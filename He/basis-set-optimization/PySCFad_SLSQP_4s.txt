#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:31 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2                    1
[INPUT] 0    0    [1    /1   ]  1.5                  1
[INPUT] 0    0    [1    /1   ]  1                    1
[INPUT] 0    0    [1    /1   ]  0.5                  1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.0, 1.0]], [0, [1.5, 1.0]], [0, [1.0, 1.0]], [0, [0.5, 1.0]]]}
ecp = {}
CPU time:         1.54
Set gradient conv threshold to 3.16228e-05
cond(S) = 13829.26774707037
E1 = -3.656210660153893  E_coul = 1.0030340847662307
init E= -2.65317657538766
    CPU time for initialize scf      0.13 sec, wall time      0.19 sec
  HOMO = -0.846208406120623  LUMO = 1.15911873381899
  mo_energy =
[-0.84620841  1.15911873  4.40932243  9.62792968]
E1 = -3.716627010045411  E_coul = 1.0185373579191326
cycle= 1 E= -2.69808965212628  delta_E= -0.0449  |g|= 0.0542  |ddm|= 9.14
    CPU time for cycle= 1      0.25 sec, wall time      0.29 sec
  HOMO = -0.839920298136269  LUMO = 1.17334234521511
  mo_energy =
[-0.8399203   1.17334235  4.42780703  9.6431129 ]
E1 = -3.7168208081219216  E_coul = 1.0184105577635771
cycle= 2 E= -2.69841025035834  delta_E= -0.000321  |g|= 0.0058  |ddm|= 1.52
    CPU time for cycle= 2      0.07 sec, wall time      0.08 sec
  HOMO = -0.840007843933577  LUMO = 1.17367663460526
  mo_energy =
[-0.84000784  1.17367663  4.4283164   9.64301448]
E1 = -3.7170954476890863  E_coul = 1.0186806605167917
cycle= 3 E= -2.69841478717229  delta_E= -4.54e-06  |g|= 0.000385  |ddm|= 0.196
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.839838188776048  LUMO = 1.17375962111463
  mo_energy =
[-0.83983819  1.17375962  4.42851543  9.64331337]
E1 = -3.7171540206175715  E_coul = 1.0187392048385397
cycle= 4 E= -2.69841481577903  delta_E= -2.86e-08  |g|= 1.45e-06  |ddm|= 0.0135
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.839837762665922  LUMO = 1.17376005703506
  mo_energy =
[-0.83983776  1.17376006  4.42851647  9.64331469]
E1 = -3.71715411509762  E_coul = 1.0187392993183522
cycle= 5 E= -2.69841481577927  delta_E= -2.36e-13  |g|= 1.26e-08  |ddm|= 6.17e-05
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.71715411509762  E_coul = 1.0187392993183522
  HOMO = -0.839837758230457  LUMO = 1.17376004793643
  mo_energy =
[-0.83983776  1.17376005  4.42851645  9.64331467]
E1 = -3.7171541177858756  E_coul = 1.01873930200661
Extra cycle  E= -2.69841481577927  delta_E= 2.22e-15  |g|= 1.15e-09  |ddm|= 2.31e-07
    CPU time for scf_cycle      0.49 sec, wall time      0.60 sec
exp = [2.  1.5 1.  0.5]
E = -2.6984148157792656
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:32 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2                    1
[INPUT] 0    0    [1    /1   ]  1.5                  1
[INPUT] 0    0    [1    /1   ]  1                    1
[INPUT] 0    0    [1    /1   ]  0.5                  1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.0, 1.0]], [0, [1.5, 1.0]], [0, [1.0, 1.0]], [0, [0.5, 1.0]]]}
ecp = {}
CPU time:         2.17
Set gradient conv threshold to 3.16228e-05
cond(S) = 13829.26774707037
E1 = -3.656210660153893  E_coul = 1.0030340847662307
init E= -2.65317657538766
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.846208406120623  LUMO = 1.15911873381899
  mo_energy =
[-0.84620841  1.15911873  4.40932243  9.62792968]
E1 = -3.716627010045411  E_coul = 1.0185373579191326
cycle= 1 E= -2.69808965212628  delta_E= -0.0449  |g|= 0.0542  |ddm|= 9.14
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.839920298136269  LUMO = 1.17334234521511
  mo_energy =
[-0.8399203   1.17334235  4.42780703  9.6431129 ]
E1 = -3.7168208081219216  E_coul = 1.0184105577635771
cycle= 2 E= -2.69841025035834  delta_E= -0.000321  |g|= 0.0058  |ddm|= 1.52
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.840007843933577  LUMO = 1.17367663460526
  mo_energy =
[-0.84000784  1.17367663  4.4283164   9.64301448]
E1 = -3.7170954476890863  E_coul = 1.0186806605167917
cycle= 3 E= -2.69841478717229  delta_E= -4.54e-06  |g|= 0.000385  |ddm|= 0.196
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.839838188776048  LUMO = 1.17375962111463
  mo_energy =
[-0.83983819  1.17375962  4.42851543  9.64331337]
E1 = -3.7171540206175715  E_coul = 1.0187392048385397
cycle= 4 E= -2.69841481577903  delta_E= -2.86e-08  |g|= 1.45e-06  |ddm|= 0.0135
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.839837762665922  LUMO = 1.17376005703506
  mo_energy =
[-0.83983776  1.17376006  4.42851647  9.64331469]
E1 = -3.71715411509762  E_coul = 1.0187392993183522
cycle= 5 E= -2.69841481577927  delta_E= -2.36e-13  |g|= 1.26e-08  |ddm|= 6.17e-05
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.71715411509762  E_coul = 1.0187392993183522
  HOMO = -0.839837758230457  LUMO = 1.17376004793643
  mo_energy =
[-0.83983776  1.17376005  4.42851645  9.64331467]
E1 = -3.7171541177858756  E_coul = 1.01873930200661
Extra cycle  E= -2.69841481577927  delta_E= 2.22e-15  |g|= 1.15e-09  |ddm|= 2.31e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 13829.26774707037
E1 = -3.7171541177858756  E_coul = 1.01873930200661
init E= -2.69841481577927
    CPU time for initialize scf      0.23 sec, wall time      0.25 sec
  HOMO = -0.839837756886327  LUMO = 1.17376004843009
  mo_energy =
[-0.83983776  1.17376005  4.42851645  9.64331467]
E1 = -3.7171541180746166  E_coul = 1.0187393022953475
cycle= 1 E= -2.69841481577927  delta_E= -3.55e-15  |g|= 1.5e-10  |ddm|= 2.88e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.7171541180746166  E_coul = 1.0187393022953475
  HOMO = -0.839837756741961  LUMO = 1.17376004848574
  mo_energy =
[-0.83983776  1.17376005  4.42851645  9.64331467]
E1 = -3.71715411810936  E_coul = 1.0187393023300932
Extra cycle  E= -2.69841481577927  delta_E= 2.22e-15  |g|= 2.31e-11  |ddm|= 4.25e-09
    CPU time for scf_cycle      0.79 sec, wall time      0.81 sec
exp = [2.  1.5 1.  0.5]
grad_E = [-0.03532591 -0.02345057 -0.01641685  0.12885635]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:37 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.03532591494        1
[INPUT] 0    0    [1    /1   ]  1.52345056519        1
[INPUT] 0    0    [1    /1   ]  1.01641684767        1
[INPUT] 0    0    [1    /1   ]  0.371143646046       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.0353259149403735, 1.0]], [0, [1.5234505651945764, 1.0]], [0, [1.0164168476708126, 1.0]], [0, [0.3711436460458648, 1.0]]]}
ecp = {}
CPU time:         6.31
Set gradient conv threshold to 3.16228e-05
cond(S) = 8579.974214490205
E1 = -3.697918092024794  E_coul = 1.0066535860632957
init E= -2.6912645059615
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.855055904610535  LUMO = 0.978057920154896
  mo_energy =
[-0.8550559   0.97805792  4.0820451   9.30481897]
E1 = -3.7213776024317893  E_coul = 1.002960524009952
cycle= 1 E= -2.71841707842184  delta_E= -0.0272  |g|= 0.0412  |ddm|= 8.42
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.857815905748227  LUMO = 0.98459845997797
  mo_energy =
[-0.85781591  0.98459846  4.0884753   9.30240531]
E1 = -3.720818491695471  E_coul = 1.0022064168943925
cycle= 2 E= -2.71861207480108  delta_E= -0.000195  |g|= 0.00448  |ddm|= 1.13
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.858230926512367  LUMO = 0.984740456044067
  mo_energy =
[-0.85823093  0.98474046  4.08859144  9.30169211]
E1 = -3.720991736457255  E_coul = 1.0023768320190731
cycle= 3 E= -2.71861490443818  delta_E= -2.83e-06  |g|= 0.000323  |ddm|= 0.148
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.85809333629623  LUMO = 0.984805078017468
  mo_energy =
[-0.85809334  0.98480508  4.08876294  9.30194197]
E1 = -3.7210425819546686  E_coul = 1.0024276558900405
cycle= 4 E= -2.71861492606463  delta_E= -2.16e-08  |g|= 7.93e-07  |ddm|= 0.0116
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.858093691393862  LUMO = 0.98480503171301
  mo_energy =
[-0.85809369  0.98480503  4.088763    9.30194174]
E1 = -3.7210424794007606  E_coul = 1.0024275533360423
cycle= 5 E= -2.71861492606472  delta_E= -9.02e-14  |g|= 1.06e-08  |ddm|= 3.65e-05
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.7210424794007606  E_coul = 1.0024275533360423
  HOMO = -0.858093686364338  LUMO = 0.984805024780032
  mo_energy =
[-0.85809369  0.98480502  4.08876297  9.30194172]
E1 = -3.721042480949715  E_coul = 1.0024275548850055
Extra cycle  E= -2.71861492606471  delta_E= 8.88e-15  |g|= 8.51e-10  |ddm|= 6.82e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.08 sec
exp = [2.03532591 1.52345057 1.01641685 0.37114365]
E = -2.7186149260647094
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:37 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.03532591494        1
[INPUT] 0    0    [1    /1   ]  1.52345056519        1
[INPUT] 0    0    [1    /1   ]  1.01641684767        1
[INPUT] 0    0    [1    /1   ]  0.371143646046       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.0353259149403735, 1.0]], [0, [1.5234505651945764, 1.0]], [0, [1.0164168476708126, 1.0]], [0, [0.3711436460458648, 1.0]]]}
ecp = {}
CPU time:         6.43
Set gradient conv threshold to 3.16228e-05
cond(S) = 8579.974214490205
E1 = -3.697918092024794  E_coul = 1.0066535860632957
init E= -2.6912645059615
    CPU time for initialize scf      0.01 sec, wall time      0.01 sec
  HOMO = -0.855055904610535  LUMO = 0.978057920154896
  mo_energy =
[-0.8550559   0.97805792  4.0820451   9.30481897]
E1 = -3.7213776024317893  E_coul = 1.002960524009952
cycle= 1 E= -2.71841707842184  delta_E= -0.0272  |g|= 0.0412  |ddm|= 8.42
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.857815905748227  LUMO = 0.98459845997797
  mo_energy =
[-0.85781591  0.98459846  4.0884753   9.30240531]
E1 = -3.720818491695471  E_coul = 1.0022064168943925
cycle= 2 E= -2.71861207480108  delta_E= -0.000195  |g|= 0.00448  |ddm|= 1.13
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.858230926512367  LUMO = 0.984740456044067
  mo_energy =
[-0.85823093  0.98474046  4.08859144  9.30169211]
E1 = -3.720991736457255  E_coul = 1.0023768320190731
cycle= 3 E= -2.71861490443818  delta_E= -2.83e-06  |g|= 0.000323  |ddm|= 0.148
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.85809333629623  LUMO = 0.984805078017468
  mo_energy =
[-0.85809334  0.98480508  4.08876294  9.30194197]
E1 = -3.7210425819546686  E_coul = 1.0024276558900405
cycle= 4 E= -2.71861492606463  delta_E= -2.16e-08  |g|= 7.93e-07  |ddm|= 0.0116
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.858093691393862  LUMO = 0.98480503171301
  mo_energy =
[-0.85809369  0.98480503  4.088763    9.30194174]
E1 = -3.7210424794007606  E_coul = 1.0024275533360423
cycle= 5 E= -2.71861492606472  delta_E= -9.02e-14  |g|= 1.06e-08  |ddm|= 3.65e-05
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.7210424794007606  E_coul = 1.0024275533360423
  HOMO = -0.858093686364338  LUMO = 0.984805024780032
  mo_energy =
[-0.85809369  0.98480502  4.08876297  9.30194172]
E1 = -3.721042480949715  E_coul = 1.0024275548850055
Extra cycle  E= -2.71861492606471  delta_E= 8.88e-15  |g|= 8.51e-10  |ddm|= 6.82e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 8579.974214490205
E1 = -3.721042480949715  E_coul = 1.0024275548850055
init E= -2.71861492606471
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.858093685589853  LUMO = 0.984805025003422
  mo_energy =
[-0.85809369  0.98480503  4.08876297  9.30194172]
E1 = -3.7210424810795697  E_coul = 1.0024275550148583
cycle= 1 E= -2.71861492606471  delta_E= -2.22e-15  |g|= 6.99e-11  |ddm|= 7.38e-09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.7210424810795697  E_coul = 1.0024275550148583
  HOMO = -0.858093685524926  LUMO = 0.98480502502226
  mo_energy =
[-0.85809369  0.98480503  4.08876297  9.30194172]
E1 = -3.7210424810910783  E_coul = 1.0024275550263728
Extra cycle  E= -2.71861492606471  delta_E= 6.22e-15  |g|= 6.05e-12  |ddm|= 6.33e-10
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [2.03532591 1.52345057 1.01641685 0.37114365]
grad_E = [-0.03690847 -0.02874666 -0.03360135  0.14393993]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:39 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.15182259655        1
[INPUT] 0    0    [1    /1   ]  1.61352651939        1
[INPUT] 0    0    [1    /1   ]  1.11992154937        1
[INPUT] 0    0    [1    /1   ]  1e-06                1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.1518225965491955, 1.0]], [0, [1.6135265193881283, 1.0]], [0, [1.119921549369776, 1.0]], [0, [1e-06, 1.0]]]}
ecp = {}
CPU time:         8.38
Set gradient conv threshold to 3.16228e-05
cond(S) = 3572.5525399891285
E1 = -3.474331526042338  E_coul = 1.003734708819065
init E= -2.47059681722327
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.80246602159529  LUMO = -0.000127193431204258
  mo_energy =
[-8.02466022e-01 -1.27193431e-04  2.99484780e+00  8.54946953e+00]
E1 = -3.740789193856518  E_coul = 1.1286523024348731
cycle= 1 E= -2.61213689142164  delta_E= -0.142  |g|= 0.0955  |ddm|= 68.6
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.741996633844307  LUMO = 1.51232128191706e-06
  mo_energy =
[-7.41996634e-01  1.51232128e-06  3.08488870e+00  8.67171596e+00]
E1 = -3.7422531668724157  E_coul = 1.1295631683373744
cycle= 2 E= -2.61268999853504  delta_E= -0.000553  |g|= 0.00815  |ddm|= 4.91
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.741543983588417  LUMO = 1.51229516749667e-06
  mo_energy =
[-7.41543984e-01  1.51229517e-06  3.08582473e+00  8.67278782e+00]
E1 = -3.7424934661891274  E_coul = 1.1297990688535273
cycle= 3 E= -2.6126943973356  delta_E= -4.4e-06  |g|= 0.000363  |ddm|= 0.469
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.741434581109792  LUMO = 1.51229431180775e-06
  mo_energy =
[-7.41434581e-01  1.51229431e-06  3.08592086e+00  8.67297999e+00]
E1 = -3.7425192746813924  E_coul = 1.1298248664180275
cycle= 4 E= -2.61269440826336  delta_E= -1.09e-08  |g|= 1.47e-08  |ddm|= 0.0245
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.741434771206754  LUMO = 1.51229430757793e-06
  mo_energy =
[-7.41434771e-01  1.51229431e-06  3.08592092e+00  8.67298026e+00]
E1 = -3.7425192747969347  E_coul = 1.1298248665338961
cycle= 5 E= -2.61269440826304  delta_E= 3.26e-13  |g|= 2.16e-11  |ddm|= 8.05e-07
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.7425192747969347  E_coul = 1.1298248665338961
  HOMO = -0.74143477086457  LUMO = 1.5122943075694e-06
  mo_energy =
[-7.41434771e-01  1.51229431e-06  3.08592092e+00  8.67298026e+00]
E1 = -3.7425192747971647  E_coul = 1.1298248665339723
Extra cycle  E= -2.61269440826319  delta_E= -1.54e-13  |g|= 3.13e-12  |ddm|= 9.66e-10
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [2.15182260e+00 1.61352652e+00 1.11992155e+00 1.00000000e-06]
E = -2.6126944082631924
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:39 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.05721986809        1
[INPUT] 0    0    [1    /1   ]  1.54037910508        1
[INPUT] 0    0    [1    /1   ]  1.03586913643        1
[INPUT] 0    0    [1    /1   ]  0.301392477237       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.0572198680907294, 1.0]], [0, [1.5403791050795947, 1.0]], [0, [1.0358691364273969, 1.0]], [0, [0.3013924772365042, 1.0]]]}
ecp = {}
CPU time:         8.51
Set gradient conv threshold to 3.16228e-05
cond(S) = 7056.899531209117
E1 = -3.7214460154181874  E_coul = 1.0090035117669494
init E= -2.71244250365124
    CPU time for initialize scf      0.01 sec, wall time      0.01 sec
  HOMO = -0.86008172941247  LUMO = 0.857299318312851
  mo_energy =
[-0.86008173  0.85729932  3.89884784  9.15828937]
E1 = -3.7239429981321743  E_coul = 0.9937175909088981
cycle= 1 E= -2.73022540722328  delta_E= -0.0178  |g|= 0.0316  |ddm|= 6.53
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.868306837947109  LUMO = 0.859742849438646
  mo_energy =
[-0.86830684  0.85974285  3.89778954  9.14502521]
E1 = -3.7228008473515417  E_coul = 0.992458096505288
cycle= 2 E= -2.73034275084625  delta_E= -0.000117  |g|= 0.00339  |ddm|= 0.829
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.868985890167031  LUMO = 0.859740122874534
  mo_energy =
[-0.86898589  0.85974012  3.89755105  9.14379848]
E1 = -3.722878989640406  E_coul = 0.9925346328980089
cycle= 3 E= -2.7303443567424  delta_E= -1.61e-06  |g|= 0.000245  |ddm|= 0.112
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.868884438393344  LUMO = 0.85978672981237
  mo_energy =
[-0.86888444  0.85978673  3.8976843   9.14398652]
E1 = -3.7229184766645154  E_coul = 0.9925741068974465
cycle= 4 E= -2.73034436976707  delta_E= -1.3e-08  |g|= 2.31e-06  |ddm|= 0.00954
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.86888524662815  LUMO = 0.85978640786677
  mo_energy =
[-0.86888525  0.85978641  3.8976837   9.14398532]
E1 = -3.7229182571981982  E_coul = 0.9925738874304718
cycle= 5 E= -2.73034436976773  delta_E= -6.57e-13  |g|= 3.99e-09  |ddm|= 0.00011
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.7229182571981982  E_coul = 0.9925738874304718
  HOMO = -0.868885241168628  LUMO = 0.859786405905609
  mo_energy =
[-0.86888524  0.85978641  3.89768368  9.14398531]
E1 = -3.7229182575483164  E_coul = 0.9925738877805839
Extra cycle  E= -2.73034436976773  delta_E= -6.22e-15  |g|= 3.59e-10  |ddm|= 3.62e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [2.05721987 1.54037911 1.03586914 0.30139248]
E = -2.7303443697677325
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:39 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.05721986809        1
[INPUT] 0    0    [1    /1   ]  1.54037910508        1
[INPUT] 0    0    [1    /1   ]  1.03586913643        1
[INPUT] 0    0    [1    /1   ]  0.301392477237       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.0572198680907294, 1.0]], [0, [1.5403791050795947, 1.0]], [0, [1.0358691364273969, 1.0]], [0, [0.3013924772365042, 1.0]]]}
ecp = {}
CPU time:         8.62
Set gradient conv threshold to 3.16228e-05
cond(S) = 7056.899531209117
E1 = -3.7214460154181874  E_coul = 1.0090035117669494
init E= -2.71244250365124
    CPU time for initialize scf      0.01 sec, wall time      0.01 sec
  HOMO = -0.86008172941247  LUMO = 0.857299318312851
  mo_energy =
[-0.86008173  0.85729932  3.89884784  9.15828937]
E1 = -3.7239429981321743  E_coul = 0.9937175909088981
cycle= 1 E= -2.73022540722328  delta_E= -0.0178  |g|= 0.0316  |ddm|= 6.53
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.868306837947109  LUMO = 0.859742849438646
  mo_energy =
[-0.86830684  0.85974285  3.89778954  9.14502521]
E1 = -3.7228008473515417  E_coul = 0.992458096505288
cycle= 2 E= -2.73034275084625  delta_E= -0.000117  |g|= 0.00339  |ddm|= 0.829
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.868985890167031  LUMO = 0.859740122874534
  mo_energy =
[-0.86898589  0.85974012  3.89755105  9.14379848]
E1 = -3.722878989640406  E_coul = 0.9925346328980089
cycle= 3 E= -2.7303443567424  delta_E= -1.61e-06  |g|= 0.000245  |ddm|= 0.112
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.868884438393344  LUMO = 0.85978672981237
  mo_energy =
[-0.86888444  0.85978673  3.8976843   9.14398652]
E1 = -3.7229184766645154  E_coul = 0.9925741068974465
cycle= 4 E= -2.73034436976707  delta_E= -1.3e-08  |g|= 2.31e-06  |ddm|= 0.00954
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.86888524662815  LUMO = 0.85978640786677
  mo_energy =
[-0.86888525  0.85978641  3.8976837   9.14398532]
E1 = -3.7229182571981982  E_coul = 0.9925738874304718
cycle= 5 E= -2.73034436976773  delta_E= -6.57e-13  |g|= 3.99e-09  |ddm|= 0.00011
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.7229182571981982  E_coul = 0.9925738874304718
  HOMO = -0.868885241168628  LUMO = 0.859786405905609
  mo_energy =
[-0.86888524  0.85978641  3.89768368  9.14398531]
E1 = -3.7229182575483164  E_coul = 0.9925738877805839
Extra cycle  E= -2.73034436976773  delta_E= -6.22e-15  |g|= 3.59e-10  |ddm|= 3.62e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 7056.899531209117
E1 = -3.7229182575483164  E_coul = 0.9925738877805839
init E= -2.73034436976773
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.868885240993574  LUMO = 0.85978640594219
  mo_energy =
[-0.86888524  0.85978641  3.89768368  9.14398531]
E1 = -3.7229182575613655  E_coul = 0.9925738877936344
cycle= 1 E= -2.73034436976773  delta_E= 1.33e-15  |g|= 3.92e-11  |ddm|= 6.54e-09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.7229182575613655  E_coul = 0.9925738877936344
  HOMO = -0.868885240987048  LUMO = 0.859786405942115
  mo_energy =
[-0.86888524  0.85978641  3.89768368  9.14398531]
E1 = -3.722918257560107  E_coul = 0.9925738877923758
Extra cycle  E= -2.73034436976773  delta_E=    0  |g|= 5.17e-12  |ddm|= 1.01e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [2.05721987 1.54037911 1.03586914 0.30139248]
grad_E = [-0.03629833 -0.0300979  -0.03847141  0.12941143]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:41 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.19847078836        1
[INPUT] 0    0    [1    /1   ]  1.65812220421        1
[INPUT] 0    0    [1    /1   ]  1.18626470102        1
[INPUT] 0    0    [1    /1   ]  1e-06                1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.1984707883620933, 1.0]], [0, [1.6581222042137755, 1.0]], [0, [1.1862647010200051, 1.0]], [0, [1e-06, 1.0]]]}
ecp = {}
CPU time:        10.83
Set gradient conv threshold to 3.16228e-05
cond(S) = 4403.0385710194905
E1 = -3.4427145471858487  E_coul = 1.0017408908006349
init E= -2.44097365638521
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.796967083858757  LUMO = -0.000139754601875318
  mo_energy =
[-7.96967084e-01 -1.39754602e-04  3.12686264e+00  8.87369999e+00]
E1 = -3.7407916740475855  E_coul = 1.1415380929869943
cycle= 1 E= -2.59925358106059  delta_E= -0.158  |g|= 0.101  |ddm|= 90.8
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.729135504497826  LUMO = 1.51263662465426e-06
  mo_energy =
[-7.29135504e-01  1.51263662e-06  3.22790887e+00  9.01106320e+00]
E1 = -3.742466894879851  E_coul = 1.1426099504259157
cycle= 2 E= -2.59985694445394  delta_E= -0.000603  |g|= 0.00852  |ddm|= 6.33
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.728600926802763  LUMO = 1.51260911018332e-06
  mo_energy =
[-7.28600927e-01  1.51260911e-06  3.22892731e+00  9.01227707e+00]
E1 = -3.742722721697689  E_coul = 1.142861114456176
cycle= 3 E= -2.59986160724151  delta_E= -4.66e-06  |g|= 0.000378  |ddm|= 0.596
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.728486842121099  LUMO = 1.51260824636597e-06
  mo_energy =
[-7.28486842e-01  1.51260825e-06  3.22902828e+00  9.01247841e+00]
E1 = -3.7427491596094136  E_coul = 1.1428875409286776
cycle= 4 E= -2.59986161868074  delta_E= -1.14e-08  |g|= 1.68e-08  |ddm|= 0.0309
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.728487039371929  LUMO = 1.51260824137961e-06
  mo_energy =
[-7.28487039e-01  1.51260824e-06  3.22902834e+00  9.01247869e+00]
E1 = -3.742749159346141  E_coul = 1.1428875406649655
cycle= 5 E= -2.59986161868118  delta_E= -4.4e-13  |g|= 3.13e-11  |ddm|= 9.61e-07
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.742749159346141  E_coul = 1.1428875406649655
  HOMO = -0.728487039008099  LUMO = 1.51260824140283e-06
  mo_energy =
[-7.28487039e-01  1.51260824e-06  3.22902834e+00  9.01247869e+00]
E1 = -3.742749159346705  E_coul = 1.1428875406655887
Extra cycle  E= -2.59986161868112  delta_E= 5.91e-14  |g|= 2.04e-12  |ddm|= 1.6e-09
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [2.19847079e+00 1.65812220e+00 1.18626470e+00 1.00000000e-06]
E = -2.5998616186811163
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:41 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.07774613687        1
[INPUT] 0    0    [1    /1   ]  1.55748926971        1
[INPUT] 0    0    [1    /1   ]  1.05772428453        1
[INPUT] 0    0    [1    /1   ]  0.257594939786       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.077746136873054, 1.0]], [0, [1.5574892697103737, 1.0]], [0, [1.0577242845323906, 1.0]], [0, [0.25759493978631787, 1.0]]]}
ecp = {}
CPU time:        10.97
Set gradient conv threshold to 3.16228e-05
cond(S) = 6448.4028225121565
E1 = -3.735206121001324  E_coul = 1.0106258507526185
init E= -2.72458027024871
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.863035671961821  LUMO = 0.771792163275376
  mo_energy =
[-0.86303567  0.77179216  3.7940212   9.10993921]
E1 = -3.725604691153897  E_coul = 0.988197256424139
cycle= 1 E= -2.73740743472976  delta_E= -0.0128  |g|= 0.0245  |ddm|= 4.03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.874637246596924  LUMO = 0.771959529215462
  mo_energy =
[-0.87463725  0.77195953  3.78810283  9.08983873]
E1 = -3.7239900646695685  E_coul = 0.9865119479083502
cycle= 2 E= -2.73747811676122  delta_E= -7.07e-05  |g|= 0.00247  |ddm|= 0.552
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.875540532625193  LUMO = 0.771840238204727
  mo_energy =
[-0.87554053  0.77184024  3.78753661  9.0881652 ]
E1 = -3.7239804273779837  E_coul = 0.9865014943522954
cycle= 3 E= -2.73747893302569  delta_E= -8.16e-07  |g|= 0.000165  |ddm|= 0.0792
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.875474440695202  LUMO = 0.771870358226596
  mo_energy =
[-0.87547444  0.77187036  3.7876274   9.08828944]
E1 = -3.7240072152379686  E_coul = 0.9865282762143109
cycle= 4 E= -2.73747893902366  delta_E= -6e-09  |g|= 3.21e-06  |ddm|= 0.00713
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.875475478014276  LUMO = 0.771869901463454
  mo_energy =
[-0.87547548  0.7718699   3.7876264   9.08828772]
E1 = -3.724006932945679  E_coul = 0.9865279939207637
cycle= 5 E= -2.73747893902492  delta_E= -1.26e-12  |g|= 1.82e-09  |ddm|= 0.000163
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.724006932945679  E_coul = 0.9865279939207637
  HOMO = -0.875475472552076  LUMO = 0.771869901212869
  mo_energy =
[-0.87547547  0.7718699   3.78762639  9.08828771]
E1 = -3.724006932658326  E_coul = 0.9865279936334057
Extra cycle  E= -2.73747893902492  delta_E= -4.88e-15  |g|= 3.04e-10  |ddm|= 5.17e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [2.07774614 1.55748927 1.05772428 0.25759494]
E = -2.7374789390249203
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:42 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.07774613687        1
[INPUT] 0    0    [1    /1   ]  1.55748926971        1
[INPUT] 0    0    [1    /1   ]  1.05772428453        1
[INPUT] 0    0    [1    /1   ]  0.257594939786       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.077746136873054, 1.0]], [0, [1.5574892697103737, 1.0]], [0, [1.0577242845323906, 1.0]], [0, [0.25759493978631787, 1.0]]]}
ecp = {}
CPU time:        11.11
Set gradient conv threshold to 3.16228e-05
cond(S) = 6448.4028225121565
E1 = -3.735206121001324  E_coul = 1.0106258507526185
init E= -2.72458027024871
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.863035671961821  LUMO = 0.771792163275376
  mo_energy =
[-0.86303567  0.77179216  3.7940212   9.10993921]
E1 = -3.725604691153897  E_coul = 0.988197256424139
cycle= 1 E= -2.73740743472976  delta_E= -0.0128  |g|= 0.0245  |ddm|= 4.03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.874637246596924  LUMO = 0.771959529215462
  mo_energy =
[-0.87463725  0.77195953  3.78810283  9.08983873]
E1 = -3.7239900646695685  E_coul = 0.9865119479083502
cycle= 2 E= -2.73747811676122  delta_E= -7.07e-05  |g|= 0.00247  |ddm|= 0.552
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.875540532625193  LUMO = 0.771840238204727
  mo_energy =
[-0.87554053  0.77184024  3.78753661  9.0881652 ]
E1 = -3.7239804273779837  E_coul = 0.9865014943522954
cycle= 3 E= -2.73747893302569  delta_E= -8.16e-07  |g|= 0.000165  |ddm|= 0.0792
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.875474440695202  LUMO = 0.771870358226596
  mo_energy =
[-0.87547444  0.77187036  3.7876274   9.08828944]
E1 = -3.7240072152379686  E_coul = 0.9865282762143109
cycle= 4 E= -2.73747893902366  delta_E= -6e-09  |g|= 3.21e-06  |ddm|= 0.00713
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.875475478014276  LUMO = 0.771869901463454
  mo_energy =
[-0.87547548  0.7718699   3.7876264   9.08828772]
E1 = -3.724006932945679  E_coul = 0.9865279939207637
cycle= 5 E= -2.73747893902492  delta_E= -1.26e-12  |g|= 1.82e-09  |ddm|= 0.000163
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.724006932945679  E_coul = 0.9865279939207637
  HOMO = -0.875475472552076  LUMO = 0.771869901212869
  mo_energy =
[-0.87547547  0.7718699   3.78762639  9.08828771]
E1 = -3.724006932658326  E_coul = 0.9865279936334057
Extra cycle  E= -2.73747893902492  delta_E= -4.88e-15  |g|= 3.04e-10  |ddm|= 5.17e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.08 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 6448.4028225121565
E1 = -3.724006932658326  E_coul = 0.9865279936334057
init E= -2.73747893902492
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.875475472695758  LUMO = 0.77186990115638
  mo_energy =
[-0.87547547  0.7718699   3.78762639  9.08828771]
E1 = -3.724006932608628  E_coul = 0.9865279935836913
cycle= 1 E= -2.73747893902494  delta_E= -1.6e-14  |g|= 5.13e-11  |ddm|= 8.98e-09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.724006932608628  E_coul = 0.9865279935836913
  HOMO = -0.875475472720622  LUMO = 0.771869901146614
  mo_energy =
[-0.87547547  0.7718699   3.78762639  9.08828771]
E1 = -3.7240069326001377  E_coul = 0.9865279935752177
Extra cycle  E= -2.73747893902492  delta_E= 1.64e-14  |g|= 8.76e-12  |ddm|= 1.52e-09
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [2.07774614 1.55748927 1.05772428 0.25759494]
grad_E = [-0.03471449 -0.02950308 -0.0376598   0.09681237]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:43 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.21038628606        1
[INPUT] 0    0    [1    /1   ]  1.66993188858        1
[INPUT] 0    0    [1    /1   ]  1.19781343543        1
[INPUT] 0    0    [1    /1   ]  0.0769177959016      1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.2103862860646615, 1.0]], [0, [1.66993188858338, 1.0]], [0, [1.1978134354310548, 1.0]], [0, [0.07691779590157202, 1.0]]]}
ecp = {}
CPU time:        13.03
Set gradient conv threshold to 3.16228e-05
cond(S) = 5258.77804021304
E1 = -3.6549904700201377  E_coul = 1.0092895896239948
init E= -2.64570088039614
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.844916329460515  LUMO = 0.267659071042372
  mo_energy =
[-0.84491633  0.26765907  3.40262728  9.17734422]
E1 = -3.7095685045942486  E_coul = 1.0076110831147256
cycle= 1 E= -2.70195742147952  delta_E= -0.0563  |g|= 0.0546  |ddm|= 48.1
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.84734202653268  LUMO = 0.274723200222779
  mo_energy =
[-0.84734203  0.2747232   3.40754472  9.17847367]
E1 = -3.7027343860198885  E_coul = 1.00039455674976
cycle= 2 E= -2.70233982927013  delta_E= -0.000382  |g|= 0.00556  |ddm|=  4.1
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.851666507573653  LUMO = 0.273666699009749
  mo_energy =
[-0.85166651  0.2736667   3.40167595  9.17014295]
E1 = -3.701469150999325  E_coul = 0.9991207446848157
cycle= 3 E= -2.70234840631451  delta_E= -8.58e-06  |g|= 0.000488  |ddm|= 0.541
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.851634331582255  LUMO = 0.273660563293123
  mo_energy =
[-0.85163433  0.27366056  3.4016167   9.17017586]
E1 = -3.7014349765091645  E_coul = 0.9990865521003689
cycle= 4 E= -2.7023484244088  delta_E= -1.81e-08  |g|= 2.14e-05  |ddm|= 0.0101
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.851630233502212  LUMO = 0.273662903478744
  mo_energy =
[-0.85163023  0.2736629   3.40162425  9.17018452]
E1 = -3.701436304504398  E_coul = 0.9990878800407001
cycle= 5 E= -2.7023484244637  delta_E= -5.49e-11  |g|= 8.12e-08  |ddm|= 0.00181
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.701436304504398  E_coul = 0.9990878800407001
  HOMO = -0.851630272211497  LUMO = 0.273662835397495
  mo_energy =
[-0.85163027  0.27366284  3.40162412  9.17018434]
E1 = -3.701436335229604  E_coul = 0.999087910766205
Extra cycle  E= -2.7023484244634  delta_E= 2.99e-13  |g|= 9.04e-09  |ddm|= 1.8e-06
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [2.21038629 1.66993189 1.19781344 0.0769178 ]
E = -2.702348424463399
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:44 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.10866877086        1
[INPUT] 0    0    [1    /1   ]  1.58370321752        1
[INPUT] 0    0    [1    /1   ]  1.09038351754        1
[INPUT] 0    0    [1    /1   ]  0.215473355755       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.1086687708593708, 1.0]], [0, [1.5837032175162533, 1.0]], [0, [1.090383517540607, 1.0]], [0, [0.2154733557554505, 1.0]]]}
ecp = {}
CPU time:        13.19
Set gradient conv threshold to 3.16228e-05
cond(S) = 6088.878016813554
E1 = -3.7454390677844054  E_coul = 1.0121882016450134
init E= -2.73325086613939
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.865253889010277  LUMO = 0.680933384402969
  mo_energy =
[-0.86525389  0.68093338  3.71178056  9.12618818]
E1 = -3.7269903790138277  E_coul = 0.9838257888846212
cycle= 1 E= -2.74316459012921  delta_E= -0.00991  |g|= 0.018  |ddm|= 0.896
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.879686574074668  LUMO = 0.679443638843963
  mo_energy =
[-0.87968657  0.67944364  3.70144168  9.10023074]
E1 = -3.724782232566809  E_coul = 0.9815806681006523
cycle= 2 E= -2.74320156446616  delta_E= -3.7e-05  |g|= 0.00143  |ddm|= 0.14
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.880892064897835  LUMO = 0.679177796068113
  mo_energy =
[-0.88089206  0.6791778   3.700406    9.09794531]
E1 = -3.7246506810929563  E_coul = 0.981448878228029
cycle= 3 E= -2.74320180286493  delta_E= -2.38e-07  |g|= 5.13e-05  |ddm|= 0.0292
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.880871289618115  LUMO = 0.679187283791488
  mo_energy =
[-0.88087129  0.67918728  3.70043483  9.09798437]
E1 = -3.7246589059946897  E_coul = 0.9814571025576836
cycle= 4 E= -2.74320180343701  delta_E= -5.72e-10  |g|= 4.12e-06  |ddm|= 0.00301
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.7246589059946897  E_coul = 0.9814571025576836
  HOMO = -0.880872350440537  LUMO = 0.679186810683915
  mo_energy =
[-0.88087235  0.67918681  3.7004337   9.09798253]
E1 = -3.724658626808614  E_coul = 0.9814568233696689
Extra cycle  E= -2.74320180343895  delta_E= -1.94e-12  |g|= 4.39e-07  |ddm|= 0.000204
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [2.10866877 1.58370322 1.09038352 0.21547336]
E = -2.743201803438945
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:44 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.10866877086        1
[INPUT] 0    0    [1    /1   ]  1.58370321752        1
[INPUT] 0    0    [1    /1   ]  1.09038351754        1
[INPUT] 0    0    [1    /1   ]  0.215473355755       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.1086687708593708, 1.0]], [0, [1.5837032175162533, 1.0]], [0, [1.090383517540607, 1.0]], [0, [0.2154733557554505, 1.0]]]}
ecp = {}
CPU time:        13.34
Set gradient conv threshold to 3.16228e-05
cond(S) = 6088.878016813554
E1 = -3.7454390677844054  E_coul = 1.0121882016450134
init E= -2.73325086613939
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.865253889010277  LUMO = 0.680933384402969
  mo_energy =
[-0.86525389  0.68093338  3.71178056  9.12618818]
E1 = -3.7269903790138277  E_coul = 0.9838257888846212
cycle= 1 E= -2.74316459012921  delta_E= -0.00991  |g|= 0.018  |ddm|= 0.896
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.879686574074668  LUMO = 0.679443638843963
  mo_energy =
[-0.87968657  0.67944364  3.70144168  9.10023074]
E1 = -3.724782232566809  E_coul = 0.9815806681006523
cycle= 2 E= -2.74320156446616  delta_E= -3.7e-05  |g|= 0.00143  |ddm|= 0.14
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.880892064897835  LUMO = 0.679177796068113
  mo_energy =
[-0.88089206  0.6791778   3.700406    9.09794531]
E1 = -3.7246506810929563  E_coul = 0.981448878228029
cycle= 3 E= -2.74320180286493  delta_E= -2.38e-07  |g|= 5.13e-05  |ddm|= 0.0292
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.880871289618115  LUMO = 0.679187283791488
  mo_energy =
[-0.88087129  0.67918728  3.70043483  9.09798437]
E1 = -3.7246589059946897  E_coul = 0.9814571025576836
cycle= 4 E= -2.74320180343701  delta_E= -5.72e-10  |g|= 4.12e-06  |ddm|= 0.00301
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.7246589059946897  E_coul = 0.9814571025576836
  HOMO = -0.880872350440537  LUMO = 0.679186810683915
  mo_energy =
[-0.88087235  0.67918681  3.7004337   9.09798253]
E1 = -3.724658626808614  E_coul = 0.9814568233696689
Extra cycle  E= -2.74320180343895  delta_E= -1.94e-12  |g|= 4.39e-07  |ddm|= 0.000204
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 6088.878016813554
E1 = -3.724658626808614  E_coul = 0.9814568233696689
init E= -2.74320180343895
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.880872490034653  LUMO = 0.679186745680079
  mo_energy =
[-0.88087249  0.67918675  3.70043351  9.09798227]
E1 = -3.7246585758922146  E_coul = 0.9814567724531964
cycle= 1 E= -2.74320180343902  delta_E= -7.33e-14  |g|= 6.41e-08  |ddm|= 2.24e-05
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.7246585758922146  E_coul = 0.9814567724531964
  HOMO = -0.880872515492912  LUMO = 0.679186734876009
  mo_energy =
[-0.88087252  0.67918673  3.70043348  9.09798222]
E1 = -3.7246585664408496  E_coul = 0.9814567630018499
Extra cycle  E= -2.743201803439  delta_E= 1.87e-14  |g|= 1.07e-08  |ddm|= 2.87e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [2.10866877 1.58370322 1.09038352 0.21547336]
grad_E = [-0.03164562 -0.02688085 -0.03196384  0.02801472]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:46 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.19483465849        1
[INPUT] 0    0    [1    /1   ]  1.65484716738        1
[INPUT] 0    0    [1    /1   ]  1.17199271222        1
[INPUT] 0    0    [1    /1   ]  0.17199328757        1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.1948346584851834, 1.0]], [0, [1.6548471673801832, 1.0]], [0, [1.1719927122170364, 1.0]], [0, [0.17199328757010296, 1.0]]]}
ecp = {}
CPU time:        15.17
Set gradient conv threshold to 3.16228e-05
cond(S) = 6257.345087641465
E1 = -3.7493101189210734  E_coul = 1.0137875881858966
init E= -2.73552253073518
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.866498815451516  LUMO = 0.581836880378252
  mo_energy =
[-0.86649882  0.58183688  3.72969323  9.4278045 ]
E1 = -3.729607918339613  E_coul = 0.9823153066623522
cycle= 1 E= -2.74729261167726  delta_E= -0.0118  |g|= 0.0182  |ddm|= 10.4
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.882506604977055  LUMO = 0.579707916373795
  mo_energy =
[-0.8825066   0.57970792  3.71572164  9.39813435]
E1 = -3.7264538477651166  E_coul = 0.9791222637056805
cycle= 2 E= -2.74733158405944  delta_E= -3.9e-05  |g|= 0.00118  |ddm|= 0.765
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.884261027913188  LUMO = 0.579189637253373
  mo_energy =
[-0.88426103  0.57918964  3.71375622  9.3946949 ]
E1 = -3.7261045345185457  E_coul = 0.9787725502036905
cycle= 3 E= -2.74733198431486  delta_E= -4e-07  |g|= 0.000124  |ddm|= 0.0797
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.884288438398855  LUMO = 0.579175821478211
  mo_energy =
[-0.88428844  0.57917582  3.71370128  9.39463856]
E1 = -3.726086900611276  E_coul = 0.9787549135958236
cycle= 4 E= -2.74733198701545  delta_E= -2.7e-09  |g|= 2.86e-07  |ddm|= 0.00381
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.884288555576265  LUMO = 0.579175837620842
  mo_energy =
[-0.88428856  0.57917584  3.71370122  9.39463846]
E1 = -3.726086864915572  E_coul = 0.9787548779001733
cycle= 5 E= -2.7473319870154  delta_E= 5.37e-14  |g|= 4.75e-09  |ddm|= 2e-05
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.726086864915572  E_coul = 0.9787548779001733
  HOMO = -0.884288554557612  LUMO = 0.579175833715032
  mo_energy =
[-0.88428855  0.57917583  3.71370122  9.39463846]
E1 = -3.7260868651954606  E_coul = 0.9787548781800265
Extra cycle  E= -2.74733198701543  delta_E= -3.55e-14  |g|= 4.12e-10  |ddm|= 2.18e-07
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [2.19483466 1.65484717 1.17199271 0.17199329]
E = -2.7473319870154342
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:46 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.19483465849        1
[INPUT] 0    0    [1    /1   ]  1.65484716738        1
[INPUT] 0    0    [1    /1   ]  1.17199271222        1
[INPUT] 0    0    [1    /1   ]  0.17199328757        1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.1948346584851834, 1.0]], [0, [1.6548471673801832, 1.0]], [0, [1.1719927122170364, 1.0]], [0, [0.17199328757010296, 1.0]]]}
ecp = {}
CPU time:        15.34
Set gradient conv threshold to 3.16228e-05
cond(S) = 6257.345087641465
E1 = -3.7493101189210734  E_coul = 1.0137875881858966
init E= -2.73552253073518
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.866498815451516  LUMO = 0.581836880378252
  mo_energy =
[-0.86649882  0.58183688  3.72969323  9.4278045 ]
E1 = -3.729607918339613  E_coul = 0.9823153066623522
cycle= 1 E= -2.74729261167726  delta_E= -0.0118  |g|= 0.0182  |ddm|= 10.4
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.882506604977055  LUMO = 0.579707916373795
  mo_energy =
[-0.8825066   0.57970792  3.71572164  9.39813435]
E1 = -3.7264538477651166  E_coul = 0.9791222637056805
cycle= 2 E= -2.74733158405944  delta_E= -3.9e-05  |g|= 0.00118  |ddm|= 0.765
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.884261027913188  LUMO = 0.579189637253373
  mo_energy =
[-0.88426103  0.57918964  3.71375622  9.3946949 ]
E1 = -3.7261045345185457  E_coul = 0.9787725502036905
cycle= 3 E= -2.74733198431486  delta_E= -4e-07  |g|= 0.000124  |ddm|= 0.0797
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.884288438398855  LUMO = 0.579175821478211
  mo_energy =
[-0.88428844  0.57917582  3.71370128  9.39463856]
E1 = -3.726086900611276  E_coul = 0.9787549135958236
cycle= 4 E= -2.74733198701545  delta_E= -2.7e-09  |g|= 2.86e-07  |ddm|= 0.00381
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.884288555576265  LUMO = 0.579175837620842
  mo_energy =
[-0.88428856  0.57917584  3.71370122  9.39463846]
E1 = -3.726086864915572  E_coul = 0.9787548779001733
cycle= 5 E= -2.7473319870154  delta_E= 5.37e-14  |g|= 4.75e-09  |ddm|= 2e-05
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.726086864915572  E_coul = 0.9787548779001733
  HOMO = -0.884288554557612  LUMO = 0.579175833715032
  mo_energy =
[-0.88428855  0.57917583  3.71370122  9.39463846]
E1 = -3.7260868651954606  E_coul = 0.9787548781800265
Extra cycle  E= -2.74733198701543  delta_E= -3.55e-14  |g|= 4.12e-10  |ddm|= 2.18e-07
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 6257.345087641465
E1 = -3.7260868651954606  E_coul = 0.9787548781800265
init E= -2.74733198701543
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.884288554417704  LUMO = 0.579175833731818
  mo_energy =
[-0.88428855  0.57917583  3.71370122  9.39463846]
E1 = -3.726086865210052  E_coul = 0.9787548781946099
cycle= 1 E= -2.74733198701544  delta_E= -7.99e-15  |g|= 3.8e-11  |ddm|= 2.04e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.726086865210052  E_coul = 0.9787548781946099
  HOMO = -0.884288554410416  LUMO = 0.57917583373155
  mo_energy =
[-0.88428855  0.57917583  3.71370122  9.39463846]
E1 = -3.726086865209713  E_coul = 0.9787548781942647
Extra cycle  E= -2.74733198701545  delta_E= -6.22e-15  |g|= 4.06e-12  |ddm|= 2.07e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [2.19483466 1.65484717 1.17199271 0.17199329]
grad_E = [-0.02443431 -0.01905665 -0.01594141 -0.13941882]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:48 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.26789453536        1
[INPUT] 0    0    [1    /1   ]  1.7123517499         1
[INPUT] 0    0    [1    /1   ]  1.23214704791        1
[INPUT] 0    0    [1    /1   ]  0.191346683637       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.267894535358404, 1.0]], [0, [1.7123517498987364, 1.0]], [0, [1.2321470479070236, 1.0]], [0, [0.19134668363657645, 1.0]]]}
ecp = {}
CPU time:        17.10
Set gradient conv threshold to 3.16228e-05
cond(S) = 7180.3533347210305
E1 = -3.7581841911747143  E_coul = 1.0146202892180818
init E= -2.74356390195663
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.869196685410129  LUMO = 0.650628226253249
  mo_energy =
[-0.86919669  0.65062823  3.94546072  9.87469027]
E1 = -3.7376815920640643  E_coul = 0.9842557598937103
cycle= 1 E= -2.75342583217035  delta_E= -0.00986  |g|= 0.0161  |ddm|= 8.62
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.884598525916364  LUMO = 0.648055980203174
  mo_energy =
[-0.88459853  0.64805598  3.93142741  9.84518865]
E1 = -3.7349326511382004  E_coul = 0.9814778332909097
cycle= 2 E= -2.75345481784729  delta_E= -2.9e-05  |g|= 0.000913  |ddm|= 0.584
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.886110416808318  LUMO = 0.647589958211306
  mo_energy =
[-0.88611042  0.64758996  3.92973153  9.84215702]
E1 = -3.7346595387491757  E_coul = 0.981204507632583
cycle= 3 E= -2.75345503111659  delta_E= -2.13e-07  |g|= 8.5e-05  |ddm|= 0.0552
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.88613093184939  LUMO = 0.647579567440158
  mo_energy =
[-0.88613093  0.64757957  3.92969217  9.84211485]
E1 = -3.734647693976419  E_coul = 0.9811926616610995
cycle= 4 E= -2.75345503231532  delta_E= -1.2e-09  |g|= 8.84e-07  |ddm|= 0.0027
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.886131229674524  LUMO = 0.647579468634267
  mo_energy =
[-0.88613123  0.64757947  3.92969184  9.84211436]
E1 = -3.7346476102400863  E_coul = 0.9811925779246897
cycle= 5 E= -2.7534550323154  delta_E= -7.73e-14  |g|= 1.39e-09  |ddm|= 6.29e-05
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.7346476102400863  E_coul = 0.9811925779246897
  HOMO = -0.886131227195356  LUMO = 0.647579465753416
  mo_energy =
[-0.88613123  0.64757947  3.92969184  9.84211436]
E1 = -3.7346476104667126  E_coul = 0.9811925781513476
Extra cycle  E= -2.75345503231536  delta_E= 3.15e-14  |g|= 1.38e-10  |ddm|= 3.19e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [2.26789454 1.71235175 1.23214705 0.19134668]
E = -2.753455032315365
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:48 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.26789453536        1
[INPUT] 0    0    [1    /1   ]  1.7123517499         1
[INPUT] 0    0    [1    /1   ]  1.23214704791        1
[INPUT] 0    0    [1    /1   ]  0.191346683637       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.267894535358404, 1.0]], [0, [1.7123517498987364, 1.0]], [0, [1.2321470479070236, 1.0]], [0, [0.19134668363657645, 1.0]]]}
ecp = {}
CPU time:        17.28
Set gradient conv threshold to 3.16228e-05
cond(S) = 7180.3533347210305
E1 = -3.7581841911747143  E_coul = 1.0146202892180818
init E= -2.74356390195663
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.869196685410129  LUMO = 0.650628226253249
  mo_energy =
[-0.86919669  0.65062823  3.94546072  9.87469027]
E1 = -3.7376815920640643  E_coul = 0.9842557598937103
cycle= 1 E= -2.75342583217035  delta_E= -0.00986  |g|= 0.0161  |ddm|= 8.62
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.884598525916364  LUMO = 0.648055980203174
  mo_energy =
[-0.88459853  0.64805598  3.93142741  9.84518865]
E1 = -3.7349326511382004  E_coul = 0.9814778332909097
cycle= 2 E= -2.75345481784729  delta_E= -2.9e-05  |g|= 0.000913  |ddm|= 0.584
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.886110416808318  LUMO = 0.647589958211306
  mo_energy =
[-0.88611042  0.64758996  3.92973153  9.84215702]
E1 = -3.7346595387491757  E_coul = 0.981204507632583
cycle= 3 E= -2.75345503111659  delta_E= -2.13e-07  |g|= 8.5e-05  |ddm|= 0.0552
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.88613093184939  LUMO = 0.647579567440158
  mo_energy =
[-0.88613093  0.64757957  3.92969217  9.84211485]
E1 = -3.734647693976419  E_coul = 0.9811926616610995
cycle= 4 E= -2.75345503231532  delta_E= -1.2e-09  |g|= 8.84e-07  |ddm|= 0.0027
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.886131229674524  LUMO = 0.647579468634267
  mo_energy =
[-0.88613123  0.64757947  3.92969184  9.84211436]
E1 = -3.7346476102400863  E_coul = 0.9811925779246897
cycle= 5 E= -2.7534550323154  delta_E= -7.73e-14  |g|= 1.39e-09  |ddm|= 6.29e-05
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.7346476102400863  E_coul = 0.9811925779246897
  HOMO = -0.886131227195356  LUMO = 0.647579465753416
  mo_energy =
[-0.88613123  0.64757947  3.92969184  9.84211436]
E1 = -3.7346476104667126  E_coul = 0.9811925781513476
Extra cycle  E= -2.75345503231536  delta_E= 3.15e-14  |g|= 1.38e-10  |ddm|= 3.19e-08
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 7180.3533347210305
E1 = -3.7346476104667126  E_coul = 0.9811925781513476
init E= -2.75345503231536
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.886131227082009  LUMO = 0.647579465786379
  mo_energy =
[-0.88613123  0.64757947  3.92969184  9.84211436]
E1 = -3.734647610492987  E_coul = 0.9811925781776628
cycle= 1 E= -2.75345503231532  delta_E= 4.04e-14  |g|= 1.77e-11  |ddm|= 1.04e-09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.734647610492987  E_coul = 0.9811925781776628
  HOMO = -0.886131227068831  LUMO = 0.647579465790741
  mo_energy =
[-0.88613123  0.64757947  3.92969184  9.84211436]
E1 = -3.7346476104964297  E_coul = 0.9811925781810659
Extra cycle  E= -2.75345503231536  delta_E= -3.95e-14  |g|= 2.57e-12  |ddm|= 2.31e-10
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [2.26789454 1.71235175 1.23214705 0.19134668]
grad_E = [-0.02350337 -0.01896665 -0.01773487 -0.09517125]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:50 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.77192097487        1
[INPUT] 0    0    [1    /1   ]  2.1133091155         1
[INPUT] 0    0    [1    /1   ]  1.6586047399         1
[INPUT] 0    0    [1    /1   ]  0.261647632357       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.7719209748706, 1.0]], [0, [2.1133091154969703, 1.0]], [0, [1.6586047398960704, 1.0]], [0, [0.2616476323573962, 1.0]]]}
ecp = {}
CPU time:        19.12
Set gradient conv threshold to 3.16228e-05
cond(S) = 14877.915963194191
E1 = -3.792672742993064  E_coul = 1.0185356163537618
init E= -2.7741371266393
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.880623243157793  LUMO = 0.957179781093936
  mo_energy =
[-0.88062324  0.95717978  5.20420324 12.75779149]
E1 = -3.776661031539607  E_coul = 0.9966655871682013
cycle= 1 E= -2.77999544437141  delta_E= -0.00586  |g|= 0.0124  |ddm|=  5.8
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.891671045096599  LUMO = 0.95410960147843
  mo_energy =
[-0.89167105  0.9541096   5.19165074 12.73266404]
E1 = -3.775110374072374  E_coul = 0.9951019852915951
cycle= 2 E= -2.78000838878078  delta_E= -1.29e-05  |g|= 0.000667  |ddm|= 0.238
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.892505582125831  LUMO = 0.95378408680384
  mo_energy =
[-0.89250558  0.95378409  5.19059207 12.73072727]
E1 = -3.7750059858753713  E_coul = 0.9949975518642766
cycle= 3 E= -2.78000843401109  delta_E= -4.52e-08  |g|= 1.24e-05  |ddm|= 0.00784
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.892505593695929  LUMO = 0.953784126245475
  mo_energy =
[-0.89250559  0.95378413  5.1905908  12.73072718]
E1 = -3.7750054467772314  E_coul = 0.9949970127590396
cycle= 4 E= -2.78000843401819  delta_E= -7.1e-12  |g|= 3.39e-07  |ddm|= 0.000391
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.7750054467772314  E_coul = 0.9949970127590396
  HOMO = -0.892505710629585  LUMO = 0.953784062520069
  mo_energy =
[-0.89250571  0.95378406  5.19059064 12.73072694]
E1 = -3.77500542031274  E_coul = 0.9949969862943749
Extra cycle  E= -2.78000843401836  delta_E= -1.73e-13  |g|= 3.38e-08  |ddm|= 3.03e-05
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [2.77192097 2.11330912 1.65860474 0.26164763]
E = -2.780008434018365
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:50 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.77192097487        1
[INPUT] 0    0    [1    /1   ]  2.1133091155         1
[INPUT] 0    0    [1    /1   ]  1.6586047399         1
[INPUT] 0    0    [1    /1   ]  0.261647632357       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [2.7719209748706, 1.0]], [0, [2.1133091154969703, 1.0]], [0, [1.6586047398960704, 1.0]], [0, [0.2616476323573962, 1.0]]]}
ecp = {}
CPU time:        19.30
Set gradient conv threshold to 3.16228e-05
cond(S) = 14877.915963194191
E1 = -3.792672742993064  E_coul = 1.0185356163537618
init E= -2.7741371266393
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.880623243157793  LUMO = 0.957179781093936
  mo_energy =
[-0.88062324  0.95717978  5.20420324 12.75779149]
E1 = -3.776661031539607  E_coul = 0.9966655871682013
cycle= 1 E= -2.77999544437141  delta_E= -0.00586  |g|= 0.0124  |ddm|=  5.8
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.891671045096599  LUMO = 0.95410960147843
  mo_energy =
[-0.89167105  0.9541096   5.19165074 12.73266404]
E1 = -3.775110374072374  E_coul = 0.9951019852915951
cycle= 2 E= -2.78000838878078  delta_E= -1.29e-05  |g|= 0.000667  |ddm|= 0.238
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.892505582125831  LUMO = 0.95378408680384
  mo_energy =
[-0.89250558  0.95378409  5.19059207 12.73072727]
E1 = -3.7750059858753713  E_coul = 0.9949975518642766
cycle= 3 E= -2.78000843401109  delta_E= -4.52e-08  |g|= 1.24e-05  |ddm|= 0.00784
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.892505593695929  LUMO = 0.953784126245475
  mo_energy =
[-0.89250559  0.95378413  5.1905908  12.73072718]
E1 = -3.7750054467772314  E_coul = 0.9949970127590396
cycle= 4 E= -2.78000843401819  delta_E= -7.1e-12  |g|= 3.39e-07  |ddm|= 0.000391
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.7750054467772314  E_coul = 0.9949970127590396
  HOMO = -0.892505710629585  LUMO = 0.953784062520069
  mo_energy =
[-0.89250571  0.95378406  5.19059064 12.73072694]
E1 = -3.77500542031274  E_coul = 0.9949969862943749
Extra cycle  E= -2.78000843401836  delta_E= -1.73e-13  |g|= 3.38e-08  |ddm|= 3.03e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 14877.915963194191
E1 = -3.77500542031274  E_coul = 0.9949969862943749
init E= -2.78000843401836
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.892505723861998  LUMO = 0.953784054701165
  mo_energy =
[-0.89250572  0.95378405  5.19059062 12.73072691]
E1 = -3.7750054163947397  E_coul = 0.9949969823763877
cycle= 1 E= -2.78000843401835  delta_E= 1.29e-14  |g|= 4.34e-09  |ddm|= 3.01e-06
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.7750054163947397  E_coul = 0.9949969823763877
  HOMO = -0.892505725820984  LUMO = 0.953784053610938
  mo_energy =
[-0.89250573  0.95378405  5.19059061 12.73072691]
E1 = -3.7750054158085846  E_coul = 0.9949969817901173
Extra cycle  E= -2.78000843401847  delta_E= -1.15e-13  |g|= 6.01e-10  |ddm|= 3.46e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [2.77192097 2.11330912 1.65860474 0.26164763]
grad_E = [-0.0151857  -0.01295422 -0.01301769 -0.02612214]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:51 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.57938016123        1
[INPUT] 0    0    [1    /1   ]  2.7573300928         1
[INPUT] 0    0    [1    /1   ]  2.34395097394        1
[INPUT] 0    0    [1    /1   ]  0.354549550966       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [3.5793801612254645, 1.0]], [0, [2.757330092795316, 1.0]], [0, [2.3439509739389304, 1.0]], [0, [0.35454955096602025, 1.0]]]}
ecp = {}
CPU time:        21.08
Set gradient conv threshold to 3.16228e-05
cond(S) = 36932.27975088064
E1 = -3.816178898925862  E_coul = 1.0220081418619715
init E= -2.79417075706389
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.889505251553181  LUMO = 1.42433941797778
  mo_energy =
[-0.88950525  1.42433942  7.15257144 17.34992905]
E1 = -3.8199267779992487  E_coul = 1.0187051331765253
cycle= 1 E= -2.80122164482272  delta_E= -0.00705  |g|= 0.0159  |ddm|= 12.7
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.891266137954982  LUMO = 1.42635952793684
  mo_energy =
[-0.89126614  1.42635953  7.15193278 17.34295626]
E1 = -3.8195996095600346  E_coul = 1.0183609275240297
cycle= 2 E= -2.80123868203601  delta_E= -1.7e-05  |g|= 0.00129  |ddm|= 1.18
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.891448285429437  LUMO = 1.42634335874425
  mo_energy =
[-0.89144829  1.42634336  7.15174662 17.34232473]
E1 = -3.8196283945759704  E_coul = 1.0183895877902236
cycle= 3 E= -2.80123880678575  delta_E= -1.25e-07  |g|= 5.77e-05  |ddm|= 0.127
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.891420876938215  LUMO = 1.42636319908526
  mo_energy =
[-0.89142088  1.4263632   7.15179808 17.34239104]
E1 = -3.8196354978308102  E_coul = 1.0183966906595243
cycle= 4 E= -2.80123880717129  delta_E= -3.86e-10  |g|= 4.75e-07  |ddm|= 0.00749
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8196354978308102  E_coul = 1.0183966906595243
  HOMO = -0.891421058255892  LUMO = 1.4263630656341
  mo_energy =
[-0.89142106  1.42636307  7.15179778 17.34239061]
E1 = -3.8196354622553814  E_coul = 1.0183966550842012
Extra cycle  E= -2.80123880717118  delta_E= 1.06e-13  |g|= 4.05e-08  |ddm|= 6.56e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [3.57938016 2.75733009 2.34395097 0.35454955]
E = -2.8012388071711802
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:52 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.57938016123        1
[INPUT] 0    0    [1    /1   ]  2.7573300928         1
[INPUT] 0    0    [1    /1   ]  2.34395097394        1
[INPUT] 0    0    [1    /1   ]  0.354549550966       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [3.5793801612254645, 1.0]], [0, [2.757330092795316, 1.0]], [0, [2.3439509739389304, 1.0]], [0, [0.35454955096602025, 1.0]]]}
ecp = {}
CPU time:        21.28
Set gradient conv threshold to 3.16228e-05
cond(S) = 36932.27975088064
E1 = -3.816178898925862  E_coul = 1.0220081418619715
init E= -2.79417075706389
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.889505251553181  LUMO = 1.42433941797778
  mo_energy =
[-0.88950525  1.42433942  7.15257144 17.34992905]
E1 = -3.8199267779992487  E_coul = 1.0187051331765253
cycle= 1 E= -2.80122164482272  delta_E= -0.00705  |g|= 0.0159  |ddm|= 12.7
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.891266137954982  LUMO = 1.42635952793684
  mo_energy =
[-0.89126614  1.42635953  7.15193278 17.34295626]
E1 = -3.8195996095600346  E_coul = 1.0183609275240297
cycle= 2 E= -2.80123868203601  delta_E= -1.7e-05  |g|= 0.00129  |ddm|= 1.18
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.891448285429437  LUMO = 1.42634335874425
  mo_energy =
[-0.89144829  1.42634336  7.15174662 17.34232473]
E1 = -3.8196283945759704  E_coul = 1.0183895877902236
cycle= 3 E= -2.80123880678575  delta_E= -1.25e-07  |g|= 5.77e-05  |ddm|= 0.127
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.891420876938215  LUMO = 1.42636319908526
  mo_energy =
[-0.89142088  1.4263632   7.15179808 17.34239104]
E1 = -3.8196354978308102  E_coul = 1.0183966906595243
cycle= 4 E= -2.80123880717129  delta_E= -3.86e-10  |g|= 4.75e-07  |ddm|= 0.00749
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8196354978308102  E_coul = 1.0183966906595243
  HOMO = -0.891421058255892  LUMO = 1.4263630656341
  mo_energy =
[-0.89142106  1.42636307  7.15179778 17.34239061]
E1 = -3.8196354622553814  E_coul = 1.0183966550842012
Extra cycle  E= -2.80123880717118  delta_E= 1.06e-13  |g|= 4.05e-08  |ddm|= 6.56e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 36932.27975088064
E1 = -3.8196354622553814  E_coul = 1.0183966550842012
init E= -2.80123880717118
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.891421076043497  LUMO = 1.42636305248499
  mo_energy =
[-0.89142108  1.42636305  7.15179775 17.34239057]
E1 = -3.8196354580428906  E_coul = 1.0183966508718267
cycle= 1 E= -2.80123880717106  delta_E= 1.16e-13  |g|= 4.34e-09  |ddm|= 5.61e-06
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8196354580428906  E_coul = 1.0183966508718267
  HOMO = -0.891421078149619  LUMO = 1.42636305098727
  mo_energy =
[-0.89142108  1.42636305  7.15179774 17.34239056]
E1 = -3.819635457534182  E_coul = 1.0183966503630602
Extra cycle  E= -2.80123880717112  delta_E= -5.77e-14  |g|= 4.96e-10  |ddm|= 5.48e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [3.57938016 2.75733009 2.34395097 0.35454955]
grad_E = [-0.0088828  -0.00812599 -0.00852258  0.06875448]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:54 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  4.16846489648        1
[INPUT] 0    0    [1    /1   ]  3.22814633302        1
[INPUT] 0    0    [1    /1   ]  2.84308221147        1
[INPUT] 0    0    [1    /1   ]  0.392804433192       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [4.168464896483752, 1.0]], [0, [3.2281463330169764, 1.0]], [0, [2.8430822114725682, 1.0]], [0, [0.39280443319245434, 1.0]]]}
ecp = {}
CPU time:        23.22
Set gradient conv threshold to 3.16228e-05
cond(S) = 61888.34725653504
E1 = -3.823610160752729  E_coul = 1.0234028588818083
init E= -2.80020730187092
    CPU time for initialize scf      0.02 sec, wall time      0.03 sec
  HOMO = -0.892759988002467  LUMO = 1.695561640047
  mo_energy =
[-0.89275999  1.69556164  8.47162885 20.61788152]
E1 = -3.8371869511386896  E_coul = 1.0280921512767645
cycle= 1 E= -2.80909479986193  delta_E= -0.00889  |g|= 0.0161  |ddm|= 23.9
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.89050826602131  LUMO = 1.70108674632315
  mo_energy =
[-0.89050827  1.70108675  8.47750594 20.62036229]
E1 = -3.8370084853768764  E_coul = 1.0278987508576394
cycle= 2 E= -2.80910973451924  delta_E= -1.49e-05  |g|= 0.00122  |ddm|= 1.78
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.890610793907664  LUMO = 1.70110196619884
  mo_energy =
[-0.89061079  1.70110197  8.47739146 20.61987889]
E1 = -3.8370357152205785  E_coul = 1.0279258871210522
cycle= 3 E= -2.80910982809953  delta_E= -9.36e-08  |g|= 4.34e-05  |ddm|= 0.166
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.890589470016682  LUMO = 1.70111931285285
  mo_energy =
[-0.89058947  1.70111931  8.47743469 20.61993426]
E1 = -3.837040573809374  E_coul = 1.0279307455246895
cycle= 4 E= -2.80910982828468  delta_E= -1.85e-10  |g|= 1.69e-07  |ddm|= 0.00755
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.837040573809374  E_coul = 1.0279307455246895
  HOMO = -0.890589541379994  LUMO = 1.70111925558875
  mo_energy =
[-0.89058954  1.70111926  8.47743457 20.61993409]
E1 = -3.8370405619077186  E_coul = 1.0279307336237606
Extra cycle  E= -2.80910982828396  delta_E= 7.26e-13  |g|= 1.32e-08  |ddm|= 3.18e-05
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [4.1684649  3.22814633 2.84308221 0.39280443]
E = -2.809109828283958
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:54 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  4.16846489648        1
[INPUT] 0    0    [1    /1   ]  3.22814633302        1
[INPUT] 0    0    [1    /1   ]  2.84308221147        1
[INPUT] 0    0    [1    /1   ]  0.392804433192       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [4.168464896483752, 1.0]], [0, [3.2281463330169764, 1.0]], [0, [2.8430822114725682, 1.0]], [0, [0.39280443319245434, 1.0]]]}
ecp = {}
CPU time:        23.47
Set gradient conv threshold to 3.16228e-05
cond(S) = 61888.34725653504
E1 = -3.823610160752729  E_coul = 1.0234028588818083
init E= -2.80020730187092
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.892759988002467  LUMO = 1.695561640047
  mo_energy =
[-0.89275999  1.69556164  8.47162885 20.61788152]
E1 = -3.8371869511386896  E_coul = 1.0280921512767645
cycle= 1 E= -2.80909479986193  delta_E= -0.00889  |g|= 0.0161  |ddm|= 23.9
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.89050826602131  LUMO = 1.70108674632315
  mo_energy =
[-0.89050827  1.70108675  8.47750594 20.62036229]
E1 = -3.8370084853768764  E_coul = 1.0278987508576394
cycle= 2 E= -2.80910973451924  delta_E= -1.49e-05  |g|= 0.00122  |ddm|= 1.78
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.890610793907664  LUMO = 1.70110196619884
  mo_energy =
[-0.89061079  1.70110197  8.47739146 20.61987889]
E1 = -3.8370357152205785  E_coul = 1.0279258871210522
cycle= 3 E= -2.80910982809953  delta_E= -9.36e-08  |g|= 4.34e-05  |ddm|= 0.166
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.890589470016682  LUMO = 1.70111931285285
  mo_energy =
[-0.89058947  1.70111931  8.47743469 20.61993426]
E1 = -3.837040573809374  E_coul = 1.0279307455246895
cycle= 4 E= -2.80910982828468  delta_E= -1.85e-10  |g|= 1.69e-07  |ddm|= 0.00755
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.837040573809374  E_coul = 1.0279307455246895
  HOMO = -0.890589541379994  LUMO = 1.70111925558875
  mo_energy =
[-0.89058954  1.70111926  8.47743457 20.61993409]
E1 = -3.8370405619077186  E_coul = 1.0279307336237606
Extra cycle  E= -2.80910982828396  delta_E= 7.26e-13  |g|= 1.32e-08  |ddm|= 3.18e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 61888.34725653504
E1 = -3.8370405619077186  E_coul = 1.0279307336237606
init E= -2.80910982828396
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.8905895473301  LUMO = 1.70111925063126
  mo_energy =
[-0.89058955  1.70111925  8.47743456 20.61993407]
E1 = -3.837040560648697  E_coul = 1.0279307323655855
cycle= 1 E= -2.80910982828311  delta_E= 8.47e-13  |g|= 1.28e-09  |ddm|= 2.48e-06
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.837040560648697  E_coul = 1.0279307323655855
  HOMO = -0.890589547958771  LUMO = 1.70111925013318
  mo_energy =
[-0.89058955  1.70111925  8.47743456 20.61993407]
E1 = -3.8370405605118822  E_coul = 1.0279307322277123
Extra cycle  E= -2.80910982828417  delta_E= -1.06e-12  |g|= 1.25e-10  |ddm|= 2.24e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [4.1684649  3.22814633 2.84308221 0.39280443]
grad_E = [-0.00578518 -0.00516477 -0.00519006  0.07883978]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:56 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  4.79845232966        1
[INPUT] 0    0    [1    /1   ]  3.73170540785        1
[INPUT] 0    0    [1    /1   ]  3.37486785647        1
[INPUT] 0    0    [1    /1   ]  0.412570377806       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [4.798452329661563, 1.0]], [0, [3.731705407845266, 1.0]], [0, [3.3748678564749697, 1.0]], [0, [0.4125703778064201, 1.0]]]}
ecp = {}
CPU time:        25.31
Set gradient conv threshold to 3.16228e-05
cond(S) = 98998.92321964835
E1 = -3.8293952338144943  E_coul = 1.0240395219465739
init E= -2.80535571186792
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.895049323018042  LUMO = 1.9290583612211
  mo_energy =
[-0.89504932  1.92905836  9.80957544 24.05372246]
E1 = -3.8441701024791244  E_coul = 1.0299621067539515
cycle= 1 E= -2.81420799572517  delta_E= -0.00885  |g|= 0.0114  |ddm|= 19.1
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.892126060731698  LUMO = 1.93535404408675
  mo_energy =
[-0.89212606  1.93535404  9.81620999 24.05778228]
E1 = -3.8437121703032973  E_coul = 1.0294975591661817
cycle= 2 E= -2.81421461113712  delta_E= -6.62e-06  |g|= 0.000726  |ddm|= 1.08
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.892371683526696  LUMO = 1.93520839899691
  mo_energy =
[-0.89237168  1.9352084   9.81572202 24.0568676 ]
E1 = -3.843697943219934  E_coul = 1.0294833057725705
cycle= 3 E= -2.81421463744736  delta_E= -2.63e-08  |g|= 1.27e-05  |ddm|=  0.1
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.892364882146022  LUMO = 1.93521460640485
  mo_energy =
[-0.89236488  1.93521461  9.8157368  24.05688661]
E1 = -3.843699265564158  E_coul = 1.0294846281035697
cycle= 4 E= -2.81421463746059  delta_E= -1.32e-11  |g|= 2.87e-07  |ddm|= 0.00346
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.843699265564158  E_coul = 1.0294846281035697
  HOMO = -0.892365004678507  LUMO = 1.93521449245112
  mo_energy =
[-0.892365    1.93521449  9.81573655 24.05688626]
E1 = -3.8436992457677803  E_coul = 1.029484608307318
Extra cycle  E= -2.81421463746046  delta_E= 1.26e-13  |g|= 2.05e-08  |ddm|= 7.63e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [4.79845233 3.73170541 3.37486786 0.41257038]
E = -2.8142146374604624
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:56 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  4.79845232966        1
[INPUT] 0    0    [1    /1   ]  3.73170540785        1
[INPUT] 0    0    [1    /1   ]  3.37486785647        1
[INPUT] 0    0    [1    /1   ]  0.412570377806       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [4.798452329661563, 1.0]], [0, [3.731705407845266, 1.0]], [0, [3.3748678564749697, 1.0]], [0, [0.4125703778064201, 1.0]]]}
ecp = {}
CPU time:        25.53
Set gradient conv threshold to 3.16228e-05
cond(S) = 98998.92321964835
E1 = -3.8293952338144943  E_coul = 1.0240395219465739
init E= -2.80535571186792
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.895049323018042  LUMO = 1.9290583612211
  mo_energy =
[-0.89504932  1.92905836  9.80957544 24.05372246]
E1 = -3.8441701024791244  E_coul = 1.0299621067539515
cycle= 1 E= -2.81420799572517  delta_E= -0.00885  |g|= 0.0114  |ddm|= 19.1
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.892126060731698  LUMO = 1.93535404408675
  mo_energy =
[-0.89212606  1.93535404  9.81620999 24.05778228]
E1 = -3.8437121703032973  E_coul = 1.0294975591661817
cycle= 2 E= -2.81421461113712  delta_E= -6.62e-06  |g|= 0.000726  |ddm|= 1.08
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.892371683526696  LUMO = 1.93520839899691
  mo_energy =
[-0.89237168  1.9352084   9.81572202 24.0568676 ]
E1 = -3.843697943219934  E_coul = 1.0294833057725705
cycle= 3 E= -2.81421463744736  delta_E= -2.63e-08  |g|= 1.27e-05  |ddm|=  0.1
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.892364882146022  LUMO = 1.93521460640485
  mo_energy =
[-0.89236488  1.93521461  9.8157368  24.05688661]
E1 = -3.843699265564158  E_coul = 1.0294846281035697
cycle= 4 E= -2.81421463746059  delta_E= -1.32e-11  |g|= 2.87e-07  |ddm|= 0.00346
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.843699265564158  E_coul = 1.0294846281035697
  HOMO = -0.892365004678507  LUMO = 1.93521449245112
  mo_energy =
[-0.892365    1.93521449  9.81573655 24.05688626]
E1 = -3.8436992457677803  E_coul = 1.029484608307318
Extra cycle  E= -2.81421463746046  delta_E= 1.26e-13  |g|= 2.05e-08  |ddm|= 7.63e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 98998.92321964835
E1 = -3.8436992457677803  E_coul = 1.029484608307318
init E= -2.81421463746046
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.892365014576558  LUMO = 1.93521448328595
  mo_energy =
[-0.89236501  1.93521448  9.81573653 24.05688624]
E1 = -3.843699243910978  E_coul = 1.0294846064500784
cycle= 1 E= -2.8142146374609  delta_E= -4.37e-13  |g|= 1.78e-09  |ddm|= 5.46e-06
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.843699243910978  E_coul = 1.0294846064500784
  HOMO = -0.892365015505417  LUMO = 1.93521448244196
  mo_energy =
[-0.89236502  1.93521448  9.81573652 24.05688623]
E1 = -3.843699243733325  E_coul = 1.029484606272533
Extra cycle  E= -2.81421463746079  delta_E= 1.07e-13  |g|= 1.65e-10  |ddm|= 4.36e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [4.79845233 3.73170541 3.37486786 0.41257038]
grad_E = [-0.00304512 -0.00210262 -0.00170779  0.04071142]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:58 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  5.22175520883        1
[INPUT] 0    0    [1    /1   ]  4.06916326777        1
[INPUT] 0    0    [1    /1   ]  3.73029360206        1
[INPUT] 0    0    [1    /1   ]  0.421756757598       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [5.221755208827517, 1.0]], [0, [4.069163267772936, 1.0]], [0, [3.73029360205711, 1.0]], [0, [0.42175675759840736, 1.0]]]}
ecp = {}
CPU time:        27.35
Set gradient conv threshold to 3.16228e-05
cond(S) = 132075.60723264192
E1 = -3.830625343110244  E_coul = 1.024042133231754
init E= -2.80658320987849
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.895768087495971  LUMO = 2.07491891612481
  mo_energy =
[-0.89576809  2.07491892 10.69517863 26.3544139 ]
E1 = -3.8445545265579693  E_coul = 1.0289426008440763
cycle= 1 E= -2.81561192571389  delta_E= -0.00903  |g|= 0.00847  |ddm|= 1.94
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.893336611451213  LUMO = 2.08083049849256
  mo_energy =
[-0.89333661  2.0808305  10.70043443 26.35696262]
E1 = -3.8438417615633855  E_coul = 1.0282257312958294
cycle= 2 E= -2.81561603026756  delta_E= -4.1e-06  |g|= 0.000424  |ddm|= 0.238
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.893716014724911  LUMO = 2.08052729142372
  mo_energy =
[-0.89371601  2.08052729 10.69959154 26.35562498]
E1 = -3.843799456511054  E_coul = 1.0281834143892927
cycle= 3 E= -2.81561604212176  delta_E= -1.19e-08  |g|= 5.08e-06  |ddm|= 0.0016
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.89371635328182  LUMO = 2.08052705579461
  mo_energy =
[-0.89371635  2.08052706 10.69959046 26.35562413]
E1 = -3.843799304099244  E_coul = 1.028183261976181
cycle= 4 E= -2.81561604212306  delta_E= -1.3e-12  |g|= 8.21e-08  |ddm|= 0.000327
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.843799304099244  E_coul = 1.028183261976181
  HOMO = -0.893716390073446  LUMO = 2.08052702014682
  mo_energy =
[-0.89371639  2.08052702 10.69959038 26.35562402]
E1 = -3.8437992986008997  E_coul = 1.028183256478869
Extra cycle  E= -2.81561604212203  delta_E= 1.03e-12  |g|= 5.58e-09  |ddm|= 2.72e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [5.22175521 4.06916327 3.7302936  0.42175676]
E = -2.8156160421220306
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:09:58 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  5.22175520883        1
[INPUT] 0    0    [1    /1   ]  4.06916326777        1
[INPUT] 0    0    [1    /1   ]  3.73029360206        1
[INPUT] 0    0    [1    /1   ]  0.421756757598       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [5.221755208827517, 1.0]], [0, [4.069163267772936, 1.0]], [0, [3.73029360205711, 1.0]], [0, [0.42175675759840736, 1.0]]]}
ecp = {}
CPU time:        27.60
Set gradient conv threshold to 3.16228e-05
cond(S) = 132075.60723264192
E1 = -3.830625343110244  E_coul = 1.024042133231754
init E= -2.80658320987849
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.895768087495971  LUMO = 2.07491891612481
  mo_energy =
[-0.89576809  2.07491892 10.69517863 26.3544139 ]
E1 = -3.8445545265579693  E_coul = 1.0289426008440763
cycle= 1 E= -2.81561192571389  delta_E= -0.00903  |g|= 0.00847  |ddm|= 1.94
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.893336611451213  LUMO = 2.08083049849256
  mo_energy =
[-0.89333661  2.0808305  10.70043443 26.35696262]
E1 = -3.8438417615633855  E_coul = 1.0282257312958294
cycle= 2 E= -2.81561603026756  delta_E= -4.1e-06  |g|= 0.000424  |ddm|= 0.238
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.893716014724911  LUMO = 2.08052729142372
  mo_energy =
[-0.89371601  2.08052729 10.69959154 26.35562498]
E1 = -3.843799456511054  E_coul = 1.0281834143892927
cycle= 3 E= -2.81561604212176  delta_E= -1.19e-08  |g|= 5.08e-06  |ddm|= 0.0016
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.89371635328182  LUMO = 2.08052705579461
  mo_energy =
[-0.89371635  2.08052706 10.69959046 26.35562413]
E1 = -3.843799304099244  E_coul = 1.028183261976181
cycle= 4 E= -2.81561604212306  delta_E= -1.3e-12  |g|= 8.21e-08  |ddm|= 0.000327
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.843799304099244  E_coul = 1.028183261976181
  HOMO = -0.893716390073446  LUMO = 2.08052702014682
  mo_energy =
[-0.89371639  2.08052702 10.69959038 26.35562402]
E1 = -3.8437992986008997  E_coul = 1.028183256478869
Extra cycle  E= -2.81561604212203  delta_E= 1.03e-12  |g|= 5.58e-09  |ddm|= 2.72e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 132075.60723264192
E1 = -3.8437992986008997  E_coul = 1.028183256478869
init E= -2.81561604212203
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.893716392821613  LUMO = 2.08052701744475
  mo_energy =
[-0.89371639  2.08052702 10.69959038 26.35562402]
E1 = -3.8437992981186966  E_coul = 1.0281832559915813
cycle= 1 E= -2.81561604212712  delta_E= -5.08e-12  |g|= 4.15e-10  |ddm|= 1.85e-06
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8437992981186966  E_coul = 1.0281832559915813
  HOMO = -0.893716393067789  LUMO = 2.08052701713068
  mo_energy =
[-0.89371639  2.08052702 10.69959038 26.35562401]
E1 = -3.843799298083211  E_coul = 1.0281832559601194
Extra cycle  E= -2.81561604212309  delta_E= 4.02e-12  |g|= 1.56e-10  |ddm|= 8.83e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [5.22175521 4.06916327 3.7302936  0.42175676]
grad_E = [-0.00157256 -0.00032532  0.00025205  0.00489444]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:00 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  5.42340821291        1
[INPUT] 0    0    [1    /1   ]  4.22879711045        1
[INPUT] 0    0    [1    /1   ]  3.89813955315        1
[INPUT] 0    0    [1    /1   ]  0.429258999847       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [5.423408212909818, 1.0]], [0, [4.228797110451334, 1.0]], [0, [3.8981395531455267, 1.0]], [0, [0.42925899984705634, 1.0]]]}
ecp = {}
CPU time:        29.74
Set gradient conv threshold to 3.16228e-05
cond(S) = 150884.90066882025
E1 = -3.8303296944193623  E_coul = 1.0241421992972983
init E= -2.80618749512206
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.895809208038456  LUMO = 2.15489839082225
  mo_energy =
[-0.89580921  2.15489839 11.12779555 27.46031529]
E1 = -3.845683543664423  E_coul = 1.0298975374147712
cycle= 1 E= -2.81578600624965  delta_E= -0.0096  |g|= 0.0081  |ddm|= 2.19
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.89294612228136  LUMO = 2.16142443831428
  mo_energy =
[-0.89294612  2.16142444 11.13387671 27.46398822]
E1 = -3.8449223224832516  E_coul = 1.0291323404945352
cycle= 2 E= -2.81578998198872  delta_E= -3.98e-06  |g|= 0.000382  |ddm|= 0.61
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.893351177098898  LUMO = 2.16108174847831
  mo_energy =
[-0.89335118  2.16108175 11.13294689 27.46254928]
E1 = -3.844874948294363  E_coul = 1.0290849546538028
cycle= 3 E= -2.81578999364056  delta_E= -1.17e-08  |g|= 6.74e-06  |ddm|= 0.0257
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.893352639157746  LUMO = 2.16108039386653
  mo_energy =
[-0.89335264  2.16108039 11.13294312 27.46254509]
E1 = -3.844874589434519  E_coul = 1.029084595786388
cycle= 4 E= -2.81578999364813  delta_E= -7.57e-12  |g|= 1.33e-07  |ddm|= 0.000303
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.844874589434519  E_coul = 1.029084595786388
  HOMO = -0.893352698930869  LUMO = 2.16108033361101
  mo_energy =
[-0.8933527   2.16108033 11.13294299 27.46254491]
E1 = -3.8448745805604227  E_coul = 1.0290845869110592
Extra cycle  E= -2.81578999364936  delta_E= -1.23e-12  |g|= 8.77e-09  |ddm|= 4.84e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [5.42340821 4.22879711 3.89813955 0.429259  ]
E = -2.8157899936493633
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:00 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  5.42340821291        1
[INPUT] 0    0    [1    /1   ]  4.22879711045        1
[INPUT] 0    0    [1    /1   ]  3.89813955315        1
[INPUT] 0    0    [1    /1   ]  0.429258999847       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [5.423408212909818, 1.0]], [0, [4.228797110451334, 1.0]], [0, [3.8981395531455267, 1.0]], [0, [0.42925899984705634, 1.0]]]}
ecp = {}
CPU time:        30.03
Set gradient conv threshold to 3.16228e-05
cond(S) = 150884.90066882025
E1 = -3.8303296944193623  E_coul = 1.0241421992972983
init E= -2.80618749512206
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.895809208038456  LUMO = 2.15489839082225
  mo_energy =
[-0.89580921  2.15489839 11.12779555 27.46031529]
E1 = -3.845683543664423  E_coul = 1.0298975374147712
cycle= 1 E= -2.81578600624965  delta_E= -0.0096  |g|= 0.0081  |ddm|= 2.19
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.89294612228136  LUMO = 2.16142443831428
  mo_energy =
[-0.89294612  2.16142444 11.13387671 27.46398822]
E1 = -3.8449223224832516  E_coul = 1.0291323404945352
cycle= 2 E= -2.81578998198872  delta_E= -3.98e-06  |g|= 0.000382  |ddm|= 0.61
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.893351177098898  LUMO = 2.16108174847831
  mo_energy =
[-0.89335118  2.16108175 11.13294689 27.46254928]
E1 = -3.844874948294363  E_coul = 1.0290849546538028
cycle= 3 E= -2.81578999364056  delta_E= -1.17e-08  |g|= 6.74e-06  |ddm|= 0.0257
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.893352639157746  LUMO = 2.16108039386653
  mo_energy =
[-0.89335264  2.16108039 11.13294312 27.46254509]
E1 = -3.844874589434519  E_coul = 1.029084595786388
cycle= 4 E= -2.81578999364813  delta_E= -7.57e-12  |g|= 1.33e-07  |ddm|= 0.000303
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.844874589434519  E_coul = 1.029084595786388
  HOMO = -0.893352698930869  LUMO = 2.16108033361101
  mo_energy =
[-0.8933527   2.16108033 11.13294299 27.46254491]
E1 = -3.8448745805604227  E_coul = 1.0290845869110592
Extra cycle  E= -2.81578999364936  delta_E= -1.23e-12  |g|= 8.77e-09  |ddm|= 4.84e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 150884.90066882025
E1 = -3.8448745805604227  E_coul = 1.0290845869110592
init E= -2.81578999364936
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.893352703369109  LUMO = 2.16108032908874
  mo_energy =
[-0.8933527   2.16108033 11.13294298 27.46254489]
E1 = -3.8448745798098414  E_coul = 1.0290845861618458
cycle= 1 E= -2.815789993648  delta_E= 1.37e-12  |g|= 7.24e-10  |ddm|= 3.18e-06
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8448745798098414  E_coul = 1.0290845861618458
  HOMO = -0.893352703743135  LUMO = 2.16108032873714
  mo_energy =
[-0.8933527   2.16108033 11.13294298 27.46254489]
E1 = -3.8448745797426565  E_coul = 1.029084586093633
Extra cycle  E= -2.81578999364902  delta_E= -1.03e-12  |g|= 5.39e-11  |ddm|= 2.48e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [5.42340821 4.22879711 3.89813955 0.429259  ]
grad_E = [-0.00111612  0.00019831  0.00078925 -0.00024121]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:02 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  5.4820694789         1
[INPUT] 0    0    [1    /1   ]  4.27414299242        1
[INPUT] 0    0    [1    /1   ]  3.94533871946        1
[INPUT] 0    0    [1    /1   ]  0.431815054739       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [5.482069478897084, 1.0]], [0, [4.274142992419195, 1.0]], [0, [3.945338719459953, 1.0]], [0, [0.4318150547393541, 1.0]]]}
ecp = {}
CPU time:        32.03
Set gradient conv threshold to 3.16228e-05
cond(S) = 155926.40690722325
E1 = -3.830181106880637  E_coul = 1.024192021075656
init E= -2.80598908580498
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.895791356173038  LUMO = 2.17915484869317
  mo_energy =
[-0.89579136  2.17915485 11.25268482 27.77781077]
E1 = -3.8461847969752125  E_coul = 1.0303872993074492
cycle= 1 E= -2.81579749766776  delta_E= -0.00981  |g|= 0.00806  |ddm|= 2.18
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.892706983945728  LUMO = 2.18597927197919
  mo_energy =
[-0.89270698  2.18597927 11.25922934 27.78208754]
E1 = -3.845419121590855  E_coul = 1.0296176543338293
cycle= 2 E= -2.81580146725703  delta_E= -3.97e-06  |g|= 0.000378  |ddm|= 0.659
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.893114393566046  LUMO = 2.18563045647975
  mo_energy =
[-0.89311439  2.18563046 11.25828626 27.78063369]
E1 = -3.845371234416536  E_coul = 1.0295697554597527
cycle= 3 E= -2.81580147895678  delta_E= -1.17e-08  |g|= 6.91e-06  |ddm|= 0.0293
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.893115990635184  LUMO = 2.18562895516716
  mo_energy =
[-0.89311599  2.18562896 11.25828215 27.78062907]
E1 = -3.8453708544683494  E_coul = 1.0295693754983348
cycle= 4 E= -2.81580147897001  delta_E= -1.32e-11  |g|= 1.36e-07  |ddm|= 0.000392
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8453708544683494  E_coul = 1.0295693754983348
  HOMO = -0.893116051735837  LUMO = 2.18562889299467
  mo_energy =
[-0.89311605  2.18562889 11.25828201 27.78062888]
E1 = -3.845370845458817  E_coul = 1.0295693664926775
Extra cycle  E= -2.81580147896614  delta_E= 3.87e-12  |g|= 8.99e-09  |ddm|= 5.03e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [5.48206948 4.27414299 3.94533872 0.43181505]
E = -2.8158014789661396
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:03 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  5.4820694789         1
[INPUT] 0    0    [1    /1   ]  4.27414299242        1
[INPUT] 0    0    [1    /1   ]  3.94533871946        1
[INPUT] 0    0    [1    /1   ]  0.431815054739       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [5.482069478897084, 1.0]], [0, [4.274142992419195, 1.0]], [0, [3.945338719459953, 1.0]], [0, [0.4318150547393541, 1.0]]]}
ecp = {}
CPU time:        32.31
Set gradient conv threshold to 3.16228e-05
cond(S) = 155926.40690722325
E1 = -3.830181106880637  E_coul = 1.024192021075656
init E= -2.80598908580498
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.895791356173038  LUMO = 2.17915484869317
  mo_energy =
[-0.89579136  2.17915485 11.25268482 27.77781077]
E1 = -3.8461847969752125  E_coul = 1.0303872993074492
cycle= 1 E= -2.81579749766776  delta_E= -0.00981  |g|= 0.00806  |ddm|= 2.18
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.892706983945728  LUMO = 2.18597927197919
  mo_energy =
[-0.89270698  2.18597927 11.25922934 27.78208754]
E1 = -3.845419121590855  E_coul = 1.0296176543338293
cycle= 2 E= -2.81580146725703  delta_E= -3.97e-06  |g|= 0.000378  |ddm|= 0.659
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.893114393566046  LUMO = 2.18563045647975
  mo_energy =
[-0.89311439  2.18563046 11.25828626 27.78063369]
E1 = -3.845371234416536  E_coul = 1.0295697554597527
cycle= 3 E= -2.81580147895678  delta_E= -1.17e-08  |g|= 6.91e-06  |ddm|= 0.0293
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.893115990635184  LUMO = 2.18562895516716
  mo_energy =
[-0.89311599  2.18562896 11.25828215 27.78062907]
E1 = -3.8453708544683494  E_coul = 1.0295693754983348
cycle= 4 E= -2.81580147897001  delta_E= -1.32e-11  |g|= 1.36e-07  |ddm|= 0.000392
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8453708544683494  E_coul = 1.0295693754983348
  HOMO = -0.893116051735837  LUMO = 2.18562889299467
  mo_energy =
[-0.89311605  2.18562889 11.25828201 27.78062888]
E1 = -3.845370845458817  E_coul = 1.0295693664926775
Extra cycle  E= -2.81580147896614  delta_E= 3.87e-12  |g|= 8.99e-09  |ddm|= 5.03e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 155926.40690722325
E1 = -3.845370845458817  E_coul = 1.0295693664926775
init E= -2.81580147896614
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.893116056236727  LUMO = 2.18562888844734
  mo_energy =
[-0.89311606  2.18562889 11.258282   27.78062887]
E1 = -3.845370844695172  E_coul = 1.029569365722063
cycle= 1 E= -2.81580147897311  delta_E= -6.97e-12  |g|= 6.39e-10  |ddm|= 3.34e-06
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.845370844695172  E_coul = 1.029569365722063
  HOMO = -0.89311605662551  LUMO = 2.18562888795143
  mo_energy =
[-0.89311606  2.18562889 11.258282   27.78062887]
E1 = -3.845370844639698  E_coul = 1.0295693656802651
Extra cycle  E= -2.81580147895943  delta_E= 1.37e-11  |g|= 5.12e-10  |ddm|= 1.66e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [5.48206948 4.27414299 3.94533872 0.43181505]
grad_E = [-1.01461958e-03  3.09370108e-04  8.98014164e-04 -4.11079802e-05]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:05 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  5.49460393135        1
[INPUT] 0    0    [1    /1   ]  4.28264517922        1
[INPUT] 0    0    [1    /1   ]  3.95361329497        1
[INPUT] 0    0    [1    /1   ]  0.432281388357       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [5.4946039313466075, 1.0]], [0, [4.28264517922091, 1.0]], [0, [3.953613294970735, 1.0]], [0, [0.43228138835656454, 1.0]]]}
ecp = {}
CPU time:        34.23
Set gradient conv threshold to 3.16228e-05
cond(S) = 155956.6320740524
E1 = -3.830153472654453  E_coul = 1.024200607303827
init E= -2.80595286535063
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.89578849428624  LUMO = 2.18369192220252
  mo_energy =
[-0.89578849  2.18369192 11.27627695 27.83867333]
E1 = -3.8462724290100065  E_coul = 1.0304725578376133
cycle= 1 E= -2.81579987117239  delta_E= -0.00985  |g|= 0.00805  |ddm|=  2.2
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.892665540810657  LUMO = 2.19056924942358
  mo_energy =
[-0.89266554  2.19056925 11.28290215 27.8430553 ]
E1 = -3.845505602660419  E_coul = 1.0297017631313956
cycle= 2 E= -2.81580383952902  delta_E= -3.97e-06  |g|= 0.000377  |ddm|= 0.667
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.8930735590344  LUMO = 2.19021909639139
  mo_energy =
[-0.89307356  2.1902191  11.28195616 27.84159811]
E1 = -3.8454575912832962  E_coul = 1.0296537400271064
cycle= 3 E= -2.81580385125619  delta_E= -1.17e-08  |g|= 6.95e-06  |ddm|= 0.0299
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.893075186629273  LUMO = 2.19021756197774
  mo_energy =
[-0.89307519  2.19021756 11.28195198 27.84159339]
E1 = -3.845457206490588  E_coul = 1.0296533552340148
cycle= 4 E= -2.81580385125657  delta_E= -3.83e-13  |g|= 1.37e-07  |ddm|= 0.000409
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.845457206490588  E_coul = 1.0296533552340148
  HOMO = -0.893075248011291  LUMO = 2.19021749963144
  mo_energy =
[-0.89307525  2.1902175  11.28195184 27.84159321]
E1 = -3.8454571974265144  E_coul = 1.0296533461713286
Extra cycle  E= -2.81580385125519  delta_E= 1.39e-12  |g|= 8.98e-09  |ddm|= 5.06e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [5.49460393 4.28264518 3.95361329 0.43228139]
E = -2.8158038512551857
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:05 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  5.49460393135        1
[INPUT] 0    0    [1    /1   ]  4.28264517922        1
[INPUT] 0    0    [1    /1   ]  3.95361329497        1
[INPUT] 0    0    [1    /1   ]  0.432281388357       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [5.4946039313466075, 1.0]], [0, [4.28264517922091, 1.0]], [0, [3.953613294970735, 1.0]], [0, [0.43228138835656454, 1.0]]]}
ecp = {}
CPU time:        34.52
Set gradient conv threshold to 3.16228e-05
cond(S) = 155956.6320740524
E1 = -3.830153472654453  E_coul = 1.024200607303827
init E= -2.80595286535063
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.89578849428624  LUMO = 2.18369192220252
  mo_energy =
[-0.89578849  2.18369192 11.27627695 27.83867333]
E1 = -3.8462724290100065  E_coul = 1.0304725578376133
cycle= 1 E= -2.81579987117239  delta_E= -0.00985  |g|= 0.00805  |ddm|=  2.2
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.892665540810657  LUMO = 2.19056924942358
  mo_energy =
[-0.89266554  2.19056925 11.28290215 27.8430553 ]
E1 = -3.845505602660419  E_coul = 1.0297017631313956
cycle= 2 E= -2.81580383952902  delta_E= -3.97e-06  |g|= 0.000377  |ddm|= 0.667
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.8930735590344  LUMO = 2.19021909639139
  mo_energy =
[-0.89307356  2.1902191  11.28195616 27.84159811]
E1 = -3.8454575912832962  E_coul = 1.0296537400271064
cycle= 3 E= -2.81580385125619  delta_E= -1.17e-08  |g|= 6.95e-06  |ddm|= 0.0299
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.893075186629273  LUMO = 2.19021756197774
  mo_energy =
[-0.89307519  2.19021756 11.28195198 27.84159339]
E1 = -3.845457206490588  E_coul = 1.0296533552340148
cycle= 4 E= -2.81580385125657  delta_E= -3.83e-13  |g|= 1.37e-07  |ddm|= 0.000409
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.845457206490588  E_coul = 1.0296533552340148
  HOMO = -0.893075248011291  LUMO = 2.19021749963144
  mo_energy =
[-0.89307525  2.1902175  11.28195184 27.84159321]
E1 = -3.8454571974265144  E_coul = 1.0296533461713286
Extra cycle  E= -2.81580385125519  delta_E= 1.39e-12  |g|= 8.98e-09  |ddm|= 5.06e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 155956.6320740524
E1 = -3.8454571974265144  E_coul = 1.0296533461713286
init E= -2.81580385125519
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.893075252541925  LUMO = 2.19021749500911
  mo_energy =
[-0.89307525  2.1902175  11.28195183 27.8415932 ]
E1 = -3.8454571966632063  E_coul = 1.0296533454002132
cycle= 1 E= -2.81580385126299  delta_E= -7.81e-12  |g|= 6.36e-10  |ddm|= 3.32e-06
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8454571966632063  E_coul = 1.0296533454002132
  HOMO = -0.89307525293141  LUMO = 2.19021749449661
  mo_energy =
[-0.89307525  2.19021749 11.28195183 27.84159319]
E1 = -3.8454571966091686  E_coul = 1.029653345355448
Extra cycle  E= -2.81580385125372  delta_E= 9.27e-12  |g|= 3.5e-10  |ddm|= 1.56e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [5.49460393 4.28264518 3.95361329 0.43228139]
grad_E = [-9.95871045e-04  3.31507770e-04  9.21115160e-04 -5.78845950e-05]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:07 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  5.54279390126        1
[INPUT] 0    0    [1    /1   ]  4.31068118621        1
[INPUT] 0    0    [1    /1   ]  3.97833323043        1
[INPUT] 0    0    [1    /1   ]  0.433824276678       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [5.542793901261922, 1.0]], [0, [4.310681186214701, 1.0]], [0, [3.9783332304325825, 1.0]], [0, [0.43382427667821816, 1.0]]]}
ecp = {}
CPU time:        36.48
Set gradient conv threshold to 3.16228e-05
cond(S) = 152021.3861940813
E1 = -3.8300658216104955  E_coul = 1.0242287812270092
init E= -2.80583704038349
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.895781506696798  LUMO = 2.19879578495706
  mo_energy =
[-0.89578151  2.19879578 11.35506979 28.04551699]
E1 = -3.8465661014560846  E_coul = 1.0307536810618767
cycle= 1 E= -2.81581242039421  delta_E= -0.00998  |g|= 0.00802  |ddm|= 2.24
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.892531251582187  LUMO = 2.20584852381918
  mo_energy =
[-0.89253125  2.20584852 11.36196183 28.05024662]
E1 = -3.8457952848320245  E_coul = 1.0299789004869875
cycle= 2 E= -2.81581638434504  delta_E= -3.96e-06  |g|= 0.000374  |ddm|= 0.676
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.892941376885277  LUMO = 2.20549380609719
  mo_energy =
[-0.89294138  2.20549381 11.36100584 28.04877789]
E1 = -3.8457468471475704  E_coul = 1.029930451039024
cycle= 3 E= -2.81581639610855  delta_E= -1.18e-08  |g|= 7.1e-06  |ddm|= 0.0314
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.892943110954612  LUMO = 2.20549215734885
  mo_energy =
[-0.89294311  2.20549216 11.36100139 28.04877283]
E1 = -3.845746445513716  E_coul = 1.0299300494070092
cycle= 4 E= -2.81581639610671  delta_E= 1.84e-12  |g|= 1.39e-07  |ddm|= 0.000456
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.845746445513716  E_coul = 1.0299300494070092
  HOMO = -0.89294317334985  LUMO = 2.20549209368153
  mo_energy =
[-0.89294317  2.20549209 11.36100125 28.04877264]
E1 = -3.845746436327575  E_coul = 1.0299300402148919
Extra cycle  E= -2.81581639611268  delta_E= -5.98e-12  |g|= 8.91e-09  |ddm|= 4.97e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [5.5427939  4.31068119 3.97833323 0.43382428]
E = -2.815816396112683
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:07 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  5.54279390126        1
[INPUT] 0    0    [1    /1   ]  4.31068118621        1
[INPUT] 0    0    [1    /1   ]  3.97833323043        1
[INPUT] 0    0    [1    /1   ]  0.433824276678       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [5.542793901261922, 1.0]], [0, [4.310681186214701, 1.0]], [0, [3.9783332304325825, 1.0]], [0, [0.43382427667821816, 1.0]]]}
ecp = {}
CPU time:        36.81
Set gradient conv threshold to 3.16228e-05
cond(S) = 152021.3861940813
E1 = -3.8300658216104955  E_coul = 1.0242287812270092
init E= -2.80583704038349
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.895781506696798  LUMO = 2.19879578495706
  mo_energy =
[-0.89578151  2.19879578 11.35506979 28.04551699]
E1 = -3.8465661014560846  E_coul = 1.0307536810618767
cycle= 1 E= -2.81581242039421  delta_E= -0.00998  |g|= 0.00802  |ddm|= 2.24
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.892531251582187  LUMO = 2.20584852381918
  mo_energy =
[-0.89253125  2.20584852 11.36196183 28.05024662]
E1 = -3.8457952848320245  E_coul = 1.0299789004869875
cycle= 2 E= -2.81581638434504  delta_E= -3.96e-06  |g|= 0.000374  |ddm|= 0.676
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.892941376885277  LUMO = 2.20549380609719
  mo_energy =
[-0.89294138  2.20549381 11.36100584 28.04877789]
E1 = -3.8457468471475704  E_coul = 1.029930451039024
cycle= 3 E= -2.81581639610855  delta_E= -1.18e-08  |g|= 7.1e-06  |ddm|= 0.0314
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.892943110954612  LUMO = 2.20549215734885
  mo_energy =
[-0.89294311  2.20549216 11.36100139 28.04877283]
E1 = -3.845746445513716  E_coul = 1.0299300494070092
cycle= 4 E= -2.81581639610671  delta_E= 1.84e-12  |g|= 1.39e-07  |ddm|= 0.000456
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.845746445513716  E_coul = 1.0299300494070092
  HOMO = -0.89294317334985  LUMO = 2.20549209368153
  mo_energy =
[-0.89294317  2.20549209 11.36100125 28.04877264]
E1 = -3.845746436327575  E_coul = 1.0299300402148919
Extra cycle  E= -2.81581639611268  delta_E= -5.98e-12  |g|= 8.91e-09  |ddm|= 4.97e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 152021.3861940813
E1 = -3.845746436327575  E_coul = 1.0299300402148919
init E= -2.81581639611268
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.892943177948877  LUMO = 2.2054920888561
  mo_energy =
[-0.89294318  2.20549209 11.36100124 28.04877263]
E1 = -3.845746435568549  E_coul = 1.029930039454653
cycle= 1 E= -2.8158163961139  delta_E= -1.21e-12  |g|= 6.88e-10  |ddm|= 3.17e-06
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.845746435568549  E_coul = 1.029930039454653
  HOMO = -0.892943178329605  LUMO = 2.20549208845698
  mo_energy =
[-0.89294318  2.20549209 11.36100124 28.04877263]
E1 = -3.845746435505015  E_coul = 1.0299300393963933
Extra cycle  E= -2.81581639610862  delta_E= 5.27e-12  |g|= 2.22e-10  |ddm|= 2.19e-07
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [5.5427939  4.31068119 3.97833323 0.43382428]
grad_E = [-0.00093685  0.00040746  0.00100584 -0.00015505]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:09 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  5.61937720262        1
[INPUT] 0    0    [1    /1   ]  4.34576476081        1
[INPUT] 0    0    [1    /1   ]  4.00317160102        1
[INPUT] 0    0    [1    /1   ]  0.435791234919       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [5.619377202616834, 1.0]], [0, [4.345764760813992, 1.0]], [0, [4.00317160101547, 1.0]], [0, [0.4357912349187147, 1.0]]]}
ecp = {}
CPU time:        38.83
Set gradient conv threshold to 3.16228e-05
cond(S) = 138679.8446726529
E1 = -3.8299637502980843  E_coul = 1.0242650314931925
init E= -2.80569871880489
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.895777991437087  LUMO = 2.21809439872698
  mo_energy =
[-0.89577799  2.2180944  11.4560009  28.31889961]
E1 = -3.846957375213144  E_coul = 1.03111791234275
cycle= 1 E= -2.81583946287039  delta_E= -0.0101  |g|= 0.00797  |ddm|= 2.14
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.892362654092259  LUMO = 2.22537549079406
  mo_energy =
[-0.89236265  2.22537549 11.46324133 28.32408218]
E1 = -3.8461816375924007  E_coul = 1.0303382168472126
cycle= 2 E= -2.81584342074519  delta_E= -3.96e-06  |g|= 0.00037  |ddm|= 0.645
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.892775369494602  LUMO = 2.22501500637953
  mo_energy =
[-0.89277537  2.22501501 11.46227261 28.32259858]
E1 = -3.846132675369204  E_coul = 1.0302892428020047
cycle= 3 E= -2.8158434325672  delta_E= -1.18e-08  |g|= 7.28e-06  |ddm|= 0.0311
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.892777242857411  LUMO = 2.22501320760016
  mo_energy =
[-0.89277724  2.22501321 11.46226781 28.32259306]
E1 = -3.8461322523520978  E_coul = 1.0302888197820212
cycle= 4 E= -2.81584343257008  delta_E= -2.88e-12  |g|= 1.41e-07  |ddm|= 0.000481
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8461322523520978  E_coul = 1.0302888197820212
  HOMO = -0.892777306394029  LUMO = 2.22501314229226
  mo_energy =
[-0.89277731  2.22501314 11.46226766 28.32259287]
E1 = -3.8461322430420117  E_coul = 1.030288810476359
Extra cycle  E= -2.81584343256565  delta_E= 4.42e-12  |g|= 9.25e-09  |ddm|= 4.57e-05
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [5.6193772  4.34576476 4.0031716  0.43579123]
E = -2.8158434325656527
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:10 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  5.61937720262        1
[INPUT] 0    0    [1    /1   ]  4.34576476081        1
[INPUT] 0    0    [1    /1   ]  4.00317160102        1
[INPUT] 0    0    [1    /1   ]  0.435791234919       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [5.619377202616834, 1.0]], [0, [4.345764760813992, 1.0]], [0, [4.00317160101547, 1.0]], [0, [0.4357912349187147, 1.0]]]}
ecp = {}
CPU time:        39.14
Set gradient conv threshold to 3.16228e-05
cond(S) = 138679.8446726529
E1 = -3.8299637502980843  E_coul = 1.0242650314931925
init E= -2.80569871880489
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.895777991437087  LUMO = 2.21809439872698
  mo_energy =
[-0.89577799  2.2180944  11.4560009  28.31889961]
E1 = -3.846957375213144  E_coul = 1.03111791234275
cycle= 1 E= -2.81583946287039  delta_E= -0.0101  |g|= 0.00797  |ddm|= 2.14
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.892362654092259  LUMO = 2.22537549079406
  mo_energy =
[-0.89236265  2.22537549 11.46324133 28.32408218]
E1 = -3.8461816375924007  E_coul = 1.0303382168472126
cycle= 2 E= -2.81584342074519  delta_E= -3.96e-06  |g|= 0.00037  |ddm|= 0.645
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.892775369494602  LUMO = 2.22501500637953
  mo_energy =
[-0.89277537  2.22501501 11.46227261 28.32259858]
E1 = -3.846132675369204  E_coul = 1.0302892428020047
cycle= 3 E= -2.8158434325672  delta_E= -1.18e-08  |g|= 7.28e-06  |ddm|= 0.0311
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.892777242857411  LUMO = 2.22501320760016
  mo_energy =
[-0.89277724  2.22501321 11.46226781 28.32259306]
E1 = -3.8461322523520978  E_coul = 1.0302888197820212
cycle= 4 E= -2.81584343257008  delta_E= -2.88e-12  |g|= 1.41e-07  |ddm|= 0.000481
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8461322523520978  E_coul = 1.0302888197820212
  HOMO = -0.892777306394029  LUMO = 2.22501314229226
  mo_energy =
[-0.89277731  2.22501314 11.46226766 28.32259287]
E1 = -3.8461322430420117  E_coul = 1.030288810476359
Extra cycle  E= -2.81584343256565  delta_E= 4.42e-12  |g|= 9.25e-09  |ddm|= 4.57e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 138679.8446726529
E1 = -3.8461322430420117  E_coul = 1.030288810476359
init E= -2.81584343256565
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.892777311044643  LUMO = 2.22501313754233
  mo_energy =
[-0.89277731  2.22501314 11.46226765 28.32259286]
E1 = -3.8461322422616075  E_coul = 1.030288809693886
cycle= 1 E= -2.81584343256772  delta_E= -2.07e-12  |g|= 6.96e-10  |ddm|= 3e-06
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8461322422616075  E_coul = 1.030288809693886
  HOMO = -0.892777311436932  LUMO = 2.22501313711755
  mo_energy =
[-0.89277731  2.22501314 11.46226765 28.32259286]
E1 = -3.846132242197981  E_coul = 1.0302888096298426
Extra cycle  E= -2.81584343256814  delta_E= -4.17e-13  |g|= 5.28e-11  |ddm|= 1.98e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [5.6193772  4.34576476 4.0031716  0.43579123]
grad_E = [-0.00087061  0.00050756  0.0011301  -0.00028418]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:12 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  5.80478033724        1
[INPUT] 0    0    [1    /1   ]  4.40850466204        1
[INPUT] 0    0    [1    /1   ]  4.02942725794        1
[INPUT] 0    0    [1    /1   ]  0.439416791869       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [5.804780337240171, 1.0]], [0, [4.408504662036834, 1.0]], [0, [4.029427257935432, 1.0]], [0, [0.439416791868529, 1.0]]]}
ecp = {}
CPU time:        41.18
Set gradient conv threshold to 3.16228e-05
cond(S) = 100570.21169730174
E1 = -3.8298050212018353  E_coul = 1.024333745673285
init E= -2.80547127552855
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.895787097791864  LUMO = 2.25359442794546
  mo_energy =
[-0.8957871   2.25359443 11.64207427 28.84952069]
E1 = -3.84773779228512  E_coul = 1.0318156460551904
cycle= 1 E= -2.81592214622993  delta_E= -0.0105  |g|= 0.00789  |ddm|=  1.6
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.89205512242226  LUMO = 2.26131505026098
  mo_energy =
[-0.89205512  2.26131505 11.64999153 28.85558021]
E1 = -3.84695411651533  E_coul = 1.0310280252480897
cycle= 2 E= -2.81592609126724  delta_E= -3.95e-06  |g|= 0.000364  |ddm|= 0.501
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.892471985248386  LUMO = 2.26094452215817
  mo_energy =
[-0.89247199  2.26094452 11.6490003  28.8540698 ]
E1 = -3.846904300899928  E_coul = 1.0309781977076597
cycle= 3 E= -2.81592610319227  delta_E= -1.19e-08  |g|= 7.57e-06  |ddm|= 0.0255
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.892474118013705  LUMO = 2.26094244274981
  mo_energy =
[-0.89247412  2.26094244 11.64899483 28.85406341]
E1 = -3.8469038401035647  E_coul = 1.0309777369049982
cycle= 4 E= -2.81592610319857  delta_E= -6.3e-12  |g|= 1.44e-07  |ddm|= 0.000432
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8469038401035647  E_coul = 1.0309777369049982
  HOMO = -0.892474183146779  LUMO = 2.26094237497068
  mo_energy =
[-0.89247418  2.26094237 11.64899468 28.85406321]
E1 = -3.8469038306264194  E_coul = 1.0309777274281466
Extra cycle  E= -2.81592610319827  delta_E= 2.94e-13  |g|= 9.28e-09  |ddm|= 3.33e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [5.80478034 4.40850466 4.02942726 0.43941679]
E = -2.8159261031982727
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:12 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  5.80478033724        1
[INPUT] 0    0    [1    /1   ]  4.40850466204        1
[INPUT] 0    0    [1    /1   ]  4.02942725794        1
[INPUT] 0    0    [1    /1   ]  0.439416791869       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [5.804780337240171, 1.0]], [0, [4.408504662036834, 1.0]], [0, [4.029427257935432, 1.0]], [0, [0.439416791868529, 1.0]]]}
ecp = {}
CPU time:        41.53
Set gradient conv threshold to 3.16228e-05
cond(S) = 100570.21169730174
E1 = -3.8298050212018353  E_coul = 1.024333745673285
init E= -2.80547127552855
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.895787097791864  LUMO = 2.25359442794546
  mo_energy =
[-0.8957871   2.25359443 11.64207427 28.84952069]
E1 = -3.84773779228512  E_coul = 1.0318156460551904
cycle= 1 E= -2.81592214622993  delta_E= -0.0105  |g|= 0.00789  |ddm|=  1.6
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.89205512242226  LUMO = 2.26131505026098
  mo_energy =
[-0.89205512  2.26131505 11.64999153 28.85558021]
E1 = -3.84695411651533  E_coul = 1.0310280252480897
cycle= 2 E= -2.81592609126724  delta_E= -3.95e-06  |g|= 0.000364  |ddm|= 0.501
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.892471985248386  LUMO = 2.26094452215817
  mo_energy =
[-0.89247199  2.26094452 11.6490003  28.8540698 ]
E1 = -3.846904300899928  E_coul = 1.0309781977076597
cycle= 3 E= -2.81592610319227  delta_E= -1.19e-08  |g|= 7.57e-06  |ddm|= 0.0255
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.892474118013705  LUMO = 2.26094244274981
  mo_energy =
[-0.89247412  2.26094244 11.64899483 28.85406341]
E1 = -3.8469038401035647  E_coul = 1.0309777369049982
cycle= 4 E= -2.81592610319857  delta_E= -6.3e-12  |g|= 1.44e-07  |ddm|= 0.000432
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8469038401035647  E_coul = 1.0309777369049982
  HOMO = -0.892474183146779  LUMO = 2.26094237497068
  mo_energy =
[-0.89247418  2.26094237 11.64899468 28.85406321]
E1 = -3.8469038306264194  E_coul = 1.0309777274281466
Extra cycle  E= -2.81592610319827  delta_E= 2.94e-13  |g|= 9.28e-09  |ddm|= 3.33e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 100570.21169730174
E1 = -3.8469038306264194  E_coul = 1.0309777274281466
init E= -2.81592610319827
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.892474187885063  LUMO = 2.260942370007
  mo_energy =
[-0.89247419  2.26094237 11.64899467 28.8540632 ]
E1 = -3.8469038298461875  E_coul = 1.0309777266487394
cycle= 1 E= -2.81592610319745  delta_E= 8.25e-13  |g|= 7.33e-10  |ddm|= 2.15e-06
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8469038298461875  E_coul = 1.0309777266487394
  HOMO = -0.89247418827435  LUMO = 2.26094236962094
  mo_energy =
[-0.89247419  2.26094237 11.64899466 28.8540632 ]
E1 = -3.8469038297791087  E_coul = 1.0309777265830464
Extra cycle  E= -2.81592610319606  delta_E= 1.39e-12  |g|= 9.07e-11  |ddm|= 1.6e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [5.80478034 4.40850466 4.02942726 0.43941679]
grad_E = [-0.00077555  0.00069691  0.00140354 -0.00043606]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:14 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.28293848668        1
[INPUT] 0    0    [1    /1   ]  4.52292427587        1
[INPUT] 0    0    [1    /1   ]  4.02473556146        1
[INPUT] 0    0    [1    /1   ]  0.446268530158       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [6.282938486682154, 1.0]], [0, [4.522924275869605, 1.0]], [0, [4.024735561464549, 1.0]], [0, [0.4462685301578178, 1.0]]]}
ecp = {}
CPU time:        43.65
Set gradient conv threshold to 3.16228e-05
cond(S) = 41511.836421319924
E1 = -3.8295958179999476  E_coul = 1.0244763771505847
init E= -2.80511944084936
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.895847856654392  LUMO = 2.31913188125799
  mo_energy =
[-0.89584786  2.31913188 11.98434747 29.9228534 ]
E1 = -3.8494615785545845  E_coul = 1.0332842170675842
cycle= 1 E= -2.816177361487  delta_E= -0.0111  |g|= 0.00775  |ddm|= 0.495
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.891448427534544  LUMO = 2.32777915667934
  mo_energy =
[-0.89144843  2.32777916 11.99373242 29.93080375]
E1 = -3.8486707612468702  E_coul = 1.0324894890066443
cycle= 2 E= -2.81618127224023  delta_E= -3.91e-06  |g|= 0.000355  |ddm|= 0.219
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.891868870056153  LUMO = 2.32739442664109
  mo_energy =
[-0.89186887  2.32739443 11.99270788 29.92925194]
E1 = -3.848620067982606  E_coul = 1.032438783677206
cycle= 3 E= -2.8161812843054  delta_E= -1.21e-08  |g|= 7.86e-06  |ddm|= 0.012
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.891871442730074  LUMO = 2.32739186346504
  mo_energy =
[-0.89187144  2.32739186 11.99270124 29.92924398]
E1 = -3.8486195510256453  E_coul = 1.0324382667178058
cycle= 4 E= -2.81618128430784  delta_E= -2.44e-12  |g|= 1.46e-07  |ddm|= 0.000229
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8486195510256453  E_coul = 1.0324382667178058
  HOMO = -0.891871508795014  LUMO = 2.3273917933538
  mo_energy =
[-0.89187151  2.32739179 11.99270109 29.92924377]
E1 = -3.8486195414952213  E_coul = 1.03243825718672
Extra cycle  E= -2.8161812843085  delta_E= -6.62e-13  |g|= 9.28e-09  |ddm|= 1.36e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [6.28293849 4.52292428 4.02473556 0.44626853]
E = -2.8161812843085015
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:15 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.28293848668        1
[INPUT] 0    0    [1    /1   ]  4.52292427587        1
[INPUT] 0    0    [1    /1   ]  4.02473556146        1
[INPUT] 0    0    [1    /1   ]  0.446268530158       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [6.282938486682154, 1.0]], [0, [4.522924275869605, 1.0]], [0, [4.024735561464549, 1.0]], [0, [0.4462685301578178, 1.0]]]}
ecp = {}
CPU time:        44.03
Set gradient conv threshold to 3.16228e-05
cond(S) = 41511.836421319924
E1 = -3.8295958179999476  E_coul = 1.0244763771505847
init E= -2.80511944084936
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.895847856654392  LUMO = 2.31913188125799
  mo_energy =
[-0.89584786  2.31913188 11.98434747 29.9228534 ]
E1 = -3.8494615785545845  E_coul = 1.0332842170675842
cycle= 1 E= -2.816177361487  delta_E= -0.0111  |g|= 0.00775  |ddm|= 0.495
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.891448427534544  LUMO = 2.32777915667934
  mo_energy =
[-0.89144843  2.32777916 11.99373242 29.93080375]
E1 = -3.8486707612468702  E_coul = 1.0324894890066443
cycle= 2 E= -2.81618127224023  delta_E= -3.91e-06  |g|= 0.000355  |ddm|= 0.219
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.891868870056153  LUMO = 2.32739442664109
  mo_energy =
[-0.89186887  2.32739443 11.99270788 29.92925194]
E1 = -3.848620067982606  E_coul = 1.032438783677206
cycle= 3 E= -2.8161812843054  delta_E= -1.21e-08  |g|= 7.86e-06  |ddm|= 0.012
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.891871442730074  LUMO = 2.32739186346504
  mo_energy =
[-0.89187144  2.32739186 11.99270124 29.92924398]
E1 = -3.8486195510256453  E_coul = 1.0324382667178058
cycle= 4 E= -2.81618128430784  delta_E= -2.44e-12  |g|= 1.46e-07  |ddm|= 0.000229
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8486195510256453  E_coul = 1.0324382667178058
  HOMO = -0.891871508795014  LUMO = 2.3273917933538
  mo_energy =
[-0.89187151  2.32739179 11.99270109 29.92924377]
E1 = -3.8486195414952213  E_coul = 1.03243825718672
Extra cycle  E= -2.8161812843085  delta_E= -6.62e-13  |g|= 9.28e-09  |ddm|= 1.36e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 41511.836421319924
E1 = -3.8486195414952213  E_coul = 1.03243825718672
init E= -2.8161812843085
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.891871513560898  LUMO = 2.3273917882498
  mo_energy =
[-0.89187151  2.32739179 11.99270108 29.92924376]
E1 = -3.848619540724089  E_coul = 1.0324382564161882
cycle= 1 E= -2.8161812843079  delta_E= 6.01e-13  |g|= 7.18e-10  |ddm|= 8.64e-07
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.848619540724089  E_coul = 1.0324382564161882
  HOMO = -0.891871513945858  LUMO = 2.327391787856
  mo_energy =
[-0.89187151  2.32739179 11.99270108 29.92924375]
E1 = -3.84861954065927  E_coul = 1.0324382563512369
Extra cycle  E= -2.81618128430803  delta_E= -1.33e-13  |g|= 5.51e-11  |ddm|= 6.31e-08
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [6.28293849 4.52292428 4.02473556 0.44626853]
grad_E = [-0.00067426  0.00103386  0.00202556  0.00026308]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:17 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  8.21952631523        1
[INPUT] 0    0    [1    /1   ]  4.87519545642        1
[INPUT] 0    0    [1    /1   ]  3.83549218163        1
[INPUT] 0    0    [1    /1   ]  0.467257616052       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [8.219526315234802, 1.0]], [0, [4.875195456420796, 1.0]], [0, [3.8354921816327003, 1.0]], [0, [0.4672576160523926, 1.0]]]}
ecp = {}
CPU time:        46.19
Set gradient conv threshold to 3.16228e-05
cond(S) = 3874.082425872741
E1 = -3.8292932832478632  E_coul = 1.0250825934631531
init E= -2.80421068978471
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.896165133811791  LUMO = 2.49109279876655
  mo_energy =
[-0.89616513  2.4910928  12.84031158 33.34301335]
E1 = -3.857007165344419  E_coul = 1.0396243630620254
cycle= 1 E= -2.81738280228239  delta_E= -0.0132  |g|= 0.00781  |ddm|= 0.314
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.888880973327929  LUMO = 2.5037138530209
  mo_energy =
[-0.88888097  2.50371385 12.85650584 33.35969718]
E1 = -3.8562962208353757  E_coul = 1.0389097224446138
cycle= 2 E= -2.81738649839076  delta_E= -3.7e-06  |g|= 0.000379  |ddm|= 0.00833
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.889258301449832  LUMO = 2.50335437736971
  mo_energy =
[-0.8892583   2.50335438 12.85552253 33.35818018]
E1 = -3.856251634539831  E_coul = 1.0388651250249041
cycle= 3 E= -2.81738650951493  delta_E= -1.11e-08  |g|= 5.84e-06  |ddm|= 0.000478
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.889260865403882  LUMO = 2.50335174764533
  mo_energy =
[-0.88926087  2.50335175 12.85551567 33.35817138]
E1 = -3.856251184937492  E_coul = 1.0388646754210358
cycle= 4 E= -2.81738650951646  delta_E= -1.53e-12  |g|= 1.15e-07  |ddm|= 1.88e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.856251184937492  E_coul = 1.0388646754210358
  HOMO = -0.889260917047712  LUMO = 2.50335169025375
  mo_energy =
[-0.88926092  2.50335169 12.85551554 33.35817122]
E1 = -3.856251177589484  E_coul = 1.0388646680730262
Extra cycle  E= -2.81738650951646  delta_E= -1.33e-15  |g|= 7.24e-09  |ddm|= 9.5e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [8.21952632 4.87519546 3.83549218 0.46725762]
E = -2.8173865095164574
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:17 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  8.21952631523        1
[INPUT] 0    0    [1    /1   ]  4.87519545642        1
[INPUT] 0    0    [1    /1   ]  3.83549218163        1
[INPUT] 0    0    [1    /1   ]  0.467257616052       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [8.219526315234802, 1.0]], [0, [4.875195456420796, 1.0]], [0, [3.8354921816327003, 1.0]], [0, [0.4672576160523926, 1.0]]]}
ecp = {}
CPU time:        46.59
Set gradient conv threshold to 3.16228e-05
cond(S) = 3874.082425872741
E1 = -3.8292932832478632  E_coul = 1.0250825934631531
init E= -2.80421068978471
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.896165133811791  LUMO = 2.49109279876655
  mo_energy =
[-0.89616513  2.4910928  12.84031158 33.34301335]
E1 = -3.857007165344419  E_coul = 1.0396243630620254
cycle= 1 E= -2.81738280228239  delta_E= -0.0132  |g|= 0.00781  |ddm|= 0.314
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.888880973327929  LUMO = 2.5037138530209
  mo_energy =
[-0.88888097  2.50371385 12.85650584 33.35969718]
E1 = -3.8562962208353757  E_coul = 1.0389097224446138
cycle= 2 E= -2.81738649839076  delta_E= -3.7e-06  |g|= 0.000379  |ddm|= 0.00833
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.889258301449832  LUMO = 2.50335437736971
  mo_energy =
[-0.8892583   2.50335438 12.85552253 33.35818018]
E1 = -3.856251634539831  E_coul = 1.0388651250249041
cycle= 3 E= -2.81738650951493  delta_E= -1.11e-08  |g|= 5.84e-06  |ddm|= 0.000478
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.889260865403882  LUMO = 2.50335174764533
  mo_energy =
[-0.88926087  2.50335175 12.85551567 33.35817138]
E1 = -3.856251184937492  E_coul = 1.0388646754210358
cycle= 4 E= -2.81738650951646  delta_E= -1.53e-12  |g|= 1.15e-07  |ddm|= 1.88e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.856251184937492  E_coul = 1.0388646754210358
  HOMO = -0.889260917047712  LUMO = 2.50335169025375
  mo_energy =
[-0.88926092  2.50335169 12.85551554 33.35817122]
E1 = -3.856251177589484  E_coul = 1.0388646680730262
Extra cycle  E= -2.81738650951646  delta_E= -1.33e-15  |g|= 7.24e-09  |ddm|= 9.5e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 3874.082425872741
E1 = -3.856251177589484  E_coul = 1.0388646680730262
init E= -2.81738650951646
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.88926092072172  LUMO = 2.50335168615047
  mo_energy =
[-0.88926092  2.50335169 12.85551553 33.3581712 ]
E1 = -3.856251177007971  E_coul = 1.038864667491517
cycle= 1 E= -2.81738650951645  delta_E= 3.55e-15  |g|= 5.34e-10  |ddm|= 6e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.856251177007971  E_coul = 1.038864667491517
  HOMO = -0.889260921012466  LUMO = 2.50335168583208
  mo_energy =
[-0.88926092  2.50335169 12.85551553 33.3581712 ]
E1 = -3.8562511769612504  E_coul = 1.0388646674447959
Extra cycle  E= -2.81738650951645  delta_E= -8.88e-16  |g|= 4.06e-11  |ddm|= 4.18e-09
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [8.21952632 4.87519546 3.83549218 0.46725762]
grad_E = [-0.00063668  0.0014708   0.00389238  0.01796406]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:19 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  29.4543352116        1
[INPUT] 0    0    [1    /1   ]  8.39517539535        1
[INPUT] 0    0    [1    /1   ]  1.22980875303        1
[INPUT] 0    0    [1    /1   ]  0.655761447228       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [29.454335211597687, 1.0]], [0, [8.39517539534714, 1.0]], [0, [1.2298087530329043, 1.0]], [0, [0.6557614472278049, 1.0]]]}
ecp = {}
CPU time:        48.76
Set gradient conv threshold to 3.16228e-05
cond(S) = 58.63752017158309
E1 = -3.5171299000737366  E_coul = 0.9989003526814492
init E= -2.51822954739229
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.861934324081249  LUMO = 1.99841549421316
  mo_energy =
[-0.86193432  1.99841549 12.03047529 60.89296393]
E1 = -3.8360274273778576  E_coul = 1.1063121638424878
cycle= 1 E= -2.72971526353537  delta_E= -0.211  |g|= 0.116  |ddm|= 1.09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.811998397961539  LUMO = 2.06540227077735
  mo_energy =
[-0.8119984   2.06540227 12.1665303  61.0490673 ]
E1 = -3.842132921890969  E_coul = 1.1117665142357285
cycle= 2 E= -2.73036640765524  delta_E= -0.000651  |g|= 0.0088  |ddm|= 0.0748
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.809099399564741  LUMO = 2.06769059753444
  mo_energy =
[-0.8090994   2.0676906  12.17441883 61.05783005]
E1 = -3.8430602069719897  E_coul = 1.1126866879643427
cycle= 3 E= -2.73037351900765  delta_E= -7.11e-06  |g|= 0.000364  |ddm|= 0.00934
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.808829304497544  LUMO = 2.06786955242844
  mo_energy =
[-0.8088293   2.06786955 12.17518556 61.05902422]
E1 = -3.8431219681374276  E_coul = 1.112748429130105
cycle= 4 E= -2.73037353900732  delta_E= -2e-08  |g|= 2.65e-05  |ddm|= 0.000498
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.808810262254175  LUMO = 2.06788297949059
  mo_energy =
[-0.80881026  2.06788298 12.17524004 61.05910708]
E1 = -3.8431265613895413  E_coul = 1.1127530222785504
cycle= 5 E= -2.73037353911099  delta_E= -1.04e-10  |g|= 2.46e-09  |ddm|= 3.89e-05
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.8431265613895413  E_coul = 1.1127530222785504
  HOMO = -0.808810258416219  LUMO = 2.06788297235157
  mo_energy =
[-0.80881026  2.06788297 12.17524003 61.05910706]
E1 = -3.8431265618396413  E_coul = 1.1127530227286497
Extra cycle  E= -2.73037353911099  delta_E= -8.88e-16  |g|= 2.4e-10  |ddm|= 2.85e-09
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [29.45433521  8.3951754   1.22980875  0.65576145]
E = -2.7303735391109916
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:20 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  10.3430072049        1
[INPUT] 0    0    [1    /1   ]  5.22719345031        1
[INPUT] 0    0    [1    /1   ]  3.57492383877        1
[INPUT] 0    0    [1    /1   ]  0.48610799917        1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [10.34300720487109, 1.0]], [0, [5.227193450313431, 1.0]], [0, [3.5749238387727207, 1.0]], [0, [0.4861079991699338, 1.0]]]}
ecp = {}
CPU time:        49.17
Set gradient conv threshold to 3.16228e-05
cond(S) = 923.6443764921921
E1 = -3.8288053686629704  E_coul = 1.025784494955307
init E= -2.80302087370766
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.896559914941891  LUMO = 2.60127149713231
  mo_energy =
[-0.89655991  2.6012715  13.34546213 36.51038777]
E1 = -3.8665814789477526  E_coul = 1.0477372803326153
cycle= 1 E= -2.81884419861514  delta_E= -0.0158  |g|= 0.00964  |ddm|= 0.252
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.885555423092219  LUMO = 2.61899752234784
  mo_energy =
[-0.88555542  2.61899752 13.37101714 36.53921921]
E1 = -3.866074330396216  E_coul = 1.047225994596229
cycle= 2 E= -2.81884833579999  delta_E= -4.14e-06  |g|= 0.000516  |ddm|= 0.00633
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.885825330234071  LUMO = 2.61875281770127
  mo_energy =
[-0.88582533  2.61875282 13.37026947 36.53796603]
E1 = -3.866046123253757  E_coul = 1.047197775637022
cycle= 3 E= -2.81884834761673  delta_E= -1.18e-08  |g|= 1.46e-06  |ddm|= 0.000395
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.885825292352817  LUMO = 2.61875291829661
  mo_energy =
[-0.88582529  2.61875292 13.37026943 36.53796594]
E1 = -3.8660461188937134  E_coul = 1.0471977712769394
cycle= 4 E= -2.81884834761677  delta_E= -3.95e-14  |g|= 1.05e-08  |ddm|= 1.82e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8660461188937134  E_coul = 1.0471977712769394
  HOMO = -0.88582528816991  LUMO = 2.61875292369343
  mo_energy =
[-0.88582529  2.61875292 13.37026945 36.53796595]
E1 = -3.866046119664913  E_coul = 1.0471977720481374
Extra cycle  E= -2.81884834761678  delta_E= -1.33e-15  |g|= 6.94e-10  |ddm|= 2.28e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [10.3430072   5.22719345  3.57492384  0.486108  ]
E = -2.8188483476167754
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:20 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  10.3430072049        1
[INPUT] 0    0    [1    /1   ]  5.22719345031        1
[INPUT] 0    0    [1    /1   ]  3.57492383877        1
[INPUT] 0    0    [1    /1   ]  0.48610799917        1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [10.34300720487109, 1.0]], [0, [5.227193450313431, 1.0]], [0, [3.5749238387727207, 1.0]], [0, [0.4861079991699338, 1.0]]]}
ecp = {}
CPU time:        49.57
Set gradient conv threshold to 3.16228e-05
cond(S) = 923.6443764921921
E1 = -3.8288053686629704  E_coul = 1.025784494955307
init E= -2.80302087370766
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.896559914941891  LUMO = 2.60127149713231
  mo_energy =
[-0.89655991  2.6012715  13.34546213 36.51038777]
E1 = -3.8665814789477526  E_coul = 1.0477372803326153
cycle= 1 E= -2.81884419861514  delta_E= -0.0158  |g|= 0.00964  |ddm|= 0.252
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.885555423092219  LUMO = 2.61899752234784
  mo_energy =
[-0.88555542  2.61899752 13.37101714 36.53921921]
E1 = -3.866074330396216  E_coul = 1.047225994596229
cycle= 2 E= -2.81884833579999  delta_E= -4.14e-06  |g|= 0.000516  |ddm|= 0.00633
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.885825330234071  LUMO = 2.61875281770127
  mo_energy =
[-0.88582533  2.61875282 13.37026947 36.53796603]
E1 = -3.866046123253757  E_coul = 1.047197775637022
cycle= 3 E= -2.81884834761673  delta_E= -1.18e-08  |g|= 1.46e-06  |ddm|= 0.000395
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.885825292352817  LUMO = 2.61875291829661
  mo_energy =
[-0.88582529  2.61875292 13.37026943 36.53796594]
E1 = -3.8660461188937134  E_coul = 1.0471977712769394
cycle= 4 E= -2.81884834761677  delta_E= -3.95e-14  |g|= 1.05e-08  |ddm|= 1.82e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8660461188937134  E_coul = 1.0471977712769394
  HOMO = -0.88582528816991  LUMO = 2.61875292369343
  mo_energy =
[-0.88582529  2.61875292 13.37026945 36.53796595]
E1 = -3.866046119664913  E_coul = 1.0471977720481374
Extra cycle  E= -2.81884834761678  delta_E= -1.33e-15  |g|= 6.94e-10  |ddm|= 2.28e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 923.6443764921921
E1 = -3.866046119664913  E_coul = 1.0471977720481374
init E= -2.81884834761678
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.885825287784317  LUMO = 2.61875292412548
  mo_energy =
[-0.88582529  2.61875292 13.37026945 36.53796596]
E1 = -3.8660461197251528  E_coul = 1.047197772108378
cycle= 1 E= -2.81884834761677  delta_E= 8.88e-16  |g|= 5.16e-11  |ddm|= 1.48e-09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8660461197251528  E_coul = 1.047197772108378
  HOMO = -0.885825287754202  LUMO = 2.61875292415873
  mo_energy =
[-0.88582529  2.61875292 13.37026945 36.53796596]
E1 = -3.8660461197299107  E_coul = 1.0471977721131347
Extra cycle  E= -2.81884834761678  delta_E= -1.78e-15  |g|= 3.9e-12  |ddm|= 1.05e-10
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [10.3430072   5.22719345  3.57492384  0.486108  ]
grad_E = [-0.00067963  0.00115628  0.00506117  0.05343712]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:22 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  38.3332271464        1
[INPUT] 0    0    [1    /1   ]  9.77836453269        1
[INPUT] 0    0    [1    /1   ]  1.00000000103e-06      1
[INPUT] 0    0    [1    /1   ]  0.6959510058         1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [38.33322714641686, 1.0]], [0, [9.778364532685224, 1.0]], [0, [1.0000000010279564e-06, 1.0]], [0, [0.6959510057996667, 1.0]]]}
ecp = {}
CPU time:        51.68
Set gradient conv threshold to 3.16228e-05
cond(S) = 7.6432075806019295
E1 = -3.537193708485746  E_coul = 1.0064297251220449
init E= -2.5307639833637
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.825044728445249  LUMO = -9.84553039877672e-05
  mo_energy =
[-8.25044728e-01 -9.84553040e-05  9.17313194e+00  7.20060015e+01]
E1 = -3.6922074436959478  E_coul = 1.033539686498063
cycle= 1 E= -2.65866775719788  delta_E= -0.128  |g|= 0.065  |ddm|= 0.211
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.812627264406925  LUMO = 1.51113903543439e-06
  mo_energy =
[-8.12627264e-01  1.51113904e-06  9.19122571e+00  7.19710061e+01]
E1 = -3.6901677439849463  E_coul = 1.031367665606156
cycle= 2 E= -2.65880007837879  delta_E= -0.000132  |g|= 0.00246  |ddm|= 0.00914
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.813772842810113  LUMO = 1.51113212864833e-06
  mo_energy =
[-8.13772843e-01  1.51113213e-06  9.18742434e+00  7.19618938e+01]
E1 = -3.6900544632477  E_coul = 1.0312540776230947
cycle= 3 E= -2.65880038562461  delta_E= -3.07e-07  |g|= 3.25e-05  |ddm|= 0.000446
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.813773256476086  LUMO = 1.51113212786037e-06
  mo_energy =
[-8.13773256e-01  1.51113213e-06  9.18742205e+00  7.19618741e+01]
E1 = -3.6900542427820184  E_coul = 1.0312538571487297
cycle= 4 E= -2.65880038563329  delta_E= -8.68e-12  |g|= 6.77e-09  |ddm|= 9.33e-07
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.6900542427820184  E_coul = 1.0312538571487297
  HOMO = -0.813773264242282  LUMO = 1.51113212766125e-06
  mo_energy =
[-8.13773264e-01  1.51113213e-06  9.18742206e+00  7.19618741e+01]
E1 = -3.690054243083339  E_coul = 1.031253857450051
Extra cycle  E= -2.65880038563329  delta_E= 4.44e-16  |g|= 3.48e-10  |ddm|= 1.17e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [3.83332271e+01 9.77836453e+00 1.00000000e-06 6.95951006e-01]
E = -2.6588003856332882
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:23 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  13.142029199         1
[INPUT] 0    0    [1    /1   ]  5.68231055855        1
[INPUT] 0    0    [1    /1   ]  3.2174315549         1
[INPUT] 0    0    [1    /1   ]  0.507092299833       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [13.142029199025668, 1.0]], [0, [5.6823105585506095, 1.0]], [0, [3.2174315548954486, 1.0]], [0, [0.507092299832907, 1.0]]]}
ecp = {}
CPU time:        52.11
Set gradient conv threshold to 3.16228e-05
cond(S) = 287.171874388846
E1 = -3.8261573009542236  E_coul = 1.0265059856249996
init E= -2.79965131532922
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.89707897787683  LUMO = 2.66280056523312
  mo_energy =
[-0.89707898  2.66280057 13.62838541 40.26828251]
E1 = -3.880096721633842  E_coul = 1.059474663501729
cycle= 1 E= -2.82062205813211  delta_E= -0.021  |g|= 0.0157  |ddm|= 0.226
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.880577795059902  LUMO = 2.68794722260825
  mo_energy =
[-0.8805778   2.68794722 13.66835991 40.31619958]
E1 = -3.8799901498885068  E_coul = 1.0593594237695219
cycle= 2 E= -2.82063072611898  delta_E= -8.67e-06  |g|= 0.000898  |ddm|= 0.00876
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.880639142641599  LUMO = 2.6879424032751
  mo_energy =
[-0.88063914  2.6879424  13.66813772 40.31556248]
E1 = -3.8799957113931556  E_coul = 1.0593649553019306
cycle= 3 E= -2.82063075609122  delta_E= -3e-08  |g|= 8.43e-06  |ddm|= 0.000569
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.880632478964898  LUMO = 2.687949247504
  mo_energy =
[-0.88063248  2.68794925 13.66815621 40.31558876]
E1 = -3.879996726279004  E_coul = 1.0593659701822167
cycle= 4 E= -2.82063075609679  delta_E= -5.56e-12  |g|= 2.02e-07  |ddm|= 5.96e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.879996726279004  E_coul = 1.0593659701822167
  HOMO = -0.880632392957289  LUMO = 2.68794934826015
  mo_energy =
[-0.88063239  2.68794935 13.66815644 40.31558906]
E1 = -3.8799967401973614  E_coul = 1.0593659841005727
Extra cycle  E= -2.82063075609679  delta_E= -1.33e-15  |g|= 1.34e-08  |ddm|= 1.78e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [13.1420292   5.68231056  3.21743155  0.5070923 ]
E = -2.8206307560967887
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:23 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  13.142029199         1
[INPUT] 0    0    [1    /1   ]  5.68231055855        1
[INPUT] 0    0    [1    /1   ]  3.2174315549         1
[INPUT] 0    0    [1    /1   ]  0.507092299833       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [13.142029199025668, 1.0]], [0, [5.6823105585506095, 1.0]], [0, [3.2174315548954486, 1.0]], [0, [0.507092299832907, 1.0]]]}
ecp = {}
CPU time:        52.54
Set gradient conv threshold to 3.16228e-05
cond(S) = 287.171874388846
E1 = -3.8261573009542236  E_coul = 1.0265059856249996
init E= -2.79965131532922
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.89707897787683  LUMO = 2.66280056523312
  mo_energy =
[-0.89707898  2.66280057 13.62838541 40.26828251]
E1 = -3.880096721633842  E_coul = 1.059474663501729
cycle= 1 E= -2.82062205813211  delta_E= -0.021  |g|= 0.0157  |ddm|= 0.226
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.880577795059902  LUMO = 2.68794722260825
  mo_energy =
[-0.8805778   2.68794722 13.66835991 40.31619958]
E1 = -3.8799901498885068  E_coul = 1.0593594237695219
cycle= 2 E= -2.82063072611898  delta_E= -8.67e-06  |g|= 0.000898  |ddm|= 0.00876
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.880639142641599  LUMO = 2.6879424032751
  mo_energy =
[-0.88063914  2.6879424  13.66813772 40.31556248]
E1 = -3.8799957113931556  E_coul = 1.0593649553019306
cycle= 3 E= -2.82063075609122  delta_E= -3e-08  |g|= 8.43e-06  |ddm|= 0.000569
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.880632478964898  LUMO = 2.687949247504
  mo_energy =
[-0.88063248  2.68794925 13.66815621 40.31558876]
E1 = -3.879996726279004  E_coul = 1.0593659701822167
cycle= 4 E= -2.82063075609679  delta_E= -5.56e-12  |g|= 2.02e-07  |ddm|= 5.96e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.879996726279004  E_coul = 1.0593659701822167
  HOMO = -0.880632392957289  LUMO = 2.68794934826015
  mo_energy =
[-0.88063239  2.68794935 13.66815644 40.31558906]
E1 = -3.8799967401973614  E_coul = 1.0593659841005727
Extra cycle  E= -2.82063075609679  delta_E= -1.33e-15  |g|= 1.34e-08  |ddm|= 1.78e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 287.171874388846
E1 = -3.8799967401973614  E_coul = 1.0593659841005727
init E= -2.82063075609679
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.880632385998111  LUMO = 2.68794935605254
  mo_energy =
[-0.88063239  2.68794936 13.66815646 40.31558909]
E1 = -3.879996741319831  E_coul = 1.059365985223042
cycle= 1 E= -2.82063075609679  delta_E= -4.44e-16  |g|= 9.95e-10  |ddm|= 1.2e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.879996741319831  E_coul = 1.059365985223042
  HOMO = -0.880632385436873  LUMO = 2.68794935666998
  mo_energy =
[-0.88063239  2.68794936 13.66815646 40.31558909]
E1 = -3.8799967414103924  E_coul = 1.059365985313605
Extra cycle  E= -2.82063075609679  delta_E= 1.78e-15  |g|= 7.55e-11  |ddm|= 8.69e-10
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [13.1420292   5.68231056  3.21743155  0.5070923 ]
grad_E = [-0.00073214  0.00042593  0.0051241   0.11344662]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:25 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  21.7000865086        1
[INPUT] 0    0    [1    /1   ]  7.056453851          1
[INPUT] 0    0    [1    /1   ]  2.09820085016        1
[INPUT] 0    0    [1    /1   ]  0.55425202832        1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [21.70008650864468, 1.0]], [0, [7.056453851003926, 1.0]], [0, [2.0982008501561795, 1.0]], [0, [0.5542520283199805, 1.0]]]}
ecp = {}
CPU time:        54.62
Set gradient conv threshold to 3.16228e-05
cond(S) = 49.379211961332565
E1 = -3.771514662746942  E_coul = 1.0231835307588066
init E= -2.74833113198814
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.894826658463623  LUMO = 2.40457703135353
  mo_energy =
[-0.89482666  2.40457703 12.98835258 50.62920491]
E1 = -3.9086411919874267  E_coul = 1.0944730578736215
cycle= 1 E= -2.8141681341138  delta_E= -0.0658  |g|= 0.0543  |ddm|= 0.363
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.859904841762673  LUMO = 2.45193960324635
  mo_energy =
[-0.85990484  2.4519396  13.07894595 50.74407752]
E1 = -3.9109010802873936  E_coul = 1.0966096235462484
cycle= 2 E= -2.81429145674115  delta_E= -0.000123  |g|= 0.00357  |ddm|= 0.0202
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.858752832368713  LUMO = 2.45312598795074
  mo_energy =
[-0.85875283  2.45312599 13.08197419 50.74740256]
E1 = -3.9111697207396157  E_coul = 1.096877476935365
cycle= 3 E= -2.81429224380425  delta_E= -7.87e-07  |g|= 6.24e-05  |ddm|= 0.00182
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.858706014554518  LUMO = 2.45316379324395
  mo_energy =
[-0.85870601  2.45316379 13.08210799 50.74761937]
E1 = -3.911177162408981  E_coul = 1.0968849183361962
cycle= 4 E= -2.81429224407278  delta_E= -2.69e-10  |g|= 3.4e-06  |ddm|= 2.53e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.911177162408981  E_coul = 1.0968849183361962
  HOMO = -0.858703662868843  LUMO = 2.45316597180606
  mo_energy =
[-0.85870366  2.45316597 13.08211457 50.74762907]
E1 = -3.9111775930672783  E_coul = 1.0968853489932948
Extra cycle  E= -2.81429224407398  delta_E= -1.2e-12  |g|= 3.13e-07  |ddm|= 2.16e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [21.70008651  7.05645385  2.09820085  0.55425203]
E = -2.8142922440739833
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:26 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  15.23442229          1
[INPUT] 0    0    [1    /1   ]  6.01828025672        1
[INPUT] 0    0    [1    /1   ]  2.94378643789        1
[INPUT] 0    0    [1    /1   ]  0.518622567333       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [15.234422290040836, 1.0]], [0, [6.018280256715923, 1.0]], [0, [2.9437864378878436, 1.0]], [0, [0.5186225673329382, 1.0]]]}
ecp = {}
CPU time:        55.11
Set gradient conv threshold to 3.16228e-05
cond(S) = 155.93375120270673
E1 = -3.822322409840893  E_coul = 1.0266893109160637
init E= -2.79563309892483
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.897533151871417  LUMO = 2.64948714883687
  mo_energy =
[-0.89753315  2.64948715 13.63168379 42.88210941]
E1 = -3.8895173448754314  E_coul = 1.0677158531018092
cycle= 1 E= -2.82180149177362  delta_E= -0.0262  |g|= 0.0218  |ddm|= 0.231
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.877050752827991  LUMO = 2.67976070960124
  mo_energy =
[-0.87705075  2.67976071 13.68242023 42.94453901]
E1 = -3.889783262164248  E_coul = 1.0679649206785344
cycle= 2 E= -2.82181834148571  delta_E= -1.68e-05  |g|= 0.00129  |ddm|= 0.00998
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.876918520252124  LUMO = 2.67997357002989
  mo_energy =
[-0.87691852  2.67997357 13.68270952 42.9445175 ]
E1 = -3.8898228825407837  E_coul = 1.0680044721539947
cycle= 3 E= -2.82181841038679  delta_E= -6.89e-08  |g|= 1.56e-05  |ddm|= 0.000688
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.876906311118279  LUMO = 2.67998549114713
  mo_energy =
[-0.87690631  2.67998549 13.68274415 42.94456897]
E1 = -3.8898247208341834  E_coul = 1.068006310430238
cycle= 4 E= -2.82181841040395  delta_E= -1.72e-11  |g|= 5.49e-07  |ddm|= 7.01e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8898247208341834  E_coul = 1.068006310430238
  HOMO = -0.876906049986854  LUMO = 2.67998578494296
  mo_energy =
[-0.87690605  2.67998578 13.68274486 42.94456993]
E1 = -3.8898247635704104  E_coul = 1.0680063531664468
Extra cycle  E= -2.82181841040396  delta_E= -1.82e-14  |g|= 3.86e-08  |ddm|= 3.63e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [15.23442229  6.01828026  2.94378644  0.51862257]
E = -2.8218184104039636
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:26 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  15.23442229          1
[INPUT] 0    0    [1    /1   ]  6.01828025672        1
[INPUT] 0    0    [1    /1   ]  2.94378643789        1
[INPUT] 0    0    [1    /1   ]  0.518622567333       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [15.234422290040836, 1.0]], [0, [6.018280256715923, 1.0]], [0, [2.9437864378878436, 1.0]], [0, [0.5186225673329382, 1.0]]]}
ecp = {}
CPU time:        55.58
Set gradient conv threshold to 3.16228e-05
cond(S) = 155.93375120270673
E1 = -3.822322409840893  E_coul = 1.0266893109160637
init E= -2.79563309892483
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.897533151871417  LUMO = 2.64948714883687
  mo_energy =
[-0.89753315  2.64948715 13.63168379 42.88210941]
E1 = -3.8895173448754314  E_coul = 1.0677158531018092
cycle= 1 E= -2.82180149177362  delta_E= -0.0262  |g|= 0.0218  |ddm|= 0.231
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.877050752827991  LUMO = 2.67976070960124
  mo_energy =
[-0.87705075  2.67976071 13.68242023 42.94453901]
E1 = -3.889783262164248  E_coul = 1.0679649206785344
cycle= 2 E= -2.82181834148571  delta_E= -1.68e-05  |g|= 0.00129  |ddm|= 0.00998
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.876918520252124  LUMO = 2.67997357002989
  mo_energy =
[-0.87691852  2.67997357 13.68270952 42.9445175 ]
E1 = -3.8898228825407837  E_coul = 1.0680044721539947
cycle= 3 E= -2.82181841038679  delta_E= -6.89e-08  |g|= 1.56e-05  |ddm|= 0.000688
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.876906311118279  LUMO = 2.67998549114713
  mo_energy =
[-0.87690631  2.67998549 13.68274415 42.94456897]
E1 = -3.8898247208341834  E_coul = 1.068006310430238
cycle= 4 E= -2.82181841040395  delta_E= -1.72e-11  |g|= 5.49e-07  |ddm|= 7.01e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8898247208341834  E_coul = 1.068006310430238
  HOMO = -0.876906049986854  LUMO = 2.67998578494296
  mo_energy =
[-0.87690605  2.67998578 13.68274486 42.94456993]
E1 = -3.8898247635704104  E_coul = 1.0680063531664468
Extra cycle  E= -2.82181841040396  delta_E= -1.82e-14  |g|= 3.86e-08  |ddm|= 3.63e-07
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 155.93375120270673
E1 = -3.8898247635704104  E_coul = 1.0680063531664468
init E= -2.82181841040396
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.876906028618761  LUMO = 2.67998580812972
  mo_energy =
[-0.87690603  2.67998581 13.68274492 42.94457001]
E1 = -3.8898247670880006  E_coul = 1.0680063566840363
cycle= 1 E= -2.82181841040396  delta_E= -8.88e-16  |g|= 2.97e-09  |ddm|= 2.6e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8898247670880006  E_coul = 1.0680063566840363
  HOMO = -0.876906026859958  LUMO = 2.67998581001096
  mo_energy =
[-0.87690603  2.67998581 13.68274492 42.94457002]
E1 = -3.8898247673766964  E_coul = 1.068006356972732
Extra cycle  E= -2.82181841040396  delta_E=    0  |g|= 2.32e-10  |ddm|= 1.98e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.08 sec
exp = [15.23442229  6.01828026  2.94378644  0.51862257]
grad_E = [-7.58441403e-04  5.95473592e-05  3.87139165e-03  1.59646171e-01]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:28 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  19.3953104842        1
[INPUT] 0    0    [1    /1   ]  6.66622220816        1
[INPUT] 0    0    [1    /1   ]  2.37169008437        1
[INPUT] 0    0    [1    /1   ]  0.527621507503       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [19.395310484228283, 1.0]], [0, [6.666222208160788, 1.0]], [0, [2.371690084371767, 1.0]], [0, [0.5276215075028554, 1.0]]]}
ecp = {}
CPU time:        57.68
Set gradient conv threshold to 3.16228e-05
cond(S) = 65.44108921560701
E1 = -3.809202257537118  E_coul = 1.0257372840171723
init E= -2.78346497351995
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.898625786230601  LUMO = 2.46797680411477
  mo_energy =
[-0.89862579  2.4679768  13.17561565 47.6920389 ]
E1 = -3.903737581648418  E_coul = 1.080234045168686
cycle= 1 E= -2.82350353647973  delta_E= -0.04  |g|= 0.0367  |ddm|= 0.266
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.871659734372735  LUMO = 2.50530531248328
  mo_energy =
[-0.87165973  2.50530531 13.2444941  47.77905213]
E1 = -3.904984263650293  E_coul = 1.081427206037841
cycle= 2 E= -2.82355705761245  delta_E= -5.35e-05  |g|= 0.00233  |ddm|= 0.0137
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.871017916893344  LUMO = 2.50602698403312
  mo_energy =
[-0.87101792  2.50602698 13.24615704 47.78072063]
E1 = -3.905129094546229  E_coul = 1.0815717434623637
cycle= 3 E= -2.82355735108387  delta_E= -2.93e-07  |g|= 3.63e-05  |ddm|= 0.00112
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.870991936529637  LUMO = 2.50604926121689
  mo_energy =
[-0.87099194  2.50604926 13.24623192 47.7808404 ]
E1 = -3.9051329971701287  E_coul = 1.081575646009361
cycle= 4 E= -2.82355735116077  delta_E= -7.69e-11  |g|= 1.7e-06  |ddm|= 1.18e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.9051329971701287  E_coul = 1.081575646009361
  HOMO = -0.870990852575818  LUMO = 2.50605033994409
  mo_energy =
[-0.87099085  2.50605034 13.24623494 47.78084471]
E1 = -3.9051331851215587  E_coul = 1.0815758339605377
Extra cycle  E= -2.82355735116102  delta_E= -2.54e-13  |g|= 1.43e-07  |ddm|= 1e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [19.39531048  6.66622221  2.37169008  0.52762151]
E = -2.8235573511610212
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:29 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  19.3953104842        1
[INPUT] 0    0    [1    /1   ]  6.66622220816        1
[INPUT] 0    0    [1    /1   ]  2.37169008437        1
[INPUT] 0    0    [1    /1   ]  0.527621507503       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [19.395310484228283, 1.0]], [0, [6.666222208160788, 1.0]], [0, [2.371690084371767, 1.0]], [0, [0.5276215075028554, 1.0]]]}
ecp = {}
CPU time:        58.15
Set gradient conv threshold to 3.16228e-05
cond(S) = 65.44108921560701
E1 = -3.809202257537118  E_coul = 1.0257372840171723
init E= -2.78346497351995
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.898625786230601  LUMO = 2.46797680411477
  mo_energy =
[-0.89862579  2.4679768  13.17561565 47.6920389 ]
E1 = -3.903737581648418  E_coul = 1.080234045168686
cycle= 1 E= -2.82350353647973  delta_E= -0.04  |g|= 0.0367  |ddm|= 0.266
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.871659734372735  LUMO = 2.50530531248328
  mo_energy =
[-0.87165973  2.50530531 13.2444941  47.77905213]
E1 = -3.904984263650293  E_coul = 1.081427206037841
cycle= 2 E= -2.82355705761245  delta_E= -5.35e-05  |g|= 0.00233  |ddm|= 0.0137
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.871017916893344  LUMO = 2.50602698403312
  mo_energy =
[-0.87101792  2.50602698 13.24615704 47.78072063]
E1 = -3.905129094546229  E_coul = 1.0815717434623637
cycle= 3 E= -2.82355735108387  delta_E= -2.93e-07  |g|= 3.63e-05  |ddm|= 0.00112
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.870991936529637  LUMO = 2.50604926121689
  mo_energy =
[-0.87099194  2.50604926 13.24623192 47.7808404 ]
E1 = -3.9051329971701287  E_coul = 1.081575646009361
cycle= 4 E= -2.82355735116077  delta_E= -7.69e-11  |g|= 1.7e-06  |ddm|= 1.18e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.9051329971701287  E_coul = 1.081575646009361
  HOMO = -0.870990852575818  LUMO = 2.50605033994409
  mo_energy =
[-0.87099085  2.50605034 13.24623494 47.78084471]
E1 = -3.9051331851215587  E_coul = 1.0815758339605377
Extra cycle  E= -2.82355735116102  delta_E= -2.54e-13  |g|= 1.43e-07  |ddm|= 1e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 65.44108921560701
E1 = -3.9051331851215587  E_coul = 1.0815758339605377
init E= -2.82355735116102
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.870990758600241  LUMO = 2.50605043124658
  mo_energy =
[-0.87099076  2.50605043 13.2462352  47.78084508]
E1 = -3.9051332015057714  E_coul = 1.0815758503447486
cycle= 1 E= -2.82355735116102  delta_E= -1.78e-15  |g|= 1.23e-08  |ddm|= 8.38e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.9051332015057714  E_coul = 1.0815758503447486
  HOMO = -0.870990750408133  LUMO = 2.5060504391638
  mo_energy =
[-0.87099075  2.50605044 13.24623522 47.78084512]
E1 = -3.905133202933814  E_coul = 1.081575851772791
Extra cycle  E= -2.82355735116102  delta_E=    0  |g|= 1.06e-09  |ddm|= 7.17e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.08 sec
exp = [19.39531048  6.66622221  2.37169008  0.52762151]
grad_E = [-0.00079719  0.00056766 -0.00463362  0.24592371]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:31 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  18.9631112736        1
[INPUT] 0    0    [1    /1   ]  6.56382825584        1
[INPUT] 0    0    [1    /1   ]  2.3843849272         1
[INPUT] 0    0    [1    /1   ]  0.507089329367       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [18.96311127355207, 1.0]], [0, [6.563828255844228, 1.0]], [0, [2.3843849271988247, 1.0]], [0, [0.5070893293665013, 1.0]]]}
ecp = {}
CPU time:        60.24
Set gradient conv threshold to 3.16228e-05
cond(S) = 67.08748682964763
E1 = -3.8237885275941474  E_coul = 1.0261060274979183
init E= -2.79768250009623
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.900731193678851  LUMO = 2.4077499264336
  mo_energy =
[-0.90073119  2.40774993 13.02300726 46.86939814]
E1 = -3.8991338424400084  E_coul = 1.0712603420200806
cycle= 1 E= -2.82787350041993  delta_E= -0.0302  |g|= 0.0294  |ddm|= 0.213
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.878322660724844  LUMO = 2.43864242846736
  mo_energy =
[-0.87832266  2.43864243 13.07986116 46.94080036]
E1 = -3.900042223187387  E_coul = 1.0721343022164032
cycle= 2 E= -2.82790792097098  delta_E= -3.44e-05  |g|= 0.00187  |ddm|= 0.0109
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.877853049747768  LUMO = 2.43918172816424
  mo_energy =
[-0.87785305  2.43918173 13.08106672 46.94191749]
E1 = -3.9001513506264676  E_coul = 1.0722432453339832
cycle= 3 E= -2.82790810529248  delta_E= -1.84e-07  |g|= 2.78e-05  |ddm|= 0.000876
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.87783159856953  LUMO = 2.43920037272569
  mo_energy =
[-0.8778316   2.43920037 13.08112844 46.94201518]
E1 = -3.9001545571203877  E_coul = 1.0722464517784849
cycle= 4 E= -2.8279081053419  delta_E= -4.94e-11  |g|= 1.24e-06  |ddm|= 9.82e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.9001545571203877  E_coul = 1.0722464517784849
  HOMO = -0.877830826781764  LUMO = 2.43920114419283
  mo_energy =
[-0.87783083  2.43920114 13.08113058 46.94201822]
E1 = -3.900154689872639  E_coul = 1.0722465845306077
Extra cycle  E= -2.82790810534203  delta_E= -1.28e-13  |g|= 1.02e-07  |ddm|= 7.15e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [18.96311127  6.56382826  2.38438493  0.50708933]
E = -2.8279081053420314
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:31 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  18.9631112736        1
[INPUT] 0    0    [1    /1   ]  6.56382825584        1
[INPUT] 0    0    [1    /1   ]  2.3843849272         1
[INPUT] 0    0    [1    /1   ]  0.507089329367       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [18.96311127355207, 1.0]], [0, [6.563828255844228, 1.0]], [0, [2.3843849271988247, 1.0]], [0, [0.5070893293665013, 1.0]]]}
ecp = {}
CPU time:        60.73
Set gradient conv threshold to 3.16228e-05
cond(S) = 67.08748682964763
E1 = -3.8237885275941474  E_coul = 1.0261060274979183
init E= -2.79768250009623
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.900731193678851  LUMO = 2.4077499264336
  mo_energy =
[-0.90073119  2.40774993 13.02300726 46.86939814]
E1 = -3.8991338424400084  E_coul = 1.0712603420200806
cycle= 1 E= -2.82787350041993  delta_E= -0.0302  |g|= 0.0294  |ddm|= 0.213
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.878322660724844  LUMO = 2.43864242846736
  mo_energy =
[-0.87832266  2.43864243 13.07986116 46.94080036]
E1 = -3.900042223187387  E_coul = 1.0721343022164032
cycle= 2 E= -2.82790792097098  delta_E= -3.44e-05  |g|= 0.00187  |ddm|= 0.0109
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.877853049747768  LUMO = 2.43918172816424
  mo_energy =
[-0.87785305  2.43918173 13.08106672 46.94191749]
E1 = -3.9001513506264676  E_coul = 1.0722432453339832
cycle= 3 E= -2.82790810529248  delta_E= -1.84e-07  |g|= 2.78e-05  |ddm|= 0.000876
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.87783159856953  LUMO = 2.43920037272569
  mo_energy =
[-0.8778316   2.43920037 13.08112844 46.94201518]
E1 = -3.9001545571203877  E_coul = 1.0722464517784849
cycle= 4 E= -2.8279081053419  delta_E= -4.94e-11  |g|= 1.24e-06  |ddm|= 9.82e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.9001545571203877  E_coul = 1.0722464517784849
  HOMO = -0.877830826781764  LUMO = 2.43920114419283
  mo_energy =
[-0.87783083  2.43920114 13.08113058 46.94201822]
E1 = -3.900154689872639  E_coul = 1.0722465845306077
Extra cycle  E= -2.82790810534203  delta_E= -1.28e-13  |g|= 1.02e-07  |ddm|= 7.15e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 67.08748682964763
E1 = -3.900154689872639  E_coul = 1.0722465845306077
init E= -2.82790810534203
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.877830760405714  LUMO = 2.43920120901117
  mo_energy =
[-0.87783076  2.43920121 13.08113077 46.94201848]
E1 = -3.9001547013652385  E_coul = 1.0722465960232068
cycle= 1 E= -2.82790810534203  delta_E= -4.44e-16  |g|= 8.71e-09  |ddm|= 5.91e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.9001547013652385  E_coul = 1.0722465960232068
  HOMO = -0.87783075465941  LUMO = 2.43920121458955
  mo_energy =
[-0.87783075  2.43920121 13.08113078 46.94201851]
E1 = -3.9001547023598717  E_coul = 1.0722465970178394
Extra cycle  E= -2.82790810534203  delta_E= -4.44e-16  |g|= 7.43e-10  |ddm|= 5e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [18.96311127  6.56382826  2.38438493  0.50708933]
grad_E = [-0.00075806  0.00029346 -0.00102804  0.20197952]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:33 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  23.6147194917        1
[INPUT] 0    0    [1    /1   ]  6.96849284918        1
[INPUT] 0    0    [1    /1   ]  1.32037363304        1
[INPUT] 0    0    [1    /1   ]  0.334635068445       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [23.614719491703642, 1.0]], [0, [6.968492849184927, 1.0]], [0, [1.320373633043103, 1.0]], [0, [0.3346350684451202, 1.0]]]}
ecp = {}
CPU time:        62.79
Set gradient conv threshold to 3.16228e-05
cond(S) = 23.694113580461035
E1 = -3.854031331570883  E_coul = 1.0226983261451594
init E= -2.83133300542572
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.910485582575807  LUMO = 1.30334707727983
  mo_energy =
[-0.91048558  1.30334708  9.90715894 49.09227087]
E1 = -3.8766079208746147  E_coul = 1.0324826444024158
cycle= 1 E= -2.8441252764722  delta_E= -0.0128  |g|= 0.0273  |ddm|= 0.11
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.90583847613276  LUMO = 1.30897548807286
  mo_energy =
[-0.90583848  1.30897549  9.91832903 49.09839155]
E1 = -3.8780045202516207  E_coul = 1.0338416220675515
cycle= 2 E= -2.84416289818407  delta_E= -3.76e-05  |g|= 0.00204  |ddm|= 0.00946
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.905099159878041  LUMO = 1.30950833602447
  mo_energy =
[-0.90509916  1.30950834  9.92024786 49.10038012]
E1 = -3.878242086725968  E_coul = 1.0340787851723299
cycle= 3 E= -2.84416330155364  delta_E= -4.03e-07  |g|= 6.27e-05  |ddm|= 0.00117
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.905038621082525  LUMO = 1.30954448415552
  mo_energy =
[-0.90503862  1.30954448  9.92041278 49.10063234]
E1 = -3.878254227887131  E_coul = 1.0340909257750939
cycle= 4 E= -2.84416330211204  delta_E= -5.58e-10  |g|= 2.74e-06  |ddm|= 4.39e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.878254227887131  E_coul = 1.0340909257750939
  HOMO = -0.90503618816903  LUMO = 1.30954600709599
  mo_energy =
[-0.90503619  1.30954601  9.92041938 49.10064237]
E1 = -3.878254742477748  E_coul = 1.0340914403644577
Extra cycle  E= -2.84416330211329  delta_E= -1.25e-12  |g|= 3.39e-07  |ddm|= 1.99e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [23.61471949  6.96849285  1.32037363  0.33463507]
E = -2.84416330211329
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:34 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  23.6147194917        1
[INPUT] 0    0    [1    /1   ]  6.96849284918        1
[INPUT] 0    0    [1    /1   ]  1.32037363304        1
[INPUT] 0    0    [1    /1   ]  0.334635068445       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [23.614719491703642, 1.0]], [0, [6.968492849184927, 1.0]], [0, [1.320373633043103, 1.0]], [0, [0.3346350684451202, 1.0]]]}
ecp = {}
CPU time:        63.27
Set gradient conv threshold to 3.16228e-05
cond(S) = 23.694113580461035
E1 = -3.854031331570883  E_coul = 1.0226983261451594
init E= -2.83133300542572
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.910485582575807  LUMO = 1.30334707727983
  mo_energy =
[-0.91048558  1.30334708  9.90715894 49.09227087]
E1 = -3.8766079208746147  E_coul = 1.0324826444024158
cycle= 1 E= -2.8441252764722  delta_E= -0.0128  |g|= 0.0273  |ddm|= 0.11
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.90583847613276  LUMO = 1.30897548807286
  mo_energy =
[-0.90583848  1.30897549  9.91832903 49.09839155]
E1 = -3.8780045202516207  E_coul = 1.0338416220675515
cycle= 2 E= -2.84416289818407  delta_E= -3.76e-05  |g|= 0.00204  |ddm|= 0.00946
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.905099159878041  LUMO = 1.30950833602447
  mo_energy =
[-0.90509916  1.30950834  9.92024786 49.10038012]
E1 = -3.878242086725968  E_coul = 1.0340787851723299
cycle= 3 E= -2.84416330155364  delta_E= -4.03e-07  |g|= 6.27e-05  |ddm|= 0.00117
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.905038621082525  LUMO = 1.30954448415552
  mo_energy =
[-0.90503862  1.30954448  9.92041278 49.10063234]
E1 = -3.878254227887131  E_coul = 1.0340909257750939
cycle= 4 E= -2.84416330211204  delta_E= -5.58e-10  |g|= 2.74e-06  |ddm|= 4.39e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.878254227887131  E_coul = 1.0340909257750939
  HOMO = -0.90503618816903  LUMO = 1.30954600709599
  mo_energy =
[-0.90503619  1.30954601  9.92041938 49.10064237]
E1 = -3.878254742477748  E_coul = 1.0340914403644577
Extra cycle  E= -2.84416330211329  delta_E= -1.25e-12  |g|= 3.39e-07  |ddm|= 1.99e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 23.694113580461035
E1 = -3.878254742477748  E_coul = 1.0340914403644577
init E= -2.84416330211329
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.905035930874422  LUMO = 1.30954616905521
  mo_energy =
[-0.90503593  1.30954617  9.92042007 49.10064338]
E1 = -3.878254800161348  E_coul = 1.0340914980480413
cycle= 1 E= -2.84416330211331  delta_E= -1.69e-14  |g|= 4.08e-08  |ddm|= 2.32e-07
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.878254800161348  E_coul = 1.0340914980480413
  HOMO = -0.90503590203263  LUMO = 1.30954618732965
  mo_energy =
[-0.9050359   1.30954619  9.92042015 49.10064349]
E1 = -3.8782548068004674  E_coul = 1.03409150468716
Extra cycle  E= -2.84416330211331  delta_E= -8.88e-16  |g|= 4.84e-09  |ddm|= 2.71e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [23.61471949  6.96849285  1.32037363  0.33463507]
grad_E = [-0.00083418  0.00600761 -0.04284161  0.11561178]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:36 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  19.2231491882        1
[INPUT] 0    0    [1    /1   ]  6.25824169086        1
[INPUT] 0    0    [1    /1   ]  1.90415202952        1
[INPUT] 0    0    [1    /1   ]  0.289050416505       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [19.22314918824678, 1.0]], [0, [6.258241690861785, 1.0]], [0, [1.9041520295246759, 1.0]], [0, [0.2890504165048347, 1.0]]]}
ecp = {}
CPU time:        65.38
Set gradient conv threshold to 3.16228e-05
cond(S) = 38.26263409433279
E1 = -3.806022216456507  E_coul = 1.015246466564216
init E= -2.79077574989229
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.902558191945853  LUMO = 1.43603419303814
  mo_energy =
[-0.90255819  1.43603419 10.72015244 43.85935293]
E1 = -3.8108920634035655  E_coul = 0.9891581574517323
cycle= 1 E= -2.82173390595183  delta_E= -0.031  |g|= 0.0428  |ddm|= 0.245
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.916337440994148  LUMO = 1.42677972635996
  mo_energy =
[-0.91633744  1.42677973 10.68531666 43.81422246]
E1 = -3.80745988208942  E_coul = 0.9856188164782405
cycle= 2 E= -2.82184106561118  delta_E= -0.000107  |g|= 0.00307  |ddm|= 0.0179
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.918308064205824  LUMO = 1.42509974604204
  mo_energy =
[-0.91830806  1.42509975 10.67996371 43.80733105]
E1 = -3.8071238425135365  E_coul = 0.9852820325335463
cycle= 3 E= -2.82184180997999  delta_E= -7.44e-07  |g|= 7.3e-05  |ddm|= 0.00161
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.918277332401895  LUMO = 1.4251258470573
  mo_energy =
[-0.91827733  1.42512585 10.68004318 43.80744372]
E1 = -3.807128535860923  E_coul = 0.985286725679619
cycle= 4 E= -2.8218418101813  delta_E= -2.01e-10  |g|= 1.23e-07  |ddm|= 2.62e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.807128535860923  E_coul = 0.985286725679619
  HOMO = -0.918277542250842  LUMO = 1.42512571733049
  mo_energy =
[-0.91827754  1.42512572 10.68004265 43.8074429 ]
E1 = -3.807128509624509  E_coul = 0.9852866994432015
Extra cycle  E= -2.82184181018131  delta_E= -3.55e-15  |g|= 1.09e-08  |ddm|= 7.67e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [19.22314919  6.25824169  1.90415203  0.28905042]
E = -2.8218418101813074
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:36 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  22.3401457765        1
[INPUT] 0    0    [1    /1   ]  6.76235531864        1
[INPUT] 0    0    [1    /1   ]  1.48980473587        1
[INPUT] 0    0    [1    /1   ]  0.321404949111       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [22.340145776534722, 1.0]], [0, [6.7623553186404735, 1.0]], [0, [1.4898047358659756, 1.0]], [0, [0.32140494911115963, 1.0]]]}
ecp = {}
CPU time:        65.89
Set gradient conv threshold to 3.16228e-05
cond(S) = 26.122146547001346
E1 = -3.8689169726192634  E_coul = 1.0236622268245628
init E= -2.8452547457947
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912090695098257  LUMO = 1.35524687146757
  mo_energy =
[-0.9120907   1.35524687 10.18147985 47.56768542]
E1 = -3.8720792949562752  E_coul = 1.0242159917733757
cycle= 1 E= -2.8478633031829  delta_E= -0.00261  |g|= 0.00568  |ddm|= 0.0202
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.91182423231529  LUMO = 1.35662892767605
  mo_energy =
[-0.91182423  1.35662893 10.18136188 47.56391552]
E1 = -3.871958831492822  E_coul = 1.0240943076796933
cycle= 2 E= -2.84786452381313  delta_E= -1.22e-06  |g|= 0.000314  |ddm|= 0.00107
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911889172928867  LUMO = 1.35660472890999
  mo_energy =
[-0.91188917  1.35660473 10.18116318 47.56338632]
E1 = -3.8719655466037053  E_coul = 1.0241010177209808
cycle= 3 E= -2.84786452888272  delta_E= -5.07e-09  |g|= 7.34e-06  |ddm|= 9.66e-05
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911881333147529  LUMO = 1.3566098546804
  mo_energy =
[-0.91188133  1.35660985 10.18118471 47.56341911]
E1 = -3.8719669322205075  E_coul = 1.024102403330693
cycle= 4 E= -2.84786452888981  delta_E= -7.09e-12  |g|= 3.43e-07  |ddm|= 4.64e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8719669322205075  E_coul = 1.024102403330693
  HOMO = -0.91188106277957  LUMO = 1.35661004162211
  mo_energy =
[-0.91188106  1.35661004 10.18118544 47.56342017]
E1 = -3.8719669863232067  E_coul = 1.0241024574333764
Extra cycle  E= -2.84786452888983  delta_E= -1.55e-14  |g|= 3.76e-08  |ddm|= 2.1e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [22.34014578  6.76235532  1.48980474  0.32140495]
E = -2.84786452888983
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:37 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  22.3401457765        1
[INPUT] 0    0    [1    /1   ]  6.76235531864        1
[INPUT] 0    0    [1    /1   ]  1.48980473587        1
[INPUT] 0    0    [1    /1   ]  0.321404949111       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [22.340145776534722, 1.0]], [0, [6.7623553186404735, 1.0]], [0, [1.4898047358659756, 1.0]], [0, [0.32140494911115963, 1.0]]]}
ecp = {}
CPU time:        66.40
Set gradient conv threshold to 3.16228e-05
cond(S) = 26.122146547001346
E1 = -3.8689169726192634  E_coul = 1.0236622268245628
init E= -2.8452547457947
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912090695098257  LUMO = 1.35524687146757
  mo_energy =
[-0.9120907   1.35524687 10.18147985 47.56768542]
E1 = -3.8720792949562752  E_coul = 1.0242159917733757
cycle= 1 E= -2.8478633031829  delta_E= -0.00261  |g|= 0.00568  |ddm|= 0.0202
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.91182423231529  LUMO = 1.35662892767605
  mo_energy =
[-0.91182423  1.35662893 10.18136188 47.56391552]
E1 = -3.871958831492822  E_coul = 1.0240943076796933
cycle= 2 E= -2.84786452381313  delta_E= -1.22e-06  |g|= 0.000314  |ddm|= 0.00107
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911889172928867  LUMO = 1.35660472890999
  mo_energy =
[-0.91188917  1.35660473 10.18116318 47.56338632]
E1 = -3.8719655466037053  E_coul = 1.0241010177209808
cycle= 3 E= -2.84786452888272  delta_E= -5.07e-09  |g|= 7.34e-06  |ddm|= 9.66e-05
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911881333147529  LUMO = 1.3566098546804
  mo_energy =
[-0.91188133  1.35660985 10.18118471 47.56341911]
E1 = -3.8719669322205075  E_coul = 1.024102403330693
cycle= 4 E= -2.84786452888981  delta_E= -7.09e-12  |g|= 3.43e-07  |ddm|= 4.64e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8719669322205075  E_coul = 1.024102403330693
  HOMO = -0.91188106277957  LUMO = 1.35661004162211
  mo_energy =
[-0.91188106  1.35661004 10.18118544 47.56342017]
E1 = -3.8719669863232067  E_coul = 1.0241024574333764
Extra cycle  E= -2.84786452888983  delta_E= -1.55e-14  |g|= 3.76e-08  |ddm|= 2.1e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 26.122146547001346
E1 = -3.8719669863232067  E_coul = 1.0241024574333764
init E= -2.84786452888983
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.911881035728227  LUMO = 1.35661006037721
  mo_energy =
[-0.91188104  1.35661006 10.18118551 47.56342027]
E1 = -3.871966991932267  E_coul = 1.024102463042437
cycle= 1 E= -2.84786452888983  delta_E=    0  |g|= 4.06e-09  |ddm|= 2.21e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.871966991932267  E_coul = 1.024102463042437
  HOMO = -0.911881032923696  LUMO = 1.35661006232661
  mo_energy =
[-0.91188103  1.35661006 10.18118552 47.56342028]
E1 = -3.8719669925228417  E_coul = 1.0241024636330134
Extra cycle  E= -2.84786452888983  delta_E= 1.78e-15  |g|= 4.35e-10  |ddm|= 2.35e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [22.34014578  6.76235532  1.48980474  0.32140495]
grad_E = [-0.00076857  0.00240965  0.00236865 -0.02532126]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:39 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  22.5286098219        1
[INPUT] 0    0    [1    /1   ]  6.81848267816        1
[INPUT] 0    0    [1    /1   ]  1.50682557215        1
[INPUT] 0    0    [1    /1   ]  0.33417087163        1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [22.528609821915076, 1.0]], [0, [6.818482678159752, 1.0]], [0, [1.506825572145955, 1.0]], [0, [0.33417087163031384, 1.0]]]}
ecp = {}
CPU time:        68.53
Set gradient conv threshold to 3.16228e-05
cond(S) = 26.61190490619267
E1 = -3.868036677425451  E_coul = 1.023879444993396
init E= -2.84415723243205
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912015007997888  LUMO = 1.40493600113127
  mo_energy =
[-0.91201501  1.404936   10.32932923 48.0529651 ]
E1 = -3.875716615664363  E_coul = 1.027754756442591
cycle= 1 E= -2.84796185922177  delta_E= -0.0038  |g|= 0.00955  |ddm|= 0.0383
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.910105329514466  LUMO = 1.40781892885292
  mo_energy =
[-0.91010533  1.40781893 10.33342379 48.05433198]
E1 = -3.8759066350319595  E_coul = 1.0279409438540656
cycle= 2 E= -2.84796569117789  delta_E= -3.83e-06  |g|= 0.00063  |ddm|= 0.00258
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910004874030724  LUMO = 1.40791792116419
  mo_energy =
[-0.91000487  1.40791792 10.33366295 48.05434134]
E1 = -3.8759533684535175  E_coul = 1.027987649818012
cycle= 3 E= -2.84796571863551  delta_E= -2.75e-08  |g|= 1.54e-05  |ddm|= 0.000276
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.909988147474011  LUMO = 1.40792893662929
  mo_energy =
[-0.90998815  1.40792894 10.33370915 48.05441266]
E1 = -3.8759562708003794  E_coul = 1.0279905521344617
cycle= 4 E= -2.84796571866592  delta_E= -3.04e-11  |g|= 6.74e-07  |ddm|= 9.56e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8759562708003794  E_coul = 1.0279905521344617
  HOMO = -0.90998758326576  LUMO = 1.40792933026427
  mo_energy =
[-0.90998758  1.40792933 10.33371068 48.05441492]
E1 = -3.875956381270888  E_coul = 1.0279906626049065
Extra cycle  E= -2.84796571866598  delta_E= -6.39e-14  |g|= 7.43e-08  |ddm|= 4.26e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [22.52860982  6.81848268  1.50682557  0.33417087]
E = -2.8479657186659817
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:40 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  22.5286098219        1
[INPUT] 0    0    [1    /1   ]  6.81848267816        1
[INPUT] 0    0    [1    /1   ]  1.50682557215        1
[INPUT] 0    0    [1    /1   ]  0.33417087163        1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [22.528609821915076, 1.0]], [0, [6.818482678159752, 1.0]], [0, [1.506825572145955, 1.0]], [0, [0.33417087163031384, 1.0]]]}
ecp = {}
CPU time:        69.06
Set gradient conv threshold to 3.16228e-05
cond(S) = 26.61190490619267
E1 = -3.868036677425451  E_coul = 1.023879444993396
init E= -2.84415723243205
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912015007997888  LUMO = 1.40493600113127
  mo_energy =
[-0.91201501  1.404936   10.32932923 48.0529651 ]
E1 = -3.875716615664363  E_coul = 1.027754756442591
cycle= 1 E= -2.84796185922177  delta_E= -0.0038  |g|= 0.00955  |ddm|= 0.0383
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.910105329514466  LUMO = 1.40781892885292
  mo_energy =
[-0.91010533  1.40781893 10.33342379 48.05433198]
E1 = -3.8759066350319595  E_coul = 1.0279409438540656
cycle= 2 E= -2.84796569117789  delta_E= -3.83e-06  |g|= 0.00063  |ddm|= 0.00258
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910004874030724  LUMO = 1.40791792116419
  mo_energy =
[-0.91000487  1.40791792 10.33366295 48.05434134]
E1 = -3.8759533684535175  E_coul = 1.027987649818012
cycle= 3 E= -2.84796571863551  delta_E= -2.75e-08  |g|= 1.54e-05  |ddm|= 0.000276
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.909988147474011  LUMO = 1.40792893662929
  mo_energy =
[-0.90998815  1.40792894 10.33370915 48.05441266]
E1 = -3.8759562708003794  E_coul = 1.0279905521344617
cycle= 4 E= -2.84796571866592  delta_E= -3.04e-11  |g|= 6.74e-07  |ddm|= 9.56e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8759562708003794  E_coul = 1.0279905521344617
  HOMO = -0.90998758326576  LUMO = 1.40792933026427
  mo_energy =
[-0.90998758  1.40792933 10.33371068 48.05441492]
E1 = -3.875956381270888  E_coul = 1.0279906626049065
Extra cycle  E= -2.84796571866598  delta_E= -6.39e-14  |g|= 7.43e-08  |ddm|= 4.26e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 26.61190490619267
E1 = -3.875956381270888  E_coul = 1.0279906626049065
init E= -2.84796571866598
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.90998752803054  LUMO = 1.40792936898305
  mo_energy =
[-0.90998753  1.40792937 10.33371083 48.05441513]
E1 = -3.8759563925695404  E_coul = 1.0279906739035578
cycle= 1 E= -2.84796571866598  delta_E= -8.88e-16  |g|= 8.04e-09  |ddm|= 4.46e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8759563925695404  E_coul = 1.0279906739035578
  HOMO = -0.909987522381213  LUMO = 1.40792937295926
  mo_energy =
[-0.90998752  1.40792937 10.33371085 48.05441515]
E1 = -3.875956393748608  E_coul = 1.0279906750826244
Extra cycle  E= -2.84796571866598  delta_E= -8.88e-16  |g|= 8.6e-10  |ddm|= 4.71e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [22.52860982  6.81848268  1.50682557  0.33417087]
grad_E = [-0.0007667   0.00257598 -0.00307686  0.01081483]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:42 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  22.6677147064        1
[INPUT] 0    0    [1    /1   ]  6.83986521962        1
[INPUT] 0    0    [1    /1   ]  1.49487603461        1
[INPUT] 0    0    [1    /1   ]  0.329890815753       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [22.667714706423933, 1.0]], [0, [6.8398652196169545, 1.0]], [0, [1.4948760346148375, 1.0]], [0, [0.3298908157526811, 1.0]]]}
ecp = {}
CPU time:        71.30
Set gradient conv threshold to 3.16228e-05
cond(S) = 26.1030921480911
E1 = -3.8683141724685823  E_coul = 1.0238085861805921
init E= -2.84450558628799
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912076902593832  LUMO = 1.38509810877169
  mo_energy =
[-0.9120769   1.38509811 10.29794863 48.21988265]
E1 = -3.874821945723067  E_coul = 1.026813384931707
cycle= 1 E= -2.84800856079136  delta_E= -0.0035  |g|= 0.00895  |ddm|= 0.0349
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.910599099100288  LUMO = 1.38757505879421
  mo_energy =
[-0.9105991   1.38757506 10.30092139 48.21975669]
E1 = -3.8749569054257016  E_coul = 1.0269450949945598
cycle= 2 E= -2.84801181043114  delta_E= -3.25e-06  |g|= 0.000574  |ddm|= 0.0023
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910528195572865  LUMO = 1.38765149555892
  mo_energy =
[-0.9105282   1.3876515  10.30108174 48.21966626]
E1 = -3.874996895968827  E_coul = 1.026985063333923
cycle= 3 E= -2.8480118326349  delta_E= -2.22e-08  |g|= 1.45e-05  |ddm|= 0.000244
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.910512548631699  LUMO = 1.38766174566018
  mo_energy =
[-0.91051255  1.38766175 10.30112496 48.21973266]
E1 = -3.874999637260031  E_coul = 1.0269878045978569
cycle= 4 E= -2.84801183266217  delta_E= -2.73e-11  |g|= 6.38e-07  |ddm|= 9.08e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.874999637260031  E_coul = 1.0269878045978569
  HOMO = -0.910512014032185  LUMO = 1.38766211553586
  mo_energy =
[-0.91051201  1.38766212 10.30112641 48.2197348 ]
E1 = -3.874999742321874  E_coul = 1.0269879096596422
Extra cycle  E= -2.84801183266223  delta_E= -5.82e-14  |g|= 7.06e-08  |ddm|= 4.03e-07
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [22.66771471  6.83986522  1.49487603  0.32989082]
E = -2.848011832662232
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:42 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  22.6677147064        1
[INPUT] 0    0    [1    /1   ]  6.83986521962        1
[INPUT] 0    0    [1    /1   ]  1.49487603461        1
[INPUT] 0    0    [1    /1   ]  0.329890815753       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [22.667714706423933, 1.0]], [0, [6.8398652196169545, 1.0]], [0, [1.4948760346148375, 1.0]], [0, [0.3298908157526811, 1.0]]]}
ecp = {}
CPU time:        71.88
Set gradient conv threshold to 3.16228e-05
cond(S) = 26.1030921480911
E1 = -3.8683141724685823  E_coul = 1.0238085861805921
init E= -2.84450558628799
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912076902593832  LUMO = 1.38509810877169
  mo_energy =
[-0.9120769   1.38509811 10.29794863 48.21988265]
E1 = -3.874821945723067  E_coul = 1.026813384931707
cycle= 1 E= -2.84800856079136  delta_E= -0.0035  |g|= 0.00895  |ddm|= 0.0349
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.910599099100288  LUMO = 1.38757505879421
  mo_energy =
[-0.9105991   1.38757506 10.30092139 48.21975669]
E1 = -3.8749569054257016  E_coul = 1.0269450949945598
cycle= 2 E= -2.84801181043114  delta_E= -3.25e-06  |g|= 0.000574  |ddm|= 0.0023
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910528195572865  LUMO = 1.38765149555892
  mo_energy =
[-0.9105282   1.3876515  10.30108174 48.21966626]
E1 = -3.874996895968827  E_coul = 1.026985063333923
cycle= 3 E= -2.8480118326349  delta_E= -2.22e-08  |g|= 1.45e-05  |ddm|= 0.000244
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.910512548631699  LUMO = 1.38766174566018
  mo_energy =
[-0.91051255  1.38766175 10.30112496 48.21973266]
E1 = -3.874999637260031  E_coul = 1.0269878045978569
cycle= 4 E= -2.84801183266217  delta_E= -2.73e-11  |g|= 6.38e-07  |ddm|= 9.08e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.874999637260031  E_coul = 1.0269878045978569
  HOMO = -0.910512014032185  LUMO = 1.38766211553586
  mo_energy =
[-0.91051201  1.38766212 10.30112641 48.2197348 ]
E1 = -3.874999742321874  E_coul = 1.0269879096596422
Extra cycle  E= -2.84801183266223  delta_E= -5.82e-14  |g|= 7.06e-08  |ddm|= 4.03e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 26.1030921480911
E1 = -3.874999742321874  E_coul = 1.0269879096596422
init E= -2.84801183266223
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.910511961501293  LUMO = 1.3876621520698
  mo_energy =
[-0.91051196  1.38766215 10.30112655 48.219735  ]
E1 = -3.874999753111258  E_coul = 1.0269879204490246
cycle= 1 E= -2.84801183266223  delta_E= -1.33e-15  |g|= 7.67e-09  |ddm|= 4.24e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.874999753111258  E_coul = 1.0269879204490246
  HOMO = -0.9105119561066  LUMO = 1.38766215583712
  mo_energy =
[-0.91051196  1.38766216 10.30112657 48.21973502]
E1 = -3.8749997542419212  E_coul = 1.0269879215796893
Extra cycle  E= -2.84801183266223  delta_E= 1.33e-15  |g|= 8.24e-10  |ddm|= 4.49e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [22.66771471  6.83986522  1.49487603  0.32989082]
grad_E = [-0.00076211  0.00265085 -0.00276135  0.00344289]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:45 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  23.0387202959        1
[INPUT] 0    0    [1    /1   ]  6.91211532507        1
[INPUT] 0    0    [1    /1   ]  1.48700872904        1
[INPUT] 0    0    [1    /1   ]  0.326304241201       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [23.03872029590171, 1.0]], [0, [6.91211532506942, 1.0]], [0, [1.4870087290439107, 1.0]], [0, [0.32630424120097773, 1.0]]]}
ecp = {}
CPU time:        74.22
Set gradient conv threshold to 3.16228e-05
cond(S) = 25.38162251830414
E1 = -3.868518981397632  E_coul = 1.0237396545485087
init E= -2.84477932684912
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912145541156381  LUMO = 1.36975195571933
  mo_energy =
[-0.91214554  1.36975196 10.32703552 48.82154607]
E1 = -3.8740953129179303  E_coul = 1.0260225393162736
cycle= 1 E= -2.84807277360166  delta_E= -0.00329  |g|= 0.00853  |ddm|= 0.0322
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911026435139467  LUMO = 1.37190270872369
  mo_energy =
[-0.91102644  1.37190271 10.32906011 48.82013486]
E1 = -3.8741838952844265  E_coul = 1.026108294599343
cycle= 2 E= -2.84807560068508  delta_E= -2.83e-06  |g|= 0.000529  |ddm|= 0.00206
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910980398623657  LUMO = 1.37196042443681
  mo_energy =
[-0.9109804   1.37196042 10.32915345 48.81995818]
E1 = -3.874218149620491  E_coul = 1.026142530741523
cycle= 3 E= -2.84807561887897  delta_E= -1.82e-08  |g|= 1.37e-05  |ddm|= 0.000216
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.9109657691137  LUMO = 1.37196998326945
  mo_energy =
[-0.91096577  1.37196998 10.329194   48.82002011]
E1 = -3.8742207350144495  E_coul = 1.0261451161110395
cycle= 4 E= -2.84807561890341  delta_E= -2.44e-11  |g|= 6.13e-07  |ddm|= 8.6e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8742207350144495  E_coul = 1.0261451161110395
  HOMO = -0.910965251396211  LUMO = 1.37197033920165
  mo_energy =
[-0.91096525  1.37197034 10.32919542 48.82002218]
E1 = -3.8742208368121243  E_coul = 1.026145217908662
Extra cycle  E= -2.84807561890346  delta_E= -5.24e-14  |g|= 6.81e-08  |ddm|= 3.87e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [23.0387203   6.91211533  1.48700873  0.32630424]
E = -2.8480756189034624
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:45 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  23.0387202959        1
[INPUT] 0    0    [1    /1   ]  6.91211532507        1
[INPUT] 0    0    [1    /1   ]  1.48700872904        1
[INPUT] 0    0    [1    /1   ]  0.326304241201       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [23.03872029590171, 1.0]], [0, [6.91211532506942, 1.0]], [0, [1.4870087290439107, 1.0]], [0, [0.32630424120097773, 1.0]]]}
ecp = {}
CPU time:        74.78
Set gradient conv threshold to 3.16228e-05
cond(S) = 25.38162251830414
E1 = -3.868518981397632  E_coul = 1.0237396545485087
init E= -2.84477932684912
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912145541156381  LUMO = 1.36975195571933
  mo_energy =
[-0.91214554  1.36975196 10.32703552 48.82154607]
E1 = -3.8740953129179303  E_coul = 1.0260225393162736
cycle= 1 E= -2.84807277360166  delta_E= -0.00329  |g|= 0.00853  |ddm|= 0.0322
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911026435139467  LUMO = 1.37190270872369
  mo_energy =
[-0.91102644  1.37190271 10.32906011 48.82013486]
E1 = -3.8741838952844265  E_coul = 1.026108294599343
cycle= 2 E= -2.84807560068508  delta_E= -2.83e-06  |g|= 0.000529  |ddm|= 0.00206
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910980398623657  LUMO = 1.37196042443681
  mo_energy =
[-0.9109804   1.37196042 10.32915345 48.81995818]
E1 = -3.874218149620491  E_coul = 1.026142530741523
cycle= 3 E= -2.84807561887897  delta_E= -1.82e-08  |g|= 1.37e-05  |ddm|= 0.000216
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.9109657691137  LUMO = 1.37196998326945
  mo_energy =
[-0.91096577  1.37196998 10.329194   48.82002011]
E1 = -3.8742207350144495  E_coul = 1.0261451161110395
cycle= 4 E= -2.84807561890341  delta_E= -2.44e-11  |g|= 6.13e-07  |ddm|= 8.6e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8742207350144495  E_coul = 1.0261451161110395
  HOMO = -0.910965251396211  LUMO = 1.37197033920165
  mo_energy =
[-0.91096525  1.37197034 10.32919542 48.82002218]
E1 = -3.8742208368121243  E_coul = 1.026145217908662
Extra cycle  E= -2.84807561890346  delta_E= -5.24e-14  |g|= 6.81e-08  |ddm|= 3.87e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 25.38162251830414
E1 = -3.8742208368121243  E_coul = 1.026145217908662
init E= -2.84807561890346
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.910965200497399  LUMO = 1.371970374398
  mo_energy =
[-0.9109652   1.37197037 10.32919555 48.82002238]
E1 = -3.8742208472779978  E_coul = 1.0261452283745351
cycle= 1 E= -2.84807561890346  delta_E=    0  |g|= 7.41e-09  |ddm|= 4.08e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8742208472779978  E_coul = 1.0261452283745351
  HOMO = -0.910965195264461  LUMO = 1.37197037803191
  mo_energy =
[-0.9109652   1.37197038 10.32919557 48.8200224 ]
E1 = -3.874220848376375  E_coul = 1.0261452294729145
Extra cycle  E= -2.84807561890346  delta_E= 1.78e-15  |g|= 7.97e-10  |ddm|= 4.33e-09
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [23.0387203   6.91211533  1.48700873  0.32630424]
grad_E = [-0.00074433  0.00274482 -0.00271603 -0.00301343]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:48 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  23.8922223168        1
[INPUT] 0    0    [1    /1   ]  7.09120382167        1
[INPUT] 0    0    [1    /1   ]  1.49189818702        1
[INPUT] 0    0    [1    /1   ]  0.324223696693       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [23.89222231683997, 1.0]], [0, [7.091203821668641, 1.0]], [0, [1.4918981870207202, 1.0]], [0, [0.32422369669257567, 1.0]]]}
ecp = {}
CPU time:        77.20
Set gradient conv threshold to 3.16228e-05
cond(S) = 24.315014221944995
E1 = -3.8687001577956033  E_coul = 1.023674791476103
init E= -2.8450253663195
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91223884711565  LUMO = 1.36616047461829
  mo_energy =
[-0.91223885  1.36616047 10.49608907 50.34866712]
E1 = -3.873566284229864  E_coul = 1.025375808844284
cycle= 1 E= -2.84819047538558  delta_E= -0.00317  |g|= 0.00813  |ddm|= 0.0295
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911408459193133  LUMO = 1.36806300964697
  mo_energy =
[-0.91140846  1.36806301 10.49730935 50.34618816]
E1 = -3.8736035952858487  E_coul = 1.0254107139996498
cycle= 2 E= -2.8481928812862  delta_E= -2.41e-06  |g|= 0.000479  |ddm|= 0.00178
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.91138982530744  LUMO = 1.36810023968104
  mo_energy =
[-0.91138983  1.36810024 10.49732696 50.34591414]
E1 = -3.873631087219279  E_coul = 1.0254381919453988
cycle= 3 E= -2.84819289527388  delta_E= -1.4e-08  |g|= 1.25e-05  |ddm|= 0.000183
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911376680884269  LUMO = 1.36810887975098
  mo_energy =
[-0.91137668  1.36810888 10.4973638  50.34596989]
E1 = -3.873633420264513  E_coul = 1.0254405249705054
cycle= 4 E= -2.84819289529401  delta_E= -2.01e-11  |g|= 5.78e-07  |ddm|= 7.77e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.873633420264513  E_coul = 1.0254405249705054
  HOMO = -0.911376185161775  LUMO = 1.36810922093078
  mo_energy =
[-0.91137619  1.36810922 10.49736517 50.34597189]
E1 = -3.8736335170946234  E_coul = 1.0254406218005687
Extra cycle  E= -2.84819289529405  delta_E= -4.75e-14  |g|= 6.39e-08  |ddm|= 3.62e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [23.89222232  7.09120382  1.49189819  0.3242237 ]
E = -2.848192895294055
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:49 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  23.8922223168        1
[INPUT] 0    0    [1    /1   ]  7.09120382167        1
[INPUT] 0    0    [1    /1   ]  1.49189818702        1
[INPUT] 0    0    [1    /1   ]  0.324223696693       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [23.89222231683997, 1.0]], [0, [7.091203821668641, 1.0]], [0, [1.4918981870207202, 1.0]], [0, [0.32422369669257567, 1.0]]]}
ecp = {}
CPU time:        77.80
Set gradient conv threshold to 3.16228e-05
cond(S) = 24.315014221944995
E1 = -3.8687001577956033  E_coul = 1.023674791476103
init E= -2.8450253663195
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91223884711565  LUMO = 1.36616047461829
  mo_energy =
[-0.91223885  1.36616047 10.49608907 50.34866712]
E1 = -3.873566284229864  E_coul = 1.025375808844284
cycle= 1 E= -2.84819047538558  delta_E= -0.00317  |g|= 0.00813  |ddm|= 0.0295
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911408459193133  LUMO = 1.36806300964697
  mo_energy =
[-0.91140846  1.36806301 10.49730935 50.34618816]
E1 = -3.8736035952858487  E_coul = 1.0254107139996498
cycle= 2 E= -2.8481928812862  delta_E= -2.41e-06  |g|= 0.000479  |ddm|= 0.00178
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.91138982530744  LUMO = 1.36810023968104
  mo_energy =
[-0.91138983  1.36810024 10.49732696 50.34591414]
E1 = -3.873631087219279  E_coul = 1.0254381919453988
cycle= 3 E= -2.84819289527388  delta_E= -1.4e-08  |g|= 1.25e-05  |ddm|= 0.000183
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911376680884269  LUMO = 1.36810887975098
  mo_energy =
[-0.91137668  1.36810888 10.4973638  50.34596989]
E1 = -3.873633420264513  E_coul = 1.0254405249705054
cycle= 4 E= -2.84819289529401  delta_E= -2.01e-11  |g|= 5.78e-07  |ddm|= 7.77e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.873633420264513  E_coul = 1.0254405249705054
  HOMO = -0.911376185161775  LUMO = 1.36810922093078
  mo_energy =
[-0.91137619  1.36810922 10.49736517 50.34597189]
E1 = -3.8736335170946234  E_coul = 1.0254406218005687
Extra cycle  E= -2.84819289529405  delta_E= -4.75e-14  |g|= 6.39e-08  |ddm|= 3.62e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 24.315014221944995
E1 = -3.8736335170946234  E_coul = 1.0254406218005687
init E= -2.84819289529405
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.911376136746745  LUMO = 1.36810925446539
  mo_energy =
[-0.91137614  1.36810925 10.49736531 50.34597208]
E1 = -3.8736335269853237  E_coul = 1.0254406316912683
cycle= 1 E= -2.84819289529406  delta_E= -4.44e-16  |g|= 6.92e-09  |ddm|= 3.8e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8736335269853237  E_coul = 1.0254406316912683
  HOMO = -0.911376131801393  LUMO = 1.36810925790575
  mo_energy =
[-0.91137613  1.36810926 10.49736532 50.3459721 ]
E1 = -3.873633528016938  E_coul = 1.0254406327228822
Extra cycle  E= -2.84819289529406  delta_E= -4.44e-16  |g|= 7.41e-10  |ddm|= 4.01e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [23.89222232  7.09120382  1.49189819  0.3242237 ]
grad_E = [-0.0006986   0.0028119  -0.00253215 -0.00992014]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:51 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  25.4994385792        1
[INPUT] 0    0    [1    /1   ]  7.44111957871        1
[INPUT] 0    0    [1    /1   ]  1.52636331851        1
[INPUT] 0    0    [1    /1   ]  0.326959533948       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [25.49943857922002, 1.0]], [0, [7.441119578706086, 1.0]], [0, [1.526363318509724, 1.0]], [0, [0.32695953394819127, 1.0]]]}
ecp = {}
CPU time:        80.19
Set gradient conv threshold to 3.16228e-05
cond(S) = 23.01860693105776
E1 = -3.868784589683749  E_coul = 1.023655875154431
init E= -2.84512871452932
    CPU time for initialize scf      0.02 sec, wall time      0.03 sec
  HOMO = -0.912345145113259  LUMO = 1.39399607264008
  mo_energy =
[-0.91234515  1.39399607 10.92699518 53.38426834]
E1 = -3.873746342072467  E_coul = 1.0253653841095067
cycle= 1 E= -2.84838095796296  delta_E= -0.00325  |g|= 0.00789  |ddm|= 0.0275
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911508769119344  LUMO = 1.39593340429904
  mo_energy =
[-0.91150877  1.3959334  10.92812952 53.38175143]
E1 = -3.8737442920352727  E_coul = 1.02536124429361
cycle= 2 E= -2.84838304774166  delta_E= -2.09e-06  |g|= 0.000437  |ddm|= 0.00154
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911511054677154  LUMO = 1.3959544195364
  mo_energy =
[-0.91151105  1.39595442 10.92808509 53.38139915]
E1 = -3.8737657674483814  E_coul = 1.0253827090692107
cycle= 3 E= -2.84838305837917  delta_E= -1.06e-08  |g|= 1.1e-05  |ddm|= 0.000151
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.91149963812582  LUMO = 1.39596210674932
  mo_energy =
[-0.91149964  1.39596211 10.92811785 53.3814482 ]
E1 = -3.8737677717782417  E_coul = 1.0253847133840506
cycle= 4 E= -2.84838305839419  delta_E= -1.5e-11  |g|= 5.3e-07  |ddm|= 6.61e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8737677717782417  E_coul = 1.0253847133840506
  HOMO = -0.911499172505088  LUMO = 1.39596243350368
  mo_energy =
[-0.91149917  1.39596243 10.92811917 53.38145012]
E1 = -3.8737678608918396  E_coul = 1.0253848024976093
Extra cycle  E= -2.84838305839423  delta_E= -3.91e-14  |g|= 5.75e-08  |ddm|= 3.27e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.08 sec
exp = [25.49943858  7.44111958  1.52636332  0.32695953]
E = -2.84838305839423
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:52 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  25.4994385792        1
[INPUT] 0    0    [1    /1   ]  7.44111957871        1
[INPUT] 0    0    [1    /1   ]  1.52636331851        1
[INPUT] 0    0    [1    /1   ]  0.326959533948       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [25.49943857922002, 1.0]], [0, [7.441119578706086, 1.0]], [0, [1.526363318509724, 1.0]], [0, [0.32695953394819127, 1.0]]]}
ecp = {}
CPU time:        80.80
Set gradient conv threshold to 3.16228e-05
cond(S) = 23.01860693105776
E1 = -3.868784589683749  E_coul = 1.023655875154431
init E= -2.84512871452932
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912345145113259  LUMO = 1.39399607264008
  mo_energy =
[-0.91234515  1.39399607 10.92699518 53.38426834]
E1 = -3.873746342072467  E_coul = 1.0253653841095067
cycle= 1 E= -2.84838095796296  delta_E= -0.00325  |g|= 0.00789  |ddm|= 0.0275
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911508769119344  LUMO = 1.39593340429904
  mo_energy =
[-0.91150877  1.3959334  10.92812952 53.38175143]
E1 = -3.8737442920352727  E_coul = 1.02536124429361
cycle= 2 E= -2.84838304774166  delta_E= -2.09e-06  |g|= 0.000437  |ddm|= 0.00154
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911511054677154  LUMO = 1.3959544195364
  mo_energy =
[-0.91151105  1.39595442 10.92808509 53.38139915]
E1 = -3.8737657674483814  E_coul = 1.0253827090692107
cycle= 3 E= -2.84838305837917  delta_E= -1.06e-08  |g|= 1.1e-05  |ddm|= 0.000151
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.91149963812582  LUMO = 1.39596210674932
  mo_energy =
[-0.91149964  1.39596211 10.92811785 53.3814482 ]
E1 = -3.8737677717782417  E_coul = 1.0253847133840506
cycle= 4 E= -2.84838305839419  delta_E= -1.5e-11  |g|= 5.3e-07  |ddm|= 6.61e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8737677717782417  E_coul = 1.0253847133840506
  HOMO = -0.911499172505088  LUMO = 1.39596243350368
  mo_energy =
[-0.91149917  1.39596243 10.92811917 53.38145012]
E1 = -3.8737678608918396  E_coul = 1.0253848024976093
Extra cycle  E= -2.84838305839423  delta_E= -3.91e-14  |g|= 5.75e-08  |ddm|= 3.27e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 23.01860693105776
E1 = -3.8737678608918396  E_coul = 1.0253848024976093
init E= -2.84838305839423
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.911499127948304  LUMO = 1.39596246497679
  mo_energy =
[-0.91149913  1.39596246 10.92811929 53.3814503 ]
E1 = -3.8737678697980247  E_coul = 1.0253848114037944
cycle= 1 E= -2.84838305839423  delta_E=    0  |g|= 6.1e-09  |ddm|= 3.35e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8737678697980247  E_coul = 1.0253848114037944
  HOMO = -0.91149912349522  LUMO = 1.39596246813596
  mo_energy =
[-0.91149912  1.39596247 10.92811931 53.38145031]
E1 = -3.873767870706787  E_coul = 1.0253848123125582
Extra cycle  E= -2.84838305839423  delta_E= 8.88e-16  |g|= 6.39e-10  |ddm|= 3.46e-09
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [25.49943858  7.44111958  1.52636332  0.32695953]
grad_E = [-0.00061589  0.00275773 -0.00192806 -0.01456611]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:54 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  27.4341357952        1
[INPUT] 0    0    [1    /1   ]  7.87082186716        1
[INPUT] 0    0    [1    /1   ]  1.58947982138        1
[INPUT] 0    0    [1    /1   ]  0.336356671016       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [27.434135795241698, 1.0]], [0, [7.87082186715865, 1.0]], [0, [1.5894798213776145, 1.0]], [0, [0.3363566710163215, 1.0]]]}
ecp = {}
CPU time:        83.29
Set gradient conv threshold to 3.16228e-05
cond(S) = 22.07164710467635
E1 = -3.868603481352283  E_coul = 1.0237463542364948
init E= -2.84485712711579
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912390681426398  LUMO = 1.4591685502836
  mo_energy =
[-0.91239068  1.45916855 11.54444789 57.17776372]
E1 = -3.8751844759755785  E_coul = 1.026621206945008
cycle= 1 E= -2.84856326903057  delta_E= -0.00371  |g|= 0.00819  |ddm|= 0.0284
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.910972047908452  LUMO = 1.46169343554974
  mo_energy =
[-0.91097205  1.46169344 11.54705081 57.17729565]
E1 = -3.8752012206828352  E_coul = 1.0266357900889662
cycle= 2 E= -2.84856543059387  delta_E= -2.16e-06  |g|= 0.000445  |ddm|= 0.00153
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910964332798052  LUMO = 1.46172107047544
  mo_energy =
[-0.91096433  1.46172107 11.54702827 57.17697225]
E1 = -3.875223228154216  E_coul = 1.0266577869939355
cycle= 3 E= -2.84856544116028  delta_E= -1.06e-08  |g|= 1.04e-05  |ddm|= 0.000148
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.910953355417289  LUMO = 1.46172875336524
  mo_energy =
[-0.91095336  1.46172875 11.54706073 57.17702067]
E1 = -3.8752250970658864  E_coul = 1.0266596558925631
cycle= 4 E= -2.84856544117332  delta_E= -1.3e-11  |g|= 5.13e-07  |ddm|= 6.06e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8752250970658864  E_coul = 1.0266596558925631
  HOMO = -0.910952892640398  LUMO = 1.46172909034952
  mo_energy =
[-0.91095289  1.46172909 11.54706207 57.17702261]
E1 = -3.875225182975012  E_coul = 1.0266597418016545
Extra cycle  E= -2.84856544117336  delta_E= -3.38e-14  |g|= 5.4e-08  |ddm|= 3.09e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [27.4341358   7.87082187  1.58947982  0.33635667]
E = -2.848565441173357
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:55 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  27.4341357952        1
[INPUT] 0    0    [1    /1   ]  7.87082186716        1
[INPUT] 0    0    [1    /1   ]  1.58947982138        1
[INPUT] 0    0    [1    /1   ]  0.336356671016       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [27.434135795241698, 1.0]], [0, [7.87082186715865, 1.0]], [0, [1.5894798213776145, 1.0]], [0, [0.3363566710163215, 1.0]]]}
ecp = {}
CPU time:        83.89
Set gradient conv threshold to 3.16228e-05
cond(S) = 22.07164710467635
E1 = -3.868603481352283  E_coul = 1.0237463542364948
init E= -2.84485712711579
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912390681426398  LUMO = 1.4591685502836
  mo_energy =
[-0.91239068  1.45916855 11.54444789 57.17776372]
E1 = -3.8751844759755785  E_coul = 1.026621206945008
cycle= 1 E= -2.84856326903057  delta_E= -0.00371  |g|= 0.00819  |ddm|= 0.0284
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.910972047908452  LUMO = 1.46169343554974
  mo_energy =
[-0.91097205  1.46169344 11.54705081 57.17729565]
E1 = -3.8752012206828352  E_coul = 1.0266357900889662
cycle= 2 E= -2.84856543059387  delta_E= -2.16e-06  |g|= 0.000445  |ddm|= 0.00153
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910964332798052  LUMO = 1.46172107047544
  mo_energy =
[-0.91096433  1.46172107 11.54702827 57.17697225]
E1 = -3.875223228154216  E_coul = 1.0266577869939355
cycle= 3 E= -2.84856544116028  delta_E= -1.06e-08  |g|= 1.04e-05  |ddm|= 0.000148
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.910953355417289  LUMO = 1.46172875336524
  mo_energy =
[-0.91095336  1.46172875 11.54706073 57.17702067]
E1 = -3.8752250970658864  E_coul = 1.0266596558925631
cycle= 4 E= -2.84856544117332  delta_E= -1.3e-11  |g|= 5.13e-07  |ddm|= 6.06e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8752250970658864  E_coul = 1.0266596558925631
  HOMO = -0.910952892640398  LUMO = 1.46172909034952
  mo_energy =
[-0.91095289  1.46172909 11.54706207 57.17702261]
E1 = -3.875225182975012  E_coul = 1.0266597418016545
Extra cycle  E= -2.84856544117336  delta_E= -3.38e-14  |g|= 5.4e-08  |ddm|= 3.09e-07
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 22.07164710467635
E1 = -3.875225182975012  E_coul = 1.0266597418016545
init E= -2.84856544117336
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.910952849685849  LUMO = 1.46172912182019
  mo_energy =
[-0.91095285  1.46172912 11.5470622  57.17702279]
E1 = -3.8752251912803657  E_coul = 1.0266597501070072
cycle= 1 E= -2.84856544117336  delta_E= -1.33e-15  |g|= 5.54e-09  |ddm|= 3.06e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8752251912803657  E_coul = 1.0266597501070072
  HOMO = -0.910952845533174  LUMO = 1.46172912487536
  mo_energy =
[-0.91095285  1.46172912 11.54706221 57.17702281]
E1 = -3.875225192099565  E_coul = 1.0266597509262074
Extra cycle  E= -2.84856544117336  delta_E= 8.88e-16  |g|= 5.62e-10  |ddm|= 3.06e-09
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [27.4341358   7.87082187  1.58947982  0.33635667]
grad_E = [-0.00052894  0.00256214 -0.00131022 -0.01054483]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:57 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  28.4631365512        1
[INPUT] 0    0    [1    /1   ]  8.09890936163        1
[INPUT] 0    0    [1    /1   ]  1.63364573312        1
[INPUT] 0    0    [1    /1   ]  0.344319769376       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [28.463136551224938, 1.0]], [0, [8.098909361627145, 1.0]], [0, [1.6336457331215954, 1.0]], [0, [0.34431976937582126, 1.0]]]}
ecp = {}
CPU time:        86.34
Set gradient conv threshold to 3.16228e-05
cond(S) = 21.80303222209513
E1 = -3.8683234649866747  E_coul = 1.0238603274927212
init E= -2.84446313749395
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912364224733546  LUMO = 1.5096293637988
  mo_energy =
[-0.91236422  1.50962936 11.91742622 59.24897132]
E1 = -3.8766331749218708  E_coul = 1.028006034870452
cycle= 1 E= -2.84862714005142  delta_E= -0.00416  |g|= 0.00867  |ddm|= 0.0307
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.910311695799378  LUMO = 1.51280110178617
  mo_energy =
[-0.9103117   1.5128011  11.92173427 59.25080919]
E1 = -3.876692373843573  E_coul = 1.0280628005087686
cycle= 2 E= -2.8486295733348  delta_E= -2.43e-06  |g|= 0.000478  |ddm|= 0.00167
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910281434395805  LUMO = 1.51284615161374
  mo_energy =
[-0.91028143  1.51284615 11.92177335 59.25056387]
E1 = -3.8767182094292396  E_coul = 1.0280886238237164
cycle= 3 E= -2.84862958560552  delta_E= -1.23e-08  |g|= 1.06e-05  |ddm|= 0.000161
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.910270010991225  LUMO = 1.51285434784379
  mo_energy =
[-0.91027001  1.51285435 11.9218077  59.25061522]
E1 = -3.876720109601641  E_coul = 1.0280905239827107
cycle= 4 E= -2.84862958561893  delta_E= -1.34e-11  |g|= 5.26e-07  |ddm|= 6.08e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.876720109601641  E_coul = 1.0280905239827107
  HOMO = -0.910269530818127  LUMO = 1.5128547065018
  mo_energy =
[-0.91026953  1.51285471 11.92180912 59.25061727]
E1 = -3.8767201971148335  E_coul = 1.0280906114958663
Extra cycle  E= -2.84862958561897  delta_E= -3.73e-14  |g|= 5.42e-08  |ddm|= 3.12e-07
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [28.46313655  8.09890936  1.63364573  0.34431977]
E = -2.8486295856189674
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:10:58 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  28.4631365512        1
[INPUT] 0    0    [1    /1   ]  8.09890936163        1
[INPUT] 0    0    [1    /1   ]  1.63364573312        1
[INPUT] 0    0    [1    /1   ]  0.344319769376       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [28.463136551224938, 1.0]], [0, [8.098909361627145, 1.0]], [0, [1.6336457331215954, 1.0]], [0, [0.34431976937582126, 1.0]]]}
ecp = {}
CPU time:        86.98
Set gradient conv threshold to 3.16228e-05
cond(S) = 21.80303222209513
E1 = -3.8683234649866747  E_coul = 1.0238603274927212
init E= -2.84446313749395
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912364224733546  LUMO = 1.5096293637988
  mo_energy =
[-0.91236422  1.50962936 11.91742622 59.24897132]
E1 = -3.8766331749218708  E_coul = 1.028006034870452
cycle= 1 E= -2.84862714005142  delta_E= -0.00416  |g|= 0.00867  |ddm|= 0.0307
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.910311695799378  LUMO = 1.51280110178617
  mo_energy =
[-0.9103117   1.5128011  11.92173427 59.25080919]
E1 = -3.876692373843573  E_coul = 1.0280628005087686
cycle= 2 E= -2.8486295733348  delta_E= -2.43e-06  |g|= 0.000478  |ddm|= 0.00167
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910281434395805  LUMO = 1.51284615161374
  mo_energy =
[-0.91028143  1.51284615 11.92177335 59.25056387]
E1 = -3.8767182094292396  E_coul = 1.0280886238237164
cycle= 3 E= -2.84862958560552  delta_E= -1.23e-08  |g|= 1.06e-05  |ddm|= 0.000161
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.910270010991225  LUMO = 1.51285434784379
  mo_energy =
[-0.91027001  1.51285435 11.9218077  59.25061522]
E1 = -3.876720109601641  E_coul = 1.0280905239827107
cycle= 4 E= -2.84862958561893  delta_E= -1.34e-11  |g|= 5.26e-07  |ddm|= 6.08e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.876720109601641  E_coul = 1.0280905239827107
  HOMO = -0.910269530818127  LUMO = 1.5128547065018
  mo_energy =
[-0.91026953  1.51285471 11.92180912 59.25061727]
E1 = -3.8767201971148335  E_coul = 1.0280906114958663
Extra cycle  E= -2.84862958561897  delta_E= -3.73e-14  |g|= 5.42e-08  |ddm|= 3.12e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 21.80303222209513
E1 = -3.8767201971148335  E_coul = 1.0280906114958663
init E= -2.84862958561897
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.910269487061547  LUMO = 1.51285473937136
  mo_energy =
[-0.91026949  1.51285474 11.92180924 59.25061745]
E1 = -3.876720205404877  E_coul = 1.0280906197859103
cycle= 1 E= -2.84862958561897  delta_E= 8.88e-16  |g|= 5.46e-09  |ddm|= 3.04e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.876720205404877  E_coul = 1.0280906197859103
  HOMO = -0.910269482916531  LUMO = 1.51285474249762
  mo_energy =
[-0.91026948  1.51285474 11.92180926 59.25061746]
E1 = -3.8767202062056163  E_coul = 1.0280906205866498
Extra cycle  E= -2.84862958561897  delta_E=    0  |g|= 5.42e-10  |ddm|= 2.97e-09
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [28.46313655  8.09890936  1.63364573  0.34431977]
grad_E = [-0.0004873   0.00240579 -0.00107231 -0.0033663 ]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:00 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  28.6916742516        1
[INPUT] 0    0    [1    /1   ]  8.1433871934         1
[INPUT] 0    0    [1    /1   ]  1.64811478774        1
[INPUT] 0    0    [1    /1   ]  0.347225610815       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [28.69167425163454, 1.0]], [0, [8.143387193399628, 1.0]], [0, [1.6481147877380327, 1.0]], [0, [0.3472256108152279, 1.0]]]}
ecp = {}
CPU time:        89.41
Set gradient conv threshold to 3.16228e-05
cond(S) = 21.8180652712512
E1 = -3.8682312876505582  E_coul = 1.0239108847474907
init E= -2.84432040290307
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912350654548587  LUMO = 1.52718703797903
  mo_energy =
[-0.91235065  1.52718704 12.01371022 59.71248409]
E1 = -3.877217799992093  E_coul = 1.0285663991949905
cycle= 1 E= -2.8486514007971  delta_E= -0.00433  |g|= 0.00883  |ddm|= 0.0316
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.910043694120366  LUMO = 1.53061990900635
  mo_energy =
[-0.91004369  1.53061991 12.0187213  59.71528689]
E1 = -3.8772940510361393  E_coul = 1.0286401086273684
cycle= 2 E= -2.84865394240877  delta_E= -2.54e-06  |g|= 0.000491  |ddm|= 0.00173
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910004358690148  LUMO = 1.5306722062547
  mo_energy =
[-0.91000436  1.53067221 12.01878615 59.71507488]
E1 = -3.877321444794633  E_coul = 1.0286674893600027
cycle= 3 E= -2.84865395543463  delta_E= -1.3e-08  |g|= 1.07e-05  |ddm|= 0.000166
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.909992761002675  LUMO = 1.53068059099528
  mo_energy =
[-0.90999276  1.53068059 12.01882116 59.71512733]
E1 = -3.8773233584768887  E_coul = 1.0286694030286927
cycle= 4 E= -2.8486539554482  delta_E= -1.36e-11  |g|= 5.3e-07  |ddm|= 6.1e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8773233584768887  E_coul = 1.0286694030286927
  HOMO = -0.909992276209779  LUMO = 1.53068095612496
  mo_energy =
[-0.90999228  1.53068096 12.0188226  59.71512941]
E1 = -3.877323446374536  E_coul = 1.0286694909263043
Extra cycle  E= -2.84865395544823  delta_E= -3.6e-14  |g|= 5.43e-08  |ddm|= 3.14e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.08 sec
exp = [28.69167425  8.14338719  1.64811479  0.34722561]
E = -2.8486539554482317
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:01 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  28.6916742516        1
[INPUT] 0    0    [1    /1   ]  8.1433871934         1
[INPUT] 0    0    [1    /1   ]  1.64811478774        1
[INPUT] 0    0    [1    /1   ]  0.347225610815       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [28.69167425163454, 1.0]], [0, [8.143387193399628, 1.0]], [0, [1.6481147877380327, 1.0]], [0, [0.3472256108152279, 1.0]]]}
ecp = {}
CPU time:        90.06
Set gradient conv threshold to 3.16228e-05
cond(S) = 21.8180652712512
E1 = -3.8682312876505582  E_coul = 1.0239108847474907
init E= -2.84432040290307
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912350654548587  LUMO = 1.52718703797903
  mo_energy =
[-0.91235065  1.52718704 12.01371022 59.71248409]
E1 = -3.877217799992093  E_coul = 1.0285663991949905
cycle= 1 E= -2.8486514007971  delta_E= -0.00433  |g|= 0.00883  |ddm|= 0.0316
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.910043694120366  LUMO = 1.53061990900635
  mo_energy =
[-0.91004369  1.53061991 12.0187213  59.71528689]
E1 = -3.8772940510361393  E_coul = 1.0286401086273684
cycle= 2 E= -2.84865394240877  delta_E= -2.54e-06  |g|= 0.000491  |ddm|= 0.00173
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910004358690148  LUMO = 1.5306722062547
  mo_energy =
[-0.91000436  1.53067221 12.01878615 59.71507488]
E1 = -3.877321444794633  E_coul = 1.0286674893600027
cycle= 3 E= -2.84865395543463  delta_E= -1.3e-08  |g|= 1.07e-05  |ddm|= 0.000166
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.909992761002675  LUMO = 1.53068059099528
  mo_energy =
[-0.90999276  1.53068059 12.01882116 59.71512733]
E1 = -3.8773233584768887  E_coul = 1.0286694030286927
cycle= 4 E= -2.8486539554482  delta_E= -1.36e-11  |g|= 5.3e-07  |ddm|= 6.1e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8773233584768887  E_coul = 1.0286694030286927
  HOMO = -0.909992276209779  LUMO = 1.53068095612496
  mo_energy =
[-0.90999228  1.53068096 12.0188226  59.71512941]
E1 = -3.877323446374536  E_coul = 1.0286694909263043
Extra cycle  E= -2.84865395544823  delta_E= -3.6e-14  |g|= 5.43e-08  |ddm|= 3.14e-07
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 21.8180652712512
E1 = -3.877323446374536  E_coul = 1.0286694909263043
init E= -2.84865395544823
    CPU time for initialize scf      0.04 sec, wall time      0.05 sec
  HOMO = -0.909992232260964  LUMO = 1.53068098940779
  mo_energy =
[-0.90999223  1.53068099 12.01882273 59.71512959]
E1 = -3.8773234546520783  E_coul = 1.0286694992038454
cycle= 1 E= -2.84865395544823  delta_E= -1.33e-15  |g|= 5.43e-09  |ddm|= 3.03e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8773234546520783  E_coul = 1.0286694992038454
  HOMO = -0.909992228122194  LUMO = 1.53068099255456
  mo_energy =
[-0.90999223  1.53068099 12.01882274 59.7151296 ]
E1 = -3.877323455446699  E_coul = 1.028669499998467
Extra cycle  E= -2.84865395544823  delta_E= 8.88e-16  |g|= 5.37e-10  |ddm|= 2.95e-09
    CPU time for scf_cycle      0.10 sec, wall time      0.11 sec
exp = [28.69167425  8.14338719  1.64811479  0.34722561]
grad_E = [-0.00047723  0.00233798 -0.00089098 -0.00038626]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:04 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  28.9066331435        1
[INPUT] 0    0    [1    /1   ]  8.16012327141        1
[INPUT] 0    0    [1    /1   ]  1.66926531013        1
[INPUT] 0    0    [1    /1   ]  0.352000094569       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [28.906633143526474, 1.0]], [0, [8.160123271405526, 1.0]], [0, [1.669265310127507, 1.0]], [0, [0.3520000945685777, 1.0]]]}
ecp = {}
CPU time:        92.61
Set gradient conv threshold to 3.16228e-05
cond(S) = 21.957054758288017
E1 = -3.8681180408161353  E_coul = 1.0240054394743598
init E= -2.84411260134178
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912335952234455  LUMO = 1.55461736090113
  mo_energy =
[-0.91233595  1.55461736 12.1139231  60.11094289]
E1 = -3.8782877491190204  E_coul = 1.029570015170215
cycle= 1 E= -2.84871773394881  delta_E= -0.00461  |g|= 0.00905  |ddm|= 0.0333
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.909575143502882  LUMO = 1.55851492263427
  mo_energy =
[-0.90957514  1.55851492 12.1202043  60.11551165]
E1 = -3.8783952875335843  E_coul = 1.0296748147838888
cycle= 2 E= -2.8487204727497  delta_E= -2.74e-06  |g|= 0.000514  |ddm|= 0.00184
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.909519123862037  LUMO = 1.55858077089033
  mo_energy =
[-0.90951912  1.55858077 12.12031743 60.1153629 ]
E1 = -3.878425601358793  E_coul = 1.0297051140770674
cycle= 3 E= -2.84872048728173  delta_E= -1.45e-08  |g|= 1.08e-05  |ddm|= 0.000178
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.909507206489153  LUMO = 1.55858947761102
  mo_energy =
[-0.90950721  1.55858948 12.12035354 60.11541726]
E1 = -3.878427543789568  E_coul = 1.0297070564939197
cycle= 4 E= -2.84872048729565  delta_E= -1.39e-11  |g|= 5.38e-07  |ddm|= 6.15e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.878427543789568  E_coul = 1.0297070564939197
  HOMO = -0.909506715400884  LUMO = 1.55858985202111
  mo_energy =
[-0.90950672  1.55858985 12.120355   60.11541937]
E1 = -3.8784276322406726  E_coul = 1.0297071449449866
Extra cycle  E= -2.84872048729569  delta_E= -3.73e-14  |g|= 5.46e-08  |ddm|= 3.16e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [28.90663314  8.16012327  1.66926531  0.35200009]
E = -2.8487204872956857
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:04 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  28.9066331435        1
[INPUT] 0    0    [1    /1   ]  8.16012327141        1
[INPUT] 0    0    [1    /1   ]  1.66926531013        1
[INPUT] 0    0    [1    /1   ]  0.352000094569       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [28.906633143526474, 1.0]], [0, [8.160123271405526, 1.0]], [0, [1.669265310127507, 1.0]], [0, [0.3520000945685777, 1.0]]]}
ecp = {}
CPU time:        93.25
Set gradient conv threshold to 3.16228e-05
cond(S) = 21.957054758288017
E1 = -3.8681180408161353  E_coul = 1.0240054394743598
init E= -2.84411260134178
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912335952234455  LUMO = 1.55461736090113
  mo_energy =
[-0.91233595  1.55461736 12.1139231  60.11094289]
E1 = -3.8782877491190204  E_coul = 1.029570015170215
cycle= 1 E= -2.84871773394881  delta_E= -0.00461  |g|= 0.00905  |ddm|= 0.0333
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.909575143502882  LUMO = 1.55851492263427
  mo_energy =
[-0.90957514  1.55851492 12.1202043  60.11551165]
E1 = -3.8783952875335843  E_coul = 1.0296748147838888
cycle= 2 E= -2.8487204727497  delta_E= -2.74e-06  |g|= 0.000514  |ddm|= 0.00184
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.909519123862037  LUMO = 1.55858077089033
  mo_energy =
[-0.90951912  1.55858077 12.12031743 60.1153629 ]
E1 = -3.878425601358793  E_coul = 1.0297051140770674
cycle= 3 E= -2.84872048728173  delta_E= -1.45e-08  |g|= 1.08e-05  |ddm|= 0.000178
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.909507206489153  LUMO = 1.55858947761102
  mo_energy =
[-0.90950721  1.55858948 12.12035354 60.11541726]
E1 = -3.878427543789568  E_coul = 1.0297070564939197
cycle= 4 E= -2.84872048729565  delta_E= -1.39e-11  |g|= 5.38e-07  |ddm|= 6.15e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.878427543789568  E_coul = 1.0297070564939197
  HOMO = -0.909506715400884  LUMO = 1.55858985202111
  mo_energy =
[-0.90950672  1.55858985 12.120355   60.11541937]
E1 = -3.8784276322406726  E_coul = 1.0297071449449866
Extra cycle  E= -2.84872048729569  delta_E= -3.73e-14  |g|= 5.46e-08  |ddm|= 3.16e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 21.957054758288017
E1 = -3.8784276322406726  E_coul = 1.0297071449449866
init E= -2.84872048729569
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.909506671175349  LUMO = 1.55858988591283
  mo_energy =
[-0.90950667  1.55858989 12.12035513 60.11541955]
E1 = -3.878427640506719  E_coul = 1.029707153211035
cycle= 1 E= -2.84872048729568  delta_E= 1.78e-15  |g|= 5.42e-09  |ddm|= 3.03e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.878427640506719  E_coul = 1.029707153211035
  HOMO = -0.909506667042328  LUMO = 1.55858988909241
  mo_energy =
[-0.90950667  1.55858989 12.12035514 60.11541957]
E1 = -3.8784276412938485  E_coul = 1.0297071539981641
Extra cycle  E= -2.84872048729568  delta_E= -4.44e-16  |g|= 5.31e-10  |ddm|= 2.93e-09
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [28.90663314  8.16012327  1.66926531  0.35200009]
grad_E = [-0.00046522  0.00221102 -0.00047688  0.00503741]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:07 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  28.9715020482        1
[INPUT] 0    0    [1    /1   ]  8.08344854229        1
[INPUT] 0    0    [1    /1   ]  1.68905607611        1
[INPUT] 0    0    [1    /1   ]  0.357591261776       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [28.9715020482252, 1.0]], [0, [8.083448542291254, 1.0]], [0, [1.6890560761064775, 1.0]], [0, [0.35759126177629136, 1.0]]]}
ecp = {}
CPU time:        95.67
Set gradient conv threshold to 3.16228e-05
cond(S) = 22.252513099321515
E1 = -3.868065772065538  E_coul = 1.0241332101502345
init E= -2.8439325619153
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912344755780056  LUMO = 1.58398752913009
  mo_energy =
[-0.91234476  1.58398753 12.13189061 60.05981216]
E1 = -3.8797597037319593  E_coul = 1.030895362099798
cycle= 1 E= -2.84886434163216  delta_E= -0.00493  |g|= 0.00929  |ddm|= 0.0356
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.908985902876818  LUMO = 1.58849312859858
  mo_energy =
[-0.9089859   1.58849313 12.13985681 60.06676346]
E1 = -3.879910986182292  E_coul = 1.0310436240015883
cycle= 2 E= -2.8488673621807  delta_E= -3.02e-06  |g|= 0.000546  |ddm|= 0.00202
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.908906480064775  LUMO = 1.58857826337449
  mo_energy =
[-0.90890648  1.58857826 12.14003838 60.06670546]
E1 = -3.879945534057595  E_coul = 1.0310781549515673
cycle= 3 E= -2.84886737910603  delta_E= -1.69e-08  |g|= 1.1e-05  |ddm|= 0.000196
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.90889411440572  LUMO = 1.5885873777082
  mo_energy =
[-0.90889411  1.58858738 12.14007583 60.06676232]
E1 = -3.8799475246630735  E_coul = 1.0310801455424925
cycle= 4 E= -2.84886737912058  delta_E= -1.46e-11  |g|= 5.48e-07  |ddm|= 6.27e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8799475246630735  E_coul = 1.0310801455424925
  HOMO = -0.908893616789062  LUMO = 1.58858776153843
  mo_energy =
[-0.90889362  1.58858776 12.14007731 60.06676445]
E1 = -3.8799476138723064  E_coul = 1.0310802347516859
Extra cycle  E= -2.84886737912062  delta_E= -3.95e-14  |g|= 5.53e-08  |ddm|= 3.21e-07
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [28.97150205  8.08344854  1.68905608  0.35759126]
E = -2.8488673791206205
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:07 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  28.9715020482        1
[INPUT] 0    0    [1    /1   ]  8.08344854229        1
[INPUT] 0    0    [1    /1   ]  1.68905607611        1
[INPUT] 0    0    [1    /1   ]  0.357591261776       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [28.9715020482252, 1.0]], [0, [8.083448542291254, 1.0]], [0, [1.6890560761064775, 1.0]], [0, [0.35759126177629136, 1.0]]]}
ecp = {}
CPU time:        96.34
Set gradient conv threshold to 3.16228e-05
cond(S) = 22.252513099321515
E1 = -3.868065772065538  E_coul = 1.0241332101502345
init E= -2.8439325619153
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912344755780056  LUMO = 1.58398752913009
  mo_energy =
[-0.91234476  1.58398753 12.13189061 60.05981216]
E1 = -3.8797597037319593  E_coul = 1.030895362099798
cycle= 1 E= -2.84886434163216  delta_E= -0.00493  |g|= 0.00929  |ddm|= 0.0356
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.908985902876818  LUMO = 1.58849312859858
  mo_energy =
[-0.9089859   1.58849313 12.13985681 60.06676346]
E1 = -3.879910986182292  E_coul = 1.0310436240015883
cycle= 2 E= -2.8488673621807  delta_E= -3.02e-06  |g|= 0.000546  |ddm|= 0.00202
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.908906480064775  LUMO = 1.58857826337449
  mo_energy =
[-0.90890648  1.58857826 12.14003838 60.06670546]
E1 = -3.879945534057595  E_coul = 1.0310781549515673
cycle= 3 E= -2.84886737910603  delta_E= -1.69e-08  |g|= 1.1e-05  |ddm|= 0.000196
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.90889411440572  LUMO = 1.5885873777082
  mo_energy =
[-0.90889411  1.58858738 12.14007583 60.06676232]
E1 = -3.8799475246630735  E_coul = 1.0310801455424925
cycle= 4 E= -2.84886737912058  delta_E= -1.46e-11  |g|= 5.48e-07  |ddm|= 6.27e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8799475246630735  E_coul = 1.0310801455424925
  HOMO = -0.908893616789062  LUMO = 1.58858776153843
  mo_energy =
[-0.90889362  1.58858776 12.14007731 60.06676445]
E1 = -3.8799476138723064  E_coul = 1.0310802347516859
Extra cycle  E= -2.84886737912062  delta_E= -3.95e-14  |g|= 5.53e-08  |ddm|= 3.21e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 22.252513099321515
E1 = -3.8799476138723064  E_coul = 1.0310802347516859
init E= -2.84886737912062
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.908893572184464  LUMO = 1.58858779610642
  mo_energy =
[-0.90889357  1.5885878  12.14007744 60.06676464]
E1 = -3.8799476221625855  E_coul = 1.0310802430419652
cycle= 1 E= -2.84886737912062  delta_E=    0  |g|= 5.45e-09  |ddm|= 3.06e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8799476221625855  E_coul = 1.0310802430419652
  HOMO = -0.908893568039321  LUMO = 1.58858779933104
  mo_energy =
[-0.90889357  1.5885878  12.14007745 60.06676466]
E1 = -3.8799476229472774  E_coul = 1.0310802438266566
Extra cycle  E= -2.84886737912062  delta_E=    0  |g|= 5.31e-10  |ddm|= 2.94e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [28.97150205  8.08344854  1.68905608  0.35759126]
grad_E = [-0.00045512  0.00203371  0.00017203  0.01232968]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:10 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  28.7718560959        1
[INPUT] 0    0    [1    /1   ]  7.76259350987        1
[INPUT] 0    0    [1    /1   ]  1.70096551284        1
[INPUT] 0    0    [1    /1   ]  0.364518200227       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [28.771856095905154, 1.0]], [0, [7.762593509868616, 1.0]], [0, [1.7009655128378016, 1.0]], [0, [0.3645182002270722, 1.0]]]}
ecp = {}
CPU time:        98.77
Set gradient conv threshold to 3.16228e-05
cond(S) = 22.87459594191735
E1 = -3.868233476324876  E_coul = 1.0243215878099619
init E= -2.84391188851491
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912439508801659  LUMO = 1.61317326733333
  mo_energy =
[-0.91243951  1.61317327 11.91964941 58.96570654]
E1 = -3.8820871512031507  E_coul = 1.032844008746786
cycle= 1 E= -2.84924314245636  delta_E= -0.00533  |g|= 0.0095  |ddm|= 0.039
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.908201189516147  LUMO = 1.61854856417815
  mo_energy =
[-0.90820119  1.61854856 11.93006849 58.97624854]
E1 = -3.882308369578245  E_coul = 1.0330617445120527
cycle= 2 E= -2.84924662506619  delta_E= -3.48e-06  |g|= 0.000597  |ddm|= 0.00232
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.908084116929358  LUMO = 1.61866477900289
  mo_energy =
[-0.90808412  1.61866478 11.93035934 58.97633826]
E1 = -3.882350074733953  E_coul = 1.033103428128162
cycle= 3 E= -2.84924664660579  delta_E= -2.15e-08  |g|= 1.14e-05  |ddm|= 0.00023
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.908071071938622  LUMO = 1.61867441842971
  mo_energy =
[-0.90807107  1.61867442 11.93039837 58.97639861]
E1 = -3.882352149204728  E_coul = 1.0331055025832492
cycle= 4 E= -2.84924664662148  delta_E= -1.57e-11  |g|= 5.63e-07  |ddm|= 6.52e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.882352149204728  E_coul = 1.0331055025832492
  HOMO = -0.908070572019141  LUMO = 1.61867480728417
  mo_energy =
[-0.90807057  1.61867481 11.93039983 58.97640075]
E1 = -3.8823522389572416  E_coul = 1.033105592335722
Extra cycle  E= -2.84924664662152  delta_E= -4.09e-14  |g|= 5.66e-08  |ddm|= 3.3e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.08 sec
exp = [28.7718561   7.76259351  1.70096551  0.3645182 ]
E = -2.84924664662152
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:10 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  28.7718560959        1
[INPUT] 0    0    [1    /1   ]  7.76259350987        1
[INPUT] 0    0    [1    /1   ]  1.70096551284        1
[INPUT] 0    0    [1    /1   ]  0.364518200227       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [28.771856095905154, 1.0]], [0, [7.762593509868616, 1.0]], [0, [1.7009655128378016, 1.0]], [0, [0.3645182002270722, 1.0]]]}
ecp = {}
CPU time:        99.44
Set gradient conv threshold to 3.16228e-05
cond(S) = 22.87459594191735
E1 = -3.868233476324876  E_coul = 1.0243215878099619
init E= -2.84391188851491
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912439508801659  LUMO = 1.61317326733333
  mo_energy =
[-0.91243951  1.61317327 11.91964941 58.96570654]
E1 = -3.8820871512031507  E_coul = 1.032844008746786
cycle= 1 E= -2.84924314245636  delta_E= -0.00533  |g|= 0.0095  |ddm|= 0.039
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.908201189516147  LUMO = 1.61854856417815
  mo_energy =
[-0.90820119  1.61854856 11.93006849 58.97624854]
E1 = -3.882308369578245  E_coul = 1.0330617445120527
cycle= 2 E= -2.84924662506619  delta_E= -3.48e-06  |g|= 0.000597  |ddm|= 0.00232
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.908084116929358  LUMO = 1.61866477900289
  mo_energy =
[-0.90808412  1.61866478 11.93035934 58.97633826]
E1 = -3.882350074733953  E_coul = 1.033103428128162
cycle= 3 E= -2.84924664660579  delta_E= -2.15e-08  |g|= 1.14e-05  |ddm|= 0.00023
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.908071071938622  LUMO = 1.61867441842971
  mo_energy =
[-0.90807107  1.61867442 11.93039837 58.97639861]
E1 = -3.882352149204728  E_coul = 1.0331055025832492
cycle= 4 E= -2.84924664662148  delta_E= -1.57e-11  |g|= 5.63e-07  |ddm|= 6.52e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.882352149204728  E_coul = 1.0331055025832492
  HOMO = -0.908070572019141  LUMO = 1.61867480728417
  mo_energy =
[-0.90807057  1.61867481 11.93039983 58.97640075]
E1 = -3.8823522389572416  E_coul = 1.033105592335722
Extra cycle  E= -2.84924664662152  delta_E= -4.09e-14  |g|= 5.66e-08  |ddm|= 3.3e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 22.87459594191735
E1 = -3.8823522389572416  E_coul = 1.033105592335722
init E= -2.84924664662152
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.908070527142894  LUMO = 1.61867484233383
  mo_energy =
[-0.90807053  1.61867484 11.93039996 58.97640093]
E1 = -3.882352247305525  E_coul = 1.0331056006840054
cycle= 1 E= -2.84924664662152  delta_E=    0  |g|= 5.58e-09  |ddm|= 3.15e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.882352247305525  E_coul = 1.0331056006840054
  HOMO = -0.908070522968752  LUMO = 1.61867484560621
  mo_energy =
[-0.90807052  1.61867485 11.93039997 58.97640095]
E1 = -3.8823522480961197  E_coul = 1.033105601474599
Extra cycle  E= -2.84924664662152  delta_E= -8.88e-16  |g|= 5.44e-10  |ddm|= 3.02e-09
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [28.7718561   7.76259351  1.70096551  0.3645182 ]
grad_E = [-0.00044294  0.0017129   0.00144088  0.02314212]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:13 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  28.198371436         1
[INPUT] 0    0    [1    /1   ]  6.93133000064        1
[INPUT] 0    0    [1    /1   ]  1.67431769419        1
[INPUT] 0    0    [1    /1   ]  0.369865382513       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [28.198371435958556, 1.0]], [0, [6.931330000636596, 1.0]], [0, [1.6743176941871656, 1.0]], [0, [0.36986538251270146, 1.0]]]}
ecp = {}
CPU time:       101.91
Set gradient conv threshold to 3.16228e-05
cond(S) = 24.18342932390014
E1 = -3.8690570476054105  E_coul = 1.0245197470411547
init E= -2.84453730056426
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912752071631112  LUMO = 1.61490328800036
  mo_energy =
[-0.91275207  1.61490329 11.13898526 55.7882216 ]
E1 = -3.8849954624133414  E_coul = 1.0349320957665704
cycle= 1 E= -2.85006336664677  delta_E= -0.00553  |g|= 0.0092  |ddm|= 0.0422
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.907567474984881  LUMO = 1.62110166509556
  mo_energy =
[-0.90756747  1.62110167 11.15186191 55.80276619]
E1 = -3.885302012604704  E_coul = 1.0352346694925998
cycle= 2 E= -2.8500673431121  delta_E= -3.98e-06  |g|= 0.000655  |ddm|= 0.00275
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.907403732854039  LUMO = 1.62125445335937
  mo_energy =
[-0.90740373  1.62125445 11.1522806  55.80303861]
E1 = -3.88535345657674  E_coul = 1.0352860844502092
cycle= 3 E= -2.85006737212653  delta_E= -2.9e-08  |g|= 1.13e-05  |ddm|= 0.000286
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.907390009269087  LUMO = 1.62126438411148
  mo_energy =
[-0.90739001  1.62126438 11.15231991 55.80310199]
E1 = -3.8853556290466633  E_coul = 1.03528825690328
cycle= 4 E= -2.85006737214338  delta_E= -1.69e-11  |g|= 5.45e-07  |ddm|= 6.89e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8853556290466633  E_coul = 1.03528825690328
  HOMO = -0.907389557620063  LUMO = 1.62126473276323
  mo_energy =
[-0.90738956  1.62126473 11.15232118 55.80310388]
E1 = -3.885355712197135  E_coul = 1.035288340053718
Extra cycle  E= -2.85006737214342  delta_E= -3.38e-14  |g|= 5.57e-08  |ddm|= 3.24e-07
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [28.19837144  6.93133     1.67431769  0.36986538]
E = -2.850067372143417
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:14 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  28.198371436         1
[INPUT] 0    0    [1    /1   ]  6.93133000064        1
[INPUT] 0    0    [1    /1   ]  1.67431769419        1
[INPUT] 0    0    [1    /1   ]  0.369865382513       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [28.198371435958556, 1.0]], [0, [6.931330000636596, 1.0]], [0, [1.6743176941871656, 1.0]], [0, [0.36986538251270146, 1.0]]]}
ecp = {}
CPU time:       102.60
Set gradient conv threshold to 3.16228e-05
cond(S) = 24.18342932390014
E1 = -3.8690570476054105  E_coul = 1.0245197470411547
init E= -2.84453730056426
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912752071631112  LUMO = 1.61490328800036
  mo_energy =
[-0.91275207  1.61490329 11.13898526 55.7882216 ]
E1 = -3.8849954624133414  E_coul = 1.0349320957665704
cycle= 1 E= -2.85006336664677  delta_E= -0.00553  |g|= 0.0092  |ddm|= 0.0422
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.907567474984881  LUMO = 1.62110166509556
  mo_energy =
[-0.90756747  1.62110167 11.15186191 55.80276619]
E1 = -3.885302012604704  E_coul = 1.0352346694925998
cycle= 2 E= -2.8500673431121  delta_E= -3.98e-06  |g|= 0.000655  |ddm|= 0.00275
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.907403732854039  LUMO = 1.62125445335937
  mo_energy =
[-0.90740373  1.62125445 11.1522806  55.80303861]
E1 = -3.88535345657674  E_coul = 1.0352860844502092
cycle= 3 E= -2.85006737212653  delta_E= -2.9e-08  |g|= 1.13e-05  |ddm|= 0.000286
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.907390009269087  LUMO = 1.62126438411148
  mo_energy =
[-0.90739001  1.62126438 11.15231991 55.80310199]
E1 = -3.8853556290466633  E_coul = 1.03528825690328
cycle= 4 E= -2.85006737214338  delta_E= -1.69e-11  |g|= 5.45e-07  |ddm|= 6.89e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8853556290466633  E_coul = 1.03528825690328
  HOMO = -0.907389557620063  LUMO = 1.62126473276323
  mo_energy =
[-0.90738956  1.62126473 11.15232118 55.80310388]
E1 = -3.885355712197135  E_coul = 1.035288340053718
Extra cycle  E= -2.85006737214342  delta_E= -3.38e-14  |g|= 5.57e-08  |ddm|= 3.24e-07
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 24.18342932390014
E1 = -3.885355712197135  E_coul = 1.035288340053718
init E= -2.85006737214342
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.90738951604485  LUMO = 1.62126476493229
  mo_energy =
[-0.90738952  1.62126476 11.15232129 55.80310405]
E1 = -3.88535572012279  E_coul = 1.0352883479793715
cycle= 1 E= -2.85006737214342  delta_E= -1.33e-15  |g|= 5.59e-09  |ddm|= 3.16e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.88535572012279  E_coul = 1.0352883479793715
  HOMO = -0.907389512082026  LUMO = 1.62126476800931
  mo_energy =
[-0.90738951  1.62126477 11.15232131 55.80310406]
E1 = -3.88535572089103  E_coul = 1.0352883487476139
Extra cycle  E= -2.85006737214342  delta_E= 2.22e-15  |g|= 5.55e-10  |ddm|= 3.1e-09
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [28.19837144  6.93133     1.67431769  0.36986538]
grad_E = [-0.0004017   0.0009874   0.00415413  0.03437547]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:16 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  28.1074675749        1
[INPUT] 0    0    [1    /1   ]  5.79329085247        1
[INPUT] 0    0    [1    /1   ]  1.57689701544        1
[INPUT] 0    0    [1    /1   ]  0.366280324268       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [28.107467574870416, 1.0]], [0, [5.793290852469184, 1.0]], [0, [1.5768970154412754, 1.0]], [0, [0.36628032426820534, 1.0]]]}
ecp = {}
CPU time:       105.06
Set gradient conv threshold to 3.16228e-05
cond(S) = 26.034168517158008
E1 = -3.8706264397262977  E_coul = 1.024529345686738
init E= -2.84609709403956
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913259115242754  LUMO = 1.54858726746768
  mo_energy =
[-0.91325912  1.54858727  9.83559838 51.90959476]
E1 = -3.8861528869224293  E_coul = 1.035077071916462
cycle= 1 E= -2.85107581500597  delta_E= -0.00498  |g|= 0.0078  |ddm|= 0.0391
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.908001070293842  LUMO = 1.5545168645188
  mo_energy =
[-0.90800107  1.55451686  9.84830553 51.92473424]
E1 = -3.8864921753157415  E_coul = 1.0354126529231118
cycle= 2 E= -2.85107952239263  delta_E= -3.71e-06  |g|= 0.000653  |ddm|= 0.00296
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.907818831706584  LUMO = 1.55467675285179
  mo_energy =
[-0.90781883  1.55467675  9.84876126 51.92508352]
E1 = -3.886548858475567  E_coul = 1.035469302772817
cycle= 3 E= -2.85107955570275  delta_E= -3.33e-08  |g|= 1.18e-05  |ddm|= 0.000331
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.907804009434846  LUMO = 1.55468707953262
  mo_energy =
[-0.90780401  1.55468708  9.84880036 51.92514899]
E1 = -3.8865513717864557  E_coul = 1.0354718160610523
cycle= 4 E= -2.8510795557254  delta_E= -2.27e-11  |g|= 2.26e-07  |ddm|= 8.96e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8865513717864557  E_coul = 1.0354718160610523
  HOMO = -0.907803869832179  LUMO = 1.5546871864099
  mo_energy =
[-0.90780387  1.55468719  9.84880073 51.92514953]
E1 = -3.886551400700982  E_coul = 1.035471844975574
Extra cycle  E= -2.85107955572541  delta_E= -4.88e-15  |g|= 2.32e-08  |ddm|= 1.32e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.08 sec
exp = [28.10746757  5.79329085  1.57689702  0.36628032]
E = -2.8510795557254083
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:17 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  28.1074675749        1
[INPUT] 0    0    [1    /1   ]  5.79329085247        1
[INPUT] 0    0    [1    /1   ]  1.57689701544        1
[INPUT] 0    0    [1    /1   ]  0.366280324268       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [28.107467574870416, 1.0]], [0, [5.793290852469184, 1.0]], [0, [1.5768970154412754, 1.0]], [0, [0.36628032426820534, 1.0]]]}
ecp = {}
CPU time:       105.75
Set gradient conv threshold to 3.16228e-05
cond(S) = 26.034168517158008
E1 = -3.8706264397262977  E_coul = 1.024529345686738
init E= -2.84609709403956
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913259115242754  LUMO = 1.54858726746768
  mo_energy =
[-0.91325912  1.54858727  9.83559838 51.90959476]
E1 = -3.8861528869224293  E_coul = 1.035077071916462
cycle= 1 E= -2.85107581500597  delta_E= -0.00498  |g|= 0.0078  |ddm|= 0.0391
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.908001070293842  LUMO = 1.5545168645188
  mo_energy =
[-0.90800107  1.55451686  9.84830553 51.92473424]
E1 = -3.8864921753157415  E_coul = 1.0354126529231118
cycle= 2 E= -2.85107952239263  delta_E= -3.71e-06  |g|= 0.000653  |ddm|= 0.00296
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.907818831706584  LUMO = 1.55467675285179
  mo_energy =
[-0.90781883  1.55467675  9.84876126 51.92508352]
E1 = -3.886548858475567  E_coul = 1.035469302772817
cycle= 3 E= -2.85107955570275  delta_E= -3.33e-08  |g|= 1.18e-05  |ddm|= 0.000331
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.907804009434846  LUMO = 1.55468707953262
  mo_energy =
[-0.90780401  1.55468708  9.84880036 51.92514899]
E1 = -3.8865513717864557  E_coul = 1.0354718160610523
cycle= 4 E= -2.8510795557254  delta_E= -2.27e-11  |g|= 2.26e-07  |ddm|= 8.96e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8865513717864557  E_coul = 1.0354718160610523
  HOMO = -0.907803869832179  LUMO = 1.5546871864099
  mo_energy =
[-0.90780387  1.55468719  9.84880073 51.92514953]
E1 = -3.886551400700982  E_coul = 1.035471844975574
Extra cycle  E= -2.85107955572541  delta_E= -4.88e-15  |g|= 2.32e-08  |ddm|= 1.32e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 26.034168517158008
E1 = -3.886551400700982  E_coul = 1.035471844975574
init E= -2.85107955572541
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.907803855374917  LUMO = 1.5546871972581
  mo_energy =
[-0.90780386  1.5546872   9.84880076 51.92514958]
E1 = -3.886551403714132  E_coul = 1.0354718479887237
cycle= 1 E= -2.85107955572541  delta_E=    0  |g|= 2.42e-09  |ddm|= 1.36e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.886551403714132  E_coul = 1.0354718479887237
  HOMO = -0.907803853868348  LUMO = 1.55468719838558
  mo_energy =
[-0.90780385  1.5546872   9.84880077 51.92514959]
E1 = -3.886551404028045  E_coul = 1.0354718483026373
Extra cycle  E= -2.85107955572541  delta_E= 4.44e-16  |g|= 2.51e-10  |ddm|= 1.41e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.08 sec
exp = [28.10746757  5.79329085  1.57689702  0.36628032]
grad_E = [-0.00023968 -0.00067045  0.00840317  0.03460135]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:20 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  30.3549712           1
[INPUT] 0    0    [1    /1   ]  5.68315807618        1
[INPUT] 0    0    [1    /1   ]  1.48602142175        1
[INPUT] 0    0    [1    /1   ]  0.35440614417        1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [30.35497120001699, 1.0]], [0, [5.683158076179064, 1.0]], [0, [1.4860214217464058, 1.0]], [0, [0.35440614417041527, 1.0]]]}
ecp = {}
CPU time:       108.43
Set gradient conv threshold to 3.16228e-05
cond(S) = 23.756399192134673
E1 = -3.8726141757920227  E_coul = 1.024382866872183
init E= -2.84823130891984
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.914059929420439  LUMO = 1.46363357215161
  mo_energy =
[-0.91405993  1.46363357  9.43876174 53.79022057]
E1 = -3.886526674714884  E_coul = 1.0339910342019236
cycle= 1 E= -2.85253564051296  delta_E= -0.0043  |g|= 0.00783  |ddm|= 0.0382
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.909274174820154  LUMO = 1.46880133691885
  mo_energy =
[-0.90927417  1.46880134  9.45028387 53.80361403]
E1 = -3.8869379956185517  E_coul = 1.034398249223378
cycle= 2 E= -2.85253974639517  delta_E= -4.11e-06  |g|= 0.000693  |ddm|= 0.00318
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.909052119525126  LUMO = 1.46898264528897
  mo_energy =
[-0.90905212  1.46898265  9.45083908 53.80410622]
E1 = -3.887005385955602  E_coul = 1.0344655982980462
cycle= 3 E= -2.85253978765756  delta_E= -4.13e-08  |g|= 1.29e-05  |ddm|= 0.000374
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.909035794102623  LUMO = 1.46899351495154
  mo_energy =
[-0.90903579  1.46899351  9.45088149 53.80417852]
E1 = -3.88700823367097  E_coul = 1.034468445984758
cycle= 4 E= -2.85253978768621  delta_E= -2.87e-11  |g|= 2.02e-07  |ddm|= 1.02e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.88700823367097  E_coul = 1.034468445984758
  HOMO = -0.90903567085073  LUMO = 1.46899360592192
  mo_energy =
[-0.90903567  1.46899361  9.45088181 53.80417899]
E1 = -3.8870082602490035  E_coul = 1.0344684725627873
Extra cycle  E= -2.85253978768622  delta_E= -4e-15  |g|= 2.16e-08  |ddm|= 1.21e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [30.3549712   5.68315808  1.48602142  0.35440614]
E = -2.852539787686216
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:20 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  30.3549712           1
[INPUT] 0    0    [1    /1   ]  5.68315807618        1
[INPUT] 0    0    [1    /1   ]  1.48602142175        1
[INPUT] 0    0    [1    /1   ]  0.35440614417        1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [30.35497120001699, 1.0]], [0, [5.683158076179064, 1.0]], [0, [1.4860214217464058, 1.0]], [0, [0.35440614417041527, 1.0]]]}
ecp = {}
CPU time:       109.11
Set gradient conv threshold to 3.16228e-05
cond(S) = 23.756399192134673
E1 = -3.8726141757920227  E_coul = 1.024382866872183
init E= -2.84823130891984
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.914059929420439  LUMO = 1.46363357215161
  mo_energy =
[-0.91405993  1.46363357  9.43876174 53.79022057]
E1 = -3.886526674714884  E_coul = 1.0339910342019236
cycle= 1 E= -2.85253564051296  delta_E= -0.0043  |g|= 0.00783  |ddm|= 0.0382
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.909274174820154  LUMO = 1.46880133691885
  mo_energy =
[-0.90927417  1.46880134  9.45028387 53.80361403]
E1 = -3.8869379956185517  E_coul = 1.034398249223378
cycle= 2 E= -2.85253974639517  delta_E= -4.11e-06  |g|= 0.000693  |ddm|= 0.00318
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.909052119525126  LUMO = 1.46898264528897
  mo_energy =
[-0.90905212  1.46898265  9.45083908 53.80410622]
E1 = -3.887005385955602  E_coul = 1.0344655982980462
cycle= 3 E= -2.85253978765756  delta_E= -4.13e-08  |g|= 1.29e-05  |ddm|= 0.000374
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.909035794102623  LUMO = 1.46899351495154
  mo_energy =
[-0.90903579  1.46899351  9.45088149 53.80417852]
E1 = -3.88700823367097  E_coul = 1.034468445984758
cycle= 4 E= -2.85253978768621  delta_E= -2.87e-11  |g|= 2.02e-07  |ddm|= 1.02e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.88700823367097  E_coul = 1.034468445984758
  HOMO = -0.90903567085073  LUMO = 1.46899360592192
  mo_energy =
[-0.90903567  1.46899361  9.45088181 53.80417899]
E1 = -3.8870082602490035  E_coul = 1.0344684725627873
Extra cycle  E= -2.85253978768622  delta_E= -4e-15  |g|= 2.16e-08  |ddm|= 1.21e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 23.756399192134673
E1 = -3.8870082602490035  E_coul = 1.0344684725627873
init E= -2.85253978768622
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.909035657561717  LUMO = 1.46899361546538
  mo_energy =
[-0.90903566  1.46899362  9.45088185 53.80417904]
E1 = -3.887008263126239  E_coul = 1.0344684754400235
cycle= 1 E= -2.85253978768622  delta_E= 8.88e-16  |g|= 2.33e-09  |ddm|= 1.29e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.887008263126239  E_coul = 1.0344684754400235
  HOMO = -0.909035656123103  LUMO = 1.46899361649568
  mo_energy =
[-0.90903566  1.46899362  9.45088185 53.80417904]
E1 = -3.887008263437189  E_coul = 1.0344684757509728
Extra cycle  E= -2.85253978768622  delta_E= -1.33e-15  |g|= 2.5e-10  |ddm|= 1.39e-09
    CPU time for scf_cycle      0.08 sec, wall time      0.09 sec
exp = [30.3549712   5.68315808  1.48602142  0.35440614]
grad_E = [-0.000147   -0.00090968  0.00701574  0.03442355]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:23 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  40.2737915702        1
[INPUT] 0    0    [1    /1   ]  6.27759866528        1
[INPUT] 0    0    [1    /1   ]  1.1340041644         1
[INPUT] 0    0    [1    /1   ]  0.2922519544         1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [40.2737915701582, 1.0]], [0, [6.277598665283614, 1.0]], [0, [1.1340041644023355, 1.0]], [0, [0.2922519543999531, 1.0]]]}
ecp = {}
CPU time:       111.80
Set gradient conv threshold to 3.16228e-05
cond(S) = 15.46678000047229
E1 = -3.867440717006268  E_coul = 1.0221591036526696
init E= -2.8452816133536
    CPU time for initialize scf      0.02 sec, wall time      0.03 sec
  HOMO = -0.914702995573004  LUMO = 1.08151451671795
  mo_energy =
[-0.914703    1.08151452  8.6699781  65.8036396 ]
E1 = -3.879252034290272  E_coul = 1.0274360295796237
cycle= 1 E= -2.85181600471065  delta_E= -0.00653  |g|= 0.0195  |ddm|= 0.0721
    CPU time for cycle= 1      0.01 sec, wall time      0.02 sec
  HOMO = -0.912201203618337  LUMO = 1.08446061863407
  mo_energy =
[-0.9122012   1.08446062  8.67585021 65.80145799]
E1 = -3.880503059525706  E_coul = 1.028662090095827
cycle= 2 E= -2.85184096942988  delta_E= -2.5e-05  |g|= 0.00173  |ddm|= 0.00797
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
  HOMO = -0.911540686349432  LUMO = 1.08487073235287
  mo_energy =
[-0.91154069  1.08487073  8.67752617 65.80315732]
E1 = -3.880733872911592  E_coul = 1.028892547136688
cycle= 3 E= -2.8518413257749  delta_E= -3.56e-07  |g|= 8.61e-05  |ddm|= 0.00112
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911468282573948  LUMO = 1.08490975833864
  mo_energy =
[-0.91146828  1.08490976  8.67771435 65.80344925]
E1 = -3.8807512519840084  E_coul = 1.028909924959415
cycle= 4 E= -2.85184132702459  delta_E= -1.25e-09  |g|= 2.76e-06  |ddm|= 7.02e-05
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
  HOMO = -0.911465375641156  LUMO = 1.08491131790399
  mo_energy =
[-0.91146538  1.08491132  8.67772195 65.80346184]
E1 = -3.8807519029558657  E_coul = 1.028910575929766
cycle= 5 E= -2.8518413270261  delta_E= -1.51e-12  |g|= 1.05e-10  |ddm|= 2.54e-06
    CPU time for cycle= 5      0.01 sec, wall time      0.02 sec
E1 = -3.8807519029558657  E_coul = 1.028910575929766
  HOMO = -0.911465375548167  LUMO = 1.08491131769177
  mo_energy =
[-0.91146538  1.08491132  8.67772195 65.80346184]
E1 = -3.8807519029853106  E_coul = 1.028910575959209
Extra cycle  E= -2.8518413270261  delta_E= -1.78e-15  |g|= 1.15e-11  |ddm|= 8.56e-11
    CPU time for scf_cycle      0.11 sec, wall time      0.12 sec
exp = [40.27379157  6.27759867  1.13400416  0.29225195]
E = -2.8518413270261016
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:24 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  34.8402880885        1
[INPUT] 0    0    [1    /1   ]  5.95196568777        1
[INPUT] 0    0    [1    /1   ]  1.32683828399        1
[INPUT] 0    0    [1    /1   ]  0.326299854646       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [34.8402880884813, 1.0]], [0, [5.9519656877702145, 1.0]], [0, [1.32683828398647, 1.0]], [0, [0.3262998546457567, 1.0]]]}
ecp = {}
CPU time:       112.58
Set gradient conv threshold to 3.16228e-05
cond(S) = 19.055150199293678
E1 = -3.8748146949069815  E_coul = 1.0238818096846822
init E= -2.8509328852223
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91526643447869  LUMO = 1.29060010172987
  mo_energy =
[-0.91526643  1.2906001   9.11022286 59.1704288 ]
E1 = -3.8859512837749266  E_coul = 1.0314663386170488
cycle= 1 E= -2.85448494515788  delta_E= -0.00355  |g|= 0.0103  |ddm|= 0.0452
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911512706599326  LUMO = 1.29443551326925
  mo_energy =
[-0.91151271  1.29443551  9.11927461 59.17880175]
E1 = -3.8866071958179553  E_coul = 1.0321147347211153
cycle= 2 E= -2.85449246109684  delta_E= -7.52e-06  |g|= 0.00094  |ddm|= 0.00432
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911154834253038  LUMO = 1.29469378834021
  mo_energy =
[-0.91115483  1.29469379  9.12017787 59.17971768]
E1 = -3.8867172172169333  E_coul = 1.0322246678670735
cycle= 3 E= -2.85449254934986  delta_E= -8.83e-08  |g|= 1.71e-05  |ddm|= 0.000552
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911132827298212  LUMO = 1.29470677244127
  mo_energy =
[-0.91113283  1.29470677  9.12023547 59.17981933]
E1 = -3.886721057296747  E_coul = 1.0322285078973095
cycle= 4 E= -2.85449254939944  delta_E= -4.96e-11  |g|= 9.34e-07  |ddm|= 1.27e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.886721057296747  E_coul = 1.0322285078973095
  HOMO = -0.911132020751128  LUMO = 1.2947072819903
  mo_energy =
[-0.91113202  1.29470728  9.12023757 59.17982272]
E1 = -3.8867212227020205  E_coul = 1.0322286733024468
Extra cycle  E= -2.85449254939957  delta_E= -1.36e-13  |g|= 1.14e-07  |ddm|= 6.52e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [34.84028809  5.95196569  1.32683828  0.32629985]
E = -2.8544925493995734
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:25 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  34.8402880885        1
[INPUT] 0    0    [1    /1   ]  5.95196568777        1
[INPUT] 0    0    [1    /1   ]  1.32683828399        1
[INPUT] 0    0    [1    /1   ]  0.326299854646       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [34.8402880884813, 1.0]], [0, [5.9519656877702145, 1.0]], [0, [1.32683828398647, 1.0]], [0, [0.3262998546457567, 1.0]]]}
ecp = {}
CPU time:       113.26
Set gradient conv threshold to 3.16228e-05
cond(S) = 19.055150199293678
E1 = -3.8748146949069815  E_coul = 1.0238818096846822
init E= -2.8509328852223
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91526643447869  LUMO = 1.29060010172987
  mo_energy =
[-0.91526643  1.2906001   9.11022286 59.1704288 ]
E1 = -3.8859512837749266  E_coul = 1.0314663386170488
cycle= 1 E= -2.85448494515788  delta_E= -0.00355  |g|= 0.0103  |ddm|= 0.0452
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911512706599326  LUMO = 1.29443551326925
  mo_energy =
[-0.91151271  1.29443551  9.11927461 59.17880175]
E1 = -3.8866071958179553  E_coul = 1.0321147347211153
cycle= 2 E= -2.85449246109684  delta_E= -7.52e-06  |g|= 0.00094  |ddm|= 0.00432
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911154834253038  LUMO = 1.29469378834021
  mo_energy =
[-0.91115483  1.29469379  9.12017787 59.17971768]
E1 = -3.8867172172169333  E_coul = 1.0322246678670735
cycle= 3 E= -2.85449254934986  delta_E= -8.83e-08  |g|= 1.71e-05  |ddm|= 0.000552
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911132827298212  LUMO = 1.29470677244127
  mo_energy =
[-0.91113283  1.29470677  9.12023547 59.17981933]
E1 = -3.886721057296747  E_coul = 1.0322285078973095
cycle= 4 E= -2.85449254939944  delta_E= -4.96e-11  |g|= 9.34e-07  |ddm|= 1.27e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.886721057296747  E_coul = 1.0322285078973095
  HOMO = -0.911132020751128  LUMO = 1.2947072819903
  mo_energy =
[-0.91113202  1.29470728  9.12023757 59.17982272]
E1 = -3.8867212227020205  E_coul = 1.0322286733024468
Extra cycle  E= -2.85449254939957  delta_E= -1.36e-13  |g|= 1.14e-07  |ddm|= 6.52e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 19.055150199293678
E1 = -3.8867212227020205  E_coul = 1.0322286733024468
init E= -2.85449254939957
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.911131938048563  LUMO = 1.29470733476649
  mo_energy =
[-0.91113194  1.29470733  9.12023778 59.17982305]
E1 = -3.8867212407949916  E_coul = 1.0322286913954162
cycle= 1 E= -2.85449254939958  delta_E= -1.78e-15  |g|= 1.34e-08  |ddm|= 7.44e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8867212407949916  E_coul = 1.0322286913954162
  HOMO = -0.911131929002083  LUMO = 1.2947073405877
  mo_energy =
[-0.91113193  1.29470734  9.1202378  59.17982309]
E1 = -3.8867212428340867  E_coul = 1.0322286934345082
Extra cycle  E= -2.85449254939958  delta_E= -3.55e-15  |g|= 1.56e-09  |ddm|= 8.56e-09
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [34.84028809  5.95196569  1.32683828  0.32629985]
grad_E = [-0.00012566  0.00095046 -0.00551417  0.04249649]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:27 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  36.3971890086        1
[INPUT] 0    0    [1    /1   ]  5.39377410265        1
[INPUT] 0    0    [1    /1   ]  1.1788326829         1
[INPUT] 0    0    [1    /1   ]  0.298477921553       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [36.39718900861592, 1.0]], [0, [5.39377410264994, 1.0]], [0, [1.1788326829017408, 1.0]], [0, [0.2984779215526799, 1.0]]]}
ecp = {}
CPU time:       115.79
Set gradient conv threshold to 3.16228e-05
cond(S) = 18.119125937308514
E1 = -3.876495643628178  E_coul = 1.0235939049868503
init E= -2.85290173864133
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.915663683188282  LUMO = 1.12919556380203
  mo_energy =
[-0.91566368  1.12919556  8.06545829 58.60625472]
E1 = -3.882960701558807  E_coul = 1.0279916182839928
cycle= 1 E= -2.85496908327481  delta_E= -0.00207  |g|= 0.00813  |ddm|= 0.0346
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.913491296008991  LUMO = 1.13139913161017
  mo_energy =
[-0.9134913   1.13139913  8.07057753 58.60846216]
E1 = -3.883538122759374  E_coul = 1.0285633223684363
cycle= 2 E= -2.85497480039094  delta_E= -5.72e-06  |g|= 0.000839  |ddm|= 0.00391
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.913174605336158  LUMO = 1.13160648200688
  mo_energy =
[-0.91317461  1.13160648  8.07135023 58.60922432]
E1 = -3.883645321048302  E_coul = 1.028670439373101
cycle= 3 E= -2.8549748816752  delta_E= -8.13e-08  |g|= 1.91e-05  |ddm|= 0.000549
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.913150155012336  LUMO = 1.13161961851344
  mo_energy =
[-0.91315016  1.13161962  8.07141044 58.6093328 ]
E1 = -3.8836500774053024  E_coul = 1.0286751956542028
cycle= 4 E= -2.8549748817511  delta_E= -7.59e-11  |g|= 4.57e-07  |ddm|= 1.73e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8836500774053024  E_coul = 1.0286751956542028
  HOMO = -0.913149843048458  LUMO = 1.13161980238591
  mo_energy =
[-0.91314984  1.1316198   8.07141121 58.60933402]
E1 = -3.8836501516192707  E_coul = 1.0286752698681394
Extra cycle  E= -2.85497488175113  delta_E= -3.15e-14  |g|= 5.82e-08  |ddm|= 3.2e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [36.39718901  5.3937741   1.17883268  0.29847792]
E = -2.854974881751131
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:28 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  36.3971890086        1
[INPUT] 0    0    [1    /1   ]  5.39377410265        1
[INPUT] 0    0    [1    /1   ]  1.1788326829         1
[INPUT] 0    0    [1    /1   ]  0.298477921553       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [36.39718900861592, 1.0]], [0, [5.39377410264994, 1.0]], [0, [1.1788326829017408, 1.0]], [0, [0.2984779215526799, 1.0]]]}
ecp = {}
CPU time:       116.46
Set gradient conv threshold to 3.16228e-05
cond(S) = 18.119125937308514
E1 = -3.876495643628178  E_coul = 1.0235939049868503
init E= -2.85290173864133
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.915663683188282  LUMO = 1.12919556380203
  mo_energy =
[-0.91566368  1.12919556  8.06545829 58.60625472]
E1 = -3.882960701558807  E_coul = 1.0279916182839928
cycle= 1 E= -2.85496908327481  delta_E= -0.00207  |g|= 0.00813  |ddm|= 0.0346
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.913491296008991  LUMO = 1.13139913161017
  mo_energy =
[-0.9134913   1.13139913  8.07057753 58.60846216]
E1 = -3.883538122759374  E_coul = 1.0285633223684363
cycle= 2 E= -2.85497480039094  delta_E= -5.72e-06  |g|= 0.000839  |ddm|= 0.00391
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.913174605336158  LUMO = 1.13160648200688
  mo_energy =
[-0.91317461  1.13160648  8.07135023 58.60922432]
E1 = -3.883645321048302  E_coul = 1.028670439373101
cycle= 3 E= -2.8549748816752  delta_E= -8.13e-08  |g|= 1.91e-05  |ddm|= 0.000549
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.913150155012336  LUMO = 1.13161961851344
  mo_energy =
[-0.91315016  1.13161962  8.07141044 58.6093328 ]
E1 = -3.8836500774053024  E_coul = 1.0286751956542028
cycle= 4 E= -2.8549748817511  delta_E= -7.59e-11  |g|= 4.57e-07  |ddm|= 1.73e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8836500774053024  E_coul = 1.0286751956542028
  HOMO = -0.913149843048458  LUMO = 1.13161980238591
  mo_energy =
[-0.91314984  1.1316198   8.07141121 58.60933402]
E1 = -3.8836501516192707  E_coul = 1.0286752698681394
Extra cycle  E= -2.85497488175113  delta_E= -3.15e-14  |g|= 5.82e-08  |ddm|= 3.2e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 18.119125937308514
E1 = -3.8836501516192707  E_coul = 1.0286752698681394
init E= -2.85497488175113
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.913149805941498  LUMO = 1.13161982396972
  mo_energy =
[-0.91314981  1.13161982  8.0714113  58.60933416]
E1 = -3.883650160765513  E_coul = 1.0286752790143845
cycle= 1 E= -2.85497488175113  delta_E= 2.66e-15  |g|= 7.34e-09  |ddm|= 3.99e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.883650160765513  E_coul = 1.0286752790143845
  HOMO = -0.913149801368373  LUMO = 1.13161982663614
  mo_energy =
[-0.9131498   1.13161983  8.07141131 58.60933417]
E1 = -3.883650161904618  E_coul = 1.0286752801534875
Extra cycle  E= -2.85497488175113  delta_E= -1.78e-15  |g|= 9.22e-10  |ddm|= 5e-09
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [36.39718901  5.3937741   1.17883268  0.29847792]
grad_E = [ 1.54205857e-05 -8.70009513e-07 -6.10275303e-03  2.65772111e-02]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:30 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  36.8929086349        1
[INPUT] 0    0    [1    /1   ]  5.66906509911        1
[INPUT] 0    0    [1    /1   ]  1.22549207625        1
[INPUT] 0    0    [1    /1   ]  0.296523592037       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [36.89290863492353, 1.0]], [0, [5.6690650991099325, 1.0]], [0, [1.2254920762466703, 1.0]], [0, [0.29652359203653356, 1.0]]]}
ecp = {}
CPU time:       119.01
Set gradient conv threshold to 3.16228e-05
cond(S) = 17.355314692202633
E1 = -3.877172744089277  E_coul = 1.0236738632268476
init E= -2.85349888086243
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.915724809975345  LUMO = 1.14724047715886
  mo_energy =
[-0.91572481  1.14724048  8.44055838 60.21848452]
E1 = -3.8817486867876365  E_coul = 1.02660274430096
cycle= 1 E= -2.85514594248668  delta_E= -0.00165  |g|= 0.00571  |ddm|= 0.0227
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914272732013105  LUMO = 1.14889365126619
  mo_energy =
[-0.91427273  1.14889365  8.44391374 60.21909606]
E1 = -3.8820769134267072  E_coul = 1.0269284599367254
cycle= 2 E= -2.85514845348998  delta_E= -2.51e-06  |g|= 0.000553  |ddm|= 0.00243
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914094304316719  LUMO = 1.1490172181045
  mo_energy =
[-0.9140943   1.14901722  8.44435431 60.21944198]
E1 = -3.8821412929522126  E_coul = 1.0269928073455723
cycle= 3 E= -2.85514848560664  delta_E= -3.21e-08  |g|= 1.52e-05  |ddm|= 0.000329
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914076131743499  LUMO = 1.14902744031156
  mo_energy =
[-0.91407613  1.14902744  8.44440028 60.21952119]
E1 = -3.8821448837726185  E_coul = 1.0269963981215116
cycle= 4 E= -2.85514848565111  delta_E= -4.45e-11  |g|= 1.45e-07  |ddm|= 1.32e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8821448837726185  E_coul = 1.0269963981215116
  HOMO = -0.914076043764797  LUMO = 1.14902749487572
  mo_energy =
[-0.91407604  1.14902749  8.4444005  60.21952152]
E1 = -3.882144905380534  E_coul = 1.026996419729422
Extra cycle  E= -2.85514848565111  delta_E= -5.33e-15  |g|= 1.75e-08  |ddm|= 9.36e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.08 sec
exp = [36.89290863  5.6690651   1.22549208  0.29652359]
E = -2.855148485651112
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:31 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  36.8929086349        1
[INPUT] 0    0    [1    /1   ]  5.66906509911        1
[INPUT] 0    0    [1    /1   ]  1.22549207625        1
[INPUT] 0    0    [1    /1   ]  0.296523592037       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [36.89290863492353, 1.0]], [0, [5.6690650991099325, 1.0]], [0, [1.2254920762466703, 1.0]], [0, [0.29652359203653356, 1.0]]]}
ecp = {}
CPU time:       119.70
Set gradient conv threshold to 3.16228e-05
cond(S) = 17.355314692202633
E1 = -3.877172744089277  E_coul = 1.0236738632268476
init E= -2.85349888086243
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.915724809975345  LUMO = 1.14724047715886
  mo_energy =
[-0.91572481  1.14724048  8.44055838 60.21848452]
E1 = -3.8817486867876365  E_coul = 1.02660274430096
cycle= 1 E= -2.85514594248668  delta_E= -0.00165  |g|= 0.00571  |ddm|= 0.0227
    CPU time for cycle= 1      0.01 sec, wall time      0.02 sec
  HOMO = -0.914272732013105  LUMO = 1.14889365126619
  mo_energy =
[-0.91427273  1.14889365  8.44391374 60.21909606]
E1 = -3.8820769134267072  E_coul = 1.0269284599367254
cycle= 2 E= -2.85514845348998  delta_E= -2.51e-06  |g|= 0.000553  |ddm|= 0.00243
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
  HOMO = -0.914094304316719  LUMO = 1.1490172181045
  mo_energy =
[-0.9140943   1.14901722  8.44435431 60.21944198]
E1 = -3.8821412929522126  E_coul = 1.0269928073455723
cycle= 3 E= -2.85514848560664  delta_E= -3.21e-08  |g|= 1.52e-05  |ddm|= 0.000329
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914076131743499  LUMO = 1.14902744031156
  mo_energy =
[-0.91407613  1.14902744  8.44440028 60.21952119]
E1 = -3.8821448837726185  E_coul = 1.0269963981215116
cycle= 4 E= -2.85514848565111  delta_E= -4.45e-11  |g|= 1.45e-07  |ddm|= 1.32e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8821448837726185  E_coul = 1.0269963981215116
  HOMO = -0.914076043764797  LUMO = 1.14902749487572
  mo_energy =
[-0.91407604  1.14902749  8.4444005  60.21952152]
E1 = -3.882144905380534  E_coul = 1.026996419729422
Extra cycle  E= -2.85514848565111  delta_E= -5.33e-15  |g|= 1.75e-08  |ddm|= 9.36e-08
    CPU time for scf_cycle      0.08 sec, wall time      0.09 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 17.355314692202633
E1 = -3.882144905380534  E_coul = 1.026996419729422
init E= -2.85514848565111
    CPU time for initialize scf      0.04 sec, wall time      0.04 sec
  HOMO = -0.914076032960851  LUMO = 1.14902750138018
  mo_energy =
[-0.91407603  1.1490275   8.44440053 60.21952156]
E1 = -3.88214490803208  E_coul = 1.0269964223809696
cycle= 1 E= -2.85514848565111  delta_E= 1.78e-15  |g|= 2.13e-09  |ddm|= 1.14e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.88214490803208  E_coul = 1.0269964223809696
  HOMO = -0.914076031635067  LUMO = 1.14902750217642
  mo_energy =
[-0.91407603  1.1490275   8.44440053 60.21952157]
E1 = -3.882144908356229  E_coul = 1.0269964227051163
Extra cycle  E= -2.85514848565111  delta_E= -2.66e-15  |g|= 2.6e-10  |ddm|= 1.38e-09
    CPU time for scf_cycle      0.09 sec, wall time      0.09 sec
exp = [36.89290863  5.6690651   1.22549208  0.29652359]
grad_E = [-2.10436195e-05  1.77553495e-04 -1.04987333e-03  3.35271665e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:34 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  37.1421890847        1
[INPUT] 0    0    [1    /1   ]  5.65551898742        1
[INPUT] 0    0    [1    /1   ]  1.22556362104        1
[INPUT] 0    0    [1    /1   ]  0.295307769072       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [37.1421890847311, 1.0]], [0, [5.655518987423034, 1.0]], [0, [1.2255636210395244, 1.0]], [0, [0.29530776907167533, 1.0]]]}
ecp = {}
CPU time:       122.26
Set gradient conv threshold to 3.16228e-05
cond(S) = 17.27576835313926
E1 = -3.8772837443787287  E_coul = 1.023682445171425
init E= -2.8536012992073
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.915725878062874  LUMO = 1.14378980580911
  mo_energy =
[-0.91572588  1.14378981  8.42398191 60.4626508 ]
E1 = -3.881445167496704  E_coul = 1.0262929168148376
cycle= 1 E= -2.85515225068187  delta_E= -0.00155  |g|= 0.00515  |ddm|= 0.0199
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914430573820355  LUMO = 1.14530620461213
  mo_energy =
[-0.91443057  1.1453062   8.42695864 60.46287341]
E1 = -3.8817245879037663  E_coul = 1.026570328822475
cycle= 2 E= -2.85515425908129  delta_E= -2.01e-06  |g|= 0.000495  |ddm|= 0.00214
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914279403771991  LUMO = 1.14541199087145
  mo_energy =
[-0.9142794   1.14541199  8.42733127 60.46313801]
E1 = -3.8817808235892994  E_coul = 1.0266265391378457
cycle= 3 E= -2.85515428445145  delta_E= -2.54e-08  |g|= 1.56e-05  |ddm|= 0.00029
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914262084501707  LUMO = 1.14542183619023
  mo_energy =
[-0.91426208  1.14542184  8.42737499 60.46321189]
E1 = -3.8817843590892136  E_coul = 1.026630074593226
cycle= 4 E= -2.85515428449599  delta_E= -4.45e-11  |g|= 4.37e-08  |ddm|= 1.33e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8817843590892136  E_coul = 1.026630074593226
  HOMO = -0.914262104951382  LUMO = 1.1454218241533
  mo_energy =
[-0.9142621   1.14542182  8.42737494 60.46321183]
E1 = -3.8817843534596883  E_coul = 1.0266300689636996
Extra cycle  E= -2.85515428449599  delta_E= -1.33e-15  |g|= 5.05e-09  |ddm|= 2.61e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.08 sec
exp = [37.14218908  5.65551899  1.22556362  0.29530777]
E = -2.8551542844959887
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:34 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  37.1421890847        1
[INPUT] 0    0    [1    /1   ]  5.65551898742        1
[INPUT] 0    0    [1    /1   ]  1.22556362104        1
[INPUT] 0    0    [1    /1   ]  0.295307769072       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [37.1421890847311, 1.0]], [0, [5.655518987423034, 1.0]], [0, [1.2255636210395244, 1.0]], [0, [0.29530776907167533, 1.0]]]}
ecp = {}
CPU time:       122.99
Set gradient conv threshold to 3.16228e-05
cond(S) = 17.27576835313926
E1 = -3.8772837443787287  E_coul = 1.023682445171425
init E= -2.8536012992073
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.915725878062874  LUMO = 1.14378980580911
  mo_energy =
[-0.91572588  1.14378981  8.42398191 60.4626508 ]
E1 = -3.881445167496704  E_coul = 1.0262929168148376
cycle= 1 E= -2.85515225068187  delta_E= -0.00155  |g|= 0.00515  |ddm|= 0.0199
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914430573820355  LUMO = 1.14530620461213
  mo_energy =
[-0.91443057  1.1453062   8.42695864 60.46287341]
E1 = -3.8817245879037663  E_coul = 1.026570328822475
cycle= 2 E= -2.85515425908129  delta_E= -2.01e-06  |g|= 0.000495  |ddm|= 0.00214
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914279403771991  LUMO = 1.14541199087145
  mo_energy =
[-0.9142794   1.14541199  8.42733127 60.46313801]
E1 = -3.8817808235892994  E_coul = 1.0266265391378457
cycle= 3 E= -2.85515428445145  delta_E= -2.54e-08  |g|= 1.56e-05  |ddm|= 0.00029
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914262084501707  LUMO = 1.14542183619023
  mo_energy =
[-0.91426208  1.14542184  8.42737499 60.46321189]
E1 = -3.8817843590892136  E_coul = 1.026630074593226
cycle= 4 E= -2.85515428449599  delta_E= -4.45e-11  |g|= 4.37e-08  |ddm|= 1.33e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8817843590892136  E_coul = 1.026630074593226
  HOMO = -0.914262104951382  LUMO = 1.1454218241533
  mo_energy =
[-0.9142621   1.14542182  8.42737494 60.46321183]
E1 = -3.8817843534596883  E_coul = 1.0266300689636996
Extra cycle  E= -2.85515428449599  delta_E= -1.33e-15  |g|= 5.05e-09  |ddm|= 2.61e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 17.27576835313926
E1 = -3.8817843534596883  E_coul = 1.0266300689636996
init E= -2.85515428449599
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.914262107766146  LUMO = 1.14542182243359
  mo_energy =
[-0.91426211  1.14542182  8.42737494 60.46321182]
E1 = -3.881784352737187  E_coul = 1.0266300682411986
cycle= 1 E= -2.85515428449599  delta_E= 4.44e-16  |g|= 6.06e-10  |ddm|= 3.18e-09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.881784352737187  E_coul = 1.0266300682411986
  HOMO = -0.914262108127396  LUMO = 1.14542182221545
  mo_energy =
[-0.91426211  1.14542182  8.42737494 60.46321182]
E1 = -3.881784352647303  E_coul = 1.0266300681513123
Extra cycle  E= -2.85515428449599  delta_E= -2.66e-15  |g|= 7.32e-11  |ddm|= 3.88e-10
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [37.14218908  5.65551899  1.22556362  0.29530777]
grad_E = [-8.23724349e-06 -4.56839159e-05  3.87263870e-04 -1.33236809e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:37 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  37.4991293716        1
[INPUT] 0    0    [1    /1   ]  5.68536610006        1
[INPUT] 0    0    [1    /1   ]  1.22561713367        1
[INPUT] 0    0    [1    /1   ]  0.294923167805       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [37.499129371602585, 1.0]], [0, [5.685366100055272, 1.0]], [0, [1.225617133665785, 1.0]], [0, [0.29492316780460825, 1.0]]]}
ecp = {}
CPU time:       125.42
Set gradient conv threshold to 3.16228e-05
cond(S) = 17.126670439701392
E1 = -3.877278678336738  E_coul = 1.0236696973070802
init E= -2.85360898102966
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91573335207369  LUMO = 1.14260212953567
  mo_energy =
[-0.91573335  1.14260213  8.44868341 60.97411965]
E1 = -3.881390512648321  E_coul = 1.0262358002331993
cycle= 1 E= -2.85515471241512  delta_E= -0.00155  |g|= 0.00518  |ddm|= 0.02
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914460371819191  LUMO = 1.14410424106269
  mo_energy =
[-0.91446037  1.14410424  8.45160338 60.97420622]
E1 = -3.881670517447692  E_coul = 1.026513777402405
cycle= 2 E= -2.85515674004529  delta_E= -2.03e-06  |g|= 0.000497  |ddm|= 0.00215
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914308843511088  LUMO = 1.14421028970938
  mo_energy =
[-0.91430884  1.14421029  8.45197725 60.97446941]
E1 = -3.8817270031875357  E_coul = 1.0265702375959298
cycle= 3 E= -2.85515676559161  delta_E= -2.55e-08  |g|= 1.54e-05  |ddm|= 0.000291
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914291488224156  LUMO = 1.14422014175223
  mo_energy =
[-0.91429149  1.14422014  8.45202117 60.97454375]
E1 = -3.881730532532732  E_coul = 1.0265737668969963
cycle= 4 E= -2.85515676563574  delta_E= -4.41e-11  |g|= 2.22e-08  |ddm|= 1.32e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.881730532532732  E_coul = 1.0265737668969963
  HOMO = -0.914291499369371  LUMO = 1.14422013570044
  mo_energy =
[-0.9142915   1.14422014  8.45202115 60.97454372]
E1 = -3.881730529569615  E_coul = 1.0265737639338812
Extra cycle  E= -2.85515676563573  delta_E= 1.78e-15  |g|= 2.59e-09  |ddm|= 1.35e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [37.49912937  5.6853661   1.22561713  0.29492317]
E = -2.8551567656357335
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:38 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  37.4991293716        1
[INPUT] 0    0    [1    /1   ]  5.68536610006        1
[INPUT] 0    0    [1    /1   ]  1.22561713367        1
[INPUT] 0    0    [1    /1   ]  0.294923167805       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [37.499129371602585, 1.0]], [0, [5.685366100055272, 1.0]], [0, [1.225617133665785, 1.0]], [0, [0.29492316780460825, 1.0]]]}
ecp = {}
CPU time:       126.17
Set gradient conv threshold to 3.16228e-05
cond(S) = 17.126670439701392
E1 = -3.877278678336738  E_coul = 1.0236696973070802
init E= -2.85360898102966
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91573335207369  LUMO = 1.14260212953567
  mo_energy =
[-0.91573335  1.14260213  8.44868341 60.97411965]
E1 = -3.881390512648321  E_coul = 1.0262358002331993
cycle= 1 E= -2.85515471241512  delta_E= -0.00155  |g|= 0.00518  |ddm|= 0.02
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914460371819191  LUMO = 1.14410424106269
  mo_energy =
[-0.91446037  1.14410424  8.45160338 60.97420622]
E1 = -3.881670517447692  E_coul = 1.026513777402405
cycle= 2 E= -2.85515674004529  delta_E= -2.03e-06  |g|= 0.000497  |ddm|= 0.00215
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914308843511088  LUMO = 1.14421028970938
  mo_energy =
[-0.91430884  1.14421029  8.45197725 60.97446941]
E1 = -3.8817270031875357  E_coul = 1.0265702375959298
cycle= 3 E= -2.85515676559161  delta_E= -2.55e-08  |g|= 1.54e-05  |ddm|= 0.000291
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914291488224156  LUMO = 1.14422014175223
  mo_energy =
[-0.91429149  1.14422014  8.45202117 60.97454375]
E1 = -3.881730532532732  E_coul = 1.0265737668969963
cycle= 4 E= -2.85515676563574  delta_E= -4.41e-11  |g|= 2.22e-08  |ddm|= 1.32e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.881730532532732  E_coul = 1.0265737668969963
  HOMO = -0.914291499369371  LUMO = 1.14422013570044
  mo_energy =
[-0.9142915   1.14422014  8.45202115 60.97454372]
E1 = -3.881730529569615  E_coul = 1.0265737639338812
Extra cycle  E= -2.85515676563573  delta_E= 1.78e-15  |g|= 2.59e-09  |ddm|= 1.35e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 17.126670439701392
E1 = -3.881730529569615  E_coul = 1.0265737639338812
init E= -2.85515676563573
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.914291500850925  LUMO = 1.14422013479918
  mo_energy =
[-0.9142915   1.14422013  8.45202114 60.97454372]
E1 = -3.88173052919368  E_coul = 1.026573763557947
cycle= 1 E= -2.85515676563573  delta_E= 4.44e-16  |g|= 3.11e-10  |ddm|= 1.64e-09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.88173052919368  E_coul = 1.026573763557947
  HOMO = -0.914291501038893  LUMO = 1.14422013468589
  mo_energy =
[-0.9142915   1.14422013  8.45202114 60.97454372]
E1 = -3.881730529147132  E_coul = 1.0265737635113958
Extra cycle  E= -2.85515676563574  delta_E= -3.11e-15  |g|= 3.77e-11  |ddm|= 2e-10
    CPU time for scf_cycle      0.07 sec, wall time      0.08 sec
exp = [37.49912937  5.6853661   1.22561713  0.29492317]
grad_E = [-6.56847822e-06  1.91136660e-05  3.61536314e-05 -1.50005406e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:40 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  37.9383409725        1
[INPUT] 0    0    [1    /1   ]  5.72353808108        1
[INPUT] 0    0    [1    /1   ]  1.23086526566        1
[INPUT] 0    0    [1    /1   ]  0.295928087095       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [37.9383409725072, 1.0]], [0, [5.72353808108076, 1.0]], [0, [1.2308652656649302, 1.0]], [0, [0.29592808709511276, 1.0]]]}
ecp = {}
CPU time:       128.62
Set gradient conv threshold to 3.16228e-05
cond(S) = 17.035667938397477
E1 = -3.8772455834750423  E_coul = 1.0236708324375914
init E= -2.85357475103745
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.915733696579646  LUMO = 1.1484147380143
  mo_energy =
[-0.9157337   1.14841474  8.501718   61.63121588]
E1 = -3.8815070317829012  E_coul = 1.0263498363216441
cycle= 1 E= -2.85515719546126  delta_E= -0.00158  |g|= 0.00528  |ddm|= 0.0204
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914404628075032  LUMO = 1.14996733458981
  mo_energy =
[-0.91440463  1.14996733  8.50477369 61.63145731]
E1 = -3.881794831337517  E_coul = 1.026635536082835
cycle= 2 E= -2.85515929525468  delta_E= -2.1e-06  |g|= 0.000505  |ddm|= 0.00218
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914248854065931  LUMO = 1.15007645009723
  mo_energy =
[-0.91424885  1.15007645  8.50515881 61.63173302]
E1 = -3.881852326869344  E_coul = 1.0266930052934402
cycle= 3 E= -2.8551593215759  delta_E= -2.63e-08  |g|= 1.54e-05  |ddm|= 0.000295
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914231387461426  LUMO = 1.15008640061425
  mo_energy =
[-0.91423139  1.1500864   8.50520316 61.63180818]
E1 = -3.8818558598599706  E_coul = 1.0266965382400002
cycle= 4 E= -2.85515932161997  delta_E= -4.41e-11  |g|= 7.63e-09  |ddm|= 1.32e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8818558598599706  E_coul = 1.0266965382400002
  HOMO = -0.914231391689982  LUMO = 1.15008639895291
  mo_energy =
[-0.91423139  1.1500864   8.50520315 61.63180817]
E1 = -3.8818558587951664  E_coul = 1.026696537175195
Extra cycle  E= -2.85515932161997  delta_E= -8.88e-16  |g|= 8.99e-10  |ddm|= 4.72e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [37.93834097  5.72353808  1.23086527  0.29592809]
E = -2.855159321619971
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:41 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  37.9383409725        1
[INPUT] 0    0    [1    /1   ]  5.72353808108        1
[INPUT] 0    0    [1    /1   ]  1.23086526566        1
[INPUT] 0    0    [1    /1   ]  0.295928087095       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [37.9383409725072, 1.0]], [0, [5.72353808108076, 1.0]], [0, [1.2308652656649302, 1.0]], [0, [0.29592808709511276, 1.0]]]}
ecp = {}
CPU time:       129.31
Set gradient conv threshold to 3.16228e-05
cond(S) = 17.035667938397477
E1 = -3.8772455834750423  E_coul = 1.0236708324375914
init E= -2.85357475103745
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.915733696579646  LUMO = 1.1484147380143
  mo_energy =
[-0.9157337   1.14841474  8.501718   61.63121588]
E1 = -3.8815070317829012  E_coul = 1.0263498363216441
cycle= 1 E= -2.85515719546126  delta_E= -0.00158  |g|= 0.00528  |ddm|= 0.0204
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914404628075032  LUMO = 1.14996733458981
  mo_energy =
[-0.91440463  1.14996733  8.50477369 61.63145731]
E1 = -3.881794831337517  E_coul = 1.026635536082835
cycle= 2 E= -2.85515929525468  delta_E= -2.1e-06  |g|= 0.000505  |ddm|= 0.00218
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914248854065931  LUMO = 1.15007645009723
  mo_energy =
[-0.91424885  1.15007645  8.50515881 61.63173302]
E1 = -3.881852326869344  E_coul = 1.0266930052934402
cycle= 3 E= -2.8551593215759  delta_E= -2.63e-08  |g|= 1.54e-05  |ddm|= 0.000295
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914231387461426  LUMO = 1.15008640061425
  mo_energy =
[-0.91423139  1.1500864   8.50520316 61.63180818]
E1 = -3.8818558598599706  E_coul = 1.0266965382400002
cycle= 4 E= -2.85515932161997  delta_E= -4.41e-11  |g|= 7.63e-09  |ddm|= 1.32e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8818558598599706  E_coul = 1.0266965382400002
  HOMO = -0.914231391689982  LUMO = 1.15008639895291
  mo_energy =
[-0.91423139  1.1500864   8.50520315 61.63180817]
E1 = -3.8818558587951664  E_coul = 1.026696537175195
Extra cycle  E= -2.85515932161997  delta_E= -8.88e-16  |g|= 8.99e-10  |ddm|= 4.72e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 17.035667938397477
E1 = -3.8818558587951664  E_coul = 1.026696537175195
init E= -2.85515932161997
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.914231392222389  LUMO = 1.15008639862932
  mo_energy =
[-0.91423139  1.1500864   8.50520315 61.63180817]
E1 = -3.881855858662505  E_coul = 1.0266965370425338
cycle= 1 E= -2.85515932161997  delta_E=    0  |g|= 1.08e-10  |ddm|= 5.72e-10
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.881855858662505  E_coul = 1.0266965370425338
  HOMO = -0.91423139228872  LUMO = 1.15008639858926
  mo_energy =
[-0.91423139  1.1500864   8.50520315 61.63180816]
E1 = -3.881855858646226  E_coul = 1.026696537026256
Extra cycle  E= -2.85515932161997  delta_E= 8.88e-16  |g|= 1.31e-11  |ddm|= 6.94e-11
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [37.93834097  5.72353808  1.23086527  0.29592809]
grad_E = [-2.86223490e-06  2.43613067e-05 -1.32176728e-04 -6.26531746e-04]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:43 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  38.3413219281        1
[INPUT] 0    0    [1    /1   ]  5.76591463977        1
[INPUT] 0    0    [1    /1   ]  1.23895148687        1
[INPUT] 0    0    [1    /1   ]  0.297411433622       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [38.341321928089265, 1.0]], [0, [5.765914639771817, 1.0]], [0, [1.238951486874122, 1.0]], [0, [0.29741143362199673, 1.0]]]}
ecp = {}
CPU time:       131.76
Set gradient conv threshold to 3.16228e-05
cond(S) = 16.975583270783574
E1 = -3.877210695230902  E_coul = 1.0236800485930584
init E= -2.85353064663784
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.915729489793868  LUMO = 1.15718687888851
  mo_energy =
[-0.91572949  1.15718688  8.56898915 62.2711675 ]
E1 = -3.8816550628417965  E_coul = 1.0264967589708263
cycle= 1 E= -2.85515830387097  delta_E= -0.00163  |g|= 0.00534  |ddm|= 0.0207
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914331735982041  LUMO = 1.15880180410823
  mo_energy =
[-0.91433174  1.1588018   8.57221215 62.27164778]
E1 = -3.8819467236514855  E_coul = 1.0267862876040348
cycle= 2 E= -2.85516043604745  delta_E= -2.13e-06  |g|= 0.000509  |ddm|= 0.00219
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914173910527051  LUMO = 1.15891277107897
  mo_energy =
[-0.91417391  1.15891277  8.5726032  62.27193034]
E1 = -3.8820044293867797  E_coul = 1.0268439668633544
cycle= 3 E= -2.85516046252343  delta_E= -2.65e-08  |g|= 1.53e-05  |ddm|= 0.000295
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914156492222578  LUMO = 1.15892275841426
  mo_energy =
[-0.91415649  1.15892276  8.57264761 62.27200552]
E1 = -3.8820079360746154  E_coul = 1.0268474735078064
cycle= 4 E= -2.85516046256681  delta_E= -4.34e-11  |g|= 3.74e-09  |ddm|= 1.31e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8820079360746154  E_coul = 1.0268474735078064
  HOMO = -0.914156494529504  LUMO = 1.15892275796499
  mo_energy =
[-0.91415649  1.15892276  8.57264761 62.27200552]
E1 = -3.8820079355287787  E_coul = 1.0268474729619712
Extra cycle  E= -2.85516046256681  delta_E= 1.33e-15  |g|= 4.45e-10  |ddm|= 2.36e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [38.34132193  5.76591464  1.23895149  0.29741143]
E = -2.8551604625668077
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:44 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  38.3413219281        1
[INPUT] 0    0    [1    /1   ]  5.76591463977        1
[INPUT] 0    0    [1    /1   ]  1.23895148687        1
[INPUT] 0    0    [1    /1   ]  0.297411433622       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [38.341321928089265, 1.0]], [0, [5.765914639771817, 1.0]], [0, [1.238951486874122, 1.0]], [0, [0.29741143362199673, 1.0]]]}
ecp = {}
CPU time:       132.45
Set gradient conv threshold to 3.16228e-05
cond(S) = 16.975583270783574
E1 = -3.877210695230902  E_coul = 1.0236800485930584
init E= -2.85353064663784
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.915729489793868  LUMO = 1.15718687888851
  mo_energy =
[-0.91572949  1.15718688  8.56898915 62.2711675 ]
E1 = -3.8816550628417965  E_coul = 1.0264967589708263
cycle= 1 E= -2.85515830387097  delta_E= -0.00163  |g|= 0.00534  |ddm|= 0.0207
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914331735982041  LUMO = 1.15880180410823
  mo_energy =
[-0.91433174  1.1588018   8.57221215 62.27164778]
E1 = -3.8819467236514855  E_coul = 1.0267862876040348
cycle= 2 E= -2.85516043604745  delta_E= -2.13e-06  |g|= 0.000509  |ddm|= 0.00219
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914173910527051  LUMO = 1.15891277107897
  mo_energy =
[-0.91417391  1.15891277  8.5726032  62.27193034]
E1 = -3.8820044293867797  E_coul = 1.0268439668633544
cycle= 3 E= -2.85516046252343  delta_E= -2.65e-08  |g|= 1.53e-05  |ddm|= 0.000295
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914156492222578  LUMO = 1.15892275841426
  mo_energy =
[-0.91415649  1.15892276  8.57264761 62.27200552]
E1 = -3.8820079360746154  E_coul = 1.0268474735078064
cycle= 4 E= -2.85516046256681  delta_E= -4.34e-11  |g|= 3.74e-09  |ddm|= 1.31e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8820079360746154  E_coul = 1.0268474735078064
  HOMO = -0.914156494529504  LUMO = 1.15892275796499
  mo_energy =
[-0.91415649  1.15892276  8.57264761 62.27200552]
E1 = -3.8820079355287787  E_coul = 1.0268474729619712
Extra cycle  E= -2.85516046256681  delta_E= 1.33e-15  |g|= 4.45e-10  |ddm|= 2.36e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 16.975583270783574
E1 = -3.8820079355287787  E_coul = 1.0268474729619712
init E= -2.85516046256681
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.914156494802419  LUMO = 1.15892275779887
  mo_energy =
[-0.91415649  1.15892276  8.57264761 62.27200552]
E1 = -3.8820079354621075  E_coul = 1.0268474728953005
cycle= 1 E= -2.85516046256681  delta_E= 8.88e-16  |g|= 5.36e-11  |ddm|= 2.84e-10
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8820079354621075  E_coul = 1.0268474728953005
  HOMO = -0.914156494835763  LUMO = 1.15892275777865
  mo_energy =
[-0.91415649  1.15892276  8.57264761 62.27200552]
E1 = -3.882007935454024  E_coul = 1.0268474728872141
Extra cycle  E= -2.85516046256681  delta_E= -2.66e-15  |g|= 6.45e-12  |ddm|= 3.43e-11
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [38.34132193  5.76591464  1.23895149  0.29741143]
grad_E = [-3.25927364e-08  6.29074438e-06 -5.78127890e-05  3.13540659e-05]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:47 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  38.3591685221        1
[INPUT] 0    0    [1    /1   ]  5.76903542933        1
[INPUT] 0    0    [1    /1   ]  1.2398891408         1
[INPUT] 0    0    [1    /1   ]  0.297569059027       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [38.35916852206472, 1.0]], [0, [5.769035429325704, 1.0]], [0, [1.2398891407953898, 1.0]], [0, [0.297569059027083, 1.0]]]}
ecp = {}
CPU time:       135.02
Set gradient conv threshold to 3.16228e-05
cond(S) = 16.976518449826358
E1 = -3.8772091267422857  E_coul = 1.0236819187142496
init E= -2.85352720802804
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91572859829955  LUMO = 1.15816197781243
  mo_energy =
[-0.9157286   1.15816198  8.57517845 62.30577936]
E1 = -3.8816671229674684  E_coul = 1.026508795257956
cycle= 1 E= -2.85515832770951  delta_E= -0.00163  |g|= 0.00533  |ddm|= 0.0206
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914325726551004  LUMO = 1.15978164229947
  mo_energy =
[-0.91432573  1.15978164  8.578414   62.3062848 ]
E1 = -3.8819581124217275  E_coul = 1.0267976597681108
cycle= 2 E= -2.85516045265362  delta_E= -2.12e-06  |g|= 0.000508  |ddm|= 0.00219
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914168280479624  LUMO = 1.15989242341582
  mo_energy =
[-0.91416828  1.15989242  8.57880417 62.3065664 ]
E1 = -3.882015660207473  E_coul = 1.0268551812028128
cycle= 3 E= -2.85516047900466  delta_E= -2.64e-08  |g|= 1.53e-05  |ddm|= 0.000294
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914150895593945  LUMO = 1.1599024005008
  mo_energy =
[-0.9141509   1.1599024   8.57884851 62.30664143]
E1 = -3.882019160026768  E_coul = 1.0268586809788733
cycle= 4 E= -2.85516047904789  delta_E= -4.32e-11  |g|= 6.02e-09  |ddm|= 1.3e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.882019160026768  E_coul = 1.0268586809788733
  HOMO = -0.914150899034512  LUMO = 1.15990239932873
  mo_energy =
[-0.9141509   1.1599024   8.5788485  62.30664142]
E1 = -3.8820191591799897  E_coul = 1.0268586801320956
Extra cycle  E= -2.85516047904789  delta_E=    0  |g|= 7.08e-10  |ddm|= 3.72e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [38.35916852  5.76903543  1.23988914  0.29756906]
E = -2.8551604790478944
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(4)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:11:47 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  38.3591685221        1
[INPUT] 0    0    [1    /1   ]  5.76903542933        1
[INPUT] 0    0    [1    /1   ]  1.2398891408         1
[INPUT] 0    0    [1    /1   ]  0.297569059027       1

nuclear repulsion = 0
number of shells = 4
number of NR pGTOs = 4
number of NR cGTOs = 4
basis = {'He': [[0, [38.35916852206472, 1.0]], [0, [5.769035429325704, 1.0]], [0, [1.2398891407953898, 1.0]], [0, [0.297569059027083, 1.0]]]}
ecp = {}
CPU time:       135.73
Set gradient conv threshold to 3.16228e-05
cond(S) = 16.976518449826358
E1 = -3.8772091267422857  E_coul = 1.0236819187142496
init E= -2.85352720802804
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91572859829955  LUMO = 1.15816197781243
  mo_energy =
[-0.9157286   1.15816198  8.57517845 62.30577936]
E1 = -3.8816671229674684  E_coul = 1.026508795257956
cycle= 1 E= -2.85515832770951  delta_E= -0.00163  |g|= 0.00533  |ddm|= 0.0206
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914325726551004  LUMO = 1.15978164229947
  mo_energy =
[-0.91432573  1.15978164  8.578414   62.3062848 ]
E1 = -3.8819581124217275  E_coul = 1.0267976597681108
cycle= 2 E= -2.85516045265362  delta_E= -2.12e-06  |g|= 0.000508  |ddm|= 0.00219
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914168280479624  LUMO = 1.15989242341582
  mo_energy =
[-0.91416828  1.15989242  8.57880417 62.3065664 ]
E1 = -3.882015660207473  E_coul = 1.0268551812028128
cycle= 3 E= -2.85516047900466  delta_E= -2.64e-08  |g|= 1.53e-05  |ddm|= 0.000294
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914150895593945  LUMO = 1.1599024005008
  mo_energy =
[-0.9141509   1.1599024   8.57884851 62.30664143]
E1 = -3.882019160026768  E_coul = 1.0268586809788733
cycle= 4 E= -2.85516047904789  delta_E= -4.32e-11  |g|= 6.02e-09  |ddm|= 1.3e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.882019160026768  E_coul = 1.0268586809788733
  HOMO = -0.914150899034512  LUMO = 1.15990239932873
  mo_energy =
[-0.9141509   1.1599024   8.5788485  62.30664142]
E1 = -3.8820191591799897  E_coul = 1.0268586801320956
Extra cycle  E= -2.85516047904789  delta_E=    0  |g|= 7.08e-10  |ddm|= 3.72e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 16.976518449826358
E1 = -3.8820191591799897  E_coul = 1.0268586801320956
init E= -2.85516047904789
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.9141508994579  LUMO = 1.15990239906995
  mo_energy =
[-0.9141509   1.1599024   8.5788485  62.30664142]
E1 = -3.8820191590754676  E_coul = 1.0268586800275716
cycle= 1 E= -2.8551604790479  delta_E= -1.78e-15  |g|= 8.48e-11  |ddm|= 4.48e-10
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8820191590754676  E_coul = 1.0268586800275716
  HOMO = -0.914150899510165  LUMO = 1.15990239903818
  mo_energy =
[-0.9141509   1.1599024   8.5788485  62.30664142]
E1 = -3.88201915906273  E_coul = 1.0268586800148363
Extra cycle  E= -2.85516047904789  delta_E= 2.22e-15  |g|= 1.02e-11  |ddm|= 5.41e-11
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [38.35916852  5.76903543  1.23988914  0.29756906]
grad_E = [ 4.82976254e-08  6.62723002e-07 -7.54012894e-06  8.78078523e-06]
 message: Optimization terminated successfully
 success: True
  status: 0
     fun: -2.8551604790478944
       x: [ 3.836e+01  5.769e+00  1.240e+00  2.976e-01]
     nit: 49
     jac: [ 4.830e-08  6.627e-07 -7.540e-06  8.781e-06]
    nfev: 57
    njev: 49
