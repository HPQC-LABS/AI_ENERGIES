#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:16:50 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.5                  1
[INPUT] 0    0    [1    /1   ]  2                    1
[INPUT] 0    0    [1    /1   ]  1.5                  1
[INPUT] 0    0    [1    /1   ]  1                    1
[INPUT] 0    0    [1    /1   ]  0.5                  1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [2.5, 1.0]], [0, [2.0, 1.0]], [0, [1.5, 1.0]], [0, [1.0, 1.0]], [0, [0.5, 1.0]]]}
ecp = {}
CPU time:         1.35
Set gradient conv threshold to 3.16228e-05
cond(S) = 378590.17957338446
E1 = -3.7746062585721467  E_coul = 1.0189813309456763
init E= -2.75562492762647
    CPU time for initialize scf      0.11 sec, wall time      0.11 sec
  HOMO = -0.876344617365818  LUMO = 1.12456103053976
  mo_energy =
[-0.87634462  1.12456103  3.68270862  8.74245069 16.19041383]
E1 = -3.7886643582534636  E_coul = 1.0163544137295824
cycle= 1 E= -2.77230994452388  delta_E= -0.0167  |g|= 0.0266  |ddm|=  352
    CPU time for cycle= 1      0.25 sec, wall time      0.25 sec
  HOMO = -0.87800579394393  LUMO = 1.12913231194683
  mo_energy =
[-0.87800579  1.12913231  3.68663323  8.74532471 16.18681823]
E1 = -3.788171299581449  E_coul = 1.01579957874051
cycle= 2 E= -2.77237172084094  delta_E= -6.18e-05  |g|= 0.0024  |ddm|= 21.4
    CPU time for cycle= 2      0.07 sec, wall time      0.07 sec
  HOMO = -0.878311728358986  LUMO = 1.12920321191474
  mo_energy =
[-0.87831173  1.12920321  3.68661838  8.74520516 16.18609351]
E1 = -3.788248464501732  E_coul = 1.0158759638364994
cycle= 3 E= -2.77237250066523  delta_E= -7.8e-07  |g|= 0.000129  |ddm|=  2.1
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.878236208109043  LUMO = 1.12923729378648
  mo_energy =
[-0.87823621  1.12923729  3.68669304  8.74531173 16.18624591]
E1 = -3.788269006318214  E_coul = 1.0158965024928368
cycle= 4 E= -2.77237250382538  delta_E= -3.16e-09  |g|= 5.57e-06  |ddm|= 0.0748
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.878238195383851  LUMO = 1.12923643912992
  mo_energy =
[-0.8782382   1.12923644  3.68669137  8.74530932 16.18624189]
E1 = -3.788268614058139  E_coul = 1.0158961102218238
cycle= 5 E= -2.77237250383632  delta_E= -1.09e-11  |g|= 2.65e-08  |ddm|= 0.000525
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.788268614058139  E_coul = 1.0158961102218238
  HOMO = -0.878238196807231  LUMO = 1.1292364357019
  mo_energy =
[-0.8782382   1.12923644  3.68669136  8.74530931 16.18624187]
E1 = -3.78826861301109  E_coul = 1.015896109180421
Extra cycle  E= -2.77237250383067  delta_E= 5.65e-12  |g|= 2.29e-09  |ddm|= 2.56e-05
    CPU time for scf_cycle      0.46 sec, wall time      0.47 sec
exp = [2.5 2.  1.5 1.  0.5]
E = -2.7723725038306686
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:16:51 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.5                  1
[INPUT] 0    0    [1    /1   ]  2                    1
[INPUT] 0    0    [1    /1   ]  1.5                  1
[INPUT] 0    0    [1    /1   ]  1                    1
[INPUT] 0    0    [1    /1   ]  0.5                  1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [2.5, 1.0]], [0, [2.0, 1.0]], [0, [1.5, 1.0]], [0, [1.0, 1.0]], [0, [0.5, 1.0]]]}
ecp = {}
CPU time:         1.92
Set gradient conv threshold to 3.16228e-05
cond(S) = 378590.17957338446
E1 = -3.7746062585721467  E_coul = 1.0189813309456763
init E= -2.75562492762647
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.876344617365818  LUMO = 1.12456103053976
  mo_energy =
[-0.87634462  1.12456103  3.68270862  8.74245069 16.19041383]
E1 = -3.7886643582534636  E_coul = 1.0163544137295824
cycle= 1 E= -2.77230994452388  delta_E= -0.0167  |g|= 0.0266  |ddm|=  352
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.87800579394393  LUMO = 1.12913231194683
  mo_energy =
[-0.87800579  1.12913231  3.68663323  8.74532471 16.18681823]
E1 = -3.788171299581449  E_coul = 1.01579957874051
cycle= 2 E= -2.77237172084094  delta_E= -6.18e-05  |g|= 0.0024  |ddm|= 21.4
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.878311728358986  LUMO = 1.12920321191474
  mo_energy =
[-0.87831173  1.12920321  3.68661838  8.74520516 16.18609351]
E1 = -3.788248464501732  E_coul = 1.0158759638364994
cycle= 3 E= -2.77237250066523  delta_E= -7.8e-07  |g|= 0.000129  |ddm|=  2.1
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.878236208109043  LUMO = 1.12923729378648
  mo_energy =
[-0.87823621  1.12923729  3.68669304  8.74531173 16.18624591]
E1 = -3.788269006318214  E_coul = 1.0158965024928368
cycle= 4 E= -2.77237250382538  delta_E= -3.16e-09  |g|= 5.57e-06  |ddm|= 0.0748
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.878238195383851  LUMO = 1.12923643912992
  mo_energy =
[-0.8782382   1.12923644  3.68669137  8.74530932 16.18624189]
E1 = -3.788268614058139  E_coul = 1.0158961102218238
cycle= 5 E= -2.77237250383632  delta_E= -1.09e-11  |g|= 2.65e-08  |ddm|= 0.000525
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.788268614058139  E_coul = 1.0158961102218238
  HOMO = -0.878238196807231  LUMO = 1.1292364357019
  mo_energy =
[-0.8782382   1.12923644  3.68669136  8.74530931 16.18624187]
E1 = -3.78826861301109  E_coul = 1.015896109180421
Extra cycle  E= -2.77237250383067  delta_E= 5.65e-12  |g|= 2.29e-09  |ddm|= 2.56e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 378590.17957338446
E1 = -3.78826861301109  E_coul = 1.015896109180421
init E= -2.77237250383067
    CPU time for initialize scf      0.24 sec, wall time      0.24 sec
  HOMO = -0.878238197325124  LUMO = 1.12923643539114
  mo_energy =
[-0.8782382   1.12923644  3.68669136  8.74530931 16.18624188]
E1 = -3.788268612820842  E_coul = 1.0158961089886709
cycle= 1 E= -2.77237250383217  delta_E= -1.5e-12  |g|= 3.29e-10  |ddm|= 2.08e-06
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.788268612820842  E_coul = 1.0158961089886709
  HOMO = -0.878238197421758  LUMO = 1.12923643534321
  mo_energy =
[-0.8782382   1.12923644  3.68669136  8.74530931 16.18624187]
E1 = -3.788268612789221  E_coul = 1.015896108958003
Extra cycle  E= -2.77237250383122  delta_E= 9.53e-13  |g|= 5.57e-11  |ddm|= 2.78e-07
    CPU time for scf_cycle      0.82 sec, wall time      0.82 sec
exp = [2.5 2.  1.5 1.  0.5]
grad_E = [-0.01289999 -0.01092835 -0.00894378 -0.00410076  0.02965771]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:16:55 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.51289999098        1
[INPUT] 0    0    [1    /1   ]  2.01092834641        1
[INPUT] 0    0    [1    /1   ]  1.50894378267        1
[INPUT] 0    0    [1    /1   ]  1.00410075654        1
[INPUT] 0    0    [1    /1   ]  0.470342288781       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [2.512899990976905, 1.0]], [0, [2.0109283464094396, 1.0]], [0, [1.50894378266808, 1.0]], [0, [1.0041007565437194, 1.0]], [0, [0.470342288781346, 1.0]]]}
ecp = {}
CPU time:         6.20
Set gradient conv threshold to 3.16228e-05
cond(S) = 346727.15851170535
E1 = -3.7778597027019183  E_coul = 1.0190308852064016
init E= -2.75882881749552
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.876992073762827  LUMO = 1.09092833998773
  mo_energy =
[-0.87699207  1.09092834  3.6256359   8.68261066 16.15830028]
E1 = -3.787559539300696  E_coul = 1.0139899607989304
cycle= 1 E= -2.77356957850177  delta_E= -0.0147  |g|= 0.0245  |ddm|=  276
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.879813681940536  LUMO = 1.09460535181353
  mo_energy =
[-0.87981368  1.09460535  3.62817016  8.68360452 16.15218746]
E1 = -3.7869592857187193  E_coul = 1.0133371446277968
cycle= 2 E= -2.77362214109092  delta_E= -5.26e-05  |g|= 0.0022  |ddm|=   17
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.880171737259845  LUMO = 1.09464407310207
  mo_energy =
[-0.88017174  1.09464407  3.62809613  8.68339625 16.15135265]
E1 = -3.7870199824596256  E_coul = 1.0133971876286982
cycle= 3 E= -2.77362279483093  delta_E= -6.54e-07  |g|= 0.000121  |ddm|= 1.67
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.880101379168177  LUMO = 1.09467575928571
  mo_energy =
[-0.88010138  1.09467576  3.62816635  8.6834967  16.15149534]
E1 = -3.7870393740801984  E_coul = 1.0134165763822638
cycle= 4 E= -2.77362279769793  delta_E= -2.87e-09  |g|= 5.29e-06  |ddm|= 0.0642
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.880103303612466  LUMO = 1.09467491518812
  mo_energy =
[-0.8801033   1.09467492  3.6281647   8.68349431 16.15149141]
E1 = -3.787038985692153  E_coul = 1.0134161879995403
cycle= 5 E= -2.77362279769261  delta_E= 5.32e-12  |g|= 2.65e-08  |ddm|= 0.000613
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.787038985692153  E_coul = 1.0134161879995403
  HOMO = -0.880103304846556  LUMO = 1.09467491219634
  mo_energy =
[-0.8801033   1.09467491  3.62816469  8.6834943  16.1514914 ]
E1 = -3.787038984582164  E_coul = 1.0134161868852072
Extra cycle  E= -2.77362279769696  delta_E= -4.34e-12  |g|= 2.54e-09  |ddm|= 2.27e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [2.51289999 2.01092835 1.50894378 1.00410076 0.47034229]
E = -2.773622797696957
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:16:55 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.51289999098        1
[INPUT] 0    0    [1    /1   ]  2.01092834641        1
[INPUT] 0    0    [1    /1   ]  1.50894378267        1
[INPUT] 0    0    [1    /1   ]  1.00410075654        1
[INPUT] 0    0    [1    /1   ]  0.470342288781       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [2.512899990976905, 1.0]], [0, [2.0109283464094396, 1.0]], [0, [1.50894378266808, 1.0]], [0, [1.0041007565437194, 1.0]], [0, [0.470342288781346, 1.0]]]}
ecp = {}
CPU time:         6.31
Set gradient conv threshold to 3.16228e-05
cond(S) = 346727.15851170535
E1 = -3.7778597027019183  E_coul = 1.0190308852064016
init E= -2.75882881749552
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.876992073762827  LUMO = 1.09092833998773
  mo_energy =
[-0.87699207  1.09092834  3.6256359   8.68261066 16.15830028]
E1 = -3.787559539300696  E_coul = 1.0139899607989304
cycle= 1 E= -2.77356957850177  delta_E= -0.0147  |g|= 0.0245  |ddm|=  276
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.879813681940536  LUMO = 1.09460535181353
  mo_energy =
[-0.87981368  1.09460535  3.62817016  8.68360452 16.15218746]
E1 = -3.7869592857187193  E_coul = 1.0133371446277968
cycle= 2 E= -2.77362214109092  delta_E= -5.26e-05  |g|= 0.0022  |ddm|=   17
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.880171737259845  LUMO = 1.09464407310207
  mo_energy =
[-0.88017174  1.09464407  3.62809613  8.68339625 16.15135265]
E1 = -3.7870199824596256  E_coul = 1.0133971876286982
cycle= 3 E= -2.77362279483093  delta_E= -6.54e-07  |g|= 0.000121  |ddm|= 1.67
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.880101379168177  LUMO = 1.09467575928571
  mo_energy =
[-0.88010138  1.09467576  3.62816635  8.6834967  16.15149534]
E1 = -3.7870393740801984  E_coul = 1.0134165763822638
cycle= 4 E= -2.77362279769793  delta_E= -2.87e-09  |g|= 5.29e-06  |ddm|= 0.0642
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.880103303612466  LUMO = 1.09467491518812
  mo_energy =
[-0.8801033   1.09467492  3.6281647   8.68349431 16.15149141]
E1 = -3.787038985692153  E_coul = 1.0134161879995403
cycle= 5 E= -2.77362279769261  delta_E= 5.32e-12  |g|= 2.65e-08  |ddm|= 0.000613
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.787038985692153  E_coul = 1.0134161879995403
  HOMO = -0.880103304846556  LUMO = 1.09467491219634
  mo_energy =
[-0.8801033   1.09467491  3.62816469  8.6834943  16.1514914 ]
E1 = -3.787038984582164  E_coul = 1.0134161868852072
Extra cycle  E= -2.77362279769696  delta_E= -4.34e-12  |g|= 2.54e-09  |ddm|= 2.27e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 346727.15851170535
E1 = -3.787038984582164  E_coul = 1.0134161868852072
init E= -2.77362279769696
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.880103305405891  LUMO = 1.0946749118276
  mo_energy =
[-0.88010331  1.09467491  3.62816469  8.6834943  16.1514914 ]
E1 = -3.7870389843783467  E_coul = 1.013416186682999
cycle= 1 E= -2.77362279769535  delta_E= 1.61e-12  |g|= 3.12e-10  |ddm|= 2.12e-06
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.7870389843783467  E_coul = 1.013416186682999
  HOMO = -0.880103305506177  LUMO = 1.09467491177709
  mo_energy =
[-0.88010331  1.09467491  3.62816469  8.6834943  16.1514914 ]
E1 = -3.7870389843445027  E_coul = 1.0134161866510172
Extra cycle  E= -2.77362279769349  delta_E= 1.86e-12  |g|= 7.48e-11  |ddm|= 1.84e-07
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [2.51289999 2.01092835 1.50894378 1.00410076 0.47034229]
grad_E = [-0.01317494 -0.01127287 -0.00953583 -0.00529175  0.02807895]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:16:57 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.57956449917        1
[INPUT] 0    0    [1    /1   ]  2.06796178729        1
[INPUT] 0    0    [1    /1   ]  1.55717050663        1
[INPUT] 0    0    [1    /1   ]  1.03081055714        1
[INPUT] 0    0    [1    /1   ]  0.328131753336       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [2.5795644991672266, 1.0]], [0, [2.0679617872888776, 1.0]], [0, [1.557170506634233, 1.0]], [0, [1.0308105571389112, 1.0]], [0, [0.3281317533359349, 1.0]]]}
ecp = {}
CPU time:         8.29
Set gradient conv threshold to 3.16228e-05
cond(S) = 239990.17000919196
E1 = -3.789946247643925  E_coul = 1.0188254144494802
init E= -2.77112083319444
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.879541401570138  LUMO = 0.889604503223684
  mo_energy =
[-0.8795414   0.8896045   3.31264972  8.39453308 16.04323308]
E1 = -3.7787472941078475  E_coul = 1.0006087099230523
cycle= 1 E= -2.77813858418479  delta_E= -0.00702  |g|= 0.0137  |ddm|= 33.5
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.88877212429461  LUMO = 0.888868467499891
  mo_energy =
[-0.88877212  0.88886847  3.30749625  8.38486354 16.0230912 ]
E1 = -3.777380845318439  E_coul = 0.9992269171119149
cycle= 2 E= -2.77815392820652  delta_E= -1.53e-05  |g|= 0.000897  |ddm|= 2.23
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.889512756701055  LUMO = 0.888690183558961
  mo_energy =
[-0.88951276  0.88869018  3.30696441  8.38398144 16.02144186]
E1 = -3.7773127127694495  E_coul = 0.9991587006591968
cycle= 3 E= -2.77815401211025  delta_E= -8.39e-08  |g|= 3.7e-05  |ddm|= 0.218
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.889493975215533  LUMO = 0.888698880290662
  mo_energy =
[-0.88949398  0.88869888  3.30698432  8.38400968 16.02148096]
E1 = -3.7773180719149115  E_coul = 0.9991640595354295
cycle= 4 E= -2.77815401237948  delta_E= -2.69e-10  |g|= 3.57e-06  |ddm|= 0.0134
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.7773180719149115  E_coul = 0.9991640595354295
  HOMO = -0.889494976422626  LUMO = 0.888698389924499
  mo_energy =
[-0.88949498  0.88869839  3.30698336  8.38400833 16.02147886]
E1 = -3.7773178638907337  E_coul = 0.9991638515103165
Extra cycle  E= -2.77815401238042  delta_E= -9.35e-13  |g|= 3.75e-07  |ddm|= 0.00075
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [2.5795645  2.06796179 1.55717051 1.03081056 0.32813175]
E = -2.7781540123804174
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:16:57 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.57956449917        1
[INPUT] 0    0    [1    /1   ]  2.06796178729        1
[INPUT] 0    0    [1    /1   ]  1.55717050663        1
[INPUT] 0    0    [1    /1   ]  1.03081055714        1
[INPUT] 0    0    [1    /1   ]  0.328131753336       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [2.5795644991672266, 1.0]], [0, [2.0679617872888776, 1.0]], [0, [1.557170506634233, 1.0]], [0, [1.0308105571389112, 1.0]], [0, [0.3281317533359349, 1.0]]]}
ecp = {}
CPU time:         8.40
Set gradient conv threshold to 3.16228e-05
cond(S) = 239990.17000919196
E1 = -3.789946247643925  E_coul = 1.0188254144494802
init E= -2.77112083319444
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.879541401570138  LUMO = 0.889604503223684
  mo_energy =
[-0.8795414   0.8896045   3.31264972  8.39453308 16.04323308]
E1 = -3.7787472941078475  E_coul = 1.0006087099230523
cycle= 1 E= -2.77813858418479  delta_E= -0.00702  |g|= 0.0137  |ddm|= 33.5
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.88877212429461  LUMO = 0.888868467499891
  mo_energy =
[-0.88877212  0.88886847  3.30749625  8.38486354 16.0230912 ]
E1 = -3.777380845318439  E_coul = 0.9992269171119149
cycle= 2 E= -2.77815392820652  delta_E= -1.53e-05  |g|= 0.000897  |ddm|= 2.23
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.889512756701055  LUMO = 0.888690183558961
  mo_energy =
[-0.88951276  0.88869018  3.30696441  8.38398144 16.02144186]
E1 = -3.7773127127694495  E_coul = 0.9991587006591968
cycle= 3 E= -2.77815401211025  delta_E= -8.39e-08  |g|= 3.7e-05  |ddm|= 0.218
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.889493975215533  LUMO = 0.888698880290662
  mo_energy =
[-0.88949398  0.88869888  3.30698432  8.38400968 16.02148096]
E1 = -3.7773180719149115  E_coul = 0.9991640595354295
cycle= 4 E= -2.77815401237948  delta_E= -2.69e-10  |g|= 3.57e-06  |ddm|= 0.0134
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.7773180719149115  E_coul = 0.9991640595354295
  HOMO = -0.889494976422626  LUMO = 0.888698389924499
  mo_energy =
[-0.88949498  0.88869839  3.30698336  8.38400833 16.02147886]
E1 = -3.7773178638907337  E_coul = 0.9991638515103165
Extra cycle  E= -2.77815401238042  delta_E= -9.35e-13  |g|= 3.75e-07  |ddm|= 0.00075
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 239990.17000919196
E1 = -3.7773178638907337  E_coul = 0.9991638515103165
init E= -2.77815401238042
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.889495080435059  LUMO = 0.888698333057812
  mo_energy =
[-0.88949508  0.88869833  3.30698324  8.38400817 16.02147864]
E1 = -3.7773178304752197  E_coul = 0.9991638180948447
cycle= 1 E= -2.77815401238038  delta_E= 4.22e-14  |g|= 5.25e-08  |ddm|= 0.000113
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.7773178304752197  E_coul = 0.9991638180948447
  HOMO = -0.889495097142767  LUMO = 0.888698324529525
  mo_energy =
[-0.8894951   0.88869832  3.30698322  8.38400814 16.02147861]
E1 = -3.7773178246350225  E_coul = 0.9991638122548526
Extra cycle  E= -2.77815401238017  delta_E= 2.05e-13  |g|= 8.12e-09  |ddm|= 1.63e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [2.5795645  2.06796179 1.55717051 1.03081056 0.32813175]
grad_E = [-0.01426843 -0.01241305 -0.01130931 -0.00745709 -0.00784978]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:16:59 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.62131254756        1
[INPUT] 0    0    [1    /1   ]  2.10392108831        1
[INPUT] 0    0    [1    /1   ]  1.58855663785        1
[INPUT] 0    0    [1    /1   ]  1.04956067306        1
[INPUT] 0    0    [1    /1   ]  0.287207997406       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [2.621312547564896, 1.0]], [0, [2.103921088305986, 1.0]], [0, [1.5885566378467428, 1.0]], [0, [1.0495606730556062, 1.0]], [0, [0.2872079974063408, 1.0]]]}
ecp = {}
CPU time:        10.28
Set gradient conv threshold to 3.16228e-05
cond(S) = 220325.65454136077
E1 = -3.790973135465115  E_coul = 1.0185535325821629
init E= -2.77241960288295
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.879994231480085  LUMO = 0.820096223778548
  mo_energy =
[-0.87999423  0.82009622  3.23249354  8.37934444 16.16135728]
E1 = -3.7753840178758913  E_coul = 0.9966158232487284
cycle= 1 E= -2.77876819462716  delta_E= -0.00635  |g|= 0.0125  |ddm|= 7.74
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.89108270407871  LUMO = 0.818243119595094
  mo_energy =
[-0.8910827   0.81824312  3.22495564  8.36632327 16.1370147 ]
E1 = -3.773689394227302  E_coul = 0.9949073920443575
cycle= 2 E= -2.77878200218294  delta_E= -1.38e-05  |g|= 0.000633  |ddm|= 0.62
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.891993420658045  LUMO = 0.817974153181633
  mo_energy =
[-0.89199342  0.81797415  3.22419867  8.36512115 16.13499202]
E1 = -3.7735596149398964  E_coul = 0.9947775591957954
cycle= 3 E= -2.7787820557441  delta_E= -5.36e-08  |g|= 2.66e-05  |ddm|= 0.0606
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.892004011879754  LUMO = 0.817969900663694
  mo_energy =
[-0.89200401  0.8179699   3.22418608  8.36510313 16.13497011]
E1 = -3.7735556038734774  E_coul = 0.9947735480113401
cycle= 4 E= -2.77878205586214  delta_E= -1.18e-10  |g|= 7.52e-07  |ddm|= 0.0041
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.7735556038734774  E_coul = 0.9947735480113401
  HOMO = -0.892004253925433  LUMO = 0.817969796984921
  mo_energy =
[-0.89200425  0.8179698   3.22418585  8.3651028  16.13496962]
E1 = -3.7735555474300506  E_coul = 0.9947734915676935
Extra cycle  E= -2.77878205586236  delta_E= -2.2e-13  |g|= 8.92e-08  |ddm|= 0.000134
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [2.62131255 2.10392109 1.58855664 1.04956067 0.287208  ]
E = -2.778782055862357
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:16:59 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.62131254756        1
[INPUT] 0    0    [1    /1   ]  2.10392108831        1
[INPUT] 0    0    [1    /1   ]  1.58855663785        1
[INPUT] 0    0    [1    /1   ]  1.04956067306        1
[INPUT] 0    0    [1    /1   ]  0.287207997406       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [2.621312547564896, 1.0]], [0, [2.103921088305986, 1.0]], [0, [1.5885566378467428, 1.0]], [0, [1.0495606730556062, 1.0]], [0, [0.2872079974063408, 1.0]]]}
ecp = {}
CPU time:        10.41
Set gradient conv threshold to 3.16228e-05
cond(S) = 220325.65454136077
E1 = -3.790973135465115  E_coul = 1.0185535325821629
init E= -2.77241960288295
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.879994231480085  LUMO = 0.820096223778548
  mo_energy =
[-0.87999423  0.82009622  3.23249354  8.37934444 16.16135728]
E1 = -3.7753840178758913  E_coul = 0.9966158232487284
cycle= 1 E= -2.77876819462716  delta_E= -0.00635  |g|= 0.0125  |ddm|= 7.74
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.89108270407871  LUMO = 0.818243119595094
  mo_energy =
[-0.8910827   0.81824312  3.22495564  8.36632327 16.1370147 ]
E1 = -3.773689394227302  E_coul = 0.9949073920443575
cycle= 2 E= -2.77878200218294  delta_E= -1.38e-05  |g|= 0.000633  |ddm|= 0.62
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.891993420658045  LUMO = 0.817974153181633
  mo_energy =
[-0.89199342  0.81797415  3.22419867  8.36512115 16.13499202]
E1 = -3.7735596149398964  E_coul = 0.9947775591957954
cycle= 3 E= -2.7787820557441  delta_E= -5.36e-08  |g|= 2.66e-05  |ddm|= 0.0606
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.892004011879754  LUMO = 0.817969900663694
  mo_energy =
[-0.89200401  0.8179699   3.22418608  8.36510313 16.13497011]
E1 = -3.7735556038734774  E_coul = 0.9947735480113401
cycle= 4 E= -2.77878205586214  delta_E= -1.18e-10  |g|= 7.52e-07  |ddm|= 0.0041
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.7735556038734774  E_coul = 0.9947735480113401
  HOMO = -0.892004253925433  LUMO = 0.817969796984921
  mo_energy =
[-0.89200425  0.8179698   3.22418585  8.3651028  16.13496962]
E1 = -3.7735555474300506  E_coul = 0.9947734915676935
Extra cycle  E= -2.77878205586236  delta_E= -2.2e-13  |g|= 8.92e-08  |ddm|= 0.000134
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 220325.65454136077
E1 = -3.7735555474300506  E_coul = 0.9947734915676935
init E= -2.77878205586236
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.89200428214733  LUMO = 0.817969782758725
  mo_energy =
[-0.89200428  0.81796978  3.22418581  8.36510275 16.13496956]
E1 = -3.7735555380084738  E_coul = 0.9947734821453578
cycle= 1 E= -2.77878205586312  delta_E= -7.59e-13  |g|= 1.34e-08  |ddm|= 2.13e-05
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.7735555380084738  E_coul = 0.9947734821453578
  HOMO = -0.892004286858881  LUMO = 0.817969780521729
  mo_energy =
[-0.89200429  0.81796978  3.22418581  8.36510274 16.13496955]
E1 = -3.7735555363586126  E_coul = 0.9947734804958231
Extra cycle  E= -2.77878205586279  delta_E= 3.26e-13  |g|= 2.15e-09  |ddm|= 3.2e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [2.62131255 2.10392109 1.58855664 1.04956067 0.287208  ]
grad_E = [-0.01415621 -0.01215903 -0.0108767  -0.00552715 -0.03802154]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:01 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.68037521807        1
[INPUT] 0    0    [1    /1   ]  2.15481855942        1
[INPUT] 0    0    [1    /1   ]  1.63348223698        1
[INPUT] 0    0    [1    /1   ]  1.07574740293        1
[INPUT] 0    0    [1    /1   ]  0.292917925548       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [2.680375218067687, 1.0]], [0, [2.154818559423237, 1.0]], [0, [1.6334822369833923, 1.0]], [0, [1.0757474029300926, 1.0]], [0, [0.2929179255483889, 1.0]]]}
ecp = {}
CPU time:        12.31
Set gradient conv threshold to 3.16228e-05
cond(S) = 228420.60171390278
E1 = -3.793756422563663  E_coul = 1.018892690958173
init E= -2.77486373160549
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.880952783938903  LUMO = 0.843257766608742
  mo_energy =
[-0.88095278  0.84325777  3.31868897  8.59326196 16.57746546]
E1 = -3.7789951956759062  E_coul = 0.9979858047360813
cycle= 1 E= -2.78100939093983  delta_E= -0.00615  |g|= 0.0122  |ddm|=    5
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.891517802457164  LUMO = 0.841506299115233
  mo_energy =
[-0.8915178   0.8415063   3.31141935  8.58066624 16.5538393 ]
E1 = -3.7773974138656463  E_coul = 0.9963753111814609
cycle= 2 E= -2.78102210268419  delta_E= -1.27e-05  |g|= 0.000617  |ddm|= 0.377
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
  HOMO = -0.892376016582733  LUMO = 0.841250927174613
  mo_energy =
[-0.89237602  0.84125093  3.31069919  8.57952082 16.5519016 ]
E1 = -3.7772806301021875  E_coul = 0.9962584822350519
cycle= 3 E= -2.78102214786714  delta_E= -4.52e-08  |g|= 1.98e-05  |ddm|= 0.0337
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
  HOMO = -0.892382956794891  LUMO = 0.84124823027437
  mo_energy =
[-0.89238296  0.84124823  3.31069075  8.57950869 16.55188718]
E1 = -3.7772779231199713  E_coul = 0.9962557751997114
cycle= 4 E= -2.78102214792026  delta_E= -5.31e-11  |g|= 7.02e-07  |ddm|= 0.00213
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
E1 = -3.7772779231199713  E_coul = 0.9962557751997114
  HOMO = -0.892383186360309  LUMO = 0.84124812834978
  mo_energy =
[-0.89238319  0.84124813  3.31069052  8.57950837 16.5518867 ]
E1 = -3.777277869445436  E_coul = 0.9962557215248101
Extra cycle  E= -2.78102214792063  delta_E= -3.65e-13  |g|= 8.33e-08  |ddm|= 0.000127
    CPU time for scf_cycle      0.09 sec, wall time      0.10 sec
exp = [2.68037522 2.15481856 1.63348224 1.0757474  0.29291793]
E = -2.7810221479206256
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:01 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.68037521807        1
[INPUT] 0    0    [1    /1   ]  2.15481855942        1
[INPUT] 0    0    [1    /1   ]  1.63348223698        1
[INPUT] 0    0    [1    /1   ]  1.07574740293        1
[INPUT] 0    0    [1    /1   ]  0.292917925548       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [2.680375218067687, 1.0]], [0, [2.154818559423237, 1.0]], [0, [1.6334822369833923, 1.0]], [0, [1.0757474029300926, 1.0]], [0, [0.2929179255483889, 1.0]]]}
ecp = {}
CPU time:        12.52
Set gradient conv threshold to 3.16228e-05
cond(S) = 228420.60171390278
E1 = -3.793756422563663  E_coul = 1.018892690958173
init E= -2.77486373160549
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.880952783938903  LUMO = 0.843257766608742
  mo_energy =
[-0.88095278  0.84325777  3.31868897  8.59326196 16.57746546]
E1 = -3.7789951956759062  E_coul = 0.9979858047360813
cycle= 1 E= -2.78100939093983  delta_E= -0.00615  |g|= 0.0122  |ddm|=    5
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.891517802457164  LUMO = 0.841506299115233
  mo_energy =
[-0.8915178   0.8415063   3.31141935  8.58066624 16.5538393 ]
E1 = -3.7773974138656463  E_coul = 0.9963753111814609
cycle= 2 E= -2.78102210268419  delta_E= -1.27e-05  |g|= 0.000617  |ddm|= 0.377
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.892376016582733  LUMO = 0.841250927174613
  mo_energy =
[-0.89237602  0.84125093  3.31069919  8.57952082 16.5519016 ]
E1 = -3.7772806301021875  E_coul = 0.9962584822350519
cycle= 3 E= -2.78102214786714  delta_E= -4.52e-08  |g|= 1.98e-05  |ddm|= 0.0337
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.892382956794891  LUMO = 0.84124823027437
  mo_energy =
[-0.89238296  0.84124823  3.31069075  8.57950869 16.55188718]
E1 = -3.7772779231199713  E_coul = 0.9962557751997114
cycle= 4 E= -2.78102214792026  delta_E= -5.31e-11  |g|= 7.02e-07  |ddm|= 0.00213
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.7772779231199713  E_coul = 0.9962557751997114
  HOMO = -0.892383186360309  LUMO = 0.84124812834978
  mo_energy =
[-0.89238319  0.84124813  3.31069052  8.57950837 16.5518867 ]
E1 = -3.777277869445436  E_coul = 0.9962557215248101
Extra cycle  E= -2.78102214792063  delta_E= -3.65e-13  |g|= 8.33e-08  |ddm|= 0.000127
    CPU time for scf_cycle      0.06 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 228420.60171390278
E1 = -3.777277869445436  E_coul = 0.9962557215248101
init E= -2.78102214792063
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.892383213197914  LUMO = 0.841248114667014
  mo_energy =
[-0.89238321  0.84124811  3.31069048  8.57950833 16.55188664]
E1 = -3.7772778605792197  E_coul = 0.9962557126587775
cycle= 1 E= -2.78102214792044  delta_E= 1.83e-13  |g|= 1.25e-08  |ddm|= 1.99e-05
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.7772778605792197  E_coul = 0.9962557126587775
  HOMO = -0.892383217630827  LUMO = 0.841248112538493
  mo_energy =
[-0.89238322  0.84124811  3.31069048  8.57950832 16.55188664]
E1 = -3.777277859048478  E_coul = 0.9962557111281156
Extra cycle  E= -2.78102214792036  delta_E= 7.99e-14  |g|= 1.98e-09  |ddm|= 2.95e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [2.68037522 2.15481856 1.63348224 1.0757474  0.29291793]
grad_E = [-0.01344195 -0.01155553 -0.01033652 -0.00516906 -0.03399519]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:03 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.97676150423        1
[INPUT] 0    0    [1    /1   ]  2.41022280997        1
[INPUT] 0    0    [1    /1   ]  1.85873679235        1
[INPUT] 0    0    [1    /1   ]  1.20621305185        1
[INPUT] 0    0    [1    /1   ]  0.306753895225       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [2.976761504228398, 1.0]], [0, [2.410222809973452, 1.0]], [0, [1.8587367923548677, 1.0]], [0, [1.2062130518488694, 1.0]], [0, [0.30675389522483026, 1.0]]]}
ecp = {}
CPU time:        14.38
Set gradient conv threshold to 3.16228e-05
cond(S) = 260578.08775064864
E1 = -3.804810955996107  E_coul = 1.0200958357996128
init E= -2.78471512019649
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.884958137776023  LUMO = 0.929512717686302
  mo_energy =
[-0.88495814  0.92951272  3.70359312  9.61030679 18.60970984]
E1 = -3.7929271882489153  E_coul = 1.0027504999307773
cycle= 1 E= -2.79017668831814  delta_E= -0.00546  |g|= 0.0113  |ddm|= 2.56
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.893717636932989  LUMO = 0.928030040577995
  mo_energy =
[-0.89371764  0.92803004  3.69701972  9.5988819  18.58835436]
E1 = -3.7916215813787844  E_coul = 1.0014353061224734
cycle= 2 E= -2.79018627525631  delta_E= -9.59e-06  |g|= 0.00057  |ddm|= 0.127
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.894417053873615  LUMO = 0.927805692243125
  mo_energy =
[-0.89441705  0.92780569  3.69638447  9.59787486 18.58665313]
E1 = -3.7915373347540093  E_coul = 1.0013510292719672
cycle= 3 E= -2.79018630548204  delta_E= -3.02e-08  |g|= 1.06e-05  |ddm|= 0.0108
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.894417831932949  LUMO = 0.927805693741516
  mo_energy =
[-0.89441783  0.92780569  3.69638327  9.597873   18.5866516 ]
E1 = -3.7915368300849317  E_coul = 1.0013505245964467
cycle= 4 E= -2.79018630548849  delta_E= -6.44e-12  |g|= 1.65e-07  |ddm|= 0.000909
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.7915368300849317  E_coul = 1.0013505245964467
  HOMO = -0.894417890446018  LUMO = 0.927805670403052
  mo_energy =
[-0.89441789  0.92780567  3.69638321  9.59787292 18.58665147]
E1 = -3.791536818453366  E_coul = 1.0013505129654743
Extra cycle  E= -2.79018630548789  delta_E= 5.93e-13  |g|= 1.6e-08  |ddm|= 9.8e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [2.9767615  2.41022281 1.85873679 1.20621305 0.3067539 ]
E = -2.790186305487892
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:03 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  2.97676150423        1
[INPUT] 0    0    [1    /1   ]  2.41022280997        1
[INPUT] 0    0    [1    /1   ]  1.85873679235        1
[INPUT] 0    0    [1    /1   ]  1.20621305185        1
[INPUT] 0    0    [1    /1   ]  0.306753895225       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [2.976761504228398, 1.0]], [0, [2.410222809973452, 1.0]], [0, [1.8587367923548677, 1.0]], [0, [1.2062130518488694, 1.0]], [0, [0.30675389522483026, 1.0]]]}
ecp = {}
CPU time:        14.54
Set gradient conv threshold to 3.16228e-05
cond(S) = 260578.08775064864
E1 = -3.804810955996107  E_coul = 1.0200958357996128
init E= -2.78471512019649
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.884958137776023  LUMO = 0.929512717686302
  mo_energy =
[-0.88495814  0.92951272  3.70359312  9.61030679 18.60970984]
E1 = -3.7929271882489153  E_coul = 1.0027504999307773
cycle= 1 E= -2.79017668831814  delta_E= -0.00546  |g|= 0.0113  |ddm|= 2.56
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.893717636932989  LUMO = 0.928030040577995
  mo_energy =
[-0.89371764  0.92803004  3.69701972  9.5988819  18.58835436]
E1 = -3.7916215813787844  E_coul = 1.0014353061224734
cycle= 2 E= -2.79018627525631  delta_E= -9.59e-06  |g|= 0.00057  |ddm|= 0.127
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.894417053873615  LUMO = 0.927805692243125
  mo_energy =
[-0.89441705  0.92780569  3.69638447  9.59787486 18.58665313]
E1 = -3.7915373347540093  E_coul = 1.0013510292719672
cycle= 3 E= -2.79018630548204  delta_E= -3.02e-08  |g|= 1.06e-05  |ddm|= 0.0108
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.894417831932949  LUMO = 0.927805693741516
  mo_energy =
[-0.89441783  0.92780569  3.69638327  9.597873   18.5866516 ]
E1 = -3.7915368300849317  E_coul = 1.0013505245964467
cycle= 4 E= -2.79018630548849  delta_E= -6.44e-12  |g|= 1.65e-07  |ddm|= 0.000909
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.7915368300849317  E_coul = 1.0013505245964467
  HOMO = -0.894417890446018  LUMO = 0.927805670403052
  mo_energy =
[-0.89441789  0.92780567  3.69638321  9.59787292 18.58665147]
E1 = -3.791536818453366  E_coul = 1.0013505129654743
Extra cycle  E= -2.79018630548789  delta_E= 5.93e-13  |g|= 1.6e-08  |ddm|= 9.8e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 260578.08775064864
E1 = -3.791536818453366  E_coul = 1.0013505129654743
init E= -2.79018630548789
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.894417896261204  LUMO = 0.92780566745197
  mo_energy =
[-0.8944179   0.92780567  3.6963832   9.59787291 18.58665146]
E1 = -3.791536816687086  E_coul = 1.0013505111988625
cycle= 1 E= -2.79018630548822  delta_E= -3.31e-13  |g|= 2.25e-09  |ddm|= 2.73e-06
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.791536816687086  E_coul = 1.0013505111988625
  HOMO = -0.894417897144678  LUMO = 0.927805667009423
  mo_energy =
[-0.8944179   0.92780567  3.6963832   9.59787291 18.58665146]
E1 = -3.7915368164043923  E_coul = 1.001350510916255
Extra cycle  E= -2.79018630548814  delta_E= 8.62e-14  |g|= 3.43e-10  |ddm|= 4.57e-07
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [2.9767615  2.41022281 1.85873679 1.20621305 0.3067539 ]
grad_E = [-0.01060096 -0.00908277 -0.00803291 -0.00305468 -0.02710159]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:05 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.98259027707        1
[INPUT] 0    0    [1    /1   ]  3.27685909782        1
[INPUT] 0    0    [1    /1   ]  2.62273935473        1
[INPUT] 0    0    [1    /1   ]  1.64460648229        1
[INPUT] 0    0    [1    /1   ]  0.358583207657       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [3.9825902770664277, 1.0]], [0, [3.276859097823821, 1.0]], [0, [2.6227393547273476, 1.0]], [0, [1.6446064822942867, 1.0]], [0, [0.35858320765736373, 1.0]]]}
ecp = {}
CPU time:        16.38
Set gradient conv threshold to 3.16228e-05
cond(S) = 366426.18720369507
E1 = -3.8252672079376637  E_coul = 1.022355176356984
init E= -2.80291203158068
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.893142489220938  LUMO = 1.23706818945363
  mo_energy =
[-0.89314249  1.23706819  5.03845811 13.08768374 25.57254907]
E1 = -3.8258656489413725  E_coul = 1.0171207215842688
cycle= 1 E= -2.8087449273571  delta_E= -0.00583  |g|= 0.0109  |ddm|= 21.1
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.895815650596139  LUMO = 1.2383102283104
  mo_energy =
[-0.89581565  1.23831023  5.03723699 13.08382399 25.56245309]
E1 = -3.8252643151327326  E_coul = 1.0165117752218658
cycle= 2 E= -2.80875253991087  delta_E= -7.61e-06  |g|= 0.000763  |ddm|= 1.28
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.896140525974235  LUMO = 1.23821269110571
  mo_energy =
[-0.89614053  1.23821269  5.0369066  13.08326512 25.56140952]
E1 = -3.825256581619076  E_coul = 1.016503991458485
cycle= 3 E= -2.80875259016059  delta_E= -5.02e-08  |g|= 3.32e-05  |ddm|= 0.122
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.896121424289334  LUMO = 1.23822406161286
  mo_energy =
[-0.89612142  1.23822406  5.03693393 13.08330222 25.56145758]
E1 = -3.825261333186316  E_coul = 1.0165087428585
cycle= 4 E= -2.80875259032782  delta_E= -1.67e-10  |g|= 1.61e-06  |ddm|= 0.00641
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.825261333186316  E_coul = 1.0165087428585
  HOMO = -0.896121923734759  LUMO = 1.23822373474749
  mo_energy =
[-0.89612192  1.23822373  5.03693324 13.08330129 25.56145629]
E1 = -3.8252612251115035  E_coul = 1.0165086347834078
Extra cycle  E= -2.8087525903281  delta_E= -2.8e-13  |g|= 1.53e-07  |ddm|= 0.000207
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [3.98259028 3.2768591  2.62273935 1.64460648 0.35858321]
E = -2.808752590328096
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:05 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.98259027707        1
[INPUT] 0    0    [1    /1   ]  3.27685909782        1
[INPUT] 0    0    [1    /1   ]  2.62273935473        1
[INPUT] 0    0    [1    /1   ]  1.64460648229        1
[INPUT] 0    0    [1    /1   ]  0.358583207657       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [3.9825902770664277, 1.0]], [0, [3.276859097823821, 1.0]], [0, [2.6227393547273476, 1.0]], [0, [1.6446064822942867, 1.0]], [0, [0.35858320765736373, 1.0]]]}
ecp = {}
CPU time:        16.54
Set gradient conv threshold to 3.16228e-05
cond(S) = 366426.18720369507
E1 = -3.8252672079376637  E_coul = 1.022355176356984
init E= -2.80291203158068
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.893142489220938  LUMO = 1.23706818945363
  mo_energy =
[-0.89314249  1.23706819  5.03845811 13.08768374 25.57254907]
E1 = -3.8258656489413725  E_coul = 1.0171207215842688
cycle= 1 E= -2.8087449273571  delta_E= -0.00583  |g|= 0.0109  |ddm|= 21.1
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.895815650596139  LUMO = 1.2383102283104
  mo_energy =
[-0.89581565  1.23831023  5.03723699 13.08382399 25.56245309]
E1 = -3.8252643151327326  E_coul = 1.0165117752218658
cycle= 2 E= -2.80875253991087  delta_E= -7.61e-06  |g|= 0.000763  |ddm|= 1.28
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.896140525974235  LUMO = 1.23821269110571
  mo_energy =
[-0.89614053  1.23821269  5.0369066  13.08326512 25.56140952]
E1 = -3.825256581619076  E_coul = 1.016503991458485
cycle= 3 E= -2.80875259016059  delta_E= -5.02e-08  |g|= 3.32e-05  |ddm|= 0.122
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.896121424289334  LUMO = 1.23822406161286
  mo_energy =
[-0.89612142  1.23822406  5.03693393 13.08330222 25.56145758]
E1 = -3.825261333186316  E_coul = 1.0165087428585
cycle= 4 E= -2.80875259032782  delta_E= -1.67e-10  |g|= 1.61e-06  |ddm|= 0.00641
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.825261333186316  E_coul = 1.0165087428585
  HOMO = -0.896121923734759  LUMO = 1.23822373474749
  mo_energy =
[-0.89612192  1.23822373  5.03693324 13.08330129 25.56145629]
E1 = -3.8252612251115035  E_coul = 1.0165086347834078
Extra cycle  E= -2.8087525903281  delta_E= -2.8e-13  |g|= 1.53e-07  |ddm|= 0.000207
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 366426.18720369507
E1 = -3.8252612251115035  E_coul = 1.0165086347834078
init E= -2.8087525903281
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.896121977772343  LUMO = 1.23822369899726
  mo_energy =
[-0.89612198  1.2382237   5.03693316 13.08330119 25.56145616]
E1 = -3.825261210453593  E_coul = 1.0165086201255296
cycle= 1 E= -2.80875259032806  delta_E= 3.24e-14  |g|= 1.88e-08  |ddm|= 2.63e-05
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.825261210453593  E_coul = 1.0165086201255296
  HOMO = -0.896121985101267  LUMO = 1.23822369436668
  mo_energy =
[-0.89612199  1.23822369  5.03693315 13.08330117 25.56145614]
E1 = -3.8252612083988913  E_coul = 1.016508618070615
Extra cycle  E= -2.80875259032828  delta_E= -2.13e-13  |g|= 2.45e-09  |ddm|= 3.2e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [3.98259028 3.2768591  2.62273935 1.64460648 0.35858321]
grad_E = [-0.00539796 -0.00454762 -0.00387332  0.00020934  0.00825192]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:07 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  4.85869893744        1
[INPUT] 0    0    [1    /1   ]  4.03138914511        1
[INPUT] 0    0    [1    /1   ]  3.28705356573        1
[INPUT] 0    0    [1    /1   ]  2.02163878024        1
[INPUT] 0    0    [1    /1   ]  0.35394680557        1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [4.8586989374449105, 1.0]], [0, [4.031389145113703, 1.0]], [0, [3.2870535657280304, 1.0]], [0, [2.021638780238164, 1.0]], [0, [0.3539468055704539, 1.0]]]}
ecp = {}
CPU time:        18.39
Set gradient conv threshold to 3.16228e-05
cond(S) = 420249.9329959006
E1 = -3.8331767724879295  E_coul = 1.0227479008143454
init E= -2.81042887167358
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.896494343506559  LUMO = 1.37983210107449
  mo_energy =
[-0.89649434  1.3798321   6.03741768 15.93593842 31.48905351]
E1 = -3.8308893350403554  E_coul = 1.015068431459408
cycle= 1 E= -2.81582090358095  delta_E= -0.00539  |g|= 0.00881  |ddm|= 9.48
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.900378538325106  LUMO = 1.37936497671018
  mo_energy =
[-0.90037854  1.37936498  6.03273839 15.92782627 31.47484868]
E1 = -3.829919817337097  E_coul = 1.0140940533275675
cycle= 2 E= -2.81582576400953  delta_E= -4.86e-06  |g|= 0.00037  |ddm|= 0.539
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.900889970465123  LUMO = 1.37906966089394
  mo_energy =
[-0.90088997  1.37906966  6.03197123 15.92672833 31.47325442]
E1 = -3.8298484524228225  E_coul = 1.0140226695646608
cycle= 3 E= -2.81582578285816  delta_E= -1.88e-08  |g|= 2.16e-05  |ddm|= 0.0348
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.900902991145183  LUMO = 1.3790613566097
  mo_energy =
[-0.90090299  1.37906136  6.03194966 15.92669962 31.47321886]
E1 = -3.829845423376561  E_coul = 1.014019640460041
cycle= 4 E= -2.81582578291652  delta_E= -5.84e-11  |g|= 2.8e-07  |ddm|= 0.0015
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.829845423376561  E_coul = 1.014019640460041
  HOMO = -0.900903071228242  LUMO = 1.37906129328523
  mo_energy =
[-0.90090307  1.37906129  6.03194953 15.92669945 31.47321866]
E1 = -3.8298454055712527  E_coul = 1.014019622654729
Extra cycle  E= -2.81582578291652  delta_E= -3.55e-15  |g|= 2.65e-08  |ddm|= 3.4e-05
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [4.85869894 4.03138915 3.28705357 2.02163878 0.35394681]
E = -2.815825782916524
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:07 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  4.85869893744        1
[INPUT] 0    0    [1    /1   ]  4.03138914511        1
[INPUT] 0    0    [1    /1   ]  3.28705356573        1
[INPUT] 0    0    [1    /1   ]  2.02163878024        1
[INPUT] 0    0    [1    /1   ]  0.35394680557        1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [4.8586989374449105, 1.0]], [0, [4.031389145113703, 1.0]], [0, [3.2870535657280304, 1.0]], [0, [2.021638780238164, 1.0]], [0, [0.3539468055704539, 1.0]]]}
ecp = {}
CPU time:        18.56
Set gradient conv threshold to 3.16228e-05
cond(S) = 420249.9329959006
E1 = -3.8331767724879295  E_coul = 1.0227479008143454
init E= -2.81042887167358
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.896494343506559  LUMO = 1.37983210107449
  mo_energy =
[-0.89649434  1.3798321   6.03741768 15.93593842 31.48905351]
E1 = -3.8308893350403554  E_coul = 1.015068431459408
cycle= 1 E= -2.81582090358095  delta_E= -0.00539  |g|= 0.00881  |ddm|= 9.48
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.900378538325106  LUMO = 1.37936497671018
  mo_energy =
[-0.90037854  1.37936498  6.03273839 15.92782627 31.47484868]
E1 = -3.829919817337097  E_coul = 1.0140940533275675
cycle= 2 E= -2.81582576400953  delta_E= -4.86e-06  |g|= 0.00037  |ddm|= 0.539
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.900889970465123  LUMO = 1.37906966089394
  mo_energy =
[-0.90088997  1.37906966  6.03197123 15.92672833 31.47325442]
E1 = -3.8298484524228225  E_coul = 1.0140226695646608
cycle= 3 E= -2.81582578285816  delta_E= -1.88e-08  |g|= 2.16e-05  |ddm|= 0.0348
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.900902991145183  LUMO = 1.3790613566097
  mo_energy =
[-0.90090299  1.37906136  6.03194966 15.92669962 31.47321886]
E1 = -3.829845423376561  E_coul = 1.014019640460041
cycle= 4 E= -2.81582578291652  delta_E= -5.84e-11  |g|= 2.8e-07  |ddm|= 0.0015
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.829845423376561  E_coul = 1.014019640460041
  HOMO = -0.900903071228242  LUMO = 1.37906129328523
  mo_energy =
[-0.90090307  1.37906129  6.03194953 15.92669945 31.47321866]
E1 = -3.8298454055712527  E_coul = 1.014019622654729
Extra cycle  E= -2.81582578291652  delta_E= -3.55e-15  |g|= 2.65e-08  |ddm|= 3.4e-05
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 420249.9329959006
E1 = -3.8298454055712527  E_coul = 1.014019622654729
init E= -2.81582578291652
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.900903080130895  LUMO = 1.37906128632797
  mo_energy =
[-0.90090308  1.37906129  6.03194951 15.92669943 31.47321864]
E1 = -3.8298454032718565  E_coul = 1.0140196203553398
cycle= 1 E= -2.81582578291652  delta_E= 7.11e-15  |g|= 2.98e-09  |ddm|= 2.81e-06
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8298454032718565  E_coul = 1.0140196203553398
  HOMO = -0.900903081280595  LUMO = 1.37906128548763
  mo_energy =
[-0.90090308  1.37906129  6.03194951 15.92669943 31.47321864]
E1 = -3.8298454029755207  E_coul = 1.014019620059009
Extra cycle  E= -2.81582578291651  delta_E= 5.33e-15  |g|= 3.49e-10  |ddm|= 2.76e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [4.85869894 4.03138915 3.28705357 2.02163878 0.35394681]
grad_E = [-0.00321207 -0.00238254 -0.00154289  0.00458364 -0.0479669 ]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:09 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.01946699012        1
[INPUT] 0    0    [1    /1   ]  5.03093405035        1
[INPUT] 0    0    [1    /1   ]  4.16749449531        1
[INPUT] 0    0    [1    /1   ]  2.51643817224        1
[INPUT] 0    0    [1    /1   ]  0.44700114898        1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [6.019466990121753, 1.0]], [0, [5.030934050354155, 1.0]], [0, [4.167494495311912, 1.0]], [0, [2.5164381722408673, 1.0]], [0, [0.4470011489802285, 1.0]]]}
ecp = {}
CPU time:        20.42
Set gradient conv threshold to 3.16228e-05
cond(S) = 526328.5809045001
E1 = -3.8286156774991293  E_coul = 1.0242401591971406
init E= -2.80437551830199
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.897117935329135  LUMO = 1.84343453922827
  mo_energy =
[-0.89711794  1.84343454  7.73351311 20.10497556 39.77137983]
E1 = -3.860357358114654  E_coul = 1.0417370090030504
cycle= 1 E= -2.8186203491116  delta_E= -0.0142  |g|= 0.0173  |ddm|= 51.8
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.888449100134904  LUMO = 1.85553564006089
  mo_energy =
[-0.8884491   1.85553564  7.75066884 20.12445087 39.79108101]
E1 = -3.860342794319317  E_coul = 1.0417064070929627
cycle= 2 E= -2.81863638722635  delta_E= -1.6e-05  |g|= 0.00127  |ddm|= 1.77
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.888466198805677  LUMO = 1.85562594834775
  mo_energy =
[-0.8884662   1.85562595  7.75070497 20.12437367 39.79064663]
E1 = -3.860381475340085  E_coul = 1.0417449756717816
cycle= 3 E= -2.8186364996683  delta_E= -1.12e-07  |g|= 3.53e-05  |ddm|= 0.129
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.888443292035599  LUMO = 1.85564318425857
  mo_energy =
[-0.88844329  1.85564318  7.75074631 20.12442841 39.79071655]
E1 = -3.860386016812782  E_coul = 1.0417495170161195
cycle= 4 E= -2.81863649979666  delta_E= -1.28e-10  |g|= 9.85e-07  |ddm|= 0.00232
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.860386016812782  E_coul = 1.0417495170161195
  HOMO = -0.888443491390279  LUMO = 1.85564304797337
  mo_energy =
[-0.88844349  1.85564305  7.75074598 20.12442797 39.79071588]
E1 = -3.8603859824723354  E_coul = 1.0417494826757223
Extra cycle  E= -2.81863649979661  delta_E= 4.93e-14  |g|= 3.75e-08  |ddm|= 2.65e-05
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [6.01946699 5.03093405 4.1674945  2.51643817 0.44700115]
E = -2.818636499796613
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:09 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.01946699012        1
[INPUT] 0    0    [1    /1   ]  5.03093405035        1
[INPUT] 0    0    [1    /1   ]  4.16749449531        1
[INPUT] 0    0    [1    /1   ]  2.51643817224        1
[INPUT] 0    0    [1    /1   ]  0.44700114898        1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [6.019466990121753, 1.0]], [0, [5.030934050354155, 1.0]], [0, [4.167494495311912, 1.0]], [0, [2.5164381722408673, 1.0]], [0, [0.4470011489802285, 1.0]]]}
ecp = {}
CPU time:        20.60
Set gradient conv threshold to 3.16228e-05
cond(S) = 526328.5809045001
E1 = -3.8286156774991293  E_coul = 1.0242401591971406
init E= -2.80437551830199
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.897117935329135  LUMO = 1.84343453922827
  mo_energy =
[-0.89711794  1.84343454  7.73351311 20.10497556 39.77137983]
E1 = -3.860357358114654  E_coul = 1.0417370090030504
cycle= 1 E= -2.8186203491116  delta_E= -0.0142  |g|= 0.0173  |ddm|= 51.8
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.888449100134904  LUMO = 1.85553564006089
  mo_energy =
[-0.8884491   1.85553564  7.75066884 20.12445087 39.79108101]
E1 = -3.860342794319317  E_coul = 1.0417064070929627
cycle= 2 E= -2.81863638722635  delta_E= -1.6e-05  |g|= 0.00127  |ddm|= 1.77
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.888466198805677  LUMO = 1.85562594834775
  mo_energy =
[-0.8884662   1.85562595  7.75070497 20.12437367 39.79064663]
E1 = -3.860381475340085  E_coul = 1.0417449756717816
cycle= 3 E= -2.8186364996683  delta_E= -1.12e-07  |g|= 3.53e-05  |ddm|= 0.129
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.888443292035599  LUMO = 1.85564318425857
  mo_energy =
[-0.88844329  1.85564318  7.75074631 20.12442841 39.79071655]
E1 = -3.860386016812782  E_coul = 1.0417495170161195
cycle= 4 E= -2.81863649979666  delta_E= -1.28e-10  |g|= 9.85e-07  |ddm|= 0.00232
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.860386016812782  E_coul = 1.0417495170161195
  HOMO = -0.888443491390279  LUMO = 1.85564304797337
  mo_energy =
[-0.88844349  1.85564305  7.75074598 20.12442797 39.79071588]
E1 = -3.8603859824723354  E_coul = 1.0417494826757223
Extra cycle  E= -2.81863649979661  delta_E= 4.93e-14  |g|= 3.75e-08  |ddm|= 2.65e-05
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 526328.5809045001
E1 = -3.8603859824723354  E_coul = 1.0417494826757223
init E= -2.81863649979661
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.888443508560449  LUMO = 1.85564303512191
  mo_energy =
[-0.88844351  1.85564304  7.75074595 20.12442793 39.79071582]
E1 = -3.860385979171417  E_coul = 1.0417494793747974
cycle= 1 E= -2.81863649979662  delta_E= -6.22e-15  |g|= 2.92e-09  |ddm|= 9.78e-07
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.860385979171417  E_coul = 1.0417494793747974
  HOMO = -0.88844351021091  LUMO = 1.85564303385811
  mo_energy =
[-0.88844351  1.85564303  7.75074595 20.12442792 39.79071582]
E1 = -3.860385978840742  E_coul = 1.0417494790440718
Extra cycle  E= -2.81863649979667  delta_E= -5.11e-14  |g|= 3e-10  |ddm|= 1.96e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [6.01946699 5.03093405 4.1674945  2.51643817 0.44700115]
grad_E = [-0.00197904 -0.00154832 -0.00115159  0.00196684  0.08214409]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:11 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.21374808808        1
[INPUT] 0    0    [1    /1   ]  5.19781538119        1
[INPUT] 0    0    [1    /1   ]  4.31360741535        1
[INPUT] 0    0    [1    /1   ]  2.59426491227        1
[INPUT] 0    0    [1    /1   ]  0.416330334139       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [6.213748088082898, 1.0]], [0, [5.197815381194545, 1.0]], [0, [4.313607415350813, 1.0]], [0, [2.5942649122669037, 1.0]], [0, [0.4163303341393859, 1.0]]]}
ecp = {}
CPU time:        22.44
Set gradient conv threshold to 3.16228e-05
cond(S) = 515919.8912911395
E1 = -3.8361261322709286  E_coul = 1.0240804492145155
init E= -2.81204568305641
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.898229190769509  LUMO = 1.79106633999769
  mo_energy =
[-0.89822919  1.79106634  7.84669981 20.61647965 40.96585441]
E1 = -3.8507014357828524  E_coul = 1.0301348775686097
cycle= 1 E= -2.82056655821424  delta_E= -0.00852  |g|= 0.00833  |ddm|= 3.91
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.89521761402131  LUMO = 1.79705251477264
  mo_energy =
[-0.89521761  1.79705251  7.85324406 20.62262345 40.9696802 ]
E1 = -3.8501423790090272  E_coul = 1.0295720708410074
cycle= 2 E= -2.82057030816802  delta_E= -3.75e-06  |g|= 0.00047  |ddm|= 0.182
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.895515686217262  LUMO = 1.79687598429842
  mo_energy =
[-0.89551569  1.79687598  7.85273052 20.62186169 40.96849314]
E1 = -3.8501162790230254  E_coul = 1.0295459576281139
cycle= 3 E= -2.82057032139491  delta_E= -1.32e-08  |g|= 8.99e-06  |ddm|= 0.0164
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.895512049810246  LUMO = 1.79687918603149
  mo_energy =
[-0.89551205  1.79687919  7.85273727 20.62187034 40.96850403]
E1 = -3.8501169646053675  E_coul = 1.029546643204276
cycle= 4 E= -2.82057032140109  delta_E= -6.18e-12  |g|= 3.62e-07  |ddm|= 0.000523
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8501169646053675  E_coul = 1.029546643204276
  HOMO = -0.895511839098414  LUMO = 1.79687935151853
  mo_energy =
[-0.89551184  1.79687935  7.85273767 20.62187087 40.96850467]
E1 = -3.85011700648659  E_coul = 1.0295466850854824
Extra cycle  E= -2.82057032140111  delta_E= -1.6e-14  |g|= 3.73e-08  |ddm|= 1.73e-05
    CPU time for scf_cycle      0.06 sec, wall time      0.07 sec
exp = [6.21374809 5.19781538 4.31360742 2.59426491 0.41633033]
E = -2.8205703214011075
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:11 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.21374808808        1
[INPUT] 0    0    [1    /1   ]  5.19781538119        1
[INPUT] 0    0    [1    /1   ]  4.31360741535        1
[INPUT] 0    0    [1    /1   ]  2.59426491227        1
[INPUT] 0    0    [1    /1   ]  0.416330334139       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [6.213748088082898, 1.0]], [0, [5.197815381194545, 1.0]], [0, [4.313607415350813, 1.0]], [0, [2.5942649122669037, 1.0]], [0, [0.4163303341393859, 1.0]]]}
ecp = {}
CPU time:        22.64
Set gradient conv threshold to 3.16228e-05
cond(S) = 515919.8912911395
E1 = -3.8361261322709286  E_coul = 1.0240804492145155
init E= -2.81204568305641
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.898229190769509  LUMO = 1.79106633999769
  mo_energy =
[-0.89822919  1.79106634  7.84669981 20.61647965 40.96585441]
E1 = -3.8507014357828524  E_coul = 1.0301348775686097
cycle= 1 E= -2.82056655821424  delta_E= -0.00852  |g|= 0.00833  |ddm|= 3.91
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.89521761402131  LUMO = 1.79705251477264
  mo_energy =
[-0.89521761  1.79705251  7.85324406 20.62262345 40.9696802 ]
E1 = -3.8501423790090272  E_coul = 1.0295720708410074
cycle= 2 E= -2.82057030816802  delta_E= -3.75e-06  |g|= 0.00047  |ddm|= 0.182
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.895515686217262  LUMO = 1.79687598429842
  mo_energy =
[-0.89551569  1.79687598  7.85273052 20.62186169 40.96849314]
E1 = -3.8501162790230254  E_coul = 1.0295459576281139
cycle= 3 E= -2.82057032139491  delta_E= -1.32e-08  |g|= 8.99e-06  |ddm|= 0.0164
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.895512049810246  LUMO = 1.79687918603149
  mo_energy =
[-0.89551205  1.79687919  7.85273727 20.62187034 40.96850403]
E1 = -3.8501169646053675  E_coul = 1.029546643204276
cycle= 4 E= -2.82057032140109  delta_E= -6.18e-12  |g|= 3.62e-07  |ddm|= 0.000523
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8501169646053675  E_coul = 1.029546643204276
  HOMO = -0.895511839098414  LUMO = 1.79687935151853
  mo_energy =
[-0.89551184  1.79687935  7.85273767 20.62187087 40.96850467]
E1 = -3.85011700648659  E_coul = 1.0295466850854824
Extra cycle  E= -2.82057032140111  delta_E= -1.6e-14  |g|= 3.73e-08  |ddm|= 1.73e-05
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 515919.8912911395
E1 = -3.85011700648659  E_coul = 1.0295466850854824
init E= -2.82057032140111
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.895511818157813  LUMO = 1.79687936799474
  mo_energy =
[-0.89551182  1.79687937  7.85273771 20.62187092 40.96850473]
E1 = -3.8501170106752958  E_coul = 1.02954668927419
cycle= 1 E= -2.82057032140111  delta_E= 1.78e-15  |g|= 3.84e-09  |ddm|= 1.74e-06
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8501170106752958  E_coul = 1.02954668927419
  HOMO = -0.895511816063459  LUMO = 1.79687936965089
  mo_energy =
[-0.89551182  1.79687937  7.85273771 20.62187092 40.96850474]
E1 = -3.8501170110981247  E_coul = 1.029546689697022
Extra cycle  E= -2.8205703214011  delta_E= 3.11e-15  |g|= 3.95e-10  |ddm|= 1.79e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [6.21374809 5.19781538 4.31360742 2.59426491 0.41633033]
grad_E = [-0.00167523 -0.00111315 -0.00052373  0.00438391  0.00975046]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:13 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.46653216507        1
[INPUT] 0    0    [1    /1   ]  5.4150016357         1
[INPUT] 0    0    [1    /1   ]  4.50410702504        1
[INPUT] 0    0    [1    /1   ]  2.69518481875        1
[INPUT] 0    0    [1    /1   ]  0.416181517228       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [6.466532165069939, 1.0]], [0, [5.4150016356968, 1.0]], [0, [4.504107025037732, 1.0]], [0, [2.6951848187455623, 1.0]], [0, [0.4161815172275609, 1.0]]]}
ecp = {}
CPU time:        24.60
Set gradient conv threshold to 3.16228e-05
cond(S) = 521872.49277775275
E1 = -3.83642564126859  E_coul = 1.0240749725087843
init E= -2.81235066875981
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.898332599097813  LUMO = 1.83386042375574
  mo_energy =
[-0.8983326   1.83386042  8.13782557 21.43410655 42.6764059 ]
E1 = -3.8495957907746536  E_coul = 1.028832232835592
cycle= 1 E= -2.82076355793906  delta_E= -0.00841  |g|= 0.00746  |ddm|= 0.262
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.895967177252581  LUMO = 1.8392246661425
  mo_energy =
[-0.89596718  1.83922467  8.14308816 21.43861811 42.67839799]
E1 = -3.8489133801508455  E_coul = 1.0281466369763792
cycle= 2 E= -2.82076674317447  delta_E= -3.19e-06  |g|= 0.00034  |ddm|= 0.00826
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.896328888011075  LUMO = 1.83897994799336
  mo_energy =
[-0.89632889  1.83897995  8.14242872 21.43767733 42.67701546]
E1 = -3.848873003705303  E_coul = 1.028106251621618
cycle= 3 E= -2.82076675208368  delta_E= -8.91e-09  |g|= 6.18e-06  |ddm|= 0.00264
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.896330378238319  LUMO = 1.83897912107852
  mo_energy =
[-0.89633038  1.83897912  8.14242572 21.43767327 42.67701049]
E1 = -3.8488726924000494  E_coul = 1.0281059403151285
cycle= 4 E= -2.82076675208492  delta_E= -1.24e-12  |g|= 6.87e-08  |ddm|= 0.000126
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8488726924000494  E_coul = 1.0281059403151285
  HOMO = -0.896330405884898  LUMO = 1.83897909691959
  mo_energy =
[-0.89633041  1.8389791   8.14242567 21.4376732  42.67701041]
E1 = -3.84887268758717  E_coul = 1.0281059355022508
Extra cycle  E= -2.82076675208492  delta_E= 1.78e-15  |g|= 5.9e-09  |ddm|= 3.26e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [6.46653217 5.41500164 4.50410703 2.69518482 0.41618152]
E = -2.820766752084919
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:14 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.46653216507        1
[INPUT] 0    0    [1    /1   ]  5.4150016357         1
[INPUT] 0    0    [1    /1   ]  4.50410702504        1
[INPUT] 0    0    [1    /1   ]  2.69518481875        1
[INPUT] 0    0    [1    /1   ]  0.416181517228       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [6.466532165069939, 1.0]], [0, [5.4150016356968, 1.0]], [0, [4.504107025037732, 1.0]], [0, [2.6951848187455623, 1.0]], [0, [0.4161815172275609, 1.0]]]}
ecp = {}
CPU time:        24.82
Set gradient conv threshold to 3.16228e-05
cond(S) = 521872.49277775275
E1 = -3.83642564126859  E_coul = 1.0240749725087843
init E= -2.81235066875981
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.898332599097813  LUMO = 1.83386042375574
  mo_energy =
[-0.8983326   1.83386042  8.13782557 21.43410655 42.6764059 ]
E1 = -3.8495957907746536  E_coul = 1.028832232835592
cycle= 1 E= -2.82076355793906  delta_E= -0.00841  |g|= 0.00746  |ddm|= 0.262
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.895967177252581  LUMO = 1.8392246661425
  mo_energy =
[-0.89596718  1.83922467  8.14308816 21.43861811 42.67839799]
E1 = -3.8489133801508455  E_coul = 1.0281466369763792
cycle= 2 E= -2.82076674317447  delta_E= -3.19e-06  |g|= 0.00034  |ddm|= 0.00826
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.896328888011075  LUMO = 1.83897994799336
  mo_energy =
[-0.89632889  1.83897995  8.14242872 21.43767733 42.67701546]
E1 = -3.848873003705303  E_coul = 1.028106251621618
cycle= 3 E= -2.82076675208368  delta_E= -8.91e-09  |g|= 6.18e-06  |ddm|= 0.00264
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.896330378238319  LUMO = 1.83897912107852
  mo_energy =
[-0.89633038  1.83897912  8.14242572 21.43767327 42.67701049]
E1 = -3.8488726924000494  E_coul = 1.0281059403151285
cycle= 4 E= -2.82076675208492  delta_E= -1.24e-12  |g|= 6.87e-08  |ddm|= 0.000126
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8488726924000494  E_coul = 1.0281059403151285
  HOMO = -0.896330405884898  LUMO = 1.83897909691959
  mo_energy =
[-0.89633041  1.8389791   8.14242567 21.4376732  42.67701041]
E1 = -3.84887268758717  E_coul = 1.0281059355022508
Extra cycle  E= -2.82076675208492  delta_E= 1.78e-15  |g|= 5.9e-09  |ddm|= 3.26e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 521872.49277775275
E1 = -3.84887268758717  E_coul = 1.0281059355022508
init E= -2.82076675208492
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.896330408291334  LUMO = 1.83897909476778
  mo_energy =
[-0.89633041  1.83897909  8.14242567 21.43767319 42.6770104 ]
E1 = -3.8488726870931846  E_coul = 1.0281059350082669
cycle= 1 E= -2.82076675208492  delta_E= 1.33e-15  |g|= 5.67e-10  |ddm|= 2.62e-07
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8488726870931846  E_coul = 1.0281059350082669
  HOMO = -0.896330408538325  LUMO = 1.83897909455411
  mo_energy =
[-0.89633041  1.83897909  8.14242567 21.43767319 42.6770104 ]
E1 = -3.848872687041731  E_coul = 1.0281059349568087
Extra cycle  E= -2.82076675208492  delta_E= -4.44e-15  |g|= 5.59e-11  |ddm|= 2.31e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [6.46653217 5.41500164 4.50410703 2.69518482 0.41618152]
grad_E = [-0.00143677 -0.00085542 -0.00022537  0.00516087 -0.00600322]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:16 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.6170100238         1
[INPUT] 0    0    [1    /1   ]  5.54399873295        1
[INPUT] 0    0    [1    /1   ]  4.61688805245        1
[INPUT] 0    0    [1    /1   ]  2.75072085283        1
[INPUT] 0    0    [1    /1   ]  0.420989773045       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [6.617010023799878, 1.0]], [0, [5.543998732947184, 1.0]], [0, [4.616888052451694, 1.0]], [0, [2.750720852832628, 1.0]], [0, [0.4209897730445017, 1.0]]]}
ecp = {}
CPU time:        26.90
Set gradient conv threshold to 3.16228e-05
cond(S) = 524320.5809298754
E1 = -3.836218912503257  E_coul = 1.024171604744659
init E= -2.8120473077586
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.898320427240843  LUMO = 1.8729581293524
  mo_energy =
[-0.89832043  1.87295813  8.32447296 21.92907398 43.69856398]
E1 = -3.850791419909525  E_coul = 1.0299598733177049
cycle= 1 E= -2.82083154659182  delta_E= -0.00878  |g|= 0.00748  |ddm|= 0.145
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.895437356375027  LUMO = 1.87892269044293
  mo_energy =
[-0.89543736  1.87892269  8.33070861 21.93478008 43.70203191]
E1 = -3.8501206641036867  E_coul = 1.0292859204023124
cycle= 2 E= -2.82083474370137  delta_E= -3.2e-06  |g|= 0.000349  |ddm|= 0.0106
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.89579301544648  LUMO = 1.87867881135104
  mo_energy =
[-0.89579302  1.87867881  8.33004938 21.93384018 43.70065109]
E1 = -3.8500813275839216  E_coul = 1.0292465748160036
cycle= 3 E= -2.82083475276792  delta_E= -9.07e-09  |g|= 6.01e-06  |ddm|= 0.00323
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.895794194669071  LUMO = 1.87867821455589
  mo_energy =
[-0.89579419  1.87867821  8.33004694 21.93383685 43.70064704]
E1 = -3.8500810792899656  E_coul = 1.0292463265209566
cycle= 4 E= -2.82083475276901  delta_E= -1.09e-12  |g|= 4.41e-08  |ddm|= 0.000128
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8500810792899656  E_coul = 1.0292463265209566
  HOMO = -0.895794213124027  LUMO = 1.87867819862424
  mo_energy =
[-0.89579421  1.8786782   8.33004691 21.93383681 43.70064698]
E1 = -3.850081076204895  E_coul = 1.0292463234358822
Extra cycle  E= -2.82083475276901  delta_E= -4e-15  |g|= 3.74e-09  |ddm|= 1.87e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [6.61701002 5.54399873 4.61688805 2.75072085 0.42098977]
E = -2.820834752769013
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:16 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.6170100238         1
[INPUT] 0    0    [1    /1   ]  5.54399873295        1
[INPUT] 0    0    [1    /1   ]  4.61688805245        1
[INPUT] 0    0    [1    /1   ]  2.75072085283        1
[INPUT] 0    0    [1    /1   ]  0.420989773045       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [6.617010023799878, 1.0]], [0, [5.543998732947184, 1.0]], [0, [4.616888052451694, 1.0]], [0, [2.750720852832628, 1.0]], [0, [0.4209897730445017, 1.0]]]}
ecp = {}
CPU time:        27.18
Set gradient conv threshold to 3.16228e-05
cond(S) = 524320.5809298754
E1 = -3.836218912503257  E_coul = 1.024171604744659
init E= -2.8120473077586
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.898320427240843  LUMO = 1.8729581293524
  mo_energy =
[-0.89832043  1.87295813  8.32447296 21.92907398 43.69856398]
E1 = -3.850791419909525  E_coul = 1.0299598733177049
cycle= 1 E= -2.82083154659182  delta_E= -0.00878  |g|= 0.00748  |ddm|= 0.145
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.895437356375027  LUMO = 1.87892269044293
  mo_energy =
[-0.89543736  1.87892269  8.33070861 21.93478008 43.70203191]
E1 = -3.8501206641036867  E_coul = 1.0292859204023124
cycle= 2 E= -2.82083474370137  delta_E= -3.2e-06  |g|= 0.000349  |ddm|= 0.0106
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.89579301544648  LUMO = 1.87867881135104
  mo_energy =
[-0.89579302  1.87867881  8.33004938 21.93384018 43.70065109]
E1 = -3.8500813275839216  E_coul = 1.0292465748160036
cycle= 3 E= -2.82083475276792  delta_E= -9.07e-09  |g|= 6.01e-06  |ddm|= 0.00323
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.895794194669071  LUMO = 1.87867821455589
  mo_energy =
[-0.89579419  1.87867821  8.33004694 21.93383685 43.70064704]
E1 = -3.8500810792899656  E_coul = 1.0292463265209566
cycle= 4 E= -2.82083475276901  delta_E= -1.09e-12  |g|= 4.41e-08  |ddm|= 0.000128
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8500810792899656  E_coul = 1.0292463265209566
  HOMO = -0.895794213124027  LUMO = 1.87867819862424
  mo_energy =
[-0.89579421  1.8786782   8.33004691 21.93383681 43.70064698]
E1 = -3.850081076204895  E_coul = 1.0292463234358822
Extra cycle  E= -2.82083475276901  delta_E= -4e-15  |g|= 3.74e-09  |ddm|= 1.87e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 524320.5809298754
E1 = -3.850081076204895  E_coul = 1.0292463234358822
init E= -2.82083475276901
    CPU time for initialize scf      0.04 sec, wall time      0.05 sec
  HOMO = -0.895794214666568  LUMO = 1.87867819722895
  mo_energy =
[-0.89579421  1.8786782   8.33004691 21.93383681 43.70064698]
E1 = -3.850081075892919  E_coul = 1.0292463231239077
cycle= 1 E= -2.82083475276901  delta_E= 1.78e-15  |g|= 3.55e-10  |ddm|= 1.51e-07
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.850081075892919  E_coul = 1.0292463231239077
  HOMO = -0.895794214822549  LUMO = 1.87867819709144
  mo_energy =
[-0.89579421  1.8786782   8.33004691 21.93383681 43.70064698]
E1 = -3.8500810758609103  E_coul = 1.0292463230919024
Extra cycle  E= -2.82083475276901  delta_E= 3.55e-15  |g|= 3.43e-11  |ddm|= 1.32e-08
    CPU time for scf_cycle      0.09 sec, wall time      0.09 sec
exp = [6.61701002 5.54399873 4.61688805 2.75072085 0.42098977]
grad_E = [-0.00134029 -0.00077296 -0.00015604  0.00522625 -0.00280041]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:18 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.74188010277        1
[INPUT] 0    0    [1    /1   ]  5.6504393562         1
[INPUT] 0    0    [1    /1   ]  4.70911680786        1
[INPUT] 0    0    [1    /1   ]  2.78755813866        1
[INPUT] 0    0    [1    /1   ]  0.424919422526       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [6.74188010276534, 1.0]], [0, [5.650439356202152, 1.0]], [0, [4.709116807859679, 1.0]], [0, [2.7875581386608728, 1.0]], [0, [0.42491942252608633, 1.0]]]}
ecp = {}
CPU time:        29.11
Set gradient conv threshold to 3.16228e-05
cond(S) = 519866.69466877193
E1 = -3.8360482409226333  E_coul = 1.0242536639984383
init E= -2.81179457692419
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.898314229733363  LUMO = 1.90347822735019
  mo_energy =
[-0.89831423  1.90347823  8.46903251 22.31724716 44.51357045]
E1 = -3.8518674562042774  E_coul = 1.0309699176923617
cycle= 1 E= -2.82089753851192  delta_E= -0.0091  |g|= 0.00754  |ddm|= 0.525
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.89496534101287  LUMO = 1.90998615662777
  mo_energy =
[-0.89496534  1.90998616  8.47616327 22.32405172 44.51838441]
E1 = -3.8512119060303274  E_coul = 1.0303111460802925
cycle= 2 E= -2.82090075995003  delta_E= -3.22e-06  |g|= 0.000361  |ddm|= 0.0239
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.895313105254229  LUMO = 1.90974617743517
  mo_energy =
[-0.89531311  1.90974618  8.47551091 22.32312046 44.51701378]
E1 = -3.8511739990898364  E_coul = 1.030273229857639
cycle= 3 E= -2.8209007692322  delta_E= -9.28e-09  |g|= 5.87e-06  |ddm|= 0.00396
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.895313848125647  LUMO = 1.90974592421885
  mo_energy =
[-0.89531385  1.90974592  8.47550932 22.32311823 44.51701108]
E1 = -3.8511738355581207  E_coul = 1.0302730663249358
cycle= 4 E= -2.82090076923318  delta_E= -9.87e-13  |g|= 6.02e-09  |ddm|= 0.000137
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8511738355581207  E_coul = 1.0302730663249358
  HOMO = -0.895313851454126  LUMO = 1.90974592225978
  mo_energy =
[-0.89531385  1.90974592  8.47550931 22.32311822 44.51701107]
E1 = -3.8511738352178466  E_coul = 1.030273065984661
Extra cycle  E= -2.82090076923319  delta_E= -8.88e-16  |g|= 4.3e-10  |ddm|= 1.15e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [6.7418801  5.65043936 4.70911681 2.78755814 0.42491942]
E = -2.8209007692331856
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:18 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.74188010277        1
[INPUT] 0    0    [1    /1   ]  5.6504393562         1
[INPUT] 0    0    [1    /1   ]  4.70911680786        1
[INPUT] 0    0    [1    /1   ]  2.78755813866        1
[INPUT] 0    0    [1    /1   ]  0.424919422526       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [6.74188010276534, 1.0]], [0, [5.650439356202152, 1.0]], [0, [4.709116807859679, 1.0]], [0, [2.7875581386608728, 1.0]], [0, [0.42491942252608633, 1.0]]]}
ecp = {}
CPU time:        29.35
Set gradient conv threshold to 3.16228e-05
cond(S) = 519866.69466877193
E1 = -3.8360482409226333  E_coul = 1.0242536639984383
init E= -2.81179457692419
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.898314229733363  LUMO = 1.90347822735019
  mo_energy =
[-0.89831423  1.90347823  8.46903251 22.31724716 44.51357045]
E1 = -3.8518674562042774  E_coul = 1.0309699176923617
cycle= 1 E= -2.82089753851192  delta_E= -0.0091  |g|= 0.00754  |ddm|= 0.525
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.89496534101287  LUMO = 1.90998615662777
  mo_energy =
[-0.89496534  1.90998616  8.47616327 22.32405172 44.51838441]
E1 = -3.8512119060303274  E_coul = 1.0303111460802925
cycle= 2 E= -2.82090075995003  delta_E= -3.22e-06  |g|= 0.000361  |ddm|= 0.0239
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.895313105254229  LUMO = 1.90974617743517
  mo_energy =
[-0.89531311  1.90974618  8.47551091 22.32312046 44.51701378]
E1 = -3.8511739990898364  E_coul = 1.030273229857639
cycle= 3 E= -2.8209007692322  delta_E= -9.28e-09  |g|= 5.87e-06  |ddm|= 0.00396
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.895313848125647  LUMO = 1.90974592421885
  mo_energy =
[-0.89531385  1.90974592  8.47550932 22.32311823 44.51701108]
E1 = -3.8511738355581207  E_coul = 1.0302730663249358
cycle= 4 E= -2.82090076923318  delta_E= -9.87e-13  |g|= 6.02e-09  |ddm|= 0.000137
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8511738355581207  E_coul = 1.0302730663249358
  HOMO = -0.895313851454126  LUMO = 1.90974592225978
  mo_energy =
[-0.89531385  1.90974592  8.47550931 22.32311822 44.51701107]
E1 = -3.8511738352178466  E_coul = 1.030273065984661
Extra cycle  E= -2.82090076923319  delta_E= -8.88e-16  |g|= 4.3e-10  |ddm|= 1.15e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 519866.69466877193
E1 = -3.8511738352178466  E_coul = 1.030273065984661
init E= -2.82090076923319
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.895313851624265  LUMO = 1.90974592210616
  mo_energy =
[-0.89531385  1.90974592  8.47550931 22.32311822 44.51701107]
E1 = -3.8511738351828972  E_coul = 1.0302730659497155
cycle= 1 E= -2.82090076923318  delta_E= 3.55e-15  |g|= 3.95e-11  |ddm|= 1.34e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8511738351828972  E_coul = 1.0302730659497155
  HOMO = -0.895313851641737  LUMO = 1.9097459220906
  mo_energy =
[-0.89531385  1.90974592  8.47550931 22.32311822 44.51701107]
E1 = -3.8511738351793414  E_coul = 1.0302730659461574
Extra cycle  E= -2.82090076923318  delta_E= -1.78e-15  |g|= 3.82e-12  |ddm|= 1.28e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [6.7418801  5.65043936 4.70911681 2.78755814 0.42491942]
grad_E = [-0.00127333 -0.00071986 -0.00011828  0.00528099  0.00058165]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:20 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.94992082621        1
[INPUT] 0    0    [1    /1   ]  5.82639594755        1
[INPUT] 0    0    [1    /1   ]  4.85966656266        1
[INPUT] 0    0    [1    /1   ]  2.82767818971        1
[INPUT] 0    0    [1    /1   ]  0.430405489373       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [6.949920826208205, 1.0]], [0, [5.8263959475487805, 1.0]], [0, [4.859666562655192, 1.0]], [0, [2.827678189710162, 1.0]], [0, [0.4304054893726356, 1.0]]]}
ecp = {}
CPU time:        31.25
Set gradient conv threshold to 3.16228e-05
cond(S) = 498854.09200720215
E1 = -3.835858723735944  E_coul = 1.024373468951921
init E= -2.81148525478402
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.898336461336047  LUMO = 1.94694583745929
  mo_energy =
[-0.89833646  1.94694584  8.68209765 22.90782313 45.79086592]
E1 = -3.853500713782027  E_coul = 1.0324443718387304
cycle= 1 E= -2.8210563419433  delta_E= -0.00957  |g|= 0.00764  |ddm|= 0.99
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.894307532492702  LUMO = 1.95425754108647
  mo_energy =
[-0.89430753  1.95425754  8.69056102 22.91626033 45.79767906]
E1 = -3.8528679637465886  E_coul = 1.031808362798903
cycle= 2 E= -2.82105960094769  delta_E= -3.26e-06  |g|= 0.000379  |ddm|= 0.0395
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.894643412339845  LUMO = 1.95402368922181
  mo_energy =
[-0.89464341  1.95402369  8.68991951 22.91534198 45.79632414]
E1 = -3.8528321126553386  E_coul = 1.0317725020933513
cycle= 3 E= -2.82105961056199  delta_E= -9.61e-09  |g|= 5.75e-06  |ddm|= 0.00467
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.894643603981707  LUMO = 1.9540238787334
  mo_energy =
[-0.8946436   1.95402388  8.689919   22.91534115 45.79632316]
E1 = -3.85283205511002  E_coul = 1.0317724445470609
cycle= 4 E= -2.82105961056296  delta_E= -9.72e-13  |g|= 5.55e-08  |ddm|= 0.00014
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.85283205511002  E_coul = 1.0317724445470609
  HOMO = -0.894643583007949  LUMO = 1.95402389958846
  mo_energy =
[-0.89464358  1.9540239   8.68991904 22.9153412  45.79632323]
E1 = -3.85283205908176  E_coul = 1.031772448518803
Extra cycle  E= -2.82105961056296  delta_E= 1.78e-15  |g|= 4.62e-09  |ddm|= 2.08e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [6.94992083 5.82639595 4.85966656 2.82767819 0.43040549]
E = -2.8210596105629575
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:20 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.94992082621        1
[INPUT] 0    0    [1    /1   ]  5.82639594755        1
[INPUT] 0    0    [1    /1   ]  4.85966656266        1
[INPUT] 0    0    [1    /1   ]  2.82767818971        1
[INPUT] 0    0    [1    /1   ]  0.430405489373       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [6.949920826208205, 1.0]], [0, [5.8263959475487805, 1.0]], [0, [4.859666562655192, 1.0]], [0, [2.827678189710162, 1.0]], [0, [0.4304054893726356, 1.0]]]}
ecp = {}
CPU time:        31.51
Set gradient conv threshold to 3.16228e-05
cond(S) = 498854.09200720215
E1 = -3.835858723735944  E_coul = 1.024373468951921
init E= -2.81148525478402
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.898336461336047  LUMO = 1.94694583745929
  mo_energy =
[-0.89833646  1.94694584  8.68209765 22.90782313 45.79086592]
E1 = -3.853500713782027  E_coul = 1.0324443718387304
cycle= 1 E= -2.8210563419433  delta_E= -0.00957  |g|= 0.00764  |ddm|= 0.99
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.894307532492702  LUMO = 1.95425754108647
  mo_energy =
[-0.89430753  1.95425754  8.69056102 22.91626033 45.79767906]
E1 = -3.8528679637465886  E_coul = 1.031808362798903
cycle= 2 E= -2.82105960094769  delta_E= -3.26e-06  |g|= 0.000379  |ddm|= 0.0395
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.894643412339845  LUMO = 1.95402368922181
  mo_energy =
[-0.89464341  1.95402369  8.68991951 22.91534198 45.79632414]
E1 = -3.8528321126553386  E_coul = 1.0317725020933513
cycle= 3 E= -2.82105961056199  delta_E= -9.61e-09  |g|= 5.75e-06  |ddm|= 0.00467
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.894643603981707  LUMO = 1.9540238787334
  mo_energy =
[-0.8946436   1.95402388  8.689919   22.91534115 45.79632316]
E1 = -3.85283205511002  E_coul = 1.0317724445470609
cycle= 4 E= -2.82105961056296  delta_E= -9.72e-13  |g|= 5.55e-08  |ddm|= 0.00014
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.85283205511002  E_coul = 1.0317724445470609
  HOMO = -0.894643583007949  LUMO = 1.95402389958846
  mo_energy =
[-0.89464358  1.9540239   8.68991904 22.9153412  45.79632323]
E1 = -3.85283205908176  E_coul = 1.031772448518803
Extra cycle  E= -2.82105961056296  delta_E= 1.78e-15  |g|= 4.62e-09  |ddm|= 2.08e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 498854.09200720215
E1 = -3.85283205908176  E_coul = 1.031772448518803
init E= -2.82105961056296
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.89464358102208  LUMO = 1.95402390142033
  mo_energy =
[-0.89464358  1.9540239   8.68991905 22.91534121 45.79632324]
E1 = -3.8528320594692644  E_coul = 1.031772448906308
cycle= 1 E= -2.82105961056296  delta_E= 8.88e-16  |g|= 4.3e-10  |ddm|= 1.58e-07
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8528320594692644  E_coul = 1.031772448906308
  HOMO = -0.894643580828326  LUMO = 1.95402390159523
  mo_energy =
[-0.89464358  1.9540239   8.68991905 22.91534121 45.79632324]
E1 = -3.8528320595078154  E_coul = 1.03177244894486
Extra cycle  E= -2.82105961056296  delta_E= 1.33e-15  |g|= 4.09e-11  |ddm|= 1.34e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [6.94992083 5.82639595 4.85966656 2.82767819 0.43040549]
grad_E = [-1.18152497e-03 -6.51786029e-04 -7.90651416e-05  5.44712909e-03
  5.43642777e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:22 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  7.37950570168        1
[INPUT] 0    0    [1    /1   ]  6.18636748925        1
[INPUT] 0    0    [1    /1   ]  5.16296657791        1
[INPUT] 0    0    [1    /1   ]  2.85829100221        1
[INPUT] 0    0    [1    /1   ]  0.439284996586       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [7.379505701682186, 1.0]], [0, [6.186367489245186, 1.0]], [0, [5.162966577913284, 1.0]], [0, [2.858291002212206, 1.0]], [0, [0.43928499658563336, 1.0]]]}
ecp = {}
CPU time:        33.54
Set gradient conv threshold to 3.16228e-05
cond(S) = 434094.7360701773
E1 = -3.8356991943037997  E_coul = 1.0245821812580376
init E= -2.81111701304576
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.898464338181837  LUMO = 2.01798134938177
  mo_energy =
[-0.89846434  2.01798135  9.04999196 23.98475526 48.22899136]
E1 = -3.8565692266207563  E_coul = 1.035058123305871
cycle= 1 E= -2.82151110331489  delta_E= -0.0104  |g|= 0.00786  |ddm|= 1.59
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.893228074304911  LUMO = 2.02674221214986
  mo_energy =
[-0.89322807  2.02674221  9.06090026 23.99619019 48.23946484]
E1 = -3.8559826278193885  E_coul = 1.0344681838626513
cycle= 2 E= -2.82151444395674  delta_E= -3.34e-06  |g|= 0.000413  |ddm|= 0.0578
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.893539813513075  LUMO = 2.0265229832554
  mo_energy =
[-0.89353981  2.02652298  9.06028577 23.9953025  48.23814782]
E1 = -3.8559507957264803  E_coul = 1.0344363414626
cycle= 3 E= -2.82151445426388  delta_E= -1.03e-08  |g|= 5.77e-06  |ddm|= 0.00534
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.893539081875203  LUMO = 2.02652393948688
  mo_energy =
[-0.89353908  2.02652394  9.06028714 23.9953041  48.23814983]
E1 = -3.8559509110397046  E_coul = 1.0344364567745865
cycle= 4 E= -2.82151445426512  delta_E= -1.24e-12  |g|= 1.99e-07  |ddm|= 0.000133
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8559509110397046  E_coul = 1.0344364567745865
  HOMO = -0.893538998745268  LUMO = 2.02652401968238
  mo_energy =
[-0.893539    2.02652402  9.06028731 23.99530432 48.2381501 ]
E1 = -3.8559509257708604  E_coul = 1.0344364715057386
Extra cycle  E= -2.82151445426512  delta_E= -4e-15  |g|= 1.65e-08  |ddm|= 5.63e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [7.3795057  6.18636749 5.16296658 2.858291   0.439285  ]
E = -2.821514454265122
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:23 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  7.37950570168        1
[INPUT] 0    0    [1    /1   ]  6.18636748925        1
[INPUT] 0    0    [1    /1   ]  5.16296657791        1
[INPUT] 0    0    [1    /1   ]  2.85829100221        1
[INPUT] 0    0    [1    /1   ]  0.439284996586       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [7.379505701682186, 1.0]], [0, [6.186367489245186, 1.0]], [0, [5.162966577913284, 1.0]], [0, [2.858291002212206, 1.0]], [0, [0.43928499658563336, 1.0]]]}
ecp = {}
CPU time:        33.82
Set gradient conv threshold to 3.16228e-05
cond(S) = 434094.7360701773
E1 = -3.8356991943037997  E_coul = 1.0245821812580376
init E= -2.81111701304576
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.898464338181837  LUMO = 2.01798134938177
  mo_energy =
[-0.89846434  2.01798135  9.04999196 23.98475526 48.22899136]
E1 = -3.8565692266207563  E_coul = 1.035058123305871
cycle= 1 E= -2.82151110331489  delta_E= -0.0104  |g|= 0.00786  |ddm|= 1.59
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.893228074304911  LUMO = 2.02674221214986
  mo_energy =
[-0.89322807  2.02674221  9.06090026 23.99619019 48.23946484]
E1 = -3.8559826278193885  E_coul = 1.0344681838626513
cycle= 2 E= -2.82151444395674  delta_E= -3.34e-06  |g|= 0.000413  |ddm|= 0.0578
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.893539813513075  LUMO = 2.0265229832554
  mo_energy =
[-0.89353981  2.02652298  9.06028577 23.9953025  48.23814782]
E1 = -3.8559507957264803  E_coul = 1.0344363414626
cycle= 3 E= -2.82151445426388  delta_E= -1.03e-08  |g|= 5.77e-06  |ddm|= 0.00534
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.893539081875203  LUMO = 2.02652393948688
  mo_energy =
[-0.89353908  2.02652394  9.06028714 23.9953041  48.23814983]
E1 = -3.8559509110397046  E_coul = 1.0344364567745865
cycle= 4 E= -2.82151445426512  delta_E= -1.24e-12  |g|= 1.99e-07  |ddm|= 0.000133
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8559509110397046  E_coul = 1.0344364567745865
  HOMO = -0.893538998745268  LUMO = 2.02652401968238
  mo_energy =
[-0.893539    2.02652402  9.06028731 23.99530432 48.2381501 ]
E1 = -3.8559509257708604  E_coul = 1.0344364715057386
Extra cycle  E= -2.82151445426512  delta_E= -4e-15  |g|= 1.65e-08  |ddm|= 5.63e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 434094.7360701773
E1 = -3.8559509257708604  E_coul = 1.0344364715057386
init E= -2.82151445426512
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.893538991379695  LUMO = 2.02652402657264
  mo_energy =
[-0.89353899  2.02652403  9.06028732 23.99530434 48.23815012]
E1 = -3.855950927171285  E_coul = 1.034436472906163
cycle= 1 E= -2.82151445426512  delta_E=    0  |g|= 1.5e-09  |ddm|= 4.37e-07
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.855950927171285  E_coul = 1.034436472906163
  HOMO = -0.893538990679479  LUMO = 2.02652402721282
  mo_energy =
[-0.89353899  2.02652403  9.06028732 23.99530434 48.23815012]
E1 = -3.8559509273066643  E_coul = 1.0344364730415456
Extra cycle  E= -2.82151445426512  delta_E= 3.55e-15  |g|= 1.39e-10  |ddm|= 3.67e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [7.3795057  6.18636749 5.16296658 2.858291   0.439285  ]
grad_E = [-1.04411918e-03 -5.65241493e-04 -5.94128292e-05  5.93045180e-03
  1.42529433e-02]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:25 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  8.46396205348        1
[INPUT] 0    0    [1    /1   ]  7.08721746643        1
[INPUT] 0    0    [1    /1   ]  5.910905678          1
[INPUT] 0    0    [1    /1   ]  2.81212121847        1
[INPUT] 0    0    [1    /1   ]  0.45545505743        1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [8.463962053481744, 1.0]], [0, [7.087217466431795, 1.0]], [0, [5.910905677999643, 1.0]], [0, [2.8121212184713893, 1.0]], [0, [0.4554550574298755, 1.0]]]}
ecp = {}
CPU time:        35.81
Set gradient conv threshold to 3.16228e-05
cond(S) = 291530.0950182147
E1 = -3.8357737516080435  E_coul = 1.025004019682269
init E= -2.81076973192577
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.899000565834625  LUMO = 2.14129883171724
  mo_energy =
[-0.89900057  2.14129883  9.76329008 26.31524934 53.89177498]
E1 = -3.8638281725430486  E_coul = 1.0408404646103278
cycle= 1 E= -2.82298770793272  delta_E= -0.0122  |g|= 0.00883  |ddm|= 2.68
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.891075419913919  LUMO = 2.15334939433493
  mo_energy =
[-0.89107542  2.15334939  9.77998667 26.33384639 53.91090608]
E1 = -3.863378742675777  E_coul = 1.0403872294135585
cycle= 2 E= -2.82299151326222  delta_E= -3.81e-06  |g|= 0.000517  |ddm|= 0.0867
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.891315399409834  LUMO = 2.15318643953906
  mo_energy =
[-0.8913154   2.15318644  9.77948334 26.33308537 53.9097428 ]
E1 = -3.863358771308183  E_coul = 1.0403672445519545
cycle= 3 E= -2.82299152675623  delta_E= -1.35e-08  |g|= 7.2e-06  |ddm|= 0.00642
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.891311835638209  LUMO = 2.15318990011449
  mo_energy =
[-0.89131184  2.1531899   9.77949089 26.33309505 53.90975477]
E1 = -3.8633593804980526  E_coul = 1.040367853738251
cycle= 4 E= -2.8229915267598  delta_E= -3.57e-12  |g|= 2.99e-07  |ddm|= 0.000131
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8633593804980526  E_coul = 1.040367853738251
  HOMO = -0.891311836510778  LUMO = 2.15318988499891
  mo_energy =
[-0.89131184  2.15318988  9.7794909  26.33309507 53.90975479]
E1 = -3.863359380891282  E_coul = 1.0403678541314763
Extra cycle  E= -2.82299152675981  delta_E= -4e-15  |g|= 1.37e-08  |ddm|= 2.85e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [8.46396205 7.08721747 5.91090568 2.81212122 0.45545506]
E = -2.8229915267598056
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:25 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  8.46396205348        1
[INPUT] 0    0    [1    /1   ]  7.08721746643        1
[INPUT] 0    0    [1    /1   ]  5.910905678          1
[INPUT] 0    0    [1    /1   ]  2.81212121847        1
[INPUT] 0    0    [1    /1   ]  0.45545505743        1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [8.463962053481744, 1.0]], [0, [7.087217466431795, 1.0]], [0, [5.910905677999643, 1.0]], [0, [2.8121212184713893, 1.0]], [0, [0.4554550574298755, 1.0]]]}
ecp = {}
CPU time:        36.10
Set gradient conv threshold to 3.16228e-05
cond(S) = 291530.0950182147
E1 = -3.8357737516080435  E_coul = 1.025004019682269
init E= -2.81076973192577
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.899000565834625  LUMO = 2.14129883171724
  mo_energy =
[-0.89900057  2.14129883  9.76329008 26.31524934 53.89177498]
E1 = -3.8638281725430486  E_coul = 1.0408404646103278
cycle= 1 E= -2.82298770793272  delta_E= -0.0122  |g|= 0.00883  |ddm|= 2.68
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.891075419913919  LUMO = 2.15334939433493
  mo_energy =
[-0.89107542  2.15334939  9.77998667 26.33384639 53.91090608]
E1 = -3.863378742675777  E_coul = 1.0403872294135585
cycle= 2 E= -2.82299151326222  delta_E= -3.81e-06  |g|= 0.000517  |ddm|= 0.0867
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.891315399409834  LUMO = 2.15318643953906
  mo_energy =
[-0.8913154   2.15318644  9.77948334 26.33308537 53.9097428 ]
E1 = -3.863358771308183  E_coul = 1.0403672445519545
cycle= 3 E= -2.82299152675623  delta_E= -1.35e-08  |g|= 7.2e-06  |ddm|= 0.00642
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.891311835638209  LUMO = 2.15318990011449
  mo_energy =
[-0.89131184  2.1531899   9.77949089 26.33309505 53.90975477]
E1 = -3.8633593804980526  E_coul = 1.040367853738251
cycle= 4 E= -2.8229915267598  delta_E= -3.57e-12  |g|= 2.99e-07  |ddm|= 0.000131
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8633593804980526  E_coul = 1.040367853738251
  HOMO = -0.891311836510778  LUMO = 2.15318988499891
  mo_energy =
[-0.89131184  2.15318988  9.7794909  26.33309507 53.90975479]
E1 = -3.863359380891282  E_coul = 1.0403678541314763
Extra cycle  E= -2.82299152675981  delta_E= -4e-15  |g|= 1.37e-08  |ddm|= 2.85e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 291530.0950182147
E1 = -3.863359380891282  E_coul = 1.0403678541314763
init E= -2.82299152675981
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.89131183631417  LUMO = 2.15318988421532
  mo_energy =
[-0.89131184  2.15318988  9.7794909  26.33309508 53.90975479]
E1 = -3.8633593808043867  E_coul = 1.0403678540445789
cycle= 1 E= -2.82299152675981  delta_E= -2.22e-15  |g|= 8.17e-10  |ddm|= 1.96e-07
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8633593808043867  E_coul = 1.0403678540445789
  HOMO = -0.891311836357613  LUMO = 2.15318988411865
  mo_energy =
[-0.89131184  2.15318988  9.7794909  26.33309508 53.90975479]
E1 = -3.863359380785048  E_coul = 1.0403678540252426
Extra cycle  E= -2.82299152675981  delta_E= 2.22e-15  |g|= 5.91e-11  |ddm|= 1.35e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [8.46396205 7.08721747 5.91090568 2.81212122 0.45545506]
grad_E = [-0.00084873 -0.00049727 -0.00016435  0.00724217  0.03636738]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:27 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  13.0416540733        1
[INPUT] 0    0    [1    /1   ]  10.8719934011        1
[INPUT] 0    0    [1    /1   ]  9.02781241797        1
[INPUT] 0    0    [1    /1   ]  2.33330496035        1
[INPUT] 0    0    [1    /1   ]  0.502530264678       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [13.041654073255504, 1.0]], [0, [10.87199340114815, 1.0]], [0, [9.027812417968136, 1.0]], [0, [2.3333049603507883, 1.0]], [0, [0.5025302646779035, 1.0]]]}
ecp = {}
CPU time:        38.06
Set gradient conv threshold to 3.16228e-05
cond(S) = 102130.05133613717
E1 = -3.8255016545550364  E_coul = 1.0255370699221504
init E= -2.79996458463289
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.90125686521094  LUMO = 2.31597429173688
  mo_energy =
[-0.90125687  2.31597429 11.50799108 34.56644699 76.4998915 ]
E1 = -3.895914953128616  E_coul = 1.067649701751417
cycle= 1 E= -2.8282652513772  delta_E= -0.0283  |g|= 0.0256  |ddm|= 13.7
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.880320514201964  LUMO = 2.34418802220536
  mo_energy =
[-0.88032051  2.34418802 11.55682788 34.62581422 76.5660578 ]
E1 = -3.8965994588263038  E_coul = 1.0683068910871778
cycle= 2 E= -2.82829256773913  delta_E= -2.73e-05  |g|= 0.00166  |ddm|= 0.331
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.879967235225997  LUMO = 2.34460645134234
  mo_energy =
[-0.87996724  2.34460645 11.55766242 34.62666844 76.5667368 ]
E1 = -3.896688842904368  E_coul = 1.0683961198954446
cycle= 3 E= -2.82829272300892  delta_E= -1.55e-07  |g|= 2.64e-05  |ddm|= 0.0195
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.879946762702594  LUMO = 2.34462349255051
  mo_energy =
[-0.87994676  2.34462349 11.55771343 34.62673991 76.56682615]
E1 = -3.896692100061441  E_coul = 1.068399377004454
cycle= 4 E= -2.82829272305699  delta_E= -4.81e-11  |g|= 1.03e-06  |ddm|= 8.8e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.896692100061441  E_coul = 1.068399377004454
  HOMO = -0.879946673026281  LUMO = 2.34462363924335
  mo_energy =
[-0.87994667  2.34462364 11.55771364 34.62674012 76.56682629]
E1 = -3.896692119819549  E_coul = 1.0683993967625367
Extra cycle  E= -2.82829272305701  delta_E= -2.58e-14  |g|= 4.61e-08  |ddm|= 1.32e-05
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [13.04165407 10.8719934   9.02781242  2.33330496  0.50253026]
E = -2.8282927230570127
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:27 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  13.0416540733        1
[INPUT] 0    0    [1    /1   ]  10.8719934011        1
[INPUT] 0    0    [1    /1   ]  9.02781241797        1
[INPUT] 0    0    [1    /1   ]  2.33330496035        1
[INPUT] 0    0    [1    /1   ]  0.502530264678       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [13.041654073255504, 1.0]], [0, [10.87199340114815, 1.0]], [0, [9.027812417968136, 1.0]], [0, [2.3333049603507883, 1.0]], [0, [0.5025302646779035, 1.0]]]}
ecp = {}
CPU time:        38.35
Set gradient conv threshold to 3.16228e-05
cond(S) = 102130.05133613717
E1 = -3.8255016545550364  E_coul = 1.0255370699221504
init E= -2.79996458463289
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.90125686521094  LUMO = 2.31597429173688
  mo_energy =
[-0.90125687  2.31597429 11.50799108 34.56644699 76.4998915 ]
E1 = -3.895914953128616  E_coul = 1.067649701751417
cycle= 1 E= -2.8282652513772  delta_E= -0.0283  |g|= 0.0256  |ddm|= 13.7
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.880320514201964  LUMO = 2.34418802220536
  mo_energy =
[-0.88032051  2.34418802 11.55682788 34.62581422 76.5660578 ]
E1 = -3.8965994588263038  E_coul = 1.0683068910871778
cycle= 2 E= -2.82829256773913  delta_E= -2.73e-05  |g|= 0.00166  |ddm|= 0.331
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.879967235225997  LUMO = 2.34460645134234
  mo_energy =
[-0.87996724  2.34460645 11.55766242 34.62666844 76.5667368 ]
E1 = -3.896688842904368  E_coul = 1.0683961198954446
cycle= 3 E= -2.82829272300892  delta_E= -1.55e-07  |g|= 2.64e-05  |ddm|= 0.0195
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.879946762702594  LUMO = 2.34462349255051
  mo_energy =
[-0.87994676  2.34462349 11.55771343 34.62673991 76.56682615]
E1 = -3.896692100061441  E_coul = 1.068399377004454
cycle= 4 E= -2.82829272305699  delta_E= -4.81e-11  |g|= 1.03e-06  |ddm|= 8.8e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.896692100061441  E_coul = 1.068399377004454
  HOMO = -0.879946673026281  LUMO = 2.34462363924335
  mo_energy =
[-0.87994667  2.34462364 11.55771364 34.62674012 76.56682629]
E1 = -3.896692119819549  E_coul = 1.0683993967625367
Extra cycle  E= -2.82829272305701  delta_E= -2.58e-14  |g|= 4.61e-08  |ddm|= 1.32e-05
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 102130.05133613717
E1 = -3.896692119819549  E_coul = 1.0683993967625367
init E= -2.82829272305701
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.879946663147239  LUMO = 2.34462365089746
  mo_energy =
[-0.87994666  2.34462365 11.55771366 34.62674014 76.56682632]
E1 = -3.896692122035185  E_coul = 1.068399398978174
cycle= 1 E= -2.82829272305701  delta_E= 1.78e-15  |g|= 3.34e-09  |ddm|= 5.82e-07
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.896692122035185  E_coul = 1.068399398978174
  HOMO = -0.879946662039419  LUMO = 2.344623652052
  mo_energy =
[-0.87994666  2.34462365 11.55771367 34.62674015 76.56682632]
E1 = -3.8966921222656676  E_coul = 1.0683993992086533
Extra cycle  E= -2.82829272305701  delta_E= -3.55e-15  |g|= 2.71e-10  |ddm|= 3.54e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [13.04165407 10.8719934   9.02781242  2.33330496  0.50253026]
grad_E = [-0.00051047 -0.00048373 -0.00053366  0.00401673  0.17614155]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:29 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  15.6141008795        1
[INPUT] 0    0    [1    /1   ]  12.9974813397        1
[INPUT] 0    0    [1    /1   ]  10.7759609164        1
[INPUT] 0    0    [1    /1   ]  2.04627919912        1
[INPUT] 0    0    [1    /1   ]  0.490247890864       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [15.614100879547426, 1.0]], [0, [12.99748133974612, 1.0]], [0, [10.775960916405603, 1.0]], [0, [2.0462791991230875, 1.0]], [0, [0.49024789086432635, 1.0]]]}
ecp = {}
CPU time:        40.35
Set gradient conv threshold to 3.16228e-05
cond(S) = 73327.34208651375
E1 = -3.8249058598296357  E_coul = 1.024970508159319
init E= -2.79993535167032
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.90401288165749  LUMO = 2.17310204862467
  mo_energy =
[-0.90401288  2.17310205 11.88879272 38.73573724 89.02393433]
E1 = -3.9034139838795774  E_coul = 1.069948551893377
cycle= 1 E= -2.8334654319862  delta_E= -0.0335  |g|= 0.0321  |ddm|= 15.4
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.881778878449805  LUMO = 2.20182587377149
  mo_energy =
[-0.88177888  2.20182587 11.94330682 38.80228108 89.09720435]
E1 = -3.9046731165760247  E_coul = 1.0711636937396969
cycle= 2 E= -2.83350942283633  delta_E= -4.4e-05  |g|= 0.00211  |ddm|= 0.371
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.881120488510202  LUMO = 2.20250250149015
  mo_energy =
[-0.88112049  2.2025025  11.94495673 38.80413473 89.09901278]
E1 = -3.9048284545505854  E_coul = 1.0713187496015901
cycle= 3 E= -2.833509704949  delta_E= -2.82e-07  |g|= 3.63e-05  |ddm|= 0.0216
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.881093556033811  LUMO = 2.20252323908468
  mo_energy =
[-0.88109356  2.20252324 11.94502844 38.80423825 89.09914066]
E1 = -3.9048325816105733  E_coul = 1.0713228765863794
cycle= 4 E= -2.83350970502419  delta_E= -7.52e-11  |g|= 1.91e-06  |ddm|= 0.000236
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.9048325816105733  E_coul = 1.0713228765863794
  HOMO = -0.881093414218974  LUMO = 2.20252349083679
  mo_energy =
[-0.88109341  2.20252349 11.94502876 38.80423847 89.09914071]
E1 = -3.904832626963965  E_coul = 1.0713229219396603
Extra cycle  E= -2.8335097050243  delta_E= -1.11e-13  |g|= 9.83e-08  |ddm|= 2.19e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [15.61410088 12.99748134 10.77596092  2.0462792   0.49024789]
E = -2.833509705024305
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:30 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  15.6141008795        1
[INPUT] 0    0    [1    /1   ]  12.9974813397        1
[INPUT] 0    0    [1    /1   ]  10.7759609164        1
[INPUT] 0    0    [1    /1   ]  2.04627919912        1
[INPUT] 0    0    [1    /1   ]  0.490247890864       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [15.614100879547426, 1.0]], [0, [12.99748133974612, 1.0]], [0, [10.775960916405603, 1.0]], [0, [2.0462791991230875, 1.0]], [0, [0.49024789086432635, 1.0]]]}
ecp = {}
CPU time:        40.68
Set gradient conv threshold to 3.16228e-05
cond(S) = 73327.34208651375
E1 = -3.8249058598296357  E_coul = 1.024970508159319
init E= -2.79993535167032
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.90401288165749  LUMO = 2.17310204862467
  mo_energy =
[-0.90401288  2.17310205 11.88879272 38.73573724 89.02393433]
E1 = -3.9034139838795774  E_coul = 1.069948551893377
cycle= 1 E= -2.8334654319862  delta_E= -0.0335  |g|= 0.0321  |ddm|= 15.4
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.881778878449805  LUMO = 2.20182587377149
  mo_energy =
[-0.88177888  2.20182587 11.94330682 38.80228108 89.09720435]
E1 = -3.9046731165760247  E_coul = 1.0711636937396969
cycle= 2 E= -2.83350942283633  delta_E= -4.4e-05  |g|= 0.00211  |ddm|= 0.371
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.881120488510202  LUMO = 2.20250250149015
  mo_energy =
[-0.88112049  2.2025025  11.94495673 38.80413473 89.09901278]
E1 = -3.9048284545505854  E_coul = 1.0713187496015901
cycle= 3 E= -2.833509704949  delta_E= -2.82e-07  |g|= 3.63e-05  |ddm|= 0.0216
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.881093556033811  LUMO = 2.20252323908468
  mo_energy =
[-0.88109356  2.20252324 11.94502844 38.80423825 89.09914066]
E1 = -3.9048325816105733  E_coul = 1.0713228765863794
cycle= 4 E= -2.83350970502419  delta_E= -7.52e-11  |g|= 1.91e-06  |ddm|= 0.000236
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.9048325816105733  E_coul = 1.0713228765863794
  HOMO = -0.881093414218974  LUMO = 2.20252349083679
  mo_energy =
[-0.88109341  2.20252349 11.94502876 38.80423847 89.09914071]
E1 = -3.904832626963965  E_coul = 1.0713229219396603
Extra cycle  E= -2.8335097050243  delta_E= -1.11e-13  |g|= 9.83e-08  |ddm|= 2.19e-05
    CPU time for scf_cycle      0.06 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 73327.34208651375
E1 = -3.904832626963965  E_coul = 1.0713229219396603
init E= -2.8335097050243
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.881093391542331  LUMO = 2.20252351556361
  mo_energy =
[-0.88109339  2.20252352 11.94502882 38.80423853 89.09914077]
E1 = -3.9048326325578713  E_coul = 1.071322927533556
cycle= 1 E= -2.83350970502432  delta_E= -1.02e-14  |g|= 7.48e-09  |ddm|= 1.02e-06
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.9048326325578713  E_coul = 1.071322927533556
  HOMO = -0.881093388745385  LUMO = 2.20252351826926
  mo_energy =
[-0.88109339  2.20252352 11.94502883 38.80423854 89.09914078]
E1 = -3.904832633160816  E_coul = 1.0713229281365149
Extra cycle  E= -2.8335097050243  delta_E= 1.38e-14  |g|= 6.29e-10  |ddm|= 6.51e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.08 sec
exp = [15.61410088 12.99748134 10.77596092  2.0462792   0.49024789]
grad_E = [-0.00027756 -0.00025971 -0.00026893 -0.00400408  0.21094468]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:32 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  22.0441453453        1
[INPUT] 0    0    [1    /1   ]  18.3162574662        1
[INPUT] 0    0    [1    /1   ]  15.1579482098        1
[INPUT] 0    0    [1    /1   ]  1.44323424471        1
[INPUT] 0    0    [1    /1   ]  0.331978468128       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [22.044145345347918, 1.0]], [0, [18.316257466224414, 1.0]], [0, [15.157948209811483, 1.0]], [0, [1.4432342447082471, 1.0]], [0, [0.33197846812846765, 1.0]]]}
ecp = {}
CPU time:        42.70
Set gradient conv threshold to 3.16228e-05
cond(S) = 45171.02996532889
E1 = -3.85097939350626  E_coul = 1.0225654477083477
init E= -2.82841394579791
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91092720530398  LUMO = 1.35962939288429
  mo_energy =
[ -0.91092721   1.35962939  11.99277971  49.01882409 120.73286128]
E1 = -3.8745463003457896  E_coul = 1.029716989961633
cycle= 1 E= -2.84482931038416  delta_E= -0.0164  |g|= 0.0265  |ddm|= 11.3
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.907567881875152  LUMO = 1.36433502114298
  mo_energy =
[ -0.90756788   1.36433502  12.00006851  49.02182663 120.73236502]
E1 = -3.875657380593968  E_coul = 1.0308026874310212
cycle= 2 E= -2.84485469316295  delta_E= -2.54e-05  |g|= 0.0016  |ddm|= 0.246
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.906966150855351  LUMO = 1.36479123492618
  mo_energy =
[ -0.90696615   1.36479123  12.00172119  49.02354254 120.73402474]
E1 = -3.8758390226807258  E_coul = 1.0309841185101272
cycle= 3 E= -2.8448549041706  delta_E= -2.11e-07  |g|= 4.11e-05  |ddm|= 0.013
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.906933700295558  LUMO = 1.36481003687896
  mo_energy =
[ -0.9069337    1.36481004  12.00182209  49.0236927  120.73420284]
E1 = -3.875843166002054  E_coul = 1.030988261757259
cycle= 4 E= -2.8448549042448  delta_E= -7.42e-11  |g|= 3.14e-06  |ddm|= 0.000385
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.875843166002054  E_coul = 1.030988261757259
  HOMO = -0.906933321243995  LUMO = 1.36481043260202
  mo_energy =
[ -0.90693332   1.36481043  12.00182295  49.02369311 120.7342029 ]
E1 = -3.875843355519781  E_coul = 1.0309884512745129
Extra cycle  E= -2.84485490424527  delta_E= -4.73e-13  |g|= 2.2e-07  |ddm|= 2.82e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [22.04414535 18.31625747 15.15794821  1.44323424  0.33197847]
E = -2.8448549042452678
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:32 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  22.0441453453        1
[INPUT] 0    0    [1    /1   ]  18.3162574662        1
[INPUT] 0    0    [1    /1   ]  15.1579482098        1
[INPUT] 0    0    [1    /1   ]  1.44323424471        1
[INPUT] 0    0    [1    /1   ]  0.331978468128       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [22.044145345347918, 1.0]], [0, [18.316257466224414, 1.0]], [0, [15.157948209811483, 1.0]], [0, [1.4432342447082471, 1.0]], [0, [0.33197846812846765, 1.0]]]}
ecp = {}
CPU time:        43.05
Set gradient conv threshold to 3.16228e-05
cond(S) = 45171.02996532889
E1 = -3.85097939350626  E_coul = 1.0225654477083477
init E= -2.82841394579791
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91092720530398  LUMO = 1.35962939288429
  mo_energy =
[ -0.91092721   1.35962939  11.99277971  49.01882409 120.73286128]
E1 = -3.8745463003457896  E_coul = 1.029716989961633
cycle= 1 E= -2.84482931038416  delta_E= -0.0164  |g|= 0.0265  |ddm|= 11.3
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.907567881875152  LUMO = 1.36433502114298
  mo_energy =
[ -0.90756788   1.36433502  12.00006851  49.02182663 120.73236502]
E1 = -3.875657380593968  E_coul = 1.0308026874310212
cycle= 2 E= -2.84485469316295  delta_E= -2.54e-05  |g|= 0.0016  |ddm|= 0.246
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.906966150855351  LUMO = 1.36479123492618
  mo_energy =
[ -0.90696615   1.36479123  12.00172119  49.02354254 120.73402474]
E1 = -3.8758390226807258  E_coul = 1.0309841185101272
cycle= 3 E= -2.8448549041706  delta_E= -2.11e-07  |g|= 4.11e-05  |ddm|= 0.013
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.906933700295558  LUMO = 1.36481003687896
  mo_energy =
[ -0.9069337    1.36481004  12.00182209  49.0236927  120.73420284]
E1 = -3.875843166002054  E_coul = 1.030988261757259
cycle= 4 E= -2.8448549042448  delta_E= -7.42e-11  |g|= 3.14e-06  |ddm|= 0.000385
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.875843166002054  E_coul = 1.030988261757259
  HOMO = -0.906933321243995  LUMO = 1.36481043260202
  mo_energy =
[ -0.90693332   1.36481043  12.00182295  49.02369311 120.7342029 ]
E1 = -3.875843355519781  E_coul = 1.0309884512745129
Extra cycle  E= -2.84485490424527  delta_E= -4.73e-13  |g|= 2.2e-07  |ddm|= 2.82e-05
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 45171.02996532889
E1 = -3.875843355519781  E_coul = 1.0309884512745129
init E= -2.84485490424527
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.906933226485375  LUMO = 1.36481050136155
  mo_energy =
[ -0.90693323   1.3648105   12.00182322  49.02369341 120.73420321]
E1 = -3.87584338107751  E_coul = 1.0309884768322537
cycle= 1 E= -2.84485490424526  delta_E= 1.15e-14  |g|= 2.13e-08  |ddm|= 1.52e-06
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.87584338107751  E_coul = 1.0309884768322537
  HOMO = -0.906933213706514  LUMO = 1.36481051020304
  mo_energy =
[ -0.90693321   1.36481051  12.00182326  49.02369346 120.73420326]
E1 = -3.8758433840896953  E_coul = 1.0309884798444269
Extra cycle  E= -2.84485490424527  delta_E= -1.24e-14  |g|= 2.21e-09  |ddm|= 1.2e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [22.04414535 18.31625747 15.15794821  1.44323424  0.33197847]
grad_E = [ 0.00041224  0.0006337   0.00102825 -0.04429785  0.08737935]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:34 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  19.655160692         1
[INPUT] 0    0    [1    /1   ]  16.361014426         1
[INPUT] 0    0    [1    /1   ]  13.576075734         1
[INPUT] 0    0    [1    /1   ]  2.01470113698        1
[INPUT] 0    0    [1    /1   ]  0.291010676072       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [19.655160691966486, 1.0]], [0, [16.361014425976762, 1.0]], [0, [13.576075734037735, 1.0]], [0, [2.0147011369796166, 1.0]], [0, [0.2910106760723211, 1.0]]]}
ecp = {}
CPU time:        45.05
Set gradient conv threshold to 3.16228e-05
cond(S) = 57601.16971817294
E1 = -3.77686087018268  E_coul = 1.0136790532171809
init E= -2.7631818169655
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.902274121870568  LUMO = 1.51119932170972
  mo_energy =
[ -0.90227412   1.51119932  12.65140458  46.13542286 109.98401715]
E1 = -3.8042768550501527  E_coul = 0.9841768278942689
cycle= 1 E= -2.82010002715588  delta_E= -0.0569  |g|= 0.0512  |ddm|= 6.63
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.918017552980366  LUMO = 1.49979934735688
  mo_energy =
[ -0.91801755   1.49979935  12.60977452  46.08545502 109.93063144]
E1 = -3.800610136389363  E_coul = 0.9803902348275519
cycle= 2 E= -2.82021990156181  delta_E= -0.00012  |g|= 0.0031  |ddm|= 0.277
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.920163745751294  LUMO = 1.4978477239768
  mo_energy =
[ -0.92016375   1.49784772  12.60352974  46.07790649 109.92243912]
E1 = -3.80028375788099  E_coul = 0.9800632055386791
cycle= 3 E= -2.82022055234231  delta_E= -6.51e-07  |g|= 0.000149  |ddm|= 0.0163
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.920071791033985  LUMO = 1.49793139380924
  mo_energy =
[ -0.92007179   1.49793139  12.60379282  46.07822988 109.92279696]
E1 = -3.8002973211186974  E_coul = 0.9800767674912925
cycle= 4 E= -2.82022055362741  delta_E= -1.29e-09  |g|= 2.75e-07  |ddm|= 0.000846
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.920071898670185  LUMO = 1.49793133485601
  mo_energy =
[ -0.9200719    1.49793133  12.60379256  46.07822951 109.92279655]
E1 = -3.8002973102077404  E_coul = 0.9800767565803359
cycle= 5 E= -2.8202205536274  delta_E= 8.88e-16  |g|= 5.72e-09  |ddm|= 6.04e-07
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.8002973102077404  E_coul = 0.9800767565803359
  HOMO = -0.920071898523525  LUMO = 1.49793133455506
  mo_energy =
[ -0.9200719    1.49793133  12.60379256  46.07822951 109.92279654]
E1 = -3.8002973103445785  E_coul = 0.9800767567171722
Extra cycle  E= -2.82022055362741  delta_E= -1.78e-15  |g|= 2.56e-10  |ddm|= 3.14e-08
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [19.65516069 16.36101443 13.57607573  2.01470114  0.29101068]
E = -2.820220553627406
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:34 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  21.3624783916        1
[INPUT] 0    0    [1    /1   ]  17.7583532682        1
[INPUT] 0    0    [1    /1   ]  14.7065806423        1
[INPUT] 0    0    [1    /1   ]  1.6062951899         1
[INPUT] 0    0    [1    /1   ]  0.320288819987       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [21.362478391593065, 1.0]], [0, [17.758353268217334, 1.0]], [0, [14.706580642312433, 1.0]], [0, [1.606295189898915, 1.0]], [0, [0.32028881998717557, 1.0]]]}
ecp = {}
CPU time:        45.41
Set gradient conv threshold to 3.16228e-05
cond(S) = 48119.515842761495
E1 = -3.869403202886839  E_coul = 1.0231802185717465
init E= -2.84622298431509
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912817991789432  LUMO = 1.41177280126533
  mo_energy =
[ -0.91281799   1.4117728   12.21269679  48.20050431 117.65805483]
E1 = -3.8702910521813854  E_coul = 1.0214629694899018
cycle= 1 E= -2.84882808269148  delta_E= -0.00261  |g|= 0.00356  |ddm|= 1.12
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.913682903466681  LUMO = 1.41227450300911
  mo_energy =
[ -0.9136829    1.4122745   12.20906439  48.19384002 117.64928818]
E1 = -3.869874601854095  E_coul = 1.021045788622289
cycle= 2 E= -2.84882881323181  delta_E= -7.31e-07  |g|= 0.000125  |ddm|= 0.0272
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.913899679422359  LUMO = 1.41212814754892
  mo_energy =
[ -0.91389968   1.41212815  12.2084061   48.19288582 117.64815105]
E1 = -3.8698462502090782  E_coul = 1.0210174345316874
cycle= 3 E= -2.84882881567739  delta_E= -2.45e-09  |g|= 6.05e-06  |ddm|= 0.000681
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.913906262315184  LUMO = 1.412123367599
  mo_energy =
[ -0.91390626   1.41212337  12.20838674  48.19286039 117.64812239]
E1 = -3.8698450702950113  E_coul = 1.0210162546125474
cycle= 4 E= -2.84882881568246  delta_E= -5.07e-12  |g|= 1.11e-07  |ddm|= 3.35e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8698450702950113  E_coul = 1.0210162546125474
  HOMO = -0.91390628053495  LUMO = 1.41212335935955
  mo_energy =
[ -0.91390628   1.41212336  12.20838668  48.19286029 117.64812227]
E1 = -3.869845069613518  E_coul = 1.0210162539310557
Extra cycle  E= -2.84882881568246  delta_E= 1.78e-15  |g|= 2.72e-09  |ddm|= 7.64e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [21.36247839 17.75835327 14.70658064  1.60629519  0.32028882]
E = -2.848828815682462
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:35 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  21.3624783916        1
[INPUT] 0    0    [1    /1   ]  17.7583532682        1
[INPUT] 0    0    [1    /1   ]  14.7065806423        1
[INPUT] 0    0    [1    /1   ]  1.6062951899         1
[INPUT] 0    0    [1    /1   ]  0.320288819987       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [21.362478391593065, 1.0]], [0, [17.758353268217334, 1.0]], [0, [14.706580642312433, 1.0]], [0, [1.606295189898915, 1.0]], [0, [0.32028881998717557, 1.0]]]}
ecp = {}
CPU time:        45.78
Set gradient conv threshold to 3.16228e-05
cond(S) = 48119.515842761495
E1 = -3.869403202886839  E_coul = 1.0231802185717465
init E= -2.84622298431509
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912817991789432  LUMO = 1.41177280126533
  mo_energy =
[ -0.91281799   1.4117728   12.21269679  48.20050431 117.65805483]
E1 = -3.8702910521813854  E_coul = 1.0214629694899018
cycle= 1 E= -2.84882808269148  delta_E= -0.00261  |g|= 0.00356  |ddm|= 1.12
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.913682903466681  LUMO = 1.41227450300911
  mo_energy =
[ -0.9136829    1.4122745   12.20906439  48.19384002 117.64928818]
E1 = -3.869874601854095  E_coul = 1.021045788622289
cycle= 2 E= -2.84882881323181  delta_E= -7.31e-07  |g|= 0.000125  |ddm|= 0.0272
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.913899679422359  LUMO = 1.41212814754892
  mo_energy =
[ -0.91389968   1.41212815  12.2084061   48.19288582 117.64815105]
E1 = -3.8698462502090782  E_coul = 1.0210174345316874
cycle= 3 E= -2.84882881567739  delta_E= -2.45e-09  |g|= 6.05e-06  |ddm|= 0.000681
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.913906262315184  LUMO = 1.412123367599
  mo_energy =
[ -0.91390626   1.41212337  12.20838674  48.19286039 117.64812239]
E1 = -3.8698450702950113  E_coul = 1.0210162546125474
cycle= 4 E= -2.84882881568246  delta_E= -5.07e-12  |g|= 1.11e-07  |ddm|= 3.35e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8698450702950113  E_coul = 1.0210162546125474
  HOMO = -0.91390628053495  LUMO = 1.41212335935955
  mo_energy =
[ -0.91390628   1.41212336  12.20838668  48.19286029 117.64812227]
E1 = -3.869845069613518  E_coul = 1.0210162539310557
Extra cycle  E= -2.84882881568246  delta_E= 1.78e-15  |g|= 2.72e-09  |ddm|= 7.64e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 48119.515842761495
E1 = -3.869845069613518  E_coul = 1.0210162539310557
init E= -2.84882881568246
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.913906280875711  LUMO = 1.41212335925769
  mo_energy =
[ -0.91390628   1.41212336  12.20838668  48.19286029 117.64812227]
E1 = -3.8698450696683655  E_coul = 1.0210162539859042
cycle= 1 E= -2.84882881568246  delta_E= 8.88e-16  |g|= 1.58e-10  |ddm|= 2.3e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8698450696683655  E_coul = 1.0210162539859042
  HOMO = -0.913906280848282  LUMO = 1.41212335928376
  mo_energy =
[ -0.91390628   1.41212336  12.20838668  48.19286029 117.64812227]
E1 = -3.8698450696792595  E_coul = 1.0210162539968022
Extra cycle  E= -2.84882881568246  delta_E= 4e-15  |g|= 1.27e-11  |ddm|= 1.1e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [21.36247839 17.75835327 14.70658064  1.60629519  0.32028882]
grad_E = [ 0.00010446  0.00019631  0.00035499  0.00395069 -0.06823608]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:37 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  19.1377835142        1
[INPUT] 0    0    [1    /1   ]  15.9105867434        1
[INPUT] 0    0    [1    /1   ]  13.1734287332        1
[INPUT] 0    0    [1    /1   ]  1.69731756577        1
[INPUT] 0    0    [1    /1   ]  0.371811376326       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [19.13778351423179, 1.0]], [0, [15.910586743448164, 1.0]], [0, [13.173428733179763, 1.0]], [0, [1.6973175657699804, 1.0]], [0, [0.3718113763260196, 1.0]]]}
ecp = {}
CPU time:        47.81
Set gradient conv threshold to 3.16228e-05
cond(S) = 52999.32962366465
E1 = -3.8669582865104895  E_coul = 1.0244128853716798
init E= -2.84254540113881
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912601667525591  LUMO = 1.62820574521219
  mo_energy =
[ -0.91260167   1.62820575  11.85312343  44.17113696 106.13269458]
E1 = -3.8859030190812662  E_coul = 1.0362051771691594
cycle= 1 E= -2.84969784191211  delta_E= -0.00715  |g|= 0.0125  |ddm|= 3.89
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.90674932080763  LUMO = 1.63522077552509
  mo_energy =
[ -0.90674932   1.63522078  11.86774261  44.18728495 106.14893529]
E1 = -3.8863688248606327  E_coul = 1.036664537535454
cycle= 2 E= -2.84970428732518  delta_E= -6.45e-06  |g|= 0.000813  |ddm|= 0.114
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.906500018726365  LUMO = 1.63544592052405
  mo_energy =
[ -0.90650002   1.63544592  11.86840221  44.1879447  106.14952915]
E1 = -3.8864385974141604  E_coul = 1.0367342650629454
cycle= 3 E= -2.84970433235122  delta_E= -4.5e-08  |g|= 1.42e-05  |ddm|= 0.00652
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.906483784538113  LUMO = 1.63545751913768
  mo_energy =
[ -0.90648378   1.63545752  11.86844916  44.18801101 106.14960757]
E1 = -3.8864410552113466  E_coul = 1.0367367228403315
cycle= 4 E= -2.84970433237102  delta_E= -1.98e-11  |g|= 6.28e-07  |ddm|= 6.06e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8864410552113466  E_coul = 1.0367367228403315
  HOMO = -0.906483804765342  LUMO = 1.63545753863771
  mo_energy =
[ -0.9064838    1.63545754  11.86844906  44.18801076 106.1496072 ]
E1 = -3.8864410670877225  E_coul = 1.0367367347166987
Extra cycle  E= -2.84970433237102  delta_E= -8.88e-15  |g|= 3.08e-08  |ddm|= 5.75e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [19.13778351 15.91058674 13.17342873  1.69731757  0.37181138]
E = -2.849704332371024
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:37 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  19.1377835142        1
[INPUT] 0    0    [1    /1   ]  15.9105867434        1
[INPUT] 0    0    [1    /1   ]  13.1734287332        1
[INPUT] 0    0    [1    /1   ]  1.69731756577        1
[INPUT] 0    0    [1    /1   ]  0.371811376326       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [19.13778351423179, 1.0]], [0, [15.910586743448164, 1.0]], [0, [13.173428733179763, 1.0]], [0, [1.6973175657699804, 1.0]], [0, [0.3718113763260196, 1.0]]]}
ecp = {}
CPU time:        48.19
Set gradient conv threshold to 3.16228e-05
cond(S) = 52999.32962366465
E1 = -3.8669582865104895  E_coul = 1.0244128853716798
init E= -2.84254540113881
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.912601667525591  LUMO = 1.62820574521219
  mo_energy =
[ -0.91260167   1.62820575  11.85312343  44.17113696 106.13269458]
E1 = -3.8859030190812662  E_coul = 1.0362051771691594
cycle= 1 E= -2.84969784191211  delta_E= -0.00715  |g|= 0.0125  |ddm|= 3.89
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.90674932080763  LUMO = 1.63522077552509
  mo_energy =
[ -0.90674932   1.63522078  11.86774261  44.18728495 106.14893529]
E1 = -3.8863688248606327  E_coul = 1.036664537535454
cycle= 2 E= -2.84970428732518  delta_E= -6.45e-06  |g|= 0.000813  |ddm|= 0.114
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.906500018726365  LUMO = 1.63544592052405
  mo_energy =
[ -0.90650002   1.63544592  11.86840221  44.1879447  106.14952915]
E1 = -3.8864385974141604  E_coul = 1.0367342650629454
cycle= 3 E= -2.84970433235122  delta_E= -4.5e-08  |g|= 1.42e-05  |ddm|= 0.00652
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.906483784538113  LUMO = 1.63545751913768
  mo_energy =
[ -0.90648378   1.63545752  11.86844916  44.18801101 106.14960757]
E1 = -3.8864410552113466  E_coul = 1.0367367228403315
cycle= 4 E= -2.84970433237102  delta_E= -1.98e-11  |g|= 6.28e-07  |ddm|= 6.06e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8864410552113466  E_coul = 1.0367367228403315
  HOMO = -0.906483804765342  LUMO = 1.63545753863771
  mo_energy =
[ -0.9064838    1.63545754  11.86844906  44.18801076 106.1496072 ]
E1 = -3.8864410670877225  E_coul = 1.0367367347166987
Extra cycle  E= -2.84970433237102  delta_E= -8.88e-15  |g|= 3.08e-08  |ddm|= 5.75e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 52999.32962366465
E1 = -3.8864410670877225  E_coul = 1.0367367347166987
init E= -2.84970433237102
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.906483798827161  LUMO = 1.63545754457891
  mo_energy =
[ -0.9064838    1.63545754  11.86844908  44.18801078 106.14960721]
E1 = -3.886441069064818  E_coul = 1.0367367366937799
cycle= 1 E= -2.84970433237104  delta_E= -1.42e-14  |g|= 2.41e-09  |ddm|= 2.54e-07
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.886441069064818  E_coul = 1.0367367366937799
  HOMO = -0.906483797838628  LUMO = 1.63545754541011
  mo_energy =
[ -0.9064838    1.63545755  11.86844908  44.18801078 106.14960721]
E1 = -3.8864410692986957  E_coul = 1.0367367369276752
Extra cycle  E= -2.84970433237102  delta_E= 1.78e-14  |g|= 2.14e-10  |ddm|= 1.62e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [19.13778351 15.91058674 13.17342873  1.69731757  0.37181138]
grad_E = [-2.48835212e-05  3.22184163e-05  1.22120246e-04 -2.64966429e-03
  5.24771681e-02]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:39 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  19.4598057218        1
[INPUT] 0    0    [1    /1   ]  16.1759905763        1
[INPUT] 0    0    [1    /1   ]  13.3906023523        1
[INPUT] 0    0    [1    /1   ]  1.65446716667        1
[INPUT] 0    0    [1    /1   ]  0.351778536476       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [19.459805721753412, 1.0]], [0, [16.175990576305065, 1.0]], [0, [13.390602352287097, 1.0]], [0, [1.654467166670527, 1.0]], [0, [0.35177853647567014, 1.0]]]}
ecp = {}
CPU time:        50.23
Set gradient conv threshold to 3.16228e-05
cond(S) = 51380.65813210252
E1 = -3.8697570561768866  E_coul = 1.0240650254796007
init E= -2.84569203069729
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913073679619424  LUMO = 1.54054387520567
  mo_energy =
[ -0.91307368   1.54054388  11.77144833  44.5950038  107.6275122 ]
E1 = -3.8807403896295116  E_coul = 1.0304937863645482
cycle= 1 E= -2.85024660326496  delta_E= -0.00455  |g|= 0.00824  |ddm|= 2.48
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.909877584173049  LUMO = 1.54473010199368
  mo_energy =
[ -0.90987758   1.5447301   11.77905049  44.60246705 107.63424399]
E1 = -3.880901588497469  E_coul = 1.0306524656664435
cycle= 2 E= -2.85024912283103  delta_E= -2.52e-06  |g|= 0.000501  |ddm|= 0.0746
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.90979216301473  LUMO = 1.54481705304461
  mo_energy =
[ -0.90979216   1.54481705  11.77926059  44.60258126 107.63425589]
E1 = -3.8809360747332855  E_coul = 1.0306869366997127
cycle= 3 E= -2.85024913803357  delta_E= -1.52e-08  |g|= 9.57e-06  |ddm|= 0.00402
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.909780129531635  LUMO = 1.54482561457465
  mo_energy =
[ -0.90978013   1.54482561  11.7792954   44.60262959 107.63431244]
E1 = -3.880937970482552  E_coul = 1.0306888324374206
cycle= 4 E= -2.85024913804513  delta_E= -1.16e-11  |g|= 3.22e-07  |ddm|= 2.1e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.880937970482552  E_coul = 1.0306888324374206
  HOMO = -0.909780152803844  LUMO = 1.54482561364479
  mo_energy =
[ -0.90978015   1.54482561  11.77929531  44.60262941 107.6343122 ]
E1 = -3.8809379745976753  E_coul = 1.0306888365525437
Extra cycle  E= -2.85024913804513  delta_E=    0  |g|= 1.4e-08  |ddm|= 2.84e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [19.45980572 16.17599058 13.39060235  1.65446717  0.35177854]
E = -2.8502491380451316
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:39 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  19.4598057218        1
[INPUT] 0    0    [1    /1   ]  16.1759905763        1
[INPUT] 0    0    [1    /1   ]  13.3906023523        1
[INPUT] 0    0    [1    /1   ]  1.65446716667        1
[INPUT] 0    0    [1    /1   ]  0.351778536476       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [19.459805721753412, 1.0]], [0, [16.175990576305065, 1.0]], [0, [13.390602352287097, 1.0]], [0, [1.654467166670527, 1.0]], [0, [0.35177853647567014, 1.0]]]}
ecp = {}
CPU time:        50.62
Set gradient conv threshold to 3.16228e-05
cond(S) = 51380.65813210252
E1 = -3.8697570561768866  E_coul = 1.0240650254796007
init E= -2.84569203069729
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913073679619424  LUMO = 1.54054387520567
  mo_energy =
[ -0.91307368   1.54054388  11.77144833  44.5950038  107.6275122 ]
E1 = -3.8807403896295116  E_coul = 1.0304937863645482
cycle= 1 E= -2.85024660326496  delta_E= -0.00455  |g|= 0.00824  |ddm|= 2.48
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.909877584173049  LUMO = 1.54473010199368
  mo_energy =
[ -0.90987758   1.5447301   11.77905049  44.60246705 107.63424399]
E1 = -3.880901588497469  E_coul = 1.0306524656664435
cycle= 2 E= -2.85024912283103  delta_E= -2.52e-06  |g|= 0.000501  |ddm|= 0.0746
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.90979216301473  LUMO = 1.54481705304461
  mo_energy =
[ -0.90979216   1.54481705  11.77926059  44.60258126 107.63425589]
E1 = -3.8809360747332855  E_coul = 1.0306869366997127
cycle= 3 E= -2.85024913803357  delta_E= -1.52e-08  |g|= 9.57e-06  |ddm|= 0.00402
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.909780129531635  LUMO = 1.54482561457465
  mo_energy =
[ -0.90978013   1.54482561  11.7792954   44.60262959 107.63431244]
E1 = -3.880937970482552  E_coul = 1.0306888324374206
cycle= 4 E= -2.85024913804513  delta_E= -1.16e-11  |g|= 3.22e-07  |ddm|= 2.1e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.880937970482552  E_coul = 1.0306888324374206
  HOMO = -0.909780152803844  LUMO = 1.54482561364479
  mo_energy =
[ -0.90978015   1.54482561  11.77929531  44.60262941 107.6343122 ]
E1 = -3.8809379745976753  E_coul = 1.0306888365525437
Extra cycle  E= -2.85024913804513  delta_E=    0  |g|= 1.4e-08  |ddm|= 2.84e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 51380.65813210252
E1 = -3.8809379745976753  E_coul = 1.0306888365525437
init E= -2.85024913804513
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.909780150746279  LUMO = 1.54482561583318
  mo_energy =
[ -0.90978015   1.54482562  11.77929531  44.60262942 107.6343122 ]
E1 = -3.8809379754286204  E_coul = 1.030688837383499
cycle= 1 E= -2.85024913804512  delta_E= 1.02e-14  |g|= 1.07e-09  |ddm|= 1.17e-07
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8809379754286204  E_coul = 1.030688837383499
  HOMO = -0.909780150330815  LUMO = 1.5448256161771
  mo_energy =
[ -0.90978015   1.54482562  11.77929532  44.60262942 107.6343122 ]
E1 = -3.8809379755311184  E_coul = 1.0306888374859908
Extra cycle  E= -2.85024913804513  delta_E= -6.22e-15  |g|= 9.46e-11  |ddm|= 7.22e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [19.45980572 16.17599058 13.39060235  1.65446717  0.35177854]
grad_E = [-4.85272683e-07  6.28541852e-05  1.65411316e-04  5.53319091e-04
  9.87908378e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:42 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  19.1260456296        1
[INPUT] 0    0    [1    /1   ]  15.8960833294        1
[INPUT] 0    0    [1    /1   ]  13.154388199         1
[INPUT] 0    0    [1    /1   ]  1.62891066096        1
[INPUT] 0    0    [1    /1   ]  0.345253150028       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [19.126045629611482, 1.0]], [0, [15.896083329361065, 1.0]], [0, [13.154388199033832, 1.0]], [0, [1.6289106609582882, 1.0]], [0, [0.3452531500280125, 1.0]]]}
ecp = {}
CPU time:        52.67
Set gradient conv threshold to 3.16228e-05
cond(S) = 51148.03381272381
E1 = -3.8704052364447477  E_coul = 1.0239637812930096
init E= -2.84644145515174
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913184529304998  LUMO = 1.50518231495852
  mo_energy =
[ -0.91318453   1.50518231  11.54735131  43.7925706  105.68690273]
E1 = -3.8793324830538403  E_coul = 1.0289750491604546
cycle= 1 E= -2.85035743389339  delta_E= -0.00392  |g|= 0.007  |ddm|=  2.1
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.910692031900241  LUMO = 1.50862525616292
  mo_energy =
[ -0.91069203   1.50862526  11.55309718  43.79779263 105.69120469]
E1 = -3.879411491446638  E_coul = 1.029052263061604
cycle= 2 E= -2.85035922838503  delta_E= -1.79e-06  |g|= 0.000418  |ddm|= 0.0646
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910650628169487  LUMO = 1.50867618442706
  mo_energy =
[ -0.91065063   1.50867618  11.55318691  43.79776348 105.69106421]
E1 = -3.879436597814572  E_coul = 1.0290773592925997
cycle= 3 E= -2.85035923852197  delta_E= -1.01e-08  |g|= 8.38e-06  |ddm|= 0.00345
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.910640066368558  LUMO = 1.50868364016105
  mo_energy =
[ -0.91064007   1.50868364  11.5532171   43.79780518 105.69111289]
E1 = -3.8794383049253205  E_coul = 1.0290790663938718
cycle= 4 E= -2.85035923853145  delta_E= -9.48e-12  |g|= 2.41e-07  |ddm|= 1.35e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8794383049253205  E_coul = 1.0290790663938718
  HOMO = -0.910640086068789  LUMO = 1.50868363730986
  mo_energy =
[ -0.91064009   1.50868364  11.55321703  43.79780505 105.6911127 ]
E1 = -3.8794383072592793  E_coul = 1.029079068727824
Extra cycle  E= -2.85035923853146  delta_E= -6.22e-15  |g|= 9.43e-09  |ddm|= 2.1e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [19.12604563 15.89608333 13.1543882   1.62891066  0.34525315]
E = -2.850359238531455
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:42 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  19.1260456296        1
[INPUT] 0    0    [1    /1   ]  15.8960833294        1
[INPUT] 0    0    [1    /1   ]  13.154388199         1
[INPUT] 0    0    [1    /1   ]  1.62891066096        1
[INPUT] 0    0    [1    /1   ]  0.345253150028       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [19.126045629611482, 1.0]], [0, [15.896083329361065, 1.0]], [0, [13.154388199033832, 1.0]], [0, [1.6289106609582882, 1.0]], [0, [0.3452531500280125, 1.0]]]}
ecp = {}
CPU time:        53.10
Set gradient conv threshold to 3.16228e-05
cond(S) = 51148.03381272381
E1 = -3.8704052364447477  E_coul = 1.0239637812930096
init E= -2.84644145515174
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913184529304998  LUMO = 1.50518231495852
  mo_energy =
[ -0.91318453   1.50518231  11.54735131  43.7925706  105.68690273]
E1 = -3.8793324830538403  E_coul = 1.0289750491604546
cycle= 1 E= -2.85035743389339  delta_E= -0.00392  |g|= 0.007  |ddm|=  2.1
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.910692031900241  LUMO = 1.50862525616292
  mo_energy =
[ -0.91069203   1.50862526  11.55309718  43.79779263 105.69120469]
E1 = -3.879411491446638  E_coul = 1.029052263061604
cycle= 2 E= -2.85035922838503  delta_E= -1.79e-06  |g|= 0.000418  |ddm|= 0.0646
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910650628169487  LUMO = 1.50867618442706
  mo_energy =
[ -0.91065063   1.50867618  11.55318691  43.79776348 105.69106421]
E1 = -3.879436597814572  E_coul = 1.0290773592925997
cycle= 3 E= -2.85035923852197  delta_E= -1.01e-08  |g|= 8.38e-06  |ddm|= 0.00345
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.910640066368558  LUMO = 1.50868364016105
  mo_energy =
[ -0.91064007   1.50868364  11.5532171   43.79780518 105.69111289]
E1 = -3.8794383049253205  E_coul = 1.0290790663938718
cycle= 4 E= -2.85035923853145  delta_E= -9.48e-12  |g|= 2.41e-07  |ddm|= 1.35e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8794383049253205  E_coul = 1.0290790663938718
  HOMO = -0.910640086068789  LUMO = 1.50868363730986
  mo_energy =
[ -0.91064009   1.50868364  11.55321703  43.79780505 105.6911127 ]
E1 = -3.8794383072592793  E_coul = 1.029079068727824
Extra cycle  E= -2.85035923853146  delta_E= -6.22e-15  |g|= 9.43e-09  |ddm|= 2.1e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 51148.03381272381
E1 = -3.8794383072592793  E_coul = 1.029079068727824
init E= -2.85035923853146
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.910640084901816  LUMO = 1.50868363862273
  mo_energy =
[ -0.91064008   1.50868364  11.55321703  43.79780505 105.6911127 ]
E1 = -3.879438307793638  E_coul = 1.0290790692621756
cycle= 1 E= -2.85035923853146  delta_E= -7.11e-15  |g|= 7.14e-10  |ddm|= 8.27e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.879438307793638  E_coul = 1.0290790692621756
  HOMO = -0.910640084634646  LUMO = 1.50868363884246
  mo_energy =
[ -0.91064008   1.50868364  11.55321703  43.79780505 105.6911127 ]
E1 = -3.879438307861464  E_coul = 1.0290790693300156
Extra cycle  E= -2.85035923853145  delta_E= 1.42e-14  |g|= 6.38e-11  |ddm|= 4.99e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [19.12604563 15.89608333 13.1543882   1.62891066  0.34525315]
grad_E = [-7.61048572e-06  5.56331630e-05  1.57304649e-04  1.79601199e-03
 -1.67177499e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:44 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  17.7531138709        1
[INPUT] 0    0    [1    /1   ]  14.7464685092        1
[INPUT] 0    0    [1    /1   ]  12.1868613863        1
[INPUT] 0    0    [1    /1   ]  1.54938433532        1
[INPUT] 0    0    [1    /1   ]  0.331567587223       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [17.75311387090438, 1.0]], [0, [14.746468509215065, 1.0]], [0, [12.186861386327342, 1.0]], [0, [1.549384335321929, 1.0]], [0, [0.3315675872227615, 1.0]]]}
ecp = {}
CPU time:        55.22
Set gradient conv threshold to 3.16228e-05
cond(S) = 50902.52141176693
E1 = -3.8714450983150592  E_coul = 1.023818627629899
init E= -2.84762647068516
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913375862893842  LUMO = 1.41701339823566
  mo_energy =
[-0.91337586  1.4170134  10.75448888 40.64190212 97.87057663]
E1 = -3.877299886440758  E_coul = 1.0267147029036314
cycle= 1 E= -2.85058518353713  delta_E= -0.00296  |g|= 0.00528  |ddm|= 1.59
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.91193574602143  LUMO = 1.4193202079646
  mo_energy =
[-0.91193575  1.41932021 10.75755866 40.6439065  97.87135622]
E1 = -3.8772854296727646  E_coul = 1.0266991679550854
cycle= 2 E= -2.85058626171768  delta_E= -1.08e-06  |g|= 0.000316  |ddm|= 0.0526
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911944085737963  LUMO = 1.41933165836856
  mo_energy =
[-0.91194409  1.41933166 10.75752037 40.64372877 97.87105853]
E1 = -3.8773001060228225  E_coul = 1.026713838605051
cycle= 3 E= -2.85058626741777  delta_E= -5.7e-09  |g|= 7.28e-06  |ddm|= 0.00286
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911935459880815  LUMO = 1.41933754481788
  mo_energy =
[-0.91193546  1.41933754 10.75754397 40.64376117 97.87109628]
E1 = -3.8773015999306377  E_coul = 1.026715332505225
cycle= 4 E= -2.85058626742541  delta_E= -7.64e-12  |g|= 1.45e-07  |ddm|= 1.95e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8773015999306377  E_coul = 1.026715332505225
  HOMO = -0.911935467460095  LUMO = 1.41933754451051
  mo_energy =
[-0.91193547  1.41933754 10.75754394 40.64376113 97.87109622]
E1 = -3.8773016007151755  E_coul = 1.0267153332897698
Extra cycle  E= -2.85058626742541  delta_E= 7.11e-15  |g|= 3.58e-09  |ddm|= 1.13e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [17.75311387 14.74646851 12.18686139  1.54938434  0.33156759]
E = -2.8505862674254057
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:45 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  17.7531138709        1
[INPUT] 0    0    [1    /1   ]  14.7464685092        1
[INPUT] 0    0    [1    /1   ]  12.1868613863        1
[INPUT] 0    0    [1    /1   ]  1.54938433532        1
[INPUT] 0    0    [1    /1   ]  0.331567587223       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [17.75311387090438, 1.0]], [0, [14.746468509215065, 1.0]], [0, [12.186861386327342, 1.0]], [0, [1.549384335321929, 1.0]], [0, [0.3315675872227615, 1.0]]]}
ecp = {}
CPU time:        55.65
Set gradient conv threshold to 3.16228e-05
cond(S) = 50902.52141176693
E1 = -3.8714450983150592  E_coul = 1.023818627629899
init E= -2.84762647068516
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913375862893842  LUMO = 1.41701339823566
  mo_energy =
[-0.91337586  1.4170134  10.75448888 40.64190212 97.87057663]
E1 = -3.877299886440758  E_coul = 1.0267147029036314
cycle= 1 E= -2.85058518353713  delta_E= -0.00296  |g|= 0.00528  |ddm|= 1.59
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.91193574602143  LUMO = 1.4193202079646
  mo_energy =
[-0.91193575  1.41932021 10.75755866 40.6439065  97.87135622]
E1 = -3.8772854296727646  E_coul = 1.0266991679550854
cycle= 2 E= -2.85058626171768  delta_E= -1.08e-06  |g|= 0.000316  |ddm|= 0.0526
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911944085737963  LUMO = 1.41933165836856
  mo_energy =
[-0.91194409  1.41933166 10.75752037 40.64372877 97.87105853]
E1 = -3.8773001060228225  E_coul = 1.026713838605051
cycle= 3 E= -2.85058626741777  delta_E= -5.7e-09  |g|= 7.28e-06  |ddm|= 0.00286
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911935459880815  LUMO = 1.41933754481788
  mo_energy =
[-0.91193546  1.41933754 10.75754397 40.64376117 97.87109628]
E1 = -3.8773015999306377  E_coul = 1.026715332505225
cycle= 4 E= -2.85058626742541  delta_E= -7.64e-12  |g|= 1.45e-07  |ddm|= 1.95e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8773015999306377  E_coul = 1.026715332505225
  HOMO = -0.911935467460095  LUMO = 1.41933754451051
  mo_energy =
[-0.91193547  1.41933754 10.75754394 40.64376113 97.87109622]
E1 = -3.8773016007151755  E_coul = 1.0267153332897698
Extra cycle  E= -2.85058626742541  delta_E= 7.11e-15  |g|= 3.58e-09  |ddm|= 1.13e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 50902.52141176693
E1 = -3.8773016007151755  E_coul = 1.0267153332897698
init E= -2.85058626742541
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.911935467067822  LUMO = 1.41933754495977
  mo_energy =
[-0.91193547  1.41933754 10.75754394 40.64376113 97.87109622]
E1 = -3.8773016009029266  E_coul = 1.0267153334775239
cycle= 1 E= -2.8505862674254  delta_E= 3.11e-15  |g|= 2.49e-10  |ddm|= 3.65e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8773016009029266  E_coul = 1.0267153334775239
  HOMO = -0.911935466973943  LUMO = 1.41933754503419
  mo_energy =
[-0.91193547  1.41933755 10.75754394 40.64376113 97.87109622]
E1 = -3.8773016009276047  E_coul = 1.0267153335021924
Extra cycle  E= -2.85058626742541  delta_E= -9.77e-15  |g|= 2.33e-11  |ddm|= 2.03e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [17.75311387 14.74646851 12.18686139  1.54938434  0.33156759]
grad_E = [-4.47153160e-05  1.75937982e-05  1.13883243e-04  3.46312500e-03
 -1.59994441e-02]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:47 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.4681915353        1
[INPUT] 0    0    [1    /1   ]  13.6705677807        1
[INPUT] 0    0    [1    /1   ]  11.2814227494        1
[INPUT] 0    0    [1    /1   ]  1.47502444832        1
[INPUT] 0    0    [1    /1   ]  0.323086387385       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.46819153527108, 1.0]], [0, [13.670567780723115, 1.0]], [0, [11.281422749424301, 1.0]], [0, [1.4750244483237083, 1.0]], [0, [0.3230863873854827, 1.0]]]}
ecp = {}
CPU time:        57.80
Set gradient conv threshold to 3.16228e-05
cond(S) = 50726.49589512424
E1 = -3.871843185000905  E_coul = 1.023784582430311
init E= -2.84805860257059
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913447304379568  LUMO = 1.34936246968797
  mo_energy =
[-0.9134473   1.34936247 10.03452659 37.71851906 90.59034457]
E1 = -3.876876108096344  E_coul = 1.0261798820217005
cycle= 1 E= -2.85069622607464  delta_E= -0.00264  |g|= 0.00542  |ddm|= 1.72
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.912258755271236  LUMO = 1.35134150079698
  mo_energy =
[-0.91225876  1.3513415  10.03703733 37.71980057 90.59023581]
E1 = -3.8769044282737006  E_coul = 1.0262069503388416
cycle= 2 E= -2.85069747793486  delta_E= -1.25e-06  |g|= 0.000352  |ddm|= 0.0598
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.912244286856511  LUMO = 1.35136994888612
  mo_energy =
[-0.91224429  1.35136995 10.03706524 37.71970694 90.59002818]
E1 = -3.8769255294612712  E_coul = 1.0262280434010034
cycle= 3 E= -2.85069748606027  delta_E= -8.13e-09  |g|= 9.13e-06  |ddm|= 0.00348
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.912233766589333  LUMO = 1.35137681593815
  mo_energy =
[-0.91223377  1.35137682 10.03709289 37.71974515 90.59007291]
E1 = -3.876927424866805  E_coul = 1.0262299387941003
cycle= 4 E= -2.85069748607271  delta_E= -1.24e-11  |g|= 1.59e-07  |ddm|= 3.08e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.876927424866805  E_coul = 1.0262299387941003
  HOMO = -0.912233773639292  LUMO = 1.35137681578636
  mo_energy =
[-0.91223377  1.35137682 10.03709287 37.71974512 90.59007285]
E1 = -3.8769274253088666  E_coul = 1.0262299392361556
Extra cycle  E= -2.85069748607271  delta_E= -6.22e-15  |g|= 3.18e-09  |ddm|= 1.21e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [16.46819154 13.67056778 11.28142275  1.47502445  0.32308639]
E = -2.8506974860727112
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:47 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.4681915353        1
[INPUT] 0    0    [1    /1   ]  13.6705677807        1
[INPUT] 0    0    [1    /1   ]  11.2814227494        1
[INPUT] 0    0    [1    /1   ]  1.47502444832        1
[INPUT] 0    0    [1    /1   ]  0.323086387385       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.46819153527108, 1.0]], [0, [13.670567780723115, 1.0]], [0, [11.281422749424301, 1.0]], [0, [1.4750244483237083, 1.0]], [0, [0.3230863873854827, 1.0]]]}
ecp = {}
CPU time:        58.24
Set gradient conv threshold to 3.16228e-05
cond(S) = 50726.49589512424
E1 = -3.871843185000905  E_coul = 1.023784582430311
init E= -2.84805860257059
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913447304379568  LUMO = 1.34936246968797
  mo_energy =
[-0.9134473   1.34936247 10.03452659 37.71851906 90.59034457]
E1 = -3.876876108096344  E_coul = 1.0261798820217005
cycle= 1 E= -2.85069622607464  delta_E= -0.00264  |g|= 0.00542  |ddm|= 1.72
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.912258755271236  LUMO = 1.35134150079698
  mo_energy =
[-0.91225876  1.3513415  10.03703733 37.71980057 90.59023581]
E1 = -3.8769044282737006  E_coul = 1.0262069503388416
cycle= 2 E= -2.85069747793486  delta_E= -1.25e-06  |g|= 0.000352  |ddm|= 0.0598
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.912244286856511  LUMO = 1.35136994888612
  mo_energy =
[-0.91224429  1.35136995 10.03706524 37.71970694 90.59002818]
E1 = -3.8769255294612712  E_coul = 1.0262280434010034
cycle= 3 E= -2.85069748606027  delta_E= -8.13e-09  |g|= 9.13e-06  |ddm|= 0.00348
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.912233766589333  LUMO = 1.35137681593815
  mo_energy =
[-0.91223377  1.35137682 10.03709289 37.71974515 90.59007291]
E1 = -3.876927424866805  E_coul = 1.0262299387941003
cycle= 4 E= -2.85069748607271  delta_E= -1.24e-11  |g|= 1.59e-07  |ddm|= 3.08e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.876927424866805  E_coul = 1.0262299387941003
  HOMO = -0.912233773639292  LUMO = 1.35137681578636
  mo_energy =
[-0.91223377  1.35137682 10.03709287 37.71974512 90.59007285]
E1 = -3.8769274253088666  E_coul = 1.0262299392361556
Extra cycle  E= -2.85069748607271  delta_E= -6.22e-15  |g|= 3.18e-09  |ddm|= 1.21e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 50726.49589512424
E1 = -3.8769274253088666  E_coul = 1.0262299392361556
init E= -2.85069748607271
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.912233773418282  LUMO = 1.35137681608114
  mo_energy =
[-0.91223377  1.35137682 10.03709287 37.71974512 90.59007285]
E1 = -3.876927425441387  E_coul = 1.0262299393686767
cycle= 1 E= -2.85069748607271  delta_E= 8.88e-16  |g|= 1.87e-10  |ddm|= 3.51e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.876927425441387  E_coul = 1.0262299393686767
  HOMO = -0.912233773352007  LUMO = 1.35137681613255
  mo_energy =
[-0.91223377  1.35137682 10.03709287 37.71974512 90.59007285]
E1 = -3.87692742545991  E_coul = 1.0262299393871976
Extra cycle  E= -2.85069748607271  delta_E= -2.22e-15  |g|= 1.79e-11  |ddm|= 1.79e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [16.46819154 13.67056778 11.28142275  1.47502445  0.32308639]
grad_E = [-8.17433373e-05 -1.70173514e-05  7.93722616e-05  2.58615411e-03
 -1.30480040e-02]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:49 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.2960047944        1
[INPUT] 0    0    [1    /1   ]  13.5259632634        1
[INPUT] 0    0    [1    /1   ]  11.1591103474        1
[INPUT] 0    0    [1    /1   ]  1.45911006826        1
[INPUT] 0    0    [1    /1   ]  0.323292746952       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.296004794425986, 1.0]], [0, [13.525963263396736, 1.0]], [0, [11.159110347445267, 1.0]], [0, [1.4591100682630511, 1.0]], [0, [0.3232927469518947, 1.0]]]}
ecp = {}
CPU time:        60.32
Set gradient conv threshold to 3.16228e-05
cond(S) = 50581.80752906628
E1 = -3.8716750522216397  E_coul = 1.0237970643562166
init E= -2.84787798786542
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913448408195989  LUMO = 1.34143064618678
  mo_energy =
[-0.91344841  1.34143065  9.92610605 37.3094944  89.59547501]
E1 = -3.8774448401409742  E_coul = 1.026726087999578
cycle= 1 E= -2.8507187521414  delta_E= -0.00284  |g|= 0.00648  |ddm|= 2.18
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911997191952948  LUMO = 1.34363748515575
  mo_energy =
[-0.91199719  1.34363749  9.92927346 37.31150761 89.59609345]
E1 = -3.877555045559237  E_coul = 1.0268344378773258
cycle= 2 E= -2.85072060768191  delta_E= -1.86e-06  |g|= 0.000438  |ddm|= 0.0742
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911938798811843  LUMO = 1.34369817092892
  mo_energy =
[-0.9119388   1.34369817  9.92941442 37.31155038 89.59603121]
E1 = -3.8775874635310186  E_coul = 1.026866842029351
cycle= 3 E= -2.85072062150167  delta_E= -1.38e-08  |g|= 1.1e-05  |ddm|= 0.00444
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911925708418193  LUMO = 1.34370655735598
  mo_energy =
[-0.91192571  1.34370656  9.92944867 37.31159815 89.59608736]
E1 = -3.8775897891203677  E_coul = 1.0268691676006023
cycle= 4 E= -2.85072062151977  delta_E= -1.81e-11  |g|= 2.23e-07  |ddm|= 2.68e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8775897891203677  E_coul = 1.0268691676006023
  HOMO = -0.911925726959594  LUMO = 1.34370655386641
  mo_energy =
[-0.91192573  1.34370655  9.92944861 37.31159806 89.59608723]
E1 = -3.877589789802758  E_coul = 1.026869168282984
Extra cycle  E= -2.85072062151977  delta_E= -8.44e-15  |g|= 6.25e-09  |ddm|= 2.08e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [16.29600479 13.52596326 11.15911035  1.45911007  0.32329275]
E = -2.850720621519774
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:50 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.2960047944        1
[INPUT] 0    0    [1    /1   ]  13.5259632634        1
[INPUT] 0    0    [1    /1   ]  11.1591103474        1
[INPUT] 0    0    [1    /1   ]  1.45911006826        1
[INPUT] 0    0    [1    /1   ]  0.323292746952       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.296004794425986, 1.0]], [0, [13.525963263396736, 1.0]], [0, [11.159110347445267, 1.0]], [0, [1.4591100682630511, 1.0]], [0, [0.3232927469518947, 1.0]]]}
ecp = {}
CPU time:        60.73
Set gradient conv threshold to 3.16228e-05
cond(S) = 50581.80752906628
E1 = -3.8716750522216397  E_coul = 1.0237970643562166
init E= -2.84787798786542
    CPU time for initialize scf      0.01 sec, wall time      0.01 sec
  HOMO = -0.913448408195989  LUMO = 1.34143064618678
  mo_energy =
[-0.91344841  1.34143065  9.92610605 37.3094944  89.59547501]
E1 = -3.8774448401409742  E_coul = 1.026726087999578
cycle= 1 E= -2.8507187521414  delta_E= -0.00284  |g|= 0.00648  |ddm|= 2.18
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911997191952948  LUMO = 1.34363748515575
  mo_energy =
[-0.91199719  1.34363749  9.92927346 37.31150761 89.59609345]
E1 = -3.877555045559237  E_coul = 1.0268344378773258
cycle= 2 E= -2.85072060768191  delta_E= -1.86e-06  |g|= 0.000438  |ddm|= 0.0742
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911938798811843  LUMO = 1.34369817092892
  mo_energy =
[-0.9119388   1.34369817  9.92941442 37.31155038 89.59603121]
E1 = -3.8775874635310186  E_coul = 1.026866842029351
cycle= 3 E= -2.85072062150167  delta_E= -1.38e-08  |g|= 1.1e-05  |ddm|= 0.00444
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911925708418193  LUMO = 1.34370655735598
  mo_energy =
[-0.91192571  1.34370656  9.92944867 37.31159815 89.59608736]
E1 = -3.8775897891203677  E_coul = 1.0268691676006023
cycle= 4 E= -2.85072062151977  delta_E= -1.81e-11  |g|= 2.23e-07  |ddm|= 2.68e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8775897891203677  E_coul = 1.0268691676006023
  HOMO = -0.911925726959594  LUMO = 1.34370655386641
  mo_energy =
[-0.91192573  1.34370655  9.92944861 37.31159806 89.59608723]
E1 = -3.877589789802758  E_coul = 1.026869168282984
Extra cycle  E= -2.85072062151977  delta_E= -8.44e-15  |g|= 6.25e-09  |ddm|= 2.08e-06
    CPU time for scf_cycle      0.05 sec, wall time      0.05 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 50581.80752906628
E1 = -3.877589789802758  E_coul = 1.026869168282984
init E= -2.85072062151977
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.911925726618385  LUMO = 1.3437065544217
  mo_energy =
[-0.91192573  1.34370655  9.92944861 37.31159806 89.59608723]
E1 = -3.877589790104306  E_coul = 1.026869168584539
cycle= 1 E= -2.85072062151977  delta_E= 6.66e-15  |g|= 4.56e-10  |ddm|= 7.29e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.877589790104306  E_coul = 1.026869168584539
  HOMO = -0.911925726467614  LUMO = 1.3437065545388
  mo_energy =
[-0.91192573  1.34370655  9.92944861 37.31159806 89.59608723]
E1 = -3.8775897901486283  E_coul = 1.02686916862885
Extra cycle  E= -2.85072062151978  delta_E= -1.11e-14  |g|= 4.44e-11  |ddm|= 4.22e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [16.29600479 13.52596326 11.15911035  1.45911007  0.32329275]
grad_E = [-7.54447562e-05 -5.59326874e-06  1.00370117e-04  6.21253397e-04
 -4.34234213e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:52 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.3379086584        1
[INPUT] 0    0    [1    /1   ]  13.5610173138        1
[INPUT] 0    0    [1    /1   ]  11.1885410347        1
[INPUT] 0    0    [1    /1   ]  1.46206198752        1
[INPUT] 0    0    [1    /1   ]  0.324875384769       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.33790865840467, 1.0]], [0, [13.561017313766076, 1.0]], [0, [11.188541034672198, 1.0]], [0, [1.462061987520037, 1.0]], [0, [0.32487538476905237, 1.0]]]}
ecp = {}
CPU time:        62.83
Set gradient conv threshold to 3.16228e-05
cond(S) = 50616.37498904836
E1 = -3.8715376222620455  E_coul = 1.0238149682328666
init E= -2.84772265402918
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913438882447109  LUMO = 1.34799656670065
  mo_energy =
[-0.91343888  1.34799657  9.95586698 37.41100066 89.83864807]
E1 = -3.87784743058649  E_coul = 1.027126061018694
cycle= 1 E= -2.8507213695678  delta_E= -0.003  |g|= 0.00695  |ddm|= 2.36
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911798652263488  LUMO = 1.35037990497857
  mo_energy =
[-0.91179865  1.3503799   9.95950023 37.41357187 89.83986409]
E1 = -3.8779923942656036  E_coul = 1.0272688681104323
cycle= 2 E= -2.85072352615517  delta_E= -2.16e-06  |g|= 0.000475  |ddm|= 0.0798
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911721518215365  LUMO = 1.35045445364796
  mo_energy =
[-0.91172152  1.35045445  9.95968909 37.41367253 89.83986376]
E1 = -3.8780294083142195  E_coul = 1.027305865582696
cycle= 3 E= -2.85072354273152  delta_E= -1.66e-08  |g|= 1.16e-05  |ddm|= 0.0048
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911707590604813  LUMO = 1.35046336222171
  mo_energy =
[-0.91170759  1.35046336  9.9597256  37.41372362 89.83992389]
E1 = -3.87803185792512  E_coul = 1.0273083151737727
cycle= 4 E= -2.85072354275135  delta_E= -1.98e-11  |g|= 2.54e-07  |ddm|= 2.42e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.87803185792512  E_coul = 1.0273083151737727
  HOMO = -0.911707613788798  LUMO = 1.35046335772521
  mo_energy =
[-0.91170761  1.35046336  9.95972553 37.4137235  89.83992372]
E1 = -3.8780318589185168  E_coul = 1.0273083161671552
Extra cycle  E= -2.85072354275136  delta_E= -1.42e-14  |g|= 7.94e-09  |ddm|= 2.49e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [16.33790866 13.56101731 11.18854103  1.46206199  0.32487538]
E = -2.8507235427513615
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:52 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.3379086584        1
[INPUT] 0    0    [1    /1   ]  13.5610173138        1
[INPUT] 0    0    [1    /1   ]  11.1885410347        1
[INPUT] 0    0    [1    /1   ]  1.46206198752        1
[INPUT] 0    0    [1    /1   ]  0.324875384769       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.33790865840467, 1.0]], [0, [13.561017313766076, 1.0]], [0, [11.188541034672198, 1.0]], [0, [1.462061987520037, 1.0]], [0, [0.32487538476905237, 1.0]]]}
ecp = {}
CPU time:        63.32
Set gradient conv threshold to 3.16228e-05
cond(S) = 50616.37498904836
E1 = -3.8715376222620455  E_coul = 1.0238149682328666
init E= -2.84772265402918
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913438882447109  LUMO = 1.34799656670065
  mo_energy =
[-0.91343888  1.34799657  9.95586698 37.41100066 89.83864807]
E1 = -3.87784743058649  E_coul = 1.027126061018694
cycle= 1 E= -2.8507213695678  delta_E= -0.003  |g|= 0.00695  |ddm|= 2.36
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911798652263488  LUMO = 1.35037990497857
  mo_energy =
[-0.91179865  1.3503799   9.95950023 37.41357187 89.83986409]
E1 = -3.8779923942656036  E_coul = 1.0272688681104323
cycle= 2 E= -2.85072352615517  delta_E= -2.16e-06  |g|= 0.000475  |ddm|= 0.0798
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911721518215365  LUMO = 1.35045445364796
  mo_energy =
[-0.91172152  1.35045445  9.95968909 37.41367253 89.83986376]
E1 = -3.8780294083142195  E_coul = 1.027305865582696
cycle= 3 E= -2.85072354273152  delta_E= -1.66e-08  |g|= 1.16e-05  |ddm|= 0.0048
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911707590604813  LUMO = 1.35046336222171
  mo_energy =
[-0.91170759  1.35046336  9.9597256  37.41372362 89.83992389]
E1 = -3.87803185792512  E_coul = 1.0273083151737727
cycle= 4 E= -2.85072354275135  delta_E= -1.98e-11  |g|= 2.54e-07  |ddm|= 2.42e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.87803185792512  E_coul = 1.0273083151737727
  HOMO = -0.911707613788798  LUMO = 1.35046335772521
  mo_energy =
[-0.91170761  1.35046336  9.95972553 37.4137235  89.83992372]
E1 = -3.8780318589185168  E_coul = 1.0273083161671552
Extra cycle  E= -2.85072354275136  delta_E= -1.42e-14  |g|= 7.94e-09  |ddm|= 2.49e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 50616.37498904836
E1 = -3.8780318589185168  E_coul = 1.0273083161671552
init E= -2.85072354275136
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.911707613292099  LUMO = 1.35046335847617
  mo_energy =
[-0.91170761  1.35046336  9.95972553 37.4137235  89.83992372]
E1 = -3.878031859323012  E_coul = 1.0273083165716614
cycle= 1 E= -2.85072354275135  delta_E= 1.11e-14  |g|= 6.03e-10  |ddm|= 9.17e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.878031859323012  E_coul = 1.0273083165716614
  HOMO = -0.911707613089837  LUMO = 1.35046335863292
  mo_energy =
[-0.91170761  1.35046336  9.95972553 37.4137235  89.83992372]
E1 = -3.878031859381991  E_coul = 1.0273083166306323
Extra cycle  E= -2.85072354275136  delta_E= -8.44e-15  |g|= 5.88e-11  |ddm|= 5.49e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [16.33790866 13.56101731 11.18854103  1.46206199  0.32487538]
grad_E = [-7.13279798e-05 -4.64720413e-07  1.07729865e-04 -4.36350640e-05
 -2.79341659e-04]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:54 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.3369865914        1
[INPUT] 0    0    [1    /1   ]  13.5602466439        1
[INPUT] 0    0    [1    /1   ]  11.1878697997        1
[INPUT] 0    0    [1    /1   ]  1.46301126833        1
[INPUT] 0    0    [1    /1   ]  0.325133667422       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.336986591393597, 1.0]], [0, [13.56024664387019, 1.0]], [0, [11.187869799749809, 1.0]], [0, [1.4630112683296996, 1.0]], [0, [0.3251336674224177, 1.0]]]}
ecp = {}
CPU time:        65.45
Set gradient conv threshold to 3.16228e-05
cond(S) = 50636.70231505928
E1 = -3.871528964790559  E_coul = 1.0238189019167336
init E= -2.84771006287383
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913436880102803  LUMO = 1.34931038890176
  mo_energy =
[-0.91343688  1.34931039  9.95923672 37.41341963 89.8380325 ]
E1 = -3.877894225815353  E_coul = 1.0271728000242075
cycle= 1 E= -2.85072142579115  delta_E= -0.00301  |g|= 0.00697  |ddm|= 2.37
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911775317519556  LUMO = 1.35171335314705
  mo_energy =
[-0.91177532  1.35171335  9.9629233  37.41606076 89.83932757]
E1 = -3.878041183819348  E_coul = 1.0273175868869158
cycle= 2 E= -2.85072359693243  delta_E= -2.17e-06  |g|= 0.000476  |ddm|= 0.0799
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.91169710897673  LUMO = 1.3517887069237
  mo_energy =
[-0.91169711  1.35178871  9.96311493 37.41616495 89.83933107]
E1 = -3.8780784209820878  E_coul = 1.0273548073346017
cycle= 3 E= -2.85072361364749  delta_E= -1.67e-08  |g|= 1.17e-05  |ddm|= 0.00482
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911683153157262  LUMO = 1.35179763877319
  mo_energy =
[-0.91168315  1.35179764  9.96315151 37.41621614 89.83939133]
E1 = -3.878080874591713  E_coul = 1.0273572609243329
cycle= 4 E= -2.85072361366738  delta_E= -1.99e-11  |g|= 2.55e-07  |ddm|= 2.42e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.878080874591713  E_coul = 1.0273572609243329
  HOMO = -0.911683176371525  LUMO = 1.35179763428455
  mo_energy =
[-0.91168318  1.35179763  9.96315144 37.41621602 89.83939116]
E1 = -3.8780808755876444  E_coul = 1.027357261920251
Extra cycle  E= -2.85072361366739  delta_E= -1.33e-14  |g|= 7.96e-09  |ddm|= 2.49e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [16.33698659 13.56024664 11.1878698   1.46301127  0.32513367]
E = -2.8507236136673937
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:55 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.3369865914        1
[INPUT] 0    0    [1    /1   ]  13.5602466439        1
[INPUT] 0    0    [1    /1   ]  11.1878697997        1
[INPUT] 0    0    [1    /1   ]  1.46301126833        1
[INPUT] 0    0    [1    /1   ]  0.325133667422       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.336986591393597, 1.0]], [0, [13.56024664387019, 1.0]], [0, [11.187869799749809, 1.0]], [0, [1.4630112683296996, 1.0]], [0, [0.3251336674224177, 1.0]]]}
ecp = {}
CPU time:        65.97
Set gradient conv threshold to 3.16228e-05
cond(S) = 50636.70231505928
E1 = -3.871528964790559  E_coul = 1.0238189019167336
init E= -2.84771006287383
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913436880102803  LUMO = 1.34931038890176
  mo_energy =
[-0.91343688  1.34931039  9.95923672 37.41341963 89.8380325 ]
E1 = -3.877894225815353  E_coul = 1.0271728000242075
cycle= 1 E= -2.85072142579115  delta_E= -0.00301  |g|= 0.00697  |ddm|= 2.37
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911775317519556  LUMO = 1.35171335314705
  mo_energy =
[-0.91177532  1.35171335  9.9629233  37.41606076 89.83932757]
E1 = -3.878041183819348  E_coul = 1.0273175868869158
cycle= 2 E= -2.85072359693243  delta_E= -2.17e-06  |g|= 0.000476  |ddm|= 0.0799
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.91169710897673  LUMO = 1.3517887069237
  mo_energy =
[-0.91169711  1.35178871  9.96311493 37.41616495 89.83933107]
E1 = -3.8780784209820878  E_coul = 1.0273548073346017
cycle= 3 E= -2.85072361364749  delta_E= -1.67e-08  |g|= 1.17e-05  |ddm|= 0.00482
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911683153157262  LUMO = 1.35179763877319
  mo_energy =
[-0.91168315  1.35179764  9.96315151 37.41621614 89.83939133]
E1 = -3.878080874591713  E_coul = 1.0273572609243329
cycle= 4 E= -2.85072361366738  delta_E= -1.99e-11  |g|= 2.55e-07  |ddm|= 2.42e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.878080874591713  E_coul = 1.0273572609243329
  HOMO = -0.911683176371525  LUMO = 1.35179763428455
  mo_energy =
[-0.91168318  1.35179763  9.96315144 37.41621602 89.83939116]
E1 = -3.8780808755876444  E_coul = 1.027357261920251
Extra cycle  E= -2.85072361366739  delta_E= -1.33e-14  |g|= 7.96e-09  |ddm|= 2.49e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 50636.70231505928
E1 = -3.8780808755876444  E_coul = 1.027357261920251
init E= -2.85072361366739
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.911683175873578  LUMO = 1.35179763503803
  mo_energy =
[-0.91168318  1.35179764  9.96315144 37.41621602 89.83939116]
E1 = -3.8780808759929872  E_coul = 1.0273572623255993
cycle= 1 E= -2.85072361366739  delta_E= 5.77e-15  |g|= 6.05e-10  |ddm|= 9.2e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8780808759929872  E_coul = 1.0273572623255993
  HOMO = -0.911683175670897  LUMO = 1.35179763519522
  mo_energy =
[-0.91168318  1.35179764  9.96315144 37.41621602 89.83939116]
E1 = -3.8780808760520844  E_coul = 1.0273572623846898
Extra cycle  E= -2.85072361366739  delta_E= -6.66e-15  |g|= 5.89e-11  |ddm|= 5.51e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [16.33698659 13.56024664 11.1878698   1.46301127  0.32513367]
grad_E = [-7.21680521e-05 -1.60416339e-06  1.05991098e-04 -2.64114058e-05
  2.45454669e-05]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:57 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.3387061877        1
[INPUT] 0    0    [1    /1   ]  13.5616190829        1
[INPUT] 0    0    [1    /1   ]  11.1888957659        1
[INPUT] 0    0    [1    /1   ]  1.46336091245        1
[INPUT] 0    0    [1    /1   ]  0.325202335038       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.338706187660367, 1.0]], [0, [13.561619082925722, 1.0]], [0, [11.188895765915895, 1.0]], [0, [1.4633609124549367, 1.0]], [0, [0.32520233503836116, 1.0]]]}
ecp = {}
CPU time:        68.14
Set gradient conv threshold to 3.16228e-05
cond(S) = 50633.554235190975
E1 = -3.8715274543292373  E_coul = 1.0238198623558372
init E= -2.8477075919734
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91343641270306  LUMO = 1.34971303055968
  mo_energy =
[-0.91343641  1.34971303  9.96108296 37.4181608  89.84828635]
E1 = -3.8779041264514578  E_coul = 1.0271826790755196
cycle= 1 E= -2.85072144737594  delta_E= -0.00301  |g|= 0.00697  |ddm|= 2.36
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911770389098684  LUMO = 1.3521202319046
  mo_energy =
[-0.91177039  1.35212023  9.96478064 37.4208169  89.84959872]
E1 = -3.878051245392263  E_coul = 1.0273276261951327
cycle= 2 E= -2.85072361919713  delta_E= -2.17e-06  |g|= 0.000476  |ddm|= 0.0799
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.91169209450107  LUMO = 1.35219565576274
  mo_energy =
[-0.91169209  1.35219566  9.9649725  37.42092139 89.84960257]
E1 = -3.878088489847492  E_coul = 1.027364853931199
cycle= 3 E= -2.85072363591629  delta_E= -1.67e-08  |g|= 1.17e-05  |ddm|= 0.00481
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911678141370584  LUMO = 1.35220458807971
  mo_energy =
[-0.91167814  1.35220459  9.96500907 37.42097258 89.84966282]
E1 = -3.878090942764214  E_coul = 1.02736730682805
cycle= 4 E= -2.85072363593616  delta_E= -1.99e-11  |g|= 2.54e-07  |ddm|= 2.42e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.878090942764214  E_coul = 1.02736730682805
  HOMO = -0.91167816455406  LUMO = 1.35220458360055
  mo_energy =
[-0.91167816  1.35220458  9.96500901 37.42097246 89.84966265]
E1 = -3.8780909437589393  E_coul = 1.0273673078227612
Extra cycle  E= -2.85072363593618  delta_E= -1.38e-14  |g|= 7.96e-09  |ddm|= 2.49e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [16.33870619 13.56161908 11.18889577  1.46336091  0.32520234]
E = -2.850723635936178
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:17:58 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.3387061877        1
[INPUT] 0    0    [1    /1   ]  13.5616190829        1
[INPUT] 0    0    [1    /1   ]  11.1888957659        1
[INPUT] 0    0    [1    /1   ]  1.46336091245        1
[INPUT] 0    0    [1    /1   ]  0.325202335038       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.338706187660367, 1.0]], [0, [13.561619082925722, 1.0]], [0, [11.188895765915895, 1.0]], [0, [1.4633609124549367, 1.0]], [0, [0.32520233503836116, 1.0]]]}
ecp = {}
CPU time:        68.65
Set gradient conv threshold to 3.16228e-05
cond(S) = 50633.554235190975
E1 = -3.8715274543292373  E_coul = 1.0238198623558372
init E= -2.8477075919734
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91343641270306  LUMO = 1.34971303055968
  mo_energy =
[-0.91343641  1.34971303  9.96108296 37.4181608  89.84828635]
E1 = -3.8779041264514578  E_coul = 1.0271826790755196
cycle= 1 E= -2.85072144737594  delta_E= -0.00301  |g|= 0.00697  |ddm|= 2.36
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911770389098684  LUMO = 1.3521202319046
  mo_energy =
[-0.91177039  1.35212023  9.96478064 37.4208169  89.84959872]
E1 = -3.878051245392263  E_coul = 1.0273276261951327
cycle= 2 E= -2.85072361919713  delta_E= -2.17e-06  |g|= 0.000476  |ddm|= 0.0799
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.91169209450107  LUMO = 1.35219565576274
  mo_energy =
[-0.91169209  1.35219566  9.9649725  37.42092139 89.84960257]
E1 = -3.878088489847492  E_coul = 1.027364853931199
cycle= 3 E= -2.85072363591629  delta_E= -1.67e-08  |g|= 1.17e-05  |ddm|= 0.00481
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911678141370584  LUMO = 1.35220458807971
  mo_energy =
[-0.91167814  1.35220459  9.96500907 37.42097258 89.84966282]
E1 = -3.878090942764214  E_coul = 1.02736730682805
cycle= 4 E= -2.85072363593616  delta_E= -1.99e-11  |g|= 2.54e-07  |ddm|= 2.42e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.878090942764214  E_coul = 1.02736730682805
  HOMO = -0.91167816455406  LUMO = 1.35220458360055
  mo_energy =
[-0.91167816  1.35220458  9.96500901 37.42097246 89.84966265]
E1 = -3.8780909437589393  E_coul = 1.0273673078227612
Extra cycle  E= -2.85072363593618  delta_E= -1.38e-14  |g|= 7.96e-09  |ddm|= 2.49e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 50633.554235190975
E1 = -3.8780909437589393  E_coul = 1.0273673078227612
init E= -2.85072363593618
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.911678164056715  LUMO = 1.35220458435335
  mo_energy =
[-0.91167816  1.35220458  9.96500901 37.42097246 89.84966265]
E1 = -3.87809094416372  E_coul = 1.0273673082275494
cycle= 1 E= -2.85072363593617  delta_E= 7.11e-15  |g|= 6.04e-10  |ddm|= 9.18e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.87809094416372  E_coul = 1.0273673082275494
  HOMO = -0.911678163854299  LUMO = 1.35220458451036
  mo_energy =
[-0.91167816  1.35220458  9.96500901 37.42097246 89.84966265]
E1 = -3.878090944222742  E_coul = 1.02736730828655
Extra cycle  E= -2.85072363593619  delta_E= -2.13e-14  |g|= 5.89e-11  |ddm|= 5.49e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [16.33870619 13.56161908 11.18889577  1.46336091  0.32520234]
grad_E = [-7.23478795e-05 -1.87362322e-06  1.05554511e-04 -1.49837348e-05
  6.54388252e-05]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:00 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.3446921536        1
[INPUT] 0    0    [1    /1   ]  13.5660932443        1
[INPUT] 0    0    [1    /1   ]  11.1916607799        1
[INPUT] 0    0    [1    /1   ]  1.4645410925         1
[INPUT] 0    0    [1    /1   ]  0.325433012414       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.34469215361201, 1.0]], [0, [13.566093244341216, 1.0]], [0, [11.191660779856951, 1.0]], [0, [1.464541092502141, 1.0]], [0, [0.3254330124136756, 1.0]]]}
ecp = {}
CPU time:        70.81
Set gradient conv threshold to 3.16228e-05
cond(S) = 50584.544609043114
E1 = -3.871522777098873  E_coul = 1.0238231298761888
init E= -2.84769964722268
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913434850353307  LUMO = 1.35106839502444
  mo_energy =
[-0.91343485  1.3510684   9.96715386 37.43334948 89.88117532]
E1 = -3.8779371538507665  E_coul = 1.0272155890323504
cycle= 1 E= -2.85072156481842  delta_E= -0.00302  |g|= 0.00697  |ddm|= 2.36
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911753993526078  LUMO = 1.35348967305843
  mo_energy =
[-0.91175399  1.35348967  9.97088851 37.4360556  89.8825457 ]
E1 = -3.878084739174526  E_coul = 1.0273610010427967
cycle= 2 E= -2.85072373813173  delta_E= -2.17e-06  |g|= 0.000477  |ddm|= 0.0797
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911675449987015  LUMO = 1.3535653026113
  mo_energy =
[-0.91167545  1.3535653   9.97108101 37.43616101 89.88255058]
E1 = -3.8781219973941177  E_coul = 1.0273982425362513
cycle= 3 E= -2.85072375485787  delta_E= -1.67e-08  |g|= 1.17e-05  |ddm|= 0.0048
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.91166150796033  LUMO = 1.35357423531326
  mo_energy =
[-0.91166151  1.35357424  9.97111757 37.43621216 89.88261079]
E1 = -3.8781244477044217  E_coul = 1.0274006928267092
cycle= 4 E= -2.85072375487771  delta_E= -1.98e-11  |g|= 2.54e-07  |ddm|= 2.42e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8781244477044217  E_coul = 1.0274006928267092
  HOMO = -0.911661531025519  LUMO = 1.3535742308682
  mo_energy =
[-0.91166153  1.35357423  9.9711175  37.43621204 89.88261062]
E1 = -3.878124448693187  E_coul = 1.027400693815474
Extra cycle  E= -2.85072375487771  delta_E= -4.44e-16  |g|= 7.93e-09  |ddm|= 2.48e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [16.34469215 13.56609324 11.19166078  1.46454109  0.32543301]
E = -2.850723754877713
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:00 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.3446921536        1
[INPUT] 0    0    [1    /1   ]  13.5660932443        1
[INPUT] 0    0    [1    /1   ]  11.1916607799        1
[INPUT] 0    0    [1    /1   ]  1.4645410925         1
[INPUT] 0    0    [1    /1   ]  0.325433012414       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.34469215361201, 1.0]], [0, [13.566093244341216, 1.0]], [0, [11.191660779856951, 1.0]], [0, [1.464541092502141, 1.0]], [0, [0.3254330124136756, 1.0]]]}
ecp = {}
CPU time:        71.34
Set gradient conv threshold to 3.16228e-05
cond(S) = 50584.544609043114
E1 = -3.871522777098873  E_coul = 1.0238231298761888
init E= -2.84769964722268
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913434850353307  LUMO = 1.35106839502444
  mo_energy =
[-0.91343485  1.3510684   9.96715386 37.43334948 89.88117532]
E1 = -3.8779371538507665  E_coul = 1.0272155890323504
cycle= 1 E= -2.85072156481842  delta_E= -0.00302  |g|= 0.00697  |ddm|= 2.36
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911753993526078  LUMO = 1.35348967305843
  mo_energy =
[-0.91175399  1.35348967  9.97088851 37.4360556  89.8825457 ]
E1 = -3.878084739174526  E_coul = 1.0273610010427967
cycle= 2 E= -2.85072373813173  delta_E= -2.17e-06  |g|= 0.000477  |ddm|= 0.0797
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911675449987015  LUMO = 1.3535653026113
  mo_energy =
[-0.91167545  1.3535653   9.97108101 37.43616101 89.88255058]
E1 = -3.8781219973941177  E_coul = 1.0273982425362513
cycle= 3 E= -2.85072375485787  delta_E= -1.67e-08  |g|= 1.17e-05  |ddm|= 0.0048
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.91166150796033  LUMO = 1.35357423531326
  mo_energy =
[-0.91166151  1.35357424  9.97111757 37.43621216 89.88261079]
E1 = -3.8781244477044217  E_coul = 1.0274006928267092
cycle= 4 E= -2.85072375487771  delta_E= -1.98e-11  |g|= 2.54e-07  |ddm|= 2.42e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8781244477044217  E_coul = 1.0274006928267092
  HOMO = -0.911661531025519  LUMO = 1.3535742308682
  mo_energy =
[-0.91166153  1.35357423  9.9711175  37.43621204 89.88261062]
E1 = -3.878124448693187  E_coul = 1.027400693815474
Extra cycle  E= -2.85072375487771  delta_E= -4.44e-16  |g|= 7.93e-09  |ddm|= 2.48e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 50584.544609043114
E1 = -3.878124448693187  E_coul = 1.027400693815474
init E= -2.85072375487771
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.911661530531119  LUMO = 1.35357423161772
  mo_energy =
[-0.91166153  1.35357423  9.9711175  37.43621204 89.88261062]
E1 = -3.878124449095662  E_coul = 1.027400694217941
cycle= 1 E= -2.85072375487772  delta_E= -7.99e-15  |g|= 6.01e-10  |ddm|= 9.13e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.878124449095662  E_coul = 1.027400694217941
  HOMO = -0.911661530329891  LUMO = 1.35357423177396
  mo_energy =
[-0.91166153  1.35357423  9.9711175  37.43621204 89.88261062]
E1 = -3.8781244491543134  E_coul = 1.0274006942765963
Extra cycle  E= -2.85072375487772  delta_E= 4e-15  |g|= 5.86e-11  |ddm|= 5.45e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [16.34469215 13.56609324 11.19166078  1.46454109  0.32543301]
grad_E = [-7.30057630e-05 -2.83946854e-06  1.04032603e-04  2.64004266e-05
  1.95882498e-04]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:02 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.3535370436        1
[INPUT] 0    0    [1    /1   ]  13.5721003724        1
[INPUT] 0    0    [1    /1   ]  11.1941449182        1
[INPUT] 0    0    [1    /1   ]  1.46605224202        1
[INPUT] 0    0    [1    /1   ]  0.325728799692       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.353537043605723, 1.0]], [0, [13.572100372362996, 1.0]], [0, [11.194144918171157, 1.0]], [0, [1.4660522420209774, 1.0]], [0, [0.32572879969199386, 1.0]]]}
ecp = {}
CPU time:        73.55
Set gradient conv threshold to 3.16228e-05
cond(S) = 50433.85873742722
E1 = -3.871516896645252  E_coul = 1.0238273390141934
init E= -2.84768955763106
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913432887540488  LUMO = 1.3528052314801
  mo_energy =
[-0.91343289  1.35280523  9.97485013 37.4525053  89.92350596]
E1 = -3.8779797429169465  E_coul = 1.027257928586697
cycle= 1 E= -2.85072181433025  delta_E= -0.00303  |g|= 0.00697  |ddm|= 2.34
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911732949357469  LUMO = 1.35524462779039
  mo_energy =
[-0.91173295  1.35524463  9.97863235 37.45527583 89.92495101]
E1 = -3.8781279239387914  E_coul = 1.0274039344352661
cycle= 2 E= -2.85072398950353  delta_E= -2.18e-06  |g|= 0.000477  |ddm|= 0.0793
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911654087883636  LUMO = 1.35532052032431
  mo_energy =
[-0.91165409  1.35532052  9.97882569 37.4553824  89.92495721]
E1 = -3.8781651994025697  E_coul = 1.0274411931642118
cycle= 3 E= -2.85072400623836  delta_E= -1.67e-08  |g|= 1.16e-05  |ddm|= 0.00478
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911640160150577  LUMO = 1.35532945346497
  mo_energy =
[-0.91164016  1.35532945  9.97886222 37.45543351 89.92501736]
E1 = -3.8781676463841257  E_coul = 1.0274436401259506
cycle= 4 E= -2.85072400625817  delta_E= -1.98e-11  |g|= 2.53e-07  |ddm|= 2.42e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8781676463841257  E_coul = 1.0274436401259506
  HOMO = -0.911640183066103  LUMO = 1.35532944906126
  mo_energy =
[-0.91164018  1.35532945  9.97886215 37.45543339 89.9250172 ]
E1 = -3.878167647363984  E_coul = 1.0274436411058145
Extra cycle  E= -2.85072400625817  delta_E= 5.33e-15  |g|= 7.88e-09  |ddm|= 2.46e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [16.35353704 13.57210037 11.19414492  1.46605224  0.3257288 ]
E = -2.8507240062581696
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:03 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.3535370436        1
[INPUT] 0    0    [1    /1   ]  13.5721003724        1
[INPUT] 0    0    [1    /1   ]  11.1941449182        1
[INPUT] 0    0    [1    /1   ]  1.46605224202        1
[INPUT] 0    0    [1    /1   ]  0.325728799692       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.353537043605723, 1.0]], [0, [13.572100372362996, 1.0]], [0, [11.194144918171157, 1.0]], [0, [1.4660522420209774, 1.0]], [0, [0.32572879969199386, 1.0]]]}
ecp = {}
CPU time:        74.08
Set gradient conv threshold to 3.16228e-05
cond(S) = 50433.85873742722
E1 = -3.871516896645252  E_coul = 1.0238273390141934
init E= -2.84768955763106
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913432887540488  LUMO = 1.3528052314801
  mo_energy =
[-0.91343289  1.35280523  9.97485013 37.4525053  89.92350596]
E1 = -3.8779797429169465  E_coul = 1.027257928586697
cycle= 1 E= -2.85072181433025  delta_E= -0.00303  |g|= 0.00697  |ddm|= 2.34
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911732949357469  LUMO = 1.35524462779039
  mo_energy =
[-0.91173295  1.35524463  9.97863235 37.45527583 89.92495101]
E1 = -3.8781279239387914  E_coul = 1.0274039344352661
cycle= 2 E= -2.85072398950353  delta_E= -2.18e-06  |g|= 0.000477  |ddm|= 0.0793
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911654087883636  LUMO = 1.35532052032431
  mo_energy =
[-0.91165409  1.35532052  9.97882569 37.4553824  89.92495721]
E1 = -3.8781651994025697  E_coul = 1.0274411931642118
cycle= 3 E= -2.85072400623836  delta_E= -1.67e-08  |g|= 1.16e-05  |ddm|= 0.00478
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911640160150577  LUMO = 1.35532945346497
  mo_energy =
[-0.91164016  1.35532945  9.97886222 37.45543351 89.92501736]
E1 = -3.8781676463841257  E_coul = 1.0274436401259506
cycle= 4 E= -2.85072400625817  delta_E= -1.98e-11  |g|= 2.53e-07  |ddm|= 2.42e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8781676463841257  E_coul = 1.0274436401259506
  HOMO = -0.911640183066103  LUMO = 1.35532944906126
  mo_energy =
[-0.91164018  1.35532945  9.97886215 37.45543339 89.9250172 ]
E1 = -3.878167647363984  E_coul = 1.0274436411058145
Extra cycle  E= -2.85072400625817  delta_E= 5.33e-15  |g|= 7.88e-09  |ddm|= 2.46e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 50433.85873742722
E1 = -3.878167647363984  E_coul = 1.0274436411058145
init E= -2.85072400625817
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.911640182576188  LUMO = 1.35532944980607
  mo_energy =
[-0.91164018  1.35532945  9.97886215 37.45543339 89.9250172 ]
E1 = -3.8781676477633167  E_coul = 1.0274436415051424
cycle= 1 E= -2.85072400625817  delta_E= -4.44e-15  |g|= 5.97e-10  |ddm|= 9.04e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8781676477633167  E_coul = 1.0274436415051424
  HOMO = -0.911640182376505  LUMO = 1.35532944996128
  mo_energy =
[-0.91164018  1.35532945  9.97886215 37.45543339 89.9250172 ]
E1 = -3.8781676478214897  E_coul = 1.0274436415633192
Extra cycle  E= -2.85072400625817  delta_E= 3.55e-15  |g|= 5.82e-11  |ddm|= 5.4e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [16.35353704 13.57210037 11.19414492  1.46605224  0.3257288 ]
grad_E = [-7.38769303e-05 -4.09544545e-06  1.02129247e-04  7.98300754e-05
  3.63139995e-04]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:05 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.3722073558        1
[INPUT] 0    0    [1    /1   ]  13.5832821378        1
[INPUT] 0    0    [1    /1   ]  11.1954138778        1
[INPUT] 0    0    [1    /1   ]  1.46870478911        1
[INPUT] 0    0    [1    /1   ]  0.326250655321       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.372207355822248, 1.0]], [0, [13.583282137831329, 1.0]], [0, [11.195413877827093, 1.0]], [0, [1.4687047891147385, 1.0]], [0, [0.32625065532067893, 1.0]]]}
ecp = {}
CPU time:        76.29
Set gradient conv threshold to 3.16228e-05
cond(S) = 49926.58757483535
E1 = -3.871506833188191  E_coul = 1.0238348309106244
init E= -2.84767200227757
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913429531296355  LUMO = 1.35586221827279
  mo_energy =
[-0.91342953  1.35586222  9.98808331 37.48495427 89.99748483]
E1 = -3.878055717778543  E_coul = 1.0273331864847903
cycle= 1 E= -2.85072253129375  delta_E= -0.00305  |g|= 0.00697  |ddm|= 2.31
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911695680397512  LUMO = 1.35833382586888
  mo_energy =
[-0.91169568  1.35833383  9.99195017 37.48783938 89.99906274]
E1 = -3.8782049642477046  E_coul = 1.027480254486299
cycle= 2 E= -2.85072470976141  delta_E= -2.18e-06  |g|= 0.000478  |ddm|= 0.0782
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911616250218515  LUMO = 1.35841018826745
  mo_energy =
[-0.91161625  1.35841019  9.992145   37.48794805 89.99907131]
E1 = -3.8782422719210197  E_coul = 1.0275175454082286
cycle= 3 E= -2.85072472651279  delta_E= -1.68e-08  |g|= 1.16e-05  |ddm|= 0.00472
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911602347286567  LUMO = 1.35841912234983
  mo_energy =
[-0.91160235  1.35841912  9.99218148 37.48799908 89.99913137]
E1 = -3.87824471317522  E_coul = 1.027519986642692
cycle= 4 E= -2.85072472653253  delta_E= -1.97e-11  |g|= 2.51e-07  |ddm|= 2.41e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.87824471317522  E_coul = 1.027519986642692
  HOMO = -0.911602369944903  LUMO = 1.35841911801223
  mo_energy =
[-0.91160237  1.35841912  9.99218141 37.48799896 89.9991312 ]
E1 = -3.8782447141358736  E_coul = 1.0275199876033505
Extra cycle  E= -2.85072472653252  delta_E= 4.88e-15  |g|= 7.81e-09  |ddm|= 2.4e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.07 sec
exp = [16.37220736 13.58328214 11.19541388  1.46870479  0.32625066]
E = -2.850724726532523
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:06 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.3722073558        1
[INPUT] 0    0    [1    /1   ]  13.5832821378        1
[INPUT] 0    0    [1    /1   ]  11.1954138778        1
[INPUT] 0    0    [1    /1   ]  1.46870478911        1
[INPUT] 0    0    [1    /1   ]  0.326250655321       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.372207355822248, 1.0]], [0, [13.583282137831329, 1.0]], [0, [11.195413877827093, 1.0]], [0, [1.4687047891147385, 1.0]], [0, [0.32625065532067893, 1.0]]]}
ecp = {}
CPU time:        76.82
Set gradient conv threshold to 3.16228e-05
cond(S) = 49926.58757483535
E1 = -3.871506833188191  E_coul = 1.0238348309106244
init E= -2.84767200227757
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913429531296355  LUMO = 1.35586221827279
  mo_energy =
[-0.91342953  1.35586222  9.98808331 37.48495427 89.99748483]
E1 = -3.878055717778543  E_coul = 1.0273331864847903
cycle= 1 E= -2.85072253129375  delta_E= -0.00305  |g|= 0.00697  |ddm|= 2.31
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911695680397512  LUMO = 1.35833382586888
  mo_energy =
[-0.91169568  1.35833383  9.99195017 37.48783938 89.99906274]
E1 = -3.8782049642477046  E_coul = 1.027480254486299
cycle= 2 E= -2.85072470976141  delta_E= -2.18e-06  |g|= 0.000478  |ddm|= 0.0782
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911616250218515  LUMO = 1.35841018826745
  mo_energy =
[-0.91161625  1.35841019  9.992145   37.48794805 89.99907131]
E1 = -3.8782422719210197  E_coul = 1.0275175454082286
cycle= 3 E= -2.85072472651279  delta_E= -1.68e-08  |g|= 1.16e-05  |ddm|= 0.00472
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911602347286567  LUMO = 1.35841912234983
  mo_energy =
[-0.91160235  1.35841912  9.99218148 37.48799908 89.99913137]
E1 = -3.87824471317522  E_coul = 1.027519986642692
cycle= 4 E= -2.85072472653253  delta_E= -1.97e-11  |g|= 2.51e-07  |ddm|= 2.41e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.87824471317522  E_coul = 1.027519986642692
  HOMO = -0.911602369944903  LUMO = 1.35841911801223
  mo_energy =
[-0.91160237  1.35841912  9.99218141 37.48799896 89.9991312 ]
E1 = -3.8782447141358736  E_coul = 1.0275199876033505
Extra cycle  E= -2.85072472653252  delta_E= 4.88e-15  |g|= 7.81e-09  |ddm|= 2.4e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 49926.58757483535
E1 = -3.8782447141358736  E_coul = 1.0275199876033505
init E= -2.85072472653252
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.911602369464596  LUMO = 1.3584191187474
  mo_energy =
[-0.91160237  1.35841912  9.99218141 37.48799896 89.9991312 ]
E1 = -3.878244714529185  E_coul = 1.0275199879966574
cycle= 1 E= -2.85072472653253  delta_E= -4.88e-15  |g|= 5.9e-10  |ddm|= 8.84e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.878244714529185  E_coul = 1.0275199879966574
  HOMO = -0.911602369267935  LUMO = 1.35841911890059
  mo_energy =
[-0.91160237  1.35841912  9.99218141 37.48799896 89.9991312 ]
E1 = -3.878244714586476  E_coul = 1.0275199880539516
Extra cycle  E= -2.85072472653252  delta_E= 3.55e-15  |g|= 5.73e-11  |ddm|= 5.27e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [16.37220736 13.58328214 11.19541388  1.46870479  0.32625066]
grad_E = [-7.54996506e-05 -6.37017801e-06  9.88881580e-05  1.74951605e-04
  6.60608847e-04]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:08 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.4091929454        1
[INPUT] 0    0    [1    /1   ]  13.6021992951        1
[INPUT] 0    0    [1    /1   ]  11.189349781         1
[INPUT] 0    0    [1    /1   ]  1.47279129904        1
[INPUT] 0    0    [1    /1   ]  0.327061551566       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.409192945405977, 1.0]], [0, [13.602199295118382, 1.0]], [0, [11.189349780975226, 1.0]], [0, [1.4727912990398333, 1.0]], [0, [0.3270615515657342, 1.0]]]}
ecp = {}
CPU time:        79.03
Set gradient conv threshold to 3.16228e-05
cond(S) = 48543.291503076995
E1 = -3.8714919926036413  E_coul = 1.0238466379094975
init E= -2.84764535469414
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913424594882177  LUMO = 1.36059324107377
  mo_energy =
[-0.91342459  1.36059324 10.0077543  37.53191923 90.11077336]
E1 = -3.878175917681806  E_coul = 1.0274515553041983
cycle= 1 E= -2.85072436237761  delta_E= -0.00308  |g|= 0.00697  |ddm|= 2.23
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911637413887904  LUMO = 1.36311552839475
  mo_energy =
[-0.91163741  1.36311553 10.01175447 37.53498487 90.11256058]
E1 = -3.878326858130978  E_coul = 1.0276003121160688
cycle= 2 E= -2.85072654601491  delta_E= -2.18e-06  |g|= 0.000478  |ddm|= 0.0757
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.91155707935783  LUMO = 1.36319263655433
  mo_energy =
[-0.91155708  1.36319264 10.01195167 37.53509687 90.11257289]
E1 = -3.878364220642302  E_coul = 1.027637657847102
cycle= 3 E= -2.8507265627952  delta_E= -1.68e-08  |g|= 1.16e-05  |ddm|= 0.00457
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911543213851625  LUMO = 1.36320157255821
  mo_energy =
[-0.91154321  1.36320157 10.01198808 37.53514778 90.11263282]
E1 = -3.878366653373391  E_coul = 1.0276400905585412
cycle= 4 E= -2.85072656281485  delta_E= -1.96e-11  |g|= 2.49e-07  |ddm|= 2.38e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.878366653373391  E_coul = 1.0276400905585412
  HOMO = -0.911543236128167  LUMO = 1.36320156830558
  mo_energy =
[-0.91154324  1.36320157 10.01198801 37.53514767 90.11263265]
E1 = -3.8783666542952795  E_coul = 1.0276400914804276
Extra cycle  E= -2.85072656281485  delta_E= -2.22e-15  |g|= 7.68e-09  |ddm|= 2.3e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [16.40919295 13.6021993  11.18934978  1.4727913   0.32706155]
E = -2.850726562814852
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:08 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.4091929454        1
[INPUT] 0    0    [1    /1   ]  13.6021992951        1
[INPUT] 0    0    [1    /1   ]  11.189349781         1
[INPUT] 0    0    [1    /1   ]  1.47279129904        1
[INPUT] 0    0    [1    /1   ]  0.327061551566       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.409192945405977, 1.0]], [0, [13.602199295118382, 1.0]], [0, [11.189349780975226, 1.0]], [0, [1.4727912990398333, 1.0]], [0, [0.3270615515657342, 1.0]]]}
ecp = {}
CPU time:        79.58
Set gradient conv threshold to 3.16228e-05
cond(S) = 48543.291503076995
E1 = -3.8714919926036413  E_coul = 1.0238466379094975
init E= -2.84764535469414
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913424594882177  LUMO = 1.36059324107377
  mo_energy =
[-0.91342459  1.36059324 10.0077543  37.53191923 90.11077336]
E1 = -3.878175917681806  E_coul = 1.0274515553041983
cycle= 1 E= -2.85072436237761  delta_E= -0.00308  |g|= 0.00697  |ddm|= 2.23
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911637413887904  LUMO = 1.36311552839475
  mo_energy =
[-0.91163741  1.36311553 10.01175447 37.53498487 90.11256058]
E1 = -3.878326858130978  E_coul = 1.0276003121160688
cycle= 2 E= -2.85072654601491  delta_E= -2.18e-06  |g|= 0.000478  |ddm|= 0.0757
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.91155707935783  LUMO = 1.36319263655433
  mo_energy =
[-0.91155708  1.36319264 10.01195167 37.53509687 90.11257289]
E1 = -3.878364220642302  E_coul = 1.027637657847102
cycle= 3 E= -2.8507265627952  delta_E= -1.68e-08  |g|= 1.16e-05  |ddm|= 0.00457
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911543213851625  LUMO = 1.36320157255821
  mo_energy =
[-0.91154321  1.36320157 10.01198808 37.53514778 90.11263282]
E1 = -3.878366653373391  E_coul = 1.0276400905585412
cycle= 4 E= -2.85072656281485  delta_E= -1.96e-11  |g|= 2.49e-07  |ddm|= 2.38e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.878366653373391  E_coul = 1.0276400905585412
  HOMO = -0.911543236128167  LUMO = 1.36320156830558
  mo_energy =
[-0.91154324  1.36320157 10.01198801 37.53514767 90.11263265]
E1 = -3.8783666542952795  E_coul = 1.0276400914804276
Extra cycle  E= -2.85072656281485  delta_E= -2.22e-15  |g|= 7.68e-09  |ddm|= 2.3e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 48543.291503076995
E1 = -3.8783666542952795  E_coul = 1.0276400914804276
init E= -2.85072656281485
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.911543235667223  LUMO = 1.36320156902238
  mo_energy =
[-0.91154324  1.36320157 10.01198801 37.53514767 90.11263265]
E1 = -3.8783666546780613  E_coul = 1.0276400918632207
cycle= 1 E= -2.85072656281484  delta_E= 1.11e-14  |g|= 5.78e-10  |ddm|= 8.42e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8783666546780613  E_coul = 1.0276400918632207
  HOMO = -0.911543235475816  LUMO = 1.36320156917203
  mo_energy =
[-0.91154324  1.36320157 10.01198801 37.53514767 90.11263265]
E1 = -3.878366654733826  E_coul = 1.0276400919189823
Extra cycle  E= -2.85072656281484  delta_E= -2.66e-15  |g|= 5.59e-11  |ddm|= 5.01e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [16.40919295 13.6021993  11.18934978  1.4727913   0.32706155]
grad_E = [-7.82336313e-05 -1.00496573e-05  9.41420738e-05  3.24888819e-04
  1.12896763e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:11 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.4914033751        1
[INPUT] 0    0    [1    /1   ]  13.6374526114        1
[INPUT] 0    0    [1    /1   ]  11.1578450655        1
[INPUT] 0    0    [1    /1   ]  1.47940973135        1
[INPUT] 0    0    [1    /1   ]  0.328393820412       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.491403375149453, 1.0]], [0, [13.63745261143497, 1.0]], [0, [11.157845065460952, 1.0]], [0, [1.4794097313477523, 1.0]], [0, [0.3283938204123177, 1.0]]]}
ecp = {}
CPU time:        81.80
Set gradient conv threshold to 3.16228e-05
cond(S) = 44885.62344364359
E1 = -3.871469808447974  E_coul = 1.023866478621041
init E= -2.84760332982693
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913417237324701  LUMO = 1.3683132772909
  mo_energy =
[-0.91341724  1.36831328 10.03760863 37.59954761 90.29231493]
E1 = -3.878379064485172  E_coul = 1.0276497641109466
cycle= 1 E= -2.85072930037423  delta_E= -0.00313  |g|= 0.00697  |ddm|= 2.03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911540782341643  LUMO = 1.37092046106382
  mo_energy =
[-0.91154078  1.37092046 10.04183242 37.60291634 90.29445361]
E1 = -3.8785328778108963  E_coul = 1.0278013852960812
cycle= 2 E= -2.85073149251482  delta_E= -2.19e-06  |g|= 0.00048  |ddm|= 0.0694
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911458913779539  LUMO = 1.37099883114201
  mo_energy =
[-0.91145891  1.37099883 10.04203366 37.60303398 90.29447225]
E1 = -3.878570341466773  E_coul = 1.0278388321166223
cycle= 3 E= -2.85073150935015  delta_E= -1.68e-08  |g|= 1.16e-05  |ddm|= 0.00421
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911445107098806  LUMO = 1.37100777136363
  mo_energy =
[-0.91144511  1.37100777 10.04206995 37.6030847  90.29453195]
E1 = -3.8785727611540097  E_coul = 1.0278412517843758
cycle= 4 E= -2.85073150936963  delta_E= -1.95e-11  |g|= 2.44e-07  |ddm|= 2.29e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8785727611540097  E_coul = 1.0278412517843758
  HOMO = -0.911445128792618  LUMO = 1.37100776720361
  mo_energy =
[-0.91144513  1.37100777 10.04206988 37.60308459 90.29453179]
E1 = -3.8785727619884445  E_coul = 1.0278412526188043
Extra cycle  E= -2.85073150936964  delta_E= -6.22e-15  |g|= 7.43e-09  |ddm|= 2.06e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [16.49140338 13.63745261 11.15784507  1.47940973  0.32839382]
E = -2.8507315093696404
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:11 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.4914033751        1
[INPUT] 0    0    [1    /1   ]  13.6374526114        1
[INPUT] 0    0    [1    /1   ]  11.1578450655        1
[INPUT] 0    0    [1    /1   ]  1.47940973135        1
[INPUT] 0    0    [1    /1   ]  0.328393820412       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.491403375149453, 1.0]], [0, [13.63745261143497, 1.0]], [0, [11.157845065460952, 1.0]], [0, [1.4794097313477523, 1.0]], [0, [0.3283938204123177, 1.0]]]}
ecp = {}
CPU time:        82.37
Set gradient conv threshold to 3.16228e-05
cond(S) = 44885.62344364359
E1 = -3.871469808447974  E_coul = 1.023866478621041
init E= -2.84760332982693
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913417237324701  LUMO = 1.3683132772909
  mo_energy =
[-0.91341724  1.36831328 10.03760863 37.59954761 90.29231493]
E1 = -3.878379064485172  E_coul = 1.0276497641109466
cycle= 1 E= -2.85072930037423  delta_E= -0.00313  |g|= 0.00697  |ddm|= 2.03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911540782341643  LUMO = 1.37092046106382
  mo_energy =
[-0.91154078  1.37092046 10.04183242 37.60291634 90.29445361]
E1 = -3.8785328778108963  E_coul = 1.0278013852960812
cycle= 2 E= -2.85073149251482  delta_E= -2.19e-06  |g|= 0.00048  |ddm|= 0.0694
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911458913779539  LUMO = 1.37099883114201
  mo_energy =
[-0.91145891  1.37099883 10.04203366 37.60303398 90.29447225]
E1 = -3.878570341466773  E_coul = 1.0278388321166223
cycle= 3 E= -2.85073150935015  delta_E= -1.68e-08  |g|= 1.16e-05  |ddm|= 0.00421
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911445107098806  LUMO = 1.37100777136363
  mo_energy =
[-0.91144511  1.37100777 10.04206995 37.6030847  90.29453195]
E1 = -3.8785727611540097  E_coul = 1.0278412517843758
cycle= 4 E= -2.85073150936963  delta_E= -1.95e-11  |g|= 2.44e-07  |ddm|= 2.29e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8785727611540097  E_coul = 1.0278412517843758
  HOMO = -0.911445128792618  LUMO = 1.37100776720361
  mo_energy =
[-0.91144513  1.37100777 10.04206988 37.60308459 90.29453179]
E1 = -3.8785727619884445  E_coul = 1.0278412526188043
Extra cycle  E= -2.85073150936964  delta_E= -6.22e-15  |g|= 7.43e-09  |ddm|= 2.06e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 44885.62344364359
E1 = -3.8785727619884445  E_coul = 1.0278412526188043
init E= -2.85073150936964
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.911445128375418  LUMO = 1.37100776788095
  mo_energy =
[-0.91144513  1.37100777 10.04206988 37.60308459 90.29453179]
E1 = -3.8785727623508173  E_coul = 1.0278412529811782
cycle= 1 E= -2.85073150936964  delta_E= 1.33e-15  |g|= 5.54e-10  |ddm|= 7.51e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8785727623508173  E_coul = 1.0278412529811782
  HOMO = -0.911445128194225  LUMO = 1.37100776802359
  mo_energy =
[-0.91144513  1.37100777 10.04206988 37.60308459 90.29453179]
E1 = -3.878572762403725  E_coul = 1.027841253034092
Extra cycle  E= -2.85073150936963  delta_E= 5.77e-15  |g|= 5.34e-11  |ddm|= 4.43e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [16.49140338 13.63745261 11.15784507  1.47940973  0.32839382]
grad_E = [-8.32688534e-05 -1.64718868e-05  8.70387495e-05  5.77477553e-04
  1.91336316e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:14 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.6855166523        1
[INPUT] 0    0    [1    /1   ]  13.7073346351        1
[INPUT] 0    0    [1    /1   ]  11.0480231232        1
[INPUT] 0    0    [1    /1   ]  1.49013335239        1
[INPUT] 0    0    [1    /1   ]  0.330605348601       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.685516652341267, 1.0]], [0, [13.707334635110392, 1.0]], [0, [11.048023123170637, 1.0]], [0, [1.4901333523891676, 1.0]], [0, [0.33060534860109847, 1.0]]]}
ecp = {}
CPU time:        84.66
Set gradient conv threshold to 3.16228e-05
cond(S) = 36422.31196295461
E1 = -3.871439271395402  E_coul = 1.0239006341464865
init E= -2.84753863724892
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913407043139247  LUMO = 1.38097890202551
  mo_energy =
[-0.91340704  1.3809789  10.08000743 37.68418917 90.58006836]
E1 = -3.8787311319834545  E_coul = 1.0279884408056288
cycle= 1 E= -2.85074269117783  delta_E= -0.0032  |g|= 0.00697  |ddm|= 1.61
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911378145309355  LUMO = 1.38373120746986
  mo_energy =
[-0.91137815  1.38373121 10.08461417 37.68807803 90.58281062]
E1 = -3.8788898572408645  E_coul = 1.0281449607558706
cycle= 2 E= -2.85074489648499  delta_E= -2.21e-06  |g|= 0.000482  |ddm|= 0.0556
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911293653778042  LUMO = 1.3838117315751
  mo_energy =
[-0.91129365  1.38381173 10.08482233 37.68820535 90.58284007]
E1 = -3.8789275052880123  E_coul = 1.0281825918638636
cycle= 3 E= -2.85074491342415  delta_E= -1.69e-08  |g|= 1.15e-05  |ddm|= 0.00339
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911279939817488  LUMO = 1.38382068037162
  mo_energy =
[-0.91127994  1.38382068 10.08485841 37.68825575 90.58289941]
E1 = -3.8789299056047657  E_coul = 1.0281849921613293
cycle= 4 E= -2.85074491344344  delta_E= -1.93e-11  |g|= 2.36e-07  |ddm|= 2.08e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8789299056047657  E_coul = 1.0281849921613293
  HOMO = -0.911279960641052  LUMO = 1.3838206762425
  mo_energy =
[-0.91127996  1.38382068 10.08485835 37.68825565 90.58289926]
E1 = -3.8789299062297897  E_coul = 1.0281849927863569
Extra cycle  E= -2.85074491344343  delta_E= 3.55e-15  |g|= 6.96e-09  |ddm|= 1.59e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [16.68551665 13.70733464 11.04802312  1.49013335  0.33060535]
E = -2.8507449134434326
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:14 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  16.6855166523        1
[INPUT] 0    0    [1    /1   ]  13.7073346351        1
[INPUT] 0    0    [1    /1   ]  11.0480231232        1
[INPUT] 0    0    [1    /1   ]  1.49013335239        1
[INPUT] 0    0    [1    /1   ]  0.330605348601       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [16.685516652341267, 1.0]], [0, [13.707334635110392, 1.0]], [0, [11.048023123170637, 1.0]], [0, [1.4901333523891676, 1.0]], [0, [0.33060534860109847, 1.0]]]}
ecp = {}
CPU time:        85.25
Set gradient conv threshold to 3.16228e-05
cond(S) = 36422.31196295461
E1 = -3.871439271395402  E_coul = 1.0239006341464865
init E= -2.84753863724892
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913407043139247  LUMO = 1.38097890202551
  mo_energy =
[-0.91340704  1.3809789  10.08000743 37.68418917 90.58006836]
E1 = -3.8787311319834545  E_coul = 1.0279884408056288
cycle= 1 E= -2.85074269117783  delta_E= -0.0032  |g|= 0.00697  |ddm|= 1.61
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911378145309355  LUMO = 1.38373120746986
  mo_energy =
[-0.91137815  1.38373121 10.08461417 37.68807803 90.58281062]
E1 = -3.8788898572408645  E_coul = 1.0281449607558706
cycle= 2 E= -2.85074489648499  delta_E= -2.21e-06  |g|= 0.000482  |ddm|= 0.0556
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911293653778042  LUMO = 1.3838117315751
  mo_energy =
[-0.91129365  1.38381173 10.08482233 37.68820535 90.58284007]
E1 = -3.8789275052880123  E_coul = 1.0281825918638636
cycle= 3 E= -2.85074491342415  delta_E= -1.69e-08  |g|= 1.15e-05  |ddm|= 0.00339
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911279939817488  LUMO = 1.38382068037162
  mo_energy =
[-0.91127994  1.38382068 10.08485841 37.68825575 90.58289941]
E1 = -3.8789299056047657  E_coul = 1.0281849921613293
cycle= 4 E= -2.85074491344344  delta_E= -1.93e-11  |g|= 2.36e-07  |ddm|= 2.08e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8789299056047657  E_coul = 1.0281849921613293
  HOMO = -0.911279960641052  LUMO = 1.3838206762425
  mo_energy =
[-0.91127996  1.38382068 10.08485835 37.68825565 90.58289926]
E1 = -3.8789299062297897  E_coul = 1.0281849927863569
Extra cycle  E= -2.85074491344343  delta_E= 3.55e-15  |g|= 6.96e-09  |ddm|= 1.59e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 36422.31196295461
E1 = -3.8789299062297897  E_coul = 1.0281849927863569
init E= -2.85074491344343
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.911279960328533  LUMO = 1.38382067682862
  mo_energy =
[-0.91127996  1.38382068 10.08485835 37.68825564 90.58289926]
E1 = -3.8789299065495326  E_coul = 1.0281849931060953
cycle= 1 E= -2.85074491344344  delta_E= -4.44e-15  |g|= 5.06e-10  |ddm|= 5.68e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8789299065495326  E_coul = 1.0281849931060953
  HOMO = -0.911279960168669  LUMO = 1.3838206769563
  mo_energy =
[-0.91127996  1.38382068 10.08485835 37.68825564 90.58289926]
E1 = -3.8789299065967424  E_coul = 1.0281849931533065
Extra cycle  E= -2.85074491344344  delta_E= 8.88e-16  |g|= 4.83e-11  |ddm|= 3.3e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [16.68551665 13.70733464 11.04802312  1.49013335  0.33060535]
grad_E = [-9.29719673e-05 -2.81196483e-05  7.66689266e-05  1.01764071e-03
  3.24550218e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:16 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  17.1917195312        1
[INPUT] 0    0    [1    /1   ]  13.8647575541        1
[INPUT] 0    0    [1    /1   ]  10.6958122224        1
[INPUT] 0    0    [1    /1   ]  1.50863225842        1
[INPUT] 0    0    [1    /1   ]  0.334578084061       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [17.19171953120422, 1.0]], [0, [13.864757554078063, 1.0]], [0, [10.695812222373926, 1.0]], [0, [1.5086322584182, 1.0]], [0, [0.334578084060707, 1.0]]]}
ecp = {}
CPU time:        87.55
Set gradient conv threshold to 3.16228e-05
cond(S) = 21204.2605114496
E1 = -3.8714044929846834  E_coul = 1.0239657632461558
init E= -2.84743872973853
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913393994095383  LUMO = 1.40327134762072
  mo_energy =
[-0.91339399  1.40327135 10.13191633 37.74307163 91.04656489]
E1 = -3.8794017114732884  E_coul = 1.0286209854045787
cycle= 1 E= -2.85078072606871  delta_E= -0.00334  |g|= 0.00692  |ddm|= 0.906
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911080895707624  LUMO = 1.40629474057729
  mo_energy =
[-0.9110809   1.40629474 10.13723879 37.74793941 91.05044694]
E1 = -3.879568808362669  E_coul = 1.028785864632515
cycle= 2 E= -2.85078294373015  delta_E= -2.22e-06  |g|= 0.000485  |ddm|= 0.0319
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910991939071216  LUMO = 1.40637895330852
  mo_energy =
[-0.91099194  1.40637895 10.13745878 37.74808357 91.05049513]
E1 = -3.87960672082491  E_coul = 1.0288237600030816
cycle= 3 E= -2.85078296082183  delta_E= -1.71e-08  |g|= 1.14e-05  |ddm|= 0.00198
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.910978396285699  LUMO = 1.40638791088145
  mo_energy =
[-0.9109784   1.40638791 10.1374944  37.74813333 91.05055374]
E1 = -3.879609090452956  E_coul = 1.0288261296120884
cycle= 4 E= -2.85078296084087  delta_E= -1.9e-11  |g|= 2.17e-07  |ddm|= 1.63e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.879609090452956  E_coul = 1.0288261296120884
  HOMO = -0.910978415614382  LUMO = 1.40638790650786
  mo_energy =
[-0.91097842  1.40638791 10.13749434 37.74813323 91.05055361]
E1 = -3.8796090905180094  E_coul = 1.0288261296771424
Extra cycle  E= -2.85078296084087  delta_E= 8.88e-16  |g|= 5.82e-09  |ddm|= 8.23e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [17.19171953 13.86475755 10.69581222  1.50863226  0.33457808]
E = -2.850782960840867
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:17 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  17.1917195312        1
[INPUT] 0    0    [1    /1   ]  13.8647575541        1
[INPUT] 0    0    [1    /1   ]  10.6958122224        1
[INPUT] 0    0    [1    /1   ]  1.50863225842        1
[INPUT] 0    0    [1    /1   ]  0.334578084061       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [17.19171953120422, 1.0]], [0, [13.864757554078063, 1.0]], [0, [10.695812222373926, 1.0]], [0, [1.5086322584182, 1.0]], [0, [0.334578084060707, 1.0]]]}
ecp = {}
CPU time:        88.14
Set gradient conv threshold to 3.16228e-05
cond(S) = 21204.2605114496
E1 = -3.8714044929846834  E_coul = 1.0239657632461558
init E= -2.84743872973853
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913393994095383  LUMO = 1.40327134762072
  mo_energy =
[-0.91339399  1.40327135 10.13191633 37.74307163 91.04656489]
E1 = -3.8794017114732884  E_coul = 1.0286209854045787
cycle= 1 E= -2.85078072606871  delta_E= -0.00334  |g|= 0.00692  |ddm|= 0.906
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911080895707624  LUMO = 1.40629474057729
  mo_energy =
[-0.9110809   1.40629474 10.13723879 37.74793941 91.05044694]
E1 = -3.879568808362669  E_coul = 1.028785864632515
cycle= 2 E= -2.85078294373015  delta_E= -2.22e-06  |g|= 0.000485  |ddm|= 0.0319
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910991939071216  LUMO = 1.40637895330852
  mo_energy =
[-0.91099194  1.40637895 10.13745878 37.74808357 91.05049513]
E1 = -3.87960672082491  E_coul = 1.0288237600030816
cycle= 3 E= -2.85078296082183  delta_E= -1.71e-08  |g|= 1.14e-05  |ddm|= 0.00198
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.910978396285699  LUMO = 1.40638791088145
  mo_energy =
[-0.9109784   1.40638791 10.1374944  37.74813333 91.05055374]
E1 = -3.879609090452956  E_coul = 1.0288261296120884
cycle= 4 E= -2.85078296084087  delta_E= -1.9e-11  |g|= 2.17e-07  |ddm|= 1.63e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.879609090452956  E_coul = 1.0288261296120884
  HOMO = -0.910978415614382  LUMO = 1.40638790650786
  mo_energy =
[-0.91097842  1.40638791 10.13749434 37.74813323 91.05055361]
E1 = -3.8796090905180094  E_coul = 1.0288261296771424
Extra cycle  E= -2.85078296084087  delta_E= 8.88e-16  |g|= 5.82e-09  |ddm|= 8.23e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 21204.2605114496
E1 = -3.8796090905180094  E_coul = 1.0288261296771424
init E= -2.85078296084087
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.910978415581863  LUMO = 1.40638790685112
  mo_energy =
[-0.91097842  1.40638791 10.13749434 37.74813323 91.0505536 ]
E1 = -3.879609090734024  E_coul = 1.0288261298931538
cycle= 1 E= -2.85078296084087  delta_E= -3.55e-15  |g|= 3.93e-10  |ddm|= 2.8e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.879609090734024  E_coul = 1.0288261298931538
  HOMO = -0.910978415473848  LUMO = 1.40638790694131
  mo_energy =
[-0.91097842  1.40638791 10.13749434 37.74813323 91.0505536 ]
E1 = -3.879609090767801  E_coul = 1.0288261299269341
Extra cycle  E= -2.85078296084087  delta_E= 3.55e-15  |g|= 3.65e-11  |ddm|= 1.55e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [17.19171953 13.86475755 10.69581222  1.50863226  0.33457808]
grad_E = [-1.13570574e-04 -5.17753815e-05  5.88834544e-05  1.90123454e-03
  5.64005477e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:19 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  18.5883340584        1
[INPUT] 0    0    [1    /1   ]  14.260896013         1
[INPUT] 0    0    [1    /1   ]  9.62282182749        1
[INPUT] 0    0    [1    /1   ]  1.54200667892        1
[INPUT] 0    0    [1    /1   ]  0.342249145355       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [18.58833405837459, 1.0]], [0, [14.260896013033662, 1.0]], [0, [9.622821827488997, 1.0]], [0, [1.542006678917901, 1.0]], [0, [0.342249145354567, 1.0]]]}
ecp = {}
CPU time:        90.37
Set gradient conv threshold to 3.16228e-05
cond(S) = 6256.05900145777
E1 = -3.8714051790540083  E_coul = 1.0241042575966495
init E= -2.84730092145736
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913376390778136  LUMO = 1.44466286484246
  mo_energy =
[-0.91337639  1.44466286 10.12620864 37.46113174 91.70888925]
E1 = -3.880752298425142  E_coul = 1.0298723091242459
cycle= 1 E= -2.8508799893009  delta_E= -0.00358  |g|= 0.00659  |ddm|= 0.256
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.910504823328108  LUMO = 1.44822036012443
  mo_energy =
[-0.91050482  1.44822036 10.13292977 37.46796616 91.71509437]
E1 = -3.880926304638411  E_coul = 1.0300441861660392
cycle= 2 E= -2.85088211847237  delta_E= -2.13e-06  |g|= 0.00048  |ddm|= 0.00985
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910412250049822  LUMO = 1.44830781666625
  mo_energy =
[-0.91041225  1.44830782 10.13315962 37.4681278  91.71516204]
E1 = -3.880963515416669  E_coul = 1.0300813802962252
cycle= 3 E= -2.85088213512044  delta_E= -1.66e-08  |g|= 1.14e-05  |ddm|= 0.00067
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.910399212013566  LUMO = 1.4483166722051
  mo_energy =
[-0.91039921  1.44831667 10.13319366 37.4681754  91.71521821]
E1 = -3.880965817340529  E_coul = 1.030083682201369
cycle= 4 E= -2.85088213513916  delta_E= -1.87e-11  |g|= 1.66e-07  |ddm|= 1.1e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.880965817340529  E_coul = 1.030083682201369
  HOMO = -0.910399226468901  LUMO = 1.44831666725783
  mo_energy =
[-0.91039923  1.44831667 10.13319362 37.46817534 91.71521813]
E1 = -3.8809658158992115  E_coul = 1.0300836807600493
Extra cycle  E= -2.85088213513916  delta_E= -2.66e-15  |g|= 2.95e-09  |ddm|= 1.67e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [18.58833406 14.26089601  9.62282183  1.54200668  0.34224915]
E = -2.8508821351391624
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:20 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  18.5883340584        1
[INPUT] 0    0    [1    /1   ]  14.260896013         1
[INPUT] 0    0    [1    /1   ]  9.62282182749        1
[INPUT] 0    0    [1    /1   ]  1.54200667892        1
[INPUT] 0    0    [1    /1   ]  0.342249145355       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [18.58833405837459, 1.0]], [0, [14.260896013033662, 1.0]], [0, [9.622821827488997, 1.0]], [0, [1.542006678917901, 1.0]], [0, [0.342249145354567, 1.0]]]}
ecp = {}
CPU time:        90.96
Set gradient conv threshold to 3.16228e-05
cond(S) = 6256.05900145777
E1 = -3.8714051790540083  E_coul = 1.0241042575966495
init E= -2.84730092145736
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913376390778136  LUMO = 1.44466286484246
  mo_energy =
[-0.91337639  1.44466286 10.12620864 37.46113174 91.70888925]
E1 = -3.880752298425142  E_coul = 1.0298723091242459
cycle= 1 E= -2.8508799893009  delta_E= -0.00358  |g|= 0.00659  |ddm|= 0.256
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.910504823328108  LUMO = 1.44822036012443
  mo_energy =
[-0.91050482  1.44822036 10.13292977 37.46796616 91.71509437]
E1 = -3.880926304638411  E_coul = 1.0300441861660392
cycle= 2 E= -2.85088211847237  delta_E= -2.13e-06  |g|= 0.00048  |ddm|= 0.00985
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910412250049822  LUMO = 1.44830781666625
  mo_energy =
[-0.91041225  1.44830782 10.13315962 37.4681278  91.71516204]
E1 = -3.880963515416669  E_coul = 1.0300813802962252
cycle= 3 E= -2.85088213512044  delta_E= -1.66e-08  |g|= 1.14e-05  |ddm|= 0.00067
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.910399212013566  LUMO = 1.4483166722051
  mo_energy =
[-0.91039921  1.44831667 10.13319366 37.4681754  91.71521821]
E1 = -3.880965817340529  E_coul = 1.030083682201369
cycle= 4 E= -2.85088213513916  delta_E= -1.87e-11  |g|= 1.66e-07  |ddm|= 1.1e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.880965817340529  E_coul = 1.030083682201369
  HOMO = -0.910399226468901  LUMO = 1.44831666725783
  mo_energy =
[-0.91039923  1.44831667 10.13319362 37.46817534 91.71521813]
E1 = -3.8809658158992115  E_coul = 1.0300836807600493
Extra cycle  E= -2.85088213513916  delta_E= -2.66e-15  |g|= 2.95e-09  |ddm|= 1.67e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 6256.05900145777
E1 = -3.8809658158992115  E_coul = 1.0300836807600493
init E= -2.85088213513916
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.910399227189571  LUMO = 1.44831666689913
  mo_energy =
[-0.91039923  1.44831667 10.13319362 37.46817534 91.71521813]
E1 = -3.8809658158283136  E_coul = 1.030083680689152
cycle= 1 E= -2.85088213513916  delta_E= 8.88e-16  |g|= 8.25e-11  |ddm|= 3.92e-09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8809658158283136  E_coul = 1.030083680689152
  HOMO = -0.910399227225013  LUMO = 1.44831666688018
  mo_energy =
[-0.91039923  1.44831667 10.13319362 37.46817534 91.71521813]
E1 = -3.8809658158252773  E_coul = 1.0300836806861144
Extra cycle  E= -2.85088213513916  delta_E= -1.33e-15  |g|= 3.68e-12  |ddm|= 1.24e-10
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [18.58833406 14.26089601  9.62282183  1.54200668  0.34224915]
grad_E = [-1.59235095e-04 -1.04049648e-04 -2.86797987e-06  4.17408024e-03
  9.47485590e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:22 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  20.5198040066        1
[INPUT] 0    0    [1    /1   ]  14.8248630613        1
[INPUT] 0    0    [1    /1   ]  8.18240501341        1
[INPUT] 0    0    [1    /1   ]  1.56521911695        1
[INPUT] 0    0    [1    /1   ]  0.348642073386       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [20.51980400662376, 1.0]], [0, [14.824863061290904, 1.0]], [0, [8.18240501341465, 1.0]], [0, [1.5652191169450425, 1.0]], [0, [0.34864207338603465, 1.0]]]}
ecp = {}
CPU time:        93.21
Set gradient conv threshold to 3.16228e-05
cond(S) = 1917.0071041639858
E1 = -3.871535035477862  E_coul = 1.0242348748884142
init E= -2.84730016058945
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913376146586078  LUMO = 1.47540093923695
  mo_energy =
[-0.91337615  1.47540094  9.90327771 36.52245409 92.20137573]
E1 = -3.881847971231648  E_coul = 1.0308454352611087
cycle= 1 E= -2.85100253597054  delta_E= -0.0037  |g|= 0.0058  |ddm|= 0.0773
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.910079371885905  LUMO = 1.47934913355009
  mo_energy =
[-0.91007937  1.47934913  9.91101881 36.53087026 92.20953205]
E1 = -3.8820029566716805  E_coul = 1.0309986387013483
cycle= 2 E= -2.85100431797033  delta_E= -1.78e-06  |g|= 0.000445  |ddm|= 0.00371
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.909997131796547  LUMO = 1.47942834484391
  mo_energy =
[-0.90999713  1.47942834  9.9112226  36.53100568 92.2095705 ]
E1 = -3.882036386823868  E_coul = 1.0310320545567422
cycle= 3 E= -2.85100433226713  delta_E= -1.43e-08  |g|= 1.13e-05  |ddm|= 0.00031
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.909985039475949  LUMO = 1.47943676799822
  mo_energy =
[-0.90998504  1.47943677  9.9112535  36.53104907 92.20962183]
E1 = -3.8820385814058627  E_coul = 1.031034249120331
cycle= 4 E= -2.85100433228553  delta_E= -1.84e-11  |g|= 1.15e-07  |ddm|= 9.33e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8820385814058627  E_coul = 1.031034249120331
  HOMO = -0.909985041582625  LUMO = 1.47943676540279
  mo_energy =
[-0.90998504  1.47943677  9.91125349 36.53104909 92.20962185]
E1 = -3.8820385789251572  E_coul = 1.0310342466396243
Extra cycle  E= -2.85100433228553  delta_E= -1.33e-15  |g|= 4.71e-09  |ddm|= 2.12e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [20.51980401 14.82486306  8.18240501  1.56521912  0.34864207]
E = -2.851004332285533
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:23 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  20.5198040066        1
[INPUT] 0    0    [1    /1   ]  14.8248630613        1
[INPUT] 0    0    [1    /1   ]  8.18240501341        1
[INPUT] 0    0    [1    /1   ]  1.56521911695        1
[INPUT] 0    0    [1    /1   ]  0.348642073386       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [20.51980400662376, 1.0]], [0, [14.824863061290904, 1.0]], [0, [8.18240501341465, 1.0]], [0, [1.5652191169450425, 1.0]], [0, [0.34864207338603465, 1.0]]]}
ecp = {}
CPU time:        93.81
Set gradient conv threshold to 3.16228e-05
cond(S) = 1917.0071041639858
E1 = -3.871535035477862  E_coul = 1.0242348748884142
init E= -2.84730016058945
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913376146586078  LUMO = 1.47540093923695
  mo_energy =
[-0.91337615  1.47540094  9.90327771 36.52245409 92.20137573]
E1 = -3.881847971231648  E_coul = 1.0308454352611087
cycle= 1 E= -2.85100253597054  delta_E= -0.0037  |g|= 0.0058  |ddm|= 0.0773
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.910079371885905  LUMO = 1.47934913355009
  mo_energy =
[-0.91007937  1.47934913  9.91101881 36.53087026 92.20953205]
E1 = -3.8820029566716805  E_coul = 1.0309986387013483
cycle= 2 E= -2.85100431797033  delta_E= -1.78e-06  |g|= 0.000445  |ddm|= 0.00371
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.909997131796547  LUMO = 1.47942834484391
  mo_energy =
[-0.90999713  1.47942834  9.9112226  36.53100568 92.2095705 ]
E1 = -3.882036386823868  E_coul = 1.0310320545567422
cycle= 3 E= -2.85100433226713  delta_E= -1.43e-08  |g|= 1.13e-05  |ddm|= 0.00031
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.909985039475949  LUMO = 1.47943676799822
  mo_energy =
[-0.90998504  1.47943677  9.9112535  36.53104907 92.20962183]
E1 = -3.8820385814058627  E_coul = 1.031034249120331
cycle= 4 E= -2.85100433228553  delta_E= -1.84e-11  |g|= 1.15e-07  |ddm|= 9.33e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8820385814058627  E_coul = 1.031034249120331
  HOMO = -0.909985041582625  LUMO = 1.47943676540279
  mo_energy =
[-0.90998504  1.47943677  9.91125349 36.53104909 92.20962185]
E1 = -3.8820385789251572  E_coul = 1.0310342466396243
Extra cycle  E= -2.85100433228553  delta_E= -1.33e-15  |g|= 4.71e-09  |ddm|= 2.12e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 1917.0071041639858
E1 = -3.8820385789251572  E_coul = 1.0310342466396243
init E= -2.85100433228553
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.909985042822941  LUMO = 1.47943676437901
  mo_energy =
[-0.90998504  1.47943676  9.91125349 36.53104908 92.20962185]
E1 = -3.8820385785523404  E_coul = 1.0310342462668087
cycle= 1 E= -2.85100433228553  delta_E= 1.33e-15  |g|= 4.14e-10  |ddm|= 2.64e-09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8820385785523404  E_coul = 1.0310342462668087
  HOMO = -0.909985043009367  LUMO = 1.4794367642364
  mo_energy =
[-0.90998504  1.47943676  9.91125349 36.53104908 92.20962185]
E1 = -3.8820385785076392  E_coul = 1.0310342462221072
Extra cycle  E= -2.85100433228553  delta_E= -4.44e-16  |g|= 4.09e-11  |ddm|= 2.79e-10
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [20.51980401 14.82486306  8.18240501  1.56521912  0.34864207]
grad_E = [-0.00020125 -0.00014463 -0.00017291  0.00737175  0.01010383]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:25 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  21.8835304261        1
[INPUT] 0    0    [1    /1   ]  15.3953938404        1
[INPUT] 0    0    [1    /1   ]  7.62488118831        1
[INPUT] 0    0    [1    /1   ]  1.55633741982        1
[INPUT] 0    0    [1    /1   ]  0.347928525917       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [21.883530426139217, 1.0]], [0, [15.395393840412403, 1.0]], [0, [7.6248811883147605, 1.0]], [0, [1.556337419817766, 1.0]], [0, [0.3479285259168414, 1.0]]]}
ecp = {}
CPU time:        96.06
Set gradient conv threshold to 3.16228e-05
cond(S) = 1191.05244971354
E1 = -3.8719457312723713  E_coul = 1.024238844611157
init E= -2.84770688666121
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913533386017609  LUMO = 1.46794222343124
  mo_energy =
[-0.91353339  1.46794222  9.76050389 36.36265564 93.92699557]
E1 = -3.8821209612530003  E_coul = 1.030801959896681
cycle= 1 E= -2.85131900135632  delta_E= -0.00361  |g|= 0.0055  |ddm|= 0.0521
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.910259282402967  LUMO = 1.47182661968289
  mo_energy =
[-0.91025928  1.47182662  9.76817836 36.3710726  93.93519999]
E1 = -3.8822708954481566  E_coul = 1.0309502402012014
cycle= 2 E= -2.85132065524696  delta_E= -1.65e-06  |g|= 0.000431  |ddm|= 0.00279
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910179729093712  LUMO = 1.47190284526855
  mo_energy =
[-0.91017973  1.47190285  9.7683754  36.37120033 93.93523002]
E1 = -3.882303452528837  E_coul = 1.03098278370523
cycle= 3 E= -2.85132066882361  delta_E= -1.36e-08  |g|= 1.14e-05  |ddm|= 0.000258
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.91016785202419  LUMO = 1.47191110772904
  mo_energy =
[-0.91016785  1.47191111  9.7684055  36.37124288 93.93528037]
E1 = -3.8823056354163477  E_coul = 1.0309849665741375
cycle= 4 E= -2.85132066884221  delta_E= -1.86e-11  |g|= 1.12e-07  |ddm|= 9.03e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8823056354163477  E_coul = 1.0309849665741375
  HOMO = -0.910167851134029  LUMO = 1.47191110550018
  mo_energy =
[-0.91016785  1.47191111  9.76840551 36.37124291 93.93528042]
E1 = -3.882305632559359  E_coul = 1.0309849637171493
Extra cycle  E= -2.85132066884221  delta_E= 8.88e-16  |g|= 6.12e-09  |ddm|= 2.94e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [21.88353043 15.39539384  7.62488119  1.55633742  0.34792853]
E = -2.8513206688422095
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:26 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  21.8835304261        1
[INPUT] 0    0    [1    /1   ]  15.3953938404        1
[INPUT] 0    0    [1    /1   ]  7.62488118831        1
[INPUT] 0    0    [1    /1   ]  1.55633741982        1
[INPUT] 0    0    [1    /1   ]  0.347928525917       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [21.883530426139217, 1.0]], [0, [15.395393840412403, 1.0]], [0, [7.6248811883147605, 1.0]], [0, [1.556337419817766, 1.0]], [0, [0.3479285259168414, 1.0]]]}
ecp = {}
CPU time:        96.67
Set gradient conv threshold to 3.16228e-05
cond(S) = 1191.05244971354
E1 = -3.8719457312723713  E_coul = 1.024238844611157
init E= -2.84770688666121
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.913533386017609  LUMO = 1.46794222343124
  mo_energy =
[-0.91353339  1.46794222  9.76050389 36.36265564 93.92699557]
E1 = -3.8821209612530003  E_coul = 1.030801959896681
cycle= 1 E= -2.85131900135632  delta_E= -0.00361  |g|= 0.0055  |ddm|= 0.0521
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.910259282402967  LUMO = 1.47182661968289
  mo_energy =
[-0.91025928  1.47182662  9.76817836 36.3710726  93.93519999]
E1 = -3.8822708954481566  E_coul = 1.0309502402012014
cycle= 2 E= -2.85132065524696  delta_E= -1.65e-06  |g|= 0.000431  |ddm|= 0.00279
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.910179729093712  LUMO = 1.47190284526855
  mo_energy =
[-0.91017973  1.47190285  9.7683754  36.37120033 93.93523002]
E1 = -3.882303452528837  E_coul = 1.03098278370523
cycle= 3 E= -2.85132066882361  delta_E= -1.36e-08  |g|= 1.14e-05  |ddm|= 0.000258
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.91016785202419  LUMO = 1.47191110772904
  mo_energy =
[-0.91016785  1.47191111  9.7684055  36.37124288 93.93528037]
E1 = -3.8823056354163477  E_coul = 1.0309849665741375
cycle= 4 E= -2.85132066884221  delta_E= -1.86e-11  |g|= 1.12e-07  |ddm|= 9.03e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8823056354163477  E_coul = 1.0309849665741375
  HOMO = -0.910167851134029  LUMO = 1.47191110550018
  mo_energy =
[-0.91016785  1.47191111  9.76840551 36.37124291 93.93528042]
E1 = -3.882305632559359  E_coul = 1.0309849637171493
Extra cycle  E= -2.85132066884221  delta_E= 8.88e-16  |g|= 6.12e-09  |ddm|= 2.94e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 1191.05244971354
E1 = -3.882305632559359  E_coul = 1.0309849637171493
init E= -2.85132066884221
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.910167852562533  LUMO = 1.47191110426403
  mo_energy =
[-0.91016785  1.4719111   9.76840551 36.37124291 93.93528042]
E1 = -3.882305632090748  E_coul = 1.030984963248538
cycle= 1 E= -2.85132066884221  delta_E= -4.44e-16  |g|= 5.53e-10  |ddm|= 3.31e-09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.882305632090748  E_coul = 1.030984963248538
  HOMO = -0.910167852796831  LUMO = 1.47191110408338
  mo_energy =
[-0.91016785  1.4719111   9.7684055  36.37124291 93.93528041]
E1 = -3.882305632032828  E_coul = 1.0309849631906172
Extra cycle  E= -2.85132066884221  delta_E= -8.88e-16  |g|= 5.47e-11  |ddm|= 3.38e-10
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [21.88353043 15.39539384  7.62488119  1.55633742  0.34792853]
grad_E = [-0.0001966  -0.00013177 -0.00022516  0.00803979  0.00874249]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:28 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  26.8890755583        1
[INPUT] 0    0    [1    /1   ]  17.7372195491        1
[INPUT] 0    0    [1    /1   ]  6.24180425021        1
[INPUT] 0    0    [1    /1   ]  1.39194066802        1
[INPUT] 0    0    [1    /1   ]  0.323084098566       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [26.889075558335, 1.0]], [0, [17.73721954906386, 1.0]], [0, [6.241804250214773, 1.0]], [0, [1.3919406680163928, 1.0]], [0, [0.3230840985658497, 1.0]]]}
ecp = {}
CPU time:        98.94
Set gradient conv threshold to 3.16228e-05
cond(S) = 393.4848585342797
E1 = -3.8749775501457244  E_coul = 1.0239949109028654
init E= -2.85098263924286
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.914709552342664  LUMO = 1.30447785624335
  mo_energy =
[ -0.91470955   1.30447786   8.80232756  35.75704272 101.70166397]
E1 = -3.8817350242241577  E_coul = 1.0283069569256447
cycle= 1 E= -2.85342806729851  delta_E= -0.00245  |g|= 0.00494  |ddm|= 0.0293
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.912561268986214  LUMO = 1.30697599338438
  mo_energy =
[ -0.91256127   1.30697599   8.80727619  35.76187517 101.70574886]
E1 = -3.8819191264624564  E_coul = 1.0284894947268677
cycle= 2 E= -2.85342963173559  delta_E= -1.56e-06  |g|= 0.000428  |ddm|= 0.00208
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.912462710698775  LUMO = 1.30705801390581
  mo_energy =
[ -0.91246271   1.30705801   8.80751797  35.76206037 101.70584705]
E1 = -3.8819581671087455  E_coul = 1.028528519395192
cycle= 3 E= -2.85342964771355  delta_E= -1.6e-08  |g|= 1.31e-05  |ddm|= 0.000241
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.912449238553668  LUMO = 1.30706651454816
  mo_energy =
[ -0.91244924   1.30706651   8.80755085  35.76210882 101.70590435]
E1 = -3.8819608052273598  E_coul = 1.0285311574871978
cycle= 4 E= -2.85342964774016  delta_E= -2.66e-11  |g|= 1.41e-07  |ddm|= 1.05e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8819608052273598  E_coul = 1.0285311574871978
  HOMO = -0.912449245126482  LUMO = 1.3070665053619
  mo_energy =
[ -0.91244925   1.30706651   8.80755083  35.76210885 101.70590441]
E1 = -3.881960798286041  E_coul = 1.0285311505458803
Extra cycle  E= -2.85342964774016  delta_E= 1.33e-15  |g|= 1.11e-08  |ddm|= 5.3e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [26.88907556 17.73721955  6.24180425  1.39194067  0.3230841 ]
E = -2.853429647740161
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:28 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  26.8890755583        1
[INPUT] 0    0    [1    /1   ]  17.7372195491        1
[INPUT] 0    0    [1    /1   ]  6.24180425021        1
[INPUT] 0    0    [1    /1   ]  1.39194066802        1
[INPUT] 0    0    [1    /1   ]  0.323084098566       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [26.889075558335, 1.0]], [0, [17.73721954906386, 1.0]], [0, [6.241804250214773, 1.0]], [0, [1.3919406680163928, 1.0]], [0, [0.3230840985658497, 1.0]]]}
ecp = {}
CPU time:        99.55
Set gradient conv threshold to 3.16228e-05
cond(S) = 393.4848585342797
E1 = -3.8749775501457244  E_coul = 1.0239949109028654
init E= -2.85098263924286
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.914709552342664  LUMO = 1.30447785624335
  mo_energy =
[ -0.91470955   1.30447786   8.80232756  35.75704272 101.70166397]
E1 = -3.8817350242241577  E_coul = 1.0283069569256447
cycle= 1 E= -2.85342806729851  delta_E= -0.00245  |g|= 0.00494  |ddm|= 0.0293
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.912561268986214  LUMO = 1.30697599338438
  mo_energy =
[ -0.91256127   1.30697599   8.80727619  35.76187517 101.70574886]
E1 = -3.8819191264624564  E_coul = 1.0284894947268677
cycle= 2 E= -2.85342963173559  delta_E= -1.56e-06  |g|= 0.000428  |ddm|= 0.00208
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.912462710698775  LUMO = 1.30705801390581
  mo_energy =
[ -0.91246271   1.30705801   8.80751797  35.76206037 101.70584705]
E1 = -3.8819581671087455  E_coul = 1.028528519395192
cycle= 3 E= -2.85342964771355  delta_E= -1.6e-08  |g|= 1.31e-05  |ddm|= 0.000241
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.912449238553668  LUMO = 1.30706651454816
  mo_energy =
[ -0.91244924   1.30706651   8.80755085  35.76210882 101.70590435]
E1 = -3.8819608052273598  E_coul = 1.0285311574871978
cycle= 4 E= -2.85342964774016  delta_E= -2.66e-11  |g|= 1.41e-07  |ddm|= 1.05e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8819608052273598  E_coul = 1.0285311574871978
  HOMO = -0.912449245126482  LUMO = 1.3070665053619
  mo_energy =
[ -0.91244925   1.30706651   8.80755083  35.76210885 101.70590441]
E1 = -3.881960798286041  E_coul = 1.0285311505458803
Extra cycle  E= -2.85342964774016  delta_E= 1.33e-15  |g|= 1.11e-08  |ddm|= 5.3e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 393.4848585342797
E1 = -3.881960798286041  E_coul = 1.0285311505458803
init E= -2.85342964774016
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.912449248597157  LUMO = 1.3070665027646
  mo_energy =
[ -0.91244925   1.3070665    8.80755082  35.76210884 101.7059044 ]
E1 = -3.881960797205751  E_coul = 1.0285311494655889
cycle= 1 E= -2.85342964774016  delta_E= -1.33e-15  |g|= 1.14e-09  |ddm|= 6.04e-09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.881960797205751  E_coul = 1.0285311494655889
  HOMO = -0.912449249137283  LUMO = 1.3070665023913
  mo_energy =
[ -0.91244925   1.3070665    8.80755082  35.76210884 101.7059044 ]
E1 = -3.8819607970680483  E_coul = 1.0285311493278853
Extra cycle  E= -2.85342964774016  delta_E= -8.88e-16  |g|= 1.25e-10  |ddm|= 6.81e-10
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [26.88907556 17.73721955  6.24180425  1.39194067  0.3230841 ]
grad_E = [-1.49083928e-04 -5.79282390e-05 -8.17726773e-05  5.97909910e-03
  5.26655620e-04]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:31 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  41.3589607457        1
[INPUT] 0    0    [1    /1   ]  23.6639441407        1
[INPUT] 0    0    [1    /1   ]  1.00000000103e-06      1
[INPUT] 0    0    [1    /1   ]  0.91678849922        1
[INPUT] 0    0    [1    /1   ]  0.262595303601       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [41.35896074565193, 1.0]], [0, [23.663944140714623, 1.0]], [0, [1.0000000010279564e-06, 1.0]], [0, [0.9167884992203927, 1.0]], [0, [0.2625953036005017, 1.0]]]}
ecp = {}
CPU time:       101.82
Set gradient conv threshold to 3.16228e-05
cond(S) = 41.64623209859972
E1 = -3.1098077426925816  E_coul = 0.9615162598907814
init E= -2.1482914828018
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.830522350220461  LUMO = -3.45105268866299e-05
  mo_energy =
[-8.30522350e-01 -3.45105269e-05  8.85898162e-01  2.10761613e+01
  1.13506117e+02]
E1 = -3.5736965125834397  E_coul = 0.9412700194105433
cycle= 1 E= -2.6324264931729  delta_E= -0.484  |g|= 0.133  |ddm|= 0.575
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.845745379663156  LUMO = 1.50851368798207e-06
  mo_energy =
[-8.45745380e-01  1.50851369e-06  8.90984526e-01  2.09737183e+01
  1.13294208e+02]
E1 = -3.5757116919842686  E_coul = 0.9429325919050557
cycle= 2 E= -2.63277910007921  delta_E= -0.000353  |g|= 0.00525  |ddm|= 0.0207
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.84488106106655  LUMO = 1.50850638578532e-06
  mo_energy =
[-8.44881061e-01  1.50850639e-06  8.91435667e-01  2.09753341e+01
  1.13292929e+02]
E1 = -3.5762276990988284  E_coul = 0.9434465399963909
cycle= 3 E= -2.63278115910244  delta_E= -2.06e-06  |g|= 0.000287  |ddm|= 0.00308
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.844648362992428  LUMO = 1.50850586874499e-06
  mo_energy =
[-8.44648363e-01  1.50850587e-06  8.91538175e-01  2.09762899e+01
  1.13294106e+02]
E1 = -3.5763044841172027  E_coul = 0.9435232974317633
cycle= 4 E= -2.63278118668544  delta_E= -2.76e-08  |g|= 3.05e-05  |ddm|= 0.000407
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.84462479137816  LUMO = 1.5085058039968e-06
  mo_energy =
[-8.44624791e-01  1.50850580e-06  8.91548750e-01  2.09763827e+01
  1.13294215e+02]
E1 = -3.5763127928194276  E_coul = 0.9435316058612357
cycle= 5 E= -2.63278118695819  delta_E= -2.73e-10  |g|= 8.58e-10  |ddm|= 4.47e-05
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.5763127928194276  E_coul = 0.9435316058612357
  HOMO = -0.844624790548477  LUMO = 1.50850580393906e-06
  mo_energy =
[-8.44624791e-01  1.50850580e-06  8.91548749e-01  2.09763827e+01
  1.13294215e+02]
E1 = -3.576312792698035  E_coul = 0.9435316057398445
Extra cycle  E= -2.63278118695819  delta_E= 1.33e-15  |g|= 7.73e-11  |ddm|= 5.96e-10
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [4.13589607e+01 2.36639441e+01 1.00000000e-06 9.16788499e-01
 2.62595304e-01]
E = -2.6327811869581903
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:31 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  28.3360640771        1
[INPUT] 0    0    [1    /1   ]  18.3298920082        1
[INPUT] 0    0    [1    /1   ]  5.61762392519        1
[INPUT] 0    0    [1    /1   ]  1.34442545114        1
[INPUT] 0    0    [1    /1   ]  0.317035219069       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [28.336064077066695, 1.0]], [0, [18.329892008228935, 1.0]], [0, [5.617623925193295, 1.0]], [0, [1.3444254511367928, 1.0]], [0, [0.31703521906931487, 1.0]]]}
ecp = {}
CPU time:       102.46
Set gradient conv threshold to 3.16228e-05
cond(S) = 291.5843999873818
E1 = -3.875687925902375  E_coul = 1.0239809172785785
init E= -2.8517070086238
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91491583184518  LUMO = 1.26108982522209
  mo_energy =
[ -0.91491583   1.26108983   8.31548982  34.79553593 102.90050851]
E1 = -3.88143507301397  E_coul = 1.02761363221827
cycle= 1 E= -2.8538214407957  delta_E= -0.00211  |g|= 0.00408  |ddm|= 0.0161
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.913104387421161  LUMO = 1.26317010966254
  mo_energy =
[ -0.91310439   1.26317011   8.31964467  34.79945616 102.90356954]
E1 = -3.8815764924596836  E_coul = 1.0277539905130464
cycle= 2 E= -2.85382250194664  delta_E= -1.06e-06  |g|= 0.000357  |ddm|= 0.00157
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.913029065237021  LUMO = 1.26323202101308
  mo_energy =
[ -0.91302907   1.26323202   8.31982899  34.79957829 102.90360203]
E1 = -3.881608979689475  E_coul = 1.0277864662997889
cycle= 3 E= -2.85382251338969  delta_E= -1.14e-08  |g|= 1.36e-05  |ddm|= 0.0002
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.913016763070453  LUMO = 1.26323971524487
  mo_energy =
[ -0.91301676   1.26323972   8.31985811  34.7996213  102.90365258]
E1 = -3.881611554455586  E_coul = 1.0277890410376913
cycle= 4 E= -2.85382251341789  delta_E= -2.82e-11  |g|= 1.43e-07  |ddm|= 1.1e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.881611554455586  E_coul = 1.0277890410376913
  HOMO = -0.91301673619011  LUMO = 1.2632397225935
  mo_energy =
[ -0.91301674   1.26323972   8.31985818  34.79962147 102.90365281]
E1 = -3.8816115521036  E_coul = 1.0277890386857031
Extra cycle  E= -2.8538225134179  delta_E= -2.22e-15  |g|= 1.1e-08  |ddm|= 5.43e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [28.33606408 18.32989201  5.61762393  1.34442545  0.31703522]
E = -2.8538225134178967
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:32 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  28.3360640771        1
[INPUT] 0    0    [1    /1   ]  18.3298920082        1
[INPUT] 0    0    [1    /1   ]  5.61762392519        1
[INPUT] 0    0    [1    /1   ]  1.34442545114        1
[INPUT] 0    0    [1    /1   ]  0.317035219069       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [28.336064077066695, 1.0]], [0, [18.329892008228935, 1.0]], [0, [5.617623925193295, 1.0]], [0, [1.3444254511367928, 1.0]], [0, [0.31703521906931487, 1.0]]]}
ecp = {}
CPU time:       103.08
Set gradient conv threshold to 3.16228e-05
cond(S) = 291.5843999873818
E1 = -3.875687925902375  E_coul = 1.0239809172785785
init E= -2.8517070086238
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91491583184518  LUMO = 1.26108982522209
  mo_energy =
[ -0.91491583   1.26108983   8.31548982  34.79553593 102.90050851]
E1 = -3.88143507301397  E_coul = 1.02761363221827
cycle= 1 E= -2.8538214407957  delta_E= -0.00211  |g|= 0.00408  |ddm|= 0.0161
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.913104387421161  LUMO = 1.26317010966254
  mo_energy =
[ -0.91310439   1.26317011   8.31964467  34.79945616 102.90356954]
E1 = -3.8815764924596836  E_coul = 1.0277539905130464
cycle= 2 E= -2.85382250194664  delta_E= -1.06e-06  |g|= 0.000357  |ddm|= 0.00157
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.913029065237021  LUMO = 1.26323202101308
  mo_energy =
[ -0.91302907   1.26323202   8.31982899  34.79957829 102.90360203]
E1 = -3.881608979689475  E_coul = 1.0277864662997889
cycle= 3 E= -2.85382251338969  delta_E= -1.14e-08  |g|= 1.36e-05  |ddm|= 0.0002
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.913016763070453  LUMO = 1.26323971524487
  mo_energy =
[ -0.91301676   1.26323972   8.31985811  34.7996213  102.90365258]
E1 = -3.881611554455586  E_coul = 1.0277890410376913
cycle= 4 E= -2.85382251341789  delta_E= -2.82e-11  |g|= 1.43e-07  |ddm|= 1.1e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.881611554455586  E_coul = 1.0277890410376913
  HOMO = -0.91301673619011  LUMO = 1.2632397225935
  mo_energy =
[ -0.91301674   1.26323972   8.31985818  34.79962147 102.90365281]
E1 = -3.8816115521036  E_coul = 1.0277890386857031
Extra cycle  E= -2.8538225134179  delta_E= -2.22e-15  |g|= 1.1e-08  |ddm|= 5.43e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 291.5843999873818
E1 = -3.8816115521036  E_coul = 1.0277890386857031
init E= -2.8538225134179
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.913016737366104  LUMO = 1.26323972130394
  mo_energy =
[ -0.91301674   1.26323972   8.31985818  34.79962147 102.90365281]
E1 = -3.8816115513472726  E_coul = 1.027789037929375
cycle= 1 E= -2.8538225134179  delta_E= -8.88e-16  |g|= 1.08e-09  |ddm|= 5.57e-09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8816115513472726  E_coul = 1.027789037929375
  HOMO = -0.913016737744258  LUMO = 1.26323972103278
  mo_energy =
[ -0.91301674   1.26323972   8.31985817  34.79962147 102.90365281]
E1 = -3.8816115512331657  E_coul = 1.027789037815269
Extra cycle  E= -2.8538225134179  delta_E= 8.88e-16  |g|= 1.18e-10  |ddm|= 6.3e-10
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [28.33606408 18.32989201  5.61762393  1.34442545  0.31703522]
grad_E = [-1.52691545e-04 -2.85726452e-05 -5.57736385e-04  8.59828941e-03
 -5.83703966e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:34 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  46.5784627902        1
[INPUT] 0    0    [1    /1   ]  27.7544916226        1
[INPUT] 0    0    [1    /1   ]  2.95086342427        1
[INPUT] 0    0    [1    /1   ]  0.626493753405       1
[INPUT] 0    0    [1    /1   ]  0.212810163133       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [46.57846279024166, 1.0]], [0, [27.754491622584453, 1.0]], [0, [2.950863424274929, 1.0]], [0, [0.6264937534049545, 1.0]], [0, [0.21281016313282775, 1.0]]]}
ecp = {}
CPU time:       105.36
Set gradient conv threshold to 3.16228e-05
cond(S) = 74.21669464613998
E1 = -3.8616595069284663  E_coul = 1.0219944727339958
init E= -2.83966503419447
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.910785486519379  LUMO = 0.620924913134553
  mo_energy =
[ -0.91078549   0.62092491   4.06070078  33.03483519 139.41090231]
E1 = -3.8630991604908593  E_coul = 1.019392513898971
cycle= 1 E= -2.84370664659189  delta_E= -0.00404  |g|= 0.014  |ddm|= 0.0594
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.912165234518447  LUMO = 0.621398794525235
  mo_energy =
[ -0.91216523   0.62139879   4.06037939  33.01974607 139.38690726]
E1 = -3.8639066398817463  E_coul = 1.020181005612009
cycle= 2 E= -2.84372563426974  delta_E= -1.9e-05  |g|= 0.00159  |ddm|= 0.00982
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911736678596483  LUMO = 0.621581255242905
  mo_energy =
[ -0.91173668   0.62158126   4.06125189  33.02049784 139.38733409]
E1 = -3.8641491669742605  E_coul = 1.0204229689950877
cycle= 3 E= -2.84372619797917  delta_E= -5.64e-07  |g|= 0.000152  |ddm|= 0.00195
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911635050655711  LUMO = 0.621614197940829
  mo_energy =
[ -0.91163505   0.6216142    4.06142976  33.02083047 139.38770849]
E1 = -3.864183778653965  E_coul = 1.02045757424056
cycle= 4 E= -2.84372620441341  delta_E= -6.43e-09  |g|= 1.16e-06  |ddm|= 0.000233
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.911634266762574  LUMO = 0.621614362141044
  mo_energy =
[ -0.91163427   0.62161436   4.06143096  33.020834   139.38771268]
E1 = -3.8641838753504096  E_coul = 1.0204576709369315
cycle= 5 E= -2.84372620441348  delta_E= -7.33e-14  |g|= 8.98e-08  |ddm|= 3.03e-07
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.8641838753504096  E_coul = 1.0204576709369315
  HOMO = -0.911634266738271  LUMO = 0.621614357711801
  mo_energy =
[ -0.91163427   0.62161436   4.06143094  33.02083406 139.38771276]
E1 = -3.8641838667697916  E_coul = 1.020457662356313
Extra cycle  E= -2.84372620441348  delta_E=    0  |g|= 1.42e-08  |ddm|= 9.25e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [46.57846279 27.75449162  2.95086342  0.62649375  0.21281016]
E = -2.8437262044134783
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:35 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  32.111970048         1
[INPUT] 0    0    [1    /1   ]  20.2806443472        1
[INPUT] 0    0    [1    /1   ]  5.06564405364        1
[INPUT] 0    0    [1    /1   ]  1.19582423773        1
[INPUT] 0    0    [1    /1   ]  0.295462178307       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [32.1119700480252, 1.0]], [0, [20.2806443471764, 1.0]], [0, [5.065644053639362, 1.0]], [0, [1.1958242377312218, 1.0]], [0, [0.2954621783074198, 1.0]]]}
ecp = {}
CPU time:       106.00
Set gradient conv threshold to 3.16228e-05
cond(S) = 193.80696137804676
E1 = -3.87723677387487  E_coul = 1.0238055698882156
init E= -2.85343120398665
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.915561885697008  LUMO = 1.12139419932692
  mo_energy =
[ -0.91556189   1.1213942    7.53700465  34.73646636 110.39188633]
E1 = -3.8814741683832885  E_coul = 1.02652907376785
cycle= 1 E= -2.85494509461544  delta_E= -0.00151  |g|= 0.00476  |ddm|= 0.0213
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914208858649255  LUMO = 1.12290810846052
  mo_energy =
[ -0.91420886   1.12290811   7.5401299   34.73854455 110.39264545]
E1 = -3.881743308680821  E_coul = 1.0267963259037691
cycle= 2 E= -2.85494698277705  delta_E= -1.89e-06  |g|= 0.000485  |ddm|= 0.0023
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914063221202321  LUMO = 1.12300862733823
  mo_energy =
[ -0.91406322   1.12300863   7.54047425  34.73886934 110.3928962 ]
E1 = -3.8817987574024593  E_coul = 1.0268517484211916
cycle= 3 E= -2.85494700898127  delta_E= -2.62e-08  |g|= 1.79e-05  |ddm|= 0.000316
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914045705001595  LUMO = 1.1230183475822
  mo_energy =
[ -0.91404571   1.12301835   7.54051426  34.73893175 110.39296964]
E1 = -3.88180255623757  E_coul = 1.0268555472000978
cycle= 4 E= -2.85494700903747  delta_E= -5.62e-11  |g|= 2.18e-07  |ddm|= 1.58e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.88180255623757  E_coul = 1.0268555472000978
  HOMO = -0.914045730918689  LUMO = 1.12301832357036
  mo_energy =
[ -0.91404573   1.12301832   7.5405142   34.73893175 110.39296968]
E1 = -3.881802539552525  E_coul = 1.0268555305150493
Extra cycle  E= -2.85494700903748  delta_E= -3.55e-15  |g|= 2.28e-08  |ddm|= 1.16e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [32.11197005 20.28064435  5.06564405  1.19582424  0.29546218]
E = -2.854947009037476
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:36 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  32.111970048         1
[INPUT] 0    0    [1    /1   ]  20.2806443472        1
[INPUT] 0    0    [1    /1   ]  5.06564405364        1
[INPUT] 0    0    [1    /1   ]  1.19582423773        1
[INPUT] 0    0    [1    /1   ]  0.295462178307       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [32.1119700480252, 1.0]], [0, [20.2806443471764, 1.0]], [0, [5.065644053639362, 1.0]], [0, [1.1958242377312218, 1.0]], [0, [0.2954621783074198, 1.0]]]}
ecp = {}
CPU time:       106.62
Set gradient conv threshold to 3.16228e-05
cond(S) = 193.80696137804676
E1 = -3.87723677387487  E_coul = 1.0238055698882156
init E= -2.85343120398665
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.915561885697008  LUMO = 1.12139419932692
  mo_energy =
[ -0.91556189   1.1213942    7.53700465  34.73646636 110.39188633]
E1 = -3.8814741683832885  E_coul = 1.02652907376785
cycle= 1 E= -2.85494509461544  delta_E= -0.00151  |g|= 0.00476  |ddm|= 0.0213
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914208858649255  LUMO = 1.12290810846052
  mo_energy =
[ -0.91420886   1.12290811   7.5401299   34.73854455 110.39264545]
E1 = -3.881743308680821  E_coul = 1.0267963259037691
cycle= 2 E= -2.85494698277705  delta_E= -1.89e-06  |g|= 0.000485  |ddm|= 0.0023
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914063221202321  LUMO = 1.12300862733823
  mo_energy =
[ -0.91406322   1.12300863   7.54047425  34.73886934 110.3928962 ]
E1 = -3.8817987574024593  E_coul = 1.0268517484211916
cycle= 3 E= -2.85494700898127  delta_E= -2.62e-08  |g|= 1.79e-05  |ddm|= 0.000316
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914045705001595  LUMO = 1.1230183475822
  mo_energy =
[ -0.91404571   1.12301835   7.54051426  34.73893175 110.39296964]
E1 = -3.88180255623757  E_coul = 1.0268555472000978
cycle= 4 E= -2.85494700903747  delta_E= -5.62e-11  |g|= 2.18e-07  |ddm|= 1.58e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.88180255623757  E_coul = 1.0268555472000978
  HOMO = -0.914045730918689  LUMO = 1.12301832357036
  mo_energy =
[ -0.91404573   1.12301832   7.5405142   34.73893175 110.39296968]
E1 = -3.881802539552525  E_coul = 1.0268555305150493
Extra cycle  E= -2.85494700903748  delta_E= -3.55e-15  |g|= 2.28e-08  |ddm|= 1.16e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 193.80696137804676
E1 = -3.881802539552525  E_coul = 1.0268555305150493
init E= -2.85494700903748
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.914045739261218  LUMO = 1.12301831818285
  mo_energy =
[ -0.91404574   1.12301832   7.54051418  34.73893173 110.39296966]
E1 = -3.881802536886795  E_coul = 1.0268555278493174
cycle= 1 E= -2.85494700903748  delta_E= -1.78e-15  |g|= 2.71e-09  |ddm|= 1.44e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.881802536886795  E_coul = 1.0268555278493174
  HOMO = -0.91404574059408  LUMO = 1.12301831737768
  mo_energy =
[ -0.91404574   1.12301832   7.54051418  34.73893172 110.39296966]
E1 = -3.8818025365203863  E_coul = 1.0268555274829083
Extra cycle  E= -2.85494700903748  delta_E= -4.44e-16  |g|= 3.33e-10  |ddm|= 1.81e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [32.11197005 20.28064435  5.06564405  1.19582424  0.29546218]
grad_E = [-1.21507033e-04  2.61268418e-05 -3.63597102e-04  3.69373112e-03
 -1.63636545e-04]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:38 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  38.1063604899        1
[INPUT] 0    0    [1    /1   ]  23.6312514129        1
[INPUT] 0    0    [1    /1   ]  4.86134538253        1
[INPUT] 0    0    [1    /1   ]  1.08857546098        1
[INPUT] 0    0    [1    /1   ]  0.277120900053       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [38.10636048986202, 1.0]], [0, [23.631251412866014, 1.0]], [0, [4.861345382532394, 1.0]], [0, [1.0885754609786598, 1.0]], [0, [0.2771209000528729, 1.0]]]}
ecp = {}
CPU time:       108.92
Set gradient conv threshold to 3.16228e-05
cond(S) = 140.2420637756648
E1 = -3.8777554883250676  E_coul = 1.0235705399527322
init E= -2.85418494837234
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.915919843421647  LUMO = 1.01488679719716
  mo_energy =
[ -0.91591984   1.0148868    7.09037971  36.85104048 125.7619395 ]
E1 = -3.881061261332688  E_coul = 1.0256238497325734
cycle= 1 E= -2.85543741160011  delta_E= -0.00125  |g|= 0.00594  |ddm|= 0.0281
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914908276928762  LUMO = 1.01608370774081
  mo_energy =
[ -0.91490828   1.01608371   7.09279335  36.85124368 125.76037904]
E1 = -3.881463651537314  E_coul = 1.0260228837183263
cycle= 2 E= -2.85544076781899  delta_E= -3.36e-06  |g|= 0.00065  |ddm|= 0.00317
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914687075936853  LUMO = 1.01622169674781
  mo_energy =
[ -0.91468708   1.0162217    7.09330887  36.85176626 125.76083105]
E1 = -3.881548221282707  E_coul = 1.0261073995384864
cycle= 3 E= -2.85544082174422  delta_E= -5.39e-08  |g|= 2.01e-05  |ddm|= 0.000467
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914664170024682  LUMO = 1.01623302242566
  mo_energy =
[ -0.91466417   1.01623302   7.09336039  36.85185214 125.76093193]
E1 = -3.881553128900104  E_coul = 1.0261123070731568
cycle= 4 E= -2.85544082182695  delta_E= -8.27e-11  |g|= 2.22e-07  |ddm|= 1.93e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.881553128900104  E_coul = 1.0261123070731568
  HOMO = -0.914664257376892  LUMO = 1.01623297518562
  mo_energy =
[ -0.91466426   1.01623298   7.09336019  36.8518519  125.76093168]
E1 = -3.881553100876153  E_coul = 1.0261122790492003
Extra cycle  E= -2.85544082182695  delta_E= -5.33e-15  |g|= 2.68e-08  |ddm|= 1.41e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [38.10636049 23.63125141  4.86134538  1.08857546  0.2771209 ]
E = -2.855440821826953
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:38 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  38.1063604899        1
[INPUT] 0    0    [1    /1   ]  23.6312514129        1
[INPUT] 0    0    [1    /1   ]  4.86134538253        1
[INPUT] 0    0    [1    /1   ]  1.08857546098        1
[INPUT] 0    0    [1    /1   ]  0.277120900053       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [38.10636048986202, 1.0]], [0, [23.631251412866014, 1.0]], [0, [4.861345382532394, 1.0]], [0, [1.0885754609786598, 1.0]], [0, [0.2771209000528729, 1.0]]]}
ecp = {}
CPU time:       109.55
Set gradient conv threshold to 3.16228e-05
cond(S) = 140.2420637756648
E1 = -3.8777554883250676  E_coul = 1.0235705399527322
init E= -2.85418494837234
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.915919843421647  LUMO = 1.01488679719716
  mo_energy =
[ -0.91591984   1.0148868    7.09037971  36.85104048 125.7619395 ]
E1 = -3.881061261332688  E_coul = 1.0256238497325734
cycle= 1 E= -2.85543741160011  delta_E= -0.00125  |g|= 0.00594  |ddm|= 0.0281
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914908276928762  LUMO = 1.01608370774081
  mo_energy =
[ -0.91490828   1.01608371   7.09279335  36.85124368 125.76037904]
E1 = -3.881463651537314  E_coul = 1.0260228837183263
cycle= 2 E= -2.85544076781899  delta_E= -3.36e-06  |g|= 0.00065  |ddm|= 0.00317
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914687075936853  LUMO = 1.01622169674781
  mo_energy =
[ -0.91468708   1.0162217    7.09330887  36.85176626 125.76083105]
E1 = -3.881548221282707  E_coul = 1.0261073995384864
cycle= 3 E= -2.85544082174422  delta_E= -5.39e-08  |g|= 2.01e-05  |ddm|= 0.000467
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914664170024682  LUMO = 1.01623302242566
  mo_energy =
[ -0.91466417   1.01623302   7.09336039  36.85185214 125.76093193]
E1 = -3.881553128900104  E_coul = 1.0261123070731568
cycle= 4 E= -2.85544082182695  delta_E= -8.27e-11  |g|= 2.22e-07  |ddm|= 1.93e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.881553128900104  E_coul = 1.0261123070731568
  HOMO = -0.914664257376892  LUMO = 1.01623297518562
  mo_energy =
[ -0.91466426   1.01623298   7.09336019  36.8518519  125.76093168]
E1 = -3.881553100876153  E_coul = 1.0261122790492003
Extra cycle  E= -2.85544082182695  delta_E= -5.33e-15  |g|= 2.68e-08  |ddm|= 1.41e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 140.2420637756648
E1 = -3.881553100876153  E_coul = 1.0261122790492003
init E= -2.85544082182695
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.91466427138888  LUMO = 1.01623296752205
  mo_energy =
[ -0.91466427   1.01623297   7.09336016  36.85185186 125.76093163]
E1 = -3.8815530969040135  E_coul = 1.0261122750770604
cycle= 1 E= -2.85544082182695  delta_E=    0  |g|= 3.53e-09  |ddm|= 1.91e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8815530969040135  E_coul = 1.0261122750770604
  HOMO = -0.91466427337495  LUMO = 1.0162329664487
  mo_energy =
[ -0.91466427   1.01623297   7.09336015  36.85185185 125.76093163]
E1 = -3.881553096360788  E_coul = 1.026112274533832
Extra cycle  E= -2.85544082182696  delta_E= -3.11e-15  |g|= 4.69e-10  |ddm|= 2.56e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [38.10636049 23.63125141  4.86134538  1.08857546  0.2771209 ]
grad_E = [-8.25549367e-05  7.32636107e-05  2.57324669e-04 -3.96685449e-03
  7.10492715e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:41 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  41.8723029828        1
[INPUT] 0    0    [1    /1   ]  25.7880225996        1
[INPUT] 0    0    [1    /1   ]  4.86801712271        1
[INPUT] 0    0    [1    /1   ]  1.12391559861        1
[INPUT] 0    0    [1    /1   ]  0.280568917595       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [41.87230298280383, 1.0]], [0, [25.788022599645554, 1.0]], [0, [4.868017122705194, 1.0]], [0, [1.1239155986126823, 1.0]], [0, [0.28056891759456565, 1.0]]]}
ecp = {}
CPU time:       111.84
Set gradient conv threshold to 3.16228e-05
cond(S) = 126.1100687668547
E1 = -3.878047781996804  E_coul = 1.0236921354351316
init E= -2.85435564656167
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.915906662152611  LUMO = 1.04433996258075
  mo_energy =
[ -0.91590666   1.04433996   7.24369084  38.97410562 136.48009624]
E1 = -3.8808413376078468  E_coul = 1.0253232550047073
cycle= 1 E= -2.85551808260314  delta_E= -0.00116  |g|= 0.00444  |ddm|= 0.0152
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.915098042813647  LUMO = 1.04531709516615
  mo_energy =
[ -0.91509804   1.0453171    7.24563419  38.97403212 136.47821735]
E1 = -3.881075145430278  E_coul = 1.0255556595773774
cycle= 2 E= -2.8555194858529  delta_E= -1.4e-06  |g|= 0.000421  |ddm|= 0.00188
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914972515542385  LUMO = 1.04539844433311
  mo_energy =
[ -0.91497252   1.04539844   7.24593131  38.97428999 136.478392  ]
E1 = -3.88112522388588  E_coul = 1.0256057173246904
cycle= 3 E= -2.85551950656119  delta_E= -2.07e-08  |g|= 2.06e-05  |ddm|= 0.000276
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914954858769421  LUMO = 1.04540794316933
  mo_energy =
[ -0.91495486   1.04540794   7.24597163  38.97435332 136.47846465]
E1 = -3.8811293996609075  E_coul = 1.0256098930256878
cycle= 4 E= -2.85551950663522  delta_E= -7.4e-11  |g|= 1.74e-07  |ddm|= 1.82e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8811293996609075  E_coul = 1.0256098930256878
  HOMO = -0.914954806804776  LUMO = 1.04540795902008
  mo_energy =
[ -0.91495481   1.04540796   7.24597175  38.97435362 136.47846503]
E1 = -3.8811293989457036  E_coul = 1.0256098923104828
Extra cycle  E= -2.85551950663522  delta_E= -1.33e-15  |g|= 1.29e-08  |ddm|= 5.79e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [41.87230298 25.7880226   4.86801712  1.1239156   0.28056892]
E = -2.855519506635221
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:41 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  41.8723029828        1
[INPUT] 0    0    [1    /1   ]  25.7880225996        1
[INPUT] 0    0    [1    /1   ]  4.86801712271        1
[INPUT] 0    0    [1    /1   ]  1.12391559861        1
[INPUT] 0    0    [1    /1   ]  0.280568917595       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [41.87230298280383, 1.0]], [0, [25.788022599645554, 1.0]], [0, [4.868017122705194, 1.0]], [0, [1.1239155986126823, 1.0]], [0, [0.28056891759456565, 1.0]]]}
ecp = {}
CPU time:       112.48
Set gradient conv threshold to 3.16228e-05
cond(S) = 126.1100687668547
E1 = -3.878047781996804  E_coul = 1.0236921354351316
init E= -2.85435564656167
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.915906662152611  LUMO = 1.04433996258075
  mo_energy =
[ -0.91590666   1.04433996   7.24369084  38.97410562 136.48009624]
E1 = -3.8808413376078468  E_coul = 1.0253232550047073
cycle= 1 E= -2.85551808260314  delta_E= -0.00116  |g|= 0.00444  |ddm|= 0.0152
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.915098042813647  LUMO = 1.04531709516615
  mo_energy =
[ -0.91509804   1.0453171    7.24563419  38.97403212 136.47821735]
E1 = -3.881075145430278  E_coul = 1.0255556595773774
cycle= 2 E= -2.8555194858529  delta_E= -1.4e-06  |g|= 0.000421  |ddm|= 0.00188
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914972515542385  LUMO = 1.04539844433311
  mo_energy =
[ -0.91497252   1.04539844   7.24593131  38.97428999 136.478392  ]
E1 = -3.88112522388588  E_coul = 1.0256057173246904
cycle= 3 E= -2.85551950656119  delta_E= -2.07e-08  |g|= 2.06e-05  |ddm|= 0.000276
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914954858769421  LUMO = 1.04540794316933
  mo_energy =
[ -0.91495486   1.04540794   7.24597163  38.97435332 136.47846465]
E1 = -3.8811293996609075  E_coul = 1.0256098930256878
cycle= 4 E= -2.85551950663522  delta_E= -7.4e-11  |g|= 1.74e-07  |ddm|= 1.82e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8811293996609075  E_coul = 1.0256098930256878
  HOMO = -0.914954806804776  LUMO = 1.04540795902008
  mo_energy =
[ -0.91495481   1.04540796   7.24597175  38.97435362 136.47846503]
E1 = -3.8811293989457036  E_coul = 1.0256098923104828
Extra cycle  E= -2.85551950663522  delta_E= -1.33e-15  |g|= 1.29e-08  |ddm|= 5.79e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 126.1100687668547
E1 = -3.8811293989457036  E_coul = 1.0256098923104828
init E= -2.85551950663522
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.914954807162371  LUMO = 1.04540795813814
  mo_energy =
[ -0.91495481   1.04540796   7.24597175  38.97435363 136.47846504]
E1 = -3.8811293980479764  E_coul = 1.0256098914127565
cycle= 1 E= -2.85551950663522  delta_E= 8.88e-16  |g|= 1.38e-09  |ddm|= 6.77e-09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8811293980479764  E_coul = 1.0256098914127565
  HOMO = -0.914954807611226  LUMO = 1.04540795785426
  mo_energy =
[ -0.91495481   1.04540796   7.24597175  38.97435363 136.47846504]
E1 = -3.88112939788693  E_coul = 1.0256098912517095
Extra cycle  E= -2.85551950663522  delta_E= -4.44e-16  |g|= 1.69e-10  |ddm|= 8.75e-10
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [41.87230298 25.7880226   4.86801712  1.1239156   0.28056892]
grad_E = [-6.44280972e-05  1.15217065e-04 -1.01902475e-03  3.77033905e-03
 -7.89971370e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:44 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  48.0017078777        1
[INPUT] 0    0    [1    /1   ]  29.6636530688        1
[INPUT] 0    0    [1    /1   ]  5.84914289158        1
[INPUT] 0    0    [1    /1   ]  1.26646861205        1
[INPUT] 0    0    [1    /1   ]  0.295862545384       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [48.00170787768997, 1.0]], [0, [29.66365306876629, 1.0]], [0, [5.849142891582607, 1.0]], [0, [1.2664686120536572, 1.0]], [0, [0.2958625453842835, 1.0]]]}
ecp = {}
CPU time:       114.85
Set gradient conv threshold to 3.16228e-05
cond(S) = 129.45185501759684
E1 = -3.8778619803890133  E_coul = 1.0237119561702903
init E= -2.85415002421872
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.915932170505316  LUMO = 1.16269956852845
  mo_energy =
[ -0.91593217   1.16269957   8.52753563  45.81664311 158.61379638]
E1 = -3.8811455463396425  E_coul = 1.0255617422917378
cycle= 1 E= -2.8555838040479  delta_E= -0.00143  |g|= 0.0035  |ddm|= 0.012
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.915011385438167  LUMO = 1.16392846103665
  mo_energy =
[ -0.91501139   1.16392846   8.52962435  45.81711386 158.61296021]
E1 = -3.881255099854528  E_coul = 1.025670517691293
cycle= 2 E= -2.85558458216324  delta_E= -7.78e-07  |g|= 0.000304  |ddm|= 0.00122
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914952987935196  LUMO = 1.16397561214994
  mo_energy =
[ -0.91495299   1.16397561   8.52976785  45.81715082 158.6129072 ]
E1 = -3.8812837289897217  E_coul = 1.025699138402935
cycle= 3 E= -2.85558459058679  delta_E= -8.42e-09  |g|= 1.19e-05  |ddm|= 0.000161
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914941515018294  LUMO = 1.16398240161603
  mo_energy =
[ -0.91494152   1.1639824    8.52979648  45.81719475 158.61295725]
E1 = -3.8812861652656205  E_coul = 1.0257015746557008
cycle= 4 E= -2.85558459060992  delta_E= -2.31e-11  |g|= 1.26e-07  |ddm|= 9.6e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8812861652656205  E_coul = 1.0257015746557008
  HOMO = -0.914941507977117  LUMO = 1.16398239890021
  mo_energy =
[ -0.91494151   1.1639824    8.5297965   45.81719486 158.6129574 ]
E1 = -3.881286159347302  E_coul = 1.0257015687373814
Extra cycle  E= -2.85558459060992  delta_E= -8.88e-16  |g|= 1.12e-08  |ddm|= 4.99e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [48.00170788 29.66365307  5.84914289  1.26646861  0.29586255]
E = -2.8555845906099204
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:44 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  48.0017078777        1
[INPUT] 0    0    [1    /1   ]  29.6636530688        1
[INPUT] 0    0    [1    /1   ]  5.84914289158        1
[INPUT] 0    0    [1    /1   ]  1.26646861205        1
[INPUT] 0    0    [1    /1   ]  0.295862545384       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [48.00170787768997, 1.0]], [0, [29.66365306876629, 1.0]], [0, [5.849142891582607, 1.0]], [0, [1.2664686120536572, 1.0]], [0, [0.2958625453842835, 1.0]]]}
ecp = {}
CPU time:       115.52
Set gradient conv threshold to 3.16228e-05
cond(S) = 129.45185501759684
E1 = -3.8778619803890133  E_coul = 1.0237119561702903
init E= -2.85415002421872
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.915932170505316  LUMO = 1.16269956852845
  mo_energy =
[ -0.91593217   1.16269957   8.52753563  45.81664311 158.61379638]
E1 = -3.8811455463396425  E_coul = 1.0255617422917378
cycle= 1 E= -2.8555838040479  delta_E= -0.00143  |g|= 0.0035  |ddm|= 0.012
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.915011385438167  LUMO = 1.16392846103665
  mo_energy =
[ -0.91501139   1.16392846   8.52962435  45.81711386 158.61296021]
E1 = -3.881255099854528  E_coul = 1.025670517691293
cycle= 2 E= -2.85558458216324  delta_E= -7.78e-07  |g|= 0.000304  |ddm|= 0.00122
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914952987935196  LUMO = 1.16397561214994
  mo_energy =
[ -0.91495299   1.16397561   8.52976785  45.81715082 158.6129072 ]
E1 = -3.8812837289897217  E_coul = 1.025699138402935
cycle= 3 E= -2.85558459058679  delta_E= -8.42e-09  |g|= 1.19e-05  |ddm|= 0.000161
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914941515018294  LUMO = 1.16398240161603
  mo_energy =
[ -0.91494152   1.1639824    8.52979648  45.81719475 158.61295725]
E1 = -3.8812861652656205  E_coul = 1.0257015746557008
cycle= 4 E= -2.85558459060992  delta_E= -2.31e-11  |g|= 1.26e-07  |ddm|= 9.6e-06
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8812861652656205  E_coul = 1.0257015746557008
  HOMO = -0.914941507977117  LUMO = 1.16398239890021
  mo_energy =
[ -0.91494151   1.1639824    8.5297965   45.81719486 158.6129574 ]
E1 = -3.881286159347302  E_coul = 1.0257015687373814
Extra cycle  E= -2.85558459060992  delta_E= -8.88e-16  |g|= 1.12e-08  |ddm|= 4.99e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 129.45185501759684
E1 = -3.881286159347302  E_coul = 1.0257015687373814
init E= -2.85558459060992
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.914941510936269  LUMO = 1.16398239674055
  mo_energy =
[ -0.91494151   1.1639824    8.52979649  45.81719485 158.6129574 ]
E1 = -3.881286158240201  E_coul = 1.0257015676302799
cycle= 1 E= -2.85558459060992  delta_E= -8.88e-16  |g|= 1.2e-09  |ddm|= 5.87e-09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.881286158240201  E_coul = 1.0257015676302799
  HOMO = -0.914941511489823  LUMO = 1.16398239638487
  mo_energy =
[ -0.91494151   1.1639824    8.52979649  45.81719485 158.61295739]
E1 = -3.881286158087547  E_coul = 1.025701567477626
Extra cycle  E= -2.85558459060992  delta_E= 4.44e-16  |g|= 1.38e-10  |ddm|= 7.05e-10
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [48.00170788 29.66365307  5.84914289  1.26646861  0.29586255]
grad_E = [-4.70293111e-05  5.36957786e-05  6.40614689e-05  4.29040780e-03
 -1.85301923e-02]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:47 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  46.8839089219        1
[INPUT] 0    0    [1    /1   ]  28.899525423         1
[INPUT] 0    0    [1    /1   ]  5.51883504559        1
[INPUT] 0    0    [1    /1   ]  1.20552964744        1
[INPUT] 0    0    [1    /1   ]  0.291067822811       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [46.88390892194897, 1.0]], [0, [28.89952542295202, 1.0]], [0, [5.518835045593051, 1.0]], [0, [1.205529647435742, 1.0]], [0, [0.2910678228114625, 1.0]]]}
ecp = {}
CPU time:       117.90
Set gradient conv threshold to 3.16228e-05
cond(S) = 124.97690515708366
E1 = -3.877963985941243  E_coul = 1.0236734521305866
init E= -2.85429053381066
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916002476575133  LUMO = 1.11697220696075
  mo_energy =
[ -0.91600248   1.11697221   8.06332665  43.96248631 153.77494607]
E1 = -3.881686088138845  E_coul = 1.0259921071810783
cycle= 1 E= -2.85569398095777  delta_E= -0.0014  |g|= 0.00474  |ddm|= 0.0192
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914851734541076  LUMO = 1.11833161722526
  mo_energy =
[ -0.91485173   1.11833162   8.06599355  43.96332995 153.77434709]
E1 = -3.8819449321996586  E_coul = 1.0262491810576784
cycle= 2 E= -2.85569575114198  delta_E= -1.77e-06  |g|= 0.000467  |ddm|= 0.00208
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914711554673496  LUMO = 1.11842856760806
  mo_energy =
[ -0.91471155   1.11842857   8.0663348   43.96361724 153.77455347]
E1 = -3.8819984283960367  E_coul = 1.0263026539310074
cycle= 3 E= -2.85569577446503  delta_E= -2.33e-08  |g|= 1.56e-05  |ddm|= 0.000284
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914694750975992  LUMO = 1.11843791877846
  mo_energy =
[ -0.91469475   1.11843792   8.06637558  43.96368255 153.77462865]
E1 = -3.8820019432848407  E_coul = 1.0263061687751918
cycle= 4 E= -2.85569577450965  delta_E= -4.46e-11  |g|= 1.54e-07  |ddm|= 1.36e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8820019432848407  E_coul = 1.0263061687751918
  HOMO = -0.914694802867221  LUMO = 1.11843788524846
  mo_energy =
[ -0.9146948    1.11843789   8.06637545  43.96368241 153.77462852]
E1 = -3.8820019260544165  E_coul = 1.026306151544764
Extra cycle  E= -2.85569577450965  delta_E= -3.55e-15  |g|= 1.75e-08  |ddm|= 8.87e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [46.88390892 28.89952542  5.51883505  1.20552965  0.29106782]
E = -2.8556957745096527
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:48 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  46.8839089219        1
[INPUT] 0    0    [1    /1   ]  28.899525423         1
[INPUT] 0    0    [1    /1   ]  5.51883504559        1
[INPUT] 0    0    [1    /1   ]  1.20552964744        1
[INPUT] 0    0    [1    /1   ]  0.291067822811       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [46.88390892194897, 1.0]], [0, [28.89952542295202, 1.0]], [0, [5.518835045593051, 1.0]], [0, [1.205529647435742, 1.0]], [0, [0.2910678228114625, 1.0]]]}
ecp = {}
CPU time:       118.56
Set gradient conv threshold to 3.16228e-05
cond(S) = 124.97690515708366
E1 = -3.877963985941243  E_coul = 1.0236734521305866
init E= -2.85429053381066
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916002476575133  LUMO = 1.11697220696075
  mo_energy =
[ -0.91600248   1.11697221   8.06332665  43.96248631 153.77494607]
E1 = -3.881686088138845  E_coul = 1.0259921071810783
cycle= 1 E= -2.85569398095777  delta_E= -0.0014  |g|= 0.00474  |ddm|= 0.0192
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914851734541076  LUMO = 1.11833161722526
  mo_energy =
[ -0.91485173   1.11833162   8.06599355  43.96332995 153.77434709]
E1 = -3.8819449321996586  E_coul = 1.0262491810576784
cycle= 2 E= -2.85569575114198  delta_E= -1.77e-06  |g|= 0.000467  |ddm|= 0.00208
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914711554673496  LUMO = 1.11842856760806
  mo_energy =
[ -0.91471155   1.11842857   8.0663348   43.96361724 153.77455347]
E1 = -3.8819984283960367  E_coul = 1.0263026539310074
cycle= 3 E= -2.85569577446503  delta_E= -2.33e-08  |g|= 1.56e-05  |ddm|= 0.000284
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914694750975992  LUMO = 1.11843791877846
  mo_energy =
[ -0.91469475   1.11843792   8.06637558  43.96368255 153.77462865]
E1 = -3.8820019432848407  E_coul = 1.0263061687751918
cycle= 4 E= -2.85569577450965  delta_E= -4.46e-11  |g|= 1.54e-07  |ddm|= 1.36e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8820019432848407  E_coul = 1.0263061687751918
  HOMO = -0.914694802867221  LUMO = 1.11843788524846
  mo_energy =
[ -0.9146948    1.11843789   8.06637545  43.96368241 153.77462852]
E1 = -3.8820019260544165  E_coul = 1.026306151544764
Extra cycle  E= -2.85569577450965  delta_E= -3.55e-15  |g|= 1.75e-08  |ddm|= 8.87e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 124.97690515708366
E1 = -3.8820019260544165  E_coul = 1.026306151544764
init E= -2.85569577450965
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.914694811482443  LUMO = 1.11843787999529
  mo_energy =
[ -0.91469481   1.11843788   8.06637543  43.96368239 153.77462849]
E1 = -3.882001923684646  E_coul = 1.026306149174994
cycle= 1 E= -2.85569577450965  delta_E= 8.88e-16  |g|= 2.1e-09  |ddm|= 1.1e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.882001923684646  E_coul = 1.026306149174994
  HOMO = -0.914694812667337  LUMO = 1.11843787928986
  mo_energy =
[ -0.91469481   1.11843788   8.06637543  43.96368238 153.77462849]
E1 = -3.882001923378629  E_coul = 1.026306148868977
Extra cycle  E= -2.85569577450965  delta_E=    0  |g|= 2.58e-10  |ddm|= 1.37e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [46.88390892 28.89952542  5.51883505  1.20552965  0.29106782]
grad_E = [-4.94725642e-05  6.88556391e-05  7.38132109e-05  6.43746371e-04
 -4.87564097e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:50 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  47.5523193608        1
[INPUT] 0    0    [1    /1   ]  29.2585360248        1
[INPUT] 0    0    [1    /1   ]  5.4574862802         1
[INPUT] 0    0    [1    /1   ]  1.19690590595        1
[INPUT] 0    0    [1    /1   ]  0.291279329437       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [47.55231936075073, 1.0]], [0, [29.258536024829628, 1.0]], [0, [5.457486280198998, 1.0]], [0, [1.1969059059547218, 1.0]], [0, [0.29127932943662305, 1.0]]]}
ecp = {}
CPU time:       120.87
Set gradient conv threshold to 3.16228e-05
cond(S) = 121.5743617337781
E1 = -3.8779389647210643  E_coul = 1.0236716820103764
init E= -2.85426728271069
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91600774529661  LUMO = 1.11347114030375
  mo_energy =
[ -0.91600775   1.11347114   7.99607401  44.09234342 155.36201101]
E1 = -3.881924054647811  E_coul = 1.0262189037354015
cycle= 1 E= -2.85570515091241  delta_E= -0.00144  |g|= 0.00507  |ddm|= 0.0208
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914744061142786  LUMO = 1.1149076295036
  mo_energy =
[ -0.91474406   1.11490763   7.99901687  44.09345388 155.36165647]
E1 = -3.882221161260696  E_coul = 1.0265139262207381
cycle= 2 E= -2.85570723503996  delta_E= -2.08e-06  |g|= 0.000508  |ddm|= 0.00229
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914582821406811  LUMO = 1.11501715557666
  mo_energy =
[ -0.91458282   1.11501716   7.9994083   44.09380508 155.36192859]
E1 = -3.8822809025545775  E_coul = 1.0265736393059461
cycle= 3 E= -2.85570726324863  delta_E= -2.82e-08  |g|= 1.65e-05  |ddm|= 0.000316
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.91456487996659  LUMO = 1.11502706988815
  mo_energy =
[ -0.91456488   1.11502707   7.99945164  44.09387507 155.36200919]
E1 = -3.882284653635419  E_coul = 1.0265773903362259
cycle= 4 E= -2.85570726329919  delta_E= -5.06e-11  |g|= 1.55e-07  |ddm|= 1.46e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.882284653635419  E_coul = 1.0265773903362259
  HOMO = -0.914564936481489  LUMO = 1.11502703429378
  mo_energy =
[ -0.91456494   1.11502703   7.99945151  44.09387492 155.36200903]
E1 = -3.8822846355424274  E_coul = 1.026577372243232
Extra cycle  E= -2.8557072632992  delta_E= -2.66e-15  |g|= 1.79e-08  |ddm|= 9.19e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [47.55231936 29.25853602  5.45748628  1.19690591  0.29127933]
E = -2.8557072632991956
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:51 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  47.5523193608        1
[INPUT] 0    0    [1    /1   ]  29.2585360248        1
[INPUT] 0    0    [1    /1   ]  5.4574862802         1
[INPUT] 0    0    [1    /1   ]  1.19690590595        1
[INPUT] 0    0    [1    /1   ]  0.291279329437       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [47.55231936075073, 1.0]], [0, [29.258536024829628, 1.0]], [0, [5.457486280198998, 1.0]], [0, [1.1969059059547218, 1.0]], [0, [0.29127932943662305, 1.0]]]}
ecp = {}
CPU time:       121.53
Set gradient conv threshold to 3.16228e-05
cond(S) = 121.5743617337781
E1 = -3.8779389647210643  E_coul = 1.0236716820103764
init E= -2.85426728271069
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91600774529661  LUMO = 1.11347114030375
  mo_energy =
[ -0.91600775   1.11347114   7.99607401  44.09234342 155.36201101]
E1 = -3.881924054647811  E_coul = 1.0262189037354015
cycle= 1 E= -2.85570515091241  delta_E= -0.00144  |g|= 0.00507  |ddm|= 0.0208
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914744061142786  LUMO = 1.1149076295036
  mo_energy =
[ -0.91474406   1.11490763   7.99901687  44.09345388 155.36165647]
E1 = -3.882221161260696  E_coul = 1.0265139262207381
cycle= 2 E= -2.85570723503996  delta_E= -2.08e-06  |g|= 0.000508  |ddm|= 0.00229
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914582821406811  LUMO = 1.11501715557666
  mo_energy =
[ -0.91458282   1.11501716   7.9994083   44.09380508 155.36192859]
E1 = -3.8822809025545775  E_coul = 1.0265736393059461
cycle= 3 E= -2.85570726324863  delta_E= -2.82e-08  |g|= 1.65e-05  |ddm|= 0.000316
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.91456487996659  LUMO = 1.11502706988815
  mo_energy =
[ -0.91456488   1.11502707   7.99945164  44.09387507 155.36200919]
E1 = -3.882284653635419  E_coul = 1.0265773903362259
cycle= 4 E= -2.85570726329919  delta_E= -5.06e-11  |g|= 1.55e-07  |ddm|= 1.46e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.882284653635419  E_coul = 1.0265773903362259
  HOMO = -0.914564936481489  LUMO = 1.11502703429378
  mo_energy =
[ -0.91456494   1.11502703   7.99945151  44.09387492 155.36200903]
E1 = -3.8822846355424274  E_coul = 1.026577372243232
Extra cycle  E= -2.8557072632992  delta_E= -2.66e-15  |g|= 1.79e-08  |ddm|= 9.19e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 121.5743617337781
E1 = -3.8822846355424274  E_coul = 1.026577372243232
init E= -2.8557072632992
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.914564945527972  LUMO = 1.11502702882661
  mo_energy =
[ -0.91456495   1.11502703   7.99945149  44.09387489 155.362009  ]
E1 = -3.882284633072787  E_coul = 1.0265773697735907
cycle= 1 E= -2.8557072632992  delta_E= -8.88e-16  |g|= 2.18e-09  |ddm|= 1.15e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.882284633072787  E_coul = 1.0265773697735907
  HOMO = -0.914564946762813  LUMO = 1.11502702809593
  mo_energy =
[ -0.91456495   1.11502703   7.99945148  44.09387488 155.362009  ]
E1 = -3.8822846327537204  E_coul = 1.026577369454526
Extra cycle  E= -2.85570726329919  delta_E= 1.78e-15  |g|= 2.69e-10  |ddm|= 1.43e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [47.55231936 29.25853602  5.45748628  1.19690591  0.29127933]
grad_E = [-4.73782851e-05  7.69541743e-05 -2.50971867e-05  7.63378860e-05
 -1.17101072e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:53 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  48.3024179678        1
[INPUT] 0    0    [1    /1   ]  29.699368924         1
[INPUT] 0    0    [1    /1   ]  5.48921843538        1
[INPUT] 0    0    [1    /1   ]  1.20281028472        1
[INPUT] 0    0    [1    /1   ]  0.29256283333        1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [48.302417967785324, 1.0]], [0, [29.699368923955, 1.0]], [0, [5.489218435376305, 1.0]], [0, [1.202810284718775, 1.0]], [0, [0.2925628333295, 1.0]]]}
ecp = {}
CPU time:       123.85
Set gradient conv threshold to 3.16228e-05
cond(S) = 120.14779228804329
E1 = -3.8779050415972396  E_coul = 1.0236771879650712
init E= -2.85422785363217
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916005777690562  LUMO = 1.12049813248498
  mo_energy =
[ -0.91600578   1.12049813   8.04864268  44.61236328 157.64507772]
E1 = -3.8820705283205  E_coul = 1.0263631559674637
cycle= 1 E= -2.85570737235304  delta_E= -0.00148  |g|= 0.00517  |ddm|= 0.0212
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914673080348235  LUMO = 1.1219941263528
  mo_energy =
[ -0.91467308   1.12199413   8.05174861  44.61367385 157.64494488]
E1 = -3.8823761568854316  E_coul = 1.0266666239813322
cycle= 2 E= -2.8557095329041  delta_E= -2.16e-06  |g|= 0.000516  |ddm|= 0.00233
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914507179657009  LUMO = 1.12210700298981
  mo_energy =
[ -0.91450718   1.122107     8.05215205  44.61403909 157.64523135]
E1 = -3.8824369689375864  E_coul = 1.0267274069590158
cycle= 3 E= -2.85570956197857  delta_E= -2.91e-08  |g|= 1.65e-05  |ddm|= 0.00032
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914489147563863  LUMO = 1.12211701080648
  mo_energy =
[ -0.91448915   1.12211701   8.05219578  44.6141098  157.64531273]
E1 = -3.882440716541983  E_coul = 1.026731154513154
cycle= 4 E= -2.85570956202883  delta_E= -5.03e-11  |g|= 1.48e-07  |ddm|= 1.45e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.882440716541983  E_coul = 1.026731154513154
  HOMO = -0.914489203757837  LUMO = 1.12211697567203
  mo_energy =
[ -0.9144892    1.12211698   8.05219564  44.61410964 157.64531258]
E1 = -3.8824406990237836  E_coul = 1.0267311369949528
Extra cycle  E= -2.85570956202883  delta_E= -1.78e-15  |g|= 1.71e-08  |ddm|= 8.78e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [48.30241797 29.69936892  5.48921844  1.20281028  0.29256283]
E = -2.8557095620288306
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:54 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  48.3024179678        1
[INPUT] 0    0    [1    /1   ]  29.699368924         1
[INPUT] 0    0    [1    /1   ]  5.48921843538        1
[INPUT] 0    0    [1    /1   ]  1.20281028472        1
[INPUT] 0    0    [1    /1   ]  0.29256283333        1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [48.302417967785324, 1.0]], [0, [29.699368923955, 1.0]], [0, [5.489218435376305, 1.0]], [0, [1.202810284718775, 1.0]], [0, [0.2925628333295, 1.0]]]}
ecp = {}
CPU time:       124.52
Set gradient conv threshold to 3.16228e-05
cond(S) = 120.14779228804329
E1 = -3.8779050415972396  E_coul = 1.0236771879650712
init E= -2.85422785363217
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916005777690562  LUMO = 1.12049813248498
  mo_energy =
[ -0.91600578   1.12049813   8.04864268  44.61236328 157.64507772]
E1 = -3.8820705283205  E_coul = 1.0263631559674637
cycle= 1 E= -2.85570737235304  delta_E= -0.00148  |g|= 0.00517  |ddm|= 0.0212
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914673080348235  LUMO = 1.1219941263528
  mo_energy =
[ -0.91467308   1.12199413   8.05174861  44.61367385 157.64494488]
E1 = -3.8823761568854316  E_coul = 1.0266666239813322
cycle= 2 E= -2.8557095329041  delta_E= -2.16e-06  |g|= 0.000516  |ddm|= 0.00233
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914507179657009  LUMO = 1.12210700298981
  mo_energy =
[ -0.91450718   1.122107     8.05215205  44.61403909 157.64523135]
E1 = -3.8824369689375864  E_coul = 1.0267274069590158
cycle= 3 E= -2.85570956197857  delta_E= -2.91e-08  |g|= 1.65e-05  |ddm|= 0.00032
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914489147563863  LUMO = 1.12211701080648
  mo_energy =
[ -0.91448915   1.12211701   8.05219578  44.6141098  157.64531273]
E1 = -3.882440716541983  E_coul = 1.026731154513154
cycle= 4 E= -2.85570956202883  delta_E= -5.03e-11  |g|= 1.48e-07  |ddm|= 1.45e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.882440716541983  E_coul = 1.026731154513154
  HOMO = -0.914489203757837  LUMO = 1.12211697567203
  mo_energy =
[ -0.9144892    1.12211698   8.05219564  44.61410964 157.64531258]
E1 = -3.8824406990237836  E_coul = 1.0267311369949528
Extra cycle  E= -2.85570956202883  delta_E= -1.78e-15  |g|= 1.71e-08  |ddm|= 8.78e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 120.14779228804329
E1 = -3.8824406990237836  E_coul = 1.0267311369949528
init E= -2.85570956202883
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.91448921251694  LUMO = 1.12211697036723
  mo_energy =
[ -0.91448921   1.12211697   8.05219562  44.61410961 157.64531255]
E1 = -3.8824406966583  E_coul = 1.0267311346294692
cycle= 1 E= -2.85570956202883  delta_E=    0  |g|= 2.07e-09  |ddm|= 1.09e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8824406966583  E_coul = 1.0267311346294692
  HOMO = -0.914489213699689  LUMO = 1.12211696966459
  mo_energy =
[ -0.91448921   1.12211697   8.05219562  44.61410961 157.64531254]
E1 = -3.8824406963546267  E_coul = 1.0267311343257959
Extra cycle  E= -2.85570956202883  delta_E=    0  |g|= 2.55e-10  |ddm|= 1.36e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [48.30241797 29.69936892  5.48921844  1.20281028  0.29256283]
grad_E = [-4.54116783e-05  7.78198318e-05 -3.97504921e-05  1.06551031e-05
 -1.49346531e-04]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:56 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  48.7546819168        1
[INPUT] 0    0    [1    /1   ]  29.9688740754        1
[INPUT] 0    0    [1    /1   ]  5.51844985789        1
[INPUT] 0    0    [1    /1   ]  1.20741684208        1
[INPUT] 0    0    [1    /1   ]  0.293302824405       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [48.754681916759296, 1.0]], [0, [29.968874075376345, 1.0]], [0, [5.518449857894828, 1.0]], [0, [1.207416842082595, 1.0]], [0, [0.29330282440540906, 1.0]]]}
ecp = {}
CPU time:       126.86
Set gradient conv threshold to 3.16228e-05
cond(S) = 119.5137393093125
E1 = -3.8778858783076426  E_coul = 1.023679778934289
init E= -2.85420609937335
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916004596636082  LUMO = 1.12515038776216
  mo_energy =
[ -0.9160046    1.12515039   8.09119268  44.96144153 159.07013013]
E1 = -3.882132810365293  E_coul = 1.0264250329479805
cycle= 1 E= -2.85570777741731  delta_E= -0.0015  |g|= 0.0052  |ddm|= 0.0214
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.91464235178069  LUMO = 1.12667479239895
  mo_energy =
[ -0.91464235   1.12667479   8.09436771  44.9628396  159.07009995]
E1 = -3.882439847468897  E_coul = 1.0267298937770086
cycle= 2 E= -2.85570995369189  delta_E= -2.18e-06  |g|= 0.000518  |ddm|= 0.00233
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914475689633505  LUMO = 1.12678849862721
  mo_energy =
[ -0.91447569   1.1267885    8.09477363  44.96320691 159.07038845]
E1 = -3.882500702606487  E_coul = 1.0267907198183144
cycle= 3 E= -2.85570998278817  delta_E= -2.91e-08  |g|= 1.63e-05  |ddm|= 0.00032
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914457716406498  LUMO = 1.12679850596751
  mo_energy =
[ -0.91445772   1.12679851   8.09481734  44.96327762 159.07046982]
E1 = -3.8825044221617917  E_coul = 1.0267944393242678
cycle= 4 E= -2.85570998283752  delta_E= -4.94e-11  |g|= 1.42e-07  |ddm|= 1.43e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8825044221617917  E_coul = 1.0267944393242678
  HOMO = -0.91445777175664  LUMO = 1.12679847150052
  mo_energy =
[ -0.91445777   1.12679847   8.09481721  44.96327747 159.07046966]
E1 = -3.882504405190469  E_coul = 1.026794422352942
Extra cycle  E= -2.85570998283753  delta_E= -3.11e-15  |g|= 1.64e-08  |ddm|= 8.42e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [48.75468192 29.96887408  5.51844986  1.20741684  0.29330282]
E = -2.855709982837527
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:57 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  48.7546819168        1
[INPUT] 0    0    [1    /1   ]  29.9688740754        1
[INPUT] 0    0    [1    /1   ]  5.51844985789        1
[INPUT] 0    0    [1    /1   ]  1.20741684208        1
[INPUT] 0    0    [1    /1   ]  0.293302824405       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [48.754681916759296, 1.0]], [0, [29.968874075376345, 1.0]], [0, [5.518449857894828, 1.0]], [0, [1.207416842082595, 1.0]], [0, [0.29330282440540906, 1.0]]]}
ecp = {}
CPU time:       127.54
Set gradient conv threshold to 3.16228e-05
cond(S) = 119.5137393093125
E1 = -3.8778858783076426  E_coul = 1.023679778934289
init E= -2.85420609937335
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916004596636082  LUMO = 1.12515038776216
  mo_energy =
[ -0.9160046    1.12515039   8.09119268  44.96144153 159.07013013]
E1 = -3.882132810365293  E_coul = 1.0264250329479805
cycle= 1 E= -2.85570777741731  delta_E= -0.0015  |g|= 0.0052  |ddm|= 0.0214
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.91464235178069  LUMO = 1.12667479239895
  mo_energy =
[ -0.91464235   1.12667479   8.09436771  44.9628396  159.07009995]
E1 = -3.882439847468897  E_coul = 1.0267298937770086
cycle= 2 E= -2.85570995369189  delta_E= -2.18e-06  |g|= 0.000518  |ddm|= 0.00233
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914475689633505  LUMO = 1.12678849862721
  mo_energy =
[ -0.91447569   1.1267885    8.09477363  44.96320691 159.07038845]
E1 = -3.882500702606487  E_coul = 1.0267907198183144
cycle= 3 E= -2.85570998278817  delta_E= -2.91e-08  |g|= 1.63e-05  |ddm|= 0.00032
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914457716406498  LUMO = 1.12679850596751
  mo_energy =
[ -0.91445772   1.12679851   8.09481734  44.96327762 159.07046982]
E1 = -3.8825044221617917  E_coul = 1.0267944393242678
cycle= 4 E= -2.85570998283752  delta_E= -4.94e-11  |g|= 1.42e-07  |ddm|= 1.43e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8825044221617917  E_coul = 1.0267944393242678
  HOMO = -0.91445777175664  LUMO = 1.12679847150052
  mo_energy =
[ -0.91445777   1.12679847   8.09481721  44.96327747 159.07046966]
E1 = -3.882504405190469  E_coul = 1.026794422352942
Extra cycle  E= -2.85570998283753  delta_E= -3.11e-15  |g|= 1.64e-08  |ddm|= 8.42e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 119.5137393093125
E1 = -3.882504405190469  E_coul = 1.026794422352942
init E= -2.85570998283753
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.914457780242297  LUMO = 1.12679846635273
  mo_energy =
[ -0.91445778   1.12679847   8.09481719  44.96327744 159.07046963]
E1 = -3.8825044029154996  E_coul = 1.026794420077972
cycle= 1 E= -2.85570998283753  delta_E= -8.88e-16  |g|= 1.98e-09  |ddm|= 1.04e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8825044029154996  E_coul = 1.026794420077972
  HOMO = -0.914457781379777  LUMO = 1.12679846567504
  mo_energy =
[ -0.91445778   1.12679847   8.09481719  44.96327744 159.07046962]
E1 = -3.882504402624769  E_coul = 1.026794419787244
Extra cycle  E= -2.85570998283753  delta_E= 2.66e-15  |g|= 2.43e-10  |ddm|= 1.3e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [48.75468192 29.96887408  5.51844986  1.20741684  0.29330282]
grad_E = [-4.43155415e-05  7.73612332e-05 -3.05242839e-05 -8.99320125e-06
  9.59477238e-05]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:18:59 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  48.7968789484        1
[INPUT] 0    0    [1    /1   ]  29.9938554382        1
[INPUT] 0    0    [1    /1   ]  5.52103987418        1
[INPUT] 0    0    [1    /1   ]  1.20769237141        1
[INPUT] 0    0    [1    /1   ]  0.293312962348       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [48.796878948392454, 1.0]], [0, [29.993855438172766, 1.0]], [0, [5.521039874181723, 1.0]], [0, [1.2076923714068735, 1.0]], [0, [0.2933129623481328, 1.0]]]}
ecp = {}
CPU time:       129.88
Set gradient conv threshold to 3.16228e-05
cond(S) = 119.44537770991441
E1 = -3.877885847970273  E_coul = 1.0236795962129739
init E= -2.8542062517573
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916004714975993  LUMO = 1.12532651626568
  mo_energy =
[ -0.91600471   1.12532652   8.09437263  44.9927687  159.20154008]
E1 = -3.8821297983853604  E_coul = 1.0264220018497896
cycle= 1 E= -2.85570779653557  delta_E= -0.0015  |g|= 0.00519  |ddm|= 0.0214
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914643874695801  LUMO = 1.12685015009737
  mo_energy =
[ -0.91464387   1.12685015   8.09754424  44.99416159 159.20150476]
E1 = -3.882436263377928  E_coul = 1.0267262955214698
cycle= 2 E= -2.85570996785646  delta_E= -2.17e-06  |g|= 0.000517  |ddm|= 0.00233
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914477529962922  LUMO = 1.12696367525034
  mo_energy =
[ -0.91447753   1.12696368   8.09794944  44.99452786 159.20179218]
E1 = -3.882497019290788  E_coul = 1.0267870224231106
cycle= 3 E= -2.85570999686768  delta_E= -2.9e-08  |g|= 1.63e-05  |ddm|= 0.000319
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914459574241221  LUMO = 1.12697367517717
  mo_energy =
[ -0.91445957   1.12697368   8.09799312  44.99459852 159.20187347]
E1 = -3.8825007348507183  E_coul = 1.0267907379337935
cycle= 4 E= -2.85570999691693  delta_E= -4.92e-11  |g|= 1.42e-07  |ddm|= 1.43e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8825007348507183  E_coul = 1.0267907379337935
  HOMO = -0.914459629491566  LUMO = 1.12697364076386
  mo_energy =
[ -0.91445963   1.12697364   8.09799299  44.99459837 159.20187331]
E1 = -3.8825007179125475  E_coul = 1.0267907209956226
Extra cycle  E= -2.85570999691693  delta_E=    0  |g|= 1.64e-08  |ddm|= 8.4e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [48.79687895 29.99385544  5.52103987  1.20769237  0.29331296]
E = -2.855709996916925
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:00 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  48.7968789484        1
[INPUT] 0    0    [1    /1   ]  29.9938554382        1
[INPUT] 0    0    [1    /1   ]  5.52103987418        1
[INPUT] 0    0    [1    /1   ]  1.20769237141        1
[INPUT] 0    0    [1    /1   ]  0.293312962348       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [48.796878948392454, 1.0]], [0, [29.993855438172766, 1.0]], [0, [5.521039874181723, 1.0]], [0, [1.2076923714068735, 1.0]], [0, [0.2933129623481328, 1.0]]]}
ecp = {}
CPU time:       130.56
Set gradient conv threshold to 3.16228e-05
cond(S) = 119.44537770991441
E1 = -3.877885847970273  E_coul = 1.0236795962129739
init E= -2.8542062517573
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916004714975993  LUMO = 1.12532651626568
  mo_energy =
[ -0.91600471   1.12532652   8.09437263  44.9927687  159.20154008]
E1 = -3.8821297983853604  E_coul = 1.0264220018497896
cycle= 1 E= -2.85570779653557  delta_E= -0.0015  |g|= 0.00519  |ddm|= 0.0214
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914643874695801  LUMO = 1.12685015009737
  mo_energy =
[ -0.91464387   1.12685015   8.09754424  44.99416159 159.20150476]
E1 = -3.882436263377928  E_coul = 1.0267262955214698
cycle= 2 E= -2.85570996785646  delta_E= -2.17e-06  |g|= 0.000517  |ddm|= 0.00233
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914477529962922  LUMO = 1.12696367525034
  mo_energy =
[ -0.91447753   1.12696368   8.09794944  44.99452786 159.20179218]
E1 = -3.882497019290788  E_coul = 1.0267870224231106
cycle= 3 E= -2.85570999686768  delta_E= -2.9e-08  |g|= 1.63e-05  |ddm|= 0.000319
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914459574241221  LUMO = 1.12697367517717
  mo_energy =
[ -0.91445957   1.12697368   8.09799312  44.99459852 159.20187347]
E1 = -3.8825007348507183  E_coul = 1.0267907379337935
cycle= 4 E= -2.85570999691693  delta_E= -4.92e-11  |g|= 1.42e-07  |ddm|= 1.43e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8825007348507183  E_coul = 1.0267907379337935
  HOMO = -0.914459629491566  LUMO = 1.12697364076386
  mo_energy =
[ -0.91445963   1.12697364   8.09799299  44.99459837 159.20187331]
E1 = -3.8825007179125475  E_coul = 1.0267907209956226
Extra cycle  E= -2.85570999691693  delta_E=    0  |g|= 1.64e-08  |ddm|= 8.4e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 119.44537770991441
E1 = -3.8825007179125475  E_coul = 1.0267907209956226
init E= -2.85570999691693
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.914459637960646  LUMO = 1.1269736356252
  mo_energy =
[ -0.91445964   1.12697364   8.09799297  44.99459834 159.20187328]
E1 = -3.882500715642378  E_coul = 1.0267907187254535
cycle= 1 E= -2.85570999691692  delta_E= 4.44e-16  |g|= 1.98e-09  |ddm|= 1.04e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.882500715642378  E_coul = 1.0267907187254535
  HOMO = -0.914459639095736  LUMO = 1.12697363494881
  mo_energy =
[ -0.91445964   1.12697363   8.09799297  44.99459834 159.20187328]
E1 = -3.882500715352328  E_coul = 1.0267907184354004
Extra cycle  E= -2.85570999691693  delta_E= -3.11e-15  |g|= 2.43e-10  |ddm|= 1.29e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [48.79687895 29.99385544  5.52103987  1.20769237  0.29331296]
grad_E = [-4.42152659e-05  7.73110517e-05 -2.87952581e-05 -5.79888644e-06
  3.87770561e-05]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:02 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  48.8488702486        1
[INPUT] 0    0    [1    /1   ]  30.024237259         1
[INPUT] 0    0    [1    /1   ]  5.52381755447        1
[INPUT] 0    0    [1    /1   ]  1.20793293609        1
[INPUT] 0    0    [1    /1   ]  0.293296478381       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [48.848870248616635, 1.0]], [0, [30.024237258973606, 1.0]], [0, [5.523817554466882, 1.0]], [0, [1.2079329360886637, 1.0]], [0, [0.2932964783813238, 1.0]]]}
ecp = {}
CPU time:       132.92
Set gradient conv threshold to 3.16228e-05
cond(S) = 119.34760027241067
E1 = -3.8778868327991733  E_coul = 1.0236792325038182
init E= -2.85420760029536
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91600494961226  LUMO = 1.12540568512721
  mo_energy =
[ -0.91600495   1.12540569   8.09756126  45.0294679  159.3606573 ]
E1 = -3.882122002932964  E_coul = 1.026414171876782
cycle= 1 E= -2.85570783105618  delta_E= -0.0015  |g|= 0.00519  |ddm|= 0.0213
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914647802732546  LUMO = 1.1269266687943
  mo_energy =
[ -0.9146478    1.12692667   8.10072402  45.03084827 159.36060875]
E1 = -3.8824274180084943  E_coul = 1.0267174250848337
cycle= 2 E= -2.85570999292366  delta_E= -2.16e-06  |g|= 0.000516  |ddm|= 0.00232
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914482040638309  LUMO = 1.12703984026448
  mo_energy =
[ -0.91448204   1.12703984   8.10112787  45.03121268 159.36089421]
E1 = -3.882487999726507  E_coul = 1.0267779779400172
cycle= 3 E= -2.85571002178649  delta_E= -2.89e-08  |g|= 1.63e-05  |ddm|= 0.000318
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914464111632762  LUMO = 1.12704982797478
  mo_energy =
[ -0.91446411   1.12704983   8.10117149  45.03128324 159.36097537]
E1 = -3.8824917101406533  E_coul = 1.026781688305045
cycle= 4 E= -2.85571002183561  delta_E= -4.91e-11  |g|= 1.42e-07  |ddm|= 1.43e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8824917101406533  E_coul = 1.026781688305045
  HOMO = -0.914464166765281  LUMO = 1.12704979360593
  mo_energy =
[ -0.91446417   1.12704979   8.10117136  45.03128308 159.36097522]
E1 = -3.8824916932230362  E_coul = 1.0267816713874258
Extra cycle  E= -2.85571002183561  delta_E= -2.22e-15  |g|= 1.64e-08  |ddm|= 8.4e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [48.84887025 30.02423726  5.52381755  1.20793294  0.29329648]
E = -2.8557100218356104
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:03 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  48.8488702486        1
[INPUT] 0    0    [1    /1   ]  30.024237259         1
[INPUT] 0    0    [1    /1   ]  5.52381755447        1
[INPUT] 0    0    [1    /1   ]  1.20793293609        1
[INPUT] 0    0    [1    /1   ]  0.293296478381       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [48.848870248616635, 1.0]], [0, [30.024237258973606, 1.0]], [0, [5.523817554466882, 1.0]], [0, [1.2079329360886637, 1.0]], [0, [0.2932964783813238, 1.0]]]}
ecp = {}
CPU time:       133.63
Set gradient conv threshold to 3.16228e-05
cond(S) = 119.34760027241067
E1 = -3.8778868327991733  E_coul = 1.0236792325038182
init E= -2.85420760029536
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91600494961226  LUMO = 1.12540568512721
  mo_energy =
[ -0.91600495   1.12540569   8.09756126  45.0294679  159.3606573 ]
E1 = -3.882122002932964  E_coul = 1.026414171876782
cycle= 1 E= -2.85570783105618  delta_E= -0.0015  |g|= 0.00519  |ddm|= 0.0213
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914647802732546  LUMO = 1.1269266687943
  mo_energy =
[ -0.9146478    1.12692667   8.10072402  45.03084827 159.36060875]
E1 = -3.8824274180084943  E_coul = 1.0267174250848337
cycle= 2 E= -2.85570999292366  delta_E= -2.16e-06  |g|= 0.000516  |ddm|= 0.00232
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914482040638309  LUMO = 1.12703984026448
  mo_energy =
[ -0.91448204   1.12703984   8.10112787  45.03121268 159.36089421]
E1 = -3.882487999726507  E_coul = 1.0267779779400172
cycle= 3 E= -2.85571002178649  delta_E= -2.89e-08  |g|= 1.63e-05  |ddm|= 0.000318
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914464111632762  LUMO = 1.12704982797478
  mo_energy =
[ -0.91446411   1.12704983   8.10117149  45.03128324 159.36097537]
E1 = -3.8824917101406533  E_coul = 1.026781688305045
cycle= 4 E= -2.85571002183561  delta_E= -4.91e-11  |g|= 1.42e-07  |ddm|= 1.43e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8824917101406533  E_coul = 1.026781688305045
  HOMO = -0.914464166765281  LUMO = 1.12704979360593
  mo_energy =
[ -0.91446417   1.12704979   8.10117136  45.03128308 159.36097522]
E1 = -3.8824916932230362  E_coul = 1.0267816713874258
Extra cycle  E= -2.85571002183561  delta_E= -2.22e-15  |g|= 1.64e-08  |ddm|= 8.4e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 119.34760027241067
E1 = -3.8824916932230362  E_coul = 1.0267816713874258
init E= -2.85571002183561
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.914464175224087  LUMO = 1.12704978847206
  mo_energy =
[ -0.91446418   1.12704979   8.10117134  45.03128306 159.36097519]
E1 = -3.8824916909551246  E_coul = 1.0267816691195122
cycle= 1 E= -2.85571002183561  delta_E= -2.22e-15  |g|= 1.98e-09  |ddm|= 1.04e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8824916909551246  E_coul = 1.0267816691195122
  HOMO = -0.914464176358046  LUMO = 1.12704978779622
  mo_energy =
[ -0.91446418   1.12704979   8.10117134  45.03128305 159.36097518]
E1 = -3.8824916906653613  E_coul = 1.0267816688297493
Extra cycle  E= -2.85571002183561  delta_E= 8.88e-16  |g|= 2.42e-10  |ddm|= 1.29e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [48.84887025 30.02423726  5.52381755  1.20793294  0.29329648]
grad_E = [-4.40913733e-05  7.72826627e-05 -2.71966489e-05  3.74736043e-06
 -7.02345591e-05]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:05 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  48.9129920227        1
[INPUT] 0    0    [1    /1   ]  30.0610853284        1
[INPUT] 0    0    [1    /1   ]  5.5269789904         1
[INPUT] 0    0    [1    /1   ]  1.20818291064        1
[INPUT] 0    0    [1    /1   ]  0.293264134741       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [48.91299202271184, 1.0]], [0, [30.061085328407046, 1.0]], [0, [5.526978990397364, 1.0]], [0, [1.2081829106426185, 1.0]], [0, [0.29326413474130963, 1.0]]]}
ecp = {}
CPU time:       136.00
Set gradient conv threshold to 3.16228e-05
cond(S) = 119.21475143935457
E1 = -3.8778885193045673  E_coul = 1.0236787461640513
init E= -2.85420977314052
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916005274835235  LUMO = 1.12544333683238
  mo_energy =
[ -0.91600527   1.12544334   8.10109868  45.0733756  159.55436953]
E1 = -3.882110772646766  E_coul = 1.026402877391999
cycle= 1 E= -2.85570789525477  delta_E= -0.0015  |g|= 0.00517  |ddm|= 0.0212
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914653476240125  LUMO = 1.12696034394437
  mo_energy =
[ -0.91465348   1.12696034   8.10424865  45.07473812 159.55430192]
E1 = -3.882414747860314  E_coul = 1.0267047038204533
cycle= 2 E= -2.85571004403986  delta_E= -2.15e-06  |g|= 0.000515  |ddm|= 0.00231
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914488513341366  LUMO = 1.12707302355424
  mo_energy =
[ -0.91448851   1.12707302   8.10465062  45.07509997 159.55458469]
E1 = -3.882475092663689  E_coul = 1.026765019961988
cycle= 3 E= -2.8557100727017  delta_E= -2.87e-08  |g|= 1.63e-05  |ddm|= 0.000317
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914470619407138  LUMO = 1.12708299493879
  mo_energy =
[ -0.91447062   1.12708299   8.10469418  45.0751704  159.55466569]
E1 = -3.8824787967095347  E_coul = 1.026768723958857
cycle= 4 E= -2.85571007275068  delta_E= -4.9e-11  |g|= 1.42e-07  |ddm|= 1.43e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8824787967095347  E_coul = 1.026768723958857
  HOMO = -0.914470674395911  LUMO = 1.12708296061419
  mo_energy =
[ -0.91447067   1.12708296   8.10469405  45.07517025 159.55466554]
E1 = -3.8824787798070033  E_coul = 1.0267687070563256
Extra cycle  E= -2.85571007275068  delta_E=    0  |g|= 1.64e-08  |ddm|= 8.4e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [48.91299202 30.06108533  5.52697899  1.20818291  0.29326413]
E = -2.8557100727506777
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:06 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  48.9129920227        1
[INPUT] 0    0    [1    /1   ]  30.0610853284        1
[INPUT] 0    0    [1    /1   ]  5.5269789904         1
[INPUT] 0    0    [1    /1   ]  1.20818291064        1
[INPUT] 0    0    [1    /1   ]  0.293264134741       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [48.91299202271184, 1.0]], [0, [30.061085328407046, 1.0]], [0, [5.526978990397364, 1.0]], [0, [1.2081829106426185, 1.0]], [0, [0.29326413474130963, 1.0]]]}
ecp = {}
CPU time:       136.72
Set gradient conv threshold to 3.16228e-05
cond(S) = 119.21475143935457
E1 = -3.8778885193045673  E_coul = 1.0236787461640513
init E= -2.85420977314052
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916005274835235  LUMO = 1.12544333683238
  mo_energy =
[ -0.91600527   1.12544334   8.10109868  45.0733756  159.55436953]
E1 = -3.882110772646766  E_coul = 1.026402877391999
cycle= 1 E= -2.85570789525477  delta_E= -0.0015  |g|= 0.00517  |ddm|= 0.0212
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914653476240125  LUMO = 1.12696034394437
  mo_energy =
[ -0.91465348   1.12696034   8.10424865  45.07473812 159.55430192]
E1 = -3.882414747860314  E_coul = 1.0267047038204533
cycle= 2 E= -2.85571004403986  delta_E= -2.15e-06  |g|= 0.000515  |ddm|= 0.00231
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914488513341366  LUMO = 1.12707302355424
  mo_energy =
[ -0.91448851   1.12707302   8.10465062  45.07509997 159.55458469]
E1 = -3.882475092663689  E_coul = 1.026765019961988
cycle= 3 E= -2.8557100727017  delta_E= -2.87e-08  |g|= 1.63e-05  |ddm|= 0.000317
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914470619407138  LUMO = 1.12708299493879
  mo_energy =
[ -0.91447062   1.12708299   8.10469418  45.0751704  159.55466569]
E1 = -3.8824787967095347  E_coul = 1.026768723958857
cycle= 4 E= -2.85571007275068  delta_E= -4.9e-11  |g|= 1.42e-07  |ddm|= 1.43e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8824787967095347  E_coul = 1.026768723958857
  HOMO = -0.914470674395911  LUMO = 1.12708296061419
  mo_energy =
[ -0.91447067   1.12708296   8.10469405  45.07517025 159.55466554]
E1 = -3.8824787798070033  E_coul = 1.0267687070563256
Extra cycle  E= -2.85571007275068  delta_E=    0  |g|= 1.64e-08  |ddm|= 8.4e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 119.21475143935457
E1 = -3.8824787798070033  E_coul = 1.0267687070563256
init E= -2.85571007275068
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.91447068284718  LUMO = 1.1270829554829
  mo_energy =
[ -0.91447068   1.12708296   8.10469403  45.07517022 159.55466551]
E1 = -3.882478777540013  E_coul = 1.0267687047893355
cycle= 1 E= -2.85571007275068  delta_E=    0  |g|= 1.98e-09  |ddm|= 1.04e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.882478777540013  E_coul = 1.0267687047893355
  HOMO = -0.914470683980668  LUMO = 1.1270829548072
  mo_energy =
[ -0.91447068   1.12708295   8.10469402  45.07517022 159.5546655 ]
E1 = -3.8824787772503404  E_coul = 1.0267687044996627
Extra cycle  E= -2.85571007275068  delta_E=    0  |g|= 2.42e-10  |ddm|= 1.29e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [48.91299202 30.06108533  5.52697899  1.20818291  0.29326413]
grad_E = [-4.39402730e-05  7.72712166e-05 -2.56666916e-05  1.87000482e-05
 -2.20690481e-04]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:08 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  49.0243760043        1
[INPUT] 0    0    [1    /1   ]  30.1236032327        1
[INPUT] 0    0    [1    /1   ]  5.53223396838        1
[INPUT] 0    0    [1    /1   ]  1.20858342477        1
[INPUT] 0    0    [1    /1   ]  0.293201518312       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [49.02437600430405, 1.0]], [0, [30.12360323274111, 1.0]], [0, [5.5322339683761586, 1.0]], [0, [1.20858342476941, 1.0]], [0, [0.293201518312293, 1.0]]]}
ecp = {}
CPU time:       139.09
Set gradient conv threshold to 3.16228e-05
cond(S) = 118.96278711203257
E1 = -3.8778917206498513  E_coul = 1.023677889077877
init E= -2.85421383157197
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916005875537598  LUMO = 1.12547187433622
  mo_energy =
[ -0.91600588   1.12547187   8.10692324  45.14791797 159.88655835]
E1 = -3.8820906032374576  E_coul = 1.0263825418541226
cycle= 1 E= -2.85570806138333  delta_E= -0.00149  |g|= 0.00515  |ddm|= 0.0211
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914663716716009  LUMO = 1.12698164298709
  mo_energy =
[ -0.91466372   1.12698164   8.11005018  45.14924846 159.88645647]
E1 = -3.882392020329764  E_coul = 1.0266818333762637
cycle= 2 E= -2.8557101869535  delta_E= -2.13e-06  |g|= 0.000512  |ddm|= 0.0023
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914500173495279  LUMO = 1.12709344509275
  mo_energy =
[ -0.91450017   1.12709345   8.11044881  45.1496058  159.88673449]
E1 = -3.8824519454965105  E_coul = 1.0267417302352526
cycle= 3 E= -2.85571021526126  delta_E= -2.83e-08  |g|= 1.62e-05  |ddm|= 0.000315
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914482341313187  LUMO = 1.12710338750689
  mo_energy =
[ -0.91448234   1.12710339   8.11049224  45.14967599 159.8868152 ]
E1 = -3.8824556385277296  E_coul = 1.0267454232177462
cycle= 4 E= -2.85571021530998  delta_E= -4.87e-11  |g|= 1.42e-07  |ddm|= 1.42e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8824556385277296  E_coul = 1.0267454232177462
  HOMO = -0.914482396046121  LUMO = 1.12710335325807
  mo_energy =
[ -0.9144824    1.12710335   8.11049211  45.14967583 159.88681504]
E1 = -3.8824556216473955  E_coul = 1.0267454063374108
Extra cycle  E= -2.85571021530998  delta_E= -1.33e-15  |g|= 1.64e-08  |ddm|= 8.4e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [49.024376   30.12360323  5.53223397  1.20858342  0.29320152]
E = -2.8557102153099847
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:09 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  49.0243760043        1
[INPUT] 0    0    [1    /1   ]  30.1236032327        1
[INPUT] 0    0    [1    /1   ]  5.53223396838        1
[INPUT] 0    0    [1    /1   ]  1.20858342477        1
[INPUT] 0    0    [1    /1   ]  0.293201518312       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [49.02437600430405, 1.0]], [0, [30.12360323274111, 1.0]], [0, [5.5322339683761586, 1.0]], [0, [1.20858342476941, 1.0]], [0, [0.293201518312293, 1.0]]]}
ecp = {}
CPU time:       139.81
Set gradient conv threshold to 3.16228e-05
cond(S) = 118.96278711203257
E1 = -3.8778917206498513  E_coul = 1.023677889077877
init E= -2.85421383157197
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916005875537598  LUMO = 1.12547187433622
  mo_energy =
[ -0.91600588   1.12547187   8.10692324  45.14791797 159.88655835]
E1 = -3.8820906032374576  E_coul = 1.0263825418541226
cycle= 1 E= -2.85570806138333  delta_E= -0.00149  |g|= 0.00515  |ddm|= 0.0211
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914663716716009  LUMO = 1.12698164298709
  mo_energy =
[ -0.91466372   1.12698164   8.11005018  45.14924846 159.88645647]
E1 = -3.882392020329764  E_coul = 1.0266818333762637
cycle= 2 E= -2.8557101869535  delta_E= -2.13e-06  |g|= 0.000512  |ddm|= 0.0023
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914500173495279  LUMO = 1.12709344509275
  mo_energy =
[ -0.91450017   1.12709345   8.11044881  45.1496058  159.88673449]
E1 = -3.8824519454965105  E_coul = 1.0267417302352526
cycle= 3 E= -2.85571021526126  delta_E= -2.83e-08  |g|= 1.62e-05  |ddm|= 0.000315
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914482341313187  LUMO = 1.12710338750689
  mo_energy =
[ -0.91448234   1.12710339   8.11049224  45.14967599 159.8868152 ]
E1 = -3.8824556385277296  E_coul = 1.0267454232177462
cycle= 4 E= -2.85571021530998  delta_E= -4.87e-11  |g|= 1.42e-07  |ddm|= 1.42e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8824556385277296  E_coul = 1.0267454232177462
  HOMO = -0.914482396046121  LUMO = 1.12710335325807
  mo_energy =
[ -0.9144824    1.12710335   8.11049211  45.14967583 159.88681504]
E1 = -3.8824556216473955  E_coul = 1.0267454063374108
Extra cycle  E= -2.85571021530998  delta_E= -1.33e-15  |g|= 1.64e-08  |ddm|= 8.4e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 118.96278711203257
E1 = -3.8824556216473955  E_coul = 1.0267454063374108
init E= -2.85571021530998
    CPU time for initialize scf      0.04 sec, wall time      0.04 sec
  HOMO = -0.914482404486294  LUMO = 1.12710334812999
  mo_energy =
[ -0.9144824    1.12710335   8.11049209  45.14967581 159.88681501]
E1 = -3.8824556193811692  E_coul = 1.0267454040711843
cycle= 1 E= -2.85571021530999  delta_E= -4.44e-16  |g|= 1.98e-09  |ddm|= 1.04e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8824556193811692  E_coul = 1.0267454040711843
  HOMO = -0.914482405619394  LUMO = 1.12710334745425
  mo_energy =
[ -0.91448241   1.12710335   8.11049209  45.1496758  159.88681501]
E1 = -3.8824556190915405  E_coul = 1.026745403781556
Extra cycle  E= -2.85571021530998  delta_E= 8.88e-16  |g|= 2.42e-10  |ddm|= 1.29e-09
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [49.024376   30.12360323  5.53223397  1.20858342  0.29320152]
grad_E = [-4.36843970e-05  7.72721626e-05 -2.33093935e-05  4.63608305e-05
 -4.88650209e-04]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:11 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  49.2009190348        1
[INPUT] 0    0    [1    /1   ]  30.2190221555        1
[INPUT] 0    0    [1    /1   ]  5.54022716421        1
[INPUT] 0    0    [1    /1   ]  1.20917858197        1
[INPUT] 0    0    [1    /1   ]  0.293098499778       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [49.20091903484314, 1.0]], [0, [30.219022155547453, 1.0]], [0, [5.540227164212187, 1.0]], [0, [1.2091785819716707, 1.0]], [0, [0.29309849977820956, 1.0]]]}
ecp = {}
CPU time:       142.23
Set gradient conv threshold to 3.16228e-05
cond(S) = 118.51671752933734
E1 = -3.877896973765727  E_coul = 1.0236765321642651
init E= -2.85422044160146
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916006893477652  LUMO = 1.12548448614895
  mo_energy =
[ -0.91600689   1.12548449   8.1157338   45.26272553 160.40354   ]
E1 = -3.8820587497561574  E_coul = 1.0263502889190332
cycle= 1 E= -2.85570846083712  delta_E= -0.00149  |g|= 0.00511  |ddm|= 0.0208
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914680026699321  LUMO = 1.12698272140908
  mo_energy =
[ -0.91468003   1.12698272   8.11882417  45.26400534 160.40338388]
E1 = -3.882356136535725  E_coul = 1.0266455864546937
cycle= 2 E= -2.85571055008103  delta_E= -2.09e-06  |g|= 0.000507  |ddm|= 0.00227
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.91451871922931  LUMO = 1.12709313842524
  mo_energy =
[ -0.91451872   1.12709314   8.11921753  45.26435556 160.40365443]
E1 = -3.882415402311784  E_coul = 1.0267048244746366
cycle= 3 E= -2.85571057783715  delta_E= -2.78e-08  |g|= 1.62e-05  |ddm|= 0.000311
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914500984561929  LUMO = 1.12710303474107
  mo_energy =
[ -0.91450098   1.12710303   8.11926076  45.26442537 160.40373466]
E1 = -3.8824190780353027  E_coul = 1.026708500149821
cycle= 4 E= -2.85571057788548  delta_E= -4.83e-11  |g|= 1.43e-07  |ddm|= 1.41e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8824190780353027  E_coul = 1.026708500149821
  HOMO = -0.91450103886784  LUMO = 1.12710300062477
  mo_energy =
[ -0.91450104   1.127103     8.11926063  45.26442522 160.40373451]
E1 = -3.882419061192774  E_coul = 1.0267084833072901
Extra cycle  E= -2.85571057788548  delta_E= -1.78e-15  |g|= 1.64e-08  |ddm|= 8.4e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [49.20091903 30.21902216  5.54022716  1.20917858  0.2930985 ]
E = -2.8557105778854837
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:12 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  49.2009190348        1
[INPUT] 0    0    [1    /1   ]  30.2190221555        1
[INPUT] 0    0    [1    /1   ]  5.54022716421        1
[INPUT] 0    0    [1    /1   ]  1.20917858197        1
[INPUT] 0    0    [1    /1   ]  0.293098499778       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [49.20091903484314, 1.0]], [0, [30.219022155547453, 1.0]], [0, [5.540227164212187, 1.0]], [0, [1.2091785819716707, 1.0]], [0, [0.29309849977820956, 1.0]]]}
ecp = {}
CPU time:       142.94
Set gradient conv threshold to 3.16228e-05
cond(S) = 118.51671752933734
E1 = -3.877896973765727  E_coul = 1.0236765321642651
init E= -2.85422044160146
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916006893477652  LUMO = 1.12548448614895
  mo_energy =
[ -0.91600689   1.12548449   8.1157338   45.26272553 160.40354   ]
E1 = -3.8820587497561574  E_coul = 1.0263502889190332
cycle= 1 E= -2.85570846083712  delta_E= -0.00149  |g|= 0.00511  |ddm|= 0.0208
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914680026699321  LUMO = 1.12698272140908
  mo_energy =
[ -0.91468003   1.12698272   8.11882417  45.26400534 160.40338388]
E1 = -3.882356136535725  E_coul = 1.0266455864546937
cycle= 2 E= -2.85571055008103  delta_E= -2.09e-06  |g|= 0.000507  |ddm|= 0.00227
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.91451871922931  LUMO = 1.12709313842524
  mo_energy =
[ -0.91451872   1.12709314   8.11921753  45.26435556 160.40365443]
E1 = -3.882415402311784  E_coul = 1.0267048244746366
cycle= 3 E= -2.85571057783715  delta_E= -2.78e-08  |g|= 1.62e-05  |ddm|= 0.000311
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914500984561929  LUMO = 1.12710303474107
  mo_energy =
[ -0.91450098   1.12710303   8.11926076  45.26442537 160.40373466]
E1 = -3.8824190780353027  E_coul = 1.026708500149821
cycle= 4 E= -2.85571057788548  delta_E= -4.83e-11  |g|= 1.43e-07  |ddm|= 1.41e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8824190780353027  E_coul = 1.026708500149821
  HOMO = -0.91450103886784  LUMO = 1.12710300062477
  mo_energy =
[ -0.91450104   1.127103     8.11926063  45.26442522 160.40373451]
E1 = -3.882419061192774  E_coul = 1.0267084833072901
Extra cycle  E= -2.85571057788548  delta_E= -1.78e-15  |g|= 1.64e-08  |ddm|= 8.4e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 118.51671752933734
E1 = -3.882419061192774  E_coul = 1.0267084833072901
init E= -2.85571057788548
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.914501047289109  LUMO = 1.1271029955026
  mo_energy =
[ -0.91450105   1.127103     8.11926061  45.26442519 160.40373448]
E1 = -3.8824190589279186  E_coul = 1.0267084810424327
cycle= 1 E= -2.85571057788549  delta_E= -2.22e-15  |g|= 1.98e-09  |ddm|= 1.04e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8824190589279186  E_coul = 1.0267084810424327
  HOMO = -0.914501048421518  LUMO = 1.1271029948269
  mo_energy =
[ -0.91450105   1.12710299   8.11926061  45.26442519 160.40373447]
E1 = -3.8824190586383587  E_coul = 1.0267084807528741
Extra cycle  E= -2.85571057788548  delta_E= 1.33e-15  |g|= 2.42e-10  |ddm|= 1.29e-09
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [49.20091903 30.21902216  5.54022716  1.20917858  0.2930985 ]
grad_E = [-4.32965514e-05  7.73016225e-05 -1.97822196e-05  9.05879610e-05
 -9.11844559e-04]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:14 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  49.4957136745        1
[INPUT] 0    0    [1    /1   ]  30.3688775768        1
[INPUT] 0    0    [1    /1   ]  5.55284612111        1
[INPUT] 0    0    [1    /1   ]  1.21009331375        1
[INPUT] 0    0    [1    /1   ]  0.292923109294       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [49.49571367453109, 1.0]], [0, [30.368877576832865, 1.0]], [0, [5.552846121111193, 1.0]], [0, [1.2100933137501102, 1.0]], [0, [0.29292310929356724, 1.0]]]}
ecp = {}
CPU time:       145.40
Set gradient conv threshold to 3.16228e-05
cond(S) = 117.65748163379162
E1 = -3.877905943345207  E_coul = 1.0236742853919025
init E= -2.8542316579533
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916008752140836  LUMO = 1.12545225260328
  mo_energy =
[ -0.91600875   1.12545225   8.12955955  45.44630953 161.24277566]
E1 = -3.882006782666663  E_coul = 1.0262973027562214
cycle= 1 E= -2.85570947991044  delta_E= -0.00148  |g|= 0.00506  |ddm|= 0.0205
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914707003180047  LUMO = 1.12693147670896
  mo_energy =
[ -0.914707     1.12693148   8.1325898   45.44750631 161.24253071]
E1 = -3.8822975908577653  E_coul = 1.0265860802568376
cycle= 2 E= -2.85571151060093  delta_E= -2.03e-06  |g|= 0.0005  |ddm|= 0.00223
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914549342368996  LUMO = 1.12703962957593
  mo_energy =
[ -0.91454934   1.12703963   8.13297454  45.44784491 161.24278906]
E1 = -3.8823557841425003  E_coul = 1.0266442466704442
cycle= 3 E= -2.85571153747206  delta_E= -2.69e-08  |g|= 1.61e-05  |ddm|= 0.000305
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914531768301552  LUMO = 1.12704944916749
  mo_energy =
[ -0.91453177   1.12704945   8.13301742  45.44791409 161.24286851]
E1 = -3.882359431367589  E_coul = 1.0266478938478367
cycle= 4 E= -2.85571153751975  delta_E= -4.77e-11  |g|= 1.43e-07  |ddm|= 1.4e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.882359431367589  E_coul = 1.0266478938478367
  HOMO = -0.914531821835957  LUMO = 1.12704941531272
  mo_energy =
[ -0.91453182   1.12704942   8.1330173   45.44791394 161.24286836]
E1 = -3.8823594146017686  E_coul = 1.026647877082012
Extra cycle  E= -2.85571153751976  delta_E= -4.44e-15  |g|= 1.64e-08  |ddm|= 8.4e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [49.49571367 30.36887758  5.55284612  1.21009331  0.29292311]
E = -2.8557115375197566
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:15 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  49.4957136745        1
[INPUT] 0    0    [1    /1   ]  30.3688775768        1
[INPUT] 0    0    [1    /1   ]  5.55284612111        1
[INPUT] 0    0    [1    /1   ]  1.21009331375        1
[INPUT] 0    0    [1    /1   ]  0.292923109294       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [49.49571367453109, 1.0]], [0, [30.368877576832865, 1.0]], [0, [5.552846121111193, 1.0]], [0, [1.2100933137501102, 1.0]], [0, [0.29292310929356724, 1.0]]]}
ecp = {}
CPU time:       146.14
Set gradient conv threshold to 3.16228e-05
cond(S) = 117.65748163379162
E1 = -3.877905943345207  E_coul = 1.0236742853919025
init E= -2.8542316579533
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916008752140836  LUMO = 1.12545225260328
  mo_energy =
[ -0.91600875   1.12545225   8.12955955  45.44630953 161.24277566]
E1 = -3.882006782666663  E_coul = 1.0262973027562214
cycle= 1 E= -2.85570947991044  delta_E= -0.00148  |g|= 0.00506  |ddm|= 0.0205
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914707003180047  LUMO = 1.12693147670896
  mo_energy =
[ -0.914707     1.12693148   8.1325898   45.44750631 161.24253071]
E1 = -3.8822975908577653  E_coul = 1.0265860802568376
cycle= 2 E= -2.85571151060093  delta_E= -2.03e-06  |g|= 0.0005  |ddm|= 0.00223
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914549342368996  LUMO = 1.12703962957593
  mo_energy =
[ -0.91454934   1.12703963   8.13297454  45.44784491 161.24278906]
E1 = -3.8823557841425003  E_coul = 1.0266442466704442
cycle= 3 E= -2.85571153747206  delta_E= -2.69e-08  |g|= 1.61e-05  |ddm|= 0.000305
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914531768301552  LUMO = 1.12704944916749
  mo_energy =
[ -0.91453177   1.12704945   8.13301742  45.44791409 161.24286851]
E1 = -3.882359431367589  E_coul = 1.0266478938478367
cycle= 4 E= -2.85571153751975  delta_E= -4.77e-11  |g|= 1.43e-07  |ddm|= 1.4e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.882359431367589  E_coul = 1.0266478938478367
  HOMO = -0.914531821835957  LUMO = 1.12704941531272
  mo_energy =
[ -0.91453182   1.12704942   8.1330173   45.44791394 161.24286836]
E1 = -3.8823594146017686  E_coul = 1.026647877082012
Extra cycle  E= -2.85571153751976  delta_E= -4.44e-15  |g|= 1.64e-08  |ddm|= 8.4e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 117.65748163379162
E1 = -3.8823594146017686  E_coul = 1.026647877082012
init E= -2.85571153751976
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.914531830218878  LUMO = 1.12704941020479
  mo_energy =
[ -0.91453183   1.12704941   8.13301728  45.44791392 161.24286833]
E1 = -3.8823594123407967  E_coul = 1.026647874821042
cycle= 1 E= -2.85571153751975  delta_E= 1.78e-15  |g|= 1.98e-09  |ddm|= 1.04e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8823594123407967  E_coul = 1.026647874821042
  HOMO = -0.914531831349361  LUMO = 1.12704940952964
  mo_energy =
[ -0.91453183   1.12704941   8.13301727  45.44791391 161.24286833]
E1 = -3.882359412051563  E_coul = 1.0266478745318075
Extra cycle  E= -2.85571153751976  delta_E= -8.88e-16  |g|= 2.42e-10  |ddm|= 1.29e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.08 sec
exp = [49.49571367 30.36887758  5.55284612  1.21009331  0.29292311]
grad_E = [-4.26948058e-05  7.74087932e-05 -1.41264621e-05  1.63316373e-04
 -1.60502151e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:18 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  49.9878746252        1
[INPUT] 0    0    [1    /1   ]  30.5948642153        1
[INPUT] 0    0    [1    /1   ]  5.57213327425        1
[INPUT] 0    0    [1    /1   ]  1.21143131837        1
[INPUT] 0    0    [1    /1   ]  0.292624962678       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [49.98787462518286, 1.0]], [0, [30.59486421526468, 1.0]], [0, [5.5721332742543055, 1.0]], [0, [1.2114313183677223, 1.0]], [0, [0.2926249626780035, 1.0]]]}
ecp = {}
CPU time:       148.54
Set gradient conv threshold to 3.16228e-05
cond(S) = 115.94931449427038
E1 = -3.87792128572322  E_coul = 1.0236705921156941
init E= -2.85425069360753
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916012254416498  LUMO = 1.12527875610724
  mo_energy =
[ -0.91601225   1.12527876   8.15048918  45.73229634 162.58278945]
E1 = -3.8819236361883127  E_coul = 1.026211555961221
cycle= 1 E= -2.85571208022709  delta_E= -0.00146  |g|= 0.00496  |ddm|= 0.0199
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914751135670912  LUMO = 1.12672708998873
  mo_energy =
[ -0.91475114   1.12672709   8.15342197  45.7333593  162.58240147]
E1 = -3.8822038936399537  E_coul = 1.0264898746819908
cycle= 2 E= -2.85571401895796  delta_E= -1.94e-06  |g|= 0.000489  |ddm|= 0.00217
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914599316298606  LUMO = 1.12683160522836
  mo_energy =
[ -0.91459932   1.12683161   8.15379284  45.73367927 162.58264026]
E1 = -3.8822603761123107  E_coul = 1.0265463316637162
cycle= 3 E= -2.85571404444859  delta_E= -2.55e-08  |g|= 1.6e-05  |ddm|= 0.000297
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914582004003344  LUMO = 1.12684129777126
  mo_energy =
[ -0.914582     1.1268413    8.15383518  45.73374742 162.58271845]
E1 = -3.8822639767880234  E_coul = 1.026549932292771
cycle= 4 E= -2.85571404449525  delta_E= -4.67e-11  |g|= 1.44e-07  |ddm|= 1.39e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8822639767880234  E_coul = 1.026549932292771
  HOMO = -0.914582056101249  LUMO = 1.12684126445876
  mo_energy =
[ -0.91458206   1.12684126   8.15383505  45.73374728 162.58271831]
E1 = -3.8822639601882747  E_coul = 1.0265499156930196
Extra cycle  E= -2.85571404449526  delta_E= -2.66e-15  |g|= 1.65e-08  |ddm|= 8.38e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [49.98787463 30.59486422  5.57213327  1.21143132  0.29262496]
E = -2.8557140444952553
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:18 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  49.9878746252        1
[INPUT] 0    0    [1    /1   ]  30.5948642153        1
[INPUT] 0    0    [1    /1   ]  5.57213327425        1
[INPUT] 0    0    [1    /1   ]  1.21143131837        1
[INPUT] 0    0    [1    /1   ]  0.292624962678       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [49.98787462518286, 1.0]], [0, [30.59486421526468, 1.0]], [0, [5.5721332742543055, 1.0]], [0, [1.2114313183677223, 1.0]], [0, [0.2926249626780035, 1.0]]]}
ecp = {}
CPU time:       149.28
Set gradient conv threshold to 3.16228e-05
cond(S) = 115.94931449427038
E1 = -3.87792128572322  E_coul = 1.0236705921156941
init E= -2.85425069360753
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916012254416498  LUMO = 1.12527875610724
  mo_energy =
[ -0.91601225   1.12527876   8.15048918  45.73229634 162.58278945]
E1 = -3.8819236361883127  E_coul = 1.026211555961221
cycle= 1 E= -2.85571208022709  delta_E= -0.00146  |g|= 0.00496  |ddm|= 0.0199
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914751135670912  LUMO = 1.12672708998873
  mo_energy =
[ -0.91475114   1.12672709   8.15342197  45.7333593  162.58240147]
E1 = -3.8822038936399537  E_coul = 1.0264898746819908
cycle= 2 E= -2.85571401895796  delta_E= -1.94e-06  |g|= 0.000489  |ddm|= 0.00217
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914599316298606  LUMO = 1.12683160522836
  mo_energy =
[ -0.91459932   1.12683161   8.15379284  45.73367927 162.58264026]
E1 = -3.8822603761123107  E_coul = 1.0265463316637162
cycle= 3 E= -2.85571404444859  delta_E= -2.55e-08  |g|= 1.6e-05  |ddm|= 0.000297
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914582004003344  LUMO = 1.12684129777126
  mo_energy =
[ -0.914582     1.1268413    8.15383518  45.73374742 162.58271845]
E1 = -3.8822639767880234  E_coul = 1.026549932292771
cycle= 4 E= -2.85571404449525  delta_E= -4.67e-11  |g|= 1.44e-07  |ddm|= 1.39e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8822639767880234  E_coul = 1.026549932292771
  HOMO = -0.914582056101249  LUMO = 1.12684126445876
  mo_energy =
[ -0.91458206   1.12684126   8.15383505  45.73374728 162.58271831]
E1 = -3.8822639601882747  E_coul = 1.0265499156930196
Extra cycle  E= -2.85571404449526  delta_E= -2.66e-15  |g|= 1.65e-08  |ddm|= 8.38e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 115.94931449427038
E1 = -3.8822639601882747  E_coul = 1.0265499156930196
init E= -2.85571404449526
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.914582064401123  LUMO = 1.12684125938687
  mo_energy =
[ -0.91458206   1.12684126   8.15383503  45.73374725 162.58271829]
E1 = -3.8822639579385134  E_coul = 1.0265499134432583
cycle= 1 E= -2.85571404449526  delta_E=    0  |g|= 1.98e-09  |ddm|= 1.03e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8822639579385134  E_coul = 1.0265499134432583
  HOMO = -0.914582065525999  LUMO = 1.12684125871415
  mo_energy =
[ -0.91458207   1.12684126   8.15383503  45.73374725 162.58271828]
E1 = -3.882263957650356  E_coul = 1.0265499131551026
Extra cycle  E= -2.85571404449525  delta_E= 1.78e-15  |g|= 2.41e-10  |ddm|= 1.28e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [49.98787463 30.59486422  5.57213327  1.21143132  0.29262496]
grad_E = [-4.18047899e-05  7.77239111e-05 -5.11561361e-06  2.80732125e-04
 -2.72281751e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:21 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  50.8362839705        1
[INPUT] 0    0    [1    /1   ]  30.9230043222        1
[INPUT] 0    0    [1    /1   ]  5.6009213154         1
[INPUT] 0    0    [1    /1   ]  1.21326604076        1
[INPUT] 0    0    [1    /1   ]  0.292098896179       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [50.836283970534204, 1.0]], [0, [30.923004322215558, 1.0]], [0, [5.60092131539615, 1.0]], [0, [1.2132660407644202, 1.0]], [0, [0.29209889617879936, 1.0]]]}
ecp = {}
CPU time:       151.67
Set gradient conv threshold to 3.16228e-05
cond(S) = 112.39593258165928
E1 = -3.8779485896864494  E_coul = 1.0236643827043947
init E= -2.85428420698205
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916019299416483  LUMO = 1.12468483355042
  mo_energy =
[ -0.9160193    1.12468483   8.18117303  46.1731207  164.73744544]
E1 = -3.8817897719259364  E_coul = 1.0260709265307322
cycle= 1 E= -2.8557188453952  delta_E= -0.00143  |g|= 0.00481  |ddm|= 0.0189
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914824768749105  LUMO = 1.12608221428725
  mo_energy =
[ -0.91482477   1.12608221   8.18394566  46.17396561 164.73682479]
E1 = -3.8820529600710976  E_coul = 1.0263323196766636
cycle= 2 E= -2.85572064039443  delta_E= -1.79e-06  |g|= 0.00047  |ddm|= 0.00207
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914682381554041  LUMO = 1.12618083077646
  mo_energy =
[ -0.91468238   1.12618083   8.18429402  46.17425545 164.73703201]
E1 = -3.8821066974334544  E_coul = 1.0263860336838908
cycle= 3 E= -2.85572066374956  delta_E= -2.34e-08  |g|= 1.57e-05  |ddm|= 0.000282
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914665504338338  LUMO = 1.12619030715576
  mo_energy =
[ -0.9146655    1.12619031   8.1843354   46.17432187 164.73710809]
E1 = -3.8821102204132463  E_coul = 1.0263895566187513
cycle= 4 E= -2.85572066379449  delta_E= -4.49e-11  |g|= 1.45e-07  |ddm|= 1.36e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8821102204132463  E_coul = 1.0263895566187513
  HOMO = -0.914665553587865  LUMO = 1.12619027504583
  mo_energy =
[ -0.91466555   1.12619028   8.18433528  46.17432174 164.73710797]
E1 = -3.8821102041981526  E_coul = 1.0263895404036556
Extra cycle  E= -2.8557206637945  delta_E= -2.22e-15  |g|= 1.64e-08  |ddm|= 8.3e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [50.83628397 30.92300432  5.60092132  1.21326604  0.2920989 ]
E = -2.855720663794497
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:21 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  50.8362839705        1
[INPUT] 0    0    [1    /1   ]  30.9230043222        1
[INPUT] 0    0    [1    /1   ]  5.6009213154         1
[INPUT] 0    0    [1    /1   ]  1.21326604076        1
[INPUT] 0    0    [1    /1   ]  0.292098896179       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [50.836283970534204, 1.0]], [0, [30.923004322215558, 1.0]], [0, [5.60092131539615, 1.0]], [0, [1.2132660407644202, 1.0]], [0, [0.29209889617879936, 1.0]]]}
ecp = {}
CPU time:       152.41
Set gradient conv threshold to 3.16228e-05
cond(S) = 112.39593258165928
E1 = -3.8779485896864494  E_coul = 1.0236643827043947
init E= -2.85428420698205
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916019299416483  LUMO = 1.12468483355042
  mo_energy =
[ -0.9160193    1.12468483   8.18117303  46.1731207  164.73744544]
E1 = -3.8817897719259364  E_coul = 1.0260709265307322
cycle= 1 E= -2.8557188453952  delta_E= -0.00143  |g|= 0.00481  |ddm|= 0.0189
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914824768749105  LUMO = 1.12608221428725
  mo_energy =
[ -0.91482477   1.12608221   8.18394566  46.17396561 164.73682479]
E1 = -3.8820529600710976  E_coul = 1.0263323196766636
cycle= 2 E= -2.85572064039443  delta_E= -1.79e-06  |g|= 0.00047  |ddm|= 0.00207
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914682381554041  LUMO = 1.12618083077646
  mo_energy =
[ -0.91468238   1.12618083   8.18429402  46.17425545 164.73703201]
E1 = -3.8821066974334544  E_coul = 1.0263860336838908
cycle= 3 E= -2.85572066374956  delta_E= -2.34e-08  |g|= 1.57e-05  |ddm|= 0.000282
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914665504338338  LUMO = 1.12619030715576
  mo_energy =
[ -0.9146655    1.12619031   8.1843354   46.17432187 164.73710809]
E1 = -3.8821102204132463  E_coul = 1.0263895566187513
cycle= 4 E= -2.85572066379449  delta_E= -4.49e-11  |g|= 1.45e-07  |ddm|= 1.36e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8821102204132463  E_coul = 1.0263895566187513
  HOMO = -0.914665553587865  LUMO = 1.12619027504583
  mo_energy =
[ -0.91466555   1.12619028   8.18433528  46.17432174 164.73710797]
E1 = -3.8821102041981526  E_coul = 1.0263895404036556
Extra cycle  E= -2.8557206637945  delta_E= -2.22e-15  |g|= 1.64e-08  |ddm|= 8.3e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 112.39593258165928
E1 = -3.8821102041981526  E_coul = 1.0263895404036556
init E= -2.8557206637945
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.914665561695421  LUMO = 1.12619027006784
  mo_energy =
[ -0.91466556   1.12619027   8.18433526  46.17432172 164.73710794]
E1 = -3.8821102019800624  E_coul = 1.0263895381855663
cycle= 1 E= -2.8557206637945  delta_E= 8.88e-16  |g|= 1.96e-09  |ddm|= 1.02e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8821102019800624  E_coul = 1.0263895381855663
  HOMO = -0.91466556280446  LUMO = 1.12619026940323
  mo_energy =
[ -0.91466556   1.12619027   8.18433526  46.17432171 164.73710794]
E1 = -3.8821102016952547  E_coul = 1.0263895379007562
Extra cycle  E= -2.8557206637945  delta_E= -2.22e-15  |g|= 2.39e-10  |ddm|= 1.26e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [50.83628397 30.92300432  5.60092132  1.21326604  0.2920989 ]
grad_E = [-4.05494542e-05  7.85887406e-05  9.43563300e-06  4.72307607e-04
 -4.54683054e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:24 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  52.3643999797        1
[INPUT] 0    0    [1    /1   ]  31.3606548118        1
[INPUT] 0    0    [1    /1   ]  5.64170204343        1
[INPUT] 0    0    [1    /1   ]  1.2153983425         1
[INPUT] 0    0    [1    /1   ]  0.291119957162       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [52.364399979723586, 1.0]], [0, [31.360654811785384, 1.0]], [0, [5.641702043430984, 1.0]], [0, [1.215398342503806, 1.0]], [0, [0.29111995716189965, 1.0]]]}
ecp = {}
CPU time:       154.81
Set gradient conv threshold to 3.16228e-05
cond(S) = 104.9104201769294
E1 = -3.877999784019596  E_coul = 1.0236536125213866
init E= -2.85434617149821
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916034499212667  LUMO = 1.12287940945378
  mo_energy =
[ -0.9160345    1.12287941   8.22299127  46.83499562 168.22758068]
E1 = -3.8815726222741818  E_coul = 1.025835879888011
cycle= 1 E= -2.85573674238617  delta_E= -0.00139  |g|= 0.00457  |ddm|= 0.0174
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914951141234629  LUMO = 1.12419095707876
  mo_energy =
[ -0.91495114   1.12419096   8.22549553  46.83548007 168.22657634]
E1 = -3.8818078541715257  E_coul = 1.0260695389039272
cycle= 2 E= -2.8557383152676  delta_E= -1.57e-06  |g|= 0.000439  |ddm|= 0.0019
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914824154217939  LUMO = 1.12427988715203
  mo_energy =
[ -0.91482415   1.12427989   8.22580681  46.83572064 168.226732  ]
E1 = -3.88185715052376  E_coul = 1.0261188151501905
cycle= 3 E= -2.85573833537357  delta_E= -2.01e-08  |g|= 1.53e-05  |ddm|= 0.00026
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914808022578861  LUMO = 1.12428898058585
  mo_energy =
[ -0.91480802   1.12428898   8.22584653  46.83578408 168.22680449]
E1 = -3.8818605393192884  E_coul = 1.026122203903733
cycle= 4 E= -2.85573833541556  delta_E= -4.2e-11  |g|= 1.46e-07  |ddm|= 1.31e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8818605393192884  E_coul = 1.026122203903733
  HOMO = -0.914808065755912  LUMO = 1.12428895132168
  mo_energy =
[ -0.91480807   1.12428895   8.22584642  46.83578398 168.2268044 ]
E1 = -3.8818605240524446  E_coul = 1.026122188636885
Extra cycle  E= -2.85573833541556  delta_E= -4.44e-15  |g|= 1.61e-08  |ddm|= 8.03e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [52.36439998 31.36065481  5.64170204  1.21539834  0.29111996]
E = -2.85573833541556
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:25 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  52.3643999797        1
[INPUT] 0    0    [1    /1   ]  31.3606548118        1
[INPUT] 0    0    [1    /1   ]  5.64170204343        1
[INPUT] 0    0    [1    /1   ]  1.2153983425         1
[INPUT] 0    0    [1    /1   ]  0.291119957162       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [52.364399979723586, 1.0]], [0, [31.360654811785384, 1.0]], [0, [5.641702043430984, 1.0]], [0, [1.215398342503806, 1.0]], [0, [0.29111995716189965, 1.0]]]}
ecp = {}
CPU time:       155.57
Set gradient conv threshold to 3.16228e-05
cond(S) = 104.9104201769294
E1 = -3.877999784019596  E_coul = 1.0236536125213866
init E= -2.85434617149821
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916034499212667  LUMO = 1.12287940945378
  mo_energy =
[ -0.9160345    1.12287941   8.22299127  46.83499562 168.22758068]
E1 = -3.8815726222741818  E_coul = 1.025835879888011
cycle= 1 E= -2.85573674238617  delta_E= -0.00139  |g|= 0.00457  |ddm|= 0.0174
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.914951141234629  LUMO = 1.12419095707876
  mo_energy =
[ -0.91495114   1.12419096   8.22549553  46.83548007 168.22657634]
E1 = -3.8818078541715257  E_coul = 1.0260695389039272
cycle= 2 E= -2.8557383152676  delta_E= -1.57e-06  |g|= 0.000439  |ddm|= 0.0019
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.914824154217939  LUMO = 1.12427988715203
  mo_energy =
[ -0.91482415   1.12427989   8.22580681  46.83572064 168.226732  ]
E1 = -3.88185715052376  E_coul = 1.0261188151501905
cycle= 3 E= -2.85573833537357  delta_E= -2.01e-08  |g|= 1.53e-05  |ddm|= 0.00026
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.914808022578861  LUMO = 1.12428898058585
  mo_energy =
[ -0.91480802   1.12428898   8.22584653  46.83578408 168.22680449]
E1 = -3.8818605393192884  E_coul = 1.026122203903733
cycle= 4 E= -2.85573833541556  delta_E= -4.2e-11  |g|= 1.46e-07  |ddm|= 1.31e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8818605393192884  E_coul = 1.026122203903733
  HOMO = -0.914808065755912  LUMO = 1.12428895132168
  mo_energy =
[ -0.91480807   1.12428895   8.22584642  46.83578398 168.2268044 ]
E1 = -3.8818605240524446  E_coul = 1.026122188636885
Extra cycle  E= -2.85573833541556  delta_E= -4.44e-15  |g|= 1.61e-08  |ddm|= 8.03e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 104.9104201769294
E1 = -3.8818605240524446  E_coul = 1.026122188636885
init E= -2.85573833541556
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.914808073389337  LUMO = 1.12428894659531
  mo_energy =
[ -0.91480807   1.12428895   8.2258464   46.83578395 168.22680437]
E1 = -3.8818605219236293  E_coul = 1.0261221865080703
cycle= 1 E= -2.85573833541556  delta_E= 8.88e-16  |g|= 1.91e-09  |ddm|= 9.88e-09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8818605219236293  E_coul = 1.0261221865080703
  HOMO = -0.914808074453737  LUMO = 1.1242889459555
  mo_energy =
[ -0.91480807   1.12428895   8.2258464   46.83578395 168.22680437]
E1 = -3.881860521648724  E_coul = 1.0261221862331644
Extra cycle  E= -2.85573833541556  delta_E= -4.44e-16  |g|= 2.31e-10  |ddm|= 1.22e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [52.36439998 31.36065481  5.64170204  1.21539834  0.29111996]
grad_E = [-3.89359601e-05  8.08610009e-05  3.34754302e-05  7.89590507e-04
 -7.57431338e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:27 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  55.3524635708        1
[INPUT] 0    0    [1    /1   ]  31.8405217009        1
[INPUT] 0    0    [1    /1   ]  5.69424330563        1
[INPUT] 0    0    [1    /1   ]  1.21666728435        1
[INPUT] 0    0    [1    /1   ]  0.289115348407       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [55.352463570768734, 1.0]], [0, [31.84052170088084, 1.0]], [0, [5.694243305631816, 1.0]], [0, [1.2166672843453137, 1.0]], [0, [0.2891153484072293, 1.0]]]}
ecp = {}
CPU time:       157.99
Set gradient conv threshold to 3.16228e-05
cond(S) = 89.76972330862277
E1 = -3.878103985022557  E_coul = 1.023633597249199
init E= -2.85447038777336
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916070395351214  LUMO = 1.11749262037804
  mo_energy =
[ -0.9160704    1.11749262   8.27140382  47.79113652 174.07225136]
E1 = -3.8812078865533985  E_coul = 1.0254220544651313
cycle= 1 E= -2.85578583208827  delta_E= -0.00132  |g|= 0.00415  |ddm|= 0.0149
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.915182445335033  LUMO = 1.11865180052272
  mo_energy =
[ -0.91518245   1.1186518    8.27343447  47.79099856 174.07058713]
E1 = -3.881395205483475  E_coul = 1.0256081432522863
cycle= 2 E= -2.85578706223119  delta_E= -1.23e-06  |g|= 0.000387  |ddm|= 0.00163
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.915081716846146  LUMO = 1.11872411642788
  mo_energy =
[ -0.91508172   1.11872412   8.27368182  47.79115505 174.07065499]
E1 = -3.8814370230880644  E_coul = 1.025649945655038
cycle= 3 E= -2.85578707743303  delta_E= -1.52e-08  |g|= 1.44e-05  |ddm|= 0.000223
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.91506696949042  LUMO = 1.11873246750223
  mo_energy =
[ -0.91506697   1.11873247   8.27371831  47.79121287 174.07072084]
E1 = -3.8814401586435032  E_coul = 1.0256530811738926
cycle= 4 E= -2.85578707746961  delta_E= -3.66e-11  |g|= 1.41e-07  |ddm|= 1.22e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8814401586435032  E_coul = 1.0256530811738926
  HOMO = -0.915066998147852  LUMO = 1.11873244567453
  mo_energy =
[ -0.915067     1.11873245   8.27371824  47.79121284 174.07072082]
E1 = -3.8814401459655317  E_coul = 1.025653068495921
Extra cycle  E= -2.85578707746961  delta_E=    0  |g|= 1.47e-08  |ddm|= 7.18e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [55.35246357 31.8405217   5.69424331  1.21666728  0.28911535]
E = -2.8557870774696106
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:28 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  55.3524635708        1
[INPUT] 0    0    [1    /1   ]  31.8405217009        1
[INPUT] 0    0    [1    /1   ]  5.69424330563        1
[INPUT] 0    0    [1    /1   ]  1.21666728435        1
[INPUT] 0    0    [1    /1   ]  0.289115348407       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [55.352463570768734, 1.0]], [0, [31.84052170088084, 1.0]], [0, [5.694243305631816, 1.0]], [0, [1.2166672843453137, 1.0]], [0, [0.2891153484072293, 1.0]]]}
ecp = {}
CPU time:       158.75
Set gradient conv threshold to 3.16228e-05
cond(S) = 89.76972330862277
E1 = -3.878103985022557  E_coul = 1.023633597249199
init E= -2.85447038777336
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916070395351214  LUMO = 1.11749262037804
  mo_energy =
[ -0.9160704    1.11749262   8.27140382  47.79113652 174.07225136]
E1 = -3.8812078865533985  E_coul = 1.0254220544651313
cycle= 1 E= -2.85578583208827  delta_E= -0.00132  |g|= 0.00415  |ddm|= 0.0149
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.915182445335033  LUMO = 1.11865180052272
  mo_energy =
[ -0.91518245   1.1186518    8.27343447  47.79099856 174.07058713]
E1 = -3.881395205483475  E_coul = 1.0256081432522863
cycle= 2 E= -2.85578706223119  delta_E= -1.23e-06  |g|= 0.000387  |ddm|= 0.00163
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.915081716846146  LUMO = 1.11872411642788
  mo_energy =
[ -0.91508172   1.11872412   8.27368182  47.79115505 174.07065499]
E1 = -3.8814370230880644  E_coul = 1.025649945655038
cycle= 3 E= -2.85578707743303  delta_E= -1.52e-08  |g|= 1.44e-05  |ddm|= 0.000223
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.91506696949042  LUMO = 1.11873246750223
  mo_energy =
[ -0.91506697   1.11873247   8.27371831  47.79121287 174.07072084]
E1 = -3.8814401586435032  E_coul = 1.0256530811738926
cycle= 4 E= -2.85578707746961  delta_E= -3.66e-11  |g|= 1.41e-07  |ddm|= 1.22e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8814401586435032  E_coul = 1.0256530811738926
  HOMO = -0.915066998147852  LUMO = 1.11873244567453
  mo_energy =
[ -0.915067     1.11873245   8.27371824  47.79121284 174.07072082]
E1 = -3.8814401459655317  E_coul = 1.025653068495921
Extra cycle  E= -2.85578707746961  delta_E=    0  |g|= 1.47e-08  |ddm|= 7.18e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 89.76972330862277
E1 = -3.8814401459655317  E_coul = 1.025653068495921
init E= -2.85578707746961
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.915067004486853  LUMO = 1.1187324416741
  mo_energy =
[ -0.915067     1.11873244   8.27371822  47.79121282 174.0707208 ]
E1 = -3.881440144104856  E_coul = 1.0256530666352437
cycle= 1 E= -2.85578707746961  delta_E= -1.78e-15  |g|= 1.72e-09  |ddm|= 8.8e-09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.881440144104856  E_coul = 1.0256530666352437
  HOMO = -0.915067005417185  LUMO = 1.11873244111204
  mo_energy =
[ -0.91506701   1.11873244   8.27371822  47.79121281 174.0707208 ]
E1 = -3.881440143860641  E_coul = 1.0256530663910295
Extra cycle  E= -2.85578707746961  delta_E= 8.88e-16  |g|= 2.08e-10  |ddm|= 1.08e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [55.35246357 31.8405217   5.69424331  1.21666728  0.28911535]
grad_E = [-3.71639222e-05  8.66586639e-05  7.70635091e-05  1.33883633e-03
 -1.28667086e-02]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:30 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  62.0406675931        1
[INPUT] 0    0    [1    /1   ]  32.0101668516        1
[INPUT] 0    0    [1    /1   ]  5.74423971699        1
[INPUT] 0    0    [1    /1   ]  1.21213997568        1
[INPUT] 0    0    [1    /1   ]  0.284316960666       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [62.04066759313365, 1.0]], [0, [32.01016685161904, 1.0]], [0, [5.744239716987967, 1.0]], [0, [1.212139975676797, 1.0]], [0, [0.2843169606663346, 1.0]]]}
ecp = {}
CPU time:       161.16
Set gradient conv threshold to 3.16228e-05
cond(S) = 63.802573197660365
E1 = -3.8783396563858927  E_coul = 1.0235912786116927
init E= -2.8547483777742
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916165510378309  LUMO = 1.10047574493399
  mo_energy =
[ -0.91616551   1.10047574   8.29502592  49.00613553 184.62136123]
E1 = -3.8805452310477206  E_coul = 1.0246155866717896
cycle= 1 E= -2.85592964437593  delta_E= -0.00118  |g|= 0.0034  |ddm|= 0.0105
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.915657351474741  LUMO = 1.10133847686837
  mo_energy =
[ -0.91565735   1.10133848   8.29613363  49.00482958 184.61846855]
E1 = -3.880641232676843  E_coul = 1.0247108797221347
cycle= 2 E= -2.85593035295471  delta_E= -7.09e-07  |g|= 0.00029  |ddm|= 0.00114
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.915606195321782  LUMO = 1.10137946504365
  mo_energy =
[ -0.9156062    1.10137947   8.29625879  49.00482773 184.61837145]
E1 = -3.8806691219606337  E_coul = 1.0247387610656276
cycle= 3 E= -2.85593036089501  delta_E= -7.94e-09  |g|= 1.22e-05  |ddm|= 0.000156
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.91559454186025  LUMO = 1.10138608110473
  mo_energy =
[ -0.91559454   1.10138608   8.29628775  49.00487295 184.61842271]
E1 = -3.880671668482309  E_coul = 1.0247413075622442
cycle= 4 E= -2.85593036092006  delta_E= -2.51e-11  |g|= 1.13e-07  |ddm|= 1e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.880671668482309  E_coul = 1.0247413075622442
  HOMO = -0.915594526678915  LUMO = 1.10138608328313
  mo_energy =
[ -0.91559453   1.10138608   8.29628779  49.00487309 184.61842288]
E1 = -3.8806716647110977  E_coul = 1.0247413037910322
Extra cycle  E= -2.85593036092007  delta_E= -4.44e-16  |g|= 9.14e-09  |ddm|= 3.94e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [62.04066759 32.01016685  5.74423972  1.21213998  0.28431696]
E = -2.8559303609200652
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:31 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  62.0406675931        1
[INPUT] 0    0    [1    /1   ]  32.0101668516        1
[INPUT] 0    0    [1    /1   ]  5.74423971699        1
[INPUT] 0    0    [1    /1   ]  1.21213997568        1
[INPUT] 0    0    [1    /1   ]  0.284316960666       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [62.04066759313365, 1.0]], [0, [32.01016685161904, 1.0]], [0, [5.744239716987967, 1.0]], [0, [1.212139975676797, 1.0]], [0, [0.2843169606663346, 1.0]]]}
ecp = {}
CPU time:       161.92
Set gradient conv threshold to 3.16228e-05
cond(S) = 63.802573197660365
E1 = -3.8783396563858927  E_coul = 1.0235912786116927
init E= -2.8547483777742
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916165510378309  LUMO = 1.10047574493399
  mo_energy =
[ -0.91616551   1.10047574   8.29502592  49.00613553 184.62136123]
E1 = -3.8805452310477206  E_coul = 1.0246155866717896
cycle= 1 E= -2.85592964437593  delta_E= -0.00118  |g|= 0.0034  |ddm|= 0.0105
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.915657351474741  LUMO = 1.10133847686837
  mo_energy =
[ -0.91565735   1.10133848   8.29613363  49.00482958 184.61846855]
E1 = -3.880641232676843  E_coul = 1.0247108797221347
cycle= 2 E= -2.85593035295471  delta_E= -7.09e-07  |g|= 0.00029  |ddm|= 0.00114
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.915606195321782  LUMO = 1.10137946504365
  mo_energy =
[ -0.9156062    1.10137947   8.29625879  49.00482773 184.61837145]
E1 = -3.8806691219606337  E_coul = 1.0247387610656276
cycle= 3 E= -2.85593036089501  delta_E= -7.94e-09  |g|= 1.22e-05  |ddm|= 0.000156
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.91559454186025  LUMO = 1.10138608110473
  mo_energy =
[ -0.91559454   1.10138608   8.29628775  49.00487295 184.61842271]
E1 = -3.880671668482309  E_coul = 1.0247413075622442
cycle= 4 E= -2.85593036092006  delta_E= -2.51e-11  |g|= 1.13e-07  |ddm|= 1e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.880671668482309  E_coul = 1.0247413075622442
  HOMO = -0.915594526678915  LUMO = 1.10138608328313
  mo_energy =
[ -0.91559453   1.10138608   8.29628779  49.00487309 184.61842288]
E1 = -3.8806716647110977  E_coul = 1.0247413037910322
Extra cycle  E= -2.85593036092007  delta_E= -4.44e-16  |g|= 9.14e-09  |ddm|= 3.94e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 63.802573197660365
E1 = -3.8806716647110977  E_coul = 1.0247413037910322
init E= -2.85593036092007
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.915594528564515  LUMO = 1.10138608185103
  mo_energy =
[ -0.91559453   1.10138608   8.29628779  49.00487309 184.61842288]
E1 = -3.8806716638491126  E_coul = 1.0247413029290475
cycle= 1 E= -2.85593036092007  delta_E=    0  |g|= 9.87e-10  |ddm|= 4.73e-09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8806716638491126  E_coul = 1.0247413029290475
  HOMO = -0.915594528995506  LUMO = 1.10138608158243
  mo_energy =
[ -0.91559453   1.10138608   8.29628779  49.00487309 184.61842288]
E1 = -3.880671663722754  E_coul = 1.0247413028026886
Extra cycle  E= -2.85593036092007  delta_E=    0  |g|= 1.16e-10  |ddm|= 5.87e-10
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [62.04066759 32.01016685  5.74423972  1.21213998  0.28431696]
grad_E = [-3.55637175e-05  1.00677822e-04  1.81518908e-04  2.37087376e-03
 -2.32229605e-02]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:33 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  79.6831735962        1
[INPUT] 0    0    [1    /1   ]  30.341194221         1
[INPUT] 0    0    [1    /1   ]  5.69486342845        1
[INPUT] 0    0    [1    /1   ]  1.1793886947         1
[INPUT] 0    0    [1    /1   ]  0.270303430688       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [79.68317359624588, 1.0]], [0, [30.3411942210387, 1.0]], [0, [5.694863428453763, 1.0]], [0, [1.179388694703411, 1.0]], [0, [0.2703034306880779, 1.0]]]}
ecp = {}
CPU time:       164.35
Set gradient conv threshold to 3.16228e-05
cond(S) = 35.058564625909
E1 = -3.878898758672099  E_coul = 1.0234887081347799
init E= -2.85541005053732
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916436654253235  LUMO = 1.04033943544721
  mo_energy =
[ -0.91643665   1.04033944   8.12072898  49.1765606  205.12812846]
E1 = -3.879269500827079  E_coul = 1.02290473973176
cycle= 1 E= -2.85636476109532  delta_E= -0.000955  |g|= 0.00203  |ddm|= 0.00408
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.916730079105091  LUMO = 1.04060744675587
  mo_energy =
[ -0.91673008   1.04060745   8.11990151  49.17299435 205.12291662]
E1 = -3.8791637970298036  E_coul = 1.0227988922231839
cycle= 2 E= -2.85636490480662  delta_E= -1.44e-07  |g|= 8.88e-05  |ddm|= 0.000242
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916785531383782  LUMO = 1.04058376931667
  mo_energy =
[ -0.91678553   1.04058377   8.11976361  49.1726572  205.12246981]
E1 = -3.8791617339392452  E_coul = 1.022796828695458
cycle= 3 E= -2.85636490524379  delta_E= -4.37e-10  |g|= 2.82e-06  |ddm|= 2.16e-05
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
E1 = -3.8791617339392452  E_coul = 1.022796828695458
  HOMO = -0.916784038274622  LUMO = 1.04058464719665
  mo_energy =
[ -0.91678404   1.04058465   8.11976728  49.17266226 205.12247539]
E1 = -3.8791621348956196  E_coul = 1.0227972296507921
Extra cycle  E= -2.85636490524483  delta_E= -1.04e-12  |g|= 3.42e-07  |ddm|= 1.77e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [79.6831736  30.34119422  5.69486343  1.17938869  0.27030343]
E = -2.8563649052448277
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:34 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  79.6831735962        1
[INPUT] 0    0    [1    /1   ]  30.341194221         1
[INPUT] 0    0    [1    /1   ]  5.69486342845        1
[INPUT] 0    0    [1    /1   ]  1.1793886947         1
[INPUT] 0    0    [1    /1   ]  0.270303430688       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [79.68317359624588, 1.0]], [0, [30.3411942210387, 1.0]], [0, [5.694863428453763, 1.0]], [0, [1.179388694703411, 1.0]], [0, [0.2703034306880779, 1.0]]]}
ecp = {}
CPU time:       165.11
Set gradient conv threshold to 3.16228e-05
cond(S) = 35.058564625909
E1 = -3.878898758672099  E_coul = 1.0234887081347799
init E= -2.85541005053732
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916436654253235  LUMO = 1.04033943544721
  mo_energy =
[ -0.91643665   1.04033944   8.12072898  49.1765606  205.12812846]
E1 = -3.879269500827079  E_coul = 1.02290473973176
cycle= 1 E= -2.85636476109532  delta_E= -0.000955  |g|= 0.00203  |ddm|= 0.00408
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.916730079105091  LUMO = 1.04060744675587
  mo_energy =
[ -0.91673008   1.04060745   8.11990151  49.17299435 205.12291662]
E1 = -3.8791637970298036  E_coul = 1.0227988922231839
cycle= 2 E= -2.85636490480662  delta_E= -1.44e-07  |g|= 8.88e-05  |ddm|= 0.000242
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916785531383782  LUMO = 1.04058376931667
  mo_energy =
[ -0.91678553   1.04058377   8.11976361  49.1726572  205.12246981]
E1 = -3.8791617339392452  E_coul = 1.022796828695458
cycle= 3 E= -2.85636490524379  delta_E= -4.37e-10  |g|= 2.82e-06  |ddm|= 2.16e-05
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
E1 = -3.8791617339392452  E_coul = 1.022796828695458
  HOMO = -0.916784038274622  LUMO = 1.04058464719665
  mo_energy =
[ -0.91678404   1.04058465   8.11976728  49.17266226 205.12247539]
E1 = -3.8791621348956196  E_coul = 1.0227972296507921
Extra cycle  E= -2.85636490524483  delta_E= -1.04e-12  |g|= 3.42e-07  |ddm|= 1.77e-06
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 35.058564625909
E1 = -3.8791621348956196  E_coul = 1.0227972296507921
init E= -2.85636490524483
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.916783837797024  LUMO = 1.04058476209305
  mo_energy =
[ -0.91678384   1.04058476   8.11976778  49.17266295 205.12247614]
E1 = -3.8791621868444137  E_coul = 1.0227972815995696
cycle= 1 E= -2.85636490524484  delta_E= -1.64e-14  |g|= 4.26e-08  |ddm|= 2.22e-07
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8791621868444137  E_coul = 1.0227972815995696
  HOMO = -0.916783811822633  LUMO = 1.04058477685962
  mo_energy =
[ -0.91678381   1.04058478   8.11976784  49.17266304 205.12247624]
E1 = -3.879162193455294  E_coul = 1.0227972882104484
Extra cycle  E= -2.85636490524485  delta_E= -1.33e-15  |g|= 5.33e-09  |ddm|= 2.79e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [79.6831736  30.34119422  5.69486343  1.17938869  0.27030343]
grad_E = [-3.17021179e-05  1.21999928e-04  6.07351655e-04  4.32177110e-03
 -4.66712054e-02]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:37 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  115.246617773        1
[INPUT] 0    0    [1    /1   ]  23.5411310582        1
[INPUT] 0    0    [1    /1   ]  5.13086033718        1
[INPUT] 0    0    [1    /1   ]  1.05789951296        1
[INPUT] 0    0    [1    /1   ]  0.237666996071       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [115.2466177732405, 1.0]], [0, [23.541131058241138, 1.0]], [0, [5.130860337179451, 1.0]], [0, [1.0578995129621012, 1.0]], [0, [0.23766699607063518, 1.0]]]}
ecp = {}
CPU time:       167.55
Set gradient conv threshold to 3.16228e-05
cond(S) = 24.092375365962234
E1 = -3.879682927352945  E_coul = 1.0233773724093362
init E= -2.85630555494361
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916841605744116  LUMO = 0.880275879955099
  mo_energy =
[ -0.91684161   0.88027588   7.16839568  41.81934622 230.0262719 ]
E1 = -3.878215441537196  E_coul = 1.0211515770918056
cycle= 1 E= -2.85706386444539  delta_E= -0.000758  |g|= 0.00122  |ddm|= 0.00781
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.917956336455939  LUMO = 0.880085313452965
  mo_energy =
[ -0.91795634   0.88008531   7.16574228  41.81411092 230.01954357]
E1 = -3.877852785072242  E_coul = 1.020788487738056
cycle= 2 E= -2.85706429733419  delta_E= -4.33e-07  |g|= 0.000184  |ddm|= 0.00115
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.918151828501712  LUMO = 0.879994392022509
  mo_energy =
[ -0.91815183   0.87999439   7.1652858   41.81335096 230.01863222]
E1 = -3.877809762518186  E_coul = 1.020745458017041
cycle= 3 E= -2.85706430450115  delta_E= -7.17e-09  |g|= 1.53e-05  |ddm|= 0.000163
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.918160739967447  LUMO = 0.879989804725277
  mo_energy =
[ -0.91816074   0.8799898    7.16526476  41.81332326 230.01860324]
E1 = -3.87780706699428  E_coul = 1.0207427624572645
cycle= 4 E= -2.85706430453702  delta_E= -3.59e-11  |g|= 1.22e-07  |ddm|= 1.21e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.87780706699428  E_coul = 1.0207427624572645
  HOMO = -0.918160771039877  LUMO = 0.879989786041486
  mo_energy =
[ -0.91816077   0.87998979   7.16526469  41.8133232  230.01860321]
E1 = -3.877807052799252  E_coul = 1.0207427482622347
Extra cycle  E= -2.85706430453702  delta_E= -1.78e-15  |g|= 1.5e-08  |ddm|= 7.46e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [115.24661777  23.54113106   5.13086034   1.05789951   0.237667  ]
E = -2.857064304537017
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:37 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  115.246617773        1
[INPUT] 0    0    [1    /1   ]  23.5411310582        1
[INPUT] 0    0    [1    /1   ]  5.13086033718        1
[INPUT] 0    0    [1    /1   ]  1.05789951296        1
[INPUT] 0    0    [1    /1   ]  0.237666996071       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [115.2466177732405, 1.0]], [0, [23.541131058241138, 1.0]], [0, [5.130860337179451, 1.0]], [0, [1.0578995129621012, 1.0]], [0, [0.23766699607063518, 1.0]]]}
ecp = {}
CPU time:       168.34
Set gradient conv threshold to 3.16228e-05
cond(S) = 24.092375365962234
E1 = -3.879682927352945  E_coul = 1.0233773724093362
init E= -2.85630555494361
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916841605744116  LUMO = 0.880275879955099
  mo_energy =
[ -0.91684161   0.88027588   7.16839568  41.81934622 230.0262719 ]
E1 = -3.878215441537196  E_coul = 1.0211515770918056
cycle= 1 E= -2.85706386444539  delta_E= -0.000758  |g|= 0.00122  |ddm|= 0.00781
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.917956336455939  LUMO = 0.880085313452965
  mo_energy =
[ -0.91795634   0.88008531   7.16574228  41.81411092 230.01954357]
E1 = -3.877852785072242  E_coul = 1.020788487738056
cycle= 2 E= -2.85706429733419  delta_E= -4.33e-07  |g|= 0.000184  |ddm|= 0.00115
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.918151828501712  LUMO = 0.879994392022509
  mo_energy =
[ -0.91815183   0.87999439   7.1652858   41.81335096 230.01863222]
E1 = -3.877809762518186  E_coul = 1.020745458017041
cycle= 3 E= -2.85706430450115  delta_E= -7.17e-09  |g|= 1.53e-05  |ddm|= 0.000163
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.918160739967447  LUMO = 0.879989804725277
  mo_energy =
[ -0.91816074   0.8799898    7.16526476  41.81332326 230.01860324]
E1 = -3.87780706699428  E_coul = 1.0207427624572645
cycle= 4 E= -2.85706430453702  delta_E= -3.59e-11  |g|= 1.22e-07  |ddm|= 1.21e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.87780706699428  E_coul = 1.0207427624572645
  HOMO = -0.918160771039877  LUMO = 0.879989786041486
  mo_energy =
[ -0.91816077   0.87998979   7.16526469  41.8133232  230.01860321]
E1 = -3.877807052799252  E_coul = 1.0207427482622347
Extra cycle  E= -2.85706430453702  delta_E= -1.78e-15  |g|= 1.5e-08  |ddm|= 7.46e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 24.092375365962234
E1 = -3.877807052799252  E_coul = 1.0207427482622347
init E= -2.85706430453702
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.918160778137401  LUMO = 0.879989782324253
  mo_energy =
[ -0.91816078   0.87998978   7.16526467  41.81332318 230.01860318]
E1 = -3.8778070505653472  E_coul = 1.0207427460283283
cycle= 1 E= -2.85706430453702  delta_E= -1.78e-15  |g|= 2e-09  |ddm|= 1.03e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8778070505653472  E_coul = 1.0207427460283283
  HOMO = -0.918160779254347  LUMO = 0.87998978175901
  mo_energy =
[ -0.91816078   0.87998978   7.16526467  41.81332318 230.01860318]
E1 = -3.8778070502441375  E_coul = 1.0207427457071174
Extra cycle  E= -2.85706430453702  delta_E= -8.88e-16  |g|= 2.71e-10  |ddm|= 1.41e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [115.24661777  23.54113106   5.13086034   1.05789951   0.237667  ]
grad_E = [-1.02195725e-05 -6.18072270e-06  2.37252002e-03  4.07568633e-03
 -7.67355118e-02]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:40 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  133.631205821        1
[INPUT] 0    0    [1    /1   ]  22.0638543496        1
[INPUT] 0    0    [1    /1   ]  4.43168462784        1
[INPUT] 0    0    [1    /1   ]  0.970133148613       1
[INPUT] 0    0    [1    /1   ]  0.228401535371       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [133.63120582145905, 1.0]], [0, [22.063854349613678, 1.0]], [0, [4.4316846278419915, 1.0]], [0, [0.9701331486126336, 1.0]], [0, [0.22840153537117644, 1.0]]]}
ecp = {}
CPU time:       170.79
Set gradient conv threshold to 3.16228e-05
cond(S) = 22.901822550010298
E1 = -3.8812999150899605  E_coul = 1.0235332155526167
init E= -2.85776669953734
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91739910215567  LUMO = 0.814328194422787
  mo_energy =
[ -0.9173991    0.81432819   6.31451687  38.00039722 246.43558051]
E1 = -3.880638043846975  E_coul = 1.0223046833570455
cycle= 1 E= -2.85833336048993  delta_E= -0.000567  |g|= 0.00144  |ddm|= 0.00601
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.918014421846818  LUMO = 0.81427279129388
  mo_energy =
[ -0.91801442   0.81427279   6.31321046  37.99721941 246.43076214]
E1 = -3.880417532069623  E_coul = 1.0220839851320331
cycle= 2 E= -2.85833354693759  delta_E= -1.86e-07  |g|= 0.00012  |ddm|= 0.000765
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.918125703684999  LUMO = 0.814224597741052
  mo_energy =
[ -0.9181257    0.8142246    6.3129692   37.99679258 246.43022137]
E1 = -3.8803917825476306  E_coul = 1.0220582324552416
cycle= 3 E= -2.85833355009239  delta_E= -3.15e-09  |g|= 1.77e-05  |ddm|= 0.000106
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.918139528630313  LUMO = 0.814218358589582
  mo_energy =
[ -0.91813953   0.81421836   6.31293881  37.99674493 246.43016613]
E1 = -3.880388012493119  E_coul = 1.0220544623395202
cycle= 4 E= -2.8583335501536  delta_E= -6.12e-11  |g|= 1.19e-07  |ddm|= 1.67e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.880388012493119  E_coul = 1.0220544623395202
  HOMO = -0.918139543907035  LUMO = 0.814218346665079
  mo_energy =
[ -0.91813954   0.81421835   6.31293877  37.99674493 246.43016615]
E1 = -3.880388001156268  E_coul = 1.0220544510026683
Extra cycle  E= -2.8583335501536  delta_E= -8.88e-16  |g|= 1.42e-08  |ddm|= 7.22e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [133.63120582  22.06385435   4.43168463   0.97013315   0.22840154]
E = -2.8583335501535996
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:41 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  133.631205821        1
[INPUT] 0    0    [1    /1   ]  22.0638543496        1
[INPUT] 0    0    [1    /1   ]  4.43168462784        1
[INPUT] 0    0    [1    /1   ]  0.970133148613       1
[INPUT] 0    0    [1    /1   ]  0.228401535371       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [133.63120582145905, 1.0]], [0, [22.063854349613678, 1.0]], [0, [4.4316846278419915, 1.0]], [0, [0.9701331486126336, 1.0]], [0, [0.22840153537117644, 1.0]]]}
ecp = {}
CPU time:       171.58
Set gradient conv threshold to 3.16228e-05
cond(S) = 22.901822550010298
E1 = -3.8812999150899605  E_coul = 1.0235332155526167
init E= -2.85776669953734
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.91739910215567  LUMO = 0.814328194422787
  mo_energy =
[ -0.9173991    0.81432819   6.31451687  38.00039722 246.43558051]
E1 = -3.880638043846975  E_coul = 1.0223046833570455
cycle= 1 E= -2.85833336048993  delta_E= -0.000567  |g|= 0.00144  |ddm|= 0.00601
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.918014421846818  LUMO = 0.81427279129388
  mo_energy =
[ -0.91801442   0.81427279   6.31321046  37.99721941 246.43076214]
E1 = -3.880417532069623  E_coul = 1.0220839851320331
cycle= 2 E= -2.85833354693759  delta_E= -1.86e-07  |g|= 0.00012  |ddm|= 0.000765
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.918125703684999  LUMO = 0.814224597741052
  mo_energy =
[ -0.9181257    0.8142246    6.3129692   37.99679258 246.43022137]
E1 = -3.8803917825476306  E_coul = 1.0220582324552416
cycle= 3 E= -2.85833355009239  delta_E= -3.15e-09  |g|= 1.77e-05  |ddm|= 0.000106
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.918139528630313  LUMO = 0.814218358589582
  mo_energy =
[ -0.91813953   0.81421836   6.31293881  37.99674493 246.43016613]
E1 = -3.880388012493119  E_coul = 1.0220544623395202
cycle= 4 E= -2.8583335501536  delta_E= -6.12e-11  |g|= 1.19e-07  |ddm|= 1.67e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.880388012493119  E_coul = 1.0220544623395202
  HOMO = -0.918139543907035  LUMO = 0.814218346665079
  mo_energy =
[ -0.91813954   0.81421835   6.31293877  37.99674493 246.43016615]
E1 = -3.880388001156268  E_coul = 1.0220544510026683
Extra cycle  E= -2.8583335501536  delta_E= -8.88e-16  |g|= 1.42e-08  |ddm|= 7.22e-08
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 22.901822550010298
E1 = -3.880388001156268  E_coul = 1.0220544510026683
init E= -2.8583335501536
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.918139549575471  LUMO = 0.81421834379083
  mo_energy =
[ -0.91813955   0.81421834   6.31293876  37.99674492 246.43016613]
E1 = -3.8803879991109014  E_coul = 1.022054448957302
cycle= 1 E= -2.8583335501536  delta_E= 4.44e-16  |g|= 1.99e-09  |ddm|= 1.04e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8803879991109014  E_coul = 1.022054448957302
  HOMO = -0.918139550598146  LUMO = 0.814218343305202
  mo_energy =
[ -0.91813955   0.81421834   6.31293875  37.99674492 246.43016613]
E1 = -3.880387998790682  E_coul = 1.0220544486370828
Extra cycle  E= -2.8583335501536  delta_E=    0  |g|= 2.87e-10  |ddm|= 1.52e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [133.63120582  22.06385435   4.43168463   0.97013315   0.22840154]
grad_E = [-5.32155103e-06  7.00373297e-05  1.14864613e-03  6.17429258e-03
 -6.25436190e-02]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:43 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  182.144726333        1
[INPUT] 0    0    [1    /1   ]  7.09155455502        1
[INPUT] 0    0    [1    /1   ]  1.46822423922        1
[INPUT] 0    0    [1    /1   ]  0.531807408912       1
[INPUT] 0    0    [1    /1   ]  0.169446387903       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [182.14472633328174, 1.0]], [0, [7.091554555018709, 1.0]], [0, [1.468224239219849, 1.0]], [0, [0.5318074089118817, 1.0]], [0, [0.169446387902967, 1.0]]]}
ecp = {}
CPU time:       174.09
Set gradient conv threshold to 3.16228e-05
cond(S) = 59.68119542314556
E1 = -3.853452474183118  E_coul = 1.0226601382834315
init E= -2.83079233589969
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.909242003430839  LUMO = 0.464967292136436
  mo_energy =
[ -0.909242     0.46496729   2.6108445   11.87090884 252.50481793]
E1 = -3.859050255106789  E_coul = 1.017811442255875
cycle= 1 E= -2.84123881285091  delta_E= -0.0104  |g|= 0.0151  |ddm|= 0.0272
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.911715043745296  LUMO = 0.464609829386765
  mo_energy =
[ -0.91171504   0.46460983   2.60894993  11.86353271 252.47506536]
E1 = -3.858972484062524  E_coul = 1.017730789146056
cycle= 2 E= -2.84124169491647  delta_E= -2.88e-06  |g|= 0.000501  |ddm|= 0.00259
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.911756095936921  LUMO = 0.46459113268669
  mo_energy =
[ -0.9117561    0.46459113   2.60891741  11.86340431 252.47427652]
E1 = -3.8589790950854477  E_coul = 1.0177373862743018
cycle= 3 E= -2.84124170881115  delta_E= -1.39e-08  |g|= 3.1e-05  |ddm|= 0.000262
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911752029450003  LUMO = 0.464590589498371
  mo_energy =
[ -0.91175203   0.46459059   2.60891986  11.86341734 252.47428299]
E1 = -3.8589794315614103  E_coul = 1.0177377226514133
cycle= 4 E= -2.84124170891  delta_E= -9.89e-11  |g|= 2.22e-06  |ddm|= 2.8e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8589794315614103  E_coul = 1.0177377226514133
  HOMO = -0.911751993129787  LUMO = 0.464590483677055
  mo_energy =
[ -0.91175199   0.46459048   2.6089196   11.86341778 252.4742843 ]
E1 = -3.8589792694779836  E_coul = 1.0177375605668257
Extra cycle  E= -2.84124170891116  delta_E= -1.16e-12  |g|= 3.75e-07  |ddm|= 2.99e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [1.82144726e+02 7.09155456e+00 1.46822424e+00 5.31807409e-01
 1.69446388e-01]
E = -2.841241708911158
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:44 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  138.482557873        1
[INPUT] 0    0    [1    /1   ]  20.5666243702        1
[INPUT] 0    0    [1    /1   ]  4.13533858898        1
[INPUT] 0    0    [1    /1   ]  0.926300574643       1
[INPUT] 0    0    [1    /1   ]  0.222506020624       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [138.4825578726413, 1.0]], [0, [20.56662437015418, 1.0]], [0, [4.135338588979777, 1.0]], [0, [0.9263005746425583, 1.0]], [0, [0.22250602062435548, 1.0]]]}
ecp = {}
CPU time:       174.91
Set gradient conv threshold to 3.16228e-05
cond(S) = 23.291776718362023
E1 = -3.881762794015921  E_coul = 1.0235708526110654
init E= -2.85819194140486
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.917548423711332  LUMO = 0.777664656204764
  mo_energy =
[ -0.91754842   0.77766466   5.92430608  35.36243011 246.79498144]
E1 = -3.88132326720037  E_coul = 1.0226541817445305
cycle= 1 E= -2.85866908545584  delta_E= -0.000477  |g|= 0.00134  |ddm|= 0.00442
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.918007496686158  LUMO = 0.777659204971657
  mo_energy =
[ -0.9180075    0.7776592    5.92340079  35.35986443 246.79067876]
E1 = -3.8811659369559055  E_coul = 1.0224967528232498
cycle= 2 E= -2.85866918413266  delta_E= -9.87e-08  |g|= 7.83e-05  |ddm|= 0.000516
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.918087466522266  LUMO = 0.777626725695093
  mo_energy =
[ -0.91808747   0.77762673   5.92323498  35.35955061 246.79025904]
E1 = -3.8811483612095308  E_coul = 1.0224791756891691
cycle= 3 E= -2.85866918552036  delta_E= -1.39e-09  |g|= 1.12e-05  |ddm|= 7.17e-05
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.918096192151156  LUMO = 0.777622976473472
  mo_energy =
[ -0.91809619   0.77762298   5.92321644  35.35952088 246.79022404]
E1 = -3.8811459324408126  E_coul = 1.02247674689464
cycle= 4 E= -2.85866918554617  delta_E= -2.58e-11  |g|= 1.24e-07  |ddm|= 1.11e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8811459324408126  E_coul = 1.02247674689464
  HOMO = -0.918096219325753  LUMO = 0.777622960205708
  mo_energy =
[ -0.91809622   0.77762296   5.92321638  35.35952083 246.790224  ]
E1 = -3.8811459182226775  E_coul = 1.022476732676503
Extra cycle  E= -2.85866918554617  delta_E= -2.22e-15  |g|= 1.64e-08  |ddm|= 8.63e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [138.48255787  20.56662437   4.13533859   0.92630057   0.22250602]
E = -2.8586691855461748
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:45 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  138.482557873        1
[INPUT] 0    0    [1    /1   ]  20.5666243702        1
[INPUT] 0    0    [1    /1   ]  4.13533858898        1
[INPUT] 0    0    [1    /1   ]  0.926300574643       1
[INPUT] 0    0    [1    /1   ]  0.222506020624       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [138.4825578726413, 1.0]], [0, [20.56662437015418, 1.0]], [0, [4.135338588979777, 1.0]], [0, [0.9263005746425583, 1.0]], [0, [0.22250602062435548, 1.0]]]}
ecp = {}
CPU time:       175.71
Set gradient conv threshold to 3.16228e-05
cond(S) = 23.291776718362023
E1 = -3.881762794015921  E_coul = 1.0235708526110654
init E= -2.85819194140486
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.917548423711332  LUMO = 0.777664656204764
  mo_energy =
[ -0.91754842   0.77766466   5.92430608  35.36243011 246.79498144]
E1 = -3.88132326720037  E_coul = 1.0226541817445305
cycle= 1 E= -2.85866908545584  delta_E= -0.000477  |g|= 0.00134  |ddm|= 0.00442
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.918007496686158  LUMO = 0.777659204971657
  mo_energy =
[ -0.9180075    0.7776592    5.92340079  35.35986443 246.79067876]
E1 = -3.8811659369559055  E_coul = 1.0224967528232498
cycle= 2 E= -2.85866918413266  delta_E= -9.87e-08  |g|= 7.83e-05  |ddm|= 0.000516
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.918087466522266  LUMO = 0.777626725695093
  mo_energy =
[ -0.91808747   0.77762673   5.92323498  35.35955061 246.79025904]
E1 = -3.8811483612095308  E_coul = 1.0224791756891691
cycle= 3 E= -2.85866918552036  delta_E= -1.39e-09  |g|= 1.12e-05  |ddm|= 7.17e-05
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.918096192151156  LUMO = 0.777622976473472
  mo_energy =
[ -0.91809619   0.77762298   5.92321644  35.35952088 246.79022404]
E1 = -3.8811459324408126  E_coul = 1.02247674689464
cycle= 4 E= -2.85866918554617  delta_E= -2.58e-11  |g|= 1.24e-07  |ddm|= 1.11e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8811459324408126  E_coul = 1.02247674689464
  HOMO = -0.918096219325753  LUMO = 0.777622960205708
  mo_energy =
[ -0.91809622   0.77762296   5.92321638  35.35952083 246.790224  ]
E1 = -3.8811459182226775  E_coul = 1.022476732676503
Extra cycle  E= -2.85866918554617  delta_E= -2.22e-15  |g|= 1.64e-08  |ddm|= 8.63e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 23.291776718362023
E1 = -3.8811459182226775  E_coul = 1.022476732676503
init E= -2.85866918554617
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.918096226434836  LUMO = 0.777622956831978
  mo_energy =
[ -0.91809623   0.77762296   5.92321636  35.35952081 246.79022398]
E1 = -3.8811459157205084  E_coul = 1.0224767301743336
cycle= 1 E= -2.85866918554617  delta_E=    0  |g|= 2.41e-09  |ddm|= 1.29e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8811459157205084  E_coul = 1.0224767301743336
  HOMO = -0.918096227685922  LUMO = 0.777622956266526
  mo_energy =
[ -0.91809623   0.77762296   5.92321636  35.35952081 246.79022398]
E1 = -3.8811459153224694  E_coul = 1.0224767297762951
Extra cycle  E= -2.85866918554617  delta_E= 4.44e-16  |g|= 3.61e-10  |ddm|= 1.94e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.08 sec
exp = [138.48255787  20.56662437   4.13533859   0.92630057   0.22250602]
grad_E = [-1.16786158e-06  4.99583903e-05  9.71146662e-04  5.87880965e-03
 -5.65187232e-02]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:47 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  135.307039939        1
[INPUT] 0    0    [1    /1   ]  15.6031784229        1
[INPUT] 0    0    [1    /1   ]  2.95094004287        1
[INPUT] 0    0    [1    /1   ]  0.764478358974       1
[INPUT] 0    0    [1    /1   ]  0.213911737602       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [135.30703993916308, 1.0]], [0, [15.603178422907645, 1.0]], [0, [2.9509400428735675, 1.0]], [0, [0.7644783589738816, 1.0]], [0, [0.21391173760229312, 1.0]]]}
ecp = {}
CPU time:       178.24
Set gradient conv threshold to 3.16228e-05
cond(S) = 29.501804075596556
E1 = -3.8823128478659648  E_coul = 1.023590146347374
init E= -2.85872270151859
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.917736680993541  LUMO = 0.683188493251311
  mo_energy =
[ -0.91773668   0.68318849   4.49366787  25.8834193  222.40522011]
E1 = -3.883199035779634  E_coul = 1.0241278487499461
cycle= 1 E= -2.85907118702969  delta_E= -0.000348  |g|= 0.00376  |ddm|= 0.00703
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.917471977074163  LUMO = 0.683372503456398
  mo_energy =
[ -0.91747198   0.6833725    4.49441047  25.8828429  222.401214  ]
E1 = -3.8834302602036526  E_coul = 1.0243583778379097
cycle= 2 E= -2.85907188236574  delta_E= -6.95e-07  |g|= 0.000294  |ddm|= 0.00133
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.917348563364019  LUMO = 0.683419246445764
  mo_energy =
[ -0.91734856   0.68341925   4.49464421  25.88316897 222.40146305]
E1 = -3.883477305827778  E_coul = 1.024405408669463
cycle= 3 E= -2.85907189715831  delta_E= -1.48e-08  |g|= 2.7e-05  |ddm|= 0.000261
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.917330534122489  LUMO = 0.683426020149239
  mo_energy =
[ -0.91733053   0.68342602   4.49467685  25.88322503 222.40153265]
E1 = -3.8834830295179392  E_coul = 1.0244111321840486
cycle= 4 E= -2.85907189733389  delta_E= -1.76e-10  |g|= 4.81e-07  |ddm|= 3.25e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8834830295179392  E_coul = 1.0244111321840486
  HOMO = -0.917330382574934  LUMO = 0.683426088457505
  mo_energy =
[ -0.91733038   0.68342609   4.49467715  25.88322539 222.40153297]
E1 = -3.883483098066195  E_coul = 1.0244112007322563
Extra cycle  E= -2.85907189733394  delta_E= -4.8e-14  |g|= 7.76e-08  |ddm|= 4.54e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [135.30703994  15.60317842   2.95094004   0.76447836   0.21391174]
E = -2.859071897333939
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:48 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  135.307039939        1
[INPUT] 0    0    [1    /1   ]  15.6031784229        1
[INPUT] 0    0    [1    /1   ]  2.95094004287        1
[INPUT] 0    0    [1    /1   ]  0.764478358974       1
[INPUT] 0    0    [1    /1   ]  0.213911737602       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [135.30703993916308, 1.0]], [0, [15.603178422907645, 1.0]], [0, [2.9509400428735675, 1.0]], [0, [0.7644783589738816, 1.0]], [0, [0.21391173760229312, 1.0]]]}
ecp = {}
CPU time:       179.05
Set gradient conv threshold to 3.16228e-05
cond(S) = 29.501804075596556
E1 = -3.8823128478659648  E_coul = 1.023590146347374
init E= -2.85872270151859
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.917736680993541  LUMO = 0.683188493251311
  mo_energy =
[ -0.91773668   0.68318849   4.49366787  25.8834193  222.40522011]
E1 = -3.883199035779634  E_coul = 1.0241278487499461
cycle= 1 E= -2.85907118702969  delta_E= -0.000348  |g|= 0.00376  |ddm|= 0.00703
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.917471977074163  LUMO = 0.683372503456398
  mo_energy =
[ -0.91747198   0.6833725    4.49441047  25.8828429  222.401214  ]
E1 = -3.8834302602036526  E_coul = 1.0243583778379097
cycle= 2 E= -2.85907188236574  delta_E= -6.95e-07  |g|= 0.000294  |ddm|= 0.00133
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.917348563364019  LUMO = 0.683419246445764
  mo_energy =
[ -0.91734856   0.68341925   4.49464421  25.88316897 222.40146305]
E1 = -3.883477305827778  E_coul = 1.024405408669463
cycle= 3 E= -2.85907189715831  delta_E= -1.48e-08  |g|= 2.7e-05  |ddm|= 0.000261
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.917330534122489  LUMO = 0.683426020149239
  mo_energy =
[ -0.91733053   0.68342602   4.49467685  25.88322503 222.40153265]
E1 = -3.8834830295179392  E_coul = 1.0244111321840486
cycle= 4 E= -2.85907189733389  delta_E= -1.76e-10  |g|= 4.81e-07  |ddm|= 3.25e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8834830295179392  E_coul = 1.0244111321840486
  HOMO = -0.917330382574934  LUMO = 0.683426088457505
  mo_energy =
[ -0.91733038   0.68342609   4.49467715  25.88322539 222.40153297]
E1 = -3.883483098066195  E_coul = 1.0244112007322563
Extra cycle  E= -2.85907189733394  delta_E= -4.8e-14  |g|= 7.76e-08  |ddm|= 4.54e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 29.501804075596556
E1 = -3.883483098066195  E_coul = 1.0244112007322563
init E= -2.85907189733394
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.917330348300847  LUMO = 0.68342610215246
  mo_energy =
[ -0.91733035   0.6834261    4.49467721  25.88322549 222.40153308]
E1 = -3.8834831106629792  E_coul = 1.0244112133290406
cycle= 1 E= -2.85907189733394  delta_E=    0  |g|= 1.29e-08  |ddm|= 7.59e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8834831106629792  E_coul = 1.0244112133290406
  HOMO = -0.91733034200245  LUMO = 0.68342610459174
  mo_energy =
[ -0.91733034   0.6834261    4.49467723  25.8832255  222.4015331 ]
E1 = -3.8834831128483054  E_coul = 1.0244112155143663
Extra cycle  E= -2.85907189733394  delta_E=    0  |g|= 2.17e-09  |ddm|= 1.28e-08
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [135.30703994  15.60317842   2.95094004   0.76447836   0.21391174]
grad_E = [ 9.49066055e-06  3.13604007e-04 -3.72083467e-03  8.04133592e-03
 -2.03227354e-02]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:51 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  111.788749116        1
[INPUT] 0    0    [1    /1   ]  13.9835218077        1
[INPUT] 0    0    [1    /1   ]  3.42168369617        1
[INPUT] 0    0    [1    /1   ]  0.871283496078       1
[INPUT] 0    0    [1    /1   ]  0.240483403371       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [111.78874911647772, 1.0]], [0, [13.983521807724783, 1.0]], [0, [3.4216836961661725, 1.0]], [0, [0.8712834960777955, 1.0]], [0, [0.2404834033714805, 1.0]]]}
ecp = {}
CPU time:       181.51
Set gradient conv threshold to 3.16228e-05
cond(S) = 34.571001473492906
E1 = -3.881715501313938  E_coul = 1.023617960562016
init E= -2.85809754075192
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.917852270396321  LUMO = 0.80017990936223
  mo_energy =
[ -0.91785227   0.80017991   5.2573854   26.06691215 189.01928082]
E1 = -3.884579149724089  E_coul = 1.025223919498764
cycle= 1 E= -2.85935523022532  delta_E= -0.00126  |g|= 0.00669  |ddm|= 0.0341
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.91706740539042  LUMO = 0.800949799605481
  mo_energy =
[ -0.91706741   0.8009498    5.2592265   26.06780279 189.01912242]
E1 = -3.885033844599125  E_coul = 1.0256746234428016
cycle= 2 E= -2.85935922115632  delta_E= -3.99e-06  |g|= 0.000704  |ddm|= 0.00406
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916825413723012  LUMO = 0.801073972955018
  mo_energy =
[ -0.91682541   0.80107397   5.25972662  26.06840255 189.01973565]
E1 = -3.885134647332048  E_coul = 1.025775339390465
cycle= 3 E= -2.85935930794158  delta_E= -8.68e-08  |g|= 6.09e-05  |ddm|= 0.000646
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.916786567846521  LUMO = 0.801090671678285
  mo_energy =
[ -0.91678657   0.80109067   5.25980269  26.06851983 189.01987267]
E1 = -3.885146830735839  E_coul = 1.0257875220476318
cycle= 4 E= -2.85935930868821  delta_E= -7.47e-10  |g|= 1.34e-06  |ddm|= 6.54e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.885146830735839  E_coul = 1.0257875220476318
  HOMO = -0.91678589332034  LUMO = 0.801090837713135
  mo_energy =
[ -0.91678589   0.80109084   5.25980383  26.06852279 189.01987686]
E1 = -3.885146872645258  E_coul = 1.0257875639569418
Extra cycle  E= -2.85935930868832  delta_E= -1.09e-13  |g|= 1e-07  |ddm|= 5.07e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [111.78874912  13.98352181   3.4216837    0.8712835    0.2404834 ]
E = -2.8593593086883162
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:51 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  111.788749116        1
[INPUT] 0    0    [1    /1   ]  13.9835218077        1
[INPUT] 0    0    [1    /1   ]  3.42168369617        1
[INPUT] 0    0    [1    /1   ]  0.871283496078       1
[INPUT] 0    0    [1    /1   ]  0.240483403371       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [111.78874911647772, 1.0]], [0, [13.983521807724783, 1.0]], [0, [3.4216836961661725, 1.0]], [0, [0.8712834960777955, 1.0]], [0, [0.2404834033714805, 1.0]]]}
ecp = {}
CPU time:       182.33
Set gradient conv threshold to 3.16228e-05
cond(S) = 34.571001473492906
E1 = -3.881715501313938  E_coul = 1.023617960562016
init E= -2.85809754075192
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.917852270396321  LUMO = 0.80017990936223
  mo_energy =
[ -0.91785227   0.80017991   5.2573854   26.06691215 189.01928082]
E1 = -3.884579149724089  E_coul = 1.025223919498764
cycle= 1 E= -2.85935523022532  delta_E= -0.00126  |g|= 0.00669  |ddm|= 0.0341
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.91706740539042  LUMO = 0.800949799605481
  mo_energy =
[ -0.91706741   0.8009498    5.2592265   26.06780279 189.01912242]
E1 = -3.885033844599125  E_coul = 1.0256746234428016
cycle= 2 E= -2.85935922115632  delta_E= -3.99e-06  |g|= 0.000704  |ddm|= 0.00406
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916825413723012  LUMO = 0.801073972955018
  mo_energy =
[ -0.91682541   0.80107397   5.25972662  26.06840255 189.01973565]
E1 = -3.885134647332048  E_coul = 1.025775339390465
cycle= 3 E= -2.85935930794158  delta_E= -8.68e-08  |g|= 6.09e-05  |ddm|= 0.000646
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.916786567846521  LUMO = 0.801090671678285
  mo_energy =
[ -0.91678657   0.80109067   5.25980269  26.06851983 189.01987267]
E1 = -3.885146830735839  E_coul = 1.0257875220476318
cycle= 4 E= -2.85935930868821  delta_E= -7.47e-10  |g|= 1.34e-06  |ddm|= 6.54e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.885146830735839  E_coul = 1.0257875220476318
  HOMO = -0.91678589332034  LUMO = 0.801090837713135
  mo_energy =
[ -0.91678589   0.80109084   5.25980383  26.06852279 189.01987686]
E1 = -3.885146872645258  E_coul = 1.0257875639569418
Extra cycle  E= -2.85935930868832  delta_E= -1.09e-13  |g|= 1e-07  |ddm|= 5.07e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 34.571001473492906
E1 = -3.885146872645258  E_coul = 1.0257875639569418
init E= -2.85935930868832
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.916785872365679  LUMO = 0.801090839374448
  mo_energy =
[ -0.91678587   0.80109084   5.25980386  26.06852291 189.01987705]
E1 = -3.8851468687172552  E_coul = 1.0257875600289388
cycle= 1 E= -2.85935930868832  delta_E=    0  |g|= 1.13e-08  |ddm|= 6.18e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8851468687172552  E_coul = 1.0257875600289388
  HOMO = -0.916785874329684  LUMO = 0.80109083808936
  mo_energy =
[ -0.91678587   0.80109084   5.25980385  26.06852291 189.01987705]
E1 = -3.8851468674694294  E_coul = 1.0257875587811112
Extra cycle  E= -2.85935930868832  delta_E= -1.78e-15  |g|= 1.6e-09  |ddm|= 9.05e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [111.78874912  13.98352181   3.4216837    0.8712835    0.2404834 ]
grad_E = [ 2.39938910e-05 -5.59265089e-04  2.78562752e-03 -7.17005730e-03
  4.56320572e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:54 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  63.3654472859        1
[INPUT] 0    0    [1    /1   ]  25.2277078181        1
[INPUT] 0    0    [1    /1   ]  5.45691761787        1
[INPUT] 0    0    [1    /1   ]  1.25000070628        1
[INPUT] 0    0    [1    /1   ]  0.321949039355       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [63.36544728587677, 1.0]], [0, [25.22770781807855, 1.0]], [0, [5.45691761786898, 1.0]], [0, [1.2500007062847407, 1.0]], [0, [0.3219490393550203, 1.0]]]}
ecp = {}
CPU time:       184.80
Set gradient conv threshold to 3.16228e-05
cond(S) = 47.913169174812936
E1 = -3.8761174577109894  E_coul = 1.0237723340429241
init E= -2.85234512366807
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.916212814105763  LUMO = 1.23122370033675
  mo_energy =
[ -0.91621281   1.2312237    8.2770767   43.47028721 168.69918602]
E1 = -3.8887368244633507  E_coul = 1.0324430085116891
cycle= 1 E= -2.85629381595166  delta_E= -0.00395  |g|= 0.0117  |ddm|= 0.0588
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.91193027739367  LUMO = 1.23531647800739
  mo_energy =
[ -0.91193028   1.23531648   8.28716901  43.4810905  168.70996799]
E1 = -3.889576096657182  E_coul = 1.0332714482969874
cycle= 2 E= -2.85630464836019  delta_E= -1.08e-05  |g|= 0.00114  |ddm|= 0.00565
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.91146582384365  LUMO = 1.23563375591614
  mo_energy =
[ -0.91146582   1.23563376   8.28829381  43.48238034 168.71122957]
E1 = -3.8897199908858284  E_coul = 1.033415198249726
cycle= 3 E= -2.8563047926361  delta_E= -1.44e-07  |g|= 1.85e-05  |ddm|= 0.000758
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.911443551191869  LUMO = 1.23564549599123
  mo_energy =
[ -0.91144355   1.2356455    8.28834794  43.48247808 168.7113465 ]
E1 = -3.8897235910709242  E_coul = 1.0334187983951437
cycle= 4 E= -2.85630479267578  delta_E= -3.97e-11  |g|= 7.08e-07  |ddm|= 1.05e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8897235910709242  E_coul = 1.0334187983951437
  HOMO = -0.911442997140345  LUMO = 1.23564583663006
  mo_energy =
[ -0.911443     1.23564584   8.28834929  43.48248023 168.71134904]
E1 = -3.8897237105848346  E_coul = 1.0334189179089774
Extra cycle  E= -2.85630479267586  delta_E= -7.64e-14  |g|= 8.82e-08  |ddm|= 5.12e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [63.36544729 25.22770782  5.45691762  1.25000071  0.32194904]
E = -2.856304792675857
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:55 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  97.8784595332        1
[INPUT] 0    0    [1    /1   ]  17.2135758854        1
[INPUT] 0    0    [1    /1   ]  4.00633389866        1
[INPUT] 0    0    [1    /1   ]  0.980075459141       1
[INPUT] 0    0    [1    /1   ]  0.263885578456       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [97.87845953322675, 1.0]], [0, [17.21357588539029, 1.0]], [0, [4.00633389865713, 1.0]], [0, [0.9800754591407191, 1.0]], [0, [0.2638855784560928, 1.0]]]}
ecp = {}
CPU time:       185.63
Set gradient conv threshold to 3.16228e-05
cond(S) = 32.96520353120528
E1 = -3.8819376870755704  E_coul = 1.0236238455941196
init E= -2.85831384148145
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.917951433728862  LUMO = 0.91975269623537
  mo_energy =
[ -0.91795143   0.9197527    6.11561293  31.58600659 184.09004835]
E1 = -3.886209694721133  E_coul = 1.0266458083840468
cycle= 1 E= -2.85956388633709  delta_E= -0.00125  |g|= 0.00684  |ddm|= 0.0359
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.916461187315885  LUMO = 0.921048978733762
  mo_energy =
[ -0.91646119   0.92104898   6.11896287  31.58874437 184.09232435]
E1 = -3.886760495193786  E_coul = 1.0271917402123925
cycle= 2 E= -2.85956875498139  delta_E= -4.87e-06  |g|= 0.00078  |ddm|= 0.00423
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916149162037072  LUMO = 0.921222334836262
  mo_energy =
[ -0.91614916   0.92122233   6.11964167  31.58955912 184.0931452 ]
E1 = -3.886876476209208  E_coul = 1.0273076276706854
cycle= 3 E= -2.85956884853852  delta_E= -9.36e-08  |g|= 1.93e-05  |ddm|= 0.000677
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.91612902055246  LUMO = 0.921230585699263
  mo_energy =
[ -0.91612902   0.92123059   6.11968275  31.58963545 184.0932394 ]
E1 = -3.886880527236264  E_coul = 1.0273116786467065
cycle= 4 E= -2.85956884858956  delta_E= -5.1e-11  |g|= 2.96e-07  |ddm|= 1.41e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.886880527236264  E_coul = 1.0273116786467065
  HOMO = -0.916128584971431  LUMO = 0.921230758394798
  mo_energy =
[ -0.91612858   0.92123076   6.11968362  31.58963729 184.09324186]
E1 = -3.886880592757261  E_coul = 1.0273117441676896
Extra cycle  E= -2.85956884858957  delta_E= -1.38e-14  |g|= 2.46e-08  |ddm|= 1.63e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
exp = [97.87845953 17.21357589  4.0063339   0.98007546  0.26388558]
E = -2.8595688485895714
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:56 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  97.8784595332        1
[INPUT] 0    0    [1    /1   ]  17.2135758854        1
[INPUT] 0    0    [1    /1   ]  4.00633389866        1
[INPUT] 0    0    [1    /1   ]  0.980075459141       1
[INPUT] 0    0    [1    /1   ]  0.263885578456       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [97.87845953322675, 1.0]], [0, [17.21357588539029, 1.0]], [0, [4.00633389865713, 1.0]], [0, [0.9800754591407191, 1.0]], [0, [0.2638855784560928, 1.0]]]}
ecp = {}
CPU time:       186.46
Set gradient conv threshold to 3.16228e-05
cond(S) = 32.96520353120528
E1 = -3.8819376870755704  E_coul = 1.0236238455941196
init E= -2.85831384148145
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.917951433728862  LUMO = 0.91975269623537
  mo_energy =
[ -0.91795143   0.9197527    6.11561293  31.58600659 184.09004835]
E1 = -3.886209694721133  E_coul = 1.0266458083840468
cycle= 1 E= -2.85956388633709  delta_E= -0.00125  |g|= 0.00684  |ddm|= 0.0359
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.916461187315885  LUMO = 0.921048978733762
  mo_energy =
[ -0.91646119   0.92104898   6.11896287  31.58874437 184.09232435]
E1 = -3.886760495193786  E_coul = 1.0271917402123925
cycle= 2 E= -2.85956875498139  delta_E= -4.87e-06  |g|= 0.00078  |ddm|= 0.00423
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916149162037072  LUMO = 0.921222334836262
  mo_energy =
[ -0.91614916   0.92122233   6.11964167  31.58955912 184.0931452 ]
E1 = -3.886876476209208  E_coul = 1.0273076276706854
cycle= 3 E= -2.85956884853852  delta_E= -9.36e-08  |g|= 1.93e-05  |ddm|= 0.000677
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.91612902055246  LUMO = 0.921230585699263
  mo_energy =
[ -0.91612902   0.92123059   6.11968275  31.58963545 184.0932394 ]
E1 = -3.886880527236264  E_coul = 1.0273116786467065
cycle= 4 E= -2.85956884858956  delta_E= -5.1e-11  |g|= 2.96e-07  |ddm|= 1.41e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.886880527236264  E_coul = 1.0273116786467065
  HOMO = -0.916128584971431  LUMO = 0.921230758394798
  mo_energy =
[ -0.91612858   0.92123076   6.11968362  31.58963729 184.09324186]
E1 = -3.886880592757261  E_coul = 1.0273117441676896
Extra cycle  E= -2.85956884858957  delta_E= -1.38e-14  |g|= 2.46e-08  |ddm|= 1.63e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 32.96520353120528
E1 = -3.886880592757261  E_coul = 1.0273117441676896
init E= -2.85956884858957
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.916128552210938  LUMO = 0.921230772042379
  mo_energy =
[ -0.91612855   0.92123077   6.11968369  31.58963742 184.09324202]
E1 = -3.886880598959425  E_coul = 1.0273117503698521
cycle= 1 E= -2.85956884858957  delta_E= -1.33e-15  |g|= 3.49e-09  |ddm|= 2.15e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.886880598959425  E_coul = 1.0273117503698521
  HOMO = -0.916128549109853  LUMO = 0.921230773426179
  mo_energy =
[ -0.91612855   0.92123077   6.1196837   31.58963743 184.09324204]
E1 = -3.886880599676469  E_coul = 1.027311751086899
Extra cycle  E= -2.85956884858957  delta_E= 2.66e-15  |g|= 5.25e-10  |ddm|= 3.06e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [97.87845953 17.21357589  4.0063339   0.98007546  0.26388558]
grad_E = [-8.33547337e-06 -4.00727390e-05  1.59382368e-03 -6.46694556e-03
  1.30839243e-02]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:58 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  109.003698956        1
[INPUT] 0    0    [1    /1   ]  16.4946314199        1
[INPUT] 0    0    [1    /1   ]  3.71781444044        1
[INPUT] 0    0    [1    /1   ]  0.937836940596       1
[INPUT] 0    0    [1    /1   ]  0.251891347108       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [109.00369895581646, 1.0]], [0, [16.494631419887497, 1.0]], [0, [3.7178144404416686, 1.0]], [0, [0.9378369405961116, 1.0]], [0, [0.2518913471079408, 1.0]]]}
ecp = {}
CPU time:       188.95
Set gradient conv threshold to 3.16228e-05
cond(S) = 32.18284812137551
E1 = -3.8828120385771254  E_coul = 1.0236771804006832
init E= -2.85913485817644
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.918064090319873  LUMO = 0.865585546716711
  mo_energy =
[ -0.91806409   0.86558555   5.72623591  29.84821854 194.77313992]
E1 = -3.885465274834175  E_coul = 1.02564393643985
cycle= 1 E= -2.85982133839433  delta_E= -0.000686  |g|= 0.00436  |ddm|= 0.0231
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.917089718039184  LUMO = 0.866410340708596
  mo_energy =
[ -0.91708972   0.86641034   5.72842535  29.84976329 194.77374264]
E1 = -3.8858513588393  E_coul = 1.0260277004666796
cycle= 2 E= -2.85982365837262  delta_E= -2.32e-06  |g|= 0.000545  |ddm|= 0.00297
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916872443548061  LUMO = 0.866525174662324
  mo_energy =
[ -0.91687244   0.86652517   5.728887    29.85032149 194.77428759]
E1 = -3.8859343328709546  E_coul = 1.026110625655799
cycle= 3 E= -2.85982370721516  delta_E= -4.88e-08  |g|= 1.76e-05  |ddm|= 0.00049
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.916854898722184  LUMO = 0.866532505476169
  mo_energy =
[ -0.9168549    0.86653251   5.72892186  29.85038349 194.77436457]
E1 = -3.8859384843359623  E_coul = 1.026114777056613
cycle= 4 E= -2.85982370727935  delta_E= -6.42e-11  |g|= 3.55e-07  |ddm|= 1.77e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8859384843359623  E_coul = 1.026114777056613
  HOMO = -0.916854465111365  LUMO = 0.866532659288333
  mo_energy =
[ -0.91685447   0.86653266   5.72892269  29.85038531 194.77436704]
E1 = -3.8859385450738486  E_coul = 1.0261148377944882
Extra cycle  E= -2.85982370727936  delta_E= -1.11e-14  |g|= 2.18e-08  |ddm|= 1.27e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [109.00369896  16.49463142   3.71781444   0.93783694   0.25189135]
E = -2.8598237072793604
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:19:59 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  109.003698956        1
[INPUT] 0    0    [1    /1   ]  16.4946314199        1
[INPUT] 0    0    [1    /1   ]  3.71781444044        1
[INPUT] 0    0    [1    /1   ]  0.937836940596       1
[INPUT] 0    0    [1    /1   ]  0.251891347108       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [109.00369895581646, 1.0]], [0, [16.494631419887497, 1.0]], [0, [3.7178144404416686, 1.0]], [0, [0.9378369405961116, 1.0]], [0, [0.2518913471079408, 1.0]]]}
ecp = {}
CPU time:       189.80
Set gradient conv threshold to 3.16228e-05
cond(S) = 32.18284812137551
E1 = -3.8828120385771254  E_coul = 1.0236771804006832
init E= -2.85913485817644
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.918064090319873  LUMO = 0.865585546716711
  mo_energy =
[ -0.91806409   0.86558555   5.72623591  29.84821854 194.77313992]
E1 = -3.885465274834175  E_coul = 1.02564393643985
cycle= 1 E= -2.85982133839433  delta_E= -0.000686  |g|= 0.00436  |ddm|= 0.0231
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.917089718039184  LUMO = 0.866410340708596
  mo_energy =
[ -0.91708972   0.86641034   5.72842535  29.84976329 194.77374264]
E1 = -3.8858513588393  E_coul = 1.0260277004666796
cycle= 2 E= -2.85982365837262  delta_E= -2.32e-06  |g|= 0.000545  |ddm|= 0.00297
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916872443548061  LUMO = 0.866525174662324
  mo_energy =
[ -0.91687244   0.86652517   5.728887    29.85032149 194.77428759]
E1 = -3.8859343328709546  E_coul = 1.026110625655799
cycle= 3 E= -2.85982370721516  delta_E= -4.88e-08  |g|= 1.76e-05  |ddm|= 0.00049
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.916854898722184  LUMO = 0.866532505476169
  mo_energy =
[ -0.9168549    0.86653251   5.72892186  29.85038349 194.77436457]
E1 = -3.8859384843359623  E_coul = 1.026114777056613
cycle= 4 E= -2.85982370727935  delta_E= -6.42e-11  |g|= 3.55e-07  |ddm|= 1.77e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8859384843359623  E_coul = 1.026114777056613
  HOMO = -0.916854465111365  LUMO = 0.866532659288333
  mo_energy =
[ -0.91685447   0.86653266   5.72892269  29.85038531 194.77436704]
E1 = -3.8859385450738486  E_coul = 1.0261148377944882
Extra cycle  E= -2.85982370727936  delta_E= -1.11e-14  |g|= 2.18e-08  |ddm|= 1.27e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 32.18284812137551
E1 = -3.8859385450738486  E_coul = 1.0261148377944882
init E= -2.85982370727936
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.916854434742429  LUMO = 0.866532670690952
  mo_energy =
[ -0.91685443   0.86653267   5.72892274  29.85038543 194.7743672 ]
E1 = -3.8859385502464354  E_coul = 1.0261148429670743
cycle= 1 E= -2.85982370727936  delta_E= -4.44e-16  |g|= 2.41e-09  |ddm|= 1.49e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8859385502464354  E_coul = 1.0261148429670743
  HOMO = -0.91685443215614  LUMO = 0.866532671741373
  mo_energy =
[ -0.91685443   0.86653267   5.72892275  29.85038544 194.77436721]
E1 = -3.8859385507981448  E_coul = 1.0261148435187837
Extra cycle  E= -2.85982370727936  delta_E=    0  |g|= 3.64e-10  |ddm|= 2.15e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [109.00369896  16.49463142   3.71781444   0.93783694   0.25189135]
grad_E = [ 7.33630423e-07 -4.96366254e-05  7.20588916e-04 -8.35982136e-04
 -2.85260961e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:20:01 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  108.915760198        1
[INPUT] 0    0    [1    /1   ]  15.5840192643        1
[INPUT] 0    0    [1    /1   ]  3.45056076966        1
[INPUT] 0    0    [1    /1   ]  0.899331469852       1
[INPUT] 0    0    [1    /1   ]  0.247494728404       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [108.91576019835615, 1.0]], [0, [15.584019264315973, 1.0]], [0, [3.4505607696580904, 1.0]], [0, [0.8993314698515414, 1.0]], [0, [0.247494728403708, 1.0]]]}
ecp = {}
CPU time:       192.31
Set gradient conv threshold to 3.16228e-05
cond(S) = 33.50617917516119
E1 = -3.882987046001935  E_coul = 1.0236904931345023
init E= -2.85929655286743
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.918085318106653  LUMO = 0.834677628782785
  mo_energy =
[ -0.91808532   0.83467763   5.38905776  27.94791204 190.72023822]
E1 = -3.8854897793580303  E_coul = 1.0256145808971542
cycle= 1 E= -2.85987519846088  delta_E= -0.000579  |g|= 0.004  |ddm|= 0.0215
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.917131272122709  LUMO = 0.835429256456356
  mo_energy =
[ -0.91713127   0.83542926   5.39117485  27.94946639 190.72059721]
E1 = -3.8858801520426516  E_coul = 1.0260027441849935
cycle= 2 E= -2.85987740785766  delta_E= -2.21e-06  |g|= 0.000536  |ddm|= 0.00297
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916912432927979  LUMO = 0.835539588289825
  mo_energy =
[ -0.91691243   0.83553959   5.39162599  27.95003313 190.72115162]
E1 = -3.8859638909239544  E_coul = 1.02608643295508
cycle= 3 E= -2.85987745796887  delta_E= -5.01e-08  |g|= 2.12e-05  |ddm|= 0.000505
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.916893529257558  LUMO = 0.835547413141715
  mo_energy =
[ -0.91689353   0.83554741   5.39166237  27.950097   190.72123142]
E1 = -3.8859687454688574  E_coul = 1.0260912874014543
cycle= 4 E= -2.8598774580674  delta_E= -9.85e-11  |g|= 3.19e-07  |ddm|= 2.28e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8859687454688574  E_coul = 1.0260912874014543
  HOMO = -0.91689308533298  LUMO = 0.83554756751797
  mo_energy =
[ -0.91689309   0.83554757   5.39166318  27.95009878 190.72123386]
E1 = -3.8859688152239094  E_coul = 1.0260913571564896
Extra cycle  E= -2.85987745806742  delta_E= -1.64e-14  |g|= 2.82e-08  |ddm|= 1.72e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [108.9157602   15.58401926   3.45056077   0.89933147   0.24749473]
E = -2.8598774580674196
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:20:02 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  108.915760198        1
[INPUT] 0    0    [1    /1   ]  15.5840192643        1
[INPUT] 0    0    [1    /1   ]  3.45056076966        1
[INPUT] 0    0    [1    /1   ]  0.899331469852       1
[INPUT] 0    0    [1    /1   ]  0.247494728404       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [108.91576019835615, 1.0]], [0, [15.584019264315973, 1.0]], [0, [3.4505607696580904, 1.0]], [0, [0.8993314698515414, 1.0]], [0, [0.247494728403708, 1.0]]]}
ecp = {}
CPU time:       193.15
Set gradient conv threshold to 3.16228e-05
cond(S) = 33.50617917516119
E1 = -3.882987046001935  E_coul = 1.0236904931345023
init E= -2.85929655286743
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.918085318106653  LUMO = 0.834677628782785
  mo_energy =
[ -0.91808532   0.83467763   5.38905776  27.94791204 190.72023822]
E1 = -3.8854897793580303  E_coul = 1.0256145808971542
cycle= 1 E= -2.85987519846088  delta_E= -0.000579  |g|= 0.004  |ddm|= 0.0215
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.917131272122709  LUMO = 0.835429256456356
  mo_energy =
[ -0.91713127   0.83542926   5.39117485  27.94946639 190.72059721]
E1 = -3.8858801520426516  E_coul = 1.0260027441849935
cycle= 2 E= -2.85987740785766  delta_E= -2.21e-06  |g|= 0.000536  |ddm|= 0.00297
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916912432927979  LUMO = 0.835539588289825
  mo_energy =
[ -0.91691243   0.83553959   5.39162599  27.95003313 190.72115162]
E1 = -3.8859638909239544  E_coul = 1.02608643295508
cycle= 3 E= -2.85987745796887  delta_E= -5.01e-08  |g|= 2.12e-05  |ddm|= 0.000505
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.916893529257558  LUMO = 0.835547413141715
  mo_energy =
[ -0.91689353   0.83554741   5.39166237  27.950097   190.72123142]
E1 = -3.8859687454688574  E_coul = 1.0260912874014543
cycle= 4 E= -2.8598774580674  delta_E= -9.85e-11  |g|= 3.19e-07  |ddm|= 2.28e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8859687454688574  E_coul = 1.0260912874014543
  HOMO = -0.91689308533298  LUMO = 0.83554756751797
  mo_energy =
[ -0.91689309   0.83554757   5.39166318  27.95009878 190.72123386]
E1 = -3.8859688152239094  E_coul = 1.0260913571564896
Extra cycle  E= -2.85987745806742  delta_E= -1.64e-14  |g|= 2.82e-08  |ddm|= 1.72e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 33.50617917516119
E1 = -3.8859688152239094  E_coul = 1.0260913571564896
init E= -2.85987745806742
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.916893050455463  LUMO = 0.835547580567475
  mo_energy =
[ -0.91689305   0.83554758   5.39166325  27.95009891 190.72123403]
E1 = -3.8859688221093425  E_coul = 1.026091364041925
cycle= 1 E= -2.85987745806742  delta_E= 1.78e-15  |g|= 4.05e-09  |ddm|= 2.44e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8859688221093425  E_coul = 1.026091364041925
  HOMO = -0.91689304701274  LUMO = 0.835547581963573
  mo_energy =
[ -0.91689305   0.83554758   5.39166325  27.95009893 190.72123405]
E1 = -3.88596882294469  E_coul = 1.0260913648772718
Extra cycle  E= -2.85987745806742  delta_E=    0  |g|= 6.37e-10  |ddm|= 3.73e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [108.9157602   15.58401926   3.45056077   0.89933147   0.24749473]
grad_E = [ 3.61326630e-06 -2.14279021e-05 -8.09113379e-06  8.28869910e-04
 -2.73895154e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:20:05 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  105.572441624        1
[INPUT] 0    0    [1    /1   ]  15.4310653095        1
[INPUT] 0    0    [1    /1   ]  3.42566506271        1
[INPUT] 0    0    [1    /1   ]  0.895852930743       1
[INPUT] 0    0    [1    /1   ]  0.248455304052       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [105.57244162378758, 1.0]], [0, [15.431065309477852, 1.0]], [0, [3.4256650627149354, 1.0]], [0, [0.8958529307433353, 1.0]], [0, [0.248455304051796, 1.0]]]}
ecp = {}
CPU time:       195.67
Set gradient conv threshold to 3.16228e-05
cond(S) = 34.08769556763873
E1 = -3.8829562741354366  E_coul = 1.02368763362425
init E= -2.85926864051119
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.918090488446983  LUMO = 0.835539495395839
  mo_energy =
[ -0.91809049   0.8355395    5.36202061  27.69616689 185.89769211]
E1 = -3.8856574489593916  E_coul = 1.025772442544845
cycle= 1 E= -2.85988500641455  delta_E= -0.000616  |g|= 0.0043  |ddm|= 0.0235
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.917057406801118  LUMO = 0.836346199504335
  mo_energy =
[ -0.91705741   0.8363462    5.36430283  27.69791567 185.89831089]
E1 = -3.8860790573564334  E_coul = 1.026191470733609
cycle= 2 E= -2.85988758662282  delta_E= -2.58e-06  |g|= 0.000578  |ddm|= 0.00323
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916819775332795  LUMO = 0.836465952537088
  mo_energy =
[ -0.91681978   0.83646595   5.36479094  27.6985324  185.89892046]
E1 = -3.8861699400658405  E_coul = 1.0262822947407702
cycle= 3 E= -2.85988764532507  delta_E= -5.87e-08  |g|= 2.01e-05  |ddm|= 0.000553
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.916800727344139  LUMO = 0.836473694097308
  mo_energy =
[ -0.91680073   0.83647369   5.36482727  27.69859749 185.89900235]
E1 = -3.8861746906734504  E_coul = 1.0262870452585608
cycle= 4 E= -2.85988764541489  delta_E= -8.98e-11  |g|= 3.38e-07  |ddm|= 2.18e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8861746906734504  E_coul = 1.0262870452585608
  HOMO = -0.916800300078165  LUMO = 0.836473838221281
  mo_energy =
[ -0.9168003    0.83647384   5.36482804  27.69859923 185.89900476]
E1 = -3.8861747523500583  E_coul = 1.0262871069351571
Extra cycle  E= -2.8598876454149  delta_E= -1.15e-14  |g|= 2.28e-08  |ddm|= 1.3e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [105.57244162  15.43106531   3.42566506   0.89585293   0.2484553 ]
E = -2.859887645414901
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:20:06 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  105.572441624        1
[INPUT] 0    0    [1    /1   ]  15.4310653095        1
[INPUT] 0    0    [1    /1   ]  3.42566506271        1
[INPUT] 0    0    [1    /1   ]  0.895852930743       1
[INPUT] 0    0    [1    /1   ]  0.248455304052       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [105.57244162378758, 1.0]], [0, [15.431065309477852, 1.0]], [0, [3.4256650627149354, 1.0]], [0, [0.8958529307433353, 1.0]], [0, [0.248455304051796, 1.0]]]}
ecp = {}
CPU time:       196.52
Set gradient conv threshold to 3.16228e-05
cond(S) = 34.08769556763873
E1 = -3.8829562741354366  E_coul = 1.02368763362425
init E= -2.85926864051119
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.918090488446983  LUMO = 0.835539495395839
  mo_energy =
[ -0.91809049   0.8355395    5.36202061  27.69616689 185.89769211]
E1 = -3.8856574489593916  E_coul = 1.025772442544845
cycle= 1 E= -2.85988500641455  delta_E= -0.000616  |g|= 0.0043  |ddm|= 0.0235
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.917057406801118  LUMO = 0.836346199504335
  mo_energy =
[ -0.91705741   0.8363462    5.36430283  27.69791567 185.89831089]
E1 = -3.8860790573564334  E_coul = 1.026191470733609
cycle= 2 E= -2.85988758662282  delta_E= -2.58e-06  |g|= 0.000578  |ddm|= 0.00323
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916819775332795  LUMO = 0.836465952537088
  mo_energy =
[ -0.91681978   0.83646595   5.36479094  27.6985324  185.89892046]
E1 = -3.8861699400658405  E_coul = 1.0262822947407702
cycle= 3 E= -2.85988764532507  delta_E= -5.87e-08  |g|= 2.01e-05  |ddm|= 0.000553
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.916800727344139  LUMO = 0.836473694097308
  mo_energy =
[ -0.91680073   0.83647369   5.36482727  27.69859749 185.89900235]
E1 = -3.8861746906734504  E_coul = 1.0262870452585608
cycle= 4 E= -2.85988764541489  delta_E= -8.98e-11  |g|= 3.38e-07  |ddm|= 2.18e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8861746906734504  E_coul = 1.0262870452585608
  HOMO = -0.916800300078165  LUMO = 0.836473838221281
  mo_energy =
[ -0.9168003    0.83647384   5.36482804  27.69859923 185.89900476]
E1 = -3.8861747523500583  E_coul = 1.0262871069351571
Extra cycle  E= -2.8598876454149  delta_E= -1.15e-14  |g|= 2.28e-08  |ddm|= 1.3e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 34.08769556763873
E1 = -3.8861747523500583  E_coul = 1.0262871069351571
init E= -2.8598876454149
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.916800269239862  LUMO = 0.83647384926214
  mo_energy =
[ -0.91680027   0.83647385   5.3648281   27.69859935 185.89900493]
E1 = -3.8861747578033388  E_coul = 1.0262871123884372
cycle= 1 E= -2.8598876454149  delta_E= -4.44e-16  |g|= 2.69e-09  |ddm|= 1.63e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8861747578033388  E_coul = 1.0262871123884372
  HOMO = -0.916800266513231  LUMO = 0.836473850323608
  mo_energy =
[ -0.91680027   0.83647385   5.3648281   27.69859936 185.89900494]
E1 = -3.886174758407215  E_coul = 1.0262871129923146
Extra cycle  E= -2.8598876454149  delta_E= 1.33e-15  |g|= 4.15e-10  |ddm|= 2.46e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [105.57244162  15.43106531   3.42566506   0.89585293   0.2484553 ]
grad_E = [ 2.03029932e-06 -6.40783969e-06 -9.41267518e-07  1.57675831e-04
  1.58007265e-04]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:20:08 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  101.633019598        1
[INPUT] 0    0    [1    /1   ]  15.1672386093        1
[INPUT] 0    0    [1    /1   ]  3.3822477046         1
[INPUT] 0    0    [1    /1   ]  0.888898957577       1
[INPUT] 0    0    [1    /1   ]  0.248300239465       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [101.63301959810521, 1.0]], [0, [15.167238609287239, 1.0]], [0, [3.382247704599997, 1.0]], [0, [0.8888989575771044, 1.0]], [0, [0.24830023946498253, 1.0]]]}
ecp = {}
CPU time:       199.02
Set gradient conv threshold to 3.16228e-05
cond(S) = 34.79215690658549
E1 = -3.882948003088692  E_coul = 1.0236856824884102
init E= -2.85926232060028
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.918092883420913  LUMO = 0.831593264871146
  mo_energy =
[ -0.91809288   0.83159326   5.30601019  27.25597097 179.89816372]
E1 = -3.8857333553035485  E_coul = 1.0258441674208025
cycle= 1 E= -2.85988918788275  delta_E= -0.000627  |g|= 0.00446  |ddm|= 0.0247
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.917023735452434  LUMO = 0.832420913016022
  mo_energy =
[ -0.91702374   0.83242091   5.3083649   27.25780964 179.89889825]
E1 = -3.886173441974889  E_coul = 1.0262814419477093
cycle= 2 E= -2.85989200002718  delta_E= -2.81e-06  |g|= 0.000604  |ddm|= 0.0034
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916774800154637  LUMO = 0.832545694015358
  mo_energy =
[ -0.9167748    0.83254569   5.30887334  27.25845589 179.89954099]
E1 = -3.8862688755386112  E_coul = 1.026376810903028
cycle= 3 E= -2.85989206463558  delta_E= -6.46e-08  |g|= 1.95e-05  |ddm|= 0.000586
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.916755682623719  LUMO = 0.832553329995417
  mo_energy =
[ -0.91675568   0.83255333   5.30890942  27.25852145 179.899624  ]
E1 = -3.8862735678679634  E_coul = 1.026381503147418
cycle= 4 E= -2.85989206472055  delta_E= -8.5e-11  |g|= 3.48e-07  |ddm|= 2.12e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8862735678679634  E_coul = 1.026381503147418
  HOMO = -0.916755280786574  LUMO = 0.832553461490215
  mo_energy =
[ -0.91675528   0.83255346   5.30891013  27.25852311 179.8996263 ]
E1 = -3.8862736219106653  E_coul = 1.0263815571901078
Extra cycle  E= -2.85989206472056  delta_E= -1.15e-14  |g|= 2.05e-08  |ddm|= 1.06e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [101.6330196   15.16723861   3.3822477    0.88889896   0.24830024]
E = -2.8598920647205572
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:20:09 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  101.633019598        1
[INPUT] 0    0    [1    /1   ]  15.1672386093        1
[INPUT] 0    0    [1    /1   ]  3.3822477046         1
[INPUT] 0    0    [1    /1   ]  0.888898957577       1
[INPUT] 0    0    [1    /1   ]  0.248300239465       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [101.63301959810521, 1.0]], [0, [15.167238609287239, 1.0]], [0, [3.382247704599997, 1.0]], [0, [0.8888989575771044, 1.0]], [0, [0.24830023946498253, 1.0]]]}
ecp = {}
CPU time:       199.88
Set gradient conv threshold to 3.16228e-05
cond(S) = 34.79215690658549
E1 = -3.882948003088692  E_coul = 1.0236856824884102
init E= -2.85926232060028
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.918092883420913  LUMO = 0.831593264871146
  mo_energy =
[ -0.91809288   0.83159326   5.30601019  27.25597097 179.89816372]
E1 = -3.8857333553035485  E_coul = 1.0258441674208025
cycle= 1 E= -2.85988918788275  delta_E= -0.000627  |g|= 0.00446  |ddm|= 0.0247
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.917023735452434  LUMO = 0.832420913016022
  mo_energy =
[ -0.91702374   0.83242091   5.3083649   27.25780964 179.89889825]
E1 = -3.886173441974889  E_coul = 1.0262814419477093
cycle= 2 E= -2.85989200002718  delta_E= -2.81e-06  |g|= 0.000604  |ddm|= 0.0034
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916774800154637  LUMO = 0.832545694015358
  mo_energy =
[ -0.9167748    0.83254569   5.30887334  27.25845589 179.89954099]
E1 = -3.8862688755386112  E_coul = 1.026376810903028
cycle= 3 E= -2.85989206463558  delta_E= -6.46e-08  |g|= 1.95e-05  |ddm|= 0.000586
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.916755682623719  LUMO = 0.832553329995417
  mo_energy =
[ -0.91675568   0.83255333   5.30890942  27.25852145 179.899624  ]
E1 = -3.8862735678679634  E_coul = 1.026381503147418
cycle= 4 E= -2.85989206472055  delta_E= -8.5e-11  |g|= 3.48e-07  |ddm|= 2.12e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8862735678679634  E_coul = 1.026381503147418
  HOMO = -0.916755280786574  LUMO = 0.832553461490215
  mo_energy =
[ -0.91675528   0.83255346   5.30891013  27.25852311 179.8996263 ]
E1 = -3.8862736219106653  E_coul = 1.0263815571901078
Extra cycle  E= -2.85989206472056  delta_E= -1.15e-14  |g|= 2.05e-08  |ddm|= 1.06e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 34.79215690658549
E1 = -3.8862736219106653  E_coul = 1.0263815571901078
init E= -2.85989206472056
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.916755253765223  LUMO = 0.832553470706366
  mo_energy =
[ -0.91675525   0.83255347   5.30891018  27.25852321 179.89962645]
E1 = -3.886273626185715  E_coul = 1.0263815614651575
cycle= 1 E= -2.85989206472056  delta_E=    0  |g|= 1.75e-09  |ddm|= 1.04e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.886273626185715  E_coul = 1.0263815614651575
  HOMO = -0.916755251627699  LUMO = 0.832553471494299
  mo_energy =
[ -0.91675525   0.83255347   5.30891018  27.25852322 179.89962646]
E1 = -3.886273626607708  E_coul = 1.0263815618871506
Extra cycle  E= -2.85989206472056  delta_E=    0  |g|= 2.48e-10  |ddm|= 1.49e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [101.6330196   15.16723861   3.3822477    0.88889896   0.24830024]
grad_E = [ 3.86918827e-07  7.62496321e-06 -2.86884857e-05 -1.80966090e-04
  1.82435086e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:20:12 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  99.9508269192        1
[INPUT] 0    0    [1    /1   ]  15.0045121142        1
[INPUT] 0    0    [1    /1   ]  3.35654509889        1
[INPUT] 0    0    [1    /1   ]  0.883637523411       1
[INPUT] 0    0    [1    /1   ]  0.247303382792       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [99.9508269191781, 1.0]], [0, [15.00451211423829, 1.0]], [0, [3.356545098894493, 1.0]], [0, [0.8836375234110186, 1.0]], [0, [0.2473033827921404, 1.0]]]}
ecp = {}
CPU time:       202.40
Set gradient conv threshold to 3.16228e-05
cond(S) = 35.05837885884807
E1 = -3.88296375918522  E_coul = 1.023684481627217
init E= -2.859279277558
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.918094377134281  LUMO = 0.826236508315852
  mo_energy =
[ -0.91809438   0.82623651   5.26640826  26.98352005 177.14589812]
E1 = -3.885693652048691  E_coul = 1.025802835869061
cycle= 1 E= -2.85989081617963  delta_E= -0.000612  |g|= 0.00443  |ddm|= 0.0246
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.917045209770686  LUMO = 0.827046911575476
  mo_energy =
[ -0.91704521   0.82704691   5.26872032  26.98530555 177.14656577]
E1 = -3.8861325762849512  E_coul = 1.0262389593318504
cycle= 2 E= -2.8598936169531  delta_E= -2.8e-06  |g|= 0.000603  |ddm|= 0.00341
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916796833884874  LUMO = 0.827170744209403
  mo_energy =
[ -0.91679683   0.82717074   5.26922601  26.98594959 177.1472069 ]
E1 = -3.886228133040129  E_coul = 1.02633445120912
cycle= 3 E= -2.85989368183101  delta_E= -6.49e-08  |g|= 1.96e-05  |ddm|= 0.000588
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.916777649145802  LUMO = 0.827178362037369
  mo_energy =
[ -0.91677765   0.82717836   5.26926205  26.98601513 177.14728997]
E1 = -3.8862328640002266  E_coul = 1.0263391820825767
cycle= 4 E= -2.85989368191765  delta_E= -8.66e-11  |g|= 3.51e-07  |ddm|= 2.15e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8862328640002266  E_coul = 1.0263391820825767
  HOMO = -0.916777249917549  LUMO = 0.827178491152635
  mo_energy =
[ -0.91677725   0.82717849   5.26926275  26.98601677 177.14729226]
E1 = -3.886232917188568  E_coul = 1.0263392352709073
Extra cycle  E= -2.85989368191766  delta_E= -1.07e-14  |g|= 2.06e-08  |ddm|= 1.04e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [99.95082692 15.00451211  3.3565451   0.88363752  0.24730338]
E = -2.8598936819176606
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:20:12 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  99.9508269192        1
[INPUT] 0    0    [1    /1   ]  15.0045121142        1
[INPUT] 0    0    [1    /1   ]  3.35654509889        1
[INPUT] 0    0    [1    /1   ]  0.883637523411       1
[INPUT] 0    0    [1    /1   ]  0.247303382792       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [99.9508269191781, 1.0]], [0, [15.00451211423829, 1.0]], [0, [3.356545098894493, 1.0]], [0, [0.8836375234110186, 1.0]], [0, [0.2473033827921404, 1.0]]]}
ecp = {}
CPU time:       203.26
Set gradient conv threshold to 3.16228e-05
cond(S) = 35.05837885884807
E1 = -3.88296375918522  E_coul = 1.023684481627217
init E= -2.859279277558
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.918094377134281  LUMO = 0.826236508315852
  mo_energy =
[ -0.91809438   0.82623651   5.26640826  26.98352005 177.14589812]
E1 = -3.885693652048691  E_coul = 1.025802835869061
cycle= 1 E= -2.85989081617963  delta_E= -0.000612  |g|= 0.00443  |ddm|= 0.0246
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.917045209770686  LUMO = 0.827046911575476
  mo_energy =
[ -0.91704521   0.82704691   5.26872032  26.98530555 177.14656577]
E1 = -3.8861325762849512  E_coul = 1.0262389593318504
cycle= 2 E= -2.8598936169531  delta_E= -2.8e-06  |g|= 0.000603  |ddm|= 0.00341
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916796833884874  LUMO = 0.827170744209403
  mo_energy =
[ -0.91679683   0.82717074   5.26922601  26.98594959 177.1472069 ]
E1 = -3.886228133040129  E_coul = 1.02633445120912
cycle= 3 E= -2.85989368183101  delta_E= -6.49e-08  |g|= 1.96e-05  |ddm|= 0.000588
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.916777649145802  LUMO = 0.827178362037369
  mo_energy =
[ -0.91677765   0.82717836   5.26926205  26.98601513 177.14728997]
E1 = -3.8862328640002266  E_coul = 1.0263391820825767
cycle= 4 E= -2.85989368191765  delta_E= -8.66e-11  |g|= 3.51e-07  |ddm|= 2.15e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8862328640002266  E_coul = 1.0263391820825767
  HOMO = -0.916777249917549  LUMO = 0.827178491152635
  mo_energy =
[ -0.91677725   0.82717849   5.26926275  26.98601677 177.14729226]
E1 = -3.886232917188568  E_coul = 1.0263392352709073
Extra cycle  E= -2.85989368191766  delta_E= -1.07e-14  |g|= 2.06e-08  |ddm|= 1.04e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 35.05837885884807
E1 = -3.886232917188568  E_coul = 1.0263392352709073
init E= -2.85989368191766
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.916777223323372  LUMO = 0.827178500089785
  mo_energy =
[ -0.91677722   0.8271785    5.2692628   26.98601688 177.1472924 ]
E1 = -3.8862329213223212  E_coul = 1.0263392394046609
cycle= 1 E= -2.85989368191766  delta_E=    0  |g|= 1.66e-09  |ddm|= 9.71e-09
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8862329213223212  E_coul = 1.0263392394046609
  HOMO = -0.916777221256498  LUMO = 0.827178500839164
  mo_energy =
[ -0.91677722   0.8271785    5.26926281  26.98601688 177.14729241]
E1 = -3.8862329217218825  E_coul = 1.0263392398042208
Extra cycle  E= -2.85989368191766  delta_E= -8.88e-16  |g|= 2.27e-10  |ddm|= 1.36e-09
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [99.95082692 15.00451211  3.3565451   0.88363752  0.24730338]
grad_E = [-9.91721275e-09  7.68882769e-06 -2.48946753e-05 -1.99373285e-04
  1.66613353e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:20:15 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  97.8468310668        1
[INPUT] 0    0    [1    /1   ]  14.7526689254        1
[INPUT] 0    0    [1    /1   ]  3.31721876197        1
[INPUT] 0    0    [1    /1   ]  0.874479785634       1
[INPUT] 0    0    [1    /1   ]  0.244975489462       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [97.84683106678074, 1.0]], [0, [14.752668925353925, 1.0]], [0, [3.3172187619717666, 1.0]], [0, [0.8744797856335238, 1.0]], [0, [0.24497548946219427, 1.0]]]}
ecp = {}
CPU time:       205.86
Set gradient conv threshold to 3.16228e-05
cond(S) = 35.327472133181374
E1 = -3.8830042812288186  E_coul = 1.0236825215965863
init E= -2.85932175963223
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.918096757699649  LUMO = 0.815348760930915
  mo_energy =
[ -0.91809676   0.81534876   5.1998537   26.55881905 173.51699287]
E1 = -3.8855651776499527  E_coul = 1.0256725670050826
cycle= 1 E= -2.85989261064487  delta_E= -0.000571  |g|= 0.00429  |ddm|= 0.0238
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.917111180021053  LUMO = 0.816109422317084
  mo_energy =
[ -0.91711118   0.81610942   5.20203319  26.56043861 173.51745041]
E1 = -3.8859926021889084  E_coul = 1.0260973291883304
cycle= 2 E= -2.85989527300058  delta_E= -2.66e-06  |g|= 0.000588  |ddm|= 0.00333
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916869490245712  LUMO = 0.816228671845479
  mo_energy =
[ -0.91686949   0.81622867   5.20252292  26.56106356 173.51807205]
E1 = -3.8860862598288497  E_coul = 1.0261909242297085
cycle= 3 E= -2.85989533559914  delta_E= -6.26e-08  |g|= 2.02e-05  |ddm|= 0.000579
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.91685018624808  LUMO = 0.81623629292994
  mo_energy =
[ -0.91685019   0.81623629   5.20255899  26.56112882 173.51815474]
E1 = -3.8860911090679786  E_coul = 1.0261957733757814
cycle= 4 E= -2.8598953356922  delta_E= -9.31e-11  |g|= 3.51e-07  |ddm|= 2.24e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8860911090679786  E_coul = 1.0261957733757814
  HOMO = -0.916849781158216  LUMO = 0.816236422399911
  mo_energy =
[ -0.91684978   0.81623642   5.2025597   26.56113047 173.51815704]
E1 = -3.8860911639928055  E_coul = 1.0261958283005994
Extra cycle  E= -2.85989533569221  delta_E= -8.88e-15  |g|= 2.11e-08  |ddm|= 1.08e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [97.84683107 14.75266893  3.31721876  0.87447979  0.24497549]
E = -2.8598953356922063
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:20:16 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  97.8468310668        1
[INPUT] 0    0    [1    /1   ]  14.7526689254        1
[INPUT] 0    0    [1    /1   ]  3.31721876197        1
[INPUT] 0    0    [1    /1   ]  0.874479785634       1
[INPUT] 0    0    [1    /1   ]  0.244975489462       1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [97.84683106678074, 1.0]], [0, [14.752668925353925, 1.0]], [0, [3.3172187619717666, 1.0]], [0, [0.8744797856335238, 1.0]], [0, [0.24497548946219427, 1.0]]]}
ecp = {}
CPU time:       206.75
Set gradient conv threshold to 3.16228e-05
cond(S) = 35.327472133181374
E1 = -3.8830042812288186  E_coul = 1.0236825215965863
init E= -2.85932175963223
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.918096757699649  LUMO = 0.815348760930915
  mo_energy =
[ -0.91809676   0.81534876   5.1998537   26.55881905 173.51699287]
E1 = -3.8855651776499527  E_coul = 1.0256725670050826
cycle= 1 E= -2.85989261064487  delta_E= -0.000571  |g|= 0.00429  |ddm|= 0.0238
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.917111180021053  LUMO = 0.816109422317084
  mo_energy =
[ -0.91711118   0.81610942   5.20203319  26.56043861 173.51745041]
E1 = -3.8859926021889084  E_coul = 1.0260973291883304
cycle= 2 E= -2.85989527300058  delta_E= -2.66e-06  |g|= 0.000588  |ddm|= 0.00333
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916869490245712  LUMO = 0.816228671845479
  mo_energy =
[ -0.91686949   0.81622867   5.20252292  26.56106356 173.51807205]
E1 = -3.8860862598288497  E_coul = 1.0261909242297085
cycle= 3 E= -2.85989533559914  delta_E= -6.26e-08  |g|= 2.02e-05  |ddm|= 0.000579
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.91685018624808  LUMO = 0.81623629292994
  mo_energy =
[ -0.91685019   0.81623629   5.20255899  26.56112882 173.51815474]
E1 = -3.8860911090679786  E_coul = 1.0261957733757814
cycle= 4 E= -2.8598953356922  delta_E= -9.31e-11  |g|= 3.51e-07  |ddm|= 2.24e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8860911090679786  E_coul = 1.0261957733757814
  HOMO = -0.916849781158216  LUMO = 0.816236422399911
  mo_energy =
[ -0.91684978   0.81623642   5.2025597   26.56113047 173.51815704]
E1 = -3.8860911639928055  E_coul = 1.0261958283005994
Extra cycle  E= -2.85989533569221  delta_E= -8.88e-15  |g|= 2.11e-08  |ddm|= 1.08e-07
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 35.327472133181374
E1 = -3.8860911639928055  E_coul = 1.0261958283005994
init E= -2.85989533569221
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.916849753695797  LUMO = 0.816236431566639
  mo_energy =
[ -0.91684975   0.81623643   5.20255975  26.56113058 173.51815719]
E1 = -3.886091168384833  E_coul = 1.0261958326926284
cycle= 1 E= -2.8598953356922  delta_E= 1.78e-15  |g|= 1.84e-09  |ddm|= 1.08e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.886091168384833  E_coul = 1.0261958326926284
  HOMO = -0.916849751499793  LUMO = 0.816236432360588
  mo_energy =
[ -0.91684975   0.81623643   5.20255975  26.56113059 173.5181572 ]
E1 = -3.8860911688240916  E_coul = 1.0261958331318866
Extra cycle  E= -2.8598953356922  delta_E= -4.44e-16  |g|= 2.62e-10  |ddm|= 1.57e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [97.84683107 14.75266893  3.31721876  0.87447979  0.24497549]
grad_E = [-1.45121006e-07  1.13221159e-06 -3.39837875e-07 -9.02807587e-05
  5.04574221e-04]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:20:19 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  98.0074633614        1
[INPUT] 0    0    [1    /1   ]  14.7558908718        1
[INPUT] 0    0    [1    /1   ]  3.3173775223         1
[INPUT] 0    0    [1    /1   ]  0.873997305869       1
[INPUT] 0    0    [1    /1   ]  0.24462608981        1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [98.00746336142836, 1.0]], [0, [14.755890871800585, 1.0]], [0, [3.317377522302804, 1.0]], [0, [0.8739973058687156, 1.0]], [0, [0.24462608981040848, 1.0]]]}
ecp = {}
CPU time:       209.31
Set gradient conv threshold to 3.16228e-05
cond(S) = 35.25640466390755
E1 = -3.883012596940141  E_coul = 1.0236823690728498
init E= -2.85933022786729
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.918097080882226  LUMO = 0.814176506295897
  mo_energy =
[ -0.91809708   0.81417651   5.19734274  26.56011379 173.7279807 ]
E1 = -3.8855355106415783  E_coul = 1.025642757134882
cycle= 1 E= -2.8598927535067  delta_E= -0.000563  |g|= 0.00425  |ddm|= 0.0235
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.917126132573869  LUMO = 0.814926570834119
  mo_energy =
[ -0.91712613   0.81492657   5.19949231  26.56169518 173.72838904]
E1 = -3.8859585952316635  E_coul = 1.026063233899241
cycle= 2 E= -2.85989536133242  delta_E= -2.61e-06  |g|= 0.000583  |ddm|= 0.0033
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916887020650155  LUMO = 0.81504442854795
  mo_energy =
[ -0.91688702   0.81504443   5.19997685  26.56231323 173.72900313]
E1 = -3.8860513177122233  E_coul = 1.026155894995363
cycle= 3 E= -2.85989542271686  delta_E= -6.14e-08  |g|= 2.04e-05  |ddm|= 0.000573
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.916867738039439  LUMO = 0.815052050443739
  mo_energy =
[ -0.91686774   0.81505205   5.2000129   26.56237831 173.72908554]
E1 = -3.8860561821024873  E_coul = 1.0261607592913884
cycle= 4 E= -2.8598954228111  delta_E= -9.42e-11  |g|= 3.46e-07  |ddm|= 2.26e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8860561821024873  E_coul = 1.0261607592913884
  HOMO = -0.91686733175986  LUMO = 0.815052180643865
  mo_energy =
[ -0.91686733   0.81505218   5.20001361  26.56237996 173.72908784]
E1 = -3.8860562378733197  E_coul = 1.0261608150622112
Extra cycle  E= -2.85989542281111  delta_E= -9.77e-15  |g|= 2.12e-08  |ddm|= 1.1e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.07 sec
exp = [98.00746336 14.75589087  3.31737752  0.87399731  0.24462609]
E = -2.8598954228111086
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

# basis_string = '\n'.join([f'''
#     He  S
#         {x}              1.0'''
#         for x in exponent])

def He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent):
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {x}              1.0'''
        for x in exponent])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n):
    x0 = [0.5 * (n-i) for i in range(n)]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        # options={"xtol": 1e-8, "ftol": 1e-8},
    )
    print(res)

minimize_energy(5)

#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Mon Mar  6 15:20:19 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  98.0074633614        1
[INPUT] 0    0    [1    /1   ]  14.7558908718        1
[INPUT] 0    0    [1    /1   ]  3.3173775223         1
[INPUT] 0    0    [1    /1   ]  0.873997305869       1
[INPUT] 0    0    [1    /1   ]  0.24462608981        1

nuclear repulsion = 0
number of shells = 5
number of NR pGTOs = 5
number of NR cGTOs = 5
basis = {'He': [[0, [98.00746336142836, 1.0]], [0, [14.755890871800585, 1.0]], [0, [3.317377522302804, 1.0]], [0, [0.8739973058687156, 1.0]], [0, [0.24462608981040848, 1.0]]]}
ecp = {}
CPU time:       210.20
Set gradient conv threshold to 3.16228e-05
cond(S) = 35.25640466390755
E1 = -3.883012596940141  E_coul = 1.0236823690728498
init E= -2.85933022786729
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.918097080882226  LUMO = 0.814176506295897
  mo_energy =
[ -0.91809708   0.81417651   5.19734274  26.56011379 173.7279807 ]
E1 = -3.8855355106415783  E_coul = 1.025642757134882
cycle= 1 E= -2.8598927535067  delta_E= -0.000563  |g|= 0.00425  |ddm|= 0.0235
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.917126132573869  LUMO = 0.814926570834119
  mo_energy =
[ -0.91712613   0.81492657   5.19949231  26.56169518 173.72838904]
E1 = -3.8859585952316635  E_coul = 1.026063233899241
cycle= 2 E= -2.85989536133242  delta_E= -2.61e-06  |g|= 0.000583  |ddm|= 0.0033
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.916887020650155  LUMO = 0.81504442854795
  mo_energy =
[ -0.91688702   0.81504443   5.19997685  26.56231323 173.72900313]
E1 = -3.8860513177122233  E_coul = 1.026155894995363
cycle= 3 E= -2.85989542271686  delta_E= -6.14e-08  |g|= 2.04e-05  |ddm|= 0.000573
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.916867738039439  LUMO = 0.815052050443739
  mo_energy =
[ -0.91686774   0.81505205   5.2000129   26.56237831 173.72908554]
E1 = -3.8860561821024873  E_coul = 1.0261607592913884
cycle= 4 E= -2.8598954228111  delta_E= -9.42e-11  |g|= 3.46e-07  |ddm|= 2.26e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8860561821024873  E_coul = 1.0261607592913884
  HOMO = -0.91686733175986  LUMO = 0.815052180643865
  mo_energy =
[ -0.91686733   0.81505218   5.20001361  26.56237996 173.72908784]
E1 = -3.8860562378733197  E_coul = 1.0261608150622112
Extra cycle  E= -2.85989542281111  delta_E= -9.77e-15  |g|= 2.12e-08  |ddm|= 1.1e-07
    CPU time for scf_cycle      0.06 sec, wall time      0.06 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 35.25640466390755
E1 = -3.8860562378733197  E_coul = 1.0261608150622112
init E= -2.85989542281111
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.91686730387445  LUMO = 0.815052190009922
  mo_energy =
[ -0.9168673    0.81505219   5.20001366  26.56238007 173.72908799]
E1 = -3.886056242428027  E_coul = 1.0261608196169179
cycle= 1 E= -2.85989542281111  delta_E= -4.44e-16  |g|= 1.96e-09  |ddm|= 1.16e-08
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.886056242428027  E_coul = 1.0261608196169179
  HOMO = -0.916867301597097  LUMO = 0.815052190840185
  mo_energy =
[ -0.9168673    0.81505219   5.20001366  26.56238008 173.729088  ]
E1 = -3.886056242894647  E_coul = 1.0261608200835364
Extra cycle  E= -2.85989542281111  delta_E= -1.33e-15  |g|= 2.88e-10  |ddm|= 1.72e-09
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [98.00746336 14.75589087  3.31737752  0.87399731  0.24462609]
grad_E = [-2.63976232e-09 -3.04551839e-07  1.85684474e-06 -2.01358990e-05
  8.69666170e-05]
 message: Optimization terminated successfully
 success: True
  status: 0
     fun: -2.8598954228111086
       x: [ 9.801e+01  1.476e+01  3.317e+00  8.740e-01  2.446e-01]
     nit: 74
     jac: [-2.640e-09 -3.046e-07  1.857e-06 -2.014e-05  8.697e-05]
    nfev: 79
    njev: 74
