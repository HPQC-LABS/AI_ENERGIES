#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:04 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3                    1
[INPUT] 0    0    [1    /1   ]  2.5                  1
[INPUT] 0    0    [1    /1   ]  2                    1
[INPUT] 0    0    [1    /1   ]  1.5                  1
[INPUT] 0    0    [1    /1   ]  1                    1
[INPUT] 0    0    [1    /1   ]  0.5                  1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.0, 1.0]], [0, [2.5, 1.0]], [0, [2.0, 1.0]], [0, [1.5, 1.0]], [0, [1.0, 1.0]], [0, [0.5, 1.0]]]}
ecp = {}
CPU time:         1.66
Set gradient conv threshold to 3.16228e-05
cond(S) = 10761092.608246949
E1 = -3.770573078871603  E_coul = 1.0185860896801937
init E= -2.75198698919141
    CPU time for initialize scf      0.11 sec, wall time      0.11 sec
  HOMO = -0.882965639823599  LUMO = 0.99621642145208
  mo_energy =
[-0.88296564  0.99621642  3.5119274   7.4816207  14.56494207 24.48846315]
E1 = -3.816766140936807  E_coul = 1.0305959963562783
cycle= 1 E= -2.78617014458053  delta_E= -0.0342  |g|= 0.0406  |ddm|= 1.03e+03
    CPU time for cycle= 1      0.25 sec, wall time      0.25 sec
  HOMO = -0.877864061757196  LUMO = 1.00391194780683
  mo_energy =
[-0.87786406  1.00391195  3.52257024  7.49231523 14.5769459  24.49956405]
E1 = -3.8178467885296077  E_coul = 1.0315044900415513
cycle= 2 E= -2.78634229848806  delta_E= -0.000172  |g|= 0.00406  |ddm|=  149
    CPU time for cycle= 2      0.07 sec, wall time      0.07 sec
  HOMO = -0.877376507613868  LUMO = 1.00432531621527
  mo_energy =
[-0.87737651  1.00432532  3.52332902  7.49311594 14.57791384 24.50043754]
E1 = -3.8181970853601026  E_coul = 1.0318518584904792
cycle= 3 E= -2.78634522686962  delta_E= -2.93e-06  |g|= 0.00027  |ddm|= 15.7
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.877219555367696  LUMO = 1.00438579018967
  mo_energy =
[-0.87721956  1.00438579  3.52346862  7.49330615 14.57816149 24.50077713]
E1 = -3.818245538483353  E_coul = 1.0319002960956285
cycle= 4 E= -2.78634524238772  delta_E= -1.55e-08  |g|= 1.16e-05  |ddm|= 0.623
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.877223031915293  LUMO = 1.00438440794534
  mo_energy =
[-0.87722303  1.00438441  3.52346573  7.49330213 14.57815625 24.50076991]
E1 = -3.8182444070266923  E_coul = 1.0318991646305293
cycle= 5 E= -2.78634524239616  delta_E= -8.44e-12  |g|= 9.2e-08  |ddm|= 0.00726
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.8182444070266923  E_coul = 1.0318991646305293
  HOMO = -0.877223038882805  LUMO = 1.00438440041286
  mo_energy =
[-0.87722304  1.0043844   3.52346572  7.49330213 14.57815625 24.50076991]
E1 = -3.8182444105214235  E_coul = 1.031899168106258
Extra cycle  E= -2.78634524241517  delta_E= -1.9e-11  |g|= 4.62e-09  |ddm|= 8.89e-05
    CPU time for scf_cycle      0.47 sec, wall time      0.47 sec
exp = [3.  2.5 2.  1.5 1.  0.5]
E = -2.7863452424151656
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:04 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3                    1
[INPUT] 0    0    [1    /1   ]  2.5                  1
[INPUT] 0    0    [1    /1   ]  2                    1
[INPUT] 0    0    [1    /1   ]  1.5                  1
[INPUT] 0    0    [1    /1   ]  1                    1
[INPUT] 0    0    [1    /1   ]  0.5                  1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.0, 1.0]], [0, [2.5, 1.0]], [0, [2.0, 1.0]], [0, [1.5, 1.0]], [0, [1.0, 1.0]], [0, [0.5, 1.0]]]}
ecp = {}
CPU time:         2.25
Set gradient conv threshold to 3.16228e-05
cond(S) = 10761092.608246949
E1 = -3.770573078871603  E_coul = 1.0185860896801937
init E= -2.75198698919141
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.882965639823599  LUMO = 0.99621642145208
  mo_energy =
[-0.88296564  0.99621642  3.5119274   7.4816207  14.56494207 24.48846315]
E1 = -3.816766140936807  E_coul = 1.0305959963562783
cycle= 1 E= -2.78617014458053  delta_E= -0.0342  |g|= 0.0406  |ddm|= 1.03e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.877864061757196  LUMO = 1.00391194780683
  mo_energy =
[-0.87786406  1.00391195  3.52257024  7.49231523 14.5769459  24.49956405]
E1 = -3.8178467885296077  E_coul = 1.0315044900415513
cycle= 2 E= -2.78634229848806  delta_E= -0.000172  |g|= 0.00406  |ddm|=  149
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.877376507613868  LUMO = 1.00432531621527
  mo_energy =
[-0.87737651  1.00432532  3.52332902  7.49311594 14.57791384 24.50043754]
E1 = -3.8181970853601026  E_coul = 1.0318518584904792
cycle= 3 E= -2.78634522686962  delta_E= -2.93e-06  |g|= 0.00027  |ddm|= 15.7
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.877219555367696  LUMO = 1.00438579018967
  mo_energy =
[-0.87721956  1.00438579  3.52346862  7.49330615 14.57816149 24.50077713]
E1 = -3.818245538483353  E_coul = 1.0319002960956285
cycle= 4 E= -2.78634524238772  delta_E= -1.55e-08  |g|= 1.16e-05  |ddm|= 0.623
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.877223031915293  LUMO = 1.00438440794534
  mo_energy =
[-0.87722303  1.00438441  3.52346573  7.49330213 14.57815625 24.50076991]
E1 = -3.8182444070266923  E_coul = 1.0318991646305293
cycle= 5 E= -2.78634524239616  delta_E= -8.44e-12  |g|= 9.2e-08  |ddm|= 0.00726
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.8182444070266923  E_coul = 1.0318991646305293
  HOMO = -0.877223038882805  LUMO = 1.00438440041286
  mo_energy =
[-0.87722304  1.0043844   3.52346572  7.49330213 14.57815625 24.50076991]
E1 = -3.8182444105214235  E_coul = 1.031899168106258
Extra cycle  E= -2.78634524241517  delta_E= -1.9e-11  |g|= 4.62e-09  |ddm|= 8.89e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 10761092.608246949
E1 = -3.8182444105214235  E_coul = 1.031899168106258
init E= -2.78634524241517
    CPU time for initialize scf      0.24 sec, wall time      0.24 sec
  HOMO = -0.87722303715445  LUMO = 1.00438440014708
  mo_energy =
[-0.87722304  1.0043844   3.52346572  7.49330212 14.57815623 24.50076985]
E1 = -3.8182444111609475  E_coul = 1.0318991687607322
cycle= 1 E= -2.78634524240022  delta_E= 1.5e-11  |g|= 3.37e-09  |ddm|= 1.66e-05
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8182444111609475  E_coul = 1.0318991687607322
  HOMO = -0.877223036819758  LUMO = 1.00438440189141
  mo_energy =
[-0.87722304  1.0043844   3.52346572  7.49330213 14.57815626 24.50076992]
E1 = -3.818244411186164  E_coul = 1.0318991688206078
Extra cycle  E= -2.78634524236556  delta_E= 3.47e-11  |g|= 4.27e-09  |ddm|= 9.36e-06
    CPU time for scf_cycle      0.80 sec, wall time      0.81 sec
exp = [3.  2.5 2.  1.5 1.  0.5]
grad_E = [-0.00760793 -0.00647965 -0.00520961 -0.00278553  0.00241137  0.06740603]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:09 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.00760792682        1
[INPUT] 0    0    [1    /1   ]  2.50647965478        1
[INPUT] 0    0    [1    /1   ]  2.005209606          1
[INPUT] 0    0    [1    /1   ]  1.50278552627        1
[INPUT] 0    0    [1    /1   ]  0.99758862509        1
[INPUT] 0    0    [1    /1   ]  0.432593970013       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.0076079268200546, 1.0]], [0, [2.5064796547787154, 1.0]], [0, [2.0052096060041187, 1.0]], [0, [1.5027855262719685, 1.0]], [0, [0.9975886250904036, 1.0]], [0, [0.43259397001279787, 1.0]]]}
ecp = {}
CPU time:         6.45
Set gradient conv threshold to 3.16228e-05
cond(S) = 9113796.122206548
E1 = -3.7840567164215413  E_coul = 1.019253706815073
init E= -2.76480300960647
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.885258710998005  LUMO = 0.922882234141048
  mo_energy =
[-0.88525871  0.92288223  3.35754728  7.28120337 14.34142761 24.27031031]
E1 = -3.8163830870864186  E_coul = 1.0253195405288222
cycle= 1 E= -2.7910635465576  delta_E= -0.0263  |g|= 0.0355  |ddm|=  642
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.882932444673727  LUMO = 0.928408383599546
  mo_energy =
[-0.88293244  0.92840838  3.36500695  7.28799553 14.34857434 24.27489062]
E1 = -3.8172128093614632  E_coul = 1.0260138570175628
cycle= 2 E= -2.7911989523439  delta_E= -0.000135  |g|= 0.0036  |ddm|=  139
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.882560994438512  LUMO = 0.92874763784107
  mo_energy =
[-0.88256099  0.92874764  3.36564767  7.28865497 14.34935284 24.27551931]
E1 = -3.8175243550366327  E_coul = 1.0263230029568768
cycle= 3 E= -2.79120135207976  delta_E= -2.4e-06  |g|= 0.000257  |ddm|= 14.5
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.882413120045151  LUMO = 0.928802946960206
  mo_energy =
[-0.88241312  0.92880295  3.36578067  7.2888371  14.34958975 24.27584115]
E1 = -3.817571310390983  E_coul = 1.0263699434612896
cycle= 4 E= -2.79120136692969  delta_E= -1.48e-08  |g|= 1.07e-05  |ddm|= 0.644
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.882416228418132  LUMO = 0.928801688925529
  mo_energy =
[-0.88241623  0.92880169  3.36577799  7.28883339 14.34958494 24.27583453]
E1 = -3.8175702612196583  E_coul = 1.0263688942931648
cycle= 5 E= -2.79120136692649  delta_E= 3.2e-12  |g|= 8.49e-08  |ddm|= 0.0101
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.8175702612196583  E_coul = 1.0263688942931648
  HOMO = -0.882416236316673  LUMO = 0.928801682655611
  mo_energy =
[-0.88241624  0.92880168  3.36577798  7.28883339 14.34958494 24.27583454]
E1 = -3.8175702639153446  E_coul = 1.0263688969642735
Extra cycle  E= -2.79120136695107  delta_E= -2.46e-11  |g|= 4.28e-09  |ddm|= 9.84e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [3.00760793 2.50647965 2.00520961 1.50278553 0.99758863 0.43259397]
E = -2.7912013669510713
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:09 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.00760792682        1
[INPUT] 0    0    [1    /1   ]  2.50647965478        1
[INPUT] 0    0    [1    /1   ]  2.005209606          1
[INPUT] 0    0    [1    /1   ]  1.50278552627        1
[INPUT] 0    0    [1    /1   ]  0.99758862509        1
[INPUT] 0    0    [1    /1   ]  0.432593970013       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.0076079268200546, 1.0]], [0, [2.5064796547787154, 1.0]], [0, [2.0052096060041187, 1.0]], [0, [1.5027855262719685, 1.0]], [0, [0.9975886250904036, 1.0]], [0, [0.43259397001279787, 1.0]]]}
ecp = {}
CPU time:         6.56
Set gradient conv threshold to 3.16228e-05
cond(S) = 9113796.122206548
E1 = -3.7840567164215413  E_coul = 1.019253706815073
init E= -2.76480300960647
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.885258710998005  LUMO = 0.922882234141048
  mo_energy =
[-0.88525871  0.92288223  3.35754728  7.28120337 14.34142761 24.27031031]
E1 = -3.8163830870864186  E_coul = 1.0253195405288222
cycle= 1 E= -2.7910635465576  delta_E= -0.0263  |g|= 0.0355  |ddm|=  642
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.882932444673727  LUMO = 0.928408383599546
  mo_energy =
[-0.88293244  0.92840838  3.36500695  7.28799553 14.34857434 24.27489062]
E1 = -3.8172128093614632  E_coul = 1.0260138570175628
cycle= 2 E= -2.7911989523439  delta_E= -0.000135  |g|= 0.0036  |ddm|=  139
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.882560994438512  LUMO = 0.92874763784107
  mo_energy =
[-0.88256099  0.92874764  3.36564767  7.28865497 14.34935284 24.27551931]
E1 = -3.8175243550366327  E_coul = 1.0263230029568768
cycle= 3 E= -2.79120135207976  delta_E= -2.4e-06  |g|= 0.000257  |ddm|= 14.5
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.882413120045151  LUMO = 0.928802946960206
  mo_energy =
[-0.88241312  0.92880295  3.36578067  7.2888371  14.34958975 24.27584115]
E1 = -3.817571310390983  E_coul = 1.0263699434612896
cycle= 4 E= -2.79120136692969  delta_E= -1.48e-08  |g|= 1.07e-05  |ddm|= 0.644
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.882416228418132  LUMO = 0.928801688925529
  mo_energy =
[-0.88241623  0.92880169  3.36577799  7.28883339 14.34958494 24.27583453]
E1 = -3.8175702612196583  E_coul = 1.0263688942931648
cycle= 5 E= -2.79120136692649  delta_E= 3.2e-12  |g|= 8.49e-08  |ddm|= 0.0101
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.8175702612196583  E_coul = 1.0263688942931648
  HOMO = -0.882416236316673  LUMO = 0.928801682655611
  mo_energy =
[-0.88241624  0.92880168  3.36577798  7.28883339 14.34958494 24.27583454]
E1 = -3.8175702639153446  E_coul = 1.0263688969642735
Extra cycle  E= -2.79120136695107  delta_E= -2.46e-11  |g|= 4.28e-09  |ddm|= 9.84e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 9113796.122206548
E1 = -3.8175702639153446  E_coul = 1.0263688969642735
init E= -2.79120136695107
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.882416234993431  LUMO = 0.928801681566194
  mo_energy =
[-0.88241623  0.92880168  3.36577797  7.28883337 14.34958491 24.27583447]
E1 = -3.817570264461305  E_coul = 1.026368897538475
cycle= 1 E= -2.79120136692283  delta_E= 2.82e-11  |g|= 3.62e-09  |ddm|= 1.78e-05
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.817570264461305  E_coul = 1.026368897538475
  HOMO = -0.882416234692164  LUMO = 0.928801683007249
  mo_energy =
[-0.88241623  0.92880168  3.36577798  7.28883339 14.34958494 24.27583454]
E1 = -3.817570264470885  E_coul = 1.0263688975309246
Extra cycle  E= -2.79120136693996  delta_E= -1.71e-11  |g|= 2.05e-09  |ddm|= 1.17e-05
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [3.00760793 2.50647965 2.00520961 1.50278553 0.99758863 0.43259397]
grad_E = [-0.00787039 -0.00694311 -0.00603975 -0.00443732 -0.00198914  0.07211958]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:11 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.04766760891        1
[INPUT] 0    0    [1    /1   ]  2.54179797074        1
[INPUT] 0    0    [1    /1   ]  2.03589298545        1
[INPUT] 0    0    [1    /1   ]  1.52523123236        1
[INPUT] 0    0    [1    /1   ]  1.00731000106        1
[INPUT] 0    0    [1    /1   ]  0.0657255975838      1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.0476676089137174, 1.0]], [0, [2.5417979707446827, 1.0]], [0, [2.035892985447032, 1.0]], [0, [1.5252312323629376, 1.0]], [0, [1.0073100010572371, 1.0]], [0, [0.06572559758378743, 1.0]]]}
ecp = {}
CPU time:         8.57
Set gradient conv threshold to 3.16228e-05
cond(S) = 4271089.047443492
E1 = -3.768042091056859  E_coul = 1.018511996783447
init E= -2.74953009427341
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.881924394643747  LUMO = 0.198748374295344
  mo_energy =
[-0.88192439  0.19874837  2.19176363  6.03595611 13.12311211 23.16868354]
E1 = -3.807996439886397  E_coul = 1.0242933625156154
cycle= 1 E= -2.78370307737078  delta_E= -0.0342  |g|= 0.0379  |ddm|= 6.54e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.879760822214442  LUMO = 0.201639512380297
  mo_energy =
[-0.87976082  0.20163951  2.19738455  6.0423863  13.13022348 23.17332272]
E1 = -3.8063409146594585  E_coul = 1.0225137252700764
cycle= 2 E= -2.78382718938938  delta_E= -0.000124  |g|= 0.00296  |ddm|=  305
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.880754564785155  LUMO = 0.201411155648785
  mo_energy =
[-0.88075456  0.20141116  2.19635251  6.04103466 13.12861254 23.1710402 ]
E1 = -3.806040237779899  E_coul = 1.0222109505607646
cycle= 3 E= -2.78382928721913  delta_E= -2.1e-06  |g|= 0.000268  |ddm|= 26.6
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.880831103279004  LUMO = 0.201391575570081
  mo_energy =
[-0.8808311   0.20139158  2.19622917  6.04089863 13.12845907 23.17089026]
E1 = -3.8059889852036988  E_coul = 1.0221596745606174
cycle= 4 E= -2.78382931064308  delta_E= -2.34e-08  |g|= 2.32e-05  |ddm|= 0.654
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.880834631287357  LUMO = 0.201392365654018
  mo_energy =
[-0.88083463  0.20139237  2.19622975  6.04089639 13.12845482 23.17088182]
E1 = -3.80598955525141  E_coul = 1.0221602441515483
cycle= 5 E= -2.78382931109986  delta_E= -4.57e-10  |g|= 7.52e-07  |ddm|= 0.11
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.80598955525141  E_coul = 1.0221602441515483
  HOMO = -0.880834533473981  LUMO = 0.20139236609991
  mo_energy =
[-0.88083453  0.20139237  2.19622978  6.04089644 13.12845489 23.17088197]
E1 = -3.8059895678222513  E_coul = 1.0221602558207827
Extra cycle  E= -2.78382931200147  delta_E= -9.02e-10  |g|= 6.3e-08  |ddm|= 0.00339
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [3.04766761 2.54179797 2.03589299 1.52523123 1.00731    0.0657256 ]
E = -2.7838293120014685
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:11 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.0233818171         1
[INPUT] 0    0    [1    /1   ]  2.52038658594        1
[INPUT] 0    0    [1    /1   ]  2.01729148573        1
[INPUT] 0    0    [1    /1   ]  1.51162374182        1
[INPUT] 0    0    [1    /1   ]  1.00141651163        1
[INPUT] 0    0    [1    /1   ]  0.288135972521       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.023381817104174, 1.0]], [0, [2.5203865859361936, 1.0]], [0, [2.0172914857291473, 1.0]], [0, [1.5116237418224745, 1.0]], [0, [1.001416511631115, 1.0]], [0, [0.2881359725209979, 1.0]]]}
ecp = {}
CPU time:         8.70
Set gradient conv threshold to 3.16228e-05
cond(S) = 6689892.775379414
E1 = -3.813173996204119  E_coul = 1.020728624828684
init E= -2.79244537137544
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.890335932277995  LUMO = 0.721468158142361
  mo_energy =
[-0.89033593  0.72146816  2.97460968  6.82715881 13.87194406 23.83468015]
E1 = -3.814430094931999  E_coul = 1.0125586334009182
cycle= 1 E= -2.80187146153108  delta_E= -0.00943  |g|= 0.0208  |ddm|= 1.06e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.894677932503322  LUMO = 0.722436085296531
  mo_energy =
[-0.89467793  0.72243609  2.97454966  6.82442928 13.86721115 23.82348117]
E1 = -3.814479619797896  E_coul = 1.012559843591626
cycle= 2 E= -2.80191977620627  delta_E= -4.83e-05  |g|= 0.00213  |ddm|=   91
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.89468060058336  LUMO = 0.722567152761372
  mo_energy =
[-0.8946806   0.72256715  2.97480185  6.82459891 13.8673507  23.82330889]
E1 = -3.8146498944006755  E_coul = 1.012729194615967
cycle= 3 E= -2.80192069978471  delta_E= -9.24e-07  |g|= 0.000186  |ddm|= 9.56
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.894576064942975  LUMO = 0.722602897927906
  mo_energy =
[-0.89457606  0.7226029   2.97490078  6.82473455 13.86752487 23.82353917]
E1 = -3.814685864569408  E_coul = 1.0127651557651989
cycle= 4 E= -2.80192070880421  delta_E= -9.02e-09  |g|= 7.98e-06  |ddm|= 0.613
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.894578163075332  LUMO = 0.722601994319359
  mo_energy =
[-0.89457816  0.72260199  2.97489871  6.82473182 13.86752144 23.8235346 ]
E1 = -3.814685077363652  E_coul = 1.012764368595502
cycle= 5 E= -2.80192070876815  delta_E= 3.61e-11  |g|= 4.75e-08  |ddm|= 0.0192
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.814685077363652  E_coul = 1.012764368595502
  HOMO = -0.894578170086256  LUMO = 0.722601991098207
  mo_energy =
[-0.89457817  0.72260199  2.9748987   6.82473182 13.86752144 23.82353462]
E1 = -3.814685077376635  E_coul = 1.0127643685372625
Extra cycle  E= -2.80192070883937  delta_E= -7.12e-11  |g|= 3.78e-09  |ddm|= 0.000136
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [3.02338182 2.52038659 2.01729149 1.51162374 1.00141651 0.28813597]
E = -2.801920708839373
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:11 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.0233818171         1
[INPUT] 0    0    [1    /1   ]  2.52038658594        1
[INPUT] 0    0    [1    /1   ]  2.01729148573        1
[INPUT] 0    0    [1    /1   ]  1.51162374182        1
[INPUT] 0    0    [1    /1   ]  1.00141651163        1
[INPUT] 0    0    [1    /1   ]  0.288135972521       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.023381817104174, 1.0]], [0, [2.5203865859361936, 1.0]], [0, [2.0172914857291473, 1.0]], [0, [1.5116237418224745, 1.0]], [0, [1.001416511631115, 1.0]], [0, [0.2881359725209979, 1.0]]]}
ecp = {}
CPU time:         8.83
Set gradient conv threshold to 3.16228e-05
cond(S) = 6689892.775379414
E1 = -3.813173996204119  E_coul = 1.020728624828684
init E= -2.79244537137544
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.890335932277995  LUMO = 0.721468158142361
  mo_energy =
[-0.89033593  0.72146816  2.97460968  6.82715881 13.87194406 23.83468015]
E1 = -3.814430094931999  E_coul = 1.0125586334009182
cycle= 1 E= -2.80187146153108  delta_E= -0.00943  |g|= 0.0208  |ddm|= 1.06e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.894677932503322  LUMO = 0.722436085296531
  mo_energy =
[-0.89467793  0.72243609  2.97454966  6.82442928 13.86721115 23.82348117]
E1 = -3.814479619797896  E_coul = 1.012559843591626
cycle= 2 E= -2.80191977620627  delta_E= -4.83e-05  |g|= 0.00213  |ddm|=   91
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.89468060058336  LUMO = 0.722567152761372
  mo_energy =
[-0.8946806   0.72256715  2.97480185  6.82459891 13.8673507  23.82330889]
E1 = -3.8146498944006755  E_coul = 1.012729194615967
cycle= 3 E= -2.80192069978471  delta_E= -9.24e-07  |g|= 0.000186  |ddm|= 9.56
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.894576064942975  LUMO = 0.722602897927906
  mo_energy =
[-0.89457606  0.7226029   2.97490078  6.82473455 13.86752487 23.82353917]
E1 = -3.814685864569408  E_coul = 1.0127651557651989
cycle= 4 E= -2.80192070880421  delta_E= -9.02e-09  |g|= 7.98e-06  |ddm|= 0.613
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.894578163075332  LUMO = 0.722601994319359
  mo_energy =
[-0.89457816  0.72260199  2.97489871  6.82473182 13.86752144 23.8235346 ]
E1 = -3.814685077363652  E_coul = 1.012764368595502
cycle= 5 E= -2.80192070876815  delta_E= 3.61e-11  |g|= 4.75e-08  |ddm|= 0.0192
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.814685077363652  E_coul = 1.012764368595502
  HOMO = -0.894578170086256  LUMO = 0.722601991098207
  mo_energy =
[-0.89457817  0.72260199  2.9748987   6.82473182 13.86752144 23.82353462]
E1 = -3.814685077376635  E_coul = 1.0127643685372625
Extra cycle  E= -2.80192070883937  delta_E= -7.12e-11  |g|= 3.78e-09  |ddm|= 0.000136
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 6689892.775379414
E1 = -3.814685077376635  E_coul = 1.0127643685372625
init E= -2.80192070883937
    CPU time for initialize scf      0.03 sec, wall time      0.04 sec
  HOMO = -0.894578170151067  LUMO = 0.722601990605116
  mo_energy =
[-0.89457817  0.72260199  2.9748987   6.82473181 13.86752142 23.82353455]
E1 = -3.8146850775050103  E_coul = 1.012764368731291
cycle= 1 E= -2.80192070877372  delta_E= 6.57e-11  |g|= 5.17e-09  |ddm|= 1.69e-05
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8146850775050103  E_coul = 1.012764368731291
  HOMO = -0.894578170021234  LUMO = 0.722601991230833
  mo_energy =
[-0.89457817  0.72260199  2.9748987   6.82473182 13.86752144 23.82353462]
E1 = -3.8146850774384347  E_coul = 1.0127643686493861
Extra cycle  E= -2.80192070878905  delta_E= -1.53e-11  |g|= 1.46e-09  |ddm|= 2.03e-05
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [3.02338182 2.52038659 2.01729149 1.51162374 1.00141651 0.28813597]
grad_E = [-0.00807233 -0.0075298  -0.0072786  -0.00714573 -0.0092632   0.06320956]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:13 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.06373171996        1
[INPUT] 0    0    [1    /1   ]  2.55709431469        1
[INPUT] 0    0    [1    /1   ]  2.05120341717        1
[INPUT] 0    0    [1    /1   ]  1.54142843928        1
[INPUT] 0    0    [1    /1   ]  1.0312310526         1
[INPUT] 0    0    [1    /1   ]  1.00000000014e-06      1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.063731719957442, 1.0]], [0, [2.557094314689148, 1.0]], [0, [2.051203417168558, 1.0]], [0, [1.541428439281668, 1.0]], [0, [1.0312310526014743, 1.0]], [0, [1.000000000139778e-06, 1.0]]]}
ecp = {}
CPU time:        10.80
Set gradient conv threshold to 3.16228e-05
cond(S) = 4229619.000928752
E1 = -3.641281629494649  E_coul = 1.0139262023070228
init E= -2.62735542718763
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.861239776576091  LUMO = -6.10694059211592e-05
  mo_energy =
[-8.61239777e-01 -6.10694059e-05  2.00213857e+00  5.90902678e+00
  1.30711502e+01  2.32030646e+01]
E1 = -3.8321330275893066  E_coul = 1.0920347851335646
cycle= 1 E= -2.74009824245574  delta_E= -0.113  |g|= 0.0746  |ddm|= 1.68e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.824201174610675  LUMO = 1.51042177632317e-06
  mo_energy =
[-8.24201175e-01  1.51042178e-06  2.04627672e+00  5.96679567e+00
  1.31402092e+01  2.32862747e+01]
E1 = -3.833898698825661  E_coul = 1.0934309685498502
cycle= 2 E= -2.74046773027581  delta_E= -0.000369  |g|= 0.00597  |ddm|=  710
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.823454672997194  LUMO = 1.51039884473546e-06
  mo_energy =
[-8.23454673e-01  1.51039884e-06  2.04712089e+00  5.96798354e+00
  1.31417142e+01  2.32875818e+01]
E1 = -3.834218680177839  E_coul = 1.0937474744170879
cycle= 3 E= -2.74047120576075  delta_E= -3.48e-06  |g|= 0.000194  |ddm|= 59.2
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.823350519144613  LUMO = 1.51039877547639e-06
  mo_energy =
[-8.23350519e-01  1.51039878e-06  2.04717744e+00  5.96809758e+00
  1.31418676e+01  2.32878082e+01]
E1 = -3.8342419180122884  E_coul = 1.093770707533415
cycle= 4 E= -2.74047121047887  delta_E= -4.72e-09  |g|= 1.02e-05  |ddm|= 0.442
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.823350169794986  LUMO = 1.51039874823569e-06
  mo_energy =
[-8.23350170e-01  1.51039875e-06  2.04717818e+00  5.96809867e+00
  1.31418689e+01  2.32878090e+01]
E1 = -3.8342421097174815  E_coul = 1.0937708957635035
cycle= 5 E= -2.74047121395398  delta_E= -3.48e-09  |g|= 6.95e-08  |ddm|= 0.0878
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.823350163647265  LUMO = 1.51039874828014e-06
  mo_energy =
[-8.23350164e-01  1.51039875e-06  2.04717817e+00  5.96809862e+00
  1.31418688e+01  2.32878087e+01]
E1 = -3.834242110853252  E_coul = 1.0937708985670092
cycle= 6 E= -2.74047121228624  delta_E= 1.67e-09  |g|= 2.57e-08  |ddm|= 0.000169
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.823350161140636  LUMO = 1.51039874870666e-06
  mo_energy =
[-8.23350161e-01  1.51039875e-06  2.04717817e+00  5.96809862e+00
  1.31418688e+01  2.32878087e+01]
E1 = -3.8342421115700396  E_coul = 1.0937709011449097
cycle= 7 E= -2.74047121042513  delta_E= 1.86e-09  |g|= 7.12e-08  |ddm|= 9.31e-05
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.823350159375865  LUMO = 1.51039874874199e-06
  mo_energy =
[-8.23350159e-01  1.51039875e-06  2.04717817e+00  5.96809863e+00
  1.31418688e+01  2.32878087e+01]
E1 = -3.8342421122203776  E_coul = 1.0937709007048046
cycle= 8 E= -2.74047121151557  delta_E= -1.09e-09  |g|= 2.25e-08  |ddm|= 0.000163
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.823350158511001  LUMO = 1.51039874878481e-06
  mo_energy =
[-8.23350159e-01  1.51039875e-06  2.04717817e+00  5.96809864e+00
  1.31418688e+01  2.32878087e+01]
E1 = -3.8342421124808954  E_coul = 1.0937708995546984
cycle= 9 E= -2.7404712129262  delta_E= -1.41e-09  |g|= 2.79e-08  |ddm|= 4.43e-05
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.823350159899089  LUMO = 1.51039874904585e-06
  mo_energy =
[-8.23350160e-01  1.51039875e-06  2.04717817e+00  5.96809862e+00
  1.31418688e+01  2.32878087e+01]
E1 = -3.834242111547618  E_coul = 1.0937709000790918
cycle= 10 E= -2.74047121146853  delta_E= 1.46e-09  |g|= 7.59e-08  |ddm|= 0.000474
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.823350155775534  LUMO = 1.51039874896309e-06
  mo_energy =
[-8.23350156e-01  1.51039875e-06  2.04717817e+00  5.96809863e+00
  1.31418688e+01  2.32878087e+01]
E1 = -3.834242113137727  E_coul = 1.093770900938845
cycle= 11 E= -2.74047121219888  delta_E= -7.3e-10  |g|= 9.94e-10  |ddm|= 0.000503
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
E1 = -3.834242113137727  E_coul = 1.093770900938845
  HOMO = -0.823350155629994  LUMO = 1.5103987494635e-06
  mo_energy =
[-8.23350156e-01  1.51039875e-06  2.04717817e+00  5.96809862e+00
  1.31418688e+01  2.32878087e+01]
E1 = -3.8342421130304287  E_coul = 1.0937709013800836
Extra cycle  E= -2.74047121165035  delta_E= 5.49e-10  |g|= 1.48e-08  |ddm|= 1.76e-06
    CPU time for scf_cycle      0.13 sec, wall time      0.13 sec
exp = [3.06373172e+00 2.55709431e+00 2.05120342e+00 1.54142844e+00
 1.03123105e+00 1.00000000e-06]
E = -2.740471211650345
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:13 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.02825142088        1
[INPUT] 0    0    [1    /1   ]  2.52481663612        1
[INPUT] 0    0    [1    /1   ]  2.02138412679        1
[INPUT] 0    0    [1    /1   ]  1.51522070382        1
[INPUT] 0    0    [1    /1   ]  1.00501466159        1
[INPUT] 0    0    [1    /1   ]  0.253362576563       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.0282514208753253, 1.0]], [0, [2.5248166361153928, 1.0]], [0, [2.0213841267901405, 1.0]], [0, [1.5152207038194612, 1.0]], [0, [1.0050146615863296, 1.0]], [0, [0.25336257656286676, 1.0]]]}
ecp = {}
CPU time:        11.00
Set gradient conv threshold to 3.16228e-05
cond(S) = 6280143.546913654
E1 = -3.8189155801812005  E_coul = 1.0210259034351816
init E= -2.79788967674602
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.891357502181159  LUMO = 0.660949727682986
  mo_energy =
[-0.8913575   0.66094973  2.87128245  6.71668094 13.76891579 23.74927903]
E1 = -3.813571069447917  E_coul = 1.0095325487329756
cycle= 1 E= -2.80403852071494  delta_E= -0.00615  |g|= 0.0163  |ddm|=  867
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.897265969472851  LUMO = 0.661011858405548
  mo_energy =
[-0.89726597  0.66101186  2.86943705  6.71165404 13.76134282 23.73436653]
E1 = -3.8133598854996853  E_coul = 1.0092922935843922
cycle= 2 E= -2.80406759191529  delta_E= -2.91e-05  |g|= 0.00163  |ddm|= 68.4
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.897397598598969  LUMO = 0.66107986897098
  mo_energy =
[-0.8973976   0.66107987  2.86954864  6.71164291 13.76125438 23.73391571]
E1 = -3.81347625001453  E_coul = 1.0094081144063536
cycle= 3 E= -2.80406813560818  delta_E= -5.44e-07  |g|= 0.000152  |ddm|= 7.35
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.897313812127842  LUMO = 0.661107762443724
  mo_energy =
[-0.89731381  0.66110776  2.86962983  6.71175368 13.76139566 23.73410082]
E1 = -3.8135059261176805  E_coul = 1.0094377841915803
cycle= 4 E= -2.8040681419261  delta_E= -6.32e-09  |g|= 6.67e-06  |ddm|= 0.552
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.897315499081824  LUMO = 0.661107022538371
  mo_energy =
[-0.8973155   0.66110702  2.86962808  6.71175141 13.76139282 23.73409701]
E1 = -3.8135052751459106  E_coul = 1.009437133088897
cycle= 5 E= -2.80406814205701  delta_E= -1.31e-10  |g|= 2.01e-08  |ddm|= 0.0199
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.8135052751459106  E_coul = 1.009437133088897
  HOMO = -0.897315504484081  LUMO = 0.661107018607623
  mo_energy =
[-0.8973155   0.66110702  2.86962807  6.71175137 13.76139277 23.73409689]
E1 = -3.813505274498818  E_coul = 1.0094371326087548
Extra cycle  E= -2.80406814189006  delta_E= 1.67e-10  |g|= 1.37e-08  |ddm|= 9.71e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.08 sec
exp = [3.02825142 2.52481664 2.02138413 1.5152207  1.00501466 0.25336258]
E = -2.8040681418900633
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:13 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.02825142088        1
[INPUT] 0    0    [1    /1   ]  2.52481663612        1
[INPUT] 0    0    [1    /1   ]  2.02138412679        1
[INPUT] 0    0    [1    /1   ]  1.51522070382        1
[INPUT] 0    0    [1    /1   ]  1.00501466159        1
[INPUT] 0    0    [1    /1   ]  0.253362576563       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.0282514208753253, 1.0]], [0, [2.5248166361153928, 1.0]], [0, [2.0213841267901405, 1.0]], [0, [1.5152207038194612, 1.0]], [0, [1.0050146615863296, 1.0]], [0, [0.25336257656286676, 1.0]]]}
ecp = {}
CPU time:        11.14
Set gradient conv threshold to 3.16228e-05
cond(S) = 6280143.546913654
E1 = -3.8189155801812005  E_coul = 1.0210259034351816
init E= -2.79788967674602
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.891357502181159  LUMO = 0.660949727682986
  mo_energy =
[-0.8913575   0.66094973  2.87128245  6.71668094 13.76891579 23.74927903]
E1 = -3.813571069447917  E_coul = 1.0095325487329756
cycle= 1 E= -2.80403852071494  delta_E= -0.00615  |g|= 0.0163  |ddm|=  867
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.897265969472851  LUMO = 0.661011858405548
  mo_energy =
[-0.89726597  0.66101186  2.86943705  6.71165404 13.76134282 23.73436653]
E1 = -3.8133598854996853  E_coul = 1.0092922935843922
cycle= 2 E= -2.80406759191529  delta_E= -2.91e-05  |g|= 0.00163  |ddm|= 68.4
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.897397598598969  LUMO = 0.66107986897098
  mo_energy =
[-0.8973976   0.66107987  2.86954864  6.71164291 13.76125438 23.73391571]
E1 = -3.81347625001453  E_coul = 1.0094081144063536
cycle= 3 E= -2.80406813560818  delta_E= -5.44e-07  |g|= 0.000152  |ddm|= 7.35
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.897313812127842  LUMO = 0.661107762443724
  mo_energy =
[-0.89731381  0.66110776  2.86962983  6.71175368 13.76139566 23.73410082]
E1 = -3.8135059261176805  E_coul = 1.0094377841915803
cycle= 4 E= -2.8040681419261  delta_E= -6.32e-09  |g|= 6.67e-06  |ddm|= 0.552
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.897315499081824  LUMO = 0.661107022538371
  mo_energy =
[-0.8973155   0.66110702  2.86962808  6.71175141 13.76139282 23.73409701]
E1 = -3.8135052751459106  E_coul = 1.009437133088897
cycle= 5 E= -2.80406814205701  delta_E= -1.31e-10  |g|= 2.01e-08  |ddm|= 0.0199
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.8135052751459106  E_coul = 1.009437133088897
  HOMO = -0.897315504484081  LUMO = 0.661107018607623
  mo_energy =
[-0.8973155   0.66110702  2.86962807  6.71175137 13.76139277 23.73409689]
E1 = -3.813505274498818  E_coul = 1.0094371326087548
Extra cycle  E= -2.80406814189006  delta_E= 1.67e-10  |g|= 1.37e-08  |ddm|= 9.71e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 6280143.546913654
E1 = -3.813505274498818  E_coul = 1.0094371326087548
init E= -2.80406814189006
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.89731550464067  LUMO = 0.661107020363066
  mo_energy =
[-0.8973155   0.66110702  2.86962807  6.71175141 13.76139283 23.73409703]
E1 = -3.81350527416783  E_coul = 1.0094371322115654
cycle= 1 E= -2.80406814195626  delta_E= -6.62e-11  |g|= 4.72e-09  |ddm|= 6.62e-05
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.81350527416783  E_coul = 1.0094371322115654
  HOMO = -0.897315504872401  LUMO = 0.661107019731949
  mo_energy =
[-0.8973155   0.66110702  2.86962807  6.7117514  13.76139281 23.73409697]
E1 = -3.8135052741952555  E_coul = 1.0094371321992746
Extra cycle  E= -2.80406814199598  delta_E= -3.97e-11  |g|= 2.81e-09  |ddm|= 1.88e-05
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [3.02825142 2.52481664 2.02138413 1.5152207  1.00501466 0.25336258]
grad_E = [-0.00795409 -0.00746503 -0.00728165 -0.00729722 -0.00964107  0.04955632]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:15 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.05605751849        1
[INPUT] 0    0    [1    /1   ]  2.55046449585        1
[INPUT] 0    0    [1    /1   ]  2.04563111559        1
[INPUT] 0    0    [1    /1   ]  1.53782866817        1
[INPUT] 0    0    [1    /1   ]  1.03032376457        1
[INPUT] 0    0    [1    /1   ]  0.114648433472       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.056057518494926, 1.0]], [0, [2.5504644958456004, 1.0]], [0, [2.045631115586914, 1.0]], [0, [1.537828668169081, 1.0]], [0, [1.0303237645737338, 1.0]], [0, [0.1146484334722076, 1.0]]]}
ecp = {}
CPU time:        13.16
Set gradient conv threshold to 3.16228e-05
cond(S) = 5111382.843203982
E1 = -3.8080642871652213  E_coul = 1.0204588506206198
init E= -2.7876054365446
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.889347034160554  LUMO = 0.347387675472774
  mo_energy =
[-0.88934703  0.34738768  2.41196345  6.28672286 13.42276849 23.52446655]
E1 = -3.80779844505002  E_coul = 1.0081804936450491
cycle= 1 E= -2.79961795140497  delta_E= -0.012  |g|= 0.0212  |ddm|= 3.27e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.89573640442525  LUMO = 0.347412831057786
  mo_energy =
[-0.8957364   0.34741283  2.40874987  6.280643   13.41429289 23.50879897]
E1 = -3.806179751543812  E_coul = 1.0065226331514598
cycle= 2 E= -2.79965711839235  delta_E= -3.92e-05  |g|= 0.00162  |ddm|=  160
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.896638658598418  LUMO = 0.347192875904733
  mo_energy =
[-0.89663866  0.34719288  2.40792308  6.27946434 13.41282147 23.50668649]
E1 = -3.8059442318103094  E_coul = 1.0062864470518362
cycle= 3 E= -2.79965778475847  delta_E= -6.66e-07  |g|= 0.000174  |ddm|= 13.8
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.896702650718451  LUMO = 0.347173690493219
  mo_energy =
[-0.89670265  0.34717369  2.40783925  6.27936274 13.41270113 23.50655393]
E1 = -3.8059098062651158  E_coul = 1.006252011355618
cycle= 4 E= -2.7996577949095  delta_E= -1.02e-08  |g|= 1.09e-05  |ddm|= 0.718
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.896702583210852  LUMO = 0.347174361231631
  mo_energy =
[-0.89670258  0.34717436  2.40784067  6.27936369 13.41270177 23.50655337]
E1 = -3.805910526997274  E_coul = 1.0062527328643427
cycle= 5 E= -2.79965779413293  delta_E= 7.77e-10  |g|= 2.94e-07  |ddm|= 0.0608
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.805910526997274  E_coul = 1.0062527328643427
  HOMO = -0.89670253063424  LUMO = 0.347174363191538
  mo_energy =
[-0.89670253  0.34717436  2.4078407   6.27936379 13.41270193 23.50655381]
E1 = -3.8059105287943837  E_coul = 1.0062527350738626
Extra cycle  E= -2.79965779372052  delta_E= 4.12e-10  |g|= 1.79e-08  |ddm|= 0.000455
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [3.05605752 2.5504645  2.04563112 1.53782867 1.03032376 0.11464843]
E = -2.799657793720521
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:16 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.03716229692        1
[INPUT] 0    0    [1    /1   ]  2.53303587284        1
[INPUT] 0    0    [1    /1   ]  2.02915443367        1
[INPUT] 0    0    [1    /1   ]  1.52246576103        1
[INPUT] 0    0    [1    /1   ]  1.0131253387         1
[INPUT] 0    0    [1    /1   ]  0.208909573787       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.037162296919674, 1.0]], [0, [2.53303587284488, 1.0]], [0, [2.029154433669322, 1.0]], [0, [1.5224657610256371, 1.0]], [0, [1.0131253386975057, 1.0]], [0, [0.20890957378668268, 1.0]]]}
ecp = {}
CPU time:        13.32
Set gradient conv threshold to 3.16228e-05
cond(S) = 5868036.126044705
E1 = -3.823794677937604  E_coul = 1.0212817225865838
init E= -2.80251295535102
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.892240130101283  LUMO = 0.574809263813331
  mo_energy =
[-0.89224013  0.57480926  2.73493959  6.5828179  13.65840793 23.6761963 ]
E1 = -3.8121792535074217  E_coul = 1.0062788224931352
cycle= 1 E= -2.80590043101429  delta_E= -0.00339  |g|= 0.0109  |ddm|=  301
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.899815603052127  LUMO = 0.574020933029283
  mo_energy =
[-0.8998156   0.57402093  2.73111642  6.57527706 13.64777641 23.65734946]
E1 = -3.8115767445210653  E_coul = 1.005665790187659
cycle= 2 E= -2.80591095433341  delta_E= -1.05e-05  |g|= 0.000901  |ddm|= 26.6
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.900143442328195  LUMO = 0.574000338295061
  mo_energy =
[-0.90014344  0.57400034  2.73100449  6.57498004 13.64733586 23.65647465]
E1 = -3.81160660365347  E_coul = 1.0056955043897724
cycle= 3 E= -2.8059110992637  delta_E= -1.45e-07  |g|= 8.4e-05  |ddm|= 3.37
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.900098696477736  LUMO = 0.574014676208491
  mo_energy =
[-0.9000987   0.57401468  2.73104976  6.57504089 13.6474125  23.65657356]
E1 = -3.8116232302975455  E_coul = 1.005712129059628
cycle= 4 E= -2.80591110123792  delta_E= -1.97e-09  |g|= 3.99e-06  |ddm|= 0.357
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.900099669769671  LUMO = 0.574014259893932
  mo_energy =
[-0.90009967  0.57401426  2.7310487   6.57503957 13.64741089 23.65657138]
E1 = -3.811622861318042  E_coul = 1.0057117598714502
cycle= 5 E= -2.80591110144659  delta_E= -2.09e-10  |g|= 3.18e-08  |ddm|= 0.0151
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.811622861318042  E_coul = 1.0057117598714502
  HOMO = -0.900099670787648  LUMO = 0.57401425692915
  mo_energy =
[-0.90009967  0.57401426  2.7310487   6.57503954 13.64741083 23.65657124]
E1 = -3.8116228598215662  E_coul = 1.0057117585295798
Extra cycle  E= -2.80591110129199  delta_E= 1.55e-10  |g|= 1.04e-08  |ddm|= 8.51e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.08 sec
exp = [3.0371623  2.53303587 2.02915443 1.52246576 1.01312534 0.20890957]
E = -2.8059111012919864
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:16 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.03716229692        1
[INPUT] 0    0    [1    /1   ]  2.53303587284        1
[INPUT] 0    0    [1    /1   ]  2.02915443367        1
[INPUT] 0    0    [1    /1   ]  1.52246576103        1
[INPUT] 0    0    [1    /1   ]  1.0131253387         1
[INPUT] 0    0    [1    /1   ]  0.208909573787       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.037162296919674, 1.0]], [0, [2.53303587284488, 1.0]], [0, [2.029154433669322, 1.0]], [0, [1.5224657610256371, 1.0]], [0, [1.0131253386975057, 1.0]], [0, [0.20890957378668268, 1.0]]]}
ecp = {}
CPU time:        13.48
Set gradient conv threshold to 3.16228e-05
cond(S) = 5868036.126044705
E1 = -3.823794677937604  E_coul = 1.0212817225865838
init E= -2.80251295535102
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.892240130101283  LUMO = 0.574809263813331
  mo_energy =
[-0.89224013  0.57480926  2.73493959  6.5828179  13.65840793 23.6761963 ]
E1 = -3.8121792535074217  E_coul = 1.0062788224931352
cycle= 1 E= -2.80590043101429  delta_E= -0.00339  |g|= 0.0109  |ddm|=  301
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.899815603052127  LUMO = 0.574020933029283
  mo_energy =
[-0.8998156   0.57402093  2.73111642  6.57527706 13.64777641 23.65734946]
E1 = -3.8115767445210653  E_coul = 1.005665790187659
cycle= 2 E= -2.80591095433341  delta_E= -1.05e-05  |g|= 0.000901  |ddm|= 26.6
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.900143442328195  LUMO = 0.574000338295061
  mo_energy =
[-0.90014344  0.57400034  2.73100449  6.57498004 13.64733586 23.65647465]
E1 = -3.81160660365347  E_coul = 1.0056955043897724
cycle= 3 E= -2.8059110992637  delta_E= -1.45e-07  |g|= 8.4e-05  |ddm|= 3.37
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.900098696477736  LUMO = 0.574014676208491
  mo_energy =
[-0.9000987   0.57401468  2.73104976  6.57504089 13.6474125  23.65657356]
E1 = -3.8116232302975455  E_coul = 1.005712129059628
cycle= 4 E= -2.80591110123792  delta_E= -1.97e-09  |g|= 3.99e-06  |ddm|= 0.357
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.900099669769671  LUMO = 0.574014259893932
  mo_energy =
[-0.90009967  0.57401426  2.7310487   6.57503957 13.64741089 23.65657138]
E1 = -3.811622861318042  E_coul = 1.0057117598714502
cycle= 5 E= -2.80591110144659  delta_E= -2.09e-10  |g|= 3.18e-08  |ddm|= 0.0151
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.811622861318042  E_coul = 1.0057117598714502
  HOMO = -0.900099670787648  LUMO = 0.57401425692915
  mo_energy =
[-0.90009967  0.57401426  2.7310487   6.57503954 13.64741083 23.65657124]
E1 = -3.8116228598215662  E_coul = 1.0057117585295798
Extra cycle  E= -2.80591110129199  delta_E= 1.55e-10  |g|= 1.04e-08  |ddm|= 8.51e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 5868036.126044705
E1 = -3.8116228598215662  E_coul = 1.0057117585295798
init E= -2.80591110129199
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.900099671381109  LUMO = 0.574014257404158
  mo_energy =
[-0.90009967  0.57401426  2.7310487   6.57503956 13.64741087 23.65657135]
E1 = -3.81162285929842  E_coul = 1.0057117579471078
cycle= 1 E= -2.80591110135131  delta_E= -5.93e-11  |g|= 3.7e-09  |ddm|= 6.27e-05
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.81162285929842  E_coul = 1.0057117579471078
  HOMO = -0.900099671702039  LUMO = 0.574014257199592
  mo_energy =
[-0.90009967  0.57401426  2.7310487   6.57503955 13.64741086 23.6565713 ]
E1 = -3.8116228592539287  E_coul = 1.0057117578451353
Extra cycle  E= -2.80591110140879  delta_E= -5.75e-11  |g|= 3.76e-09  |ddm|= 1.09e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [3.0371623  2.53303587 2.02915443 1.52246576 1.01312534 0.20890957]
grad_E = [-0.00759863 -0.00712045 -0.00690088 -0.00682151 -0.00833751  0.01530414]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:18 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.05117036185        1
[INPUT] 0    0    [1    /1   ]  2.54601540181        1
[INPUT] 0    0    [1    /1   ]  2.04148880179        1
[INPUT] 0    0    [1    /1   ]  1.53411637369        1
[INPUT] 0    0    [1    /1   ]  1.02597060619        1
[INPUT] 0    0    [1    /1   ]  0.181443238836       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.0511703618541626, 1.0]], [0, [2.546015401813042, 1.0]], [0, [2.041488801789542, 1.0]], [0, [1.53411637368583, 1.0]], [0, [1.025970606192622, 1.0]], [0, [0.18144323883637223, 1.0]]]}
ecp = {}
CPU time:        15.34
Set gradient conv threshold to 3.16228e-05
cond(S) = 5772058.001618391
E1 = -3.8244929821779112  E_coul = 1.0213223649793275
init E= -2.80317061719858
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.892426764439889  LUMO = 0.516785354248395
  mo_energy =
[-0.89242676  0.51678535  2.65728327  6.52802269 13.649054   23.72942239]
E1 = -3.8113535219672277  E_coul = 1.0050719908215764
cycle= 1 E= -2.80628153114565  delta_E= -0.00311  |g|= 0.00955  |ddm|=  357
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.900607459571892  LUMO = 0.515744483996801
  mo_energy =
[-0.90060746  0.51574448  2.65260574  6.51946961 13.63725251 23.70915152]
E1 = -3.8104684067586145  E_coul = 1.004181202907713
cycle= 2 E= -2.8062872038509  delta_E= -5.67e-06  |g|= 0.000491  |ddm|= 12.4
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.901079899018113  LUMO = 0.515663559808724
  mo_energy =
[-0.9010799   0.51566356  2.6523189   6.51895241 13.63654789 23.70796309]
E1 = -3.8104313262321665  E_coul = 1.0041441023314333
cycle= 3 E= -2.80628722390073  delta_E= -2e-08  |g|= 1.98e-05  |ddm|= 0.227
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.901069321919473  LUMO = 0.515666710897881
  mo_energy =
[-0.90106932  0.51566671  2.65232972  6.51896679 13.63656595 23.70798704]
E1 = -3.810435104494432  E_coul = 1.0041478799164145
cycle= 4 E= -2.80628722457802  delta_E= -6.77e-10  |g|= 1.7e-06  |ddm|= 0.0891
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.810435104494432  E_coul = 1.0041478799164145
  HOMO = -0.901069672330901  LUMO = 0.515666604637908
  mo_energy =
[-0.90106967  0.5156666   2.65232939  6.5189663  13.6365653  23.70798585]
E1 = -3.8104350332562222  E_coul = 1.004147808636776
Extra cycle  E= -2.80628722461945  delta_E= -4.14e-11  |g|= 1.39e-07  |ddm|= 0.00366
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [3.05117036 2.5460154  2.0414888  1.53411637 1.02597061 0.18144324]
E = -2.806287224619446
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:18 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.05117036185        1
[INPUT] 0    0    [1    /1   ]  2.54601540181        1
[INPUT] 0    0    [1    /1   ]  2.04148880179        1
[INPUT] 0    0    [1    /1   ]  1.53411637369        1
[INPUT] 0    0    [1    /1   ]  1.02597060619        1
[INPUT] 0    0    [1    /1   ]  0.181443238836       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.0511703618541626, 1.0]], [0, [2.546015401813042, 1.0]], [0, [2.041488801789542, 1.0]], [0, [1.53411637368583, 1.0]], [0, [1.025970606192622, 1.0]], [0, [0.18144323883637223, 1.0]]]}
ecp = {}
CPU time:        15.50
Set gradient conv threshold to 3.16228e-05
cond(S) = 5772058.001618391
E1 = -3.8244929821779112  E_coul = 1.0213223649793275
init E= -2.80317061719858
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.892426764439889  LUMO = 0.516785354248395
  mo_energy =
[-0.89242676  0.51678535  2.65728327  6.52802269 13.649054   23.72942239]
E1 = -3.8113535219672277  E_coul = 1.0050719908215764
cycle= 1 E= -2.80628153114565  delta_E= -0.00311  |g|= 0.00955  |ddm|=  357
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.900607459571892  LUMO = 0.515744483996801
  mo_energy =
[-0.90060746  0.51574448  2.65260574  6.51946961 13.63725251 23.70915152]
E1 = -3.8104684067586145  E_coul = 1.004181202907713
cycle= 2 E= -2.8062872038509  delta_E= -5.67e-06  |g|= 0.000491  |ddm|= 12.4
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.901079899018113  LUMO = 0.515663559808724
  mo_energy =
[-0.9010799   0.51566356  2.6523189   6.51895241 13.63654789 23.70796309]
E1 = -3.8104313262321665  E_coul = 1.0041441023314333
cycle= 3 E= -2.80628722390073  delta_E= -2e-08  |g|= 1.98e-05  |ddm|= 0.227
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.901069321919473  LUMO = 0.515666710897881
  mo_energy =
[-0.90106932  0.51566671  2.65232972  6.51896679 13.63656595 23.70798704]
E1 = -3.810435104494432  E_coul = 1.0041478799164145
cycle= 4 E= -2.80628722457802  delta_E= -6.77e-10  |g|= 1.7e-06  |ddm|= 0.0891
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.810435104494432  E_coul = 1.0041478799164145
  HOMO = -0.901069672330901  LUMO = 0.515666604637908
  mo_energy =
[-0.90106967  0.5156666   2.65232939  6.5189663  13.6365653  23.70798585]
E1 = -3.8104350332562222  E_coul = 1.004147808636776
Extra cycle  E= -2.80628722461945  delta_E= -4.14e-11  |g|= 1.39e-07  |ddm|= 0.00366
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 5772058.001618391
E1 = -3.8104350332562222  E_coul = 1.004147808636776
init E= -2.80628722461945
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.901069707991325  LUMO = 0.515666591525654
  mo_energy =
[-0.90106971  0.51566659  2.65232935  6.51896625 13.63656524 23.70798575]
E1 = -3.810435018816194  E_coul = 1.0041477939485242
cycle= 1 E= -2.80628722486767  delta_E= -2.48e-10  |g|= 2.56e-08  |ddm|= 0.000459
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.810435018816194  E_coul = 1.0041477939485242
  HOMO = -0.901069715459575  LUMO = 0.515666587871604
  mo_energy =
[-0.90106972  0.51566659  2.65232933  6.51896621 13.63656517 23.70798561]
E1 = -3.810435015927277  E_coul = 1.0041477911460546
Extra cycle  E= -2.80628722478122  delta_E= 8.64e-11  |g|= 6.01e-09  |ddm|= 9.76e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.08 sec
exp = [3.05117036 2.5460154  2.0414888  1.53411637 1.02597061 0.18144324]
grad_E = [-0.00715427 -0.00663229 -0.00627855 -0.00588024 -0.00590317 -0.02291472]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:20 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.06002193049        1
[INPUT] 0    0    [1    /1   ]  2.55420631068        1
[INPUT] 0    0    [1    /1   ]  2.04923523735        1
[INPUT] 0    0    [1    /1   ]  1.54135161972        1
[INPUT] 0    0    [1    /1   ]  1.03345054953        1
[INPUT] 0    0    [1    /1   ]  0.188221975226       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.0600219304903664, 1.0]], [0, [2.5542063106783637, 1.0]], [0, [2.049235237347305, 1.0]], [0, [1.5413516197207888, 1.0]], [0, [1.0334505495261757, 1.0]], [0, [0.18822197522645948, 1.0]]]}
ecp = {}
CPU time:        17.39
Set gradient conv threshold to 3.16228e-05
cond(S) = 5988035.188712579
E1 = -3.8250129319387094  E_coul = 1.0213568848270256
init E= -2.80365604711168
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.892599833853814  LUMO = 0.533646769141736
  mo_energy =
[-0.89259983  0.53364677  2.69332384  6.5837732  13.73480943 23.85484647]
E1 = -3.812041792484999  E_coul = 1.0053803380108457
cycle= 1 E= -2.80666145447415  delta_E= -0.00301  |g|= 0.00949  |ddm|=  206
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.900643360107605  LUMO = 0.532624852319334
  mo_energy =
[-0.90064336  0.53262485  2.6887744   6.57538058 13.72320326 23.83483952]
E1 = -3.8112247931783143  E_coul = 1.0045573873300733
cycle= 2 E= -2.80666740584824  delta_E= -5.95e-06  |g|= 0.000548  |ddm|= 4.04
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.901080318650295  LUMO = 0.532556478911168
  mo_energy =
[-0.90108032  0.53255648  2.6885266   6.57491365 13.7225596  23.83372614]
E1 = -3.8112027071141243  E_coul = 1.0045352683395652
cycle= 3 E= -2.80666743877456  delta_E= -3.29e-08  |g|= 3.4e-05  |ddm|= 0.665
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.90106229194419  LUMO = 0.532562080718198
  mo_energy =
[-0.90106229  0.53256208  2.68854527  6.57493839 13.72259055 23.83376606]
E1 = -3.8112093946238783  E_coul = 1.0045419556728
cycle= 4 E= -2.80666743895108  delta_E= -1.77e-10  |g|= 2.11e-06  |ddm|= 0.161
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8112093946238783  E_coul = 1.0045419556728
  HOMO = -0.901062741639283  LUMO = 0.532561920409568
  mo_energy =
[-0.90106274  0.53256192  2.68854483  6.57493785 13.72258988 23.83376512]
E1 = -3.8112092694170565  E_coul = 1.0045418302250253
Extra cycle  E= -2.80666743919203  delta_E= -2.41e-10  |g|= 2.33e-07  |ddm|= 0.00662
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [3.06002193 2.55420631 2.04923524 1.54135162 1.03345055 0.18822198]
E = -2.806667439192031
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:20 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.06002193049        1
[INPUT] 0    0    [1    /1   ]  2.55420631068        1
[INPUT] 0    0    [1    /1   ]  2.04923523735        1
[INPUT] 0    0    [1    /1   ]  1.54135161972        1
[INPUT] 0    0    [1    /1   ]  1.03345054953        1
[INPUT] 0    0    [1    /1   ]  0.188221975226       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.0600219304903664, 1.0]], [0, [2.5542063106783637, 1.0]], [0, [2.049235237347305, 1.0]], [0, [1.5413516197207888, 1.0]], [0, [1.0334505495261757, 1.0]], [0, [0.18822197522645948, 1.0]]]}
ecp = {}
CPU time:        17.56
Set gradient conv threshold to 3.16228e-05
cond(S) = 5988035.188712579
E1 = -3.8250129319387094  E_coul = 1.0213568848270256
init E= -2.80365604711168
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.892599833853814  LUMO = 0.533646769141736
  mo_energy =
[-0.89259983  0.53364677  2.69332384  6.5837732  13.73480943 23.85484647]
E1 = -3.812041792484999  E_coul = 1.0053803380108457
cycle= 1 E= -2.80666145447415  delta_E= -0.00301  |g|= 0.00949  |ddm|=  206
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.900643360107605  LUMO = 0.532624852319334
  mo_energy =
[-0.90064336  0.53262485  2.6887744   6.57538058 13.72320326 23.83483952]
E1 = -3.8112247931783143  E_coul = 1.0045573873300733
cycle= 2 E= -2.80666740584824  delta_E= -5.95e-06  |g|= 0.000548  |ddm|= 4.04
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.901080318650295  LUMO = 0.532556478911168
  mo_energy =
[-0.90108032  0.53255648  2.6885266   6.57491365 13.7225596  23.83372614]
E1 = -3.8112027071141243  E_coul = 1.0045352683395652
cycle= 3 E= -2.80666743877456  delta_E= -3.29e-08  |g|= 3.4e-05  |ddm|= 0.665
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.90106229194419  LUMO = 0.532562080718198
  mo_energy =
[-0.90106229  0.53256208  2.68854527  6.57493839 13.72259055 23.83376606]
E1 = -3.8112093946238783  E_coul = 1.0045419556728
cycle= 4 E= -2.80666743895108  delta_E= -1.77e-10  |g|= 2.11e-06  |ddm|= 0.161
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.8112093946238783  E_coul = 1.0045419556728
  HOMO = -0.901062741639283  LUMO = 0.532561920409568
  mo_energy =
[-0.90106274  0.53256192  2.68854483  6.57493785 13.72258988 23.83376512]
E1 = -3.8112092694170565  E_coul = 1.0045418302250253
Extra cycle  E= -2.80666743919203  delta_E= -2.41e-10  |g|= 2.33e-07  |ddm|= 0.00662
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 5988035.188712579
E1 = -3.8112092694170565  E_coul = 1.0045418302250253
init E= -2.80666743919203
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.901062804483306  LUMO = 0.532561895479766
  mo_energy =
[-0.9010628   0.5325619   2.68854475  6.57493774 13.72258973 23.83376482]
E1 = -3.8112092427009268  E_coul = 1.0045418038119132
cycle= 1 E= -2.80666743888901  delta_E= 3.03e-10  |g|= 4.36e-08  |ddm|= 0.00085
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8112092427009268  E_coul = 1.0045418038119132
  HOMO = -0.901062817538529  LUMO = 0.532561892023518
  mo_energy =
[-0.90106282  0.53256189  2.68854474  6.57493775 13.72258976 23.83376499]
E1 = -3.8112092367796695  E_coul = 1.0045417978268862
Extra cycle  E= -2.80666743895278  delta_E= -6.38e-11  |g|= 8.13e-09  |ddm|= 0.000244
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [3.06002193 2.55420631 2.04923524 1.54135162 1.03345055 0.18822198]
grad_E = [-0.00717215 -0.00667196 -0.00635886 -0.00605178 -0.00642842 -0.01378738]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:22 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.14708184447        1
[INPUT] 0    0    [1    /1   ]  2.63481440556        1
[INPUT] 0    0    [1    /1   ]  2.12556482132        1
[INPUT] 0    0    [1    /1   ]  1.61285900595        1
[INPUT] 0    0    [1    /1   ]  1.10833472254        1
[INPUT] 0    0    [1    /1   ]  0.210485037563       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.147081844465998, 1.0]], [0, [2.6348144055584637, 1.0]], [0, [2.1255648213209133, 1.0]], [0, [1.61285900594542, 1.0]], [0, [1.1083347225371585, 1.0]], [0, [0.21048503756291542, 1.0]]]}
ecp = {}
CPU time:        19.46
Set gradient conv threshold to 3.16228e-05
cond(S) = 7833734.841815697
E1 = -3.827960581423117  E_coul = 1.0215784810974857
init E= -2.80638210032563
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.893799760716501  LUMO = 0.598153251144579
  mo_energy =
[-0.89379976  0.59815325  2.88819785  6.96417475 14.40881177 24.92026574]
E1 = -3.816430645274531  E_coul = 1.0071422537029808
cycle= 1 E= -2.80928839157155  delta_E= -0.00291  |g|= 0.00984  |ddm|=  184
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.901076578870098  LUMO = 0.597233988933238
  mo_energy =
[-0.90107658  0.59723399  2.88410238  6.95646299 14.39812272 24.90165132]
E1 = -3.8158228682593536  E_coul = 1.0065268505541554
cycle= 2 E= -2.8092960177052  delta_E= -7.63e-06  |g|= 0.000743  |ddm|= 21.2
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.901404563429014  LUMO = 0.597199393012275
  mo_energy =
[-0.90140456  0.59719939  2.88395585  6.95613289 14.3976507  24.90076161]
E1 = -3.815838544520286  E_coul = 1.006542440127392
cycle= 3 E= -2.80929610439289  delta_E= -8.67e-08  |g|= 6.44e-05  |ddm|=  3.1
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.901369830646982  LUMO = 0.597211063737709
  mo_energy =
[-0.90136983  0.59721106  2.88399254  6.95618151 14.39771137 24.90083934]
E1 = -3.8158511894049276  E_coul = 1.0065550838820208
cycle= 4 E= -2.80929610552291  delta_E= -1.13e-09  |g|= 3.06e-06  |ddm|= 0.367
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.901370657327229  LUMO = 0.597210715933869
  mo_energy =
[-0.90137066  0.59721072  2.88399164  6.95618039 14.39771001 24.90083743]
E1 = -3.815850895409914  E_coul = 1.0065547900725662
cycle= 5 E= -2.80929610533735  delta_E= 1.86e-10  |g|= 3.18e-08  |ddm|= 0.0155
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.815850895409914  E_coul = 1.0065547900725662
  HOMO = -0.901370657632471  LUMO = 0.59721071505567
  mo_energy =
[-0.90137066  0.59721072  2.88399164  6.95618041 14.39771004 24.90083755]
E1 = -3.8158508935342192  E_coul = 1.006554787878348
Extra cycle  E= -2.80929610565587  delta_E= -3.19e-10  |g|= 2.01e-08  |ddm|= 0.000237
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
exp = [3.14708184 2.63481441 2.12556482 1.61285901 1.10833472 0.21048504]
E = -2.8092961056558714
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:22 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.14708184447        1
[INPUT] 0    0    [1    /1   ]  2.63481440556        1
[INPUT] 0    0    [1    /1   ]  2.12556482132        1
[INPUT] 0    0    [1    /1   ]  1.61285900595        1
[INPUT] 0    0    [1    /1   ]  1.10833472254        1
[INPUT] 0    0    [1    /1   ]  0.210485037563       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.147081844465998, 1.0]], [0, [2.6348144055584637, 1.0]], [0, [2.1255648213209133, 1.0]], [0, [1.61285900594542, 1.0]], [0, [1.1083347225371585, 1.0]], [0, [0.21048503756291542, 1.0]]]}
ecp = {}
CPU time:        19.66
Set gradient conv threshold to 3.16228e-05
cond(S) = 7833734.841815697
E1 = -3.827960581423117  E_coul = 1.0215784810974857
init E= -2.80638210032563
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.893799760716501  LUMO = 0.598153251144579
  mo_energy =
[-0.89379976  0.59815325  2.88819785  6.96417475 14.40881177 24.92026574]
E1 = -3.816430645274531  E_coul = 1.0071422537029808
cycle= 1 E= -2.80928839157155  delta_E= -0.00291  |g|= 0.00984  |ddm|=  184
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.901076578870098  LUMO = 0.597233988933238
  mo_energy =
[-0.90107658  0.59723399  2.88410238  6.95646299 14.39812272 24.90165132]
E1 = -3.8158228682593536  E_coul = 1.0065268505541554
cycle= 2 E= -2.8092960177052  delta_E= -7.63e-06  |g|= 0.000743  |ddm|= 21.2
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.901404563429014  LUMO = 0.597199393012275
  mo_energy =
[-0.90140456  0.59719939  2.88395585  6.95613289 14.3976507  24.90076161]
E1 = -3.815838544520286  E_coul = 1.006542440127392
cycle= 3 E= -2.80929610439289  delta_E= -8.67e-08  |g|= 6.44e-05  |ddm|=  3.1
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.901369830646982  LUMO = 0.597211063737709
  mo_energy =
[-0.90136983  0.59721106  2.88399254  6.95618151 14.39771137 24.90083934]
E1 = -3.8158511894049276  E_coul = 1.0065550838820208
cycle= 4 E= -2.80929610552291  delta_E= -1.13e-09  |g|= 3.06e-06  |ddm|= 0.367
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.901370657327229  LUMO = 0.597210715933869
  mo_energy =
[-0.90137066  0.59721072  2.88399164  6.95618039 14.39771001 24.90083743]
E1 = -3.815850895409914  E_coul = 1.0065547900725662
cycle= 5 E= -2.80929610533735  delta_E= 1.86e-10  |g|= 3.18e-08  |ddm|= 0.0155
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.815850895409914  E_coul = 1.0065547900725662
  HOMO = -0.901370657632471  LUMO = 0.59721071505567
  mo_energy =
[-0.90137066  0.59721072  2.88399164  6.95618041 14.39771004 24.90083755]
E1 = -3.8158508935342192  E_coul = 1.006554787878348
Extra cycle  E= -2.80929610565587  delta_E= -3.19e-10  |g|= 2.01e-08  |ddm|= 0.000237
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 7833734.841815697
E1 = -3.8158508935342192  E_coul = 1.006554787878348
init E= -2.80929610565587
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.901370658888812  LUMO = 0.597210712875152
  mo_energy =
[-0.90137066  0.59721071  2.88399163  6.95618037 14.39770997 24.90083735]
E1 = -3.81585089341557  E_coul = 1.0065547881551111
cycle= 1 E= -2.80929610526046  delta_E= 3.95e-10  |g|= 2.52e-08  |ddm|= 0.000101
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.81585089341557  E_coul = 1.0065547881551111
  HOMO = -0.9013706585526  LUMO = 0.597210715256223
  mo_energy =
[-0.90137066  0.59721072  2.88399164  6.95618042 14.39771006 24.9008376 ]
E1 = -3.815850892988618  E_coul = 1.0065547876160554
Extra cycle  E= -2.80929610537256  delta_E= -1.12e-10  |g|= 6.91e-09  |ddm|= 0.000161
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [3.14708184 2.63481441 2.12556482 1.61285901 1.10833472 0.21048504]
grad_E = [-0.00674972 -0.00633359 -0.00611789 -0.0060041  -0.00687327  0.00538406]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:24 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.63946887017        1
[INPUT] 0    0    [1    /1   ]  3.09080438143        1
[INPUT] 0    0    [1    /1   ]  2.55743692523        1
[INPUT] 0    0    [1    /1   ]  2.01763429369        1
[INPUT] 0    0    [1    /1   ]  1.53227142033        1
[INPUT] 0    0    [1    /1   ]  0.291262151043       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.639468870173622, 1.0]], [0, [3.0908043814269455, 1.0]], [0, [2.557436925229408, 1.0]], [0, [2.0176342936869354, 1.0]], [0, [1.5322714203302885, 1.0]], [0, [0.29126215104332515, 1.0]]]}
ecp = {}
CPU time:        21.56
Set gradient conv threshold to 3.16228e-05
cond(S) = 27229896.338296507
E1 = -3.8356804205017707  E_coul = 1.0224278289333666
init E= -2.8132525915684
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.898160358921928  LUMO = 0.868871841326991
  mo_energy =
[-0.89816036  0.86887184  3.81600878  8.92016542 18.01419188 30.76215134]
E1 = -3.8367358916847465  E_coul = 1.0177371172437948
cycle= 1 E= -2.81899877444095  delta_E= -0.00575  |g|= 0.016  |ddm|= 3.19e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.900641938488295  LUMO = 0.869838235746504
  mo_energy =
[-0.90064194  0.86983824  3.81608157  8.91815579 18.01068218 30.75364405]
E1 = -3.8369242939190196  E_coul = 1.0179007052123903
cycle= 2 E= -2.81902358870663  delta_E= -2.48e-05  |g|= 0.00158  |ddm|=  237
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.900555432408312  LUMO = 0.869977049450358
  mo_energy =
[-0.90055543  0.86997705  3.81636214  8.91838685 18.01090465 30.75365231]
E1 = -3.837057024740882  E_coul = 1.0180330205966894
cycle= 3 E= -2.81902400414419  delta_E= -4.15e-07  |g|= 0.000125  |ddm|= 24.3
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.900482860229267  LUMO = 0.870007783062828
  mo_energy =
[-0.90048286  0.87000778  3.81644687  8.9184976  18.01104138 30.75382728]
E1 = -3.8370798313412395  E_coul = 1.0180558228199796
cycle= 4 E= -2.81902400852126  delta_E= -4.38e-09  |g|= 4.63e-06  |ddm|= 1.57
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.900484339169775  LUMO = 0.870007038768245
  mo_energy =
[-0.90048434  0.87000704  3.81644503  8.91849503 18.01103813 30.7538224 ]
E1 = -3.8370793325274692  E_coul = 1.0180553236371859
cycle= 5 E= -2.81902400889028  delta_E= -3.69e-10  |g|= 1.76e-08  |ddm|= 0.042
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.8370793325274692  E_coul = 1.0180553236371859
  HOMO = -0.900484342626484  LUMO = 0.870007036842652
  mo_energy =
[-0.90048434  0.87000704  3.81644503  8.91849499 18.011038   30.7538218 ]
E1 = -3.837079332497693  E_coul = 1.0180553241349504
Extra cycle  E= -2.81902400836274  delta_E= 5.28e-10  |g|= 4.23e-08  |ddm|= 0.000112
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [3.63946887 3.09080438 2.55743693 2.01763429 1.53227142 0.29126215]
E = -2.8190240083627427
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:24 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  3.63946887017        1
[INPUT] 0    0    [1    /1   ]  3.09080438143        1
[INPUT] 0    0    [1    /1   ]  2.55743692523        1
[INPUT] 0    0    [1    /1   ]  2.01763429369        1
[INPUT] 0    0    [1    /1   ]  1.53227142033        1
[INPUT] 0    0    [1    /1   ]  0.291262151043       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [3.639468870173622, 1.0]], [0, [3.0908043814269455, 1.0]], [0, [2.557436925229408, 1.0]], [0, [2.0176342936869354, 1.0]], [0, [1.5322714203302885, 1.0]], [0, [0.29126215104332515, 1.0]]]}
ecp = {}
CPU time:        21.77
Set gradient conv threshold to 3.16228e-05
cond(S) = 27229896.338296507
E1 = -3.8356804205017707  E_coul = 1.0224278289333666
init E= -2.8132525915684
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.898160358921928  LUMO = 0.868871841326991
  mo_energy =
[-0.89816036  0.86887184  3.81600878  8.92016542 18.01419188 30.76215134]
E1 = -3.8367358916847465  E_coul = 1.0177371172437948
cycle= 1 E= -2.81899877444095  delta_E= -0.00575  |g|= 0.016  |ddm|= 3.19e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.900641938488295  LUMO = 0.869838235746504
  mo_energy =
[-0.90064194  0.86983824  3.81608157  8.91815579 18.01068218 30.75364405]
E1 = -3.8369242939190196  E_coul = 1.0179007052123903
cycle= 2 E= -2.81902358870663  delta_E= -2.48e-05  |g|= 0.00158  |ddm|=  237
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.900555432408312  LUMO = 0.869977049450358
  mo_energy =
[-0.90055543  0.86997705  3.81636214  8.91838685 18.01090465 30.75365231]
E1 = -3.837057024740882  E_coul = 1.0180330205966894
cycle= 3 E= -2.81902400414419  delta_E= -4.15e-07  |g|= 0.000125  |ddm|= 24.3
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.900482860229267  LUMO = 0.870007783062828
  mo_energy =
[-0.90048286  0.87000778  3.81644687  8.9184976  18.01104138 30.75382728]
E1 = -3.8370798313412395  E_coul = 1.0180558228199796
cycle= 4 E= -2.81902400852126  delta_E= -4.38e-09  |g|= 4.63e-06  |ddm|= 1.57
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.900484339169775  LUMO = 0.870007038768245
  mo_energy =
[-0.90048434  0.87000704  3.81644503  8.91849503 18.01103813 30.7538224 ]
E1 = -3.8370793325274692  E_coul = 1.0180553236371859
cycle= 5 E= -2.81902400889028  delta_E= -3.69e-10  |g|= 1.76e-08  |ddm|= 0.042
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
E1 = -3.8370793325274692  E_coul = 1.0180553236371859
  HOMO = -0.900484342626484  LUMO = 0.870007036842652
  mo_energy =
[-0.90048434  0.87000704  3.81644503  8.91849499 18.011038   30.7538218 ]
E1 = -3.837079332497693  E_coul = 1.0180553241349504
Extra cycle  E= -2.81902400836274  delta_E= 5.28e-10  |g|= 4.23e-08  |ddm|= 0.000112
    CPU time for scf_cycle      0.08 sec, wall time      0.08 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 27229896.338296507
E1 = -3.837079332497693  E_coul = 1.0180553241349504
init E= -2.81902400836274
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.90048434211377  LUMO = 0.870007040431589
  mo_energy =
[-0.90048434  0.87000704  3.81644504  8.91849506 18.01103813 30.75382245]
E1 = -3.8370793318013083  E_coul = 1.0180553227302873
cycle= 1 E= -2.81902400907102  delta_E= -7.08e-10  |g|= 5.69e-08  |ddm|= 0.000543
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.8370793318013083  E_coul = 1.0180553227302873
  HOMO = -0.900484343169997  LUMO = 0.870007034631651
  mo_energy =
[-0.90048434  0.87000703  3.81644503  8.91849495 18.01103794 30.75382159]
E1 = -3.8370793326587926  E_coul = 1.0180553250650233
Extra cycle  E= -2.81902400759377  delta_E= 1.48e-09  |g|= 1.2e-07  |ddm|= 0.000725
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [3.63946887 3.09080438 2.55743693 2.01763429 1.53227142 0.29126215]
grad_E = [-0.00473536 -0.00455918 -0.00454356 -0.00473136 -0.00565023  0.06021605]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:26 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  4.13799266937        1
[INPUT] 0    0    [1    /1   ]  3.55248372481        1
[INPUT] 0    0    [1    /1   ]  2.99460468584        1
[INPUT] 0    0    [1    /1   ]  2.4271016424         1
[INPUT] 0    0    [1    /1   ]  1.95911255755        1
[INPUT] 0    0    [1    /1   ]  0.332558566442       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [4.137992669367362, 1.0]], [0, [3.5524837248062857, 1.0]], [0, [2.994604685838438, 1.0]], [0, [2.427101642404492, 1.0]], [0, [1.9591125575483634, 1.0]], [0, [0.3325585664420378, 1.0]]]}
ecp = {}
CPU time:        23.65
Set gradient conv threshold to 3.16228e-05
cond(S) = 70792776.08929572
E1 = -3.839725155515242  E_coul = 1.0230392939222308
init E= -2.81668586159301
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.900944129318329  LUMO = 1.06298171833965
  mo_energy =
[-0.90094413  1.06298172  4.6046257  10.72330428 21.46686561 36.50424054]
E1 = -3.850930030873725  E_coul = 1.0256688090688657
cycle= 1 E= -2.82526122180486  delta_E= -0.00858  |g|= 0.0192  |ddm|= 8.34e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.899810938433169  LUMO = 1.06613608933207
  mo_energy =
[-0.89981094  1.06613609  4.60877379 10.72659765 21.4697398  36.50435496]
E1 = -3.8514593681524087  E_coul = 1.0261653934990824
cycle= 2 E= -2.82529397465333  delta_E= -3.28e-05  |g|= 0.00184  |ddm|=  627
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.899545399719482  LUMO = 1.06637877799442
  mo_energy =
[-0.8995454   1.06637878  4.60927525 10.72710932 21.47029731 36.50479114]
E1 = -3.8516193574101263  E_coul = 1.0263248884926641
cycle= 3 E= -2.82529446891746  delta_E= -4.94e-07  |g|= 0.000123  |ddm|= 59.7
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.89947329818622  LUMO = 1.06641398171682
  mo_energy =
[-0.8994733   1.06641398  4.60936737 10.72722422 21.47043556 36.50495777]
E1 = -3.851640111902024  E_coul = 1.0263456446578079
cycle= 4 E= -2.82529446724422  delta_E= 1.67e-09  |g|= 3.86e-06  |ddm|=  3.1
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.899474614523267  LUMO = 1.06641343316788
  mo_energy =
[-0.89947461  1.06641343  4.60936633 10.7272245  21.47043659 36.50496223]
E1 = -3.851639688627805  E_coul = 1.0263452153535453
cycle= 5 E= -2.82529447327426  delta_E= -6.03e-09  |g|= 5.6e-07  |ddm|= 0.0731
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474622123172  LUMO = 1.06641336586673
  mo_energy =
[-0.89947462  1.06641337  4.60936605 10.72722342 21.47043491 36.50495792]
E1 = -3.8516396936904855  E_coul = 1.0263452290836974
cycle= 6 E= -2.82529446460679  delta_E= 8.67e-09  |g|= 5.54e-07  |ddm|= 0.00801
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474620646422  LUMO = 1.06641340396386
  mo_energy =
[-0.89947462  1.0664134   4.60936621 10.72722408 21.47043594 36.50496048]
E1 = -3.851639690185855  E_coul = 1.026345224014503
cycle= 7 E= -2.82529446617135  delta_E= -1.56e-09  |g|= 2.42e-07  |ddm|= 0.00527
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474620752394  LUMO = 1.0664134089092
  mo_energy =
[-0.89947462  1.06641341  4.60936623 10.72722422 21.47043622 36.50496146]
E1 = -3.8516396892449385  E_coul = 1.0263452262811756
cycle= 8 E= -2.82529446296376  delta_E= 3.21e-09  |g|= 4.81e-07  |ddm|= 0.00154
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474620293749  LUMO = 1.06641342699194
  mo_energy =
[-0.89947462  1.06641343  4.6093663  10.72722454 21.47043674 36.50496282]
E1 = -3.851639687417712  E_coul = 1.0263452200450096
cycle= 9 E= -2.8252944673727  delta_E= -4.41e-09  |g|= 5.28e-08  |ddm|= 0.0027
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474622047428  LUMO = 1.0664134247328
  mo_energy =
[-0.89947462  1.06641342  4.60936629 10.72722452 21.47043671 36.50496269]
E1 = -3.851639687234616  E_coul = 1.026345225185923
cycle= 10 E= -2.82529446204869  delta_E= 5.32e-09  |g|= 4.7e-07  |ddm|= 7.85e-05
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474621501584  LUMO = 1.06641343700384
  mo_energy =
[-0.89947462  1.06641344  4.60936634 10.72722475 21.47043709 36.50496391]
E1 = -3.8516396858269273  E_coul = 1.0263452179419827
cycle= 11 E= -2.82529446788494  delta_E= -5.84e-09  |g|= 1.56e-07  |ddm|= 0.00211
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474621992985  LUMO = 1.06641342732706
  mo_energy =
[-0.89947462  1.06641343  4.60936629 10.72722461 21.47043693 36.50496379]
E1 = -3.8516396863814863  E_coul = 1.0263452209134312
cycle= 12 E= -2.82529446546806  delta_E= 2.42e-09  |g|= 1.02e-07  |ddm|= 0.000727
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474621936664  LUMO = 1.06641343422174
  mo_energy =
[-0.89947462  1.06641343  4.60936633 10.7272247  21.47043704 36.50496371]
E1 = -3.8516396860324607  E_coul = 1.0263452234991883
cycle= 13 E= -2.82529446253327  delta_E= 2.93e-09  |g|= 3.4e-07  |ddm|= 0.000406
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474620755531  LUMO = 1.06641345989879
  mo_energy =
[-0.89947462  1.06641346  4.60936643 10.72722513 21.47043771 36.50496545]
E1 = -3.851639683579644  E_coul = 1.0263452145906453
cycle= 14 E= -2.825294468989  delta_E= -6.46e-09  |g|= 3.76e-07  |ddm|= 0.00359
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474621935337  LUMO = 1.06641344466314
  mo_energy =
[-0.89947462  1.06641344  4.60936636 10.72722491 21.4704374  36.50496489]
E1 = -3.8516396845415786  E_coul = 1.026345223941379
cycle= 15 E= -2.8252944606002  delta_E= 8.39e-09  |g|= 4.57e-07  |ddm|= 0.00145
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474621592375  LUMO = 1.06641346407515
  mo_energy =
[-0.89947462  1.06641346  4.60936645 10.7272252  21.47043781 36.50496555]
E1 = -3.851639683011662  E_coul = 1.026345213993522
cycle= 16 E= -2.82529446901814  delta_E= -8.42e-09  |g|= 4.07e-07  |ddm|= 0.00203
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474622738986  LUMO = 1.06641344867373
  mo_energy =
[-0.89947462  1.06641345  4.60936639 10.72722494 21.47043739 36.50496451]
E1 = -3.851639684282598  E_coul = 1.0263452183283808
cycle= 17 E= -2.82529446595422  delta_E= 3.06e-09  |g|= 4.27e-08  |ddm|= 0.00201
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474622757819  LUMO = 1.06641345037106
  mo_energy =
[-0.89947462  1.06641345  4.60936639 10.72722498 21.47043747 36.50496481]
E1 = -3.851639683964962  E_coul = 1.026345227728966
cycle= 18 E= -2.825294456236  delta_E= 9.72e-09  |g|= 8.55e-07  |ddm|= 0.000471
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474622235162  LUMO = 1.06641346888452
  mo_energy =
[-0.89947462  1.06641347  4.60936648 10.72722527 21.4704379  36.50496555]
E1 = -3.851639682446664  E_coul = 1.0263452162764124
cycle= 19 E= -2.82529446617025  delta_E= -9.93e-09  |g|= 1.57e-07  |ddm|= 0.00209
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474622232404  LUMO = 1.0664134773344
  mo_energy =
[-0.89947462  1.06641348  4.60936652 10.72722538 21.47043802 36.50496555]
E1 = -3.851639681864812  E_coul = 1.0263452218505615
cycle= 20 E= -2.82529446001425  delta_E= 6.16e-09  |g|= 4.04e-07  |ddm|= 0.000638
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474621833221  LUMO = 1.06641348963538
  mo_energy =
[-0.89947462  1.06641349  4.60936657 10.72722559 21.47043834 36.50496644]
E1 = -3.85163968058897  E_coul = 1.0263452097772103
cycle= 21 E= -2.82529447081176  delta_E= -1.08e-08  |g|= 6.83e-07  |ddm|= 0.00182
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474623207843  LUMO = 1.06641347242035
  mo_energy =
[-0.89947462  1.06641347  4.6093665  10.72722529 21.47043786 36.50496501]
E1 = -3.851639682269795  E_coul = 1.0263452169535887
cycle= 22 E= -2.82529446531621  delta_E= 5.5e-09  |g|= 5.4e-08  |ddm|= 0.00263
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474622830484  LUMO = 1.0664134842771
  mo_energy =
[-0.89947462  1.06641348  4.60936656 10.72722547 21.47043811 36.50496548]
E1 = -3.8516396813209774  E_coul = 1.0263452137558544
cycle= 23 E= -2.82529446756512  delta_E= -2.25e-09  |g|= 3.14e-07  |ddm|= 0.00129
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474623903134  LUMO = 1.06641346375241
  mo_energy =
[-0.89947462  1.06641346  4.60936647 10.72722514 21.47043761 36.50496444]
E1 = -3.851639682949638  E_coul = 1.0263452164796363
cycle= 24 E= -2.82529446647  delta_E= 1.1e-09  |g|= 1.19e-07  |ddm|= 0.00241
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474623588314  LUMO = 1.06641346655291
  mo_energy =
[-0.89947462  1.06641347  4.60936647 10.72722522 21.47043777 36.5049651 ]
E1 = -3.8516396824911636  E_coul = 1.026345219924608
cycle= 25 E= -2.82529446256656  delta_E= 3.9e-09  |g|= 2.36e-07  |ddm|= 0.000826
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.8994746232764  LUMO = 1.06641347346792
  mo_energy =
[-0.89947462  1.06641347  4.6093665  10.72722535 21.470438   36.50496576]
E1 = -3.851639681739995  E_coul = 1.0263452129007118
cycle= 26 E= -2.82529446883928  delta_E= -6.27e-09  |g|= 4.03e-07  |ddm|= 0.00116
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474624990687  LUMO = 1.06641343825807
  mo_energy =
[-0.89947462  1.06641344  4.60936635 10.72722478 21.47043715 36.50496393]
E1 = -3.8516396846867935  E_coul = 1.0263452156379411
cycle= 27 E= -2.82529446904885  delta_E= -2.1e-10  |g|= 3.09e-07  |ddm|= 0.00428
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
E1 = -3.8516396846867935  E_coul = 1.0263452156379411
  HOMO = -0.899474626705706  LUMO = 1.06641337941296
  mo_energy =
[-0.89947463  1.06641338  4.60936611 10.72722373 21.4704354  36.50495955]
E1 = -3.8516396905674055  E_coul = 1.0263452211902642
Extra cycle  E= -2.82529446937714  delta_E= -3.28e-10  |g|= 4.31e-08  |ddm|= 0.00867
    CPU time for scf_cycle      0.28 sec, wall time      0.29 sec
exp = [4.13799267 3.55248372 2.99460469 2.42710164 1.95911256 0.33255857]
E = -2.825294469377141
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:26 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  4.13799266937        1
[INPUT] 0    0    [1    /1   ]  3.55248372481        1
[INPUT] 0    0    [1    /1   ]  2.99460468584        1
[INPUT] 0    0    [1    /1   ]  2.4271016424         1
[INPUT] 0    0    [1    /1   ]  1.95911255755        1
[INPUT] 0    0    [1    /1   ]  0.332558566442       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [4.137992669367362, 1.0]], [0, [3.5524837248062857, 1.0]], [0, [2.994604685838438, 1.0]], [0, [2.427101642404492, 1.0]], [0, [1.9591125575483634, 1.0]], [0, [0.3325585664420378, 1.0]]]}
ecp = {}
CPU time:        24.09
Set gradient conv threshold to 3.16228e-05
cond(S) = 70792776.08929572
E1 = -3.839725155515242  E_coul = 1.0230392939222308
init E= -2.81668586159301
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.900944129318329  LUMO = 1.06298171833965
  mo_energy =
[-0.90094413  1.06298172  4.6046257  10.72330428 21.46686561 36.50424054]
E1 = -3.850930030873725  E_coul = 1.0256688090688657
cycle= 1 E= -2.82526122180486  delta_E= -0.00858  |g|= 0.0192  |ddm|= 8.34e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.899810938433169  LUMO = 1.06613608933207
  mo_energy =
[-0.89981094  1.06613609  4.60877379 10.72659765 21.4697398  36.50435496]
E1 = -3.8514593681524087  E_coul = 1.0261653934990824
cycle= 2 E= -2.82529397465333  delta_E= -3.28e-05  |g|= 0.00184  |ddm|=  627
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.899545399719482  LUMO = 1.06637877799442
  mo_energy =
[-0.8995454   1.06637878  4.60927525 10.72710932 21.47029731 36.50479114]
E1 = -3.8516193574101263  E_coul = 1.0263248884926641
cycle= 3 E= -2.82529446891746  delta_E= -4.94e-07  |g|= 0.000123  |ddm|= 59.7
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.89947329818622  LUMO = 1.06641398171682
  mo_energy =
[-0.8994733   1.06641398  4.60936737 10.72722422 21.47043556 36.50495777]
E1 = -3.851640111902024  E_coul = 1.0263456446578079
cycle= 4 E= -2.82529446724422  delta_E= 1.67e-09  |g|= 3.86e-06  |ddm|=  3.1
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.899474614523267  LUMO = 1.06641343316788
  mo_energy =
[-0.89947461  1.06641343  4.60936633 10.7272245  21.47043659 36.50496223]
E1 = -3.851639688627805  E_coul = 1.0263452153535453
cycle= 5 E= -2.82529447327426  delta_E= -6.03e-09  |g|= 5.6e-07  |ddm|= 0.0731
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474622123172  LUMO = 1.06641336586673
  mo_energy =
[-0.89947462  1.06641337  4.60936605 10.72722342 21.47043491 36.50495792]
E1 = -3.8516396936904855  E_coul = 1.0263452290836974
cycle= 6 E= -2.82529446460679  delta_E= 8.67e-09  |g|= 5.54e-07  |ddm|= 0.00801
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474620646422  LUMO = 1.06641340396386
  mo_energy =
[-0.89947462  1.0664134   4.60936621 10.72722408 21.47043594 36.50496048]
E1 = -3.851639690185855  E_coul = 1.026345224014503
cycle= 7 E= -2.82529446617135  delta_E= -1.56e-09  |g|= 2.42e-07  |ddm|= 0.00527
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474620752394  LUMO = 1.0664134089092
  mo_energy =
[-0.89947462  1.06641341  4.60936623 10.72722422 21.47043622 36.50496146]
E1 = -3.8516396892449385  E_coul = 1.0263452262811756
cycle= 8 E= -2.82529446296376  delta_E= 3.21e-09  |g|= 4.81e-07  |ddm|= 0.00154
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474620293749  LUMO = 1.06641342699194
  mo_energy =
[-0.89947462  1.06641343  4.6093663  10.72722454 21.47043674 36.50496282]
E1 = -3.851639687417712  E_coul = 1.0263452200450096
cycle= 9 E= -2.8252944673727  delta_E= -4.41e-09  |g|= 5.28e-08  |ddm|= 0.0027
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474622047428  LUMO = 1.0664134247328
  mo_energy =
[-0.89947462  1.06641342  4.60936629 10.72722452 21.47043671 36.50496269]
E1 = -3.851639687234616  E_coul = 1.026345225185923
cycle= 10 E= -2.82529446204869  delta_E= 5.32e-09  |g|= 4.7e-07  |ddm|= 7.85e-05
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474621501584  LUMO = 1.06641343700384
  mo_energy =
[-0.89947462  1.06641344  4.60936634 10.72722475 21.47043709 36.50496391]
E1 = -3.8516396858269273  E_coul = 1.0263452179419827
cycle= 11 E= -2.82529446788494  delta_E= -5.84e-09  |g|= 1.56e-07  |ddm|= 0.00211
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474621992985  LUMO = 1.06641342732706
  mo_energy =
[-0.89947462  1.06641343  4.60936629 10.72722461 21.47043693 36.50496379]
E1 = -3.8516396863814863  E_coul = 1.0263452209134312
cycle= 12 E= -2.82529446546806  delta_E= 2.42e-09  |g|= 1.02e-07  |ddm|= 0.000727
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474621936664  LUMO = 1.06641343422174
  mo_energy =
[-0.89947462  1.06641343  4.60936633 10.7272247  21.47043704 36.50496371]
E1 = -3.8516396860324607  E_coul = 1.0263452234991883
cycle= 13 E= -2.82529446253327  delta_E= 2.93e-09  |g|= 3.4e-07  |ddm|= 0.000406
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474620755531  LUMO = 1.06641345989879
  mo_energy =
[-0.89947462  1.06641346  4.60936643 10.72722513 21.47043771 36.50496545]
E1 = -3.851639683579644  E_coul = 1.0263452145906453
cycle= 14 E= -2.825294468989  delta_E= -6.46e-09  |g|= 3.76e-07  |ddm|= 0.00359
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474621935337  LUMO = 1.06641344466314
  mo_energy =
[-0.89947462  1.06641344  4.60936636 10.72722491 21.4704374  36.50496489]
E1 = -3.8516396845415786  E_coul = 1.026345223941379
cycle= 15 E= -2.8252944606002  delta_E= 8.39e-09  |g|= 4.57e-07  |ddm|= 0.00145
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474621592375  LUMO = 1.06641346407515
  mo_energy =
[-0.89947462  1.06641346  4.60936645 10.7272252  21.47043781 36.50496555]
E1 = -3.851639683011662  E_coul = 1.026345213993522
cycle= 16 E= -2.82529446901814  delta_E= -8.42e-09  |g|= 4.07e-07  |ddm|= 0.00203
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474622738986  LUMO = 1.06641344867373
  mo_energy =
[-0.89947462  1.06641345  4.60936639 10.72722494 21.47043739 36.50496451]
E1 = -3.851639684282598  E_coul = 1.0263452183283808
cycle= 17 E= -2.82529446595422  delta_E= 3.06e-09  |g|= 4.27e-08  |ddm|= 0.00201
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474622757819  LUMO = 1.06641345037106
  mo_energy =
[-0.89947462  1.06641345  4.60936639 10.72722498 21.47043747 36.50496481]
E1 = -3.851639683964962  E_coul = 1.026345227728966
cycle= 18 E= -2.825294456236  delta_E= 9.72e-09  |g|= 8.55e-07  |ddm|= 0.000471
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474622235162  LUMO = 1.06641346888452
  mo_energy =
[-0.89947462  1.06641347  4.60936648 10.72722527 21.4704379  36.50496555]
E1 = -3.851639682446664  E_coul = 1.0263452162764124
cycle= 19 E= -2.82529446617025  delta_E= -9.93e-09  |g|= 1.57e-07  |ddm|= 0.00209
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474622232404  LUMO = 1.0664134773344
  mo_energy =
[-0.89947462  1.06641348  4.60936652 10.72722538 21.47043802 36.50496555]
E1 = -3.851639681864812  E_coul = 1.0263452218505615
cycle= 20 E= -2.82529446001425  delta_E= 6.16e-09  |g|= 4.04e-07  |ddm|= 0.000638
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474621833221  LUMO = 1.06641348963538
  mo_energy =
[-0.89947462  1.06641349  4.60936657 10.72722559 21.47043834 36.50496644]
E1 = -3.85163968058897  E_coul = 1.0263452097772103
cycle= 21 E= -2.82529447081176  delta_E= -1.08e-08  |g|= 6.83e-07  |ddm|= 0.00182
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474623207843  LUMO = 1.06641347242035
  mo_energy =
[-0.89947462  1.06641347  4.6093665  10.72722529 21.47043786 36.50496501]
E1 = -3.851639682269795  E_coul = 1.0263452169535887
cycle= 22 E= -2.82529446531621  delta_E= 5.5e-09  |g|= 5.4e-08  |ddm|= 0.00263
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474622830484  LUMO = 1.0664134842771
  mo_energy =
[-0.89947462  1.06641348  4.60936656 10.72722547 21.47043811 36.50496548]
E1 = -3.8516396813209774  E_coul = 1.0263452137558544
cycle= 23 E= -2.82529446756512  delta_E= -2.25e-09  |g|= 3.14e-07  |ddm|= 0.00129
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474623903134  LUMO = 1.06641346375241
  mo_energy =
[-0.89947462  1.06641346  4.60936647 10.72722514 21.47043761 36.50496444]
E1 = -3.851639682949638  E_coul = 1.0263452164796363
cycle= 24 E= -2.82529446647  delta_E= 1.1e-09  |g|= 1.19e-07  |ddm|= 0.00241
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474623588314  LUMO = 1.06641346655291
  mo_energy =
[-0.89947462  1.06641347  4.60936647 10.72722522 21.47043777 36.5049651 ]
E1 = -3.8516396824911636  E_coul = 1.026345219924608
cycle= 25 E= -2.82529446256656  delta_E= 3.9e-09  |g|= 2.36e-07  |ddm|= 0.000826
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.8994746232764  LUMO = 1.06641347346792
  mo_energy =
[-0.89947462  1.06641347  4.6093665  10.72722535 21.470438   36.50496576]
E1 = -3.851639681739995  E_coul = 1.0263452129007118
cycle= 26 E= -2.82529446883928  delta_E= -6.27e-09  |g|= 4.03e-07  |ddm|= 0.00116
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.899474624990687  LUMO = 1.06641343825807
  mo_energy =
[-0.89947462  1.06641344  4.60936635 10.72722478 21.47043715 36.50496393]
E1 = -3.8516396846867935  E_coul = 1.0263452156379411
cycle= 27 E= -2.82529446904885  delta_E= -2.1e-10  |g|= 3.09e-07  |ddm|= 0.00428
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
E1 = -3.8516396846867935  E_coul = 1.0263452156379411
  HOMO = -0.899474626705706  LUMO = 1.06641337941296
  mo_energy =
[-0.89947463  1.06641338  4.60936611 10.72722373 21.4704354  36.50495955]
E1 = -3.8516396905674055  E_coul = 1.0263452211902642
Extra cycle  E= -2.82529446937714  delta_E= -3.28e-10  |g|= 4.31e-08  |ddm|= 0.00867
    CPU time for scf_cycle      0.29 sec, wall time      0.29 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 70792776.08929572
E1 = -3.8516396905674055  E_coul = 1.0263452211902642
init E= -2.82529446937714
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.899474624092327  LUMO = 1.0664133766908
  mo_energy =
[-0.89947462  1.06641338  4.60936609 10.72722363 21.47043522 36.50495908]
E1 = -3.851639691837027  E_coul = 1.0263452229102796
cycle= 1 E= -2.82529446892675  delta_E= 4.5e-10  |g|= 7.13e-08  |ddm|= 0.00132
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
E1 = -3.851639691837027  E_coul = 1.0263452229102796
  HOMO = -0.89947462300806  LUMO = 1.06641336263161
  mo_energy =
[-0.89947462  1.06641336  4.60936599 10.72722355 21.47043541 36.50496109]
E1 = -3.851639691934861  E_coul = 1.0263452272458562
Extra cycle  E= -2.82529446468901  delta_E= 4.24e-09  |g|= 3.92e-07  |ddm|= 0.000891
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [4.13799267 3.55248372 2.99460469 2.42710164 1.95911256 0.33255857]
grad_E = [-0.00338608 -0.00330871 -0.00334182 -0.00353943 -0.00409929  0.08355614]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:28 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  4.84212524384        1
[INPUT] 0    0    [1    /1   ]  4.20451534015        1
[INPUT] 0    0    [1    /1   ]  3.61180668093        1
[INPUT] 0    0    [1    /1   ]  3.00462640702        1
[INPUT] 0    0    [1    /1   ]  2.55828147583        1
[INPUT] 0    0    [1    /1   ]  0.345421081514       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [4.842125243838476, 1.0]], [0, [4.204515340151593, 1.0]], [0, [3.6118066809280553, 1.0]], [0, [3.004626407023771, 1.0]], [0, [2.55828147582706, 1.0]], [0, [0.3454210815143248, 1.0]]]}
ecp = {}
CPU time:        26.20
Set gradient conv threshold to 3.16228e-05
cond(S) = 198154554.82068992

WARN: Singularity detected in overlap matrix (condition number = 1.98e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8504959514617263  E_coul = 1.0237582947855388
init E= -2.82673765667619
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.904465094382704  LUMO = 1.23357120031164
  mo_energy =
[-0.90446509  1.2335712   5.55232756 13.08093234 26.131224   44.4310016 ]
E1 = -3.860684110163215  E_coul = 1.0278310421746237
cycle= 1 E= -2.83285306798859  delta_E= -0.00612  |g|= 0.0142  |ddm|= 1.73e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.902518056463771  LUMO = 1.23704727250242
  mo_energy =
[-0.90251806  1.23704727  5.55703582 13.08516751 26.13525349 44.43302266]
E1 = -3.861010939331744  E_coul = 1.0281423004088757
cycle= 2 E= -2.83286863892287  delta_E= -1.56e-05  |g|= 0.00128  |ddm|= 1.1e+03
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.902352325320456  LUMO = 1.23722384773157
  mo_energy =
[-0.90235233  1.23722385  5.55737887 13.08548379 26.13557303 44.43318879]
E1 = -3.8611076336236736  E_coul = 1.028238900942467
cycle= 3 E= -2.83286873268121  delta_E= -9.38e-08  |g|= 7.43e-05  |ddm|=  100
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.902308449967748  LUMO = 1.23725157507409
  mo_energy =
[-0.90230845  1.23725158  5.55745563 13.08560494 26.13572858 44.4334186 ]
E1 = -3.8611187632708406  E_coul = 1.028249958230961
cycle= 4 E= -2.83286880503988  delta_E= -7.24e-08  |g|= 8.56e-06  |ddm|= 4.13
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.902309554950219  LUMO = 1.23724905325557
  mo_energy =
[-0.90230955  1.23724905  5.55744512 13.08557166 26.1356794  44.43332112]
E1 = -3.86111866550693  E_coul = 1.0282498355375813
cycle= 5 E= -2.83286882996935  delta_E= -2.49e-08  |g|= 2.45e-06  |ddm|= 0.454
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309522203052  LUMO = 1.23724889793465
  mo_energy =
[-0.90230952  1.2372489   5.5574444  13.08556822 26.13567349 44.43330316]
E1 = -3.8611186951237504  E_coul = 1.0282498986622712
cycle= 6 E= -2.83286879646148  delta_E= 3.35e-08  |g|= 2.26e-06  |ddm|= 0.0886
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309495778555  LUMO = 1.23724902628196
  mo_energy =
[-0.9023095   1.23724903  5.5574449  13.08557077 26.13567805 44.43331625]
E1 = -3.8611186865032296  E_coul = 1.0282498546612433
cycle= 7 E= -2.83286883184199  delta_E= -3.54e-08  |g|= 1.89e-06  |ddm|= 0.0458
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309493457456  LUMO = 1.23724891801929
  mo_energy =
[-0.90230949  1.23724892  5.55744437 13.08556892 26.13567526 44.4333114 ]
E1 = -3.861118698223295  E_coul = 1.0282498362535306
cycle= 8 E= -2.83286886196976  delta_E= -3.01e-08  |g|= 4.28e-06  |ddm|= 0.0364
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309496948993  LUMO = 1.23724874124805
  mo_energy =
[-0.9023095   1.23724874  5.55744354 13.08556583 26.13567047 44.43330071]
E1 = -3.8611187163844147  E_coul = 1.0282499539742769
cycle= 9 E= -2.83286876241014  delta_E= 9.96e-08  |g|= 5.66e-06  |ddm|= 0.0614
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309475632643  LUMO = 1.23724898001525
  mo_energy =
[-0.90230948  1.23724898  5.55744466 13.08556976 26.13567644 44.43331309]
E1 = -3.8611186979465266  E_coul = 1.0282498991538085
cycle= 10 E= -2.83286879879272  delta_E= -3.64e-08  |g|= 1.64e-06  |ddm|= 0.071
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309466588441  LUMO = 1.23724898375322
  mo_energy =
[-0.90230947  1.23724898  5.5574446  13.0855699  26.13567693 44.43331633]
E1 = -3.861118698294512  E_coul = 1.0282499744821691
cycle= 11 E= -2.83286872381234  delta_E= 7.5e-08  |g|= 8.58e-06  |ddm|= 0.00346
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309453397627  LUMO = 1.23724921288861
  mo_energy =
[-0.90230945  1.23724921  5.55744565 13.08557403 26.13568362 44.43333224]
E1 = -3.8611186765303245  E_coul = 1.0282499031201109
cycle= 12 E= -2.83286877341021  delta_E= -4.96e-08  |g|= 2.49e-06  |ddm|= 0.08
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309451425277  LUMO = 1.23724929199528
  mo_energy =
[-0.90230945  1.23724929  5.55744602 13.08557534 26.1356856  44.43333607]
E1 = -3.861118668930758  E_coul = 1.028249884977382
cycle= 13 E= -2.83286878395338  delta_E= -1.05e-08  |g|= 1.6e-06  |ddm|= 0.0245
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90230944545912  LUMO = 1.23724937348429
  mo_energy =
[-0.90230945  1.23724937  5.55744635 13.08557709 26.1356888  44.43334617]
E1 = -3.8611186596115625  E_coul = 1.0282498672003828
cycle= 14 E= -2.83286879241118  delta_E= -8.46e-09  |g|= 1.57e-07  |ddm|= 0.0381
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309447174084  LUMO = 1.23724937855503
  mo_energy =
[-0.90230945  1.23724938  5.55744636 13.08557716 26.13568888 44.43334666]
E1 = -3.8611186583784574  E_coul = 1.0282498706527547
cycle= 15 E= -2.8328687877257  delta_E= 4.69e-09  |g|= 4.55e-07  |ddm|= 0.00344
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309443419989  LUMO = 1.23724947372684
  mo_energy =
[-0.90230944  1.23724947  5.55744678 13.08557893 26.13569184 44.43335415]
E1 = -3.861118648292294  E_coul = 1.028249822221416
cycle= 16 E= -2.83286882607088  delta_E= -3.83e-08  |g|= 3.71e-06  |ddm|= 0.0367
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309442053727  LUMO = 1.23724955516152
  mo_energy =
[-0.90230944  1.23724956  5.55744715 13.08558043 26.13569428 44.43335996]
E1 = -3.8611186395555244  E_coul = 1.0282498011304444
cycle= 17 E= -2.83286883842508  delta_E= -1.24e-08  |g|= 5.29e-06  |ddm|= 0.0306
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309456353092  LUMO = 1.23724934141961
  mo_energy =
[-0.90230946  1.23724934  5.55744612 13.08557696 26.13568913 44.43335052]
E1 = -3.861118656739514  E_coul = 1.0282498268856255
cycle= 18 E= -2.83286882985389  delta_E= 8.57e-09  |g|= 3.73e-06  |ddm|= 0.0606
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309462814076  LUMO = 1.23724927403604
  mo_energy =
[-0.90230946  1.23724927  5.55744584 13.08557581 26.13568728 44.43334519]
E1 = -3.8611186629243877  E_coul = 1.0282498569004084
cycle= 19 E= -2.83286880602398  delta_E= 2.38e-08  |g|= 1.01e-06  |ddm|= 0.0236
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309475301426  LUMO = 1.23724906896586
  mo_energy =
[-0.90230948  1.23724907  5.55744489 13.08557225 26.13568166 44.43333307]
E1 = -3.8611186813674347  E_coul = 1.028249870286431
cycle= 20 E= -2.832868811081  delta_E= -5.06e-09  |g|= 8.48e-07  |ddm|= 0.0668
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309479710717  LUMO = 1.23724896849883
  mo_energy =
[-0.90230948  1.23724897  5.55744441 13.08557055 26.13567901 44.43332776]
E1 = -3.8611186903666384  E_coul = 1.0282498928968047
cycle= 21 E= -2.83286879746983  delta_E= 1.36e-08  |g|= 8.72e-07  |ddm|= 0.0313
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309480057229  LUMO = 1.23724896535062
  mo_energy =
[-0.90230948  1.23724897  5.55744444 13.08557017 26.13567798 44.43332293]
E1 = -3.861118692751851  E_coul = 1.0282498533026552
cycle= 22 E= -2.8328688394492  delta_E= -4.2e-08  |g|= 2.88e-06  |ddm|= 0.0119
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309483867568  LUMO = 1.23724887820039
  mo_energy =
[-0.90230948  1.23724888  5.55744409 13.08556848 26.13567506 44.43331381]
E1 = -3.8611187030217895  E_coul = 1.0282499577835054
cycle= 23 E= -2.83286874523828  delta_E= 9.42e-08  |g|= 6.76e-06  |ddm|= 0.0383
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309475765203  LUMO = 1.23724898703357
  mo_energy =
[-0.90230948  1.23724899  5.55744459 13.08557025 26.13567775 44.43331992]
E1 = -3.8611186938360835  E_coul = 1.028249919543604
cycle= 24 E= -2.83286877429248  delta_E= -2.91e-08  |g|= 3.89e-06  |ddm|= 0.0332
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309466444221  LUMO = 1.23724909254662
  mo_energy =
[-0.90230947  1.23724909  5.55744503 13.08557221 26.13568103 44.43332946]
E1 = -3.86111868340261  E_coul = 1.028249953984277
cycle= 25 E= -2.83286872941833  delta_E= 4.49e-08  |g|= 7.16e-06  |ddm|= 0.0406
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309450076749  LUMO = 1.23724936681528
  mo_energy =
[-0.90230945  1.23724937  5.5574463  13.08557695 26.13568847 44.43334567]
E1 = -3.861118658862498  E_coul = 1.0282498520370027
cycle= 26 E= -2.8328688068255  delta_E= -7.74e-08  |g|= 1.57e-06  |ddm|= 0.0886
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309447067449  LUMO = 1.23724942978192
  mo_energy =
[-0.90230945  1.23724943  5.55744661 13.08557796 26.13568995 44.4333485 ]
E1 = -3.8611186534114608  E_coul = 1.0282498841164407
cycle= 27 E= -2.83286876929502  delta_E= 3.75e-08  |g|= 1.95e-06  |ddm|= 0.0185
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309443069158  LUMO = 1.23724952091578
  mo_energy =
[-0.90230944  1.23724952  5.55744703 13.08557951 26.13569231 44.43335344]
E1 = -3.861118644783901  E_coul = 1.0282498662607555
cycle= 28 E= -2.83286877852315  delta_E= -9.23e-09  |g|= 5.98e-07  |ddm|= 0.0298
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309441287807  LUMO = 1.2372496130604
  mo_energy =
[-0.90230944  1.23724961  5.55744749 13.08558111 26.13569481 44.43335802]
E1 = -3.8611186363443015  E_coul = 1.0282498506867852
cycle= 29 E= -2.83286878565752  delta_E= -7.13e-09  |g|= 5.25e-07  |ddm|= 0.0286
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309443188095  LUMO = 1.23724963216429
  mo_energy =
[-0.90230944  1.23724963  5.55744757 13.08558158 26.13569569 44.43336051]
E1 = -3.861118633097257  E_coul = 1.0282499453222742
cycle= 30 E= -2.83286868777498  delta_E= 9.79e-08  |g|= 8.79e-06  |ddm|= 0.0111
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309427954906  LUMO = 1.23724996741022
  mo_energy =
[-0.90230943  1.23724997  5.55744907 13.08558769 26.13570568 44.43338623]
E1 = -3.861118598752635  E_coul = 1.028249862163774
cycle= 31 E= -2.83286873658886  delta_E= -4.88e-08  |g|= 1.99e-06  |ddm|= 0.125
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309433393759  LUMO = 1.23725000967287
  mo_energy =
[-0.90230943  1.23725001  5.55744932 13.08558831 26.13570636 44.4333852 ]
E1 = -3.8611185944185826  E_coul = 1.0282497451970127
cycle= 32 E= -2.83286884922157  delta_E= -1.13e-07  |g|= 8.41e-06  |ddm|= 0.00968
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309448975045  LUMO = 1.23724984941104
  mo_energy =
[-0.90230945  1.23724985  5.55744865 13.08558542 26.13570154 44.43337155]
E1 = -3.8611186092168013  E_coul = 1.0282498565282128
cycle= 33 E= -2.83286875268859  delta_E= 9.65e-08  |g|= 1.37e-06  |ddm|= 0.0584
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309456515376  LUMO = 1.23724980254693
  mo_energy =
[-0.90230946  1.2372498   5.55744846 13.08558448 26.13569984 44.43336668]
E1 = -3.861118613036817  E_coul = 1.0282498460984084
cycle= 34 E= -2.83286876693841  delta_E= -1.42e-08  |g|= 5.45e-07  |ddm|= 0.0179
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309454397372  LUMO = 1.2372498892376
  mo_energy =
[-0.90230945  1.23724989  5.55744885 13.08558609 26.13570249 44.43337361]
E1 = -3.861118603575468  E_coul = 1.028249804319431
cycle= 35 E= -2.83286879925604  delta_E= -3.23e-08  |g|= 3.06e-06  |ddm|= 0.0335
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309461251781  LUMO = 1.23724981884878
  mo_energy =
[-0.90230946  1.23724982  5.55744854 13.08558489 26.13570061 44.43336898]
E1 = -3.8611186095336407  E_coul = 1.0282498593491858
cycle= 36 E= -2.83286875018445  delta_E= 4.91e-08  |g|= 1.79e-06  |ddm|= 0.0229
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309459916616  LUMO = 1.23724986776408
  mo_energy =
[-0.90230946  1.23724987  5.55744873 13.08558586 26.13570227 44.43337436]
E1 = -3.8611186031940568  E_coul = 1.0282498427034168
cycle= 37 E= -2.83286876049064  delta_E= -1.03e-08  |g|= 6.35e-07  |ddm|= 0.0229
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309458841818  LUMO = 1.23724991370988
  mo_energy =
[-0.90230946  1.23724991  5.55744893 13.08558678 26.13570386 44.43337934]
E1 = -3.86111859750136  E_coul = 1.0282498158151043
cycle= 38 E= -2.83286878168626  delta_E= -2.12e-08  |g|= 1.79e-06  |ddm|= 0.0208
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309472807435  LUMO = 1.23724969077989
  mo_energy =
[-0.90230947  1.23724969  5.55744791 13.08558283 26.13569754 44.4333646 ]
E1 = -3.861118618220372  E_coul = 1.0282498030512692
cycle= 39 E= -2.8328688151691  delta_E= -3.35e-08  |g|= 3.81e-06  |ddm|= 0.0761
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90230948141012  LUMO = 1.23724948357883
  mo_energy =
[-0.90230948  1.23724948  5.55744692 13.08557937 26.13569228 44.43335408]
E1 = -3.8611186369639974  E_coul = 1.0282499211399287
cycle= 40 E= -2.83286871582407  delta_E= 9.93e-08  |g|= 6.18e-06  |ddm|= 0.0646
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309462079644  LUMO = 1.23724982549963
  mo_energy =
[-0.90230946  1.23724983  5.55744853 13.08558519 26.13570126 44.4333733 ]
E1 = -3.8611186065660377  E_coul = 1.0282498773761397
cycle= 41 E= -2.8328687291899  delta_E= -1.34e-08  |g|= 3.78e-06  |ddm|= 0.108
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309459307638  LUMO = 1.23724986267814
  mo_energy =
[-0.90230946  1.23724986  5.55744867 13.08558609 26.13570301 44.43337896]
E1 = -3.861118601873125  E_coul = 1.0282498747444415
cycle= 42 E= -2.83286872712868  delta_E= 2.06e-09  |g|= 3.47e-06  |ddm|= 0.0198
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309455029268  LUMO = 1.2372499603564
  mo_energy =
[-0.90230946  1.23724996  5.55744912 13.08558775 26.13570556 44.43338473]
E1 = -3.8611185925887077  E_coul = 1.0282498183244932
cycle= 43 E= -2.83286877426421  delta_E= -4.71e-08  |g|= 1.72e-06  |ddm|= 0.0323
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309452592179  LUMO = 1.23725003779637
  mo_energy =
[-0.90230945  1.23725004  5.55744951 13.08558888 26.13570703 44.43338661]
E1 = -3.8611185861751958  E_coul = 1.0282498595865237
cycle= 44 E= -2.83286872658867  delta_E= 4.77e-08  |g|= 2.65e-06  |ddm|= 0.0199
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90230945110336  LUMO = 1.23725009975375
  mo_energy =
[-0.90230945  1.2372501   5.55744981 13.08558983 26.13570834 44.43338929]
E1 = -3.8611185802775854  E_coul = 1.0282497738462506
cycle= 45 E= -2.83286880643133  delta_E= -7.98e-08  |g|= 5.19e-06  |ddm|= 0.0188
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309458276071  LUMO = 1.23725001199493
  mo_energy =
[-0.90230946  1.23725001  5.55744945 13.08558809 26.13570525 44.4333799 ]
E1 = -3.861118589572962  E_coul = 1.028249801944486
cycle= 46 E= -2.83286878762848  delta_E= 1.88e-08  |g|= 2.87e-06  |ddm|= 0.0371
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309459516375  LUMO = 1.23725001539219
  mo_energy =
[-0.90230946  1.23725002  5.5574495  13.08558795 26.13570472 44.43337688]
E1 = -3.8611185901529845  E_coul = 1.02824976321963
cycle= 47 E= -2.83286882693335  delta_E= -3.93e-08  |g|= 6.02e-06  |ddm|= 0.00517
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309462738528  LUMO = 1.23724997904155
  mo_energy =
[-0.90230946  1.23724998  5.55744933 13.08558736 26.13570386 44.43337575]
E1 = -3.861118592736782  E_coul = 1.0282497914434099
cycle= 48 E= -2.83286880129337  delta_E= 2.56e-08  |g|= 3.65e-06  |ddm|= 0.00938
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309476185208  LUMO = 1.23724975426006
  mo_energy =
[-0.90230948  1.23724975  5.55744826 13.08558348 26.13569785 44.43336362]
E1 = -3.861118612157837  E_coul = 1.028249864805487
cycle= 49 E= -2.83286874735235  delta_E= 5.39e-08  |g|= 2.66e-06  |ddm|= 0.07
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309478103181  LUMO = 1.23724971241735
  mo_energy =
[-0.90230948  1.23724971  5.55744807 13.08558267 26.13569644 44.43336049]
E1 = -3.8611186162910576  E_coul = 1.0282499228057314
cycle= 50 E= -2.83286869348533  delta_E= 5.39e-08  |g|= 8e-06  |ddm|= 0.0156
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8611186162910576  E_coul = 1.0282499228057314

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.902309385342472  LUMO = 1.23725119487084
  mo_energy =
[-0.90230939  1.23725119  5.55745471 13.08561026 26.13574244 44.43347376]
E1 = -3.8611184739034554  E_coul = 1.028249675216761
Extra cycle  E= -2.83286879868669  delta_E= -1.05e-07  |g|= 9.93e-06  |ddm|= 0.536
    CPU time for scf_cycle      0.51 sec, wall time      0.51 sec
exp = [4.84212524 4.20451534 3.61180668 3.00462641 2.55828148 0.34542108]
E = -2.8328687986866945
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:29 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  4.84212524384        1
[INPUT] 0    0    [1    /1   ]  4.20451534015        1
[INPUT] 0    0    [1    /1   ]  3.61180668093        1
[INPUT] 0    0    [1    /1   ]  3.00462640702        1
[INPUT] 0    0    [1    /1   ]  2.55828147583        1
[INPUT] 0    0    [1    /1   ]  0.345421081514       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [4.842125243838476, 1.0]], [0, [4.204515340151593, 1.0]], [0, [3.6118066809280553, 1.0]], [0, [3.004626407023771, 1.0]], [0, [2.55828147582706, 1.0]], [0, [0.3454210815143248, 1.0]]]}
ecp = {}
CPU time:        26.87
Set gradient conv threshold to 3.16228e-05
cond(S) = 198154554.82068992

WARN: Singularity detected in overlap matrix (condition number = 1.98e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8504959514617263  E_coul = 1.0237582947855388
init E= -2.82673765667619
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.904465094382704  LUMO = 1.23357120031164
  mo_energy =
[-0.90446509  1.2335712   5.55232756 13.08093234 26.131224   44.4310016 ]
E1 = -3.860684110163215  E_coul = 1.0278310421746237
cycle= 1 E= -2.83285306798859  delta_E= -0.00612  |g|= 0.0142  |ddm|= 1.73e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.902518056463771  LUMO = 1.23704727250242
  mo_energy =
[-0.90251806  1.23704727  5.55703582 13.08516751 26.13525349 44.43302266]
E1 = -3.861010939331744  E_coul = 1.0281423004088757
cycle= 2 E= -2.83286863892287  delta_E= -1.56e-05  |g|= 0.00128  |ddm|= 1.1e+03
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.902352325320456  LUMO = 1.23722384773157
  mo_energy =
[-0.90235233  1.23722385  5.55737887 13.08548379 26.13557303 44.43318879]
E1 = -3.8611076336236736  E_coul = 1.028238900942467
cycle= 3 E= -2.83286873268121  delta_E= -9.38e-08  |g|= 7.43e-05  |ddm|=  100
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.902308449967748  LUMO = 1.23725157507409
  mo_energy =
[-0.90230845  1.23725158  5.55745563 13.08560494 26.13572858 44.4334186 ]
E1 = -3.8611187632708406  E_coul = 1.028249958230961
cycle= 4 E= -2.83286880503988  delta_E= -7.24e-08  |g|= 8.56e-06  |ddm|= 4.13
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.902309554950219  LUMO = 1.23724905325557
  mo_energy =
[-0.90230955  1.23724905  5.55744512 13.08557166 26.1356794  44.43332112]
E1 = -3.86111866550693  E_coul = 1.0282498355375813
cycle= 5 E= -2.83286882996935  delta_E= -2.49e-08  |g|= 2.45e-06  |ddm|= 0.454
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309522203052  LUMO = 1.23724889793465
  mo_energy =
[-0.90230952  1.2372489   5.5574444  13.08556822 26.13567349 44.43330316]
E1 = -3.8611186951237504  E_coul = 1.0282498986622712
cycle= 6 E= -2.83286879646148  delta_E= 3.35e-08  |g|= 2.26e-06  |ddm|= 0.0886
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309495778555  LUMO = 1.23724902628196
  mo_energy =
[-0.9023095   1.23724903  5.5574449  13.08557077 26.13567805 44.43331625]
E1 = -3.8611186865032296  E_coul = 1.0282498546612433
cycle= 7 E= -2.83286883184199  delta_E= -3.54e-08  |g|= 1.89e-06  |ddm|= 0.0458
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309493457456  LUMO = 1.23724891801929
  mo_energy =
[-0.90230949  1.23724892  5.55744437 13.08556892 26.13567526 44.4333114 ]
E1 = -3.861118698223295  E_coul = 1.0282498362535306
cycle= 8 E= -2.83286886196976  delta_E= -3.01e-08  |g|= 4.28e-06  |ddm|= 0.0364
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309496948993  LUMO = 1.23724874124805
  mo_energy =
[-0.9023095   1.23724874  5.55744354 13.08556583 26.13567047 44.43330071]
E1 = -3.8611187163844147  E_coul = 1.0282499539742769
cycle= 9 E= -2.83286876241014  delta_E= 9.96e-08  |g|= 5.66e-06  |ddm|= 0.0614
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309475632643  LUMO = 1.23724898001525
  mo_energy =
[-0.90230948  1.23724898  5.55744466 13.08556976 26.13567644 44.43331309]
E1 = -3.8611186979465266  E_coul = 1.0282498991538085
cycle= 10 E= -2.83286879879272  delta_E= -3.64e-08  |g|= 1.64e-06  |ddm|= 0.071
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309466588441  LUMO = 1.23724898375322
  mo_energy =
[-0.90230947  1.23724898  5.5574446  13.0855699  26.13567693 44.43331633]
E1 = -3.861118698294512  E_coul = 1.0282499744821691
cycle= 11 E= -2.83286872381234  delta_E= 7.5e-08  |g|= 8.58e-06  |ddm|= 0.00346
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309453397627  LUMO = 1.23724921288861
  mo_energy =
[-0.90230945  1.23724921  5.55744565 13.08557403 26.13568362 44.43333224]
E1 = -3.8611186765303245  E_coul = 1.0282499031201109
cycle= 12 E= -2.83286877341021  delta_E= -4.96e-08  |g|= 2.49e-06  |ddm|= 0.08
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309451425277  LUMO = 1.23724929199528
  mo_energy =
[-0.90230945  1.23724929  5.55744602 13.08557534 26.1356856  44.43333607]
E1 = -3.861118668930758  E_coul = 1.028249884977382
cycle= 13 E= -2.83286878395338  delta_E= -1.05e-08  |g|= 1.6e-06  |ddm|= 0.0245
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90230944545912  LUMO = 1.23724937348429
  mo_energy =
[-0.90230945  1.23724937  5.55744635 13.08557709 26.1356888  44.43334617]
E1 = -3.8611186596115625  E_coul = 1.0282498672003828
cycle= 14 E= -2.83286879241118  delta_E= -8.46e-09  |g|= 1.57e-07  |ddm|= 0.0381
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309447174084  LUMO = 1.23724937855503
  mo_energy =
[-0.90230945  1.23724938  5.55744636 13.08557716 26.13568888 44.43334666]
E1 = -3.8611186583784574  E_coul = 1.0282498706527547
cycle= 15 E= -2.8328687877257  delta_E= 4.69e-09  |g|= 4.55e-07  |ddm|= 0.00344
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309443419989  LUMO = 1.23724947372684
  mo_energy =
[-0.90230944  1.23724947  5.55744678 13.08557893 26.13569184 44.43335415]
E1 = -3.861118648292294  E_coul = 1.028249822221416
cycle= 16 E= -2.83286882607088  delta_E= -3.83e-08  |g|= 3.71e-06  |ddm|= 0.0367
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309442053727  LUMO = 1.23724955516152
  mo_energy =
[-0.90230944  1.23724956  5.55744715 13.08558043 26.13569428 44.43335996]
E1 = -3.8611186395555244  E_coul = 1.0282498011304444
cycle= 17 E= -2.83286883842508  delta_E= -1.24e-08  |g|= 5.29e-06  |ddm|= 0.0306
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309456353092  LUMO = 1.23724934141961
  mo_energy =
[-0.90230946  1.23724934  5.55744612 13.08557696 26.13568913 44.43335052]
E1 = -3.861118656739514  E_coul = 1.0282498268856255
cycle= 18 E= -2.83286882985389  delta_E= 8.57e-09  |g|= 3.73e-06  |ddm|= 0.0606
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309462814076  LUMO = 1.23724927403604
  mo_energy =
[-0.90230946  1.23724927  5.55744584 13.08557581 26.13568728 44.43334519]
E1 = -3.8611186629243877  E_coul = 1.0282498569004084
cycle= 19 E= -2.83286880602398  delta_E= 2.38e-08  |g|= 1.01e-06  |ddm|= 0.0236
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309475301426  LUMO = 1.23724906896586
  mo_energy =
[-0.90230948  1.23724907  5.55744489 13.08557225 26.13568166 44.43333307]
E1 = -3.8611186813674347  E_coul = 1.028249870286431
cycle= 20 E= -2.832868811081  delta_E= -5.06e-09  |g|= 8.48e-07  |ddm|= 0.0668
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309479710717  LUMO = 1.23724896849883
  mo_energy =
[-0.90230948  1.23724897  5.55744441 13.08557055 26.13567901 44.43332776]
E1 = -3.8611186903666384  E_coul = 1.0282498928968047
cycle= 21 E= -2.83286879746983  delta_E= 1.36e-08  |g|= 8.72e-07  |ddm|= 0.0313
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309480057229  LUMO = 1.23724896535062
  mo_energy =
[-0.90230948  1.23724897  5.55744444 13.08557017 26.13567798 44.43332293]
E1 = -3.861118692751851  E_coul = 1.0282498533026552
cycle= 22 E= -2.8328688394492  delta_E= -4.2e-08  |g|= 2.88e-06  |ddm|= 0.0119
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309483867568  LUMO = 1.23724887820039
  mo_energy =
[-0.90230948  1.23724888  5.55744409 13.08556848 26.13567506 44.43331381]
E1 = -3.8611187030217895  E_coul = 1.0282499577835054
cycle= 23 E= -2.83286874523828  delta_E= 9.42e-08  |g|= 6.76e-06  |ddm|= 0.0383
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309475765203  LUMO = 1.23724898703357
  mo_energy =
[-0.90230948  1.23724899  5.55744459 13.08557025 26.13567775 44.43331992]
E1 = -3.8611186938360835  E_coul = 1.028249919543604
cycle= 24 E= -2.83286877429248  delta_E= -2.91e-08  |g|= 3.89e-06  |ddm|= 0.0332
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309466444221  LUMO = 1.23724909254662
  mo_energy =
[-0.90230947  1.23724909  5.55744503 13.08557221 26.13568103 44.43332946]
E1 = -3.86111868340261  E_coul = 1.028249953984277
cycle= 25 E= -2.83286872941833  delta_E= 4.49e-08  |g|= 7.16e-06  |ddm|= 0.0406
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309450076749  LUMO = 1.23724936681528
  mo_energy =
[-0.90230945  1.23724937  5.5574463  13.08557695 26.13568847 44.43334567]
E1 = -3.861118658862498  E_coul = 1.0282498520370027
cycle= 26 E= -2.8328688068255  delta_E= -7.74e-08  |g|= 1.57e-06  |ddm|= 0.0886
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309447067449  LUMO = 1.23724942978192
  mo_energy =
[-0.90230945  1.23724943  5.55744661 13.08557796 26.13568995 44.4333485 ]
E1 = -3.8611186534114608  E_coul = 1.0282498841164407
cycle= 27 E= -2.83286876929502  delta_E= 3.75e-08  |g|= 1.95e-06  |ddm|= 0.0185
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309443069158  LUMO = 1.23724952091578
  mo_energy =
[-0.90230944  1.23724952  5.55744703 13.08557951 26.13569231 44.43335344]
E1 = -3.861118644783901  E_coul = 1.0282498662607555
cycle= 28 E= -2.83286877852315  delta_E= -9.23e-09  |g|= 5.98e-07  |ddm|= 0.0298
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309441287807  LUMO = 1.2372496130604
  mo_energy =
[-0.90230944  1.23724961  5.55744749 13.08558111 26.13569481 44.43335802]
E1 = -3.8611186363443015  E_coul = 1.0282498506867852
cycle= 29 E= -2.83286878565752  delta_E= -7.13e-09  |g|= 5.25e-07  |ddm|= 0.0286
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309443188095  LUMO = 1.23724963216429
  mo_energy =
[-0.90230944  1.23724963  5.55744757 13.08558158 26.13569569 44.43336051]
E1 = -3.861118633097257  E_coul = 1.0282499453222742
cycle= 30 E= -2.83286868777498  delta_E= 9.79e-08  |g|= 8.79e-06  |ddm|= 0.0111
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309427954906  LUMO = 1.23724996741022
  mo_energy =
[-0.90230943  1.23724997  5.55744907 13.08558769 26.13570568 44.43338623]
E1 = -3.861118598752635  E_coul = 1.028249862163774
cycle= 31 E= -2.83286873658886  delta_E= -4.88e-08  |g|= 1.99e-06  |ddm|= 0.125
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309433393759  LUMO = 1.23725000967287
  mo_energy =
[-0.90230943  1.23725001  5.55744932 13.08558831 26.13570636 44.4333852 ]
E1 = -3.8611185944185826  E_coul = 1.0282497451970127
cycle= 32 E= -2.83286884922157  delta_E= -1.13e-07  |g|= 8.41e-06  |ddm|= 0.00968
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309448975045  LUMO = 1.23724984941104
  mo_energy =
[-0.90230945  1.23724985  5.55744865 13.08558542 26.13570154 44.43337155]
E1 = -3.8611186092168013  E_coul = 1.0282498565282128
cycle= 33 E= -2.83286875268859  delta_E= 9.65e-08  |g|= 1.37e-06  |ddm|= 0.0584
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309456515376  LUMO = 1.23724980254693
  mo_energy =
[-0.90230946  1.2372498   5.55744846 13.08558448 26.13569984 44.43336668]
E1 = -3.861118613036817  E_coul = 1.0282498460984084
cycle= 34 E= -2.83286876693841  delta_E= -1.42e-08  |g|= 5.45e-07  |ddm|= 0.0179
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309454397372  LUMO = 1.2372498892376
  mo_energy =
[-0.90230945  1.23724989  5.55744885 13.08558609 26.13570249 44.43337361]
E1 = -3.861118603575468  E_coul = 1.028249804319431
cycle= 35 E= -2.83286879925604  delta_E= -3.23e-08  |g|= 3.06e-06  |ddm|= 0.0335
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309461251781  LUMO = 1.23724981884878
  mo_energy =
[-0.90230946  1.23724982  5.55744854 13.08558489 26.13570061 44.43336898]
E1 = -3.8611186095336407  E_coul = 1.0282498593491858
cycle= 36 E= -2.83286875018445  delta_E= 4.91e-08  |g|= 1.79e-06  |ddm|= 0.0229
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309459916616  LUMO = 1.23724986776408
  mo_energy =
[-0.90230946  1.23724987  5.55744873 13.08558586 26.13570227 44.43337436]
E1 = -3.8611186031940568  E_coul = 1.0282498427034168
cycle= 37 E= -2.83286876049064  delta_E= -1.03e-08  |g|= 6.35e-07  |ddm|= 0.0229
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309458841818  LUMO = 1.23724991370988
  mo_energy =
[-0.90230946  1.23724991  5.55744893 13.08558678 26.13570386 44.43337934]
E1 = -3.86111859750136  E_coul = 1.0282498158151043
cycle= 38 E= -2.83286878168626  delta_E= -2.12e-08  |g|= 1.79e-06  |ddm|= 0.0208
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309472807435  LUMO = 1.23724969077989
  mo_energy =
[-0.90230947  1.23724969  5.55744791 13.08558283 26.13569754 44.4333646 ]
E1 = -3.861118618220372  E_coul = 1.0282498030512692
cycle= 39 E= -2.8328688151691  delta_E= -3.35e-08  |g|= 3.81e-06  |ddm|= 0.0761
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90230948141012  LUMO = 1.23724948357883
  mo_energy =
[-0.90230948  1.23724948  5.55744692 13.08557937 26.13569228 44.43335408]
E1 = -3.8611186369639974  E_coul = 1.0282499211399287
cycle= 40 E= -2.83286871582407  delta_E= 9.93e-08  |g|= 6.18e-06  |ddm|= 0.0646
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309462079644  LUMO = 1.23724982549963
  mo_energy =
[-0.90230946  1.23724983  5.55744853 13.08558519 26.13570126 44.4333733 ]
E1 = -3.8611186065660377  E_coul = 1.0282498773761397
cycle= 41 E= -2.8328687291899  delta_E= -1.34e-08  |g|= 3.78e-06  |ddm|= 0.108
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309459307638  LUMO = 1.23724986267814
  mo_energy =
[-0.90230946  1.23724986  5.55744867 13.08558609 26.13570301 44.43337896]
E1 = -3.861118601873125  E_coul = 1.0282498747444415
cycle= 42 E= -2.83286872712868  delta_E= 2.06e-09  |g|= 3.47e-06  |ddm|= 0.0198
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309455029268  LUMO = 1.2372499603564
  mo_energy =
[-0.90230946  1.23724996  5.55744912 13.08558775 26.13570556 44.43338473]
E1 = -3.8611185925887077  E_coul = 1.0282498183244932
cycle= 43 E= -2.83286877426421  delta_E= -4.71e-08  |g|= 1.72e-06  |ddm|= 0.0323
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309452592179  LUMO = 1.23725003779637
  mo_energy =
[-0.90230945  1.23725004  5.55744951 13.08558888 26.13570703 44.43338661]
E1 = -3.8611185861751958  E_coul = 1.0282498595865237
cycle= 44 E= -2.83286872658867  delta_E= 4.77e-08  |g|= 2.65e-06  |ddm|= 0.0199
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90230945110336  LUMO = 1.23725009975375
  mo_energy =
[-0.90230945  1.2372501   5.55744981 13.08558983 26.13570834 44.43338929]
E1 = -3.8611185802775854  E_coul = 1.0282497738462506
cycle= 45 E= -2.83286880643133  delta_E= -7.98e-08  |g|= 5.19e-06  |ddm|= 0.0188
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309458276071  LUMO = 1.23725001199493
  mo_energy =
[-0.90230946  1.23725001  5.55744945 13.08558809 26.13570525 44.4333799 ]
E1 = -3.861118589572962  E_coul = 1.028249801944486
cycle= 46 E= -2.83286878762848  delta_E= 1.88e-08  |g|= 2.87e-06  |ddm|= 0.0371
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309459516375  LUMO = 1.23725001539219
  mo_energy =
[-0.90230946  1.23725002  5.5574495  13.08558795 26.13570472 44.43337688]
E1 = -3.8611185901529845  E_coul = 1.02824976321963
cycle= 47 E= -2.83286882693335  delta_E= -3.93e-08  |g|= 6.02e-06  |ddm|= 0.00517
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309462738528  LUMO = 1.23724997904155
  mo_energy =
[-0.90230946  1.23724998  5.55744933 13.08558736 26.13570386 44.43337575]
E1 = -3.861118592736782  E_coul = 1.0282497914434099
cycle= 48 E= -2.83286880129337  delta_E= 2.56e-08  |g|= 3.65e-06  |ddm|= 0.00938
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309476185208  LUMO = 1.23724975426006
  mo_energy =
[-0.90230948  1.23724975  5.55744826 13.08558348 26.13569785 44.43336362]
E1 = -3.861118612157837  E_coul = 1.028249864805487
cycle= 49 E= -2.83286874735235  delta_E= 5.39e-08  |g|= 2.66e-06  |ddm|= 0.07
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309478103181  LUMO = 1.23724971241735
  mo_energy =
[-0.90230948  1.23724971  5.55744807 13.08558267 26.13569644 44.43336049]
E1 = -3.8611186162910576  E_coul = 1.0282499228057314
cycle= 50 E= -2.83286869348533  delta_E= 5.39e-08  |g|= 8e-06  |ddm|= 0.0156
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8611186162910576  E_coul = 1.0282499228057314

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.902309385342472  LUMO = 1.23725119487084
  mo_energy =
[-0.90230939  1.23725119  5.55745471 13.08561026 26.13574244 44.43347376]
E1 = -3.8611184739034554  E_coul = 1.028249675216761
Extra cycle  E= -2.83286879868669  delta_E= -1.05e-07  |g|= 9.93e-06  |ddm|= 0.536
    CPU time for scf_cycle      0.50 sec, wall time      0.50 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 198154554.82068992

WARN: Singularity detected in overlap matrix (condition number = 1.98e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8611184739034554  E_coul = 1.028249675216761
init E= -2.83286879868669
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.90230956173416  LUMO = 1.23724911956681
  mo_energy =
[-0.90230956  1.23724912  5.55744527 13.08557384 26.13568401 44.43333878]
E1 = -3.8611186500329615  E_coul = 1.0282498915418772
cycle= 1 E= -2.83286875849108  delta_E= 4.02e-08  |g|= 3.57e-06  |ddm|= 0.671
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.902309433473913  LUMO = 1.23724989751035
  mo_energy =
[-0.90230943  1.2372499   5.55744859 13.08558713 26.13570567 44.43339422]
E1 = -3.8611185979418554  E_coul = 1.0282498411075147
cycle= 2 E= -2.83286875683434  delta_E= 1.66e-09  |g|= 2.25e-07  |ddm|= 0.232
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309445670131  LUMO = 1.23724990035765
  mo_energy =
[-0.90230945  1.2372499   5.55744861 13.08558725 26.13570592 44.43339593]
E1 = -3.861118594014247  E_coul = 1.0282497507464101
cycle= 3 E= -2.83286884326784  delta_E= -8.64e-08  |g|= 8.21e-06  |ddm|= 0.00972
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309479200705  LUMO = 1.2372494189129
  mo_energy =
[-0.90230948  1.23724942  5.55744655 13.08557842 26.13569115 44.43335475]
E1 = -3.86111864237409  E_coul = 1.0282499057465695
cycle= 4 E= -2.83286873662752  delta_E= 1.07e-07  |g|= 4.43e-06  |ddm|= 0.183
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309463262102  LUMO = 1.23724966788559
  mo_energy =
[-0.90230946  1.23724967  5.5574477  13.08558258 26.13569751 44.43336928]
E1 = -3.861118620379585  E_coul = 1.0282498514936667
cycle= 5 E= -2.83286876888592  delta_E= -3.23e-08  |g|= 4.64e-07  |ddm|= 0.0789
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90230946234647  LUMO = 1.23724969058883
  mo_energy =
[-0.90230946  1.23724969  5.55744781 13.08558294 26.13569801 44.43336989]
E1 = -3.86111861844134  E_coul = 1.0282498375744495
cycle= 6 E= -2.83286878086689  delta_E= -1.2e-08  |g|= 7.74e-07  |ddm|= 0.00634
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309463896495  LUMO = 1.23724967497876
  mo_energy =
[-0.90230946  1.23724967  5.55744776 13.08558261 26.13569741 44.43336771]
E1 = -3.861118620459422  E_coul = 1.0282499051592568
cycle= 7 E= -2.83286871530017  delta_E= 6.56e-08  |g|= 5.62e-06  |ddm|= 0.00813
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309455494441  LUMO = 1.23724983826152
  mo_energy =
[-0.90230946  1.23724984  5.55744852 13.08558549 26.13570196 44.43337796]
E1 = -3.8611186051032917  E_coul = 1.0282498568228442
cycle= 8 E= -2.83286874828045  delta_E= -3.3e-08  |g|= 1.51e-06  |ddm|= 0.0551
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309454272586  LUMO = 1.23724989571204
  mo_energy =
[-0.90230945  1.2372499   5.55744882 13.08558638 26.13570319 44.43337924]
E1 = -3.86111860036356  E_coul = 1.028249804842096
cycle= 9 E= -2.83286879552146  delta_E= -4.72e-08  |g|= 2.81e-06  |ddm|= 0.0148
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90230946200722  LUMO = 1.23724980864924
  mo_energy =
[-0.90230946  1.23724981  5.55744844 13.08558491 26.13570087 44.43337361]
E1 = -3.8611186079975988  E_coul = 1.0282498351347373
cycle= 10 E= -2.83286877286286  delta_E= 2.27e-08  |g|= 3.71e-07  |ddm|= 0.0284
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309463383329  LUMO = 1.23724977004765
  mo_energy =
[-0.90230946  1.23724977  5.55744826 13.08558426 26.1356999  44.43337146]
E1 = -3.8611186117678074  E_coul = 1.0282497969076305
cycle= 11 E= -2.83286881486018  delta_E= -4.2e-08  |g|= 4.37e-06  |ddm|= 0.013
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309458723836  LUMO = 1.23724983835976
  mo_energy =
[-0.90230946  1.23724984  5.55744857 13.08558542 26.1357017  44.43337583]
E1 = -3.8611186055815594  E_coul = 1.0282497641499575
cycle= 12 E= -2.8328688414316  delta_E= -2.66e-08  |g|= 6.7e-06  |ddm|= 0.0224
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309474118333  LUMO = 1.23724956471828
  mo_energy =
[-0.90230947  1.23724956  5.55744728 13.08558091 26.13569492 44.43336168]
E1 = -3.861118629559324  E_coul = 1.0282498472219654
cycle= 13 E= -2.83286878233736  delta_E= 5.91e-08  |g|= 5.5e-07  |ddm|= 0.0839
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309475226305  LUMO = 1.23724953624927
  mo_energy =
[-0.90230948  1.23724954  5.55744716 13.0855804  26.13569412 44.43335943]
E1 = -3.8611186325797076  E_coul = 1.0282499021353058
cycle= 14 E= -2.8328687304444  delta_E= 5.19e-08  |g|= 5e-06  |ddm|= 0.0108
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309468040883  LUMO = 1.23724963710631
  mo_energy =
[-0.90230947  1.23724964  5.55744758 13.0855823  26.13569733 44.43336886]
E1 = -3.8611186220767064  E_coul = 1.0282498529100619
cycle= 15 E= -2.83286876916664  delta_E= -3.87e-08  |g|= 4.55e-07  |ddm|= 0.0402
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309474675995  LUMO = 1.23724951025369
  mo_energy =
[-0.90230947  1.23724951  5.557447   13.08558001 26.13569366 44.43336035]
E1 = -3.8611186342695882  E_coul = 1.0282499005161079
cycle= 16 E= -2.83286873375348  delta_E= 3.54e-08  |g|= 4.37e-06  |ddm|= 0.0443
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309471039011  LUMO = 1.23724954207545
  mo_energy =
[-0.90230947  1.23724954  5.55744713 13.08558058 26.13569463 44.43336327]
E1 = -3.861118631537956  E_coul = 1.0282497804031712
cycle= 17 E= -2.83286885113478  delta_E= -1.17e-07  |g|= 6.56e-06  |ddm|= 0.0113
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309476042107  LUMO = 1.23724940159424
  mo_energy =
[-0.90230948  1.2372494   5.55744647 13.0855781  26.13569077 44.43335511]
E1 = -3.8611186449292956  E_coul = 1.0282498499544208
cycle= 18 E= -2.83286879497487  delta_E= 5.62e-08  |g|= 9.31e-07  |ddm|= 0.0467
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309476497821  LUMO = 1.23724937294326
  mo_energy =
[-0.90230948  1.23724937  5.55744638 13.08557739 26.13568934 44.43334942]
E1 = -3.861118649669054  E_coul = 1.0282498666399913
cycle= 19 E= -2.83286878302906  delta_E= 1.19e-08  |g|= 4.7e-07  |ddm|= 0.0186
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309470149733  LUMO = 1.23724944765251
  mo_energy =
[-0.90230947  1.23724945  5.5574467  13.0855787  26.13569145 44.43335454]
E1 = -3.861118643057272  E_coul = 1.0282499160394634
cycle= 20 E= -2.83286872701781  delta_E= 5.6e-08  |g|= 5.47e-06  |ddm|= 0.0251
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309453505985  LUMO = 1.23724973381327
  mo_energy =
[-0.90230945  1.23724973  5.55744803 13.08558352 26.13569889 44.43337084]
E1 = -3.8611186172488186  E_coul = 1.028249814248727
cycle= 21 E= -2.83286880300009  delta_E= -7.6e-08  |g|= 3.21e-06  |ddm|= 0.0918
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90230945685671  LUMO = 1.23724969268688
  mo_energy =
[-0.90230946  1.23724969  5.55744786 13.08558266 26.13569728 44.43336659]
E1 = -3.8611186214946964  E_coul = 1.0282498628896948
cycle= 22 E= -2.832868758605  delta_E= 4.44e-08  |g|= 1.31e-06  |ddm|= 0.0173
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309461068428  LUMO = 1.23724964992734
  mo_energy =
[-0.90230946  1.23724965  5.55744771 13.08558168 26.13569541 44.43335957]
E1 = -3.86111862684228  E_coul = 1.0282498198040793
cycle= 23 E= -2.8328688070382  delta_E= -4.84e-08  |g|= 2.77e-06  |ddm|= 0.0228
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309465506968  LUMO = 1.23724956574135
  mo_energy =
[-0.90230947  1.23724957  5.55744734 13.08558021 26.135693   44.43335303]
E1 = -3.861118635250804  E_coul = 1.0282499035811172
cycle= 24 E= -2.83286873166969  delta_E= 7.54e-08  |g|= 4.54e-06  |ddm|= 0.0306
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309465181029  LUMO = 1.23724957801109
  mo_energy =
[-0.90230947  1.23724958  5.5574474  13.08558033 26.13569306 44.43335228]
E1 = -3.861118634470869  E_coul = 1.0282499164026804
cycle= 25 E= -2.83286871806819  delta_E= 1.36e-08  |g|= 6.22e-06  |ddm|= 0.00141
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90230944836479  LUMO = 1.23724991321073
  mo_energy =
[-0.90230945  1.23724991  5.55744897 13.08558608 26.13570194 44.43337144]
E1 = -3.8611186036982605  E_coul = 1.0282498822035893
cycle= 26 E= -2.83286872149467  delta_E= -3.43e-09  |g|= 4.08e-06  |ddm|= 0.109
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309441756297  LUMO = 1.2372500847698
  mo_energy =
[-0.90230944  1.23725008  5.55744975 13.08558903 26.13570649 44.4333827 ]
E1 = -3.8611185865182165  E_coul = 1.0282498120705181
cycle= 27 E= -2.8328687744477  delta_E= -5.3e-08  |g|= 1.5e-06  |ddm|= 0.0597
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309444629163  LUMO = 1.23725009401336
  mo_energy =
[-0.90230944  1.23725009  5.55744978 13.0855893  26.13570703 44.43338483]
E1 = -3.861118583962147  E_coul = 1.02824972308415
cycle= 28 E= -2.832868860878  delta_E= -8.64e-08  |g|= 9.76e-06  |ddm|= 0.00829
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309465060955  LUMO = 1.23724978353201
  mo_energy =
[-0.90230947  1.23724978  5.55744839 13.08558383 26.13569821 44.43336319]
E1 = -3.8611186130419224  E_coul = 1.0282498320202593
cycle= 29 E= -2.83286878102166  delta_E= 7.99e-08  |g|= 1.08e-06  |ddm|= 0.107
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309462576616  LUMO = 1.23724984213074
  mo_energy =
[-0.90230946  1.23724984  5.55744867 13.08558482 26.13569978 44.43336635]
E1 = -3.8611186077616617  E_coul = 1.0282498617663243
cycle= 30 E= -2.83286874599534  delta_E= 3.5e-08  |g|= 2.45e-06  |ddm|= 0.0183
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309461857403  LUMO = 1.23724985316116
  mo_energy =
[-0.90230946  1.23724985  5.55744868 13.08558523 26.13570068 44.43337013]
E1 = -3.8611186053107502  E_coul = 1.028249829299085
cycle= 31 E= -2.83286877601167  delta_E= -3e-08  |g|= 7.8e-07  |ddm|= 0.0109
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309459324905  LUMO = 1.23724992741765
  mo_energy =
[-0.90230946  1.23724993  5.55744903 13.08558648 26.13570262 44.43337475]
E1 = -3.861118597957373  E_coul = 1.0282497958666632
cycle= 32 E= -2.83286880209071  delta_E= -2.61e-08  |g|= 3.51e-06  |ddm|= 0.0253
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309470457594  LUMO = 1.23724973754729
  mo_energy =
[-0.90230947  1.23724974  5.55744813 13.08558337 26.13569798 44.43336601]
E1 = -3.861118614169054  E_coul = 1.0282498362625145
cycle= 33 E= -2.83286877790654  delta_E= 2.42e-08  |g|= 5.22e-07  |ddm|= 0.0565
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309479205163  LUMO = 1.23724957665666
  mo_energy =
[-0.90230948  1.23724958  5.55744736 13.08558067 26.13569386 44.43335778]
E1 = -3.8611186280156016  E_coul = 1.0282498420704165
cycle= 34 E= -2.83286878594518  delta_E= -8.04e-09  |g|= 6.5e-07  |ddm|= 0.0489
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309485744504  LUMO = 1.23724942862099
  mo_energy =
[-0.90230949  1.23724943  5.5574467  13.08557816 26.13569002 44.43334791]
E1 = -3.8611186427896835  E_coul = 1.0282498834701077
cycle= 35 E= -2.83286875931958  delta_E= 2.66e-08  |g|= 2.62e-06  |ddm|= 0.0516
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309480339269  LUMO = 1.23724947369313
  mo_energy =
[-0.90230948  1.23724947  5.55744691 13.08557885 26.13569105 44.4333497 ]
E1 = -3.8611186399536686  E_coul = 1.0282498613365447
cycle= 36 E= -2.83286877861712  delta_E= -1.93e-08  |g|= 1.01e-06  |ddm|= 0.0111
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309466553274  LUMO = 1.23724966030763
  mo_energy =
[-0.90230947  1.23724966  5.55744774 13.08558221 26.13569655 44.43336364]
E1 = -3.8611186225235756  E_coul = 1.0282498771254676
cycle= 37 E= -2.83286874539811  delta_E= 3.32e-08  |g|= 2.87e-06  |ddm|= 0.0659
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309461507201  LUMO = 1.23724973446928
  mo_energy =
[-0.90230946  1.23724973  5.55744806 13.08558367 26.13569907 44.43337028]
E1 = -3.8611186149517827  E_coul = 1.0282499336803888
cycle= 38 E= -2.83286868127139  delta_E= 6.41e-08  |g|= 8.48e-06  |ddm|= 0.0294
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309452965788  LUMO = 1.23724989777983
  mo_energy =
[-0.90230945  1.2372499   5.55744882 13.08558645 26.1357034  44.43337984]
E1 = -3.861118600114842  E_coul = 1.02824983691181
cycle= 39 E= -2.83286876320303  delta_E= -8.19e-08  |g|= 1.96e-07  |ddm|= 0.0527
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309451689233  LUMO = 1.23724992373803
  mo_energy =
[-0.90230945  1.23724992  5.55744893 13.08558694 26.13570429 44.4333824 ]
E1 = -3.861118597306304  E_coul = 1.0282498627944534
cycle= 40 E= -2.83286873451185  delta_E= 2.87e-08  |g|= 2.7e-06  |ddm|= 0.0107
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309443281082  LUMO = 1.23725008040557
  mo_energy =
[-0.90230944  1.23725008  5.55744963 13.0855897  26.13570865 44.43339289]
E1 = -3.861118582102045  E_coul = 1.0282497895064928
cycle= 41 E= -2.83286879259555  delta_E= -5.81e-08  |g|= 3.36e-06  |ddm|= 0.0547
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309447120135  LUMO = 1.23725005437988
  mo_energy =
[-0.90230945  1.23725005  5.55744955 13.08558933 26.1357081  44.43339064]
E1 = -3.861118584672915  E_coul = 1.0282497766361138
cycle= 42 E= -2.8328688080368  delta_E= -1.54e-08  |g|= 4.78e-06  |ddm|= 0.00967
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309452596322  LUMO = 1.23724996890637
  mo_energy =
[-0.90230945  1.23724997  5.5574491  13.08558802 26.13570634 44.43338979]
E1 = -3.8611185902255003  E_coul = 1.0282497780066677
cycle= 43 E= -2.83286881221883  delta_E= -4.18e-09  |g|= 5.19e-06  |ddm|= 0.0182
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309462492385  LUMO = 1.23724984334954
  mo_energy =
[-0.90230946  1.23724984  5.55744854 13.08558589 26.13570301 44.43338165]
E1 = -3.861118601397057  E_coul = 1.0282498100809838
cycle= 44 E= -2.83286879131607  delta_E= 2.09e-08  |g|= 2.9e-06  |ddm|= 0.0412
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309466486072  LUMO = 1.23724984768487
  mo_energy =
[-0.90230947  1.23724985  5.55744864 13.0855857  26.13570224 44.43337663]
E1 = -3.8611186024979696  E_coul = 1.0282498302182548
cycle= 45 E= -2.83286877227971  delta_E= 1.9e-08  |g|= 6.26e-07  |ddm|= 0.00913
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309471101882  LUMO = 1.23724978163985
  mo_energy =
[-0.90230947  1.23724978  5.55744834 13.08558458 26.13570052 44.4333726 ]
E1 = -3.8611186083609446  E_coul = 1.0282497845995793
cycle= 46 E= -2.83286882376137  delta_E= -5.15e-08  |g|= 5.03e-06  |ddm|= 0.0213
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.902309489320161  LUMO = 1.23724942227873
  mo_energy =
[-0.90230949  1.23724942  5.55744665 13.08557837 26.13569082 44.43335189]
E1 = -3.861118641231294  E_coul = 1.0282498179952042
cycle= 47 E= -2.83286882323609  delta_E= 5.25e-10  |g|= 3.56e-06  |ddm|= 0.117
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
E1 = -3.861118641231294  E_coul = 1.0282498179952042
  HOMO = -0.902309502618611  LUMO = 1.2372488514747
  mo_energy =
[-0.9023095   1.23724885  5.55744424 13.08556751 26.1356726  44.43330005]
E1 = -3.8611187082031484  E_coul = 1.0282499464325179
Extra cycle  E= -2.83286876177063  delta_E= 6.15e-08  |g|= 5.89e-06  |ddm|= 0.239
    CPU time for scf_cycle      0.50 sec, wall time      0.50 sec
exp = [4.84212524 4.20451534 3.61180668 3.00462641 2.55828148 0.34542108]
grad_E = [-0.00200463 -0.00194242 -0.00191789 -0.0019379  -0.00202548  0.06090501]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:32 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  5.60450348241        1
[INPUT] 0    0    [1    /1   ]  4.9104010641         1
[INPUT] 0    0    [1    /1   ]  4.27978688097        1
[INPUT] 0    0    [1    /1   ]  3.6292037904         1
[INPUT] 0    0    [1    /1   ]  3.20473114505        1
[INPUT] 0    0    [1    /1   ]  0.340940669953       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [5.604503482408072, 1.0]], [0, [4.910401064098345, 1.0]], [0, [4.279786880967304, 1.0]], [0, [3.629203790403218, 1.0]], [0, [3.2047311450466336, 1.0]], [0, [0.34094066995332595, 1.0]]]}
ecp = {}
CPU time:        29.64
Set gradient conv threshold to 3.16228e-05
cond(S) = 476917901.507989

WARN: Singularity detected in overlap matrix (condition number = 4.77e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8570365747926436  E_coul = 1.0236792842108076
init E= -2.83335729058184
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906526518866753  LUMO = 1.36160381875974
  mo_energy =
[-0.90652652  1.36160382  6.50560311 15.55532322 31.08938018 52.95147594]
E1 = -3.859021262033368  E_coul = 1.0222659168252333
cycle= 1 E= -2.83675534520814  delta_E= -0.0034  |g|= 0.00553  |ddm|= 1.09e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.907245344684604  LUMO = 1.36260496762142
  mo_energy =
[-0.90724534  1.36260497  6.50536616 15.55389016 31.08700424 52.94626673]
E1 = -3.8586526177730724  E_coul = 1.021896094225368
cycle= 2 E= -2.8367565235477  delta_E= -1.18e-06  |g|= 0.000252  |ddm|=  243
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.907440428474215  LUMO = 1.36251018260991
  mo_energy =
[-0.90744043  1.36251018  6.50511061 15.55353908 31.0865591  52.94550234]
E1 = -3.85863706957631  E_coul = 1.0218804920142988
cycle= 3 E= -2.83675657756201  delta_E= -5.4e-08  |g|= 7.09e-06  |ddm|= 2.46
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.907438280800669  LUMO = 1.36251015943425
  mo_energy =
[-0.90743828  1.36251016  6.50510457 15.55353078 31.08656744 52.94561742]
E1 = -3.858637650668935  E_coul = 1.0218814649395709
cycle= 4 E= -2.83675618572936  delta_E= 3.92e-07  |g|= 3.4e-05  |ddm|= 1.37
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.907437149558464  LUMO = 1.36251832436165
  mo_energy =
[-0.90743715  1.36251832  6.50514346 15.5536707  31.08678735 52.94616349]
E1 = -3.858636919316274  E_coul = 1.0218800115984474
cycle= 5 E= -2.83675690771783  delta_E= -7.22e-07  |g|= 7.32e-05  |ddm|= 6.85
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438018778624  LUMO = 1.36250951144073
  mo_energy =
[-0.90743802  1.36250951  6.50510055 15.55351327 31.08653568 52.9455466 ]
E1 = -3.858637819305707  E_coul = 1.021881752266161
cycle= 6 E= -2.83675606703955  delta_E= 8.41e-07  |g|= 4.83e-05  |ddm|=  7.7
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9074377224048  LUMO = 1.36251245122922
  mo_energy =
[-0.90743772  1.36251245  6.50511506 15.55356767 31.08662424 52.94575332]
E1 = -3.8586375233488797  E_coul = 1.0218809200558514
cycle= 7 E= -2.83675660329303  delta_E= -5.36e-07  |g|= 9.45e-06  |ddm|= 2.58
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437753995315  LUMO = 1.3625113981418
  mo_energy =
[-0.90743775  1.3625114   6.5051089  15.55355472 31.0866126  52.94577211]
E1 = -3.858637618074032  E_coul = 1.0218810519893382
cycle= 8 E= -2.83675656608469  delta_E= 3.72e-08  |g|= 7.1e-06  |ddm|= 0.546
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437754374644  LUMO = 1.36251111437047
  mo_energy =
[-0.90743775  1.36251111  6.50510739 15.55354937 31.08660429 52.94575352]
E1 = -3.858637653599596  E_coul = 1.021881486224804
cycle= 9 E= -2.83675616737479  delta_E= 3.99e-07  |g|= 2.58e-05  |ddm|= 0.27
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437686404398  LUMO = 1.36251207162884
  mo_energy =
[-0.90743769  1.36251207  6.50511243 15.5535649  31.08662649 52.94579414]
E1 = -3.858637559700487  E_coul = 1.0218805929968684
cycle= 10 E= -2.83675696670362  delta_E= -7.99e-07  |g|= 4.6e-05  |ddm|= 0.725
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437770277263  LUMO = 1.36251084860827
  mo_energy =
[-0.90743777  1.36251085  6.5051064  15.55354128 31.08658732 52.94569916]
E1 = -3.858637697830076  E_coul = 1.0218810379667547
cycle= 11 E= -2.83675665986332  delta_E= 3.07e-07  |g|= 1.23e-05  |ddm|= 1.17
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90743786147695  LUMO = 1.36250974440292
  mo_energy =
[-0.90743786  1.36250974  6.50510095 15.55352029 31.08655248 52.94561316]
E1 = -3.858637816989025  E_coul = 1.021881393257027
cycle= 12 E= -2.836756423732  delta_E= 2.36e-07  |g|= 1.3e-05  |ddm|= 1.03
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437830131768  LUMO = 1.36251001517483
  mo_energy =
[-0.90743783  1.36251002  6.50510243 15.55352419 31.08655742 52.94561575]
E1 = -3.85863779653865  E_coul = 1.0218810489417514
cycle= 13 E= -2.8367567475969  delta_E= -3.24e-07  |g|= 1.27e-05  |ddm|= 0.154
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438019784769  LUMO = 1.36250646336066
  mo_energy =
[-0.90743802  1.36250646  6.50508384 15.55346145 31.08646202 52.94543342]
E1 = -3.8586381777411356  E_coul = 1.0218817917747365
cycle= 14 E= -2.8367563859664  delta_E= 3.62e-07  |g|= 3.33e-05  |ddm|= 2.99
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438031972695  LUMO = 1.36250696858125
  mo_energy =
[-0.90743803  1.36250697  6.50508606 15.55347508 31.08648843 52.9455253 ]
E1 = -3.85863809049108  E_coul = 1.0218817505339761
cycle= 15 E= -2.8367563399571  delta_E= 4.6e-08  |g|= 3.17e-05  |ddm|= 0.781
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437991650411  LUMO = 1.36250752164065
  mo_energy =
[-0.90743799  1.36250752  6.50508955 15.55347788 31.08648327 52.94546622]
E1 = -3.858638062070077  E_coul = 1.0218814001280914
cycle= 16 E= -2.83675666194199  delta_E= -3.22e-07  |g|= 4.35e-06  |ddm|= 0.0303
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437968208412  LUMO = 1.36250783654894
  mo_energy =
[-0.90743797  1.36250784  6.50509139 15.55348149 31.08648621 52.94545996]
E1 = -3.8586380387115327  E_coul = 1.021881822038121
cycle= 17 E= -2.83675621667341  delta_E= 4.45e-07  |g|= 4.27e-05  |ddm|= 0.135
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438065335523  LUMO = 1.36250605256794
  mo_energy =
[-0.90743807  1.36250605  6.50508227 15.55344886 31.08643466 52.94534221]
E1 = -3.858638237181571  E_coul = 1.0218807675824495
cycle= 18 E= -2.83675746959912  delta_E= -1.25e-06  |g|= 5.21e-05  |ddm|= 1.61
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437661349583  LUMO = 1.36251218038401
  mo_energy =
[-0.90743766  1.36251218  6.50511325 15.55355971 31.08660899 52.94572164]
E1 = -3.858637572275015  E_coul = 1.0218814837977923
cycle= 19 E= -2.83675608847722  delta_E= 1.38e-06  |g|= 3.47e-05  |ddm|= 5.42
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437391991094  LUMO = 1.36251606181951
  mo_energy =
[-0.90743739  1.36251606  6.50513261 15.55363572 31.08673682 52.94602855]
E1 = -3.858637138085435  E_coul = 1.0218806906081483
cycle= 20 E= -2.83675644747729  delta_E= -3.59e-07  |g|= 2.16e-05  |ddm|= 3.72
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437627196667  LUMO = 1.3625127621726
  mo_energy =
[-0.90743763  1.36251276  6.50511631 15.55357497 31.08663937 52.94580126]
E1 = -3.85863750213941  E_coul = 1.0218807340252074
cycle= 21 E= -2.8367567681142  delta_E= -3.21e-07  |g|= 3.13e-05  |ddm|= 3.02
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437677262703  LUMO = 1.36251212148249
  mo_energy =
[-0.90743768  1.36251212  6.5051133  15.5535616  31.08661597 52.94573712]
E1 = -3.8586375784952747  E_coul = 1.0218807602949838
cycle= 22 E= -2.83675681820029  delta_E= -5.01e-08  |g|= 2.87e-05  |ddm|= 0.685
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437753165335  LUMO = 1.3625109574061
  mo_energy =
[-0.90743775  1.36251096  6.50510735 15.55354223 31.0865875  52.9456815 ]
E1 = -3.8586376999877467  E_coul = 1.0218811916930624
cycle= 23 E= -2.83675650829468  delta_E= 3.1e-07  |g|= 3.12e-06  |ddm|= 0.946
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437755834139  LUMO = 1.36251079790724
  mo_energy =
[-0.90743776  1.3625108   6.50510634 15.55354009 31.08658548 52.9456875 ]
E1 = -3.858637713127892  E_coul = 1.021880646234527
cycle= 24 E= -2.83675706689337  delta_E= -5.59e-07  |g|= 4.55e-05  |ddm|= 0.0724
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437817469207  LUMO = 1.36250980769676
  mo_energy =
[-0.90743782  1.36250981  6.50510132 15.55352267 31.08655862 52.94562826]
E1 = -3.858637820398552  E_coul = 1.0218806055621787
cycle= 25 E= -2.83675721483637  delta_E= -1.48e-07  |g|= 5.37e-05  |ddm|= 0.859
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437913926038  LUMO = 1.36250830262489
  mo_energy =
[-0.90743791  1.3625083   6.50509369 15.55349562 31.08651635 52.94553567]
E1 = -3.8586379839718257  E_coul = 1.0218809027725395
cycle= 26 E= -2.83675708119929  delta_E= 1.34e-07  |g|= 3.64e-05  |ddm|= 1.33
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437909867927  LUMO = 1.36250840675647
  mo_energy =
[-0.90743791  1.36250841  6.50509435 15.55349677 31.08651718 52.94552971]
E1 = -3.8586379765637493  E_coul = 1.021881845460193
cycle= 27 E= -2.83675613110356  delta_E= 9.5e-07  |g|= 4.37e-05  |ddm|= 0.0345
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437937810774  LUMO = 1.36250806811007
  mo_energy =
[-0.90743794  1.36250807  6.50509283 15.55348934 31.08650371 52.94549073]
E1 = -3.8586380187437697  E_coul = 1.021881889525018
cycle= 28 E= -2.83675612921875  delta_E= 1.88e-09  |g|= 4.9e-05  |ddm|= 0.388
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90743808344522  LUMO = 1.36250560174988
  mo_energy =
[-0.90743808  1.3625056   6.50508003 15.55344663 31.08643933 52.94536338]
E1 = -3.858638280513867  E_coul = 1.0218814784398909
cycle= 29 E= -2.83675680207398  delta_E= -6.73e-07  |g|= 3.4e-06  |ddm|= 2.06
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438060830285  LUMO = 1.36250589837945
  mo_energy =
[-0.90743806  1.3625059   6.50508144 15.55345403 31.08645374 52.9454059 ]
E1 = -3.858638242101565  E_coul = 1.0218822759804986
cycle= 30 E= -2.83675596612107  delta_E= 8.36e-07  |g|= 7.18e-05  |ddm|= 0.375
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438176393586  LUMO = 1.36250392861649
  mo_energy =
[-0.90743818  1.36250393  6.50507134 15.55341543 31.0863901  52.94525826]
E1 = -3.8586384628839574  E_coul = 1.0218813565176705
cycle= 31 E= -2.83675710636629  delta_E= -1.14e-06  |g|= 1.34e-05  |ddm|= 1.86
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438112831023  LUMO = 1.36250529474394
  mo_energy =
[-0.90743811  1.36250529  6.50507895 15.55343669 31.08641797 52.94528599]
E1 = -3.8586383307054093  E_coul = 1.0218812520613678
cycle= 32 E= -2.83675707864404  delta_E= 2.77e-08  |g|= 1.33e-05  |ddm|= 0.939
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437784398056  LUMO = 1.36251035314512
  mo_energy =
[-0.90743778  1.36251035  6.50510521 15.55352042 31.08654075 52.94552223]
E1 = -3.8586378107438066  E_coul = 1.02188062135318
cycle= 33 E= -2.83675718939063  delta_E= -1.11e-07  |g|= 5.1e-05  |ddm|= 4.03
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437835727374  LUMO = 1.36250974276703
  mo_energy =
[-0.90743784  1.36250974  6.50510275 15.55350414 31.08650712 52.94540914]
E1 = -3.8586378967174477  E_coul = 1.0218820462387306
cycle= 34 E= -2.83675585047872  delta_E= 1.34e-06  |g|= 7.2e-05  |ddm|= 0.889
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437345850456  LUMO = 1.36251670897102
  mo_energy =
[-0.90743735  1.36251671  6.50513721 15.55363399 31.08671753 52.94591445]
E1 = -3.8586371242790363  E_coul = 1.021880259836891
cycle= 35 E= -2.83675686444215  delta_E= -1.01e-06  |g|= 5.39e-05  |ddm|= 6.46
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9074377969727  LUMO = 1.36250989741994
  mo_energy =
[-0.9074378   1.3625099   6.50510241 15.55351684 31.08653952 52.94554128]
E1 = -3.8586378429648533  E_coul = 1.0218818779057908
cycle= 36 E= -2.83675596505906  delta_E= 8.99e-07  |g|= 5.61e-05  |ddm|= 5.71
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90743773674766  LUMO = 1.36251076904152
  mo_energy =
[-0.90743774  1.36251077  6.50510679 15.553533   31.08656555 52.94559949]
E1 = -3.8586377482605654  E_coul = 1.0218800698773174
cycle= 37 E= -2.83675767838325  delta_E= -1.71e-06  |g|= 9.5e-05  |ddm|= 0.787
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437911447043  LUMO = 1.36250808181302
  mo_energy =
[-0.90743791  1.36250808  6.50509319 15.55348421 31.08648836 52.94542715]
E1 = -3.8586380406973126  E_coul = 1.0218811348956531
cycle= 38 E= -2.83675690580166  delta_E= 7.73e-07  |g|= 1.41e-05  |ddm|= 2.39
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437955200305  LUMO = 1.36250735751635
  mo_energy =
[-0.90743796  1.36250736  6.50508939 15.55347142 31.0864687  52.94538904]
E1 = -3.8586381163160293  E_coul = 1.0218813292389783
cycle= 39 E= -2.83675678707705  delta_E= 1.19e-07  |g|= 1.91e-06  |ddm|= 0.603
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437951511586  LUMO = 1.36250743582786
  mo_energy =
[-0.90743795  1.36250744  6.50508986 15.55347245 31.0864698  52.94538764]
E1 = -3.8586381099889895  E_coul = 1.0218807806812924
cycle= 40 E= -2.8367573293077  delta_E= -5.42e-07  |g|= 4.84e-05  |ddm|= 0.0383
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437982078408  LUMO = 1.36250698050708
  mo_energy =
[-0.90743798  1.36250698  6.50508757 15.55346426 31.08645682 52.94535731]
E1 = -3.8586381596089065  E_coul = 1.0218809871240184
cycle= 41 E= -2.83675717248489  delta_E= 1.57e-07  |g|= 3.21e-05  |ddm|= 0.406
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437942494544  LUMO = 1.36250756248354
  mo_energy =
[-0.90743794  1.36250756  6.50509039 15.55347572 31.08647608 52.94540517]
E1 = -3.858638092389447  E_coul = 1.021881659267954
cycle= 42 E= -2.83675643312149  delta_E= 7.39e-07  |g|= 2.8e-05  |ddm|= 0.577
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438063546179  LUMO = 1.36250578673243
  mo_energy =
[-0.90743806  1.36250579  6.5050815  15.5534435  31.08642483 52.945288  ]
E1 = -3.8586382861989157  E_coul = 1.021881887631059
cycle= 43 E= -2.83675639856786  delta_E= 3.46e-08  |g|= 3.9e-05  |ddm|= 1.59
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438248221477  LUMO = 1.36250280903183
  mo_energy =
[-0.90743825  1.36250281  6.50506617 15.55339125 31.08634533 52.94512438]
E1 = -3.858638603840568  E_coul = 1.021882015047874
cycle= 44 E= -2.83675658879269  delta_E= -1.9e-07  |g|= 3.87e-05  |ddm|= 2.53
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438733801435  LUMO = 1.3624954341407
  mo_energy =
[-0.90743873  1.36249543  6.50502926 15.55325513 31.08612603 52.94461451]
E1 = -3.8586394173313123  E_coul = 1.021882284669119
cycle= 45 E= -2.83675713266219  delta_E= -5.44e-07  |g|= 3.23e-05  |ddm|= 6.73
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437957993304  LUMO = 1.36250770456174
  mo_energy =
[-0.90743796  1.3625077   6.50509113 15.553481   31.08648684 52.94543353]
E1 = -3.8586380655635466  E_coul = 1.0218816737711025
cycle= 46 E= -2.83675639179244  delta_E= 7.41e-07  |g|= 2.94e-05  |ddm|= 11.1
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437802150712  LUMO = 1.36251003090505
  mo_energy =
[-0.9074378   1.36251003  6.50510306 15.55352193 31.0865506  52.94555971]
E1 = -3.858637822816425  E_coul = 1.0218813105166953
cycle= 47 E= -2.83675651229973  delta_E= -1.21e-07  |g|= 1.07e-05  |ddm|= 1.95
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437746054252  LUMO = 1.36251073970013
  mo_energy =
[-0.90743775  1.36251074  6.50510586 15.55353817 31.08658124 52.9456682 ]
E1 = -3.8586377226051702  E_coul = 1.0218804002836934
cycle= 48 E= -2.83675732232148  delta_E= -8.1e-07  |g|= 6.53e-05  |ddm|= 0.94
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90743786369652  LUMO = 1.3625087413357
  mo_energy =
[-0.90743786  1.36250874  6.50509542 15.55350376 31.08652996 52.94557177]
E1 = -3.8586379326595766  E_coul = 1.0218812766520968
cycle= 49 E= -2.83675665600748  delta_E= 6.66e-07  |g|= 3.5e-06  |ddm|= 1.64
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437788616082  LUMO = 1.36250999924077
  mo_energy =
[-0.90743779  1.36251     6.50510179 15.55352585 31.08656413 52.94565274]
E1 = -3.858637795525466  E_coul = 1.0218811794350187
cycle= 50 E= -2.83675661609045  delta_E= 3.99e-08  |g|= 8.63e-06  |ddm|=  1.1
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.858637795525466  E_coul = 1.0218811794350187

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.907437718311262  LUMO = 1.36251019332582
  mo_energy =
[-0.90743772  1.36251019  6.50510405 15.55351522 31.08652917 52.94548911]
E1 = -3.8586378489857673  E_coul = 1.021880678488529
Extra cycle  E= -2.83675717049724  delta_E= -5.54e-07  |g|= 4.22e-05  |ddm|= 0.773
    CPU time for scf_cycle      0.49 sec, wall time      0.50 sec
exp = [5.60450348 4.91040106 4.27978688 3.62920379 3.20473115 0.34094067]
E = -2.836757170497238
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:33 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  5.60450348241        1
[INPUT] 0    0    [1    /1   ]  4.9104010641         1
[INPUT] 0    0    [1    /1   ]  4.27978688097        1
[INPUT] 0    0    [1    /1   ]  3.6292037904         1
[INPUT] 0    0    [1    /1   ]  3.20473114505        1
[INPUT] 0    0    [1    /1   ]  0.340940669953       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [5.604503482408072, 1.0]], [0, [4.910401064098345, 1.0]], [0, [4.279786880967304, 1.0]], [0, [3.629203790403218, 1.0]], [0, [3.2047311450466336, 1.0]], [0, [0.34094066995332595, 1.0]]]}
ecp = {}
CPU time:        30.32
Set gradient conv threshold to 3.16228e-05
cond(S) = 476917901.507989

WARN: Singularity detected in overlap matrix (condition number = 4.77e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8570365747926436  E_coul = 1.0236792842108076
init E= -2.83335729058184
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906526518866753  LUMO = 1.36160381875974
  mo_energy =
[-0.90652652  1.36160382  6.50560311 15.55532322 31.08938018 52.95147594]
E1 = -3.859021262033368  E_coul = 1.0222659168252333
cycle= 1 E= -2.83675534520814  delta_E= -0.0034  |g|= 0.00553  |ddm|= 1.09e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.907245344684604  LUMO = 1.36260496762142
  mo_energy =
[-0.90724534  1.36260497  6.50536616 15.55389016 31.08700424 52.94626673]
E1 = -3.8586526177730724  E_coul = 1.021896094225368
cycle= 2 E= -2.8367565235477  delta_E= -1.18e-06  |g|= 0.000252  |ddm|=  243
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.907440428474215  LUMO = 1.36251018260991
  mo_energy =
[-0.90744043  1.36251018  6.50511061 15.55353908 31.0865591  52.94550234]
E1 = -3.85863706957631  E_coul = 1.0218804920142988
cycle= 3 E= -2.83675657756201  delta_E= -5.4e-08  |g|= 7.09e-06  |ddm|= 2.46
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.907438280800669  LUMO = 1.36251015943425
  mo_energy =
[-0.90743828  1.36251016  6.50510457 15.55353078 31.08656744 52.94561742]
E1 = -3.858637650668935  E_coul = 1.0218814649395709
cycle= 4 E= -2.83675618572936  delta_E= 3.92e-07  |g|= 3.4e-05  |ddm|= 1.37
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.907437149558464  LUMO = 1.36251832436165
  mo_energy =
[-0.90743715  1.36251832  6.50514346 15.5536707  31.08678735 52.94616349]
E1 = -3.858636919316274  E_coul = 1.0218800115984474
cycle= 5 E= -2.83675690771783  delta_E= -7.22e-07  |g|= 7.32e-05  |ddm|= 6.85
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438018778624  LUMO = 1.36250951144073
  mo_energy =
[-0.90743802  1.36250951  6.50510055 15.55351327 31.08653568 52.9455466 ]
E1 = -3.858637819305707  E_coul = 1.021881752266161
cycle= 6 E= -2.83675606703955  delta_E= 8.41e-07  |g|= 4.83e-05  |ddm|=  7.7
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9074377224048  LUMO = 1.36251245122922
  mo_energy =
[-0.90743772  1.36251245  6.50511506 15.55356767 31.08662424 52.94575332]
E1 = -3.8586375233488797  E_coul = 1.0218809200558514
cycle= 7 E= -2.83675660329303  delta_E= -5.36e-07  |g|= 9.45e-06  |ddm|= 2.58
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437753995315  LUMO = 1.3625113981418
  mo_energy =
[-0.90743775  1.3625114   6.5051089  15.55355472 31.0866126  52.94577211]
E1 = -3.858637618074032  E_coul = 1.0218810519893382
cycle= 8 E= -2.83675656608469  delta_E= 3.72e-08  |g|= 7.1e-06  |ddm|= 0.546
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437754374644  LUMO = 1.36251111437047
  mo_energy =
[-0.90743775  1.36251111  6.50510739 15.55354937 31.08660429 52.94575352]
E1 = -3.858637653599596  E_coul = 1.021881486224804
cycle= 9 E= -2.83675616737479  delta_E= 3.99e-07  |g|= 2.58e-05  |ddm|= 0.27
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437686404398  LUMO = 1.36251207162884
  mo_energy =
[-0.90743769  1.36251207  6.50511243 15.5535649  31.08662649 52.94579414]
E1 = -3.858637559700487  E_coul = 1.0218805929968684
cycle= 10 E= -2.83675696670362  delta_E= -7.99e-07  |g|= 4.6e-05  |ddm|= 0.725
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437770277263  LUMO = 1.36251084860827
  mo_energy =
[-0.90743777  1.36251085  6.5051064  15.55354128 31.08658732 52.94569916]
E1 = -3.858637697830076  E_coul = 1.0218810379667547
cycle= 11 E= -2.83675665986332  delta_E= 3.07e-07  |g|= 1.23e-05  |ddm|= 1.17
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90743786147695  LUMO = 1.36250974440292
  mo_energy =
[-0.90743786  1.36250974  6.50510095 15.55352029 31.08655248 52.94561316]
E1 = -3.858637816989025  E_coul = 1.021881393257027
cycle= 12 E= -2.836756423732  delta_E= 2.36e-07  |g|= 1.3e-05  |ddm|= 1.03
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437830131768  LUMO = 1.36251001517483
  mo_energy =
[-0.90743783  1.36251002  6.50510243 15.55352419 31.08655742 52.94561575]
E1 = -3.85863779653865  E_coul = 1.0218810489417514
cycle= 13 E= -2.8367567475969  delta_E= -3.24e-07  |g|= 1.27e-05  |ddm|= 0.154
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438019784769  LUMO = 1.36250646336066
  mo_energy =
[-0.90743802  1.36250646  6.50508384 15.55346145 31.08646202 52.94543342]
E1 = -3.8586381777411356  E_coul = 1.0218817917747365
cycle= 14 E= -2.8367563859664  delta_E= 3.62e-07  |g|= 3.33e-05  |ddm|= 2.99
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438031972695  LUMO = 1.36250696858125
  mo_energy =
[-0.90743803  1.36250697  6.50508606 15.55347508 31.08648843 52.9455253 ]
E1 = -3.85863809049108  E_coul = 1.0218817505339761
cycle= 15 E= -2.8367563399571  delta_E= 4.6e-08  |g|= 3.17e-05  |ddm|= 0.781
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437991650411  LUMO = 1.36250752164065
  mo_energy =
[-0.90743799  1.36250752  6.50508955 15.55347788 31.08648327 52.94546622]
E1 = -3.858638062070077  E_coul = 1.0218814001280914
cycle= 16 E= -2.83675666194199  delta_E= -3.22e-07  |g|= 4.35e-06  |ddm|= 0.0303
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437968208412  LUMO = 1.36250783654894
  mo_energy =
[-0.90743797  1.36250784  6.50509139 15.55348149 31.08648621 52.94545996]
E1 = -3.8586380387115327  E_coul = 1.021881822038121
cycle= 17 E= -2.83675621667341  delta_E= 4.45e-07  |g|= 4.27e-05  |ddm|= 0.135
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438065335523  LUMO = 1.36250605256794
  mo_energy =
[-0.90743807  1.36250605  6.50508227 15.55344886 31.08643466 52.94534221]
E1 = -3.858638237181571  E_coul = 1.0218807675824495
cycle= 18 E= -2.83675746959912  delta_E= -1.25e-06  |g|= 5.21e-05  |ddm|= 1.61
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437661349583  LUMO = 1.36251218038401
  mo_energy =
[-0.90743766  1.36251218  6.50511325 15.55355971 31.08660899 52.94572164]
E1 = -3.858637572275015  E_coul = 1.0218814837977923
cycle= 19 E= -2.83675608847722  delta_E= 1.38e-06  |g|= 3.47e-05  |ddm|= 5.42
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437391991094  LUMO = 1.36251606181951
  mo_energy =
[-0.90743739  1.36251606  6.50513261 15.55363572 31.08673682 52.94602855]
E1 = -3.858637138085435  E_coul = 1.0218806906081483
cycle= 20 E= -2.83675644747729  delta_E= -3.59e-07  |g|= 2.16e-05  |ddm|= 3.72
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437627196667  LUMO = 1.3625127621726
  mo_energy =
[-0.90743763  1.36251276  6.50511631 15.55357497 31.08663937 52.94580126]
E1 = -3.85863750213941  E_coul = 1.0218807340252074
cycle= 21 E= -2.8367567681142  delta_E= -3.21e-07  |g|= 3.13e-05  |ddm|= 3.02
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437677262703  LUMO = 1.36251212148249
  mo_energy =
[-0.90743768  1.36251212  6.5051133  15.5535616  31.08661597 52.94573712]
E1 = -3.8586375784952747  E_coul = 1.0218807602949838
cycle= 22 E= -2.83675681820029  delta_E= -5.01e-08  |g|= 2.87e-05  |ddm|= 0.685
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437753165335  LUMO = 1.3625109574061
  mo_energy =
[-0.90743775  1.36251096  6.50510735 15.55354223 31.0865875  52.9456815 ]
E1 = -3.8586376999877467  E_coul = 1.0218811916930624
cycle= 23 E= -2.83675650829468  delta_E= 3.1e-07  |g|= 3.12e-06  |ddm|= 0.946
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437755834139  LUMO = 1.36251079790724
  mo_energy =
[-0.90743776  1.3625108   6.50510634 15.55354009 31.08658548 52.9456875 ]
E1 = -3.858637713127892  E_coul = 1.021880646234527
cycle= 24 E= -2.83675706689337  delta_E= -5.59e-07  |g|= 4.55e-05  |ddm|= 0.0724
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437817469207  LUMO = 1.36250980769676
  mo_energy =
[-0.90743782  1.36250981  6.50510132 15.55352267 31.08655862 52.94562826]
E1 = -3.858637820398552  E_coul = 1.0218806055621787
cycle= 25 E= -2.83675721483637  delta_E= -1.48e-07  |g|= 5.37e-05  |ddm|= 0.859
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437913926038  LUMO = 1.36250830262489
  mo_energy =
[-0.90743791  1.3625083   6.50509369 15.55349562 31.08651635 52.94553567]
E1 = -3.8586379839718257  E_coul = 1.0218809027725395
cycle= 26 E= -2.83675708119929  delta_E= 1.34e-07  |g|= 3.64e-05  |ddm|= 1.33
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437909867927  LUMO = 1.36250840675647
  mo_energy =
[-0.90743791  1.36250841  6.50509435 15.55349677 31.08651718 52.94552971]
E1 = -3.8586379765637493  E_coul = 1.021881845460193
cycle= 27 E= -2.83675613110356  delta_E= 9.5e-07  |g|= 4.37e-05  |ddm|= 0.0345
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437937810774  LUMO = 1.36250806811007
  mo_energy =
[-0.90743794  1.36250807  6.50509283 15.55348934 31.08650371 52.94549073]
E1 = -3.8586380187437697  E_coul = 1.021881889525018
cycle= 28 E= -2.83675612921875  delta_E= 1.88e-09  |g|= 4.9e-05  |ddm|= 0.388
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90743808344522  LUMO = 1.36250560174988
  mo_energy =
[-0.90743808  1.3625056   6.50508003 15.55344663 31.08643933 52.94536338]
E1 = -3.858638280513867  E_coul = 1.0218814784398909
cycle= 29 E= -2.83675680207398  delta_E= -6.73e-07  |g|= 3.4e-06  |ddm|= 2.06
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438060830285  LUMO = 1.36250589837945
  mo_energy =
[-0.90743806  1.3625059   6.50508144 15.55345403 31.08645374 52.9454059 ]
E1 = -3.858638242101565  E_coul = 1.0218822759804986
cycle= 30 E= -2.83675596612107  delta_E= 8.36e-07  |g|= 7.18e-05  |ddm|= 0.375
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438176393586  LUMO = 1.36250392861649
  mo_energy =
[-0.90743818  1.36250393  6.50507134 15.55341543 31.0863901  52.94525826]
E1 = -3.8586384628839574  E_coul = 1.0218813565176705
cycle= 31 E= -2.83675710636629  delta_E= -1.14e-06  |g|= 1.34e-05  |ddm|= 1.86
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438112831023  LUMO = 1.36250529474394
  mo_energy =
[-0.90743811  1.36250529  6.50507895 15.55343669 31.08641797 52.94528599]
E1 = -3.8586383307054093  E_coul = 1.0218812520613678
cycle= 32 E= -2.83675707864404  delta_E= 2.77e-08  |g|= 1.33e-05  |ddm|= 0.939
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437784398056  LUMO = 1.36251035314512
  mo_energy =
[-0.90743778  1.36251035  6.50510521 15.55352042 31.08654075 52.94552223]
E1 = -3.8586378107438066  E_coul = 1.02188062135318
cycle= 33 E= -2.83675718939063  delta_E= -1.11e-07  |g|= 5.1e-05  |ddm|= 4.03
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437835727374  LUMO = 1.36250974276703
  mo_energy =
[-0.90743784  1.36250974  6.50510275 15.55350414 31.08650712 52.94540914]
E1 = -3.8586378967174477  E_coul = 1.0218820462387306
cycle= 34 E= -2.83675585047872  delta_E= 1.34e-06  |g|= 7.2e-05  |ddm|= 0.889
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437345850456  LUMO = 1.36251670897102
  mo_energy =
[-0.90743735  1.36251671  6.50513721 15.55363399 31.08671753 52.94591445]
E1 = -3.8586371242790363  E_coul = 1.021880259836891
cycle= 35 E= -2.83675686444215  delta_E= -1.01e-06  |g|= 5.39e-05  |ddm|= 6.46
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9074377969727  LUMO = 1.36250989741994
  mo_energy =
[-0.9074378   1.3625099   6.50510241 15.55351684 31.08653952 52.94554128]
E1 = -3.8586378429648533  E_coul = 1.0218818779057908
cycle= 36 E= -2.83675596505906  delta_E= 8.99e-07  |g|= 5.61e-05  |ddm|= 5.71
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90743773674766  LUMO = 1.36251076904152
  mo_energy =
[-0.90743774  1.36251077  6.50510679 15.553533   31.08656555 52.94559949]
E1 = -3.8586377482605654  E_coul = 1.0218800698773174
cycle= 37 E= -2.83675767838325  delta_E= -1.71e-06  |g|= 9.5e-05  |ddm|= 0.787
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437911447043  LUMO = 1.36250808181302
  mo_energy =
[-0.90743791  1.36250808  6.50509319 15.55348421 31.08648836 52.94542715]
E1 = -3.8586380406973126  E_coul = 1.0218811348956531
cycle= 38 E= -2.83675690580166  delta_E= 7.73e-07  |g|= 1.41e-05  |ddm|= 2.39
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437955200305  LUMO = 1.36250735751635
  mo_energy =
[-0.90743796  1.36250736  6.50508939 15.55347142 31.0864687  52.94538904]
E1 = -3.8586381163160293  E_coul = 1.0218813292389783
cycle= 39 E= -2.83675678707705  delta_E= 1.19e-07  |g|= 1.91e-06  |ddm|= 0.603
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437951511586  LUMO = 1.36250743582786
  mo_energy =
[-0.90743795  1.36250744  6.50508986 15.55347245 31.0864698  52.94538764]
E1 = -3.8586381099889895  E_coul = 1.0218807806812924
cycle= 40 E= -2.8367573293077  delta_E= -5.42e-07  |g|= 4.84e-05  |ddm|= 0.0383
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437982078408  LUMO = 1.36250698050708
  mo_energy =
[-0.90743798  1.36250698  6.50508757 15.55346426 31.08645682 52.94535731]
E1 = -3.8586381596089065  E_coul = 1.0218809871240184
cycle= 41 E= -2.83675717248489  delta_E= 1.57e-07  |g|= 3.21e-05  |ddm|= 0.406
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437942494544  LUMO = 1.36250756248354
  mo_energy =
[-0.90743794  1.36250756  6.50509039 15.55347572 31.08647608 52.94540517]
E1 = -3.858638092389447  E_coul = 1.021881659267954
cycle= 42 E= -2.83675643312149  delta_E= 7.39e-07  |g|= 2.8e-05  |ddm|= 0.577
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438063546179  LUMO = 1.36250578673243
  mo_energy =
[-0.90743806  1.36250579  6.5050815  15.5534435  31.08642483 52.945288  ]
E1 = -3.8586382861989157  E_coul = 1.021881887631059
cycle= 43 E= -2.83675639856786  delta_E= 3.46e-08  |g|= 3.9e-05  |ddm|= 1.59
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438248221477  LUMO = 1.36250280903183
  mo_energy =
[-0.90743825  1.36250281  6.50506617 15.55339125 31.08634533 52.94512438]
E1 = -3.858638603840568  E_coul = 1.021882015047874
cycle= 44 E= -2.83675658879269  delta_E= -1.9e-07  |g|= 3.87e-05  |ddm|= 2.53
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907438733801435  LUMO = 1.3624954341407
  mo_energy =
[-0.90743873  1.36249543  6.50502926 15.55325513 31.08612603 52.94461451]
E1 = -3.8586394173313123  E_coul = 1.021882284669119
cycle= 45 E= -2.83675713266219  delta_E= -5.44e-07  |g|= 3.23e-05  |ddm|= 6.73
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437957993304  LUMO = 1.36250770456174
  mo_energy =
[-0.90743796  1.3625077   6.50509113 15.553481   31.08648684 52.94543353]
E1 = -3.8586380655635466  E_coul = 1.0218816737711025
cycle= 46 E= -2.83675639179244  delta_E= 7.41e-07  |g|= 2.94e-05  |ddm|= 11.1
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437802150712  LUMO = 1.36251003090505
  mo_energy =
[-0.9074378   1.36251003  6.50510306 15.55352193 31.0865506  52.94555971]
E1 = -3.858637822816425  E_coul = 1.0218813105166953
cycle= 47 E= -2.83675651229973  delta_E= -1.21e-07  |g|= 1.07e-05  |ddm|= 1.95
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437746054252  LUMO = 1.36251073970013
  mo_energy =
[-0.90743775  1.36251074  6.50510586 15.55353817 31.08658124 52.9456682 ]
E1 = -3.8586377226051702  E_coul = 1.0218804002836934
cycle= 48 E= -2.83675732232148  delta_E= -8.1e-07  |g|= 6.53e-05  |ddm|= 0.94
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90743786369652  LUMO = 1.3625087413357
  mo_energy =
[-0.90743786  1.36250874  6.50509542 15.55350376 31.08652996 52.94557177]
E1 = -3.8586379326595766  E_coul = 1.0218812766520968
cycle= 49 E= -2.83675665600748  delta_E= 6.66e-07  |g|= 3.5e-06  |ddm|= 1.64
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437788616082  LUMO = 1.36250999924077
  mo_energy =
[-0.90743779  1.36251     6.50510179 15.55352585 31.08656413 52.94565274]
E1 = -3.858637795525466  E_coul = 1.0218811794350187
cycle= 50 E= -2.83675661609045  delta_E= 3.99e-08  |g|= 8.63e-06  |ddm|=  1.1
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.858637795525466  E_coul = 1.0218811794350187

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.907437718311262  LUMO = 1.36251019332582
  mo_energy =
[-0.90743772  1.36251019  6.50510405 15.55351522 31.08652917 52.94548911]
E1 = -3.8586378489857673  E_coul = 1.021880678488529
Extra cycle  E= -2.83675717049724  delta_E= -5.54e-07  |g|= 4.22e-05  |ddm|= 0.773
    CPU time for scf_cycle      0.49 sec, wall time      0.50 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 476917901.507989

WARN: Singularity detected in overlap matrix (condition number = 4.77e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8586378489857673  E_coul = 1.021880678488529
init E= -2.83675717049724
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.907438246022431  LUMO = 1.36250067965796
  mo_energy =
[-0.90743825  1.36250068  6.50505338 15.55335748 31.08630127 52.94511312]
E1 = -3.8586388214751723  E_coul = 1.0218819517245707
cycle= 1 E= -2.8367568697506  delta_E= 3.01e-07  |g|= 2.2e-05  |ddm|=  7.4
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.907437459015122  LUMO = 1.36250629970364
  mo_energy =
[-0.90743746  1.3625063   6.50508234 15.5534478  31.08643273 52.94529962]
E1 = -3.8586383890338722  E_coul = 1.0218818879200264
cycle= 2 E= -2.83675650111385  delta_E= 3.69e-07  |g|= 3.13e-05  |ddm|= 3.72
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.907437349799212  LUMO = 1.36251049615373
  mo_energy =
[-0.90743735  1.3625105   6.50510481 15.55352396 31.08655144 52.94555301]
E1 = -3.858637907443795  E_coul = 1.0218815047857548
cycle= 3 E= -2.83675640265804  delta_E= 9.85e-08  |g|= 2.05e-05  |ddm|= 3.74
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437404864168  LUMO = 1.36251034373617
  mo_energy =
[-0.9074374   1.36251034  6.5051033  15.55352565 31.08655956 52.94560949]
E1 = -3.8586378817582316  E_coul = 1.0218811296436432
cycle= 4 E= -2.83675675211459  delta_E= -3.49e-07  |g|= 1.38e-05  |ddm|= 0.284
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9074375011076  LUMO = 1.36250940734265
  mo_energy =
[-0.9074375   1.36250941  6.50509885 15.55350773 31.08652943 52.94552852]
E1 = -3.858637981923065  E_coul = 1.021881065523939
cycle= 5 E= -2.83675691639913  delta_E= -1.64e-07  |g|= 2.34e-05  |ddm|= 0.894
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437576898436  LUMO = 1.36250855810587
  mo_energy =
[-0.90743758  1.36250856  6.50509485 15.55349113 31.08650106 52.94545227]
E1 = -3.8586380773159195  E_coul = 1.021881530873765
cycle= 6 E= -2.83675654644215  delta_E= 3.7e-07  |g|= 1.83e-05  |ddm|= 0.844
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437563005985  LUMO = 1.36250877267523
  mo_energy =
[-0.90743756  1.36250877  6.50509564 15.55349636 31.0865113  52.94549347]
E1 = -3.8586380434975096  E_coul = 1.0218816587915414
cycle= 7 E= -2.83675638470597  delta_E= 1.62e-07  |g|= 2.87e-05  |ddm|= 0.32
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437532758852  LUMO = 1.36250931729275
  mo_energy =
[-0.90743753  1.36250932  6.50509827 15.55350699 31.08652887 52.94553869]
E1 = -3.858637978114343  E_coul = 1.0218813062576049
cycle= 8 E= -2.83675667185674  delta_E= -2.87e-07  |g|= 9.16e-07  |ddm|= 0.549
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437547845913  LUMO = 1.36250917291578
  mo_energy =
[-0.90743755  1.36250917  6.5050975  15.55350459 31.08652516 52.94553192]
E1 = -3.858637990315601  E_coul = 1.0218807475854628
cycle= 9 E= -2.83675724273014  delta_E= -5.71e-07  |g|= 5.09e-05  |ddm|= 0.101
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437764703033  LUMO = 1.36250671102559
  mo_energy =
[-0.90743776  1.36250671  6.50508485 15.5534611  31.08645657 52.94539746]
E1 = -3.8586382315168213  E_coul = 1.0218821732585766
cycle= 10 E= -2.83675605825824  delta_E= 1.18e-06  |g|= 6.27e-05  |ddm|= 2.01
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437385098908  LUMO = 1.36251243299565
  mo_energy =
[-0.90743739  1.36251243  6.50511429 15.55356254 31.08661462 52.94572734]
E1 = -3.858637628774596  E_coul = 1.0218811125778302
cycle= 11 E= -2.83675651619677  delta_E= -4.58e-07  |g|= 3.95e-06  |ddm|= 4.87
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437301124761  LUMO = 1.3625133489471
  mo_energy =
[-0.9074373   1.36251335  6.50511871 15.55358024 31.0866444  52.94580255]
E1 = -3.8586375292646466  E_coul = 1.021880470361905
cycle= 12 E= -2.83675705890274  delta_E= -5.43e-07  |g|= 5.52e-05  |ddm|= 0.876
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437278693062  LUMO = 1.36251351479342
  mo_energy =
[-0.90743728  1.36251351  6.50511944 15.55358285 31.08664811 52.9458113 ]
E1 = -3.8586375130936275  E_coul = 1.0218808108401969
cycle= 13 E= -2.83675670225343  delta_E= 3.57e-07  |g|= 2.87e-05  |ddm|= 0.136
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437298680869  LUMO = 1.36251314430652
  mo_energy =
[-0.9074373   1.36251314  6.50511723 15.55357785 31.08664287 52.94581807]
E1 = -3.858637542940674  E_coul = 1.0218812625243874
cycle= 14 E= -2.83675628041629  delta_E= 4.22e-07  |g|= 1.01e-05  |ddm|= 0.184
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437321099749  LUMO = 1.36251297859629
  mo_energy =
[-0.90743732  1.36251298  6.50511669 15.55357354 31.08663395 52.94578014]
E1 = -3.858637567481495  E_coul = 1.0218811382771134
cycle= 15 E= -2.83675642920438  delta_E= -1.49e-07  |g|= 2.49e-06  |ddm|= 0.259
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437383551189  LUMO = 1.36251231659565
  mo_energy =
[-0.90743738  1.36251232  6.50511369 15.55356    31.08661044 52.9457139 ]
E1 = -3.858637644415118  E_coul = 1.021880939553003
cycle= 16 E= -2.83675670486211  delta_E= -2.76e-07  |g|= 2.06e-05  |ddm|= 0.698
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437356737312  LUMO = 1.36251290575921
  mo_energy =
[-0.90743736  1.36251291  6.50511684 15.55356972 31.08662483 52.94573972]
E1 = -3.8586375832660895  E_coul = 1.0218807652932327
cycle= 17 E= -2.83675681797286  delta_E= -1.13e-07  |g|= 3.14e-05  |ddm|= 0.459
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437109783123  LUMO = 1.36251697868934
  mo_energy =
[-0.90743711  1.36251698  6.50513746 15.55364407 31.086743   52.94600892]
E1 = -3.8586371342321395  E_coul = 1.0218804326067246
cycle= 18 E= -2.83675670162541  delta_E= 1.16e-07  |g|= 4.46e-05  |ddm|= 3.66
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437413867789  LUMO = 1.36251129629467
  mo_energy =
[-0.90743741  1.3625113   6.50510723 15.55354619 31.08659814 52.94576424]
E1 = -3.858637728339192  E_coul = 1.0218811723354255
cycle= 19 E= -2.83675655600377  delta_E= 1.46e-07  |g|= 7.66e-06  |ddm|= 4.59
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437417187548  LUMO = 1.36251156066202
  mo_energy =
[-0.90743742  1.36251156  6.50510972 15.55354737 31.08659226 52.94567521]
E1 = -3.8586377319165814  E_coul = 1.0218806746902427
cycle= 20 E= -2.83675705722634  delta_E= -5.01e-07  |g|= 4.38e-05  |ddm|= 0.189
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437544754182  LUMO = 1.36250945524941
  mo_energy =
[-0.90743754  1.36250946  6.50509881 15.55351165 31.08653956 52.94557473]
E1 = -3.8586379523789547  E_coul = 1.0218812752411088
cycle= 21 E= -2.83675667713785  delta_E= 3.8e-07  |g|= 2.66e-06  |ddm|= 1.72
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90743756207652  LUMO = 1.36250899967121
  mo_energy =
[-0.90743756  1.362509    6.50509628 15.55350425 31.08652911 52.94556322]
E1 = -3.8586379978163934  E_coul = 1.0218815172435596
cycle= 22 E= -2.83675648057283  delta_E= 1.97e-07  |g|= 1.51e-05  |ddm|= 0.332
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90743744434452  LUMO = 1.36251050684948
  mo_energy =
[-0.90743744  1.36251051  6.50510407 15.55353016 31.08656947 52.94564978]
E1 = -3.8586378462594504  E_coul = 1.021881720844947
cycle= 23 E= -2.8367561254145  delta_E= 3.55e-07  |g|= 3.82e-05  |ddm|= 1.23
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437299381342  LUMO = 1.36251268512914
  mo_energy =
[-0.9074373   1.36251269  6.50511511 15.55356864 31.08662882 52.94578081]
E1 = -3.858637612288776  E_coul = 1.0218813364051254
cycle= 24 E= -2.83675627588365  delta_E= -1.5e-07  |g|= 1.43e-05  |ddm|= 1.89
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437308038143  LUMO = 1.36251252121587
  mo_energy =
[-0.90743731  1.36251252  6.50511428 15.55356592 31.08662485 52.94577218]
E1 = -3.8586376303664993  E_coul = 1.021881154780152
cycle= 25 E= -2.83675647558635  delta_E= -2e-07  |g|= 1.67e-06  |ddm|= 0.138
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437298708191  LUMO = 1.36251268845816
  mo_energy =
[-0.9074373   1.36251269  6.50511518 15.55356842 31.08662801 52.94577588]
E1 = -3.858637613957902  E_coul = 1.0218810964351277
cycle= 26 E= -2.83675651752277  delta_E= -4.19e-08  |g|= 4.63e-06  |ddm|= 0.117
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437444625518  LUMO = 1.36251165920592
  mo_energy =
[-0.90743744  1.36251166  6.50511105 15.55354474 31.08658185 52.94561115]
E1 = -3.8586377367192273  E_coul = 1.0218814004303096
cycle= 27 E= -2.83675633628892  delta_E= 1.81e-07  |g|= 1.62e-05  |ddm|= 1.27
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437394271607  LUMO = 1.36251221857741
  mo_energy =
[-0.90743739  1.36251222  6.50511384 15.55355461 31.08659789 52.94564954]
E1 = -3.8586376794237793  E_coul = 1.0218805680376013
cycle= 28 E= -2.83675711138618  delta_E= -7.75e-07  |g|= 4.87e-05  |ddm|= 0.479
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437415065383  LUMO = 1.36251199405156
  mo_energy =
[-0.90743742  1.36251199  6.5051127  15.55355102 31.08659276 52.94563988]
E1 = -3.858637701042815  E_coul = 1.0218818899158937
cycle= 29 E= -2.83675581112692  delta_E= 1.3e-06  |g|= 6.15e-05  |ddm|= 0.171
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437528107933  LUMO = 1.36251306579276
  mo_energy =
[-0.90743753  1.36251307  6.50511746 15.55357995 31.08664865 52.94583688]
E1 = -3.8586374878435983  E_coul = 1.02188061227967
cycle= 30 E= -2.83675687556393  delta_E= -1.06e-06  |g|= 4.12e-05  |ddm|=  1.8
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437847944728  LUMO = 1.3625095035028
  mo_energy =
[-0.90743785  1.3625095   6.50510095 15.55350684 31.0865185  52.94545454]
E1 = -3.858637901523915  E_coul = 1.021881452823522
cycle= 31 E= -2.83675644870039  delta_E= 4.27e-07  |g|= 1.49e-05  |ddm|= 3.78
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437657639416  LUMO = 1.36251156727547
  mo_energy =
[-0.90743766  1.36251157  6.50511175 15.55354069 31.08656869 52.94554408]
E1 = -3.858637708555265  E_coul = 1.0218808600586324
cycle= 32 E= -2.83675684849663  delta_E= -4e-07  |g|= 2.38e-05  |ddm|= 1.54
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90743774413865  LUMO = 1.36251026330595
  mo_energy =
[-0.90743774  1.36251026  6.50510515 15.55351779 31.08653366 52.9454669 ]
E1 = -3.858637847734127  E_coul = 1.0218813514112373
cycle= 33 E= -2.83675649632289  delta_E= 3.52e-07  |g|= 1.37e-05  |ddm|= 1.12
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437694205983  LUMO = 1.36251062476291
  mo_energy =
[-0.90743769  1.36251062  6.50510628 15.55352798 31.08655583 52.94555756]
E1 = -3.8586377930173916  E_coul = 1.0218811071825054
cycle= 34 E= -2.83675668583489  delta_E= -1.9e-07  |g|= 1.04e-05  |ddm|= 0.599
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437713997184  LUMO = 1.36251034969613
  mo_energy =
[-0.90743771  1.36251035  6.50510498 15.55352185 31.08654444 52.94552523]
E1 = -3.858637826657303  E_coul = 1.0218811190232275
cycle= 35 E= -2.83675670763408  delta_E= -2.18e-08  |g|= 9.62e-06  |ddm|= 0.31
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437736659092  LUMO = 1.36250996750736
  mo_energy =
[-0.90743774  1.36250997  6.50510302 15.55351556 31.08653533 52.9455085 ]
E1 = -3.858637867177054  E_coul = 1.0218819957810534
cycle= 36 E= -2.836755871396  delta_E= 8.36e-07  |g|= 6.39e-05  |ddm|= 0.31
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437597792008  LUMO = 1.36251207208231
  mo_energy =
[-0.9074376   1.36251207  6.50511362 15.55355355 31.0865952  52.94564428]
E1 = -3.8586376381196783  E_coul = 1.0218807895176574
cycle= 37 E= -2.83675684860202  delta_E= -9.77e-07  |g|= 2.97e-05  |ddm|= 1.87
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437718415029  LUMO = 1.36251040480148
  mo_energy =
[-0.90743772  1.3625104   6.50510519 15.55352383 31.08654834 52.94553816]
E1 = -3.8586378146688145  E_coul = 1.021880547221547
cycle= 38 E= -2.83675726744727  delta_E= -4.19e-07  |g|= 5.62e-05  |ddm|= 1.45
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437746969695  LUMO = 1.36250972544818
  mo_energy =
[-0.90743775  1.36250973  6.50510188 15.55351061 31.08652636 52.94548028]
E1 = -3.8586378983066343  E_coul = 1.0218814263533014
cycle= 39 E= -2.83675647195333  delta_E= 7.95e-07  |g|= 1.71e-05  |ddm|= 0.694
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437750070105  LUMO = 1.36250952395179
  mo_energy =
[-0.90743775  1.36250952  6.50510044 15.55350879 31.08652631 52.9455018 ]
E1 = -3.8586379093986722  E_coul = 1.0218814720610956
cycle= 40 E= -2.83675643733758  delta_E= 3.46e-08  |g|= 1.63e-05  |ddm|= 0.0185
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437686143243  LUMO = 1.3625103325921
  mo_energy =
[-0.90743769  1.36251033  6.50510446 15.55352272 31.08654734 52.94554849]
E1 = -3.8586378253197893  E_coul = 1.0218807510566243
cycle= 41 E= -2.83675707426316  delta_E= -6.37e-07  |g|= 3.83e-05  |ddm|= 0.682
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90743775974462  LUMO = 1.36250918478736
  mo_energy =
[-0.90743776  1.36250918  6.50509857 15.55350189 31.08651421 52.94547771]
E1 = -3.858637947830717  E_coul = 1.0218814011031685
cycle= 42 E= -2.83675654672755  delta_E= 5.28e-07  |g|= 1.39e-05  |ddm|= 0.999
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437732708016  LUMO = 1.36250936001575
  mo_energy =
[-0.90743773  1.36250936  6.50509921 15.5535071  31.08652551 52.94551628]
E1 = -3.8586379244757683  E_coul = 1.0218812077781971
cycle= 43 E= -2.83675671669757  delta_E= -1.7e-07  |g|= 5.8e-06  |ddm|= 0.271
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437727726087  LUMO = 1.36250929429444
  mo_energy =
[-0.90743773  1.36250929  6.50509871 15.55350648 31.08652545 52.94552313]
E1 = -3.8586379296925637  E_coul = 1.0218808974328826
cycle= 44 E= -2.83675703225968  delta_E= -3.16e-07  |g|= 3.16e-05  |ddm|= 0.0116
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437868922275  LUMO = 1.36250699374208
  mo_energy =
[-0.90743787  1.36250699  6.50508689 15.55346589 31.08646291 52.94539097]
E1 = -3.8586381766483244  E_coul = 1.0218820136399334
cycle= 45 E= -2.83675616300839  delta_E= 8.69e-07  |g|= 5.35e-05  |ddm|= 1.97
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9074377495493  LUMO = 1.36250831301008
  mo_energy =
[-0.90743775  1.36250831  6.50509339 15.55348975 31.08650117 52.94547978]
E1 = -3.8586380404254075  E_coul = 1.0218808051840724
cycle= 46 E= -2.83675723524134  delta_E= -1.07e-06  |g|= 4.26e-05  |ddm|= 1.16
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437731435826  LUMO = 1.36250834016556
  mo_energy =
[-0.90743773  1.36250834  6.50509338 15.5534909  31.08650438 52.94549455]
E1 = -3.8586380384208785  E_coul = 1.0218811344737158
cycle= 47 E= -2.83675690394716  delta_E= 3.31e-07  |g|= 1.77e-05  |ddm|= 0.0608
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437776678389  LUMO = 1.36250756900459
  mo_energy =
[-0.90743778  1.36250757  6.50508963 15.5534767  31.08648153 52.94543491]
E1 = -3.858638128764302  E_coul = 1.0218820362403893
cycle= 48 E= -2.83675609252391  delta_E= 8.11e-07  |g|= 5.44e-05  |ddm|= 0.741
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437719864112  LUMO = 1.36250829327212
  mo_energy =
[-0.90743772  1.36250829  6.50509343 15.55348947 31.08650125 52.94547109]
E1 = -3.8586380573028034  E_coul = 1.021881313854825
cycle= 49 E= -2.83675674344798  delta_E= -6.51e-07  |g|= 3.06e-06  |ddm|= 0.584
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.907437663999784  LUMO = 1.36250902195744
  mo_energy =
[-0.90743766  1.36250902  6.50509726 15.5535014  31.08651854 52.9454973 ]
E1 = -3.8586379875084007  E_coul = 1.0218818593640162
cycle= 50 E= -2.83675612814438  delta_E= 6.15e-07  |g|= 4.43e-05  |ddm|= 0.543
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8586379875084007  E_coul = 1.0218818593640162

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.907437134397486  LUMO = 1.36251795956258
  mo_energy =
[-0.90743713  1.36251796  6.50514367 15.55365515 31.08675023 52.94595786]
E1 = -3.8586370410972854  E_coul = 1.0218810372445024
Extra cycle  E= -2.83675600385278  delta_E= 1.24e-07  |g|= 1.39e-05  |ddm|= 7.43
    CPU time for scf_cycle      0.52 sec, wall time      0.52 sec
exp = [5.60450348 4.91040106 4.27978688 3.62920379 3.20473115 0.34094067]
grad_E = [-7.42842945e-04 -5.66238221e-04 -3.48606222e-04 -5.30016294e-07
  3.71102371e-04 -2.49899543e-02]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:36 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  5.98102420028        1
[INPUT] 0    0    [1    /1   ]  5.25895823197        1
[INPUT] 0    0    [1    /1   ]  4.60958199904        1
[INPUT] 0    0    [1    /1   ]  3.93759796283        1
[INPUT] 0    0    [1    /1   ]  3.52507347469        1
[INPUT] 0    0    [1    /1   ]  0.364110289708       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [5.981024200277334, 1.0]], [0, [5.258958231967702, 1.0]], [0, [4.609581999042745, 1.0]], [0, [3.937597962827315, 1.0]], [0, [3.5250734746885417, 1.0]], [0, [0.36411028970821724, 1.0]]]}
ecp = {}
CPU time:        33.26
Set gradient conv threshold to 3.16228e-05
cond(S) = 714620642.1277921

WARN: Singularity detected in overlap matrix (condition number = 7.15e+08). SCF may be inaccurate and hard to converge.

E1 = -3.857080084916333  E_coul = 1.024051575231466
init E= -2.83302850968487
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906703099800462  LUMO = 1.49628992219499
  mo_energy =
[-0.9067031   1.49628992  7.06947197 16.87385472 33.63330158 57.26341435]
E1 = -3.864271413471003  E_coul = 1.0267901003354807
cycle= 1 E= -2.83748131313552  delta_E= -0.00445  |g|= 0.00612  |ddm|= 6.3e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.905346542419412  LUMO = 1.49918679406515
  mo_energy =
[-0.90534654  1.49918679  7.0724489  16.87573253 33.63435183 57.26129262]
E1 = -3.8640478180806603  E_coul = 1.0265663568546328
cycle= 2 E= -2.83748146122603  delta_E= -1.48e-07  |g|= 0.000418  |ddm|=  563
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.905464151327152  LUMO = 1.49917900340701
  mo_energy =
[-0.90546415  1.499179    7.07247717 16.87608781 33.63494786 57.26252251]
E1 = -3.8640461230607106  E_coul = 1.0265635570829845
cycle= 3 E= -2.83748256597773  delta_E= -1.1e-06  |g|= 0.000111  |ddm|= 29.3
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.905458642093872  LUMO = 1.49915927888524
  mo_energy =
[-0.90545864  1.49915928  7.07236817 16.87565277 33.63422713 57.26076033]
E1 = -3.8640501523860262  E_coul = 1.026568151485977
cycle= 4 E= -2.83748200090005  delta_E= 5.65e-07  |g|= 7.31e-05  |ddm|= 29.8
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.905456911884904  LUMO = 1.49917316441292
  mo_energy =
[-0.90545691  1.49917316  7.07243378 16.87590612 33.63465742 57.26187179]
E1 = -3.8640489633929467  E_coul = 1.026567128234575
cycle= 5 E= -2.83748183515837  delta_E= 1.66e-07  |g|= 2.34e-05  |ddm|= 14.5
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457149005764  LUMO = 1.49917383670766
  mo_energy =
[-0.90545715  1.49917384  7.07243641 16.87593121 33.63471125 57.26207461]
E1 = -3.864048773648035  E_coul = 1.0265663854984017
cycle= 6 E= -2.83748238814963  delta_E= -5.53e-07  |g|= 4.37e-05  |ddm|= 2.16
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457431157812  LUMO = 1.49917122566779
  mo_energy =
[-0.90545743  1.49917123  7.07242387 16.87588114 33.63462479 57.26185753]
E1 = -3.8640490089981387  E_coul = 1.026566922271379
cycle= 7 E= -2.83748208672676  delta_E= 3.01e-07  |g|= 3.32e-06  |ddm|= 2.93
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457465331598  LUMO = 1.49917096430053
  mo_energy =
[-0.90545747  1.49917096  7.07242199 16.87587857 33.63462344 57.26188075]
E1 = -3.864049012833043  E_coul = 1.0265657527049554
cycle= 8 E= -2.83748326012809  delta_E= -1.17e-06  |g|= 0.000109  |ddm|= 0.0216
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457731903063  LUMO = 1.49916667853477
  mo_energy =
[-0.90545773  1.49916668  7.07240072 16.87580263 33.63450139 57.26158675]
E1 = -3.8640494360011934  E_coul = 1.0265674063714334
cycle= 9 E= -2.83748202962976  delta_E= 1.23e-06  |g|= 2.38e-05  |ddm|=  4.7
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90545766553417  LUMO = 1.49916762436495
  mo_energy =
[-0.90545767  1.49916762  7.07240568 16.87581867 33.63452527 57.26162438]
E1 = -3.8640493530127653  E_coul = 1.0265675511079715
cycle= 10 E= -2.83748180190479  delta_E= 2.28e-07  |g|= 3.74e-05  |ddm|= 0.897
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457606708122  LUMO = 1.49916885116576
  mo_energy =
[-0.90545761  1.49916885  7.0724121  16.87583796 33.63455289 57.26167038]
E1 = -3.864049238528447  E_coul = 1.0265660162332606
cycle= 11 E= -2.83748322229519  delta_E= -1.42e-06  |g|= 9.09e-05  |ddm|= 1.15
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457714201439  LUMO = 1.4991666391731
  mo_energy =
[-0.90545771  1.49916664  7.07240089 16.87579908 33.63449204 57.26154027]
E1 = -3.8640494603062736  E_coul = 1.0265666066838395
cycle= 12 E= -2.83748285362243  delta_E= 3.69e-07  |g|= 5.17e-05  |ddm|= 2.39
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457878327527  LUMO = 1.49916390715942
  mo_energy =
[-0.90545788  1.49916391  7.07238758 16.87574694 33.63440373 57.26131297]
E1 = -3.8640497429546605  E_coul = 1.026566784161183
cycle= 13 E= -2.83748295879348  delta_E= -1.05e-07  |g|= 4.22e-05  |ddm|= 3.26
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457953185964  LUMO = 1.49916243865052
  mo_energy =
[-0.90545795  1.49916244  7.07237995 16.87572085 33.63436252 57.26123362]
E1 = -3.864049884707524  E_coul = 1.0265679205660891
cycle= 14 E= -2.83748196414144  delta_E= 9.95e-07  |g|= 5.82e-05  |ddm|= 1.53
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457995146383  LUMO = 1.4991618369383
  mo_energy =
[-0.905458    1.49916184  7.07237668 16.87571246 33.63435223 57.2612219 ]
E1 = -3.864049932935491  E_coul = 1.0265685427316493
cycle= 15 E= -2.83748139020384  delta_E= 5.74e-07  |g|= 0.000114  |ddm|= 0.459
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458310375072  LUMO = 1.49915674896219
  mo_energy =
[-0.90545831  1.49915675  7.07235211 16.87561754 33.63419372 57.26081043]
E1 = -3.8640504586150373  E_coul = 1.0265685835280427
cycle= 16 E= -2.83748187508699  delta_E= -4.85e-07  |g|= 9.51e-05  |ddm|= 6.02
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458072200741  LUMO = 1.4991608914189
  mo_energy =
[-0.90545807  1.49916089  7.07237294 16.87568937 33.63430736 57.26108041]
E1 = -3.8640500527858297  E_coul = 1.0265684864995879
cycle= 17 E= -2.83748156628624  delta_E= 3.09e-07  |g|= 0.000102  |ddm|= 4.43
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458126849168  LUMO = 1.49915966250057
  mo_energy =
[-0.90545813  1.49915966  7.0723666  16.87566699 33.63427226 57.26101215]
E1 = -3.864050175641477  E_coul = 1.0265677386921919
cycle= 18 E= -2.83748243694929  delta_E= -8.71e-07  |g|= 3.27e-05  |ddm|= 1.33
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458431763689  LUMO = 1.49915389409104
  mo_energy =
[-0.90545843  1.49915389  7.07233711 16.87556917 33.63412258 57.26071148]
E1 = -3.8640507338933388  E_coul = 1.0265674231678945
cycle= 19 E= -2.83748331072544  delta_E= -8.74e-07  |g|= 2.39e-05  |ddm|= 5.93
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457570801706  LUMO = 1.49916916515286
  mo_energy =
[-0.90545757  1.49916917  7.07241427 16.87584023 33.6345539  57.26166454]
E1 = -3.864049228005841  E_coul = 1.0265671388576385
cycle= 20 E= -2.8374820891482  delta_E= 1.22e-06  |g|= 6.63e-06  |ddm|= 16.5
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457234450569  LUMO = 1.49917531265948
  mo_energy =
[-0.90545723  1.49917531  7.07244588 16.87594455 33.63471179 57.26194164]
E1 = -3.8640486456116023  E_coul = 1.0265668343318244
cycle= 21 E= -2.83748181127978  delta_E= 2.78e-07  |g|= 1.6e-05  |ddm|= 6.15
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457186126602  LUMO = 1.49917539762752
  mo_energy =
[-0.90545719  1.4991754   7.07244471 16.87595982 33.63475552 57.26214596]
E1 = -3.8640485901945194  E_coul = 1.0265671296450476
cycle= 22 E= -2.83748146054947  delta_E= 3.51e-07  |g|= 2.76e-05  |ddm|= 1.21
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457170800824  LUMO = 1.49917603809337
  mo_energy =
[-0.90545717  1.49917604  7.07244875 16.87596424 33.63475283 57.26208805]
E1 = -3.8640485502998696  E_coul = 1.0265669768691839
cycle= 23 E= -2.83748157343069  delta_E= -1.13e-07  |g|= 2.16e-05  |ddm|= 0.145
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457252169432  LUMO = 1.49917461076792
  mo_energy =
[-0.90545725  1.49917461  7.07244136 16.87593716 33.63470722 57.26199182]
E1 = -3.864048688030374  E_coul = 1.026566160262177
cycle= 24 E= -2.8374825277682  delta_E= -9.54e-07  |g|= 4.81e-05  |ddm|= 1.57
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457432791766  LUMO = 1.49917096180449
  mo_energy =
[-0.90545743  1.49917096  7.07242205 16.87587789 33.63462179 57.26185708]
E1 = -3.8640490263112066  E_coul = 1.0265666540692506
cycle= 25 E= -2.83748237224196  delta_E= 1.56e-07  |g|= 3.18e-05  |ddm|= 3.44
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457603051034  LUMO = 1.49916799281304
  mo_energy =
[-0.9054576   1.49916799  7.07240721 16.87582254 33.63453056 57.26164288]
E1 = -3.864049326066511  E_coul = 1.026567184523786
cycle= 26 E= -2.83748214154273  delta_E= 2.31e-07  |g|= 8.18e-06  |ddm|= 3.38
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457642686999  LUMO = 1.49916764402598
  mo_energy =
[-0.90545764  1.49916764  7.07240607 16.87581376 33.63451196 57.26156645]
E1 = -3.8640493741350226  E_coul = 1.0265668559682437
cycle= 27 E= -2.83748251816678  delta_E= -3.77e-07  |g|= 1.87e-05  |ddm|= 0.674
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457655155924  LUMO = 1.49916781868679
  mo_energy =
[-0.90545766  1.49916782  7.07240747 16.87581539 33.63451162 57.26153598]
E1 = -3.8640493658864545  E_coul = 1.0265675080639847
cycle= 28 E= -2.83748185782247  delta_E= 6.6e-07  |g|= 3.86e-05  |ddm|= 0.0187
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457566576094  LUMO = 1.49916921441964
  mo_energy =
[-0.90545757  1.49916921  7.07241427 16.87584363 33.63456149 57.26167075]
E1 = -3.8640492188997806  E_coul = 1.0265664199061446
cycle= 29 E= -2.83748279899364  delta_E= -9.41e-07  |g|= 5.65e-05  |ddm|= 1.76
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457684415742  LUMO = 1.49916718121141
  mo_energy =
[-0.90545768  1.49916718  7.07240398 16.87580466 33.63449583 57.26152319]
E1 = -3.8640494216855825  E_coul = 1.0265681290946949
cycle= 30 E= -2.83748129259089  delta_E= 1.51e-06  |g|= 9.64e-05  |ddm|= 2.33
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457501765643  LUMO = 1.4991703062898
  mo_energy =
[-0.9054575   1.49917031  7.07241953 16.87586256 33.63459161 57.26175195]
E1 = -3.86404910672337  E_coul = 1.0265664982816505
cycle= 31 E= -2.83748260844172  delta_E= -1.32e-06  |g|= 4.6e-05  |ddm|= 3.56
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457582536599  LUMO = 1.49916887979669
  mo_energy =
[-0.90545758  1.49916888  7.07241234 16.87583651 33.63454932 57.26165743]
E1 = -3.864049248375171  E_coul = 1.0265678513215175
cycle= 32 E= -2.83748139705365  delta_E= 1.21e-06  |g|= 7.55e-05  |ddm|= 1.58
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457492837247  LUMO = 1.49917055286191
  mo_energy =
[-0.90545749  1.49917055  7.07242107 16.87586461 33.63459184 57.26173388]
E1 = -3.864049091537764  E_coul = 1.0265688805415452
cycle= 33 E= -2.83748021099622  delta_E= 1.19e-06  |g|= 0.000172  |ddm|= 1.65
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457218627854  LUMO = 1.49917535252922
  mo_energy =
[-0.90545722  1.49917535  7.07244522 16.87595025 33.63472829 57.26203792]
E1 = -3.864048616707174  E_coul = 1.0265670780107061
cycle= 34 E= -2.83748153869647  delta_E= -1.33e-06  |g|= 2.89e-05  |ddm|= 5.23
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457216667293  LUMO = 1.49917535718064
  mo_energy =
[-0.90545722  1.49917536  7.07244505 16.87595119 33.63473121 57.26205421]
E1 = -3.8640486105221488  E_coul = 1.026566424847736
cycle= 35 E= -2.83748218567441  delta_E= -6.47e-07  |g|= 2.86e-05  |ddm|= 0.107
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457106686361  LUMO = 1.49917749177027
  mo_energy =
[-0.90545711  1.49917749  7.07245619 16.87598716 33.63478572 57.26215585]
E1 = -3.864048408478897  E_coul = 1.0265655307416246
cycle= 36 E= -2.83748287773727  delta_E= -6.92e-07  |g|= 0.000102  |ddm|= 2.12
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457032255761  LUMO = 1.49917882342865
  mo_energy =
[-0.90545703  1.49917882  7.0724626  16.87601146 33.63482558 57.26226069]
E1 = -3.8640482692834066  E_coul = 1.0265663773539684
cycle= 37 E= -2.83748189192944  delta_E= 9.86e-07  |g|= 1.89e-05  |ddm|= 1.57
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905456772224853  LUMO = 1.49918342821739
  mo_energy =
[-0.90545677  1.49918343  7.07248593 16.87609539 33.63496201 57.26256107]
E1 = -3.8640478144178094  E_coul = 1.0265641055618433
cycle= 38 E= -2.83748370885597  delta_E= -1.82e-06  |g|= 0.000205  |ddm|= 5.06
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905456565170351  LUMO = 1.49918732160272
  mo_energy =
[-0.90545657  1.49918732  7.07250581 16.87615795 33.63505277 57.26273832]
E1 = -3.864047441125309  E_coul = 1.0265659102175035
cycle= 39 E= -2.83748153090781  delta_E= 2.18e-06  |g|= 2.65e-05  |ddm|= 3.84
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905456545671217  LUMO = 1.49918741767732
  mo_energy =
[-0.90545655  1.49918742  7.07250604 16.87616165 33.6350618  57.26276788]
E1 = -3.86404742786681  E_coul = 1.0265662570568843
cycle= 40 E= -2.83748117080993  delta_E= 3.6e-07  |g|= 2.77e-06  |ddm|= 0.242
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905456727421082  LUMO = 1.49918396222556
  mo_energy =
[-0.90545673  1.49918396  7.07248824 16.87609709 33.63495533 57.26254064]
E1 = -3.8640477665025967  E_coul = 1.0265651071677389
cycle= 41 E= -2.83748265933486  delta_E= -1.49e-06  |g|= 0.000114  |ddm|= 3.79
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457790462894  LUMO = 1.49916470174411
  mo_energy =
[-0.90545779  1.4991647   7.07239032 16.87575925 33.63442426 57.26141518]
E1 = -3.8640496464333722  E_coul = 1.0265666928743007
cycle= 42 E= -2.83748295355907  delta_E= -2.94e-07  |g|= 4.86e-05  |ddm|= 20.4
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458217156522  LUMO = 1.4991573408402
  mo_energy =
[-0.90545822  1.49915734  7.07235304 16.87562807 33.63421534 57.26095552]
E1 = -3.864050369403317  E_coul = 1.026567890564342
cycle= 43 E= -2.83748247883898  delta_E= 4.75e-07  |g|= 2.65e-05  |ddm|= 7.96
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457986814814  LUMO = 1.49916187117181
  mo_energy =
[-0.90545799  1.49916187  7.07237714 16.87570386 33.63432861 57.26113774]
E1 = -3.86404995311697  E_coul = 1.026567697674839
cycle= 44 E= -2.83748225544213  delta_E= 2.23e-07  |g|= 3.36e-05  |ddm|= 4.32
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457819831929  LUMO = 1.49916466810484
  mo_energy =
[-0.90545782  1.49916467  7.07239097 16.87575512 33.63441241 57.26133738]
E1 = -3.8640496712335595  E_coul = 1.0265668844681761
cycle= 45 E= -2.83748278676538  delta_E= -5.31e-07  |g|= 2.52e-05  |ddm|= 3.17
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457901627419  LUMO = 1.49916299176127
  mo_energy =
[-0.9054579   1.49916299  7.07238218 16.87572941 33.63437744 57.2612889 ]
E1 = -3.8640498260987743  E_coul = 1.026565431261533
cycle= 46 E= -2.83748439483724  delta_E= -1.61e-06  |g|= 0.000164  |ddm|= 1.52
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458018404924  LUMO = 1.49916091543241
  mo_energy =
[-0.90545802  1.49916092  7.07237161 16.87569389 33.63432238 57.26117655]
E1 = -3.8640500261955784  E_coul = 1.026567648540825
cycle= 47 E= -2.83748237765475  delta_E= 2.02e-06  |g|= 2.92e-05  |ddm|= 2.15
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457977212129  LUMO = 1.49916160166926
  mo_energy =
[-0.90545798  1.4991616   7.07237484 16.87570805 33.63434754 57.26124684]
E1 = -3.86404995134696  E_coul = 1.0265688095173562
cycle= 48 E= -2.8374811418296  delta_E= 1.24e-06  |g|= 0.00013  |ddm|= 0.903
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458025587803  LUMO = 1.49916041804189
  mo_energy =
[-0.90545803  1.49916042  7.07236855 16.87568818 33.6343187  57.26119356]
E1 = -3.8640500653473318  E_coul = 1.0265683872633231
cycle= 49 E= -2.83748167808401  delta_E= -5.36e-07  |g|= 8.53e-05  |ddm|= 1.17
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458528271036  LUMO = 1.49914985870084
  mo_energy =
[-0.90545853  1.49914986  7.07231247 16.8755161  33.63406963 57.26082919]
E1 = -3.864051041470244  E_coul = 1.0265689975299053
cycle= 50 E= -2.83748204394034  delta_E= -3.66e-07  |g|= 0.000102  |ddm|= 9.91
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.864051041470244  E_coul = 1.0265689975299053

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.905456523292217  LUMO = 1.49917137396749
  mo_energy =
[-0.90545652  1.49917137  7.0724196  16.8758838  33.63464849 57.26202822]
E1 = -3.864049170241057  E_coul = 1.0265662370160522
Extra cycle  E= -2.837482933225  delta_E= -8.89e-07  |g|= 7.96e-05  |ddm|= 21.3
    CPU time for scf_cycle      0.50 sec, wall time      0.50 sec
exp = [5.9810242  5.25895823 4.609582   3.93759796 3.52507347 0.36411029]
E = -2.8374829332250044
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:36 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  5.98102420028        1
[INPUT] 0    0    [1    /1   ]  5.25895823197        1
[INPUT] 0    0    [1    /1   ]  4.60958199904        1
[INPUT] 0    0    [1    /1   ]  3.93759796283        1
[INPUT] 0    0    [1    /1   ]  3.52507347469        1
[INPUT] 0    0    [1    /1   ]  0.364110289708       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [5.981024200277334, 1.0]], [0, [5.258958231967702, 1.0]], [0, [4.609581999042745, 1.0]], [0, [3.937597962827315, 1.0]], [0, [3.5250734746885417, 1.0]], [0, [0.36411028970821724, 1.0]]]}
ecp = {}
CPU time:        34.00
Set gradient conv threshold to 3.16228e-05
cond(S) = 714620642.1277921

WARN: Singularity detected in overlap matrix (condition number = 7.15e+08). SCF may be inaccurate and hard to converge.

E1 = -3.857080084916333  E_coul = 1.024051575231466
init E= -2.83302850968487
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906703099800462  LUMO = 1.49628992219499
  mo_energy =
[-0.9067031   1.49628992  7.06947197 16.87385472 33.63330158 57.26341435]
E1 = -3.864271413471003  E_coul = 1.0267901003354807
cycle= 1 E= -2.83748131313552  delta_E= -0.00445  |g|= 0.00612  |ddm|= 6.3e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.905346542419412  LUMO = 1.49918679406515
  mo_energy =
[-0.90534654  1.49918679  7.0724489  16.87573253 33.63435183 57.26129262]
E1 = -3.8640478180806603  E_coul = 1.0265663568546328
cycle= 2 E= -2.83748146122603  delta_E= -1.48e-07  |g|= 0.000418  |ddm|=  563
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.905464151327152  LUMO = 1.49917900340701
  mo_energy =
[-0.90546415  1.499179    7.07247717 16.87608781 33.63494786 57.26252251]
E1 = -3.8640461230607106  E_coul = 1.0265635570829845
cycle= 3 E= -2.83748256597773  delta_E= -1.1e-06  |g|= 0.000111  |ddm|= 29.3
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.905458642093872  LUMO = 1.49915927888524
  mo_energy =
[-0.90545864  1.49915928  7.07236817 16.87565277 33.63422713 57.26076033]
E1 = -3.8640501523860262  E_coul = 1.026568151485977
cycle= 4 E= -2.83748200090005  delta_E= 5.65e-07  |g|= 7.31e-05  |ddm|= 29.8
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.905456911884904  LUMO = 1.49917316441292
  mo_energy =
[-0.90545691  1.49917316  7.07243378 16.87590612 33.63465742 57.26187179]
E1 = -3.8640489633929467  E_coul = 1.026567128234575
cycle= 5 E= -2.83748183515837  delta_E= 1.66e-07  |g|= 2.34e-05  |ddm|= 14.5
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457149005764  LUMO = 1.49917383670766
  mo_energy =
[-0.90545715  1.49917384  7.07243641 16.87593121 33.63471125 57.26207461]
E1 = -3.864048773648035  E_coul = 1.0265663854984017
cycle= 6 E= -2.83748238814963  delta_E= -5.53e-07  |g|= 4.37e-05  |ddm|= 2.16
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457431157812  LUMO = 1.49917122566779
  mo_energy =
[-0.90545743  1.49917123  7.07242387 16.87588114 33.63462479 57.26185753]
E1 = -3.8640490089981387  E_coul = 1.026566922271379
cycle= 7 E= -2.83748208672676  delta_E= 3.01e-07  |g|= 3.32e-06  |ddm|= 2.93
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457465331598  LUMO = 1.49917096430053
  mo_energy =
[-0.90545747  1.49917096  7.07242199 16.87587857 33.63462344 57.26188075]
E1 = -3.864049012833043  E_coul = 1.0265657527049554
cycle= 8 E= -2.83748326012809  delta_E= -1.17e-06  |g|= 0.000109  |ddm|= 0.0216
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457731903063  LUMO = 1.49916667853477
  mo_energy =
[-0.90545773  1.49916668  7.07240072 16.87580263 33.63450139 57.26158675]
E1 = -3.8640494360011934  E_coul = 1.0265674063714334
cycle= 9 E= -2.83748202962976  delta_E= 1.23e-06  |g|= 2.38e-05  |ddm|=  4.7
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90545766553417  LUMO = 1.49916762436495
  mo_energy =
[-0.90545767  1.49916762  7.07240568 16.87581867 33.63452527 57.26162438]
E1 = -3.8640493530127653  E_coul = 1.0265675511079715
cycle= 10 E= -2.83748180190479  delta_E= 2.28e-07  |g|= 3.74e-05  |ddm|= 0.897
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457606708122  LUMO = 1.49916885116576
  mo_energy =
[-0.90545761  1.49916885  7.0724121  16.87583796 33.63455289 57.26167038]
E1 = -3.864049238528447  E_coul = 1.0265660162332606
cycle= 11 E= -2.83748322229519  delta_E= -1.42e-06  |g|= 9.09e-05  |ddm|= 1.15
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457714201439  LUMO = 1.4991666391731
  mo_energy =
[-0.90545771  1.49916664  7.07240089 16.87579908 33.63449204 57.26154027]
E1 = -3.8640494603062736  E_coul = 1.0265666066838395
cycle= 12 E= -2.83748285362243  delta_E= 3.69e-07  |g|= 5.17e-05  |ddm|= 2.39
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457878327527  LUMO = 1.49916390715942
  mo_energy =
[-0.90545788  1.49916391  7.07238758 16.87574694 33.63440373 57.26131297]
E1 = -3.8640497429546605  E_coul = 1.026566784161183
cycle= 13 E= -2.83748295879348  delta_E= -1.05e-07  |g|= 4.22e-05  |ddm|= 3.26
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457953185964  LUMO = 1.49916243865052
  mo_energy =
[-0.90545795  1.49916244  7.07237995 16.87572085 33.63436252 57.26123362]
E1 = -3.864049884707524  E_coul = 1.0265679205660891
cycle= 14 E= -2.83748196414144  delta_E= 9.95e-07  |g|= 5.82e-05  |ddm|= 1.53
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457995146383  LUMO = 1.4991618369383
  mo_energy =
[-0.905458    1.49916184  7.07237668 16.87571246 33.63435223 57.2612219 ]
E1 = -3.864049932935491  E_coul = 1.0265685427316493
cycle= 15 E= -2.83748139020384  delta_E= 5.74e-07  |g|= 0.000114  |ddm|= 0.459
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458310375072  LUMO = 1.49915674896219
  mo_energy =
[-0.90545831  1.49915675  7.07235211 16.87561754 33.63419372 57.26081043]
E1 = -3.8640504586150373  E_coul = 1.0265685835280427
cycle= 16 E= -2.83748187508699  delta_E= -4.85e-07  |g|= 9.51e-05  |ddm|= 6.02
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458072200741  LUMO = 1.4991608914189
  mo_energy =
[-0.90545807  1.49916089  7.07237294 16.87568937 33.63430736 57.26108041]
E1 = -3.8640500527858297  E_coul = 1.0265684864995879
cycle= 17 E= -2.83748156628624  delta_E= 3.09e-07  |g|= 0.000102  |ddm|= 4.43
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458126849168  LUMO = 1.49915966250057
  mo_energy =
[-0.90545813  1.49915966  7.0723666  16.87566699 33.63427226 57.26101215]
E1 = -3.864050175641477  E_coul = 1.0265677386921919
cycle= 18 E= -2.83748243694929  delta_E= -8.71e-07  |g|= 3.27e-05  |ddm|= 1.33
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458431763689  LUMO = 1.49915389409104
  mo_energy =
[-0.90545843  1.49915389  7.07233711 16.87556917 33.63412258 57.26071148]
E1 = -3.8640507338933388  E_coul = 1.0265674231678945
cycle= 19 E= -2.83748331072544  delta_E= -8.74e-07  |g|= 2.39e-05  |ddm|= 5.93
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457570801706  LUMO = 1.49916916515286
  mo_energy =
[-0.90545757  1.49916917  7.07241427 16.87584023 33.6345539  57.26166454]
E1 = -3.864049228005841  E_coul = 1.0265671388576385
cycle= 20 E= -2.8374820891482  delta_E= 1.22e-06  |g|= 6.63e-06  |ddm|= 16.5
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457234450569  LUMO = 1.49917531265948
  mo_energy =
[-0.90545723  1.49917531  7.07244588 16.87594455 33.63471179 57.26194164]
E1 = -3.8640486456116023  E_coul = 1.0265668343318244
cycle= 21 E= -2.83748181127978  delta_E= 2.78e-07  |g|= 1.6e-05  |ddm|= 6.15
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457186126602  LUMO = 1.49917539762752
  mo_energy =
[-0.90545719  1.4991754   7.07244471 16.87595982 33.63475552 57.26214596]
E1 = -3.8640485901945194  E_coul = 1.0265671296450476
cycle= 22 E= -2.83748146054947  delta_E= 3.51e-07  |g|= 2.76e-05  |ddm|= 1.21
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457170800824  LUMO = 1.49917603809337
  mo_energy =
[-0.90545717  1.49917604  7.07244875 16.87596424 33.63475283 57.26208805]
E1 = -3.8640485502998696  E_coul = 1.0265669768691839
cycle= 23 E= -2.83748157343069  delta_E= -1.13e-07  |g|= 2.16e-05  |ddm|= 0.145
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457252169432  LUMO = 1.49917461076792
  mo_energy =
[-0.90545725  1.49917461  7.07244136 16.87593716 33.63470722 57.26199182]
E1 = -3.864048688030374  E_coul = 1.026566160262177
cycle= 24 E= -2.8374825277682  delta_E= -9.54e-07  |g|= 4.81e-05  |ddm|= 1.57
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457432791766  LUMO = 1.49917096180449
  mo_energy =
[-0.90545743  1.49917096  7.07242205 16.87587789 33.63462179 57.26185708]
E1 = -3.8640490263112066  E_coul = 1.0265666540692506
cycle= 25 E= -2.83748237224196  delta_E= 1.56e-07  |g|= 3.18e-05  |ddm|= 3.44
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457603051034  LUMO = 1.49916799281304
  mo_energy =
[-0.9054576   1.49916799  7.07240721 16.87582254 33.63453056 57.26164288]
E1 = -3.864049326066511  E_coul = 1.026567184523786
cycle= 26 E= -2.83748214154273  delta_E= 2.31e-07  |g|= 8.18e-06  |ddm|= 3.38
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457642686999  LUMO = 1.49916764402598
  mo_energy =
[-0.90545764  1.49916764  7.07240607 16.87581376 33.63451196 57.26156645]
E1 = -3.8640493741350226  E_coul = 1.0265668559682437
cycle= 27 E= -2.83748251816678  delta_E= -3.77e-07  |g|= 1.87e-05  |ddm|= 0.674
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457655155924  LUMO = 1.49916781868679
  mo_energy =
[-0.90545766  1.49916782  7.07240747 16.87581539 33.63451162 57.26153598]
E1 = -3.8640493658864545  E_coul = 1.0265675080639847
cycle= 28 E= -2.83748185782247  delta_E= 6.6e-07  |g|= 3.86e-05  |ddm|= 0.0187
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457566576094  LUMO = 1.49916921441964
  mo_energy =
[-0.90545757  1.49916921  7.07241427 16.87584363 33.63456149 57.26167075]
E1 = -3.8640492188997806  E_coul = 1.0265664199061446
cycle= 29 E= -2.83748279899364  delta_E= -9.41e-07  |g|= 5.65e-05  |ddm|= 1.76
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457684415742  LUMO = 1.49916718121141
  mo_energy =
[-0.90545768  1.49916718  7.07240398 16.87580466 33.63449583 57.26152319]
E1 = -3.8640494216855825  E_coul = 1.0265681290946949
cycle= 30 E= -2.83748129259089  delta_E= 1.51e-06  |g|= 9.64e-05  |ddm|= 2.33
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457501765643  LUMO = 1.4991703062898
  mo_energy =
[-0.9054575   1.49917031  7.07241953 16.87586256 33.63459161 57.26175195]
E1 = -3.86404910672337  E_coul = 1.0265664982816505
cycle= 31 E= -2.83748260844172  delta_E= -1.32e-06  |g|= 4.6e-05  |ddm|= 3.56
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457582536599  LUMO = 1.49916887979669
  mo_energy =
[-0.90545758  1.49916888  7.07241234 16.87583651 33.63454932 57.26165743]
E1 = -3.864049248375171  E_coul = 1.0265678513215175
cycle= 32 E= -2.83748139705365  delta_E= 1.21e-06  |g|= 7.55e-05  |ddm|= 1.58
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457492837247  LUMO = 1.49917055286191
  mo_energy =
[-0.90545749  1.49917055  7.07242107 16.87586461 33.63459184 57.26173388]
E1 = -3.864049091537764  E_coul = 1.0265688805415452
cycle= 33 E= -2.83748021099622  delta_E= 1.19e-06  |g|= 0.000172  |ddm|= 1.65
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457218627854  LUMO = 1.49917535252922
  mo_energy =
[-0.90545722  1.49917535  7.07244522 16.87595025 33.63472829 57.26203792]
E1 = -3.864048616707174  E_coul = 1.0265670780107061
cycle= 34 E= -2.83748153869647  delta_E= -1.33e-06  |g|= 2.89e-05  |ddm|= 5.23
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457216667293  LUMO = 1.49917535718064
  mo_energy =
[-0.90545722  1.49917536  7.07244505 16.87595119 33.63473121 57.26205421]
E1 = -3.8640486105221488  E_coul = 1.026566424847736
cycle= 35 E= -2.83748218567441  delta_E= -6.47e-07  |g|= 2.86e-05  |ddm|= 0.107
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457106686361  LUMO = 1.49917749177027
  mo_energy =
[-0.90545711  1.49917749  7.07245619 16.87598716 33.63478572 57.26215585]
E1 = -3.864048408478897  E_coul = 1.0265655307416246
cycle= 36 E= -2.83748287773727  delta_E= -6.92e-07  |g|= 0.000102  |ddm|= 2.12
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457032255761  LUMO = 1.49917882342865
  mo_energy =
[-0.90545703  1.49917882  7.0724626  16.87601146 33.63482558 57.26226069]
E1 = -3.8640482692834066  E_coul = 1.0265663773539684
cycle= 37 E= -2.83748189192944  delta_E= 9.86e-07  |g|= 1.89e-05  |ddm|= 1.57
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905456772224853  LUMO = 1.49918342821739
  mo_energy =
[-0.90545677  1.49918343  7.07248593 16.87609539 33.63496201 57.26256107]
E1 = -3.8640478144178094  E_coul = 1.0265641055618433
cycle= 38 E= -2.83748370885597  delta_E= -1.82e-06  |g|= 0.000205  |ddm|= 5.06
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905456565170351  LUMO = 1.49918732160272
  mo_energy =
[-0.90545657  1.49918732  7.07250581 16.87615795 33.63505277 57.26273832]
E1 = -3.864047441125309  E_coul = 1.0265659102175035
cycle= 39 E= -2.83748153090781  delta_E= 2.18e-06  |g|= 2.65e-05  |ddm|= 3.84
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905456545671217  LUMO = 1.49918741767732
  mo_energy =
[-0.90545655  1.49918742  7.07250604 16.87616165 33.6350618  57.26276788]
E1 = -3.86404742786681  E_coul = 1.0265662570568843
cycle= 40 E= -2.83748117080993  delta_E= 3.6e-07  |g|= 2.77e-06  |ddm|= 0.242
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905456727421082  LUMO = 1.49918396222556
  mo_energy =
[-0.90545673  1.49918396  7.07248824 16.87609709 33.63495533 57.26254064]
E1 = -3.8640477665025967  E_coul = 1.0265651071677389
cycle= 41 E= -2.83748265933486  delta_E= -1.49e-06  |g|= 0.000114  |ddm|= 3.79
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457790462894  LUMO = 1.49916470174411
  mo_energy =
[-0.90545779  1.4991647   7.07239032 16.87575925 33.63442426 57.26141518]
E1 = -3.8640496464333722  E_coul = 1.0265666928743007
cycle= 42 E= -2.83748295355907  delta_E= -2.94e-07  |g|= 4.86e-05  |ddm|= 20.4
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458217156522  LUMO = 1.4991573408402
  mo_energy =
[-0.90545822  1.49915734  7.07235304 16.87562807 33.63421534 57.26095552]
E1 = -3.864050369403317  E_coul = 1.026567890564342
cycle= 43 E= -2.83748247883898  delta_E= 4.75e-07  |g|= 2.65e-05  |ddm|= 7.96
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457986814814  LUMO = 1.49916187117181
  mo_energy =
[-0.90545799  1.49916187  7.07237714 16.87570386 33.63432861 57.26113774]
E1 = -3.86404995311697  E_coul = 1.026567697674839
cycle= 44 E= -2.83748225544213  delta_E= 2.23e-07  |g|= 3.36e-05  |ddm|= 4.32
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457819831929  LUMO = 1.49916466810484
  mo_energy =
[-0.90545782  1.49916467  7.07239097 16.87575512 33.63441241 57.26133738]
E1 = -3.8640496712335595  E_coul = 1.0265668844681761
cycle= 45 E= -2.83748278676538  delta_E= -5.31e-07  |g|= 2.52e-05  |ddm|= 3.17
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457901627419  LUMO = 1.49916299176127
  mo_energy =
[-0.9054579   1.49916299  7.07238218 16.87572941 33.63437744 57.2612889 ]
E1 = -3.8640498260987743  E_coul = 1.026565431261533
cycle= 46 E= -2.83748439483724  delta_E= -1.61e-06  |g|= 0.000164  |ddm|= 1.52
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458018404924  LUMO = 1.49916091543241
  mo_energy =
[-0.90545802  1.49916092  7.07237161 16.87569389 33.63432238 57.26117655]
E1 = -3.8640500261955784  E_coul = 1.026567648540825
cycle= 47 E= -2.83748237765475  delta_E= 2.02e-06  |g|= 2.92e-05  |ddm|= 2.15
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457977212129  LUMO = 1.49916160166926
  mo_energy =
[-0.90545798  1.4991616   7.07237484 16.87570805 33.63434754 57.26124684]
E1 = -3.86404995134696  E_coul = 1.0265688095173562
cycle= 48 E= -2.8374811418296  delta_E= 1.24e-06  |g|= 0.00013  |ddm|= 0.903
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458025587803  LUMO = 1.49916041804189
  mo_energy =
[-0.90545803  1.49916042  7.07236855 16.87568818 33.6343187  57.26119356]
E1 = -3.8640500653473318  E_coul = 1.0265683872633231
cycle= 49 E= -2.83748167808401  delta_E= -5.36e-07  |g|= 8.53e-05  |ddm|= 1.17
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458528271036  LUMO = 1.49914985870084
  mo_energy =
[-0.90545853  1.49914986  7.07231247 16.8755161  33.63406963 57.26082919]
E1 = -3.864051041470244  E_coul = 1.0265689975299053
cycle= 50 E= -2.83748204394034  delta_E= -3.66e-07  |g|= 0.000102  |ddm|= 9.91
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.864051041470244  E_coul = 1.0265689975299053

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.905456523292217  LUMO = 1.49917137396749
  mo_energy =
[-0.90545652  1.49917137  7.0724196  16.8758838  33.63464849 57.26202822]
E1 = -3.864049170241057  E_coul = 1.0265662370160522
Extra cycle  E= -2.837482933225  delta_E= -8.89e-07  |g|= 7.96e-05  |ddm|= 21.3
    CPU time for scf_cycle      0.51 sec, wall time      0.51 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 714620642.1277921

WARN: Singularity detected in overlap matrix (condition number = 7.15e+08). SCF may be inaccurate and hard to converge.

E1 = -3.864049170241057  E_coul = 1.0265662370160522
init E= -2.837482933225
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.905458348133015  LUMO = 1.49915514618976
  mo_energy =
[-0.90545835  1.49915515  7.07234127 16.87560356 33.63419518 57.26099972]
E1 = -3.8640505518360486  E_coul = 1.0265688362667131
cycle= 1 E= -2.83748171556934  delta_E= 1.22e-06  |g|= 0.000103  |ddm|= 16.3
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.905456439775041  LUMO = 1.49917822868532
  mo_energy =
[-0.90545644  1.49917823  7.07245746 16.87598736 33.63477952 57.26216605]
E1 = -3.8640485000535905  E_coul = 1.0265662153940425
cycle= 2 E= -2.83748228465955  delta_E= -5.69e-07  |g|= 4.93e-05  |ddm|= 22.5
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.905457052088868  LUMO = 1.49917417374872
  mo_energy =
[-0.90545705  1.49917417  7.07243864 16.87592219 33.63467636 57.26191092]
E1 = -3.8640488051894533  E_coul = 1.026566320278935
cycle= 3 E= -2.83748248491052  delta_E= -2e-07  |g|= 4.81e-05  |ddm|= 3.77
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457203776592  LUMO = 1.49917213603546
  mo_energy =
[-0.9054572   1.49917214  7.07242806 16.87588623 33.63461984 57.26179985]
E1 = -3.864048987985018  E_coul = 1.0265658318455895
cycle= 4 E= -2.83748315613943  delta_E= -6.71e-07  |g|= 9.39e-05  |ddm|= 2.05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457447077044  LUMO = 1.4991678502799
  mo_energy =
[-0.90545745  1.49916785  7.0724059  16.87581568 33.63451541 57.26160367]
E1 = -3.8640493879623263  E_coul = 1.0265676678350066
cycle= 5 E= -2.83748172012732  delta_E= 1.44e-06  |g|= 4.93e-05  |ddm|= 4.19
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90545731311407  LUMO = 1.49917037461708
  mo_energy =
[-0.90545731  1.49917037  7.0724187  16.87585898 33.63458268 57.26174836]
E1 = -3.8640491404409025  E_coul = 1.0265668570907382
cycle= 6 E= -2.83748228335016  delta_E= -5.63e-07  |g|= 9.61e-06  |ddm|= 2.65
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457321333575  LUMO = 1.49917010072208
  mo_energy =
[-0.90545732  1.4991701   7.07241676 16.87585757 33.63458605 57.26179297]
E1 = -3.864049150131141  E_coul = 1.0265659951745971
cycle= 7 E= -2.83748315495654  delta_E= -8.72e-07  |g|= 8.98e-05  |ddm|= 0.0517
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457463664363  LUMO = 1.49916771902969
  mo_energy =
[-0.90545746  1.49916772  7.07240488 16.87581657 33.63452221 57.26164951]
E1 = -3.8640493833001224  E_coul = 1.026567118453785
cycle= 8 E= -2.83748226484634  delta_E= 8.9e-07  |g|= 3.11e-07  |ddm|= 2.53
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457461560479  LUMO = 1.49916781844767
  mo_energy =
[-0.90545746  1.49916782  7.07240532 16.87581871 33.63452631 57.26166401]
E1 = -3.8640493706579053  E_coul = 1.0265674669063125
cycle= 9 E= -2.83748190375159  delta_E= 3.61e-07  |g|= 3.16e-05  |ddm|= 0.152
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90545756931526  LUMO = 1.49916680018228
  mo_energy =
[-0.90545757  1.4991668   7.07239989 16.87580619 33.6345144  57.26167015]
E1 = -3.8640494407861543  E_coul = 1.0265673095257282
cycle= 10 E= -2.83748213126043  delta_E= -2.28e-07  |g|= 1.46e-05  |ddm|= 0.637
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457231640675  LUMO = 1.49917260554347
  mo_energy =
[-0.90545723  1.49917261  7.07242991 16.87590645 33.6346696  57.26198206]
E1 = -3.8640488926938175  E_coul = 1.0265666351664708
cycle= 11 E= -2.83748225752735  delta_E= -1.26e-07  |g|= 1.7e-05  |ddm|= 5.92
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457093169165  LUMO = 1.49917542863483
  mo_energy =
[-0.90545709  1.49917543  7.07244477 16.87595043 33.63473082 57.26207654]
E1 = -3.8640486332559254  E_coul = 1.0265679614572534
cycle= 12 E= -2.83748067179867  delta_E= 1.59e-06  |g|= 0.000116  |ddm|= 2.58
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457614887412  LUMO = 1.49916566483046
  mo_energy =
[-0.90545761  1.49916566  7.07239535 16.87577385 33.63444638 57.26144567]
E1 = -3.8640496051247397  E_coul = 1.026568604861758
cycle= 13 E= -2.83748100026298  delta_E= -3.28e-07  |g|= 0.000126  |ddm|= 10.7
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457207288839  LUMO = 1.49917302735877
  mo_energy =
[-0.90545721  1.49917303  7.07243219 16.87591017 33.63466966 57.26196706]
E1 = -3.8640488611593202  E_coul = 1.026565505815075
cycle= 14 E= -2.83748335534425  delta_E= -2.36e-06  |g|= 0.000121  |ddm|= 8.34
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457192631738  LUMO = 1.49917337187948
  mo_energy =
[-0.90545719  1.49917337  7.07243397 16.87591662 33.63468018 57.26198894]
E1 = -3.8640488262502943  E_coul = 1.0265674298012017
cycle= 15 E= -2.83748139644909  delta_E= 1.96e-06  |g|= 5.48e-05  |ddm|= 0.385
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90545712636601  LUMO = 1.49917455892473
  mo_energy =
[-0.90545713  1.49917456  7.0724399  16.87593854 33.63471616 57.26207344]
E1 = -3.8640487063781537  E_coul = 1.026565953828697
cycle= 16 E= -2.83748275254946  delta_E= -1.36e-06  |g|= 7.88e-05  |ddm|= 1.35
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905456979605261  LUMO = 1.49917732388529
  mo_energy =
[-0.90545698  1.49917732  7.07245373 16.8759899  33.6348004  57.2622695 ]
E1 = -3.8640484245651865  E_coul = 1.0265651938757006
cycle= 17 E= -2.83748323068949  delta_E= -4.78e-07  |g|= 0.000133  |ddm|= 3.16
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905456824296038  LUMO = 1.49917990614445
  mo_energy =
[-0.90545682  1.49917991  7.07246586 16.87603933 33.63488451 57.26250483]
E1 = -3.864048144360784  E_coul = 1.0265656925724893
cycle= 18 E= -2.83748245178829  delta_E= 7.79e-07  |g|= 8.18e-05  |ddm|= 3.25
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905456561829532  LUMO = 1.4991840991573
  mo_energy =
[-0.90545656  1.4991841   7.0724862  16.87611773 33.63501455 57.26283325]
E1 = -3.864047714328902  E_coul = 1.0265646556455708
cycle= 19 E= -2.83748305868333  delta_E= -6.07e-07  |g|= 0.000157  |ddm|= 4.91
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905456505642807  LUMO = 1.49918505687091
  mo_energy =
[-0.90545651  1.49918506  7.07249155 16.87613207 33.63503409 57.26283886]
E1 = -3.864047637925269  E_coul = 1.02656534656036
cycle= 20 E= -2.83748229136491  delta_E= 7.67e-07  |g|= 9.05e-05  |ddm|= 0.724
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905456980360332  LUMO = 1.499176633597
  mo_energy =
[-0.90545698  1.49917663  7.07244901 16.8759768  33.63478069 57.26227775]
E1 = -3.864048475346375  E_coul = 1.0265662583451793
cycle= 21 E= -2.8374822170012  delta_E= 7.44e-08  |g|= 4.61e-05  |ddm|= 9.37
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457684294411  LUMO = 1.49916352202254
  mo_energy =
[-0.90545768  1.49916352  7.07238191 16.8757419  33.63440767 57.261497  ]
E1 = -3.864049756863453  E_coul = 1.0265674167967562
cycle= 22 E= -2.8374823400667  delta_E= -1.23e-07  |g|= 1.36e-05  |ddm|=   14
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457467709268  LUMO = 1.49916793958115
  mo_energy =
[-0.90545747  1.49916794  7.0724047  16.87582817 33.63455379 57.26182027]
E1 = -3.86404931456371  E_coul = 1.0265676160903685
cycle= 23 E= -2.83748169847334  delta_E= 6.42e-07  |g|= 3.91e-05  |ddm|= 5.07
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457475760542  LUMO = 1.49916861651926
  mo_energy =
[-0.90545748  1.49916862  7.07240996 16.8758307  33.63454279 57.26168831]
E1 = -3.864049292367489  E_coul = 1.0265670166104204
cycle= 24 E= -2.83748227575707  delta_E= -5.77e-07  |g|= 7.52e-06  |ddm|= 0.229
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457441766127  LUMO = 1.49916932754092
  mo_energy =
[-0.90545744  1.49916933  7.0724138  16.87584449 33.63456487 57.26172578]
E1 = -3.8640492239977093  E_coul = 1.0265665035415688
cycle= 25 E= -2.83748272045614  delta_E= -4.45e-07  |g|= 4.94e-05  |ddm|= 0.759
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457472541867  LUMO = 1.4991686541324
  mo_energy =
[-0.90545747  1.49916865  7.07241043 16.87583123 33.63454244 57.26166922]
E1 = -3.8640492950317453  E_coul = 1.026566867364421
cycle= 26 E= -2.83748242766732  delta_E= 2.93e-07  |g|= 1.96e-05  |ddm|= 0.816
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457501504325  LUMO = 1.49916811310808
  mo_energy =
[-0.9054575   1.49916811  7.07240775 16.87582096 33.63452499 57.26162562]
E1 = -3.8640493509098532  E_coul = 1.0265665126159416
cycle= 27 E= -2.83748283829391  delta_E= -4.11e-07  |g|= 5.45e-05  |ddm|= 0.642
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457609436758  LUMO = 1.49916619032696
  mo_energy =
[-0.90545761  1.49916619  7.07239837 16.87578604 33.63446828 57.26148539]
E1 = -3.864049548877166  E_coul = 1.0265663838929846
cycle= 28 E= -2.83748316498418  delta_E= -3.27e-07  |g|= 7.27e-05  |ddm|= 2.21
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457753051579  LUMO = 1.49916348870475
  mo_energy =
[-0.90545775  1.49916349  7.07238448 16.87574216 33.63440409 57.26136137]
E1 = -3.8640498057781247  E_coul = 1.0265671460502501
cycle= 29 E= -2.83748265972787  delta_E= 5.05e-07  |g|= 1.22e-05  |ddm|= 2.66
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90545776875445  LUMO = 1.4991631348991
  mo_energy =
[-0.90545777  1.49916313  7.0723825  16.8757375  33.6343988  57.26135983]
E1 = -3.864049835207942  E_coul = 1.0265666849159352
cycle= 30 E= -2.83748315029201  delta_E= -4.91e-07  |g|= 5.71e-05  |ddm|= 0.257
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457911653179  LUMO = 1.4991606188339
  mo_energy =
[-0.90545791  1.49916062  7.07237043 16.87569148 33.63432309 57.26115973]
E1 = -3.8640500987130024  E_coul = 1.0265681952956236
cycle= 31 E= -2.83748190341738  delta_E= 1.25e-06  |g|= 6.64e-05  |ddm|= 2.97
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457873631798  LUMO = 1.49916124518273
  mo_energy =
[-0.90545787  1.49916125  7.07237378 16.87570091 33.63433572 57.26117607]
E1 = -3.864050044197618  E_coul = 1.026567291238809
cycle= 32 E= -2.83748275295881  delta_E= -8.5e-07  |g|= 1.45e-05  |ddm|= 0.535
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457956346396  LUMO = 1.49915972067411
  mo_energy =
[-0.90545796  1.49915972  7.07236618 16.87567175 33.63428688 57.26105784]
E1 = -3.8640502009036055  E_coul = 1.0265674037132932
cycle= 33 E= -2.83748279719031  delta_E= -4.42e-08  |g|= 4.18e-06  |ddm|= 1.79
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458004021029  LUMO = 1.49915892820514
  mo_energy =
[-0.905458    1.49915893  7.07236235 16.87565881 33.63426729 57.26101173]
E1 = -3.8640502802926306  E_coul = 1.0265683746664291
cycle= 34 E= -2.8374819056262  delta_E= 8.92e-07  |g|= 7.83e-05  |ddm|= 0.847
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90545816019321  LUMO = 1.49915600743635
  mo_energy =
[-0.90545816  1.49915601  7.07234794 16.87560808 33.63418827 57.26082796]
E1 = -3.8640505762628448  E_coul = 1.0265673110329276
cycle= 35 E= -2.83748326522992  delta_E= -1.36e-06  |g|= 2.88e-05  |ddm|=  3.2
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458154732207  LUMO = 1.49915624138684
  mo_energy =
[-0.90545815  1.49915624  7.07234907 16.87561616 33.63420555 57.26088043]
E1 = -3.8640505445100324  E_coul = 1.0265673377152793
cycle= 36 E= -2.83748320679475  delta_E= 5.84e-08  |g|= 2.76e-05  |ddm|= 0.471
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457722873409  LUMO = 1.49916417691785
  mo_energy =
[-0.90545772  1.49916418  7.07238917 16.87576043 33.63443809 57.26139559]
E1 = -3.864049754619252  E_coul = 1.0265666104861246
cycle= 37 E= -2.83748314413313  delta_E= 6.27e-08  |g|= 5.96e-05  |ddm|= 8.75
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457991574625  LUMO = 1.4991600056451
  mo_energy =
[-0.90545799  1.49916001  7.07236908 16.87568352 33.63430897 57.261063  ]
E1 = -3.8640501810202235  E_coul = 1.0265678404014378
cycle= 38 E= -2.83748234061879  delta_E= 8.04e-07  |g|= 3.67e-05  |ddm|= 4.88
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457603428884  LUMO = 1.49916752231098
  mo_energy =
[-0.9054576   1.49916752  7.07240705 16.87581223 33.63450472 57.26147167]
E1 = -3.864049439967754  E_coul = 1.026566902120241
cycle= 39 E= -2.83748253784751  delta_E= -1.97e-07  |g|= 1.71e-05  |ddm|= 7.89
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457800787631  LUMO = 1.4991624908552
  mo_energy =
[-0.9054578   1.49916249  7.07237988 16.8757291  33.63438505 57.26129151]
E1 = -3.864049908175248  E_coul = 1.0265673090093166
cycle= 40 E= -2.83748259916593  delta_E= -6.13e-08  |g|= 7.69e-06  |ddm|= 4.73
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457773092875  LUMO = 1.49916286182573
  mo_energy =
[-0.90545777  1.49916286  7.07238161 16.87573515 33.6343948  57.26131706]
E1 = -3.8640498710341666  E_coul = 1.026567642168975
cycle= 41 E= -2.83748222886519  delta_E= 3.7e-07  |g|= 3.19e-05  |ddm|= 0.41
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457671690062  LUMO = 1.49916442068532
  mo_energy =
[-0.90545767  1.49916442  7.07238914 16.87576462 33.63444494 57.26144615]
E1 = -3.864049711547056  E_coul = 1.0265666933336612
cycle= 42 E= -2.83748301821339  delta_E= -7.89e-07  |g|= 5.64e-05  |ddm|= 1.85
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457815434186  LUMO = 1.49916193223507
  mo_energy =
[-0.90545782  1.49916193  7.07237692 16.87571648 33.63436397 57.26125118]
E1 = -3.864049969019669  E_coul = 1.0265678836674201
cycle= 43 E= -2.83748208535225  delta_E= 9.33e-07  |g|= 4.46e-05  |ddm|= 2.96
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90545776721395  LUMO = 1.49916271066962
  mo_energy =
[-0.90545777  1.49916271  7.07238077 16.87572912 33.6343834  57.26129705]
E1 = -3.8640498940540127  E_coul = 1.0265660975459205
cycle= 44 E= -2.83748379650809  delta_E= -1.71e-06  |g|= 0.000108  |ddm|= 0.799
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457977330947  LUMO = 1.49915883822259
  mo_energy =
[-0.90545798  1.49915884  7.07236115 16.87565989 33.63427297 57.2610515 ]
E1 = -3.864050276555279  E_coul = 1.026568301833251
cycle= 45 E= -2.83748197472203  delta_E= 1.82e-06  |g|= 7.03e-05  |ddm|=  4.2
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457985549072  LUMO = 1.49915838865391
  mo_energy =
[-0.90545799  1.49915839  7.07235849 16.87565253 33.63426265 57.26103729]
E1 = -3.8640503168412645  E_coul = 1.026568248846861
cycle= 46 E= -2.8374820679944  delta_E= -9.33e-08  |g|= 6.93e-05  |ddm|= 0.387
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905457994563196  LUMO = 1.49915822420389
  mo_energy =
[-0.90545799  1.49915822  7.07235786 16.87564895 33.63425592 57.26101015]
E1 = -3.8640503390117518  E_coul = 1.026569309518695
cycle= 47 E= -2.83748102949306  delta_E= 1.04e-06  |g|= 0.000154  |ddm|= 0.275
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458407951142  LUMO = 1.49915073396042
  mo_energy =
[-0.90545841  1.49915073  7.07231978 16.8755138  33.63403963 57.26052885]
E1 = -3.864051078405716  E_coul = 1.0265695902805003
cycle= 48 E= -2.83748148812522  delta_E= -4.59e-07  |g|= 0.000155  |ddm|= 8.16
    CPU time for cycle= 48      0.02 sec, wall time      0.02 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458179435624  LUMO = 1.49915487043104
  mo_energy =
[-0.90545818  1.49915487  7.07233999 16.87559113 33.63416809 57.26087848]
E1 = -3.864050646481482  E_coul = 1.026567866450768
cycle= 49 E= -2.83748278003071  delta_E= -1.29e-06  |g|= 2.16e-05  |ddm|= 4.91
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.905458220028404  LUMO = 1.49915444354847
  mo_energy =
[-0.90545822  1.49915444  7.07233832 16.87557773 33.63413894 57.26078495]
E1 = -3.8640507035926643  E_coul = 1.0265695986842118
cycle= 50 E= -2.83748110490845  delta_E= 1.68e-06  |g|= 0.000177  |ddm|= 0.865
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8640507035926643  E_coul = 1.0265695986842118

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.90545575336242  LUMO = 1.49918788325293
  mo_energy =
[-0.90545575  1.49918788  7.07250338 16.87618646 33.63513654 57.26311272]
E1 = -3.864047483654014  E_coul = 1.026565519904371
Extra cycle  E= -2.83748196374964  delta_E= -8.59e-07  |g|= 8.07e-05  |ddm|= 36.8
    CPU time for scf_cycle      0.59 sec, wall time      0.59 sec
exp = [5.9810242  5.25895823 4.609582   3.93759796 3.52507347 0.36411029]
grad_E = [-5.64456113e-04 -3.95201449e-04 -2.46032937e-04  1.59703173e-05
  2.81455125e-04 -2.40473352e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:39 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.27387559472        1
[INPUT] 0    0    [1    /1   ]  5.52991231537        1
[INPUT] 0    0    [1    /1   ]  4.86582727818        1
[INPUT] 0    0    [1    /1   ]  4.17694048964        1
[INPUT] 0    0    [1    /1   ]  3.77319347671        1
[INPUT] 0    0    [1    /1   ]  0.376750235978       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.273875594722907, 1.0]], [0, [5.52991231537197, 1.0]], [0, [4.865827278178212, 1.0]], [0, [4.176940489638526, 1.0]], [0, [3.7731934767069357, 1.0]], [0, [0.37675023597817464, 1.0]]]}
ecp = {}
CPU time:        37.00
Set gradient conv threshold to 3.16228e-05
cond(S) = 948813784.1430129

WARN: Singularity detected in overlap matrix (condition number = 9.49e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8566672003467133  E_coul = 1.024231165510319
init E= -2.83243603483639
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906686171380687  LUMO = 1.58690942762251
  mo_energy =
[-0.90668617  1.58690943  7.4897024  17.88267898 35.59516588 60.61107997]
E1 = -3.866470629029844  E_coul = 1.0288507701685836
cycle= 1 E= -2.83761985886126  delta_E= -0.00518  |g|= 0.00626  |ddm|= 1.3e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904385507503987  LUMO = 1.59090056714399
  mo_energy =
[-0.90438551  1.59090057  7.49477442 17.88804215 35.60082306 60.61689374]
E1 = -3.8662426305352873  E_coul = 1.028621059376338
cycle= 2 E= -2.83762157115895  delta_E= -1.71e-06  |g|= 0.00041  |ddm|=  725
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904507085403059  LUMO = 1.59085828312971
  mo_energy =
[-0.90450709  1.59085828  7.49463314 17.8879012  35.60070773 60.61694366]
E1 = -3.866242195131656  E_coul = 1.0286191586080244
cycle= 3 E= -2.83762303652363  delta_E= -1.47e-06  |g|= 0.00014  |ddm|= 72.2
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904500872275087  LUMO = 1.5908308586313
  mo_energy =
[-0.90450087  1.59083086  7.49447939 17.88732215 35.59976479 60.6147689 ]
E1 = -3.866247053734337  E_coul = 1.0286262141741132
cycle= 4 E= -2.83762083956022  delta_E= 2.2e-06  |g|= 0.000231  |ddm|=   48
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.90449726833419  LUMO = 1.5908791652132
  mo_energy =
[-0.90449727  1.59087917  7.49472078 17.88817485 35.60113954 60.61779647]
E1 = -3.8662427289382126  E_coul = 1.0286203740130155
cycle= 5 E= -2.8376223549252  delta_E= -1.52e-06  |g|= 0.000137  |ddm|= 60.6
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499297047795  LUMO = 1.59086267091739
  mo_energy =
[-0.9044993   1.59086267  7.49464013 17.88789866 35.60069739 60.61682581]
E1 = -3.86624397366592  E_coul = 1.0286224065204694
cycle= 6 E= -2.83762156714545  delta_E= 7.88e-07  |g|= 7.61e-06  |ddm|= 18.7
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90449940673667  LUMO = 1.59086338273265
  mo_energy =
[-0.90449941  1.59086338  7.49464505 17.88790449 35.60069529 60.61674716]
E1 = -3.8662439001710256  E_coul = 1.0286226582934304
cycle= 7 E= -2.8376212418776  delta_E= 3.25e-07  |g|= 3.57e-05  |ddm|= 0.377
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499377381846  LUMO = 1.59086524062905
  mo_energy =
[-0.90449938  1.59086524  7.49465431 17.88793397 35.60073897 60.61685809]
E1 = -3.8662437039446083  E_coul = 1.0286193169728188
cycle= 8 E= -2.83762438697179  delta_E= -3.15e-06  |g|= 0.000264  |ddm|= 2.44
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500003416599  LUMO = 1.59085447027197
  mo_energy =
[-0.9045      1.59085447  7.49459997 17.88774606 35.6004392  60.61619807]
E1 = -3.8662447064310617  E_coul = 1.028624772720747
cycle= 9 E= -2.83761993371031  delta_E= 4.45e-06  |g|= 0.00021  |ddm|= 13.7
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499640364738  LUMO = 1.59086044032492
  mo_energy =
[-0.90449964  1.59086044  7.49462957 17.88785476 35.60061938 60.61663353]
E1 = -3.8662441372561087  E_coul = 1.0286228613878607
cycle= 10 E= -2.83762127586825  delta_E= -1.34e-06  |g|= 4.67e-05  |ddm|= 8.06
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499242031659  LUMO = 1.59086498459791
  mo_energy =
[-0.90449924  1.59086498  7.49465194 17.8879351  35.600751   60.61693336]
E1 = -3.8662437418771547  E_coul = 1.0286212900017715
cycle= 11 E= -2.83762245187538  delta_E= -1.18e-06  |g|= 7.68e-05  |ddm|= 5.73
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499274354714  LUMO = 1.59086397931069
  mo_energy =
[-0.90449927  1.59086398  7.49464644 17.88792016 35.60073165 60.61691634]
E1 = -3.8662438297239117  E_coul = 1.0286220923235445
cycle= 12 E= -2.83762173740037  delta_E= 7.14e-07  |g|= 1.95e-05  |ddm|= 1.02
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499500563261  LUMO = 1.59086348030863
  mo_energy =
[-0.9044995   1.59086348  7.49464425 17.88791112 35.600715   60.61687876]
E1 = -3.8662438224358837  E_coul = 1.0286212549519782
cycle= 13 E= -2.83762256748391  delta_E= -8.3e-07  |g|= 9.65e-05  |ddm|= 0.295
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499030931353  LUMO = 1.59087160995511
  mo_energy =
[-0.90449903  1.59087161  7.49468525 17.8880573  35.60095285 60.61741786]
E1 = -3.8662430593957144  E_coul = 1.0286204240870773
cycle= 14 E= -2.83762263530864  delta_E= -6.78e-08  |g|= 0.000138  |ddm|= 10.6
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499104058393  LUMO = 1.59087007610577
  mo_energy =
[-0.9044991   1.59087008  7.49467744 17.88802915 35.60090651 60.61731454]
E1 = -3.8662432076070736  E_coul = 1.0286198755138036
cycle= 15 E= -2.83762333209327  delta_E= -6.97e-07  |g|= 0.000201  |ddm|= 2.05
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499207020604  LUMO = 1.5908681847331
  mo_energy =
[-0.90449921  1.59086818  7.49466784 17.88799807 35.60085931 60.61721402]
E1 = -3.8662433819168793  E_coul = 1.0286221075642838
cycle= 16 E= -2.8376212743526  delta_E= 2.06e-06  |g|= 4.66e-06  |ddm|=  2.3
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498915854475  LUMO = 1.59087372121645
  mo_energy =
[-0.90449892  1.59087372  7.49469577 17.88809513 35.60101456 60.61756   ]
E1 = -3.866242856016256  E_coul = 1.0286201085571536
cycle= 17 E= -2.8376227474591  delta_E= -1.47e-06  |g|= 0.000167  |ddm|= 7.17
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499376878083  LUMO = 1.59086489851706
  mo_energy =
[-0.90449938  1.5908649   7.4946516  17.8879334  35.60074768 60.61691356]
E1 = -3.8662437145742095  E_coul = 1.0286203804409755
cycle= 18 E= -2.83762333413323  delta_E= -5.87e-07  |g|= 0.000166  |ddm|=   12
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90450014732791  LUMO = 1.59085090948437
  mo_energy =
[-0.90450015  1.59085091  7.49458279 17.88767207 35.60030998 60.61583633]
E1 = -3.8662450960713834  E_coul = 1.0286225352772302
cycle= 19 E= -2.83762256079415  delta_E= 7.73e-07  |g|= 1.86e-05  |ddm|= 19.6
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90450034040902  LUMO = 1.59084693818257
  mo_energy =
[-0.90450034  1.59084694  7.49456218 17.88761131 35.60022254 60.61568261]
E1 = -3.8662454499686265  E_coul = 1.0286242939685482
cycle= 20 E= -2.83762115600008  delta_E= 1.4e-06  |g|= 0.000123  |ddm|= 4.43
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500104698457  LUMO = 1.59085158142766
  mo_energy =
[-0.9045001   1.59085158  7.4945853  17.88768921 35.60034367 60.61597457]
E1 = -3.866245003049514  E_coul = 1.0286215215064878
cycle= 21 E= -2.83762348154303  delta_E= -2.33e-06  |g|= 0.000105  |ddm|= 5.97
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500332227787  LUMO = 1.59084658153834
  mo_energy =
[-0.90450033  1.59084658  7.49455903 17.88760957 35.60022823 60.61578393]
E1 = -3.866245452959017  E_coul = 1.0286211995739252
cycle= 22 E= -2.83762425338509  delta_E= -7.72e-07  |g|= 0.00017  |ddm|= 5.68
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500609465899  LUMO = 1.59084177011391
  mo_energy =
[-0.90450061  1.59084177  7.49453563 17.88751698 35.60006872 60.61536296]
E1 = -3.866245934418878  E_coul = 1.0286226745278466
cycle= 23 E= -2.83762325989103  delta_E= 9.93e-07  |g|= 4.59e-05  |ddm|=    7
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500531205656  LUMO = 1.59084342521718
  mo_energy =
[-0.90450053  1.59084343  7.49454431 17.88754492 35.60011124 60.61544257]
E1 = -3.866245783134924  E_coul = 1.0286235066478784
cycle= 24 E= -2.83762227648705  delta_E= 9.83e-07  |g|= 3.82e-05  |ddm|= 1.99
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90450078051722  LUMO = 1.5908388824614
  mo_energy =
[-0.90450078  1.59083888  7.49452173 17.8874647  35.59998101 60.61512955]
E1 = -3.8662462204714423  E_coul = 1.0286225556908066
cycle= 25 E= -2.83762366478064  delta_E= -1.39e-06  |g|= 6.12e-05  |ddm|= 6.04
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500856384446  LUMO = 1.59083654275841
  mo_energy =
[-0.90450086  1.59083654  7.49450949 17.88742802 35.59993109 60.61504013]
E1 = -3.8662464422110334  E_coul = 1.0286240909639857
cycle= 26 E= -2.83762235124705  delta_E= 1.31e-06  |g|= 6.01e-05  |ddm|= 2.73
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500670487097  LUMO = 1.59083870574335
  mo_energy =
[-0.90450067  1.59083871  7.49451692 17.88748149 35.60004243 60.61550428]
E1 = -3.8662461595897395  E_coul = 1.028624311707335
cycle= 27 E= -2.8376218478824  delta_E= 5.03e-07  |g|= 9.68e-05  |ddm|= 4.83
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501183077138  LUMO = 1.59082911958073
  mo_energy =
[-0.90450118  1.59082912  7.49446896 17.8873     35.5997379  60.6148014 ]
E1 = -3.8662470923198304  E_coul = 1.0286254190437916
cycle= 28 E= -2.83762167327604  delta_E= 1.75e-07  |g|= 0.000147  |ddm|= 13.3
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904502318855057  LUMO = 1.5908065265139
  mo_energy =
[-0.90450232  1.59080653  7.49435248 17.88692845 35.59917912 60.61372165]
E1 = -3.866249164808116  E_coul = 1.028627545652888
cycle= 29 E= -2.83762161915523  delta_E= 5.41e-08  |g|= 0.000243  |ddm|=   27
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501599732017  LUMO = 1.59082106660152
  mo_energy =
[-0.9045016   1.59082107  7.49442783 17.88717797 35.59956451 60.61448079]
E1 = -3.8662478202728447  E_coul = 1.0286237856276543
cycle= 30 E= -2.83762403464519  delta_E= -2.42e-06  |g|= 3.31e-05  |ddm|= 17.9
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500815167604  LUMO = 1.59083548416717
  mo_energy =
[-0.90450082  1.59083548  7.49449949 17.88744599 35.60001101 60.61557978]
E1 = -3.866246410543946  E_coul = 1.0286245496923088
cycle= 31 E= -2.83762186085164  delta_E= 2.17e-06  |g|= 9.07e-05  |ddm|=   20
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500422472318  LUMO = 1.59084306979046
  mo_energy =
[-0.90450042  1.59084307  7.49453712 17.88758052 35.60022723 60.61607683]
E1 = -3.8662456749654734  E_coul = 1.0286231521783542
cycle= 32 E= -2.83762252278712  delta_E= -6.62e-07  |g|= 1.24e-05  |ddm|= 10.1
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500558639029  LUMO = 1.59084155044413
  mo_energy =
[-0.90450056  1.59084155  7.49453059 17.88754266 35.60015224 60.6158445 ]
E1 = -3.8662458471650782  E_coul = 1.0286247238145974
cycle= 33 E= -2.83762112335048  delta_E= 1.4e-06  |g|= 0.00013  |ddm|=  2.9
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499722663091  LUMO = 1.59085874342197
  mo_energy =
[-0.90449972  1.59085874  7.49461887 17.88782699 35.6005813  60.6166753 ]
E1 = -3.866244256036375  E_coul = 1.0286206426431106
cycle= 34 E= -2.83762361339326  delta_E= -2.49e-06  |g|= 0.000159  |ddm|= 20.8
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500546961107  LUMO = 1.59084249211602
  mo_energy =
[-0.90450055  1.59084249  7.49453544 17.88755552 35.60016519 60.61581951]
E1 = -3.866245755303155  E_coul = 1.028624139438967
cycle= 35 E= -2.83762161586419  delta_E= 2e-06  |g|= 8.37e-05  |ddm|= 19.8
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90450045692769  LUMO = 1.59084493571726
  mo_energy =
[-0.90450046  1.59084494  7.49454939 17.88758845 35.60020172 60.61579069]
E1 = -3.866245561619351  E_coul = 1.0286208163944301
cycle= 36 E= -2.83762474522492  delta_E= -3.13e-06  |g|= 0.000202  |ddm|= 2.05
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501017313739  LUMO = 1.5908334692173
  mo_energy =
[-0.90450102  1.59083347  7.49449017 17.88739716 35.59991101 60.61521327]
E1 = -3.866246619857425  E_coul = 1.0286245176840152
cycle= 37 E= -2.83762210217341  delta_E= 2.64e-06  |g|= 9.22e-05  |ddm|= 13.9
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500793708681  LUMO = 1.59083762409921
  mo_energy =
[-0.90450079  1.59083762  7.49451097 17.8874706  35.60002812 60.61547646]
E1 = -3.8662462212732986  E_coul = 1.028623053811071
cycle= 38 E= -2.83762316746223  delta_E= -1.07e-06  |g|= 3.63e-05  |ddm|= 5.46
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501780947534  LUMO = 1.59081789290794
  mo_energy =
[-0.90450178  1.59081789  7.49441029 17.8871345  35.59950667 60.61437526]
E1 = -3.8662480699293176  E_coul = 1.0286256237628766
cycle= 39 E= -2.83762244616644  delta_E= 7.21e-07  |g|= 0.000118  |ddm|= 24.7
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501224986626  LUMO = 1.59082899633609
  mo_energy =
[-0.90450122  1.590829    7.49446711 17.88732174 35.59979514 60.61496804]
E1 = -3.8662470374786344  E_coul = 1.028625271001291
cycle= 40 E= -2.83762176647734  delta_E= 6.8e-07  |g|= 0.00015  |ddm|= 13.7
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90450129666115  LUMO = 1.59082746217244
  mo_energy =
[-0.9045013   1.59082746  7.49445938 17.88729727 35.59975812 60.61487776]
E1 = -3.866247181655376  E_coul = 1.028623507523702
cycle= 41 E= -2.83762367413167  delta_E= -1.91e-06  |g|= 4.16e-05  |ddm|= 1.88
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501506650281  LUMO = 1.59082288210035
  mo_energy =
[-0.90450151  1.59082288  7.49443546 17.8872244  35.59965276 60.61469641]
E1 = -3.866247596096911  E_coul = 1.0286269372774863
cycle= 42 E= -2.83762065881942  delta_E= 3.02e-06  |g|= 0.000264  |ddm|= 5.24
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501972833688  LUMO = 1.59081415334084
  mo_energy =
[-0.90450197  1.59081415  7.4943921  17.88706424 35.5993864  60.6140306 ]
E1 = -3.8662484505874315  E_coul = 1.0286275848033495
cycle= 43 E= -2.83762086578408  delta_E= -2.07e-07  |g|= 0.000284  |ddm|=   12
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904503203318454  LUMO = 1.5907893665156
  mo_energy =
[-0.9045032   1.59078937  7.49426405 17.88664908 35.59875355 60.61281715]
E1 = -3.8662507312206045  E_coul = 1.0286260048659572
cycle= 44 E= -2.83762472635465  delta_E= -3.86e-06  |g|= 4.39e-05  |ddm|=   30
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499025656894  LUMO = 1.59087231132557
  mo_energy =
[-0.90449903  1.59087231  7.49468987 17.88806042 35.6009402  60.6172912 ]
E1 = -3.8662430187116246  E_coul = 1.0286216473577021
cycle= 45 E= -2.83762137135392  delta_E= 3.36e-06  |g|= 2.43e-05  |ddm|=  103
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499343659937  LUMO = 1.59086649920778
  mo_energy =
[-0.90449934  1.5908665   7.49466236 17.88794586 35.60074089 60.61675177]
E1 = -3.86624362393724  E_coul = 1.0286218421530677
cycle= 46 E= -2.83762178178417  delta_E= -4.1e-07  |g|= 2.64e-05  |ddm|= 8.87
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499299765209  LUMO = 1.59086696816559
  mo_energy =
[-0.9044993   1.59086697  7.49466475 17.88795366 35.60075432 60.6167834 ]
E1 = -3.866243585265613  E_coul = 1.0286219552091551
cycle= 47 E= -2.83762163005646  delta_E= 1.52e-07  |g|= 1.46e-05  |ddm|= 0.539
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499380917986  LUMO = 1.59086508739136
  mo_energy =
[-0.90449938  1.59086509  7.49465456 17.88792268 35.60070896 60.61671994]
E1 = -3.8662437507906144  E_coul = 1.0286237009533636
cycle= 48 E= -2.83762004983725  delta_E= 1.58e-06  |g|= 0.000141  |ddm|=  2.1
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499164496805  LUMO = 1.59086931667234
  mo_energy =
[-0.90449916  1.59086932  7.49467628 17.88799293 35.60081579 60.61692915]
E1 = -3.8662433615381393  E_coul = 1.0286207564118686
cycle= 49 E= -2.83762260512627  delta_E= -2.56e-06  |g|= 0.000121  |ddm|= 5.11
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499285208121  LUMO = 1.59086698723836
  mo_energy =
[-0.90449929  1.59086699  7.49466438 17.88794921 35.6007429  60.61676943]
E1 = -3.866243584821254  E_coul = 1.0286208605205212
cycle= 50 E= -2.83762272430073  delta_E= -1.19e-07  |g|= 0.000114  |ddm|= 3.15
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.866243584821254  E_coul = 1.0286208605205212

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904500931969698  LUMO = 1.59084350825023
  mo_energy =
[-0.90450093  1.59084351  7.49454755 17.8875265  35.60004982 60.61516644]
E1 = -3.866245740510322  E_coul = 1.0286224041820649
Extra cycle  E= -2.83762333632826  delta_E= -6.12e-07  |g|= 5.16e-05  |ddm|= 30.7
    CPU time for scf_cycle      0.50 sec, wall time      0.50 sec
exp = [6.27387559 5.52991232 4.86582728 4.17694049 3.77319348 0.37675024]
E = -2.8376233363282575
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:40 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.27387559472        1
[INPUT] 0    0    [1    /1   ]  5.52991231537        1
[INPUT] 0    0    [1    /1   ]  4.86582727818        1
[INPUT] 0    0    [1    /1   ]  4.17694048964        1
[INPUT] 0    0    [1    /1   ]  3.77319347671        1
[INPUT] 0    0    [1    /1   ]  0.376750235978       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.273875594722907, 1.0]], [0, [5.52991231537197, 1.0]], [0, [4.865827278178212, 1.0]], [0, [4.176940489638526, 1.0]], [0, [3.7731934767069357, 1.0]], [0, [0.37675023597817464, 1.0]]]}
ecp = {}
CPU time:        37.70
Set gradient conv threshold to 3.16228e-05
cond(S) = 948813784.1430129

WARN: Singularity detected in overlap matrix (condition number = 9.49e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8566672003467133  E_coul = 1.024231165510319
init E= -2.83243603483639
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906686171380687  LUMO = 1.58690942762251
  mo_energy =
[-0.90668617  1.58690943  7.4897024  17.88267898 35.59516588 60.61107997]
E1 = -3.866470629029844  E_coul = 1.0288507701685836
cycle= 1 E= -2.83761985886126  delta_E= -0.00518  |g|= 0.00626  |ddm|= 1.3e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904385507503987  LUMO = 1.59090056714399
  mo_energy =
[-0.90438551  1.59090057  7.49477442 17.88804215 35.60082306 60.61689374]
E1 = -3.8662426305352873  E_coul = 1.028621059376338
cycle= 2 E= -2.83762157115895  delta_E= -1.71e-06  |g|= 0.00041  |ddm|=  725
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904507085403059  LUMO = 1.59085828312971
  mo_energy =
[-0.90450709  1.59085828  7.49463314 17.8879012  35.60070773 60.61694366]
E1 = -3.866242195131656  E_coul = 1.0286191586080244
cycle= 3 E= -2.83762303652363  delta_E= -1.47e-06  |g|= 0.00014  |ddm|= 72.2
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904500872275087  LUMO = 1.5908308586313
  mo_energy =
[-0.90450087  1.59083086  7.49447939 17.88732215 35.59976479 60.6147689 ]
E1 = -3.866247053734337  E_coul = 1.0286262141741132
cycle= 4 E= -2.83762083956022  delta_E= 2.2e-06  |g|= 0.000231  |ddm|=   48
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.90449726833419  LUMO = 1.5908791652132
  mo_energy =
[-0.90449727  1.59087917  7.49472078 17.88817485 35.60113954 60.61779647]
E1 = -3.8662427289382126  E_coul = 1.0286203740130155
cycle= 5 E= -2.8376223549252  delta_E= -1.52e-06  |g|= 0.000137  |ddm|= 60.6
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499297047795  LUMO = 1.59086267091739
  mo_energy =
[-0.9044993   1.59086267  7.49464013 17.88789866 35.60069739 60.61682581]
E1 = -3.86624397366592  E_coul = 1.0286224065204694
cycle= 6 E= -2.83762156714545  delta_E= 7.88e-07  |g|= 7.61e-06  |ddm|= 18.7
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90449940673667  LUMO = 1.59086338273265
  mo_energy =
[-0.90449941  1.59086338  7.49464505 17.88790449 35.60069529 60.61674716]
E1 = -3.8662439001710256  E_coul = 1.0286226582934304
cycle= 7 E= -2.8376212418776  delta_E= 3.25e-07  |g|= 3.57e-05  |ddm|= 0.377
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499377381846  LUMO = 1.59086524062905
  mo_energy =
[-0.90449938  1.59086524  7.49465431 17.88793397 35.60073897 60.61685809]
E1 = -3.8662437039446083  E_coul = 1.0286193169728188
cycle= 8 E= -2.83762438697179  delta_E= -3.15e-06  |g|= 0.000264  |ddm|= 2.44
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500003416599  LUMO = 1.59085447027197
  mo_energy =
[-0.9045      1.59085447  7.49459997 17.88774606 35.6004392  60.61619807]
E1 = -3.8662447064310617  E_coul = 1.028624772720747
cycle= 9 E= -2.83761993371031  delta_E= 4.45e-06  |g|= 0.00021  |ddm|= 13.7
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499640364738  LUMO = 1.59086044032492
  mo_energy =
[-0.90449964  1.59086044  7.49462957 17.88785476 35.60061938 60.61663353]
E1 = -3.8662441372561087  E_coul = 1.0286228613878607
cycle= 10 E= -2.83762127586825  delta_E= -1.34e-06  |g|= 4.67e-05  |ddm|= 8.06
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499242031659  LUMO = 1.59086498459791
  mo_energy =
[-0.90449924  1.59086498  7.49465194 17.8879351  35.600751   60.61693336]
E1 = -3.8662437418771547  E_coul = 1.0286212900017715
cycle= 11 E= -2.83762245187538  delta_E= -1.18e-06  |g|= 7.68e-05  |ddm|= 5.73
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499274354714  LUMO = 1.59086397931069
  mo_energy =
[-0.90449927  1.59086398  7.49464644 17.88792016 35.60073165 60.61691634]
E1 = -3.8662438297239117  E_coul = 1.0286220923235445
cycle= 12 E= -2.83762173740037  delta_E= 7.14e-07  |g|= 1.95e-05  |ddm|= 1.02
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499500563261  LUMO = 1.59086348030863
  mo_energy =
[-0.9044995   1.59086348  7.49464425 17.88791112 35.600715   60.61687876]
E1 = -3.8662438224358837  E_coul = 1.0286212549519782
cycle= 13 E= -2.83762256748391  delta_E= -8.3e-07  |g|= 9.65e-05  |ddm|= 0.295
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499030931353  LUMO = 1.59087160995511
  mo_energy =
[-0.90449903  1.59087161  7.49468525 17.8880573  35.60095285 60.61741786]
E1 = -3.8662430593957144  E_coul = 1.0286204240870773
cycle= 14 E= -2.83762263530864  delta_E= -6.78e-08  |g|= 0.000138  |ddm|= 10.6
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499104058393  LUMO = 1.59087007610577
  mo_energy =
[-0.9044991   1.59087008  7.49467744 17.88802915 35.60090651 60.61731454]
E1 = -3.8662432076070736  E_coul = 1.0286198755138036
cycle= 15 E= -2.83762333209327  delta_E= -6.97e-07  |g|= 0.000201  |ddm|= 2.05
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499207020604  LUMO = 1.5908681847331
  mo_energy =
[-0.90449921  1.59086818  7.49466784 17.88799807 35.60085931 60.61721402]
E1 = -3.8662433819168793  E_coul = 1.0286221075642838
cycle= 16 E= -2.8376212743526  delta_E= 2.06e-06  |g|= 4.66e-06  |ddm|=  2.3
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498915854475  LUMO = 1.59087372121645
  mo_energy =
[-0.90449892  1.59087372  7.49469577 17.88809513 35.60101456 60.61756   ]
E1 = -3.866242856016256  E_coul = 1.0286201085571536
cycle= 17 E= -2.8376227474591  delta_E= -1.47e-06  |g|= 0.000167  |ddm|= 7.17
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499376878083  LUMO = 1.59086489851706
  mo_energy =
[-0.90449938  1.5908649   7.4946516  17.8879334  35.60074768 60.61691356]
E1 = -3.8662437145742095  E_coul = 1.0286203804409755
cycle= 18 E= -2.83762333413323  delta_E= -5.87e-07  |g|= 0.000166  |ddm|=   12
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90450014732791  LUMO = 1.59085090948437
  mo_energy =
[-0.90450015  1.59085091  7.49458279 17.88767207 35.60030998 60.61583633]
E1 = -3.8662450960713834  E_coul = 1.0286225352772302
cycle= 19 E= -2.83762256079415  delta_E= 7.73e-07  |g|= 1.86e-05  |ddm|= 19.6
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90450034040902  LUMO = 1.59084693818257
  mo_energy =
[-0.90450034  1.59084694  7.49456218 17.88761131 35.60022254 60.61568261]
E1 = -3.8662454499686265  E_coul = 1.0286242939685482
cycle= 20 E= -2.83762115600008  delta_E= 1.4e-06  |g|= 0.000123  |ddm|= 4.43
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500104698457  LUMO = 1.59085158142766
  mo_energy =
[-0.9045001   1.59085158  7.4945853  17.88768921 35.60034367 60.61597457]
E1 = -3.866245003049514  E_coul = 1.0286215215064878
cycle= 21 E= -2.83762348154303  delta_E= -2.33e-06  |g|= 0.000105  |ddm|= 5.97
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500332227787  LUMO = 1.59084658153834
  mo_energy =
[-0.90450033  1.59084658  7.49455903 17.88760957 35.60022823 60.61578393]
E1 = -3.866245452959017  E_coul = 1.0286211995739252
cycle= 22 E= -2.83762425338509  delta_E= -7.72e-07  |g|= 0.00017  |ddm|= 5.68
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500609465899  LUMO = 1.59084177011391
  mo_energy =
[-0.90450061  1.59084177  7.49453563 17.88751698 35.60006872 60.61536296]
E1 = -3.866245934418878  E_coul = 1.0286226745278466
cycle= 23 E= -2.83762325989103  delta_E= 9.93e-07  |g|= 4.59e-05  |ddm|=    7
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500531205656  LUMO = 1.59084342521718
  mo_energy =
[-0.90450053  1.59084343  7.49454431 17.88754492 35.60011124 60.61544257]
E1 = -3.866245783134924  E_coul = 1.0286235066478784
cycle= 24 E= -2.83762227648705  delta_E= 9.83e-07  |g|= 3.82e-05  |ddm|= 1.99
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90450078051722  LUMO = 1.5908388824614
  mo_energy =
[-0.90450078  1.59083888  7.49452173 17.8874647  35.59998101 60.61512955]
E1 = -3.8662462204714423  E_coul = 1.0286225556908066
cycle= 25 E= -2.83762366478064  delta_E= -1.39e-06  |g|= 6.12e-05  |ddm|= 6.04
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500856384446  LUMO = 1.59083654275841
  mo_energy =
[-0.90450086  1.59083654  7.49450949 17.88742802 35.59993109 60.61504013]
E1 = -3.8662464422110334  E_coul = 1.0286240909639857
cycle= 26 E= -2.83762235124705  delta_E= 1.31e-06  |g|= 6.01e-05  |ddm|= 2.73
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500670487097  LUMO = 1.59083870574335
  mo_energy =
[-0.90450067  1.59083871  7.49451692 17.88748149 35.60004243 60.61550428]
E1 = -3.8662461595897395  E_coul = 1.028624311707335
cycle= 27 E= -2.8376218478824  delta_E= 5.03e-07  |g|= 9.68e-05  |ddm|= 4.83
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501183077138  LUMO = 1.59082911958073
  mo_energy =
[-0.90450118  1.59082912  7.49446896 17.8873     35.5997379  60.6148014 ]
E1 = -3.8662470923198304  E_coul = 1.0286254190437916
cycle= 28 E= -2.83762167327604  delta_E= 1.75e-07  |g|= 0.000147  |ddm|= 13.3
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904502318855057  LUMO = 1.5908065265139
  mo_energy =
[-0.90450232  1.59080653  7.49435248 17.88692845 35.59917912 60.61372165]
E1 = -3.866249164808116  E_coul = 1.028627545652888
cycle= 29 E= -2.83762161915523  delta_E= 5.41e-08  |g|= 0.000243  |ddm|=   27
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501599732017  LUMO = 1.59082106660152
  mo_energy =
[-0.9045016   1.59082107  7.49442783 17.88717797 35.59956451 60.61448079]
E1 = -3.8662478202728447  E_coul = 1.0286237856276543
cycle= 30 E= -2.83762403464519  delta_E= -2.42e-06  |g|= 3.31e-05  |ddm|= 17.9
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500815167604  LUMO = 1.59083548416717
  mo_energy =
[-0.90450082  1.59083548  7.49449949 17.88744599 35.60001101 60.61557978]
E1 = -3.866246410543946  E_coul = 1.0286245496923088
cycle= 31 E= -2.83762186085164  delta_E= 2.17e-06  |g|= 9.07e-05  |ddm|=   20
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500422472318  LUMO = 1.59084306979046
  mo_energy =
[-0.90450042  1.59084307  7.49453712 17.88758052 35.60022723 60.61607683]
E1 = -3.8662456749654734  E_coul = 1.0286231521783542
cycle= 32 E= -2.83762252278712  delta_E= -6.62e-07  |g|= 1.24e-05  |ddm|= 10.1
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500558639029  LUMO = 1.59084155044413
  mo_energy =
[-0.90450056  1.59084155  7.49453059 17.88754266 35.60015224 60.6158445 ]
E1 = -3.8662458471650782  E_coul = 1.0286247238145974
cycle= 33 E= -2.83762112335048  delta_E= 1.4e-06  |g|= 0.00013  |ddm|=  2.9
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499722663091  LUMO = 1.59085874342197
  mo_energy =
[-0.90449972  1.59085874  7.49461887 17.88782699 35.6005813  60.6166753 ]
E1 = -3.866244256036375  E_coul = 1.0286206426431106
cycle= 34 E= -2.83762361339326  delta_E= -2.49e-06  |g|= 0.000159  |ddm|= 20.8
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500546961107  LUMO = 1.59084249211602
  mo_energy =
[-0.90450055  1.59084249  7.49453544 17.88755552 35.60016519 60.61581951]
E1 = -3.866245755303155  E_coul = 1.028624139438967
cycle= 35 E= -2.83762161586419  delta_E= 2e-06  |g|= 8.37e-05  |ddm|= 19.8
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90450045692769  LUMO = 1.59084493571726
  mo_energy =
[-0.90450046  1.59084494  7.49454939 17.88758845 35.60020172 60.61579069]
E1 = -3.866245561619351  E_coul = 1.0286208163944301
cycle= 36 E= -2.83762474522492  delta_E= -3.13e-06  |g|= 0.000202  |ddm|= 2.05
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501017313739  LUMO = 1.5908334692173
  mo_energy =
[-0.90450102  1.59083347  7.49449017 17.88739716 35.59991101 60.61521327]
E1 = -3.866246619857425  E_coul = 1.0286245176840152
cycle= 37 E= -2.83762210217341  delta_E= 2.64e-06  |g|= 9.22e-05  |ddm|= 13.9
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500793708681  LUMO = 1.59083762409921
  mo_energy =
[-0.90450079  1.59083762  7.49451097 17.8874706  35.60002812 60.61547646]
E1 = -3.8662462212732986  E_coul = 1.028623053811071
cycle= 38 E= -2.83762316746223  delta_E= -1.07e-06  |g|= 3.63e-05  |ddm|= 5.46
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501780947534  LUMO = 1.59081789290794
  mo_energy =
[-0.90450178  1.59081789  7.49441029 17.8871345  35.59950667 60.61437526]
E1 = -3.8662480699293176  E_coul = 1.0286256237628766
cycle= 39 E= -2.83762244616644  delta_E= 7.21e-07  |g|= 0.000118  |ddm|= 24.7
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501224986626  LUMO = 1.59082899633609
  mo_energy =
[-0.90450122  1.590829    7.49446711 17.88732174 35.59979514 60.61496804]
E1 = -3.8662470374786344  E_coul = 1.028625271001291
cycle= 40 E= -2.83762176647734  delta_E= 6.8e-07  |g|= 0.00015  |ddm|= 13.7
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90450129666115  LUMO = 1.59082746217244
  mo_energy =
[-0.9045013   1.59082746  7.49445938 17.88729727 35.59975812 60.61487776]
E1 = -3.866247181655376  E_coul = 1.028623507523702
cycle= 41 E= -2.83762367413167  delta_E= -1.91e-06  |g|= 4.16e-05  |ddm|= 1.88
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501506650281  LUMO = 1.59082288210035
  mo_energy =
[-0.90450151  1.59082288  7.49443546 17.8872244  35.59965276 60.61469641]
E1 = -3.866247596096911  E_coul = 1.0286269372774863
cycle= 42 E= -2.83762065881942  delta_E= 3.02e-06  |g|= 0.000264  |ddm|= 5.24
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501972833688  LUMO = 1.59081415334084
  mo_energy =
[-0.90450197  1.59081415  7.4943921  17.88706424 35.5993864  60.6140306 ]
E1 = -3.8662484505874315  E_coul = 1.0286275848033495
cycle= 43 E= -2.83762086578408  delta_E= -2.07e-07  |g|= 0.000284  |ddm|=   12
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904503203318454  LUMO = 1.5907893665156
  mo_energy =
[-0.9045032   1.59078937  7.49426405 17.88664908 35.59875355 60.61281715]
E1 = -3.8662507312206045  E_coul = 1.0286260048659572
cycle= 44 E= -2.83762472635465  delta_E= -3.86e-06  |g|= 4.39e-05  |ddm|=   30
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499025656894  LUMO = 1.59087231132557
  mo_energy =
[-0.90449903  1.59087231  7.49468987 17.88806042 35.6009402  60.6172912 ]
E1 = -3.8662430187116246  E_coul = 1.0286216473577021
cycle= 45 E= -2.83762137135392  delta_E= 3.36e-06  |g|= 2.43e-05  |ddm|=  103
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499343659937  LUMO = 1.59086649920778
  mo_energy =
[-0.90449934  1.5908665   7.49466236 17.88794586 35.60074089 60.61675177]
E1 = -3.86624362393724  E_coul = 1.0286218421530677
cycle= 46 E= -2.83762178178417  delta_E= -4.1e-07  |g|= 2.64e-05  |ddm|= 8.87
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499299765209  LUMO = 1.59086696816559
  mo_energy =
[-0.9044993   1.59086697  7.49466475 17.88795366 35.60075432 60.6167834 ]
E1 = -3.866243585265613  E_coul = 1.0286219552091551
cycle= 47 E= -2.83762163005646  delta_E= 1.52e-07  |g|= 1.46e-05  |ddm|= 0.539
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499380917986  LUMO = 1.59086508739136
  mo_energy =
[-0.90449938  1.59086509  7.49465456 17.88792268 35.60070896 60.61671994]
E1 = -3.8662437507906144  E_coul = 1.0286237009533636
cycle= 48 E= -2.83762004983725  delta_E= 1.58e-06  |g|= 0.000141  |ddm|=  2.1
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499164496805  LUMO = 1.59086931667234
  mo_energy =
[-0.90449916  1.59086932  7.49467628 17.88799293 35.60081579 60.61692915]
E1 = -3.8662433615381393  E_coul = 1.0286207564118686
cycle= 49 E= -2.83762260512627  delta_E= -2.56e-06  |g|= 0.000121  |ddm|= 5.11
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499285208121  LUMO = 1.59086698723836
  mo_energy =
[-0.90449929  1.59086699  7.49466438 17.88794921 35.6007429  60.61676943]
E1 = -3.866243584821254  E_coul = 1.0286208605205212
cycle= 50 E= -2.83762272430073  delta_E= -1.19e-07  |g|= 0.000114  |ddm|= 3.15
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.866243584821254  E_coul = 1.0286208605205212

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904500931969698  LUMO = 1.59084350825023
  mo_energy =
[-0.90450093  1.59084351  7.49454755 17.8875265  35.60004982 60.61516644]
E1 = -3.866245740510322  E_coul = 1.0286224041820649
Extra cycle  E= -2.83762333632826  delta_E= -6.12e-07  |g|= 5.16e-05  |ddm|= 30.7
    CPU time for scf_cycle      0.49 sec, wall time      0.49 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 948813784.1430129

WARN: Singularity detected in overlap matrix (condition number = 9.49e+08). SCF may be inaccurate and hard to converge.

E1 = -3.866245740510322  E_coul = 1.0286224041820649
init E= -2.83762333632826
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.904500466115742  LUMO = 1.59083157519539
  mo_energy =
[-0.90450047  1.59083158  7.49448195 17.88732898 35.59976295 60.61469656]
E1 = -3.8662470721924076  E_coul = 1.0286239315359882
cycle= 1 E= -2.83762314065642  delta_E= 1.96e-07  |g|= 2.7e-05  |ddm|= 15.5
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904499604569993  LUMO = 1.59083493343317
  mo_energy =
[-0.9044996   1.59083493  7.49449595 17.88740823 35.59992941 60.61517067]
E1 = -3.8662468767222147  E_coul = 1.0286273769750078
cycle= 2 E= -2.83761949974721  delta_E= 3.64e-06  |g|= 0.000322  |ddm|= 5.03
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904496064150374  LUMO = 1.59090650435752
  mo_energy =
[-0.90449606  1.5909065   7.49486318 17.88861057 35.60177517 60.6189209 ]
E1 = -3.866240227804732  E_coul = 1.028617861301699
cycle= 3 E= -2.83762236650303  delta_E= -2.87e-06  |g|= 0.000252  |ddm|= 87.9
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498413133991  LUMO = 1.59086598685363
  mo_energy =
[-0.90449841  1.59086599  7.49465611 17.88793344 35.60073513 60.61681064]
E1 = -3.866243898496933  E_coul = 1.0286225229999484
cycle= 4 E= -2.83762137549699  delta_E= 9.91e-07  |g|= 1.57e-05  |ddm|=   49
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498363443958  LUMO = 1.59086739002666
  mo_energy =
[-0.90449836  1.59086739  7.49466316 17.88795793 35.60077513 60.61691058]
E1 = -3.8662437570668193  E_coul = 1.028620601180465
cycle= 5 E= -2.83762315588635  delta_E= -1.78e-06  |g|= 0.000153  |ddm|=  1.9
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498640350393  LUMO = 1.59086219582205
  mo_energy =
[-0.90449864  1.5908622   7.49463623 17.88786744 35.60063312 60.61662513]
E1 = -3.8662442326156743  E_coul = 1.028622790445079
cycle= 6 E= -2.8376214421706  delta_E= 1.71e-06  |g|= 2.7e-05  |ddm|= 6.42
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498581444821  LUMO = 1.59086364553725
  mo_energy =
[-0.90449858  1.59086365  7.49464354 17.88789269 35.60067255 60.61670939]
E1 = -3.866244089248408  E_coul = 1.0286230546293593
cycle= 7 E= -2.83762103461905  delta_E= 4.08e-07  |g|= 7.02e-05  |ddm|= 1.91
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498489661141  LUMO = 1.59086567237161
  mo_energy =
[-0.90449849  1.59086567  7.4946537  17.88793358 35.6007442  60.61689166]
E1 = -3.8662438826557306  E_coul = 1.0286213280573582
cycle= 8 E= -2.83762255459837  delta_E= -1.52e-06  |g|= 0.000105  |ddm|= 3.02
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498603120673  LUMO = 1.5908639961153
  mo_energy =
[-0.9044986   1.590864    7.49464565 17.88790129 35.60068804 60.6167406 ]
E1 = -3.8662440475645274  E_coul = 1.0286214130620122
cycle= 9 E= -2.83762263450252  delta_E= -7.99e-08  |g|= 9.21e-05  |ddm|= 2.44
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904497888684084  LUMO = 1.59087752854733
  mo_energy =
[-0.90449789  1.59087753  7.49471536 17.88812466 35.60102601 60.61739763]
E1 = -3.8662428170191694  E_coul = 1.028619855226797
cycle= 10 E= -2.83762296179237  delta_E= -3.27e-07  |g|= 0.000181  |ddm|= 16.2
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498975642151  LUMO = 1.59085992604851
  mo_energy =
[-0.90449898  1.59085993  7.49462545 17.88782892 35.60056982 60.61647103]
E1 = -3.866244395351028  E_coul = 1.0286215587773833
cycle= 11 E= -2.83762283657364  delta_E= 1.25e-07  |g|= 9.64e-05  |ddm|= 21.2
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498711257583  LUMO = 1.59086798561489
  mo_energy =
[-0.90449871  1.59086799  7.49467103 17.88795121 35.60073002 60.61665685]
E1 = -3.8662437030731516  E_coul = 1.0286221627207732
cycle= 12 E= -2.83762154035238  delta_E= 1.3e-06  |g|= 2.64e-06  |ddm|= 8.13
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498489522326  LUMO = 1.59087313623223
  mo_energy =
[-0.90449849  1.59087314  7.49469767 17.8880387  35.60086455 60.61693109]
E1 = -3.8662432159816125  E_coul = 1.0286204837825148
cycle= 13 E= -2.8376227321991  delta_E= -1.19e-06  |g|= 0.000134  |ddm|= 6.38
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498551470793  LUMO = 1.59087045084108
  mo_energy =
[-0.90449855  1.59087045  7.49468288 17.88799562 35.60080514 60.61685847]
E1 = -3.8662434631271014  E_coul = 1.0286210876583823
cycle= 14 E= -2.83762237546872  delta_E= 3.57e-07  |g|= 8.02e-05  |ddm|= 2.96
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498862786179  LUMO = 1.59086574921265
  mo_energy =
[-0.90449886  1.59086575  7.49465968 17.88791437 35.60067575 60.61657296]
E1 = -3.866243898978596  E_coul = 1.0286214322976808
cycle= 15 E= -2.83762246668091  delta_E= -9.12e-08  |g|= 6.85e-05  |ddm|= 6.03
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499398953219  LUMO = 1.59085582476097
  mo_energy =
[-0.9044994   1.59085582  7.49460716 17.88773942 35.600399   60.61604035]
E1 = -3.86624478602365  E_coul = 1.028622131692746
cycle= 16 E= -2.8376226543309  delta_E= -1.88e-07  |g|= 3.92e-05  |ddm|= 12.1
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499727448974  LUMO = 1.59084900723185
  mo_energy =
[-0.90449973  1.59084901  7.49457092 17.88764843 35.60029104 60.61593753]
E1 = -3.866245359661401  E_coul = 1.0286226029969008
cycle= 17 E= -2.8376227566645  delta_E= -1.02e-07  |g|= 3.79e-05  |ddm|= 6.54
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499921965742  LUMO = 1.59084586845728
  mo_energy =
[-0.90449992  1.59084587  7.49455518 17.88758546 35.60018202 60.61564855]
E1 = -3.8662456679416017  E_coul = 1.0286226280561666
cycle= 18 E= -2.83762303988544  delta_E= -2.83e-07  |g|= 4.3e-05  |ddm|= 4.58
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500163536582  LUMO = 1.59084065500457
  mo_energy =
[-0.90450016  1.59084066  7.49452792 17.88749412 35.60003819 60.61535259]
E1 = -3.8662461566361825  E_coul = 1.028624279703532
cycle= 19 E= -2.83762187693265  delta_E= 1.16e-06  |g|= 8.59e-05  |ddm|= 6.55
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499807852369  LUMO = 1.59084749946336
  mo_energy =
[-0.90449981  1.5908475   7.49456331 17.88761343 35.60022492 60.6157187 ]
E1 = -3.8662455254172543  E_coul = 1.0286234151703157
cycle= 20 E= -2.83762211024694  delta_E= -2.33e-07  |g|= 3.13e-05  |ddm|= 8.49
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499769706961  LUMO = 1.59084816755606
  mo_energy =
[-0.90449977  1.59084817  7.49456674 17.88762218 35.60023551 60.61572929]
E1 = -3.866245468041352  E_coul = 1.0286215881640701
cycle= 21 E= -2.83762387987728  delta_E= -1.77e-06  |g|= 0.000124  |ddm|= 0.663
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499981537831  LUMO = 1.59084392358485
  mo_energy =
[-0.90449998  1.59084392  7.49454476 17.88755295 35.6001321  60.61553011]
E1 = -3.8662458552519032  E_coul = 1.0286240998320217
cycle= 22 E= -2.83762175541988  delta_E= 2.12e-06  |g|= 8.62e-05  |ddm|= 5.02
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499869021223  LUMO = 1.59084575614956
  mo_energy =
[-0.90449987  1.59084576  7.49455332 17.88758826 35.600194   60.61570908]
E1 = -3.866245666784854  E_coul = 1.0286238969811223
cycle= 23 E= -2.83762176980373  delta_E= -1.44e-08  |g|= 7.37e-05  |ddm|= 2.78
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499922613293  LUMO = 1.59084486909384
  mo_energy =
[-0.90449992  1.59084487  7.49454924 17.88757492 35.60017417 60.61565197]
E1 = -3.8662457533040797  E_coul = 1.0286246301294641
cycle= 24 E= -2.83762112317462  delta_E= 6.47e-07  |g|= 0.000138  |ddm|= 1.13
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500139282796  LUMO = 1.59084100349634
  mo_energy =
[-0.90450014  1.590841    7.49452966 17.88749982 35.60004643 60.61533095]
E1 = -3.866246127797655  E_coul = 1.0286236865384262
cycle= 25 E= -2.83762244125923  delta_E= -1.32e-06  |g|= 2.99e-05  |ddm|= 5.43
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499990021447  LUMO = 1.59084348154815
  mo_energy =
[-0.90449999  1.59084348  7.49454167 17.88754799 35.60012879 60.61553483]
E1 = -3.8662458817208822  E_coul = 1.028623066413429
cycle= 26 E= -2.83762281530745  delta_E= -3.74e-07  |g|= 1.06e-05  |ddm|= 3.59
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499834499934  LUMO = 1.59084633976781
  mo_energy =
[-0.90449983  1.59084634  7.49455632 17.88759843 35.60020941 60.61570204]
E1 = -3.866245616577931  E_coul = 1.0286231316649823
cycle= 27 E= -2.83762248491295  delta_E= 3.3e-07  |g|= 5.37e-06  |ddm|= 3.62
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499824834811  LUMO = 1.59084660976001
  mo_energy =
[-0.90449982  1.59084661  7.49455838 17.88760086 35.60020901 60.61566606]
E1 = -3.8662456081942125  E_coul = 1.028623921523836
cycle= 28 E= -2.83762168667038  delta_E= 7.98e-07  |g|= 8.46e-05  |ddm|= 0.0304
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499829098837  LUMO = 1.59084607103562
  mo_energy =
[-0.90449983  1.59084607  7.49455449 17.88760904 35.60024486 60.6158332 ]
E1 = -3.8662456180997236  E_coul = 1.0286238098893201
cycle= 29 E= -2.8376218082104  delta_E= -1.22e-07  |g|= 5.43e-05  |ddm|= 0.697
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498833421564  LUMO = 1.59086602887363
  mo_energy =
[-0.90449883  1.59086603  7.49465777 17.88793989 35.60074541 60.61679745]
E1 = -3.866243791383259  E_coul = 1.0286231449003254
cycle= 30 E= -2.83762064648293  delta_E= 1.16e-06  |g|= 7.94e-05  |ddm|= 23.9
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499057387576  LUMO = 1.59086206119864
  mo_energy =
[-0.90449906  1.59086206  7.49463763 17.88786689 35.60062642 60.61655955]
E1 = -3.8662441618919376  E_coul = 1.0286220024306412
cycle= 31 E= -2.8376221594613  delta_E= -1.51e-06  |g|= 3.2e-05  |ddm|= 5.19
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499233943081  LUMO = 1.59085852456882
  mo_energy =
[-0.90449923  1.59085852  7.49461936 17.88780834 35.60053848 60.61639197]
E1 = -3.866244486056614  E_coul = 1.0286206740106272
cycle= 32 E= -2.83762381204599  delta_E= -1.65e-06  |g|= 0.00017  |ddm|= 4.23
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499607547827  LUMO = 1.59085133114087
  mo_energy =
[-0.90449961  1.59085133  7.49458265 17.88768456 35.60034438 60.61599553]
E1 = -3.866245157070759  E_coul = 1.0286225701996061
cycle= 33 E= -2.83762258687115  delta_E= 1.23e-06  |g|= 2.74e-05  |ddm|= 9.01
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499666613677  LUMO = 1.59085018305538
  mo_energy =
[-0.90449967  1.59085018  7.49457667 17.88766541 35.60031511 60.61594212]
E1 = -3.86624526114744  E_coul = 1.0286212878311576
cycle= 34 E= -2.83762397331628  delta_E= -1.39e-06  |g|= 0.000144  |ddm|= 1.36
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499860171437  LUMO = 1.59084641341384
  mo_energy =
[-0.90449986  1.59084641  7.49455746 17.88759946 35.60020985 60.61570793]
E1 = -3.8662456164873324  E_coul = 1.0286229040457509
cycle= 35 E= -2.83762271244158  delta_E= 1.26e-06  |g|= 1.55e-05  |ddm|= 4.83
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499906418127  LUMO = 1.59084585178097
  mo_energy =
[-0.90449991  1.59084585  7.49455494 17.88758761 35.60018801 60.61565286]
E1 = -3.866245674102472  E_coul = 1.028623184818926
cycle= 36 E= -2.83762248928355  delta_E= 2.23e-07  |g|= 5.31e-06  |ddm|= 0.907
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500055570172  LUMO = 1.59084316864652
  mo_energy =
[-0.90450006  1.59084317  7.4945422  17.88753373 35.60009308 60.61539358]
E1 = -3.866245952807272  E_coul = 1.028624739511345
cycle= 37 E= -2.83762121329593  delta_E= 1.28e-06  |g|= 0.000139  |ddm|= 4.13
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499879174558  LUMO = 1.59084616447359
  mo_energy =
[-0.90449988  1.59084616  7.49455732 17.88758991 35.60018765 60.61561468]
E1 = -3.866245666719878  E_coul = 1.0286240623426062
cycle= 38 E= -2.83762160437727  delta_E= -3.91e-07  |g|= 8.92e-05  |ddm|= 4.08
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499789874882  LUMO = 1.59084776430998
  mo_energy =
[-0.90449979  1.59084776  7.49456524 17.88761995 35.60023796 60.61573035]
E1 = -3.8662455106681057  E_coul = 1.0286212979005351
cycle= 39 E= -2.83762421276757  delta_E= -2.61e-06  |g|= 0.000159  |ddm|= 2.22
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500170609668  LUMO = 1.59084031117046
  mo_energy =
[-0.90450017  1.59084031  7.49452678 17.88749015 35.60003298 60.61531131]
E1 = -3.866246202706532  E_coul = 1.028623942459268
cycle= 40 E= -2.83762226024726  delta_E= 1.95e-06  |g|= 5.67e-05  |ddm|= 9.33
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500319049192  LUMO = 1.59083733037929
  mo_energy =
[-0.90450032  1.59083733  7.49451116 17.88743949 35.59995465 60.61515588]
E1 = -3.8662464738612963  E_coul = 1.0286249979438142
cycle= 41 E= -2.83762147591748  delta_E= 7.84e-07  |g|= 0.000137  |ddm|= 3.59
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500610154705  LUMO = 1.59083169073031
  mo_energy =
[-0.90450061  1.59083169  7.49448242 17.88734503 35.59980915 60.61485084]
E1 = -3.8662469986087276  E_coul = 1.0286251171696208
cycle= 42 E= -2.83762188143911  delta_E= -4.06e-07  |g|= 0.00013  |ddm|= 6.96
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500076018269  LUMO = 1.59084267051769
  mo_energy =
[-0.90450008  1.59084267  7.4945399  17.88752267 35.60007261 60.61531526]
E1 = -3.8662460111755634  E_coul = 1.0286237947768786
cycle= 43 E= -2.83762221639868  delta_E= -3.35e-07  |g|= 4.26e-05  |ddm|= 12.7
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500008205973  LUMO = 1.59084401336445
  mo_energy =
[-0.90450001  1.59084401  7.49454719 17.88754145 35.6000952  60.61531099]
E1 = -3.8662459010673467  E_coul = 1.028623774308891
cycle= 44 E= -2.83762212675846  delta_E= 8.96e-08  |g|= 5.07e-05  |ddm|= 1.24
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90450002038846  LUMO = 1.59084406079558
  mo_energy =
[-0.90450002  1.59084406  7.49454719 17.8875409  35.60009052 60.61529903]
E1 = -3.866245889265535  E_coul = 1.0286245806924093
cycle= 45 E= -2.83762130857313  delta_E= 8.18e-07  |g|= 0.000136  |ddm|= 0.0544
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500035457137  LUMO = 1.59084340969585
  mo_energy =
[-0.90450004  1.59084341  7.49454267 17.88753584 35.60009204 60.61537379]
E1 = -3.8662459212768603  E_coul = 1.0286246505710754
cycle= 46 E= -2.83762127070578  delta_E= 3.79e-08  |g|= 0.000129  |ddm|= 0.0776
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500112932049  LUMO = 1.5908420554019
  mo_energy =
[-0.90450011  1.59084206  7.49453591 17.8875044  35.60003225 60.61521885]
E1 = -3.8662460602566138  E_coul = 1.0286228452367636
cycle= 47 E= -2.83762321501985  delta_E= -1.94e-06  |g|= 3.26e-05  |ddm|= 2.24
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499376749854  LUMO = 1.59085658629994
  mo_energy =
[-0.90449938  1.59085659  7.49461113 17.88775379 35.60042208 60.61601508]
E1 = -3.866244718204108  E_coul = 1.0286221469494556
cycle= 48 E= -2.83762257125465  delta_E= 6.44e-07  |g|= 4.16e-05  |ddm|= 17.9
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90449952274559  LUMO = 1.59085301032781
  mo_energy =
[-0.90449952  1.59085301  7.49459138 17.88770626 35.6003652  60.61596911]
E1 = -3.8662450124210266  E_coul = 1.028622118305464
cycle= 49 E= -2.83762289411556  delta_E= -3.23e-07  |g|= 6.03e-05  |ddm|= 3.24
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499664669377  LUMO = 1.59085003250458
  mo_energy =
[-0.90449966  1.59085003  7.49457576 17.88765781 35.60029477 60.61587023]
E1 = -3.8662452794657436  E_coul = 1.0286209870934804
cycle= 50 E= -2.83762429237226  delta_E= -1.4e-06  |g|= 0.000172  |ddm|= 3.39
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8662452794657436  E_coul = 1.0286209870934804

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.90450165289995  LUMO = 1.59081227250761
  mo_energy =
[-0.90450165  1.59081227  7.49438331 17.88701575 35.59929974 60.61382865]
E1 = -3.8662487929251674  E_coul = 1.0286259091583014
Extra cycle  E= -2.83762288376687  delta_E= 1.41e-06  |g|= 0.000115  |ddm|= 46.9
    CPU time for scf_cycle      0.52 sec, wall time      0.52 sec
exp = [6.27387559 5.52991232 4.86582728 4.17694049 3.77319348 0.37675024]
grad_E = [-4.41796753e-04 -2.91994503e-04 -7.90423718e-05  2.31599603e-04
  5.06541747e-04  2.01385974e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:43 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.30260066487        1
[INPUT] 0    0    [1    /1   ]  5.55637332607        1
[INPUT] 0    0    [1    /1   ]  4.89064573918        1
[INPUT] 0    0    [1    /1   ]  4.19980462387        1
[INPUT] 0    0    [1    /1   ]  3.79659966256        1
[INPUT] 0    0    [1    /1   ]  0.377108919535       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.302600664870345, 1.0]], [0, [5.556373326068817, 1.0]], [0, [4.890645739181508, 1.0]], [0, [4.19980462387439, 1.0]], [0, [3.796599662560253, 1.0]], [0, [0.3771089195353546, 1.0]]]}
ecp = {}
CPU time:        40.52
Set gradient conv threshold to 3.16228e-05
cond(S) = 970238369.7139628

WARN: Singularity detected in overlap matrix (condition number = 9.7e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8566634708871748  E_coul = 1.0242247435866416
init E= -2.83243872730053
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906692223455193  LUMO = 1.59310380796897
  mo_energy =
[-0.90669222  1.59310381  7.52675447 17.97577261 35.77961696 60.92836912]
E1 = -3.86637514132738  E_coul = 1.028746744387294
cycle= 1 E= -2.83762839694009  delta_E= -0.00519  |g|= 0.00613  |ddm|= 1.1e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904441751545017  LUMO = 1.59697732831888
  mo_energy =
[-0.90444175  1.59697733  7.53132541 17.97961465 35.78290823 60.92902398]
E1 = -3.8661393528792742  E_coul = 1.028508146071936
cycle= 2 E= -2.83763120680734  delta_E= -2.81e-06  |g|= 0.000416  |ddm|=  743
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904568637343279  LUMO = 1.59690478493427
  mo_energy =
[-0.90456864  1.59690478  7.53103531 17.97903221 35.78213652 60.9278864 ]
E1 = -3.866140029263064  E_coul = 1.0285119495448496
cycle= 3 E= -2.83762807971821  delta_E= 3.13e-06  |g|= 0.00028  |ddm|=  102
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904555517816207  LUMO = 1.59699230477675
  mo_energy =
[-0.90455552  1.5969923   7.53147237 17.9803837  35.78416582 60.93157967]
E1 = -3.8661345823504676  E_coul = 1.0285062054402234
cycle= 4 E= -2.83762837691024  delta_E= -2.97e-07  |g|= 7.72e-05  |ddm|= 91.5
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904560833564556  LUMO = 1.5969654742593
  mo_energy =
[-0.90456083  1.59696547  7.5313411  17.97999838 35.78360274 60.93070365]
E1 = -3.866135861821305  E_coul = 1.0285080297939264
cycle= 5 E= -2.83762783202738  delta_E= 5.45e-07  |g|= 5.43e-05  |ddm|= 22.5
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456051974621  LUMO = 1.59696951296078
  mo_energy =
[-0.90456052  1.59696951  7.53136023 17.98006786 35.78371364 60.93098595]
E1 = -3.8661354840330073  E_coul = 1.0285060525120178
cycle= 6 E= -2.83762943152099  delta_E= -1.6e-06  |g|= 0.000113  |ddm|= 5.45
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456085719691  LUMO = 1.59696238534925
  mo_energy =
[-0.90456086  1.59696239  7.53132426 17.97994692 35.78352622 60.93058629]
E1 = -3.8661361680829747  E_coul = 1.028503641087018
cycle= 7 E= -2.83763252699596  delta_E= -3.1e-06  |g|= 0.00037  |ddm|= 9.26
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561682235258  LUMO = 1.59694509472954
  mo_energy =
[-0.90456168  1.59694509  7.53123642 17.97964042 35.78303633 60.92951452]
E1 = -3.866137833750942  E_coul = 1.0285084446675
cycle= 8 E= -2.83762938908344  delta_E= 3.14e-06  |g|= 8.68e-06  |ddm|= 23.1
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561445229653  LUMO = 1.59694564287009
  mo_energy =
[-0.90456145  1.59694564  7.53123887 17.97964961 35.78305384 60.92955483]
E1 = -3.866137839805059  E_coul = 1.028509155456216
cycle= 9 E= -2.83762868434884  delta_E= 7.05e-07  |g|= 6.8e-05  |ddm|= 0.316
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561285386346  LUMO = 1.59694502528014
  mo_energy =
[-0.90456129  1.59694503  7.53123504 17.97963618 35.78303263 60.92951501]
E1 = -3.8661379464883754  E_coul = 1.0285077242749567
cycle= 10 E= -2.83763022221342  delta_E= -1.54e-06  |g|= 6.31e-05  |ddm|= 1.19
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561205984861  LUMO = 1.59694471643923
  mo_energy =
[-0.90456121  1.59694472  7.53123298 17.97963162 35.78302809 60.92951417]
E1 = -3.8661379939953093  E_coul = 1.0285070300584462
cycle= 11 E= -2.83763096393686  delta_E= -7.42e-07  |g|= 0.000129  |ddm|= 0.424
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561321459324  LUMO = 1.5969412198464
  mo_energy =
[-0.90456132  1.59694122  7.53121482 17.97957332 35.78294024 60.92934411]
E1 = -3.8661383324427154  E_coul = 1.0285101036209594
cycle= 12 E= -2.83762822882176  delta_E= 2.74e-06  |g|= 0.00013  |ddm|= 4.42
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456260461971  LUMO = 1.59693150726038
  mo_energy =
[-0.9045626   1.59693151  7.53116741 17.97940805 35.78267005 60.92875133]
E1 = -3.866139044904231  E_coul = 1.028510052384182
cycle= 13 E= -2.83762899252005  delta_E= -7.64e-07  |g|= 0.000106  |ddm|= 11.2
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562693304975  LUMO = 1.59692181595704
  mo_energy =
[-0.90456269  1.59692182  7.53111827 17.97923904 35.7824097  60.92817034]
E1 = -3.8661400917992763  E_coul = 1.02850826172182
cycle= 14 E= -2.83763183007746  delta_E= -2.84e-06  |g|= 0.000119  |ddm|= 13.7
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562203614408  LUMO = 1.5969278833306
  mo_energy =
[-0.9045622   1.59692788  7.53114753 17.97934486 35.78258367 60.92860608]
E1 = -3.8661395405286036  E_coul = 1.028507817521644
cycle= 15 E= -2.83763172300696  delta_E= 1.07e-07  |g|= 0.00013  |ddm|= 8.07
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904560379035735  LUMO = 1.59695792858471
  mo_energy =
[-0.90456038  1.59695793  7.53129908 17.97987864 35.78344552 60.93051469]
E1 = -3.8661367441579597  E_coul = 1.0285081544267491
cycle= 16 E= -2.83762858973121  delta_E= 3.13e-06  |g|= 1.36e-05  |ddm|= 39.6
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456032702961  LUMO = 1.59696026339927
  mo_energy =
[-0.90456033  1.59696026  7.53131454 17.97989326 35.78342767 60.93021288]
E1 = -3.8661366222824025  E_coul = 1.028505209983617
cycle= 17 E= -2.83763141229879  delta_E= -2.82e-06  |g|= 0.000238  |ddm|= 0.226
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561446277021  LUMO = 1.59693808612997
  mo_energy =
[-0.90456145  1.59693809  7.5312015  17.97951344 35.78283623 60.92897173]
E1 = -3.8661387088093715  E_coul = 1.0285095671493625
cycle= 18 E= -2.83762914166001  delta_E= 2.27e-06  |g|= 6.06e-05  |ddm|= 28.5
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456123743058  LUMO = 1.59694177238232
  mo_energy =
[-0.90456124  1.59694177  7.53122116 17.97956783 35.78290884 60.92906079]
E1 = -3.866138400718432  E_coul = 1.0285096793258606
cycle= 19 E= -2.83762872139257  delta_E= 4.2e-07  |g|= 9.99e-05  |ddm|= 3.82
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904560787406891  LUMO = 1.59694938221126
  mo_energy =
[-0.90456079  1.59694938  7.53125951 17.97969757 35.78311251 60.92950018]
E1 = -3.8661376954569144  E_coul = 1.0285056001482735
cycle= 20 E= -2.83763209530864  delta_E= -3.37e-06  |g|= 0.00026  |ddm|= 9.75
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561572496912  LUMO = 1.59693436105974
  mo_energy =
[-0.90456157  1.59693436  7.53118328 17.97942794 35.78267476 60.92852546]
E1 = -3.8661391264834486  E_coul = 1.0285089861768855
cycle= 21 E= -2.83763014030656  delta_E= 1.96e-06  |g|= 5.32e-06  |ddm|= 20.2
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561415212181  LUMO = 1.59693752056181
  mo_energy =
[-0.90456142  1.59693752  7.53119926 17.97948476 35.78276671 60.92873348]
E1 = -3.866138821770956  E_coul = 1.0285096866071461
cycle= 22 E= -2.83762913516381  delta_E= 1.01e-06  |g|= 9.48e-05  |ddm|= 4.27
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561505001366  LUMO = 1.59693620547197
  mo_energy =
[-0.90456151  1.59693621  7.53119275 17.97946607 35.78274178 60.92868627]
E1 = -3.8661389368399215  E_coul = 1.0285078244709691
cycle= 23 E= -2.83763111236895  delta_E= -1.98e-06  |g|= 9.69e-05  |ddm|= 1.46
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561925985955  LUMO = 1.59692909854825
  mo_energy =
[-0.90456193  1.5969291   7.53115669 17.97934166 35.78254367 60.92825367]
E1 = -3.8661395944287897  E_coul = 1.0285109806323438
cycle= 24 E= -2.83762861379645  delta_E= 2.5e-06  |g|= 0.000158  |ddm|= 9.21
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562835471018  LUMO = 1.59690978867062
  mo_energy =
[-0.90456284  1.59690979  7.53105616 17.97901831 35.78205277 60.92733744]
E1 = -3.8661413726319895  E_coul = 1.028513573248741
cycle= 25 E= -2.83762779938325  delta_E= 8.14e-07  |g|= 0.000336  |ddm|= 23.7
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562821234231  LUMO = 1.59691094679067
  mo_energy =
[-0.90456282  1.59691095  7.5310644  17.97900198 35.78197474 60.92696554]
E1 = -3.866141353614784  E_coul = 1.0285110829885034
cycle= 26 E= -2.83763027062628  delta_E= -2.47e-06  |g|= 0.000109  |ddm|= 1.55
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562436306712  LUMO = 1.59691784491792
  mo_energy =
[-0.90456244  1.59691784  7.53109821 17.97913693 35.78220941 60.92757423]
E1 = -3.8661406616963494  E_coul = 1.0285098417375074
cycle= 27 E= -2.83763081995884  delta_E= -5.49e-07  |g|= 1.54e-05  |ddm|= 10.3
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563001082684  LUMO = 1.59690778768642
  mo_energy =
[-0.904563    1.59690779  7.53104834 17.97895436 35.78190778 60.92685804]
E1 = -3.866141637202114  E_coul = 1.0285128110002661
cycle= 28 E= -2.83762882620185  delta_E= 1.99e-06  |g|= 0.000264  |ddm|=   14
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562197269634  LUMO = 1.59692306666288
  mo_energy =
[-0.9045622   1.59692307  7.53112583 17.97923529 35.78237126 60.927933  ]
E1 = -3.866140169668438  E_coul = 1.0285107867111294
cycle= 29 E= -2.83762938295731  delta_E= -5.57e-07  |g|= 0.000119  |ddm|=   21
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562051083268  LUMO = 1.59692561599843
  mo_energy =
[-0.90456205  1.59692562  7.53113812 17.97928028 35.78244685 60.92814665]
E1 = -3.8661399171689963  E_coul = 1.0285099122790602
cycle= 30 E= -2.83763000488994  delta_E= -6.22e-07  |g|= 4.55e-05  |ddm|= 3.63
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562959159775  LUMO = 1.59691056165115
  mo_energy =
[-0.90456296  1.59691056  7.53106699 17.97895878 35.78185423 60.9264379 ]
E1 = -3.866141507624973  E_coul = 1.0285124639898025
cycle= 31 E= -2.83762904363517  delta_E= 9.61e-07  |g|= 0.000233  |ddm|= 25.1
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561881063179  LUMO = 1.59693232927279
  mo_energy =
[-0.90456188  1.59693233  7.5311801  17.97930679 35.7823681  60.92737384]
E1 = -3.866139544785303  E_coul = 1.0285087558644752
cycle= 32 E= -2.83763078892083  delta_E= -1.75e-06  |g|= 2.32e-05  |ddm|= 25.7
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563754599807  LUMO = 1.59689058373083
  mo_energy =
[-0.90456375  1.59689058  7.53096098 17.97864265 35.78139772 60.92568   ]
E1 = -3.8661433130618286  E_coul = 1.0285130070916317
cycle= 33 E= -2.8376303059702  delta_E= 4.83e-07  |g|= 0.000198  |ddm|= 48.9
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561825146198  LUMO = 1.59692743904156
  mo_energy =
[-0.90456183  1.59692744  7.53114553 17.97931777 35.78251364 60.92832497]
E1 = -3.8661397293200586  E_coul = 1.0285100833525544
cycle= 34 E= -2.8376296459675  delta_E= 6.6e-07  |g|= 6.26e-05  |ddm|= 51.3
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561709668599  LUMO = 1.5969317672926
  mo_energy =
[-0.90456171  1.59693177  7.53117077 17.97937603 35.78257968 60.92828858]
E1 = -3.866139385792662  E_coul = 1.0285103774853297
cycle= 35 E= -2.83762900830733  delta_E= 6.38e-07  |g|= 0.00011  |ddm|= 3.68
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456117552271  LUMO = 1.59694360883231
  mo_energy =
[-0.90456118  1.59694361  7.53123384 17.97956346 35.78284947 60.92872521]
E1 = -3.8661383320902525  E_coul = 1.0285079979219054
cycle= 36 E= -2.83763033416835  delta_E= -1.33e-06  |g|= 4.87e-05  |ddm|= 13.5
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561373490652  LUMO = 1.59693907451704
  mo_energy =
[-0.90456137  1.59693907  7.53120923 17.97950253 35.78277706 60.92866955]
E1 = -3.8661387118456485  E_coul = 1.0285078252543423
cycle= 37 E= -2.83763088659131  delta_E= -5.52e-07  |g|= 8.81e-05  |ddm|= 4.35
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561773743086  LUMO = 1.59693177448258
  mo_energy =
[-0.90456177  1.59693177  7.53117279 17.97937703 35.78257752 60.92818569]
E1 = -3.866139407640976  E_coul = 1.0285093432690429
cycle= 38 E= -2.83763006437193  delta_E= 8.22e-07  |g|= 1.47e-05  |ddm|= 9.67
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561776173795  LUMO = 1.59693204951706
  mo_energy =
[-0.90456178  1.59693205  7.53117486 17.97937648 35.78257021 60.92814129]
E1 = -3.8661393983708927  E_coul = 1.0285094712282323
cycle= 39 E= -2.83762992714266  delta_E= 1.37e-07  |g|= 3.62e-05  |ddm|= 0.151
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561626642371  LUMO = 1.59693472569753
  mo_energy =
[-0.90456163  1.59693473  7.53118822 17.97942341 35.7826456  60.9283182 ]
E1 = -3.866139142603798  E_coul = 1.028508508274263
cycle= 40 E= -2.83763063432953  delta_E= -7.07e-07  |g|= 3.3e-05  |ddm|= 3.59
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456163388204  LUMO = 1.59693490455143
  mo_energy =
[-0.90456163  1.5969349   7.53118879 17.97942973 35.78266042 60.9283823 ]
E1 = -3.8661391103269573  E_coul = 1.0285100313680517
cycle= 41 E= -2.83762907895891  delta_E= 1.56e-06  |g|= 9.35e-05  |ddm|= 0.616
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9045626909442  LUMO = 1.59690980561901
  mo_energy =
[-0.90456269  1.59690981  7.53105469 17.97904514 35.78212302 60.92755678]
E1 = -3.8661413342815876  E_coul = 1.0285119762397934
cycle= 42 E= -2.83762935804179  delta_E= -2.79e-07  |g|= 0.000178  |ddm|= 27.9
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562018232548  LUMO = 1.59692666432889
  mo_energy =
[-0.90456202  1.59692666  7.53114971 17.9792606  35.78236144 60.92756769]
E1 = -3.8661399971811865  E_coul = 1.0285086488306514
cycle= 43 E= -2.83763134835054  delta_E= -1.99e-06  |g|= 5.07e-05  |ddm|= 14.4
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562101957122  LUMO = 1.59692480184401
  mo_energy =
[-0.9045621   1.5969248   7.53113962 17.97923317 35.78232498 60.9275219 ]
E1 = -3.86614015671298  E_coul = 1.0285102985295336
cycle= 44 E= -2.83762985818345  delta_E= 1.49e-06  |g|= 9.4e-05  |ddm|= 1.94
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562195501201  LUMO = 1.59692339198925
  mo_energy =
[-0.9045622   1.59692339  7.53113385 17.9791979  35.78225557 60.92729248]
E1 = -3.8661403287165705  E_coul = 1.0285111312914654
cycle= 45 E= -2.83762919742511  delta_E= 6.61e-07  |g|= 0.00017  |ddm|= 2.94
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561872905359  LUMO = 1.59692888873212
  mo_energy =
[-0.90456187  1.59692889  7.53116108 17.97928667 35.78239287 60.92764862]
E1 = -3.8661398133772047  E_coul = 1.0285105314705016
cycle= 46 E= -2.8376292819067  delta_E= -8.45e-08  |g|= 0.000129  |ddm|=    7
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561684436882  LUMO = 1.59693133361321
  mo_energy =
[-0.90456168  1.59693133  7.5311719  17.97934297 35.78250156 60.92797398]
E1 = -3.8661395453255674  E_coul = 1.02851055889301
cycle= 47 E= -2.83762898643256  delta_E= 2.95e-07  |g|= 0.000136  |ddm|= 4.45
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561421697497  LUMO = 1.5969361794205
  mo_energy =
[-0.90456142  1.59693618  7.53119575 17.9794287  35.78264021 60.92833074]
E1 = -3.8661390686735184  E_coul = 1.0285109950346607
cycle= 48 E= -2.83762807363886  delta_E= 9.13e-07  |g|= 0.000199  |ddm|= 6.71
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559862773226  LUMO = 1.59696614497913
  mo_energy =
[-0.90455986  1.59696614  7.5313486  17.97994508 35.78345161 60.93005314]
E1 = -3.866136257960593  E_coul = 1.0285058394326025
cycle= 49 E= -2.83763041852799  delta_E= -2.34e-06  |g|= 0.000156  |ddm|= 38.6
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456132656053  LUMO = 1.59693806223734
  mo_energy =
[-0.90456133  1.59693806  7.53119977 17.97950096 35.78280599 60.92897477]
E1 = -3.8661387179866207  E_coul = 1.0285080553490293
cycle= 50 E= -2.83763066263759  delta_E= -2.44e-07  |g|= 6.81e-05  |ddm|= 31.8
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8661387179866207  E_coul = 1.0285080553490293

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.90456130368558  LUMO = 1.59692426079938
  mo_energy =
[-0.9045613   1.59692426  7.53112781 17.97924979 35.78240529 60.92808354]
E1 = -3.8661402374499008  E_coul = 1.0285103918217156
Extra cycle  E= -2.83762984562818  delta_E= 8.17e-07  |g|= 8.86e-05  |ddm|= 19.9
    CPU time for scf_cycle      0.49 sec, wall time      0.49 sec
exp = [6.30260066 5.55637333 4.89064574 4.19980462 3.79659966 0.37710892]
E = -2.837629845628185
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:44 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.30260066487        1
[INPUT] 0    0    [1    /1   ]  5.55637332607        1
[INPUT] 0    0    [1    /1   ]  4.89064573918        1
[INPUT] 0    0    [1    /1   ]  4.19980462387        1
[INPUT] 0    0    [1    /1   ]  3.79659966256        1
[INPUT] 0    0    [1    /1   ]  0.377108919535       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.302600664870345, 1.0]], [0, [5.556373326068817, 1.0]], [0, [4.890645739181508, 1.0]], [0, [4.19980462387439, 1.0]], [0, [3.796599662560253, 1.0]], [0, [0.3771089195353546, 1.0]]]}
ecp = {}
CPU time:        41.23
Set gradient conv threshold to 3.16228e-05
cond(S) = 970238369.7139628

WARN: Singularity detected in overlap matrix (condition number = 9.7e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8566634708871748  E_coul = 1.0242247435866416
init E= -2.83243872730053
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906692223455193  LUMO = 1.59310380796897
  mo_energy =
[-0.90669222  1.59310381  7.52675447 17.97577261 35.77961696 60.92836912]
E1 = -3.86637514132738  E_coul = 1.028746744387294
cycle= 1 E= -2.83762839694009  delta_E= -0.00519  |g|= 0.00613  |ddm|= 1.1e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904441751545017  LUMO = 1.59697732831888
  mo_energy =
[-0.90444175  1.59697733  7.53132541 17.97961465 35.78290823 60.92902398]
E1 = -3.8661393528792742  E_coul = 1.028508146071936
cycle= 2 E= -2.83763120680734  delta_E= -2.81e-06  |g|= 0.000416  |ddm|=  743
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904568637343279  LUMO = 1.59690478493427
  mo_energy =
[-0.90456864  1.59690478  7.53103531 17.97903221 35.78213652 60.9278864 ]
E1 = -3.866140029263064  E_coul = 1.0285119495448496
cycle= 3 E= -2.83762807971821  delta_E= 3.13e-06  |g|= 0.00028  |ddm|=  102
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904555517816207  LUMO = 1.59699230477675
  mo_energy =
[-0.90455552  1.5969923   7.53147237 17.9803837  35.78416582 60.93157967]
E1 = -3.8661345823504676  E_coul = 1.0285062054402234
cycle= 4 E= -2.83762837691024  delta_E= -2.97e-07  |g|= 7.72e-05  |ddm|= 91.5
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904560833564556  LUMO = 1.5969654742593
  mo_energy =
[-0.90456083  1.59696547  7.5313411  17.97999838 35.78360274 60.93070365]
E1 = -3.866135861821305  E_coul = 1.0285080297939264
cycle= 5 E= -2.83762783202738  delta_E= 5.45e-07  |g|= 5.43e-05  |ddm|= 22.5
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456051974621  LUMO = 1.59696951296078
  mo_energy =
[-0.90456052  1.59696951  7.53136023 17.98006786 35.78371364 60.93098595]
E1 = -3.8661354840330073  E_coul = 1.0285060525120178
cycle= 6 E= -2.83762943152099  delta_E= -1.6e-06  |g|= 0.000113  |ddm|= 5.45
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456085719691  LUMO = 1.59696238534925
  mo_energy =
[-0.90456086  1.59696239  7.53132426 17.97994692 35.78352622 60.93058629]
E1 = -3.8661361680829747  E_coul = 1.028503641087018
cycle= 7 E= -2.83763252699596  delta_E= -3.1e-06  |g|= 0.00037  |ddm|= 9.26
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561682235258  LUMO = 1.59694509472954
  mo_energy =
[-0.90456168  1.59694509  7.53123642 17.97964042 35.78303633 60.92951452]
E1 = -3.866137833750942  E_coul = 1.0285084446675
cycle= 8 E= -2.83762938908344  delta_E= 3.14e-06  |g|= 8.68e-06  |ddm|= 23.1
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561445229653  LUMO = 1.59694564287009
  mo_energy =
[-0.90456145  1.59694564  7.53123887 17.97964961 35.78305384 60.92955483]
E1 = -3.866137839805059  E_coul = 1.028509155456216
cycle= 9 E= -2.83762868434884  delta_E= 7.05e-07  |g|= 6.8e-05  |ddm|= 0.316
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561285386346  LUMO = 1.59694502528014
  mo_energy =
[-0.90456129  1.59694503  7.53123504 17.97963618 35.78303263 60.92951501]
E1 = -3.8661379464883754  E_coul = 1.0285077242749567
cycle= 10 E= -2.83763022221342  delta_E= -1.54e-06  |g|= 6.31e-05  |ddm|= 1.19
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561205984861  LUMO = 1.59694471643923
  mo_energy =
[-0.90456121  1.59694472  7.53123298 17.97963162 35.78302809 60.92951417]
E1 = -3.8661379939953093  E_coul = 1.0285070300584462
cycle= 11 E= -2.83763096393686  delta_E= -7.42e-07  |g|= 0.000129  |ddm|= 0.424
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561321459324  LUMO = 1.5969412198464
  mo_energy =
[-0.90456132  1.59694122  7.53121482 17.97957332 35.78294024 60.92934411]
E1 = -3.8661383324427154  E_coul = 1.0285101036209594
cycle= 12 E= -2.83762822882176  delta_E= 2.74e-06  |g|= 0.00013  |ddm|= 4.42
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456260461971  LUMO = 1.59693150726038
  mo_energy =
[-0.9045626   1.59693151  7.53116741 17.97940805 35.78267005 60.92875133]
E1 = -3.866139044904231  E_coul = 1.028510052384182
cycle= 13 E= -2.83762899252005  delta_E= -7.64e-07  |g|= 0.000106  |ddm|= 11.2
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562693304975  LUMO = 1.59692181595704
  mo_energy =
[-0.90456269  1.59692182  7.53111827 17.97923904 35.7824097  60.92817034]
E1 = -3.8661400917992763  E_coul = 1.02850826172182
cycle= 14 E= -2.83763183007746  delta_E= -2.84e-06  |g|= 0.000119  |ddm|= 13.7
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562203614408  LUMO = 1.5969278833306
  mo_energy =
[-0.9045622   1.59692788  7.53114753 17.97934486 35.78258367 60.92860608]
E1 = -3.8661395405286036  E_coul = 1.028507817521644
cycle= 15 E= -2.83763172300696  delta_E= 1.07e-07  |g|= 0.00013  |ddm|= 8.07
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904560379035735  LUMO = 1.59695792858471
  mo_energy =
[-0.90456038  1.59695793  7.53129908 17.97987864 35.78344552 60.93051469]
E1 = -3.8661367441579597  E_coul = 1.0285081544267491
cycle= 16 E= -2.83762858973121  delta_E= 3.13e-06  |g|= 1.36e-05  |ddm|= 39.6
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456032702961  LUMO = 1.59696026339927
  mo_energy =
[-0.90456033  1.59696026  7.53131454 17.97989326 35.78342767 60.93021288]
E1 = -3.8661366222824025  E_coul = 1.028505209983617
cycle= 17 E= -2.83763141229879  delta_E= -2.82e-06  |g|= 0.000238  |ddm|= 0.226
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561446277021  LUMO = 1.59693808612997
  mo_energy =
[-0.90456145  1.59693809  7.5312015  17.97951344 35.78283623 60.92897173]
E1 = -3.8661387088093715  E_coul = 1.0285095671493625
cycle= 18 E= -2.83762914166001  delta_E= 2.27e-06  |g|= 6.06e-05  |ddm|= 28.5
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456123743058  LUMO = 1.59694177238232
  mo_energy =
[-0.90456124  1.59694177  7.53122116 17.97956783 35.78290884 60.92906079]
E1 = -3.866138400718432  E_coul = 1.0285096793258606
cycle= 19 E= -2.83762872139257  delta_E= 4.2e-07  |g|= 9.99e-05  |ddm|= 3.82
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904560787406891  LUMO = 1.59694938221126
  mo_energy =
[-0.90456079  1.59694938  7.53125951 17.97969757 35.78311251 60.92950018]
E1 = -3.8661376954569144  E_coul = 1.0285056001482735
cycle= 20 E= -2.83763209530864  delta_E= -3.37e-06  |g|= 0.00026  |ddm|= 9.75
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561572496912  LUMO = 1.59693436105974
  mo_energy =
[-0.90456157  1.59693436  7.53118328 17.97942794 35.78267476 60.92852546]
E1 = -3.8661391264834486  E_coul = 1.0285089861768855
cycle= 21 E= -2.83763014030656  delta_E= 1.96e-06  |g|= 5.32e-06  |ddm|= 20.2
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561415212181  LUMO = 1.59693752056181
  mo_energy =
[-0.90456142  1.59693752  7.53119926 17.97948476 35.78276671 60.92873348]
E1 = -3.866138821770956  E_coul = 1.0285096866071461
cycle= 22 E= -2.83762913516381  delta_E= 1.01e-06  |g|= 9.48e-05  |ddm|= 4.27
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561505001366  LUMO = 1.59693620547197
  mo_energy =
[-0.90456151  1.59693621  7.53119275 17.97946607 35.78274178 60.92868627]
E1 = -3.8661389368399215  E_coul = 1.0285078244709691
cycle= 23 E= -2.83763111236895  delta_E= -1.98e-06  |g|= 9.69e-05  |ddm|= 1.46
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561925985955  LUMO = 1.59692909854825
  mo_energy =
[-0.90456193  1.5969291   7.53115669 17.97934166 35.78254367 60.92825367]
E1 = -3.8661395944287897  E_coul = 1.0285109806323438
cycle= 24 E= -2.83762861379645  delta_E= 2.5e-06  |g|= 0.000158  |ddm|= 9.21
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562835471018  LUMO = 1.59690978867062
  mo_energy =
[-0.90456284  1.59690979  7.53105616 17.97901831 35.78205277 60.92733744]
E1 = -3.8661413726319895  E_coul = 1.028513573248741
cycle= 25 E= -2.83762779938325  delta_E= 8.14e-07  |g|= 0.000336  |ddm|= 23.7
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562821234231  LUMO = 1.59691094679067
  mo_energy =
[-0.90456282  1.59691095  7.5310644  17.97900198 35.78197474 60.92696554]
E1 = -3.866141353614784  E_coul = 1.0285110829885034
cycle= 26 E= -2.83763027062628  delta_E= -2.47e-06  |g|= 0.000109  |ddm|= 1.55
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562436306712  LUMO = 1.59691784491792
  mo_energy =
[-0.90456244  1.59691784  7.53109821 17.97913693 35.78220941 60.92757423]
E1 = -3.8661406616963494  E_coul = 1.0285098417375074
cycle= 27 E= -2.83763081995884  delta_E= -5.49e-07  |g|= 1.54e-05  |ddm|= 10.3
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563001082684  LUMO = 1.59690778768642
  mo_energy =
[-0.904563    1.59690779  7.53104834 17.97895436 35.78190778 60.92685804]
E1 = -3.866141637202114  E_coul = 1.0285128110002661
cycle= 28 E= -2.83762882620185  delta_E= 1.99e-06  |g|= 0.000264  |ddm|=   14
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562197269634  LUMO = 1.59692306666288
  mo_energy =
[-0.9045622   1.59692307  7.53112583 17.97923529 35.78237126 60.927933  ]
E1 = -3.866140169668438  E_coul = 1.0285107867111294
cycle= 29 E= -2.83762938295731  delta_E= -5.57e-07  |g|= 0.000119  |ddm|=   21
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562051083268  LUMO = 1.59692561599843
  mo_energy =
[-0.90456205  1.59692562  7.53113812 17.97928028 35.78244685 60.92814665]
E1 = -3.8661399171689963  E_coul = 1.0285099122790602
cycle= 30 E= -2.83763000488994  delta_E= -6.22e-07  |g|= 4.55e-05  |ddm|= 3.63
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562959159775  LUMO = 1.59691056165115
  mo_energy =
[-0.90456296  1.59691056  7.53106699 17.97895878 35.78185423 60.9264379 ]
E1 = -3.866141507624973  E_coul = 1.0285124639898025
cycle= 31 E= -2.83762904363517  delta_E= 9.61e-07  |g|= 0.000233  |ddm|= 25.1
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561881063179  LUMO = 1.59693232927279
  mo_energy =
[-0.90456188  1.59693233  7.5311801  17.97930679 35.7823681  60.92737384]
E1 = -3.866139544785303  E_coul = 1.0285087558644752
cycle= 32 E= -2.83763078892083  delta_E= -1.75e-06  |g|= 2.32e-05  |ddm|= 25.7
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563754599807  LUMO = 1.59689058373083
  mo_energy =
[-0.90456375  1.59689058  7.53096098 17.97864265 35.78139772 60.92568   ]
E1 = -3.8661433130618286  E_coul = 1.0285130070916317
cycle= 33 E= -2.8376303059702  delta_E= 4.83e-07  |g|= 0.000198  |ddm|= 48.9
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561825146198  LUMO = 1.59692743904156
  mo_energy =
[-0.90456183  1.59692744  7.53114553 17.97931777 35.78251364 60.92832497]
E1 = -3.8661397293200586  E_coul = 1.0285100833525544
cycle= 34 E= -2.8376296459675  delta_E= 6.6e-07  |g|= 6.26e-05  |ddm|= 51.3
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561709668599  LUMO = 1.5969317672926
  mo_energy =
[-0.90456171  1.59693177  7.53117077 17.97937603 35.78257968 60.92828858]
E1 = -3.866139385792662  E_coul = 1.0285103774853297
cycle= 35 E= -2.83762900830733  delta_E= 6.38e-07  |g|= 0.00011  |ddm|= 3.68
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456117552271  LUMO = 1.59694360883231
  mo_energy =
[-0.90456118  1.59694361  7.53123384 17.97956346 35.78284947 60.92872521]
E1 = -3.8661383320902525  E_coul = 1.0285079979219054
cycle= 36 E= -2.83763033416835  delta_E= -1.33e-06  |g|= 4.87e-05  |ddm|= 13.5
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561373490652  LUMO = 1.59693907451704
  mo_energy =
[-0.90456137  1.59693907  7.53120923 17.97950253 35.78277706 60.92866955]
E1 = -3.8661387118456485  E_coul = 1.0285078252543423
cycle= 37 E= -2.83763088659131  delta_E= -5.52e-07  |g|= 8.81e-05  |ddm|= 4.35
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561773743086  LUMO = 1.59693177448258
  mo_energy =
[-0.90456177  1.59693177  7.53117279 17.97937703 35.78257752 60.92818569]
E1 = -3.866139407640976  E_coul = 1.0285093432690429
cycle= 38 E= -2.83763006437193  delta_E= 8.22e-07  |g|= 1.47e-05  |ddm|= 9.67
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561776173795  LUMO = 1.59693204951706
  mo_energy =
[-0.90456178  1.59693205  7.53117486 17.97937648 35.78257021 60.92814129]
E1 = -3.8661393983708927  E_coul = 1.0285094712282323
cycle= 39 E= -2.83762992714266  delta_E= 1.37e-07  |g|= 3.62e-05  |ddm|= 0.151
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561626642371  LUMO = 1.59693472569753
  mo_energy =
[-0.90456163  1.59693473  7.53118822 17.97942341 35.7826456  60.9283182 ]
E1 = -3.866139142603798  E_coul = 1.028508508274263
cycle= 40 E= -2.83763063432953  delta_E= -7.07e-07  |g|= 3.3e-05  |ddm|= 3.59
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456163388204  LUMO = 1.59693490455143
  mo_energy =
[-0.90456163  1.5969349   7.53118879 17.97942973 35.78266042 60.9283823 ]
E1 = -3.8661391103269573  E_coul = 1.0285100313680517
cycle= 41 E= -2.83762907895891  delta_E= 1.56e-06  |g|= 9.35e-05  |ddm|= 0.616
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9045626909442  LUMO = 1.59690980561901
  mo_energy =
[-0.90456269  1.59690981  7.53105469 17.97904514 35.78212302 60.92755678]
E1 = -3.8661413342815876  E_coul = 1.0285119762397934
cycle= 42 E= -2.83762935804179  delta_E= -2.79e-07  |g|= 0.000178  |ddm|= 27.9
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562018232548  LUMO = 1.59692666432889
  mo_energy =
[-0.90456202  1.59692666  7.53114971 17.9792606  35.78236144 60.92756769]
E1 = -3.8661399971811865  E_coul = 1.0285086488306514
cycle= 43 E= -2.83763134835054  delta_E= -1.99e-06  |g|= 5.07e-05  |ddm|= 14.4
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562101957122  LUMO = 1.59692480184401
  mo_energy =
[-0.9045621   1.5969248   7.53113962 17.97923317 35.78232498 60.9275219 ]
E1 = -3.86614015671298  E_coul = 1.0285102985295336
cycle= 44 E= -2.83762985818345  delta_E= 1.49e-06  |g|= 9.4e-05  |ddm|= 1.94
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562195501201  LUMO = 1.59692339198925
  mo_energy =
[-0.9045622   1.59692339  7.53113385 17.9791979  35.78225557 60.92729248]
E1 = -3.8661403287165705  E_coul = 1.0285111312914654
cycle= 45 E= -2.83762919742511  delta_E= 6.61e-07  |g|= 0.00017  |ddm|= 2.94
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561872905359  LUMO = 1.59692888873212
  mo_energy =
[-0.90456187  1.59692889  7.53116108 17.97928667 35.78239287 60.92764862]
E1 = -3.8661398133772047  E_coul = 1.0285105314705016
cycle= 46 E= -2.8376292819067  delta_E= -8.45e-08  |g|= 0.000129  |ddm|=    7
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561684436882  LUMO = 1.59693133361321
  mo_energy =
[-0.90456168  1.59693133  7.5311719  17.97934297 35.78250156 60.92797398]
E1 = -3.8661395453255674  E_coul = 1.02851055889301
cycle= 47 E= -2.83762898643256  delta_E= 2.95e-07  |g|= 0.000136  |ddm|= 4.45
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561421697497  LUMO = 1.5969361794205
  mo_energy =
[-0.90456142  1.59693618  7.53119575 17.9794287  35.78264021 60.92833074]
E1 = -3.8661390686735184  E_coul = 1.0285109950346607
cycle= 48 E= -2.83762807363886  delta_E= 9.13e-07  |g|= 0.000199  |ddm|= 6.71
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559862773226  LUMO = 1.59696614497913
  mo_energy =
[-0.90455986  1.59696614  7.5313486  17.97994508 35.78345161 60.93005314]
E1 = -3.866136257960593  E_coul = 1.0285058394326025
cycle= 49 E= -2.83763041852799  delta_E= -2.34e-06  |g|= 0.000156  |ddm|= 38.6
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456132656053  LUMO = 1.59693806223734
  mo_energy =
[-0.90456133  1.59693806  7.53119977 17.97950096 35.78280599 60.92897477]
E1 = -3.8661387179866207  E_coul = 1.0285080553490293
cycle= 50 E= -2.83763066263759  delta_E= -2.44e-07  |g|= 6.81e-05  |ddm|= 31.8
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8661387179866207  E_coul = 1.0285080553490293

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.90456130368558  LUMO = 1.59692426079938
  mo_energy =
[-0.9045613   1.59692426  7.53112781 17.97924979 35.78240529 60.92808354]
E1 = -3.8661402374499008  E_coul = 1.0285103918217156
Extra cycle  E= -2.83762984562818  delta_E= 8.17e-07  |g|= 8.86e-05  |ddm|= 19.9
    CPU time for scf_cycle      0.49 sec, wall time      0.49 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 970238369.7139628

WARN: Singularity detected in overlap matrix (condition number = 9.7e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8661402374499008  E_coul = 1.0285103918217156
init E= -2.83762984562818
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.904559726958055  LUMO = 1.59693843173404
  mo_energy =
[-0.90455973  1.59693843  7.53119386 17.97953606 35.78292407 60.92944203]
E1 = -3.866138975413096  E_coul = 1.0285107418427586
cycle= 1 E= -2.83762823357034  delta_E= 1.61e-06  |g|= 0.000139  |ddm|=   21
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904558746041471  LUMO = 1.59697169785586
  mo_energy =
[-0.90455875  1.5969717   7.5313722  17.9800812  35.78372255 60.93074793]
E1 = -3.866135859845474  E_coul = 1.0285051120255961
cycle= 2 E= -2.83763074781988  delta_E= -2.51e-06  |g|= 0.000236  |ddm|= 39.9
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904557117874604  LUMO = 1.59699128035612
  mo_energy =
[-0.90455712  1.59699128  7.5314705  17.9804298  35.78429203 60.93197652]
E1 = -3.8661341663012383  E_coul = 1.028503559404162
cycle= 3 E= -2.83763060689708  delta_E= 1.41e-07  |g|= 0.000302  |ddm|= 24.9
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558573001121  LUMO = 1.59697108986319
  mo_energy =
[-0.90455857  1.59697109  7.53137062 17.98004731 35.78364063 60.93043358]
E1 = -3.8661360466905177  E_coul = 1.0285053046595138
cycle= 4 E= -2.837630742031  delta_E= -1.35e-07  |g|= 0.00021  |ddm|= 28.2
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558775176018  LUMO = 1.59696749836694
  mo_energy =
[-0.90455878  1.5969675   7.53135232 17.97998725 35.78354946 60.93025038]
E1 = -3.8661363753766445  E_coul = 1.0285066085424777
cycle= 5 E= -2.83762976683417  delta_E= 9.75e-07  |g|= 9.7e-05  |ddm|= 4.48
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558726225723  LUMO = 1.59696789604738
  mo_energy =
[-0.90455873  1.5969679   7.53135272 17.98000324 35.78358937 60.93043311]
E1 = -3.8661362969164212  E_coul = 1.0285051146699271
cycle= 6 E= -2.83763118224649  delta_E= -1.42e-06  |g|= 0.000248  |ddm|= 1.61
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559028611695  LUMO = 1.59696270479243
  mo_energy =
[-0.90455903  1.5969627   7.53132662 17.97990919 35.78343494 60.93007742]
E1 = -3.8661367888873537  E_coul = 1.0285053381762157
cycle= 7 E= -2.83763145071114  delta_E= -2.68e-07  |g|= 0.000247  |ddm|= 7.04
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559515836917  LUMO = 1.59695411236704
  mo_energy =
[-0.90455952  1.59695411  7.5312835  17.97975619 35.78318728 60.92951325]
E1 = -3.866137604058885  E_coul = 1.028506246390029
cycle= 8 E= -2.83763135766886  delta_E= 9.3e-08  |g|= 0.000185  |ddm|= 11.5
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904560062642696  LUMO = 1.59694293326787
  mo_energy =
[-0.90456006  1.59694293  7.53122493 17.97957251 35.78291308 60.92904385]
E1 = -3.866138610736011  E_coul = 1.0285092038536174
cycle= 9 E= -2.83762940688239  delta_E= 1.95e-06  |g|= 3.48e-05  |ddm|= 13.3
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904560826367865  LUMO = 1.59692948992855
  mo_energy =
[-0.90456083  1.59692949  7.53115333 17.97933757 35.78254852 60.92841814]
E1 = -3.866139786703205  E_coul = 1.0285072874815346
cycle= 10 E= -2.83763249922167  delta_E= -3.09e-06  |g|= 0.000189  |ddm|= 16.2
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561737516629  LUMO = 1.59691091695637
  mo_energy =
[-0.90456174  1.59691092  7.53105722 17.97902933 35.78208159 60.92750345]
E1 = -3.8661414997585144  E_coul = 1.0285124496257285
cycle= 11 E= -2.83762905013279  delta_E= 3.45e-06  |g|= 0.000205  |ddm|= 22.8
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904560874987605  LUMO = 1.59692647336935
  mo_energy =
[-0.90456087  1.59692647  7.53113621 17.97929818 35.7825039  60.92841153]
E1 = -3.8661400500476857  E_coul = 1.0285073588965188
cycle= 12 E= -2.83763269115117  delta_E= -3.64e-06  |g|= 0.000196  |ddm|= 20.1
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561299390002  LUMO = 1.59691835644932
  mo_energy =
[-0.9045613   1.59691836  7.53109497 17.9791586  35.78228451 60.9279368 ]
E1 = -3.866140813930675  E_coul = 1.0285100050024314
cycle= 13 E= -2.83763080892824  delta_E= 1.88e-06  |g|= 8.25e-06  |ddm|= 10.5
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561384800217  LUMO = 1.59691715324294
  mo_energy =
[-0.90456138  1.59691715  7.53108965 17.97913218 35.78223326 60.92777555]
E1 = -3.8661409468680006  E_coul = 1.0285105665141259
cycle= 14 E= -2.83763038035387  delta_E= 4.29e-07  |g|= 5.67e-05  |ddm|= 2.17
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561346731485  LUMO = 1.59691747302635
  mo_energy =
[-0.90456135  1.59691747  7.53109109 17.97914065 35.78225144 60.92783392]
E1 = -3.8661409142043266  E_coul = 1.0285101224503246
cycle= 15 E= -2.837630791754  delta_E= -4.11e-07  |g|= 1.94e-05  |ddm|= 0.629
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561322954869  LUMO = 1.59691715591752
  mo_energy =
[-0.90456132  1.59691716  7.53108849 17.97914102 35.78226162 60.92791294]
E1 = -3.866140925134648  E_coul = 1.0285092619951466
cycle= 16 E= -2.8376316631395  delta_E= -8.71e-07  |g|= 7.13e-05  |ddm|= 0.233
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561302757971  LUMO = 1.59691762671552
  mo_energy =
[-0.9045613   1.59691763  7.53109085 17.97914328 35.78225977 60.92787805]
E1 = -3.8661408910250943  E_coul = 1.0285114294092705
cycle= 17 E= -2.83762946161582  delta_E= 2.2e-06  |g|= 0.000141  |ddm|= 0.222
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904564555671238  LUMO = 1.59685595050768
  mo_energy =
[-0.90456456  1.59685595  7.53077654 17.97809288 35.78062514 60.92442897]
E1 = -3.8661466452255064  E_coul = 1.028515864408774
cycle= 18 E= -2.83763078081673  delta_E= -1.32e-06  |g|= 0.000299  |ddm|= 78.7
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561322974582  LUMO = 1.59691940933795
  mo_energy =
[-0.90456132  1.59691941  7.53110182 17.97917712 35.7823085  60.92791691]
E1 = -3.866140724898243  E_coul = 1.0285107846987627
cycle= 19 E= -2.83762994019948  delta_E= 8.41e-07  |g|= 7.47e-05  |ddm|= 80.8
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561339224536  LUMO = 1.59691919520025
  mo_energy =
[-0.90456134  1.5969192   7.5311014  17.97916718 35.78228364 60.92781399]
E1 = -3.866140767078157  E_coul = 1.0285118755442029
cycle= 20 E= -2.83762889153395  delta_E= 1.05e-06  |g|= 0.00019  |ddm|=  0.9
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904560503284051  LUMO = 1.59693513740822
  mo_energy =
[-0.9045605   1.59693514  7.53118286 17.97944261 35.78271673 60.92873451]
E1 = -3.8661392752715575  E_coul = 1.0285111928731423
cycle= 21 E= -2.83762808239842  delta_E= 8.09e-07  |g|= 0.000193  |ddm|= 20.5
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559873599087  LUMO = 1.59694650621676
  mo_energy =
[-0.90455987  1.59694651  7.53124036 17.97964868 35.78305535 60.92950951]
E1 = -3.866138194710063  E_coul = 1.0285095679485734
cycle= 22 E= -2.83762862676149  delta_E= -5.44e-07  |g|= 7.19e-05  |ddm|= 15.4
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9045596603564  LUMO = 1.59695115642054
  mo_energy =
[-0.90455966  1.59695116  7.5312651  17.97972219 35.78316059 60.92966854]
E1 = -3.866137783670813  E_coul = 1.0285066673691348
cycle= 23 E= -2.83763111630168  delta_E= -2.49e-06  |g|= 0.00016  |ddm|= 5.26
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559994297112  LUMO = 1.59694466954527
  mo_energy =
[-0.90455999  1.59694467  7.53123148 17.97961315 35.78299321 60.92934518]
E1 = -3.8661383772826907  E_coul = 1.0285101095245301
cycle= 24 E= -2.83762826775816  delta_E= 2.85e-06  |g|= 0.000124  |ddm|=    8
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559589167703  LUMO = 1.59695206133875
  mo_energy =
[-0.90455959  1.59695206  7.5312685  17.97974544 35.78320865 60.92984437]
E1 = -3.866137669699237  E_coul = 1.028507825798555
cycle= 25 E= -2.83762984390068  delta_E= -1.58e-06  |g|= 5.67e-05  |ddm|=   10
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559730197451  LUMO = 1.5969493325386
  mo_energy =
[-0.90455973  1.59694933  7.53125427 17.9796959  35.78312787 60.92967634]
E1 = -3.866137923582532  E_coul = 1.0285091391101788
cycle= 26 E= -2.83762878447235  delta_E= 1.06e-06  |g|= 5.68e-05  |ddm|= 3.58
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559540684448  LUMO = 1.59695304779548
  mo_energy =
[-0.90455954  1.59695305  7.5312736  17.97975827 35.78322303 60.92985472]
E1 = -3.8661375832866365  E_coul = 1.0285074258884421
cycle= 27 E= -2.83763015739819  delta_E= -1.37e-06  |g|= 9.13e-05  |ddm|= 4.57
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559254195611  LUMO = 1.59695818996647
  mo_energy =
[-0.90455925  1.59695819  7.53129935 17.97985619 35.78338987 60.93026276]
E1 = -3.8661370824123105  E_coul = 1.0285083140884816
cycle= 28 E= -2.83762876832383  delta_E= 1.39e-06  |g|= 9.2e-06  |ddm|= 7.34
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558630033803  LUMO = 1.59696964400514
  mo_energy =
[-0.90455863  1.59696964  7.53135708 17.98006946 35.78374689 60.93111236]
E1 = -3.8661359805614133  E_coul = 1.0285070921660768
cycle= 29 E= -2.83762888839534  delta_E= -1.2e-07  |g|= 5.61e-05  |ddm|= 15.9
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455976611056  LUMO = 1.59694850434215
  mo_energy =
[-0.90455977  1.5969485   7.53124994 17.97967989 35.78309764 60.92958491]
E1 = -3.8661380025848096  E_coul = 1.0285090602675013
cycle= 30 E= -2.83762894231731  delta_E= -5.39e-08  |g|= 3.98e-05  |ddm|=   29
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559933976486  LUMO = 1.5969446424744
  mo_energy =
[-0.90455993  1.59694464  7.53122833 17.97961789 35.78300907 60.92949099]
E1 = -3.8661383246687113  E_coul = 1.0285100576646162
cycle= 31 E= -2.83762826700409  delta_E= 6.75e-07  |g|= 0.000113  |ddm|= 4.06
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559112590612  LUMO = 1.59696116604124
  mo_energy =
[-0.90455911  1.59696117  7.53131387 17.97989091 35.78342304 60.93030751]
E1 = -3.8661368077300633  E_coul = 1.0285070724292675
cycle= 32 E= -2.8376297353008  delta_E= -1.47e-06  |g|= 9.43e-05  |ddm|= 20.2
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559344669758  LUMO = 1.59695696587889
  mo_energy =
[-0.90455934  1.59695697  7.53129245 17.97981824 35.78330699 60.93005261]
E1 = -3.866137196068998  E_coul = 1.0285058778115619
cycle= 33 E= -2.83763131825744  delta_E= -1.58e-06  |g|= 0.000217  |ddm|= 5.39
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559226293835  LUMO = 1.59695939131882
  mo_energy =
[-0.90455923  1.59695939  7.53130544 17.97985829 35.78336721 60.9301486 ]
E1 = -3.8661369808008543  E_coul = 1.0285069973615515
cycle= 34 E= -2.8376299834393  delta_E= 1.33e-06  |g|= 0.000105  |ddm|= 2.83
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455942104108  LUMO = 1.59695600141208
  mo_energy =
[-0.90455942  1.596956    7.53128829 17.97979288 35.78325569 60.92990593]
E1 = -3.86613730594212  E_coul = 1.0285074854483844
cycle= 35 E= -2.83762982049374  delta_E= 1.63e-07  |g|= 6.45e-05  |ddm|= 4.79
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559181780159  LUMO = 1.59696038506372
  mo_energy =
[-0.90455918  1.59696039  7.5313103  17.97986137 35.78335651 60.93012583]
E1 = -3.866136900002133  E_coul = 1.0285065981474137
cycle= 36 E= -2.83763030185472  delta_E= -4.81e-07  |g|= 0.000143  |ddm|= 5.34
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559167970337  LUMO = 1.5969607161426
  mo_energy =
[-0.90455917  1.59696072  7.53131199 17.97987026 35.78337458 60.93017756]
E1 = -3.866136863547187  E_coul = 1.0285076185223092
cycle= 37 E= -2.83762924502488  delta_E= 1.06e-06  |g|= 4.33e-05  |ddm|= 0.637
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558198910093  LUMO = 1.59697930202682
  mo_energy =
[-0.9045582   1.5969793   7.53140597 17.98021493 35.78394983 60.93152832]
E1 = -3.8661350714907914  E_coul = 1.028503679670595
cycle= 38 E= -2.8376313918202  delta_E= -2.15e-06  |g|= 0.000334  |ddm|= 25.8
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455843263754  LUMO = 1.59697476501093
  mo_energy =
[-0.90455843  1.59697477  7.53138496 17.9801195  35.7837733  60.93090068]
E1 = -3.866135573635109  E_coul = 1.028507396640043
cycle= 39 E= -2.83762817699507  delta_E= 3.21e-06  |g|= 1.22e-05  |ddm|= 7.93
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904560537413435  LUMO = 1.59693525600721
  mo_energy =
[-0.90456054  1.59693526  7.53118675 17.97940831 35.78261433 60.92816582]
E1 = -3.8661393839043328  E_coul = 1.0285086722601706
cycle= 40 E= -2.83763071164416  delta_E= -2.53e-06  |g|= 3.87e-05  |ddm|=   54
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904560868973259  LUMO = 1.59692769975479
  mo_energy =
[-0.90456087  1.5969277   7.53114713 17.97929812 35.78246631 60.92802157]
E1 = -3.866140048963348  E_coul = 1.0285101255725386
cycle= 41 E= -2.83762992339081  delta_E= 7.88e-07  |g|= 6.61e-05  |ddm|=  8.1
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904560445286267  LUMO = 1.59693508396055
  mo_energy =
[-0.90456045  1.59693508  7.53118162 17.97944056 35.78271358 60.92876526]
E1 = -3.866139277053021  E_coul = 1.0285083040937086
cycle= 42 E= -2.83763097295931  delta_E= -1.05e-06  |g|= 8.29e-05  |ddm|= 11.6
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904560662287552  LUMO = 1.59693051490156
  mo_energy =
[-0.90456066  1.59693051  7.53115724 17.97936376 35.78259759 60.92856473]
E1 = -3.866139685592068  E_coul = 1.028510217168711
cycle= 43 E= -2.83762946842336  delta_E= 1.5e-06  |g|= 8.06e-05  |ddm|= 5.41
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904560490825494  LUMO = 1.59693387651673
  mo_energy =
[-0.90456049  1.59693388  7.53117391 17.97942588 35.78270141 60.92882174]
E1 = -3.866139354029405  E_coul = 1.028509545399017
cycle= 44 E= -2.83762980863039  delta_E= -3.4e-07  |g|= 2.81e-05  |ddm|= 4.78
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904560423919074  LUMO = 1.59693554444687
  mo_energy =
[-0.90456042  1.59693554  7.53118276 17.97945544 35.78274813 60.92891574]
E1 = -3.8661391975277066  E_coul = 1.028510006016036
cycle= 45 E= -2.83762919151167  delta_E= 6.17e-07  |g|= 7.64e-05  |ddm|= 2.14
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904560354833029  LUMO = 1.59693712758559
  mo_energy =
[-0.90456035  1.59693713  7.53119099 17.97948234 35.7827893  60.92899908]
E1 = -3.8661390496809473  E_coul = 1.0285095823551358
cycle= 46 E= -2.83762946732581  delta_E= -2.76e-07  |g|= 4.09e-05  |ddm|= 1.99
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904560218045395  LUMO = 1.59693966670111
  mo_energy =
[-0.90456022  1.59693967  7.53120388 17.97952536 35.78285669 60.92913864]
E1 = -3.8661388136275368  E_coul = 1.0285104885286858
cycle= 47 E= -2.83762832509885  delta_E= 1.14e-06  |g|= 0.000142  |ddm|= 3.23
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904560044984282  LUMO = 1.59694296706446
  mo_energy =
[-0.90456004  1.59694297  7.53122049 17.97957974 35.7829402  60.92932034]
E1 = -3.866138504656819  E_coul = 1.0285101490335231
cycle= 48 E= -2.8376283556233  delta_E= -3.05e-08  |g|= 0.000124  |ddm|= 4.17
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559793304446  LUMO = 1.59694784428851
  mo_energy =
[-0.90455979  1.59694784  7.53124447 17.97966739 35.783083   60.92967437]
E1 = -3.8661380229471307  E_coul = 1.0285083299888313
cycle= 49 E= -2.8376296929583  delta_E= -1.34e-06  |g|= 2.51e-05  |ddm|= 6.83
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559905174313  LUMO = 1.59694602561418
  mo_energy =
[-0.90455991  1.59694603  7.53123573 17.97963481 35.78302952 60.92953011]
E1 = -3.8661382020875443  E_coul = 1.0285097956999019
cycle= 50 E= -2.83762840638764  delta_E= 1.29e-06  |g|= 0.000106  |ddm|= 2.58
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8661382020875443  E_coul = 1.0285097956999019

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904559305445185  LUMO = 1.5969657646166
  mo_energy =
[-0.90455931  1.59696576  7.53133685 17.9800092  35.78365039 60.93093535]
E1 = -3.866136180473618  E_coul = 1.0285044204972125
Extra cycle  E= -2.83763175997641  delta_E= -3.35e-06  |g|= 0.000306  |ddm|= 28.4
    CPU time for scf_cycle      0.52 sec, wall time      0.53 sec
exp = [6.30260066 5.55637333 4.89064574 4.19980462 3.79659966 0.37710892]
grad_E = [-4.01588133e-04 -2.46496869e-04 -4.09880319e-05  2.46875799e-04
  5.04947778e-04  2.09131466e-04]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:46 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.32150744467        1
[INPUT] 0    0    [1    /1   ]  5.57366184729        1
[INPUT] 0    0    [1    /1   ]  4.90667362332        1
[INPUT] 0    0    [1    /1   ]  4.21429975271        1
[INPUT] 0    0    [1    /1   ]  3.81122296996        1
[INPUT] 0    0    [1    /1   ]  0.377562121144       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.321507444666254, 1.0]], [0, [5.573661847289185, 1.0]], [0, [4.906673623319631, 1.0]], [0, [4.214299752705042, 1.0]], [0, [3.8112229699645863, 1.0]], [0, [0.3775621211444727, 1.0]]]}
ecp = {}
CPU time:        44.07
Set gradient conv threshold to 3.16228e-05
cond(S) = 981582528.2681699

WARN: Singularity detected in overlap matrix (condition number = 9.82e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8566453587062797  E_coul = 1.024220719202386
init E= -2.83242463950389
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906698462655637  LUMO = 1.59761452680304
  mo_energy =
[-0.90669846  1.59761453  7.55072424 18.03422859 35.89546454 61.1257416 ]
E1 = -3.8664042463246275  E_coul = 1.0287731464295047
cycle= 1 E= -2.83763109989512  delta_E= -0.00521  |g|= 0.00607  |ddm|= 1.06e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904429868205076  LUMO = 1.60160109607292
  mo_energy =
[-0.90442987  1.6016011   7.55579907 18.03973178 35.90136177 61.13188976]
E1 = -3.8661549402493143  E_coul = 1.028521649660744
cycle= 2 E= -2.83763329058857  delta_E= -2.19e-06  |g|= 0.000391  |ddm|=  600
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904563252435695  LUMO = 1.60153463116665
  mo_energy =
[-0.90456325  1.60153463  7.55556161 18.03931639 35.90082229 61.1311543 ]
E1 = -3.866153079351691  E_coul = 1.0285182917463873
cycle= 3 E= -2.8376347876053  delta_E= -1.5e-06  |g|= 0.000145  |ddm|= 81.9
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904557051043565  LUMO = 1.60150834539367
  mo_energy =
[-0.90455705  1.60150835  7.55541561 18.03871809 35.8997852  61.12841463]
E1 = -3.8661579092248584  E_coul = 1.028522572151247
cycle= 4 E= -2.83763533707361  delta_E= -5.49e-07  |g|= 2.24e-05  |ddm|= 52.3
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904556411892815  LUMO = 1.60150131285844
  mo_energy =
[-0.90455641  1.60150131  7.55536898 18.03867135 35.89984517 61.12925071]
E1 = -3.8661585230458244  E_coul = 1.0285235853986814
cycle= 5 E= -2.83763493764714  delta_E= 3.99e-07  |g|= 2.11e-05  |ddm|= 3.35
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556023560035  LUMO = 1.60150699254124
  mo_energy =
[-0.90455602  1.60150699  7.55540191 18.03872563 35.89986895 61.12898735]
E1 = -3.8661581730624053  E_coul = 1.0285227551162461
cycle= 6 E= -2.83763541794616  delta_E= -4.8e-07  |g|= 1.7e-05  |ddm|= 2.99
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556125066354  LUMO = 1.60150425803816
  mo_energy =
[-0.90455613  1.60150426  7.55538583 18.03869686 35.89984855 61.12907555]
E1 = -3.8661583683161784  E_coul = 1.0285237606867808
cycle= 7 E= -2.8376346076294  delta_E= 8.1e-07  |g|= 5.42e-05  |ddm|= 1.73
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555948506585  LUMO = 1.60150760012838
  mo_energy =
[-0.90455595  1.6015076   7.55540344 18.03875068 35.89992883 61.12921507]
E1 = -3.8661580748253335  E_coul = 1.0285237319332203
cycle= 8 E= -2.83763434289211  delta_E= 2.65e-07  |g|= 5.86e-05  |ddm|= 3.91
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555818172831  LUMO = 1.60151077621804
  mo_energy =
[-0.90455582  1.60151078  7.55542034 18.03879738 35.89999045 61.12929364]
E1 = -3.866157794108786  E_coul = 1.0285256421049804
cycle= 9 E= -2.83763215200381  delta_E= 2.19e-06  |g|= 0.000257  |ddm|= 3.45
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455538565036  LUMO = 1.60151990370087
  mo_energy =
[-0.90455539  1.6015199   7.5554672  18.03895583 35.90023943 61.12980856]
E1 = -3.866156931131314  E_coul = 1.0285227824185532
cycle= 10 E= -2.83763414871276  delta_E= -2e-06  |g|= 2.89e-05  |ddm|= 11.9
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555353470889  LUMO = 1.60152313802233
  mo_energy =
[-0.90455535  1.60152314  7.55548435 18.03900996 35.9003194  61.12995722]
E1 = -3.8661566030232564  E_coul = 1.0285219469839861
cycle= 11 E= -2.83763465603927  delta_E= -5.07e-07  |g|= 2.41e-05  |ddm|= 4.21
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555494454157  LUMO = 1.60152049707915
  mo_energy =
[-0.90455549  1.6015205   7.55547088 18.03896256 35.90024246 61.1297952 ]
E1 = -3.8661568517053544  E_coul = 1.0285221157193505
cycle= 12 E= -2.837634735986  delta_E= -7.99e-08  |g|= 2.14e-05  |ddm|= 3.53
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555471512286  LUMO = 1.60152043469957
  mo_energy =
[-0.90455547  1.60152043  7.55547105 18.03895603 35.90022484 61.12971657]
E1 = -3.8661568841933285  E_coul = 1.0285209939216649
cycle= 13 E= -2.83763589027166  delta_E= -1.15e-06  |g|= 0.000116  |ddm|= 0.656
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555231938135  LUMO = 1.60152252565971
  mo_energy =
[-0.90455523  1.60152253  7.5554802  18.03900393 35.90031918 61.12999627]
E1 = -3.8661566791917843  E_coul = 1.0285229809521357
cycle= 14 E= -2.83763369823965  delta_E= 2.19e-06  |g|= 5.21e-05  |ddm|= 3.67
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554906842892  LUMO = 1.60152972635702
  mo_energy =
[-0.90455491  1.60152973  7.55551872 18.03911401 35.90047267 61.13021095]
E1 = -3.8661560498977408  E_coul = 1.0285204461193915
cycle= 15 E= -2.83763560377835  delta_E= -1.91e-06  |g|= 0.000142  |ddm|= 7.95
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554280189862  LUMO = 1.60154224552071
  mo_energy =
[-0.90455428  1.60154225  7.55558187 18.03933207 35.90081695 61.13097553]
E1 = -3.8661548508275856  E_coul = 1.0285191500981834
cycle= 16 E= -2.8376357007294  delta_E= -9.7e-08  |g|= 0.000216  |ddm|= 16.7
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455422573447  LUMO = 1.60154292932217
  mo_energy =
[-0.90455423  1.60154293  7.55558307 18.0393716  35.9009152  61.13139749]
E1 = -3.8661546976691357  E_coul = 1.0285197110128108
cycle= 17 E= -2.83763498665633  delta_E= 7.14e-07  |g|= 0.000157  |ddm|=  3.5
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555295304635  LUMO = 1.60152242255019
  mo_energy =
[-0.9045553   1.60152242  7.55547868 18.03901453 35.90035171 61.13022102]
E1 = -3.86615662539646  E_coul = 1.0285200674636867
cycle= 18 E= -2.83763655793277  delta_E= -1.57e-06  |g|= 0.000202  |ddm|= 26.9
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455606166483  LUMO = 1.60150764515249
  mo_energy =
[-0.90455606  1.60150765  7.55540225 18.03876805 35.89997766 61.12951649]
E1 = -3.8661579729922044  E_coul = 1.028521262687913
cycle= 19 E= -2.83763671030429  delta_E= -1.52e-07  |g|= 0.000146  |ddm|= 18.3
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556939846634  LUMO = 1.60149004309462
  mo_energy =
[-0.90455694  1.60149004  7.55531051 18.03846708 35.89951334 61.12860057]
E1 = -3.866159591191244  E_coul = 1.0285233527980873
cycle= 20 E= -2.83763623839316  delta_E= 4.72e-07  |g|= 4.42e-05  |ddm|= 22.2
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557033885601  LUMO = 1.60148961143503
  mo_energy =
[-0.90455703  1.60148961  7.55531131 18.03844324 35.89944907 61.12827015]
E1 = -3.866159702257086  E_coul = 1.0285248507526408
cycle= 21 E= -2.83763485150445  delta_E= 1.39e-06  |g|= 9.35e-05  |ddm|= 2.58
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455666340353  LUMO = 1.60149715001805
  mo_energy =
[-0.90455666  1.60149715  7.55535091 18.03856324 35.89962337 61.12855555]
E1 = -3.866159028931568  E_coul = 1.028522159967921
cycle= 22 E= -2.83763686896365  delta_E= -2.02e-06  |g|= 0.000118  |ddm|=  8.8
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557032081809  LUMO = 1.60148979950079
  mo_energy =
[-0.90455703  1.6014898   7.55531313 18.03843706 35.899426   61.12813738]
E1 = -3.8661597140646804  E_coul = 1.0285238274501252
cycle= 23 E= -2.83763588661456  delta_E= 9.82e-07  |g|= 8.75e-06  |ddm|= 9.47
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557012707647  LUMO = 1.60149032041439
  mo_energy =
[-0.90455701  1.60149032  7.55531614 18.03844387 35.89943361 61.12813107]
E1 = -3.8661596734687227  E_coul = 1.0285261562798433
cycle= 24 E= -2.83763351718888  delta_E= 2.37e-06  |g|= 0.000234  |ddm|= 0.433
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556772707222  LUMO = 1.60149462617987
  mo_energy =
[-0.90455677  1.60149463  7.55533678 18.03852894 35.89958159 61.12853309]
E1 = -3.8661592302581176  E_coul = 1.0285213241391387
cycle= 25 E= -2.83763790611898  delta_E= -4.39e-06  |g|= 0.000204  |ddm|= 6.73
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557554598829  LUMO = 1.60147891162216
  mo_energy =
[-0.90455755  1.60147891  7.55525539 18.03826155 35.89917073 61.12774685]
E1 = -3.8661606800916464  E_coul = 1.0285271439176003
cycle= 26 E= -2.83763353617405  delta_E= 4.37e-06  |g|= 0.000268  |ddm|= 19.8
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558733167848  LUMO = 1.60145525060503
  mo_energy =
[-0.90455873  1.60145525  7.55513253 18.03785526 35.89853861 61.12648823]
E1 = -3.866162862804922  E_coul = 1.028527532115344
cycle= 27 E= -2.83763533068958  delta_E= -1.79e-06  |g|= 0.000202  |ddm|=   30
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557304245902  LUMO = 1.6014842429597
  mo_energy =
[-0.9045573   1.60148424  7.55528671 18.03833863 35.89926738 61.12770556]
E1 = -3.8661602820576175  E_coul = 1.0285247332933876
cycle= 28 E= -2.83763554876423  delta_E= -2.18e-07  |g|= 7.32e-05  |ddm|= 34.6
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557174423957  LUMO = 1.60148613040525
  mo_energy =
[-0.90455717  1.60148613  7.55529585 18.03837407 35.8993276  61.1278611 ]
E1 = -3.86616009831314  E_coul = 1.0285276947699227
cycle= 29 E= -2.83763240354322  delta_E= 3.15e-06  |g|= 0.000338  |ddm|= 2.75
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556841558528  LUMO = 1.60149227525871
  mo_energy =
[-0.90455684  1.60149228  7.55532706 18.03848048 35.89949532 61.12822163]
E1 = -3.8661595224253937  E_coul = 1.0285234886361907
cycle= 30 E= -2.8376360337892  delta_E= -3.63e-06  |g|= 1.2e-05  |ddm|= 8.04
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455649428128  LUMO = 1.60149896315159
  mo_energy =
[-0.90455649  1.60149896  7.55536119 18.03860057 35.89969009 61.12866079]
E1 = -3.866158889017878  E_coul = 1.0285244157730447
cycle= 31 E= -2.83763447324483  delta_E= 1.56e-06  |g|= 9.38e-05  |ddm|=    9
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556049223759  LUMO = 1.60150774956924
  mo_energy =
[-0.90455605  1.60150775  7.55540557 18.03875248 35.89992921 61.12919497]
E1 = -3.8661580527531636  E_coul = 1.028521919972451
cycle= 32 E= -2.83763613278071  delta_E= -1.66e-06  |g|= 0.000102  |ddm|= 11.6
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556682016844  LUMO = 1.60149630389777
  mo_energy =
[-0.90455668  1.6014963   7.55534769 18.03853817 35.89957001 61.12836696]
E1 = -3.8661591507694224  E_coul = 1.0285234736400617
cycle= 33 E= -2.83763567712936  delta_E= 4.56e-07  |g|= 2.29e-05  |ddm|= 16.1
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556207008321  LUMO = 1.60150475486544
  mo_energy =
[-0.90455621  1.60150475  7.55539003 18.03869377 35.89982717 61.12895887]
E1 = -3.866158337907731  E_coul = 1.0285232809571974
cycle= 34 E= -2.83763505695053  delta_E= 6.2e-07  |g|= 1.81e-05  |ddm|= 11.8
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556218979827  LUMO = 1.6015045650766
  mo_energy =
[-0.90455622  1.60150457  7.55538876 18.03869621 35.8998371  61.12899916]
E1 = -3.8661583393362364  E_coul = 1.0285224305743097
cycle= 35 E= -2.83763590876193  delta_E= -8.52e-07  |g|= 7.4e-05  |ddm|= 0.219
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455692323487  LUMO = 1.60149198294911
  mo_energy =
[-0.90455692  1.60149198  7.55532505 18.03846436 35.8994522  61.12811424]
E1 = -3.8661595378933415  E_coul = 1.0285255773629332
cycle= 36 E= -2.83763396053041  delta_E= 1.95e-06  |g|= 0.00019  |ddm|= 17.4
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557246485265  LUMO = 1.60148573763325
  mo_energy =
[-0.90455725  1.60148574  7.55529326 18.03835612 35.89928137 61.12775332]
E1 = -3.8661601245129935  E_coul = 1.0285260649326846
cycle= 37 E= -2.83763405958031  delta_E= -9.9e-08  |g|= 0.000206  |ddm|= 8.17
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556938283677  LUMO = 1.6014920491307
  mo_energy =
[-0.90455694  1.60149205  7.55532616 18.0384587  35.89943437 61.12804025]
E1 = -3.866159552377246  E_coul = 1.0285268432830927
cycle= 38 E= -2.83763270909415  delta_E= 1.35e-06  |g|= 0.000309  |ddm|= 7.62
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557002666051  LUMO = 1.60149080818571
  mo_energy =
[-0.904557    1.60149081  7.55531989 18.03843664 35.89939868 61.12795888]
E1 = -3.8661596706837944  E_coul = 1.0285234707800361
cycle= 39 E= -2.83763619990376  delta_E= -3.49e-06  |g|= 2.4e-05  |ddm|= 1.68
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557037552556  LUMO = 1.601489809207
  mo_energy =
[-0.90455704  1.60148981  7.55531418 18.03842386 35.89938483 61.12796233]
E1 = -3.8661597496861653  E_coul = 1.028525870547448
cycle= 40 E= -2.83763387913872  delta_E= 2.32e-06  |g|= 0.000204  |ddm|= 0.847
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556983078582  LUMO = 1.60149080951637
  mo_energy =
[-0.90455698  1.60149081  7.55531919 18.03844943 35.8994344  61.12808854]
E1 = -3.8661596411254333  E_coul = 1.0285247558064208
cycle= 41 E= -2.83763488531901  delta_E= -1.01e-06  |g|= 8.87e-05  |ddm|= 1.86
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556793333151  LUMO = 1.60149484342029
  mo_energy =
[-0.90455679  1.60149484  7.55534042 18.0385132  35.89952605 61.12824181]
E1 = -3.86615927942067  E_coul = 1.0285246156519035
cycle= 42 E= -2.83763466376877  delta_E= 2.22e-07  |g|= 0.000105  |ddm|=  4.7
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557108836634  LUMO = 1.60148926898525
  mo_energy =
[-0.90455711  1.60148927  7.55531371 18.03838638 35.89928893 61.12762036]
E1 = -3.8661598780307984  E_coul = 1.0285258754767845
cycle= 43 E= -2.83763400255401  delta_E= 6.61e-07  |g|= 0.000204  |ddm|= 9.71
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556402246703  LUMO = 1.60150137773413
  mo_energy =
[-0.9045564   1.60150138  7.55537221 18.0386113  35.89967762 61.12882213]
E1 = -3.8661586740091414  E_coul = 1.0285237843509751
cycle= 44 E= -2.83763488965817  delta_E= -8.87e-07  |g|= 6.27e-05  |ddm|= 17.9
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556069150442  LUMO = 1.60150342161078
  mo_energy =
[-0.90455607  1.60150342  7.55537661 18.03870249 35.89989552 61.12951104]
E1 = -3.86615834066877  E_coul = 1.028524553417023
cycle= 45 E= -2.83763378725175  delta_E= 1.1e-06  |g|= 0.000114  |ddm|=  7.6
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455525755184  LUMO = 1.60152110961556
  mo_energy =
[-0.90455526  1.60152111  7.55547027 18.03899709 35.9003369  61.13020099]
E1 = -3.8661567479613432  E_coul = 1.0285200065531104
cycle= 46 E= -2.83763674140823  delta_E= -2.95e-06  |g|= 0.000231  |ddm|= 21.3
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556264476202  LUMO = 1.60150307591538
  mo_energy =
[-0.90455626  1.60150308  7.55538105 18.03865697 35.89976236 61.12882691]
E1 = -3.8661585123754842  E_coul = 1.0285259929993584
cycle= 47 E= -2.83763251937613  delta_E= 4.22e-06  |g|= 0.000267  |ddm|=   26
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555744013023  LUMO = 1.60151277293295
  mo_energy =
[-0.90455574  1.60151277  7.55543001 18.03883015 35.90004172 61.12944336]
E1 = -3.866157590355552  E_coul = 1.0285210906603477
cycle= 48 E= -2.8376364996952  delta_E= -3.98e-06  |g|= 0.000161  |ddm|= 13.1
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555985420888  LUMO = 1.60150846269412
  mo_energy =
[-0.90455599  1.60150846  7.55540892 18.03875054 35.89990837 61.12911112]
E1 = -3.866158015330445  E_coul = 1.0285222011007211
cycle= 49 E= -2.83763581422972  delta_E= 6.85e-07  |g|= 6.67e-05  |ddm|= 6.22
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555985395561  LUMO = 1.60150809655024
  mo_energy =
[-0.90455599  1.6015081   7.55540645 18.0387498  35.89991525 61.12916329]
E1 = -3.8661580344594952  E_coul = 1.02852403378135
cycle= 50 E= -2.83763400067815  delta_E= 1.81e-06  |g|= 9.53e-05  |ddm|= 0.035
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8661580344594952  E_coul = 1.02852403378135

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904554983549288  LUMO = 1.6015298959265
  mo_energy =
[-0.90455498  1.6015299   7.55552172 18.03911955 35.90047901 61.13017625]
E1 = -3.8661560455752237  E_coul = 1.0285220979188363
Extra cycle  E= -2.83763394765639  delta_E= 5.3e-08  |g|= 1.15e-05  |ddm|= 26.8
    CPU time for scf_cycle      0.49 sec, wall time      0.50 sec
exp = [6.32150744 5.57366185 4.90667362 4.21429975 3.81122297 0.37756212]
E = -2.8376339476563874
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:47 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.32150744467        1
[INPUT] 0    0    [1    /1   ]  5.57366184729        1
[INPUT] 0    0    [1    /1   ]  4.90667362332        1
[INPUT] 0    0    [1    /1   ]  4.21429975271        1
[INPUT] 0    0    [1    /1   ]  3.81122296996        1
[INPUT] 0    0    [1    /1   ]  0.377562121144       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.321507444666254, 1.0]], [0, [5.573661847289185, 1.0]], [0, [4.906673623319631, 1.0]], [0, [4.214299752705042, 1.0]], [0, [3.8112229699645863, 1.0]], [0, [0.3775621211444727, 1.0]]]}
ecp = {}
CPU time:        44.82
Set gradient conv threshold to 3.16228e-05
cond(S) = 981582528.2681699

WARN: Singularity detected in overlap matrix (condition number = 9.82e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8566453587062797  E_coul = 1.024220719202386
init E= -2.83242463950389
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906698462655637  LUMO = 1.59761452680304
  mo_energy =
[-0.90669846  1.59761453  7.55072424 18.03422859 35.89546454 61.1257416 ]
E1 = -3.8664042463246275  E_coul = 1.0287731464295047
cycle= 1 E= -2.83763109989512  delta_E= -0.00521  |g|= 0.00607  |ddm|= 1.06e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904429868205076  LUMO = 1.60160109607292
  mo_energy =
[-0.90442987  1.6016011   7.55579907 18.03973178 35.90136177 61.13188976]
E1 = -3.8661549402493143  E_coul = 1.028521649660744
cycle= 2 E= -2.83763329058857  delta_E= -2.19e-06  |g|= 0.000391  |ddm|=  600
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904563252435695  LUMO = 1.60153463116665
  mo_energy =
[-0.90456325  1.60153463  7.55556161 18.03931639 35.90082229 61.1311543 ]
E1 = -3.866153079351691  E_coul = 1.0285182917463873
cycle= 3 E= -2.8376347876053  delta_E= -1.5e-06  |g|= 0.000145  |ddm|= 81.9
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904557051043565  LUMO = 1.60150834539367
  mo_energy =
[-0.90455705  1.60150835  7.55541561 18.03871809 35.8997852  61.12841463]
E1 = -3.8661579092248584  E_coul = 1.028522572151247
cycle= 4 E= -2.83763533707361  delta_E= -5.49e-07  |g|= 2.24e-05  |ddm|= 52.3
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904556411892815  LUMO = 1.60150131285844
  mo_energy =
[-0.90455641  1.60150131  7.55536898 18.03867135 35.89984517 61.12925071]
E1 = -3.8661585230458244  E_coul = 1.0285235853986814
cycle= 5 E= -2.83763493764714  delta_E= 3.99e-07  |g|= 2.11e-05  |ddm|= 3.35
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556023560035  LUMO = 1.60150699254124
  mo_energy =
[-0.90455602  1.60150699  7.55540191 18.03872563 35.89986895 61.12898735]
E1 = -3.8661581730624053  E_coul = 1.0285227551162461
cycle= 6 E= -2.83763541794616  delta_E= -4.8e-07  |g|= 1.7e-05  |ddm|= 2.99
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556125066354  LUMO = 1.60150425803816
  mo_energy =
[-0.90455613  1.60150426  7.55538583 18.03869686 35.89984855 61.12907555]
E1 = -3.8661583683161784  E_coul = 1.0285237606867808
cycle= 7 E= -2.8376346076294  delta_E= 8.1e-07  |g|= 5.42e-05  |ddm|= 1.73
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555948506585  LUMO = 1.60150760012838
  mo_energy =
[-0.90455595  1.6015076   7.55540344 18.03875068 35.89992883 61.12921507]
E1 = -3.8661580748253335  E_coul = 1.0285237319332203
cycle= 8 E= -2.83763434289211  delta_E= 2.65e-07  |g|= 5.86e-05  |ddm|= 3.91
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555818172831  LUMO = 1.60151077621804
  mo_energy =
[-0.90455582  1.60151078  7.55542034 18.03879738 35.89999045 61.12929364]
E1 = -3.866157794108786  E_coul = 1.0285256421049804
cycle= 9 E= -2.83763215200381  delta_E= 2.19e-06  |g|= 0.000257  |ddm|= 3.45
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455538565036  LUMO = 1.60151990370087
  mo_energy =
[-0.90455539  1.6015199   7.5554672  18.03895583 35.90023943 61.12980856]
E1 = -3.866156931131314  E_coul = 1.0285227824185532
cycle= 10 E= -2.83763414871276  delta_E= -2e-06  |g|= 2.89e-05  |ddm|= 11.9
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555353470889  LUMO = 1.60152313802233
  mo_energy =
[-0.90455535  1.60152314  7.55548435 18.03900996 35.9003194  61.12995722]
E1 = -3.8661566030232564  E_coul = 1.0285219469839861
cycle= 11 E= -2.83763465603927  delta_E= -5.07e-07  |g|= 2.41e-05  |ddm|= 4.21
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555494454157  LUMO = 1.60152049707915
  mo_energy =
[-0.90455549  1.6015205   7.55547088 18.03896256 35.90024246 61.1297952 ]
E1 = -3.8661568517053544  E_coul = 1.0285221157193505
cycle= 12 E= -2.837634735986  delta_E= -7.99e-08  |g|= 2.14e-05  |ddm|= 3.53
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555471512286  LUMO = 1.60152043469957
  mo_energy =
[-0.90455547  1.60152043  7.55547105 18.03895603 35.90022484 61.12971657]
E1 = -3.8661568841933285  E_coul = 1.0285209939216649
cycle= 13 E= -2.83763589027166  delta_E= -1.15e-06  |g|= 0.000116  |ddm|= 0.656
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555231938135  LUMO = 1.60152252565971
  mo_energy =
[-0.90455523  1.60152253  7.5554802  18.03900393 35.90031918 61.12999627]
E1 = -3.8661566791917843  E_coul = 1.0285229809521357
cycle= 14 E= -2.83763369823965  delta_E= 2.19e-06  |g|= 5.21e-05  |ddm|= 3.67
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554906842892  LUMO = 1.60152972635702
  mo_energy =
[-0.90455491  1.60152973  7.55551872 18.03911401 35.90047267 61.13021095]
E1 = -3.8661560498977408  E_coul = 1.0285204461193915
cycle= 15 E= -2.83763560377835  delta_E= -1.91e-06  |g|= 0.000142  |ddm|= 7.95
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554280189862  LUMO = 1.60154224552071
  mo_energy =
[-0.90455428  1.60154225  7.55558187 18.03933207 35.90081695 61.13097553]
E1 = -3.8661548508275856  E_coul = 1.0285191500981834
cycle= 16 E= -2.8376357007294  delta_E= -9.7e-08  |g|= 0.000216  |ddm|= 16.7
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455422573447  LUMO = 1.60154292932217
  mo_energy =
[-0.90455423  1.60154293  7.55558307 18.0393716  35.9009152  61.13139749]
E1 = -3.8661546976691357  E_coul = 1.0285197110128108
cycle= 17 E= -2.83763498665633  delta_E= 7.14e-07  |g|= 0.000157  |ddm|=  3.5
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555295304635  LUMO = 1.60152242255019
  mo_energy =
[-0.9045553   1.60152242  7.55547868 18.03901453 35.90035171 61.13022102]
E1 = -3.86615662539646  E_coul = 1.0285200674636867
cycle= 18 E= -2.83763655793277  delta_E= -1.57e-06  |g|= 0.000202  |ddm|= 26.9
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455606166483  LUMO = 1.60150764515249
  mo_energy =
[-0.90455606  1.60150765  7.55540225 18.03876805 35.89997766 61.12951649]
E1 = -3.8661579729922044  E_coul = 1.028521262687913
cycle= 19 E= -2.83763671030429  delta_E= -1.52e-07  |g|= 0.000146  |ddm|= 18.3
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556939846634  LUMO = 1.60149004309462
  mo_energy =
[-0.90455694  1.60149004  7.55531051 18.03846708 35.89951334 61.12860057]
E1 = -3.866159591191244  E_coul = 1.0285233527980873
cycle= 20 E= -2.83763623839316  delta_E= 4.72e-07  |g|= 4.42e-05  |ddm|= 22.2
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557033885601  LUMO = 1.60148961143503
  mo_energy =
[-0.90455703  1.60148961  7.55531131 18.03844324 35.89944907 61.12827015]
E1 = -3.866159702257086  E_coul = 1.0285248507526408
cycle= 21 E= -2.83763485150445  delta_E= 1.39e-06  |g|= 9.35e-05  |ddm|= 2.58
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455666340353  LUMO = 1.60149715001805
  mo_energy =
[-0.90455666  1.60149715  7.55535091 18.03856324 35.89962337 61.12855555]
E1 = -3.866159028931568  E_coul = 1.028522159967921
cycle= 22 E= -2.83763686896365  delta_E= -2.02e-06  |g|= 0.000118  |ddm|=  8.8
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557032081809  LUMO = 1.60148979950079
  mo_energy =
[-0.90455703  1.6014898   7.55531313 18.03843706 35.899426   61.12813738]
E1 = -3.8661597140646804  E_coul = 1.0285238274501252
cycle= 23 E= -2.83763588661456  delta_E= 9.82e-07  |g|= 8.75e-06  |ddm|= 9.47
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557012707647  LUMO = 1.60149032041439
  mo_energy =
[-0.90455701  1.60149032  7.55531614 18.03844387 35.89943361 61.12813107]
E1 = -3.8661596734687227  E_coul = 1.0285261562798433
cycle= 24 E= -2.83763351718888  delta_E= 2.37e-06  |g|= 0.000234  |ddm|= 0.433
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556772707222  LUMO = 1.60149462617987
  mo_energy =
[-0.90455677  1.60149463  7.55533678 18.03852894 35.89958159 61.12853309]
E1 = -3.8661592302581176  E_coul = 1.0285213241391387
cycle= 25 E= -2.83763790611898  delta_E= -4.39e-06  |g|= 0.000204  |ddm|= 6.73
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557554598829  LUMO = 1.60147891162216
  mo_energy =
[-0.90455755  1.60147891  7.55525539 18.03826155 35.89917073 61.12774685]
E1 = -3.8661606800916464  E_coul = 1.0285271439176003
cycle= 26 E= -2.83763353617405  delta_E= 4.37e-06  |g|= 0.000268  |ddm|= 19.8
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558733167848  LUMO = 1.60145525060503
  mo_energy =
[-0.90455873  1.60145525  7.55513253 18.03785526 35.89853861 61.12648823]
E1 = -3.866162862804922  E_coul = 1.028527532115344
cycle= 27 E= -2.83763533068958  delta_E= -1.79e-06  |g|= 0.000202  |ddm|=   30
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557304245902  LUMO = 1.6014842429597
  mo_energy =
[-0.9045573   1.60148424  7.55528671 18.03833863 35.89926738 61.12770556]
E1 = -3.8661602820576175  E_coul = 1.0285247332933876
cycle= 28 E= -2.83763554876423  delta_E= -2.18e-07  |g|= 7.32e-05  |ddm|= 34.6
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557174423957  LUMO = 1.60148613040525
  mo_energy =
[-0.90455717  1.60148613  7.55529585 18.03837407 35.8993276  61.1278611 ]
E1 = -3.86616009831314  E_coul = 1.0285276947699227
cycle= 29 E= -2.83763240354322  delta_E= 3.15e-06  |g|= 0.000338  |ddm|= 2.75
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556841558528  LUMO = 1.60149227525871
  mo_energy =
[-0.90455684  1.60149228  7.55532706 18.03848048 35.89949532 61.12822163]
E1 = -3.8661595224253937  E_coul = 1.0285234886361907
cycle= 30 E= -2.8376360337892  delta_E= -3.63e-06  |g|= 1.2e-05  |ddm|= 8.04
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455649428128  LUMO = 1.60149896315159
  mo_energy =
[-0.90455649  1.60149896  7.55536119 18.03860057 35.89969009 61.12866079]
E1 = -3.866158889017878  E_coul = 1.0285244157730447
cycle= 31 E= -2.83763447324483  delta_E= 1.56e-06  |g|= 9.38e-05  |ddm|=    9
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556049223759  LUMO = 1.60150774956924
  mo_energy =
[-0.90455605  1.60150775  7.55540557 18.03875248 35.89992921 61.12919497]
E1 = -3.8661580527531636  E_coul = 1.028521919972451
cycle= 32 E= -2.83763613278071  delta_E= -1.66e-06  |g|= 0.000102  |ddm|= 11.6
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556682016844  LUMO = 1.60149630389777
  mo_energy =
[-0.90455668  1.6014963   7.55534769 18.03853817 35.89957001 61.12836696]
E1 = -3.8661591507694224  E_coul = 1.0285234736400617
cycle= 33 E= -2.83763567712936  delta_E= 4.56e-07  |g|= 2.29e-05  |ddm|= 16.1
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556207008321  LUMO = 1.60150475486544
  mo_energy =
[-0.90455621  1.60150475  7.55539003 18.03869377 35.89982717 61.12895887]
E1 = -3.866158337907731  E_coul = 1.0285232809571974
cycle= 34 E= -2.83763505695053  delta_E= 6.2e-07  |g|= 1.81e-05  |ddm|= 11.8
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556218979827  LUMO = 1.6015045650766
  mo_energy =
[-0.90455622  1.60150457  7.55538876 18.03869621 35.8998371  61.12899916]
E1 = -3.8661583393362364  E_coul = 1.0285224305743097
cycle= 35 E= -2.83763590876193  delta_E= -8.52e-07  |g|= 7.4e-05  |ddm|= 0.219
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455692323487  LUMO = 1.60149198294911
  mo_energy =
[-0.90455692  1.60149198  7.55532505 18.03846436 35.8994522  61.12811424]
E1 = -3.8661595378933415  E_coul = 1.0285255773629332
cycle= 36 E= -2.83763396053041  delta_E= 1.95e-06  |g|= 0.00019  |ddm|= 17.4
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557246485265  LUMO = 1.60148573763325
  mo_energy =
[-0.90455725  1.60148574  7.55529326 18.03835612 35.89928137 61.12775332]
E1 = -3.8661601245129935  E_coul = 1.0285260649326846
cycle= 37 E= -2.83763405958031  delta_E= -9.9e-08  |g|= 0.000206  |ddm|= 8.17
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556938283677  LUMO = 1.6014920491307
  mo_energy =
[-0.90455694  1.60149205  7.55532616 18.0384587  35.89943437 61.12804025]
E1 = -3.866159552377246  E_coul = 1.0285268432830927
cycle= 38 E= -2.83763270909415  delta_E= 1.35e-06  |g|= 0.000309  |ddm|= 7.62
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557002666051  LUMO = 1.60149080818571
  mo_energy =
[-0.904557    1.60149081  7.55531989 18.03843664 35.89939868 61.12795888]
E1 = -3.8661596706837944  E_coul = 1.0285234707800361
cycle= 39 E= -2.83763619990376  delta_E= -3.49e-06  |g|= 2.4e-05  |ddm|= 1.68
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557037552556  LUMO = 1.601489809207
  mo_energy =
[-0.90455704  1.60148981  7.55531418 18.03842386 35.89938483 61.12796233]
E1 = -3.8661597496861653  E_coul = 1.028525870547448
cycle= 40 E= -2.83763387913872  delta_E= 2.32e-06  |g|= 0.000204  |ddm|= 0.847
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556983078582  LUMO = 1.60149080951637
  mo_energy =
[-0.90455698  1.60149081  7.55531919 18.03844943 35.8994344  61.12808854]
E1 = -3.8661596411254333  E_coul = 1.0285247558064208
cycle= 41 E= -2.83763488531901  delta_E= -1.01e-06  |g|= 8.87e-05  |ddm|= 1.86
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556793333151  LUMO = 1.60149484342029
  mo_energy =
[-0.90455679  1.60149484  7.55534042 18.0385132  35.89952605 61.12824181]
E1 = -3.86615927942067  E_coul = 1.0285246156519035
cycle= 42 E= -2.83763466376877  delta_E= 2.22e-07  |g|= 0.000105  |ddm|=  4.7
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557108836634  LUMO = 1.60148926898525
  mo_energy =
[-0.90455711  1.60148927  7.55531371 18.03838638 35.89928893 61.12762036]
E1 = -3.8661598780307984  E_coul = 1.0285258754767845
cycle= 43 E= -2.83763400255401  delta_E= 6.61e-07  |g|= 0.000204  |ddm|= 9.71
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556402246703  LUMO = 1.60150137773413
  mo_energy =
[-0.9045564   1.60150138  7.55537221 18.0386113  35.89967762 61.12882213]
E1 = -3.8661586740091414  E_coul = 1.0285237843509751
cycle= 44 E= -2.83763488965817  delta_E= -8.87e-07  |g|= 6.27e-05  |ddm|= 17.9
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556069150442  LUMO = 1.60150342161078
  mo_energy =
[-0.90455607  1.60150342  7.55537661 18.03870249 35.89989552 61.12951104]
E1 = -3.86615834066877  E_coul = 1.028524553417023
cycle= 45 E= -2.83763378725175  delta_E= 1.1e-06  |g|= 0.000114  |ddm|=  7.6
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455525755184  LUMO = 1.60152110961556
  mo_energy =
[-0.90455526  1.60152111  7.55547027 18.03899709 35.9003369  61.13020099]
E1 = -3.8661567479613432  E_coul = 1.0285200065531104
cycle= 46 E= -2.83763674140823  delta_E= -2.95e-06  |g|= 0.000231  |ddm|= 21.3
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556264476202  LUMO = 1.60150307591538
  mo_energy =
[-0.90455626  1.60150308  7.55538105 18.03865697 35.89976236 61.12882691]
E1 = -3.8661585123754842  E_coul = 1.0285259929993584
cycle= 47 E= -2.83763251937613  delta_E= 4.22e-06  |g|= 0.000267  |ddm|=   26
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555744013023  LUMO = 1.60151277293295
  mo_energy =
[-0.90455574  1.60151277  7.55543001 18.03883015 35.90004172 61.12944336]
E1 = -3.866157590355552  E_coul = 1.0285210906603477
cycle= 48 E= -2.8376364996952  delta_E= -3.98e-06  |g|= 0.000161  |ddm|= 13.1
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555985420888  LUMO = 1.60150846269412
  mo_energy =
[-0.90455599  1.60150846  7.55540892 18.03875054 35.89990837 61.12911112]
E1 = -3.866158015330445  E_coul = 1.0285222011007211
cycle= 49 E= -2.83763581422972  delta_E= 6.85e-07  |g|= 6.67e-05  |ddm|= 6.22
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555985395561  LUMO = 1.60150809655024
  mo_energy =
[-0.90455599  1.6015081   7.55540645 18.0387498  35.89991525 61.12916329]
E1 = -3.8661580344594952  E_coul = 1.02852403378135
cycle= 50 E= -2.83763400067815  delta_E= 1.81e-06  |g|= 9.53e-05  |ddm|= 0.035
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8661580344594952  E_coul = 1.02852403378135

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904554983549288  LUMO = 1.6015298959265
  mo_energy =
[-0.90455498  1.6015299   7.55552172 18.03911955 35.90047901 61.13017625]
E1 = -3.8661560455752237  E_coul = 1.0285220979188363
Extra cycle  E= -2.83763394765639  delta_E= 5.3e-08  |g|= 1.15e-05  |ddm|= 26.8
    CPU time for scf_cycle      0.53 sec, wall time      0.53 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 981582528.2681699

WARN: Singularity detected in overlap matrix (condition number = 9.82e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8661560455752237  E_coul = 1.0285220979188363
init E= -2.83763394765639
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.904555924882861  LUMO = 1.60152785064758
  mo_energy =
[-0.90455592  1.60152785  7.55550726 18.03910848 35.90049122 61.13055538]
E1 = -3.866155852804987  E_coul = 1.0285188248218637
cycle= 1 E= -2.83763702798312  delta_E= -3.08e-06  |g|= 0.000292  |ddm|= 2.54
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904559102293037  LUMO = 1.60147088355686
  mo_energy =
[-0.9045591   1.60147088  7.55522212 18.03808272 35.89881941 61.12664537]
E1 = -3.8661613075101977  E_coul = 1.0285255265610556
cycle= 2 E= -2.83763578094914  delta_E= 1.25e-06  |g|= 0.000109  |ddm|= 78.3
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904558917089823  LUMO = 1.60147210460209
  mo_energy =
[-0.90455892  1.6014721   7.55522802 18.03810291 35.89885152 61.12671199]
E1 = -3.8661612250599546  E_coul = 1.0285252569263226
cycle= 3 E= -2.83763596813363  delta_E= -1.87e-07  |g|= 8.64e-05  |ddm|= 1.33
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558917016958  LUMO = 1.60147201177096
  mo_energy =
[-0.90455892  1.60147201  7.55522756 18.03810069 35.89884728 61.1267003 ]
E1 = -3.8661612362370454  E_coul = 1.0285268611215213
cycle= 4 E= -2.83763437511552  delta_E= 1.59e-06  |g|= 0.000243  |ddm|= 0.175
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558855474779  LUMO = 1.60147303877189
  mo_energy =
[-0.90455886  1.60147304  7.55523266 18.03811989 35.89887961 61.12677884]
E1 = -3.866161137174416  E_coul = 1.0285254229864609
cycle= 5 E= -2.83763571418795  delta_E= -1.34e-06  |g|= 9.99e-05  |ddm|= 1.46
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558865124151  LUMO = 1.60147289370079
  mo_energy =
[-0.90455887  1.60147289  7.55523204 18.03811636 35.89887267 61.12675717]
E1 = -3.866161154204666  E_coul = 1.0285256154962685
cycle= 6 E= -2.8376355387084  delta_E= 1.75e-07  |g|= 0.000148  |ddm|= 0.291
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558865318004  LUMO = 1.60147280515045
  mo_energy =
[-0.90455887  1.60147281  7.55523144 18.03811632 35.89887471 61.12677236]
E1 = -3.8661611583736475  E_coul = 1.0285256835496
cycle= 7 E= -2.83763547482405  delta_E= 6.39e-08  |g|= 0.000126  |ddm|= 0.0234
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558861788855  LUMO = 1.60147288304763
  mo_energy =
[-0.90455886  1.60147288  7.5552319  18.03811661 35.89887382 61.12676429]
E1 = -3.866161154043572  E_coul = 1.0285268353996353
cycle= 8 E= -2.83763431864394  delta_E= 1.16e-06  |g|= 0.000239  |ddm|= 0.0104
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558837670344  LUMO = 1.60147333945339
  mo_energy =
[-0.90455884  1.60147334  7.55523424 18.03812455 35.89888641 61.12679146]
E1 = -3.866161111501596  E_coul = 1.028526269091667
cycle= 9 E= -2.83763484240993  delta_E= -5.24e-07  |g|= 0.000191  |ddm|= 0.595
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554659065335  LUMO = 1.60150645753629
  mo_energy =
[-0.90455466  1.60150646  7.55539541 18.03869242 35.8998067  61.12883146]
E1 = -3.8661586018953082  E_coul = 1.0285224014502063
cycle= 10 E= -2.8376362004451  delta_E= -1.36e-06  |g|= 7.48e-05  |ddm|= 39.3
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556190144302  LUMO = 1.60149199992803
  mo_energy =
[-0.90455619  1.601492    7.5553203  18.03847078 35.89948398 61.12835483]
E1 = -3.866159646328828  E_coul = 1.0285283120993478
cycle= 11 E= -2.83763133422948  delta_E= 4.87e-06  |g|= 0.000412  |ddm|= 14.4
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554688614936  LUMO = 1.60152073685537
  mo_energy =
[-0.90455469  1.60152074  7.55546739 18.03896487 35.90025916 61.12998136]
E1 = -3.866156972591014  E_coul = 1.0285202245178935
cycle= 12 E= -2.83763674807312  delta_E= -5.41e-06  |g|= 0.000218  |ddm|= 37.1
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555668519552  LUMO = 1.60150671706055
  mo_energy =
[-0.90455567  1.60150672  7.55539777 18.03871952 35.89986349 61.12906873]
E1 = -3.866158254626427  E_coul = 1.0285229618128273
cycle= 13 E= -2.8376352928136  delta_E= 1.46e-06  |g|= 1.47e-05  |ddm|= 18.5
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555681628289  LUMO = 1.60150728088635
  mo_energy =
[-0.90455568  1.60150728  7.55540126 18.03872963 35.89987801 61.1290803 ]
E1 = -3.8661582007841258  E_coul = 1.0285239659663667
cycle= 14 E= -2.83763423481776  delta_E= 1.06e-06  |g|= 7.67e-05  |ddm|= 0.647
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555507330063  LUMO = 1.60151168790284
  mo_energy =
[-0.90455551  1.60151169  7.55542518 18.03879767 35.8999723  61.12919635]
E1 = -3.8661578138268156  E_coul = 1.0285233915599161
cycle= 15 E= -2.8376344222669  delta_E= -1.87e-07  |g|= 4.76e-05  |ddm|= 4.84
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455536119206  LUMO = 1.60151522771018
  mo_energy =
[-0.90455536  1.60151523  7.55544364 18.0388595  35.90006955 61.12940194]
E1 = -3.8661574772777825  E_coul = 1.0285215489533404
cycle= 16 E= -2.83763592832444  delta_E= -1.51e-06  |g|= 9.48e-05  |ddm|= 4.62
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555431839303  LUMO = 1.60151428606719
  mo_energy =
[-0.90455543  1.60151429  7.55543858 18.03884728 35.90005561 61.12939936]
E1 = -3.866157546691866  E_coul = 1.028523297186585
cycle= 17 E= -2.83763424950528  delta_E= 1.68e-06  |g|= 5.66e-05  |ddm|= 0.814
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553414565835  LUMO = 1.60155283978514
  mo_energy =
[-0.90455341  1.60155284  7.5556361  18.03950843 35.9010897  61.13154166]
E1 = -3.866153966561013  E_coul = 1.0285205027429305
cycle= 18 E= -2.83763346381808  delta_E= 7.86e-07  |g|= 6.48e-05  |ddm|= 49.5
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554646543229  LUMO = 1.60152651843185
  mo_energy =
[-0.90455465  1.60152652  7.55550012 18.03906111 35.90039815 61.1301504 ]
E1 = -3.8661564282380527  E_coul = 1.0285218498023607
cycle= 19 E= -2.83763457843569  delta_E= -1.11e-06  |g|= 3.77e-05  |ddm|= 33.5
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555824202195  LUMO = 1.60150499847822
  mo_energy =
[-0.90455582  1.601505    7.55539082 18.03869168 35.89981707 61.12890114]
E1 = -3.8661584325668477  E_coul = 1.0285202114398944
cycle= 20 E= -2.83763822112695  delta_E= -3.64e-06  |g|= 0.000263  |ddm|= 27.9
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556451055144  LUMO = 1.60149259773663
  mo_energy =
[-0.90455645  1.6014926   7.55532694 18.03848145 35.89949265 61.12824959]
E1 = -3.8661595807049047  E_coul = 1.028523859288252
cycle= 21 E= -2.83763572141665  delta_E= 2.5e-06  |g|= 1.49e-05  |ddm|= 15.7
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556346987805  LUMO = 1.60149494601318
  mo_energy =
[-0.90455635  1.60149495  7.55533914 18.03851752 35.89954441 61.12834138]
E1 = -3.8661593674474193  E_coul = 1.0285224785133456
cycle= 22 E= -2.83763688893407  delta_E= -1.17e-06  |g|= 9.09e-05  |ddm|= 2.73
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556739587009  LUMO = 1.60148623578293
  mo_energy =
[-0.90455674  1.60148624  7.55529244 18.03838222 35.89935562 61.12808274]
E1 = -3.8661601300899977  E_coul = 1.028525273098488
cycle= 23 E= -2.83763485699151  delta_E= 2.03e-06  |g|= 0.000125  |ddm|= 9.69
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556457995985  LUMO = 1.60149153761869
  mo_energy =
[-0.90455646  1.60149154  7.5553192  18.03847675 35.89950893 61.12843259]
E1 = -3.8661596243926786  E_coul = 1.0285234313374794
cycle= 24 E= -2.8376361930552  delta_E= -1.34e-06  |g|= 3.66e-05  |ddm|=  7.2
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556393407225  LUMO = 1.60149344398996
  mo_energy =
[-0.90455639  1.60149344  7.55533023 18.0385027  35.89953872 61.1284198 ]
E1 = -3.866159474795123  E_coul = 1.0285227378529262
cycle= 25 E= -2.8376367369422  delta_E= -5.44e-07  |g|= 7.97e-05  |ddm|= 1.64
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556604948805  LUMO = 1.6014891832521
  mo_energy =
[-0.9045566   1.60148918  7.55530864 18.03842844 35.89942127 61.1281725 ]
E1 = -3.8661598794710192  E_coul = 1.0285253183512082
cycle= 26 E= -2.83763456111981  delta_E= 2.18e-06  |g|= 0.000134  |ddm|= 5.63
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556509437469  LUMO = 1.6014907564759
  mo_energy =
[-0.90455651  1.60149076  7.55531635 18.03845613 35.89946549 61.12827125]
E1 = -3.866159729631158  E_coul = 1.02852342342063
cycle= 27 E= -2.83763630621053  delta_E= -1.75e-06  |g|= 3.37e-05  |ddm|= 2.14
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557893625074  LUMO = 1.60146313917491
  mo_energy =
[-0.90455789  1.60146314  7.55517436 18.03798587 35.89873621 61.12678557]
E1 = -3.8661622979926706  E_coul = 1.028526137844985
cycle= 28 E= -2.83763616014769  delta_E= 1.46e-07  |g|= 0.000101  |ddm|= 35.3
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556608372049  LUMO = 1.60148841997446
  mo_energy =
[-0.90455661  1.60148842  7.55530254 18.03842268 35.89942554 61.12830967]
E1 = -3.866159903345339  E_coul = 1.028526470745198
cycle= 29 E= -2.83763343260014  delta_E= 2.73e-06  |g|= 0.000237  |ddm|= 33.3
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556344216669  LUMO = 1.60149330560225
  mo_energy =
[-0.90455634  1.60149331  7.55532683 18.03851294 35.89957549 61.12867022]
E1 = -3.866159427097486  E_coul = 1.0285225369795377
cycle= 30 E= -2.83763689011795  delta_E= -3.46e-06  |g|= 0.000109  |ddm|= 6.94
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556306843151  LUMO = 1.6014954539878
  mo_energy =
[-0.90455631  1.60149545  7.55533947 18.03853914 35.89959865 61.12862939]
E1 = -3.8661592567032743  E_coul = 1.0285215177715377
cycle= 31 E= -2.83763773893174  delta_E= -8.49e-07  |g|= 0.00018  |ddm|= 1.68
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556887903659  LUMO = 1.60148416716587
  mo_energy =
[-0.90455689  1.60148417  7.55528126 18.03834832 35.89930317 61.12802403]
E1 = -3.866160296667344  E_coul = 1.0285282526751687
cycle= 32 E= -2.83763204399218  delta_E= 5.69e-06  |g|= 0.000386  |ddm|= 14.3
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455659383726  LUMO = 1.60148943214876
  mo_energy =
[-0.90455659  1.60148943  7.55530707 18.03844331 35.89945903 61.12841275]
E1 = -3.8661597805951637  E_coul = 1.0285244800703595
cycle= 33 E= -2.8376353005248  delta_E= -3.26e-06  |g|= 6.16e-05  |ddm|= 7.45
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556271691355  LUMO = 1.60149564997077
  mo_energy =
[-0.90455627  1.60149565  7.55533854 18.03855179 35.89963245 61.12879695]
E1 = -3.866159192431655  E_coul = 1.0285224529464667
cycle= 34 E= -2.83763673948519  delta_E= -1.44e-06  |g|= 0.000117  |ddm|= 8.25
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556736379409  LUMO = 1.60148768619707
  mo_energy =
[-0.90455674  1.60148769  7.55530006 18.03840101 35.89937487 61.1281154 ]
E1 = -3.866159989060399  E_coul = 1.0285253376262173
cycle= 35 E= -2.83763465143418  delta_E= 2.09e-06  |g|= 0.000136  |ddm|= 11.9
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556487587461  LUMO = 1.60149256890626
  mo_energy =
[-0.90455649  1.60149257  7.55532482 18.03848384 35.89950329 61.12838402]
E1 = -3.8661595291174584  E_coul = 1.02852468531762
cycle= 36 E= -2.83763484379984  delta_E= -1.92e-07  |g|= 8.46e-05  |ddm|= 6.32
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559697375126  LUMO = 1.60143077504645
  mo_energy =
[-0.9045597   1.60143078  7.55501127 18.03740246 35.8977793  61.12456689]
E1 = -3.866165375898143  E_coul = 1.028529149577971
cycle= 37 E= -2.83763622632017  delta_E= -1.38e-06  |g|= 0.000265  |ddm|= 82.1
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556190366126  LUMO = 1.60149863180859
  mo_energy =
[-0.90455619  1.60149863  7.55535716 18.03858594 35.89965963 61.12865315]
E1 = -3.8661589879968923  E_coul = 1.0285232051278699
cycle= 38 E= -2.83763578286902  delta_E= 4.43e-07  |g|= 1.84e-05  |ddm|= 89.4
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455600186402  LUMO = 1.60150191533209
  mo_energy =
[-0.904556    1.60150192  7.55537355 18.0386449  35.899755   61.12885701]
E1 = -3.8661586755083692  E_coul = 1.0285233446088544
cycle= 39 E= -2.83763533089951  delta_E= 4.52e-07  |g|= 4.39e-06  |ddm|= 4.46
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555592871911  LUMO = 1.60151000006875
  mo_energy =
[-0.90455559  1.60151     7.55541591 18.03877625 35.89995003 61.12920414]
E1 = -3.8661579501071297  E_coul = 1.0285213696779016
cycle= 40 E= -2.83763658042923  delta_E= -1.25e-06  |g|= 0.000152  |ddm|= 9.64
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556238342559  LUMO = 1.60149769026382
  mo_energy =
[-0.90455624  1.60149769  7.55535364 18.03855576 35.89959231 61.12839803]
E1 = -3.8661591245799314  E_coul = 1.02852311616651
cycle= 41 E= -2.83763600841342  delta_E= 5.72e-07  |g|= 2.16e-05  |ddm|= 16.7
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556328253213  LUMO = 1.60149565403925
  mo_energy =
[-0.90455633  1.60149565  7.55534297 18.03852378 35.89954666 61.12831788]
E1 = -3.866159309363859  E_coul = 1.0285263065119385
cycle= 42 E= -2.83763300285192  delta_E= 3.01e-06  |g|= 0.000254  |ddm|=  2.4
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555794420294  LUMO = 1.60150545497917
  mo_energy =
[-0.90455579  1.60150545  7.5553922  18.03869893 35.89983137 61.1289764 ]
E1 = -3.8661583728087034  E_coul = 1.0285232776325048
cycle= 43 E= -2.8376350951762  delta_E= -2.09e-06  |g|= 9.11e-06  |ddm|= 13.4
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555854182612  LUMO = 1.6015044001493
  mo_energy =
[-0.90455585  1.6015044   7.55538724 18.03867833 35.89979597 61.12887827]
E1 = -3.8661584833357825  E_coul = 1.0285230441717876
cycle= 44 E= -2.83763543916399  delta_E= -3.44e-07  |g|= 1.1e-05  |ddm|= 1.67
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555932296114  LUMO = 1.60150244172997
  mo_energy =
[-0.90455593  1.60150244  7.55537668 18.03864848 35.89975515 61.12881266]
E1 = -3.8661586565038735  E_coul = 1.0285243253003145
cycle= 45 E= -2.83763433120356  delta_E= 1.11e-06  |g|= 9.32e-05  |ddm|= 2.18
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455550365823  LUMO = 1.60151059055848
  mo_energy =
[-0.9045555   1.60151059  7.55541786 18.0387965  35.89999736 61.12936675]
E1 = -3.866157874983703  E_coul = 1.028524110270472
cycle= 46 E= -2.83763376471323  delta_E= 5.66e-07  |g|= 0.000109  |ddm|= 11.2
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555253079428  LUMO = 1.60151529615762
  mo_energy =
[-0.90455525  1.6015153   7.55544186 18.0388772  35.90012496 61.12965042]
E1 = -3.8661574353917465  E_coul = 1.0285214914540177
cycle= 47 E= -2.83763594393773  delta_E= -2.18e-06  |g|= 0.000107  |ddm|= 6.12
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555151783279  LUMO = 1.60151713071105
  mo_energy =
[-0.90455515  1.60151713  7.55545103 18.03890928 35.90017687 61.12977238]
E1 = -3.8661572609310815  E_coul = 1.0285206849772217
cycle= 48 E= -2.83763657595386  delta_E= -6.32e-07  |g|= 0.000192  |ddm|= 2.46
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555053823203  LUMO = 1.60151887208115
  mo_energy =
[-0.90455505  1.60151887  7.55545953 18.03894357 35.90023685 61.12992641]
E1 = -3.8661570858650687  E_coul = 1.028523529721254
cycle= 49 E= -2.83763355614381  delta_E= 3.02e-06  |g|= 8.63e-05  |ddm|= 2.65
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554664018754  LUMO = 1.60152703994066
  mo_energy =
[-0.90455466  1.60152704  7.55550251 18.03907459 35.90042727 61.13024428]
E1 = -3.866156352748434  E_coul = 1.028522019530183
cycle= 50 E= -2.83763433321825  delta_E= -7.77e-07  |g|= 1.4e-05  |ddm|=  9.6
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.866156352748434  E_coul = 1.028522019530183

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.90455615687247  LUMO = 1.60152105133841
  mo_energy =
[-0.90455616  1.60152105  7.55547398 18.03899434 35.90031036 61.13004848]
E1 = -3.8661565584676665  E_coul = 1.0285201581934897
Extra cycle  E= -2.83763640027418  delta_E= -2.07e-06  |g|= 0.000188  |ddm|= 4.11
    CPU time for scf_cycle      0.54 sec, wall time      0.55 sec
exp = [6.32150744 5.57366185 4.90667362 4.21429975 3.81122297 0.37756212]
grad_E = [-3.76592836e-04 -2.07953980e-04 -3.74153696e-05  2.48781318e-04
  5.07695417e-04 -3.11992863e-04]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:50 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.32904854579        1
[INPUT] 0    0    [1    /1   ]  5.58030452372        1
[INPUT] 0    0    [1    /1   ]  4.91251606013        1
[INPUT] 0    0    [1    /1   ]  4.21903947835        1
[INPUT] 0    0    [1    /1   ]  3.81553688435        1
[INPUT] 0    0    [1    /1   ]  0.377677490349       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.329048545788048, 1.0]], [0, [5.580304523723069, 1.0]], [0, [4.912516060129291, 1.0]], [0, [4.219039478345726, 1.0]], [0, [3.8155368843484947, 1.0]], [0, [0.37767749034902454, 1.0]]]}
ecp = {}
CPU time:        47.78
Set gradient conv threshold to 3.16228e-05
cond(S) = 980080439.2827014

WARN: Singularity detected in overlap matrix (condition number = 9.8e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8566421756871248  E_coul = 1.024225699491741
init E= -2.83241647619538
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906693650650055  LUMO = 1.59919691765068
  mo_energy =
[-0.90669365  1.59919692  7.5595942  18.05694446 35.9398466  61.20375992]
E1 = -3.866386265609697  E_coul = 1.028758117221731
cycle= 1 E= -2.83762814838797  delta_E= -0.00521  |g|= 0.00605  |ddm|= 1.01e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904435901879217  LUMO = 1.60314505793138
  mo_energy =
[-0.9044359   1.60314506  7.56448506 18.06188613 35.94489232 61.20830407]
E1 = -3.866136324560427  E_coul = 1.02850390232103
cycle= 2 E= -2.8376324222394  delta_E= -4.27e-06  |g|= 0.000463  |ddm|=  615
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904571833706398  LUMO = 1.60303692439785
  mo_energy =
[-0.90457183  1.60303692  7.5640385  18.06073982 35.94317503 61.20478223]
E1 = -3.86613823064877  E_coul = 1.0285066976087838
cycle= 3 E= -2.83763153303999  delta_E= 8.89e-07  |g|= 8.3e-05  |ddm|=  137
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904559769682052  LUMO = 1.6030726792586
  mo_energy =
[-0.90455977  1.60307268  7.56419951 18.06120346 35.94385188 61.20597635]
E1 = -3.866137870955177  E_coul = 1.0285066312640625
cycle= 4 E= -2.83763123969111  delta_E= 2.93e-07  |g|= 2.21e-05  |ddm|= 24.9
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904562351915543  LUMO = 1.6030676625914
  mo_energy =
[-0.90456235  1.60306766  7.56417692 18.06119772 35.94391318 61.20643432]
E1 = -3.8661375562771214  E_coul = 1.0285067256063667
cycle= 5 E= -2.83763083067075  delta_E= 4.09e-07  |g|= 4.48e-05  |ddm|= 2.76
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562226182337  LUMO = 1.60307136556484
  mo_energy =
[-0.90456223  1.60307137  7.56419605 18.06126403 35.94401825 61.20666605]
E1 = -3.8661371920123604  E_coul = 1.0285091010207188
cycle= 6 E= -2.83762809099164  delta_E= 2.74e-06  |g|= 0.000267  |ddm|= 5.05
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561429250788  LUMO = 1.60308903586315
  mo_energy =
[-0.90456143  1.60308904  7.56428722 18.06155868 35.9444669  61.20756498]
E1 = -3.866135533105942  E_coul = 1.0285059309203044
cycle= 7 E= -2.83762960218564  delta_E= -1.51e-06  |g|= 6.41e-05  |ddm|= 22.3
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561537061441  LUMO = 1.60309094967238
  mo_energy =
[-0.90456154  1.60309095  7.56429702 18.06159907 35.94453839 61.20775055]
E1 = -3.866135279081904  E_coul = 1.0285046916344749
cycle= 8 E= -2.83763058744743  delta_E= -9.85e-07  |g|= 5.5e-05  |ddm|= 3.46
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561807416232  LUMO = 1.60308908644647
  mo_energy =
[-0.90456181  1.60308909  7.56428894 18.06156379 35.94447413 61.20754613]
E1 = -3.8661354361416618  E_coul = 1.0285063859359556
cycle= 9 E= -2.83762905020571  delta_E= 1.54e-06  |g|= 9.16e-05  |ddm|= 2.72
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561715806073  LUMO = 1.60309261666343
  mo_energy =
[-0.90456172  1.60309262  7.56430791 18.06161991 35.94455365 61.20766448]
E1 = -3.8661351045491417  E_coul = 1.0285044934785577
cycle= 10 E= -2.83763061107058  delta_E= -1.56e-06  |g|= 6.2e-05  |ddm|= 4.15
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561184784066  LUMO = 1.6031079483088
  mo_energy =
[-0.90456118  1.60310795  7.56438795 18.06187215 35.94492891 61.2083833 ]
E1 = -3.8661336426259303  E_coul = 1.0285015300834222
cycle= 11 E= -2.83763211254251  delta_E= -1.5e-06  |g|= 0.000257  |ddm|= 19.1
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561533375257  LUMO = 1.60310324685959
  mo_energy =
[-0.90456153  1.60310325  7.56436435 18.06179282 35.94480472 61.20811153]
E1 = -3.8661340567526703  E_coul = 1.0285041822034553
cycle= 12 E= -2.83762987454922  delta_E= 2.24e-06  |g|= 2.69e-05  |ddm|= 5.89
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456023085854  LUMO = 1.60311075772916
  mo_energy =
[-0.90456023  1.60311076  7.56439912 18.06191888 35.94501312 61.2086296 ]
E1 = -3.866133565529457  E_coul = 1.0285036187439325
cycle= 13 E= -2.83762994678552  delta_E= -7.22e-08  |g|= 6.96e-05  |ddm|= 8.55
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9045606150507  LUMO = 1.6031130755975
  mo_energy =
[-0.90456062  1.60311308  7.56441392 18.06194704 35.94503366 61.20852424]
E1 = -3.866133270628082  E_coul = 1.0285028403094574
cycle= 14 E= -2.83763043031863  delta_E= -4.84e-07  |g|= 0.000124  |ddm|= 2.43
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561788851823  LUMO = 1.60309562373305
  mo_energy =
[-0.90456179  1.60309562  7.56432582 18.06165592 35.94458377 61.20756091]
E1 = -3.866134832118771  E_coul = 1.0285065112548395
cycle= 15 E= -2.83762832086393  delta_E= 2.11e-06  |g|= 0.000148  |ddm|= 21.8
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561407210762  LUMO = 1.60310585233709
  mo_energy =
[-0.90456141  1.60310585  7.5643795  18.06182297 35.94483051 61.20800806]
E1 = -3.866133871484686  E_coul = 1.02850349762445
cycle= 16 E= -2.83763037386024  delta_E= -2.05e-06  |g|= 8.47e-05  |ddm|= 12.5
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904561357193248  LUMO = 1.6031087433138
  mo_energy =
[-0.90456136  1.60310874  7.5643938  18.06187392 35.94491264 61.20822691]
E1 = -3.866133555792024  E_coul = 1.0285026338865724
cycle= 17 E= -2.83763092190545  delta_E= -5.48e-07  |g|= 0.000153  |ddm|= 4.25
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562157940424  LUMO = 1.60309732081518
  mo_energy =
[-0.90456216  1.60309732  7.56433521 18.06167802 35.94460525 61.20761028]
E1 = -3.866134552184104  E_coul = 1.0285038252729215
cycle= 18 E= -2.83763072691118  delta_E= 1.95e-07  |g|= 6.93e-05  |ddm|= 14.1
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562691672338  LUMO = 1.60308920478196
  mo_energy =
[-0.90456269  1.6030892   7.56428963 18.06157451 35.94448908 61.20764843]
E1 = -3.8661351327374165  E_coul = 1.0285042622649743
cycle= 19 E= -2.83763087047244  delta_E= -1.44e-07  |g|= 7.08e-05  |ddm|= 6.49
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562926015378  LUMO = 1.60308424078191
  mo_energy =
[-0.90456293  1.60308424  7.56426506 18.06149067 35.94435881 61.20734741]
E1 = -3.8661356202045716  E_coul = 1.0285053982294496
cycle= 20 E= -2.83763022197512  delta_E= 6.48e-07  |g|= 1.17e-05  |ddm|= 6.62
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562823862402  LUMO = 1.60308519252472
  mo_energy =
[-0.90456282  1.60308519  7.56427034 18.06150103 35.94436839 61.20732607]
E1 = -3.866135567654692  E_coul = 1.028503704241984
cycle= 21 E= -2.83763186341271  delta_E= -1.64e-06  |g|= 0.000142  |ddm|= 0.565
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563107537665  LUMO = 1.60307934777097
  mo_energy =
[-0.90456311  1.60307935  7.56424127 18.06139501 35.94419522 61.20692565]
E1 = -3.866136146402487  E_coul = 1.0285041932303762
cycle= 22 E= -2.83763195317211  delta_E= -8.98e-08  |g|= 0.000111  |ddm|= 8.21
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563250265237  LUMO = 1.60307562954776
  mo_energy =
[-0.90456325  1.60307563  7.56422181 18.06133317 35.944103   61.20676525]
E1 = -3.866136495616215  E_coul = 1.028504388039753
cycle= 23 E= -2.83763210757646  delta_E= -1.54e-07  |g|= 0.000113  |ddm|=  4.6
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563565248141  LUMO = 1.60306950820797
  mo_energy =
[-0.90456357  1.60306951  7.56419051 18.06122695 35.94393488 61.20640445]
E1 = -3.866137070367592  E_coul = 1.0285074458874912
cycle= 24 E= -2.8376296244801  delta_E= 2.48e-06  |g|= 0.000128  |ddm|= 7.98
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563456376407  LUMO = 1.60307210695252
  mo_energy =
[-0.90456346  1.60307211  7.56420434 18.06126728 35.94399093 61.20648068]
E1 = -3.866136838441838  E_coul = 1.0285067845864504
cycle= 25 E= -2.83763005385539  delta_E= -4.29e-07  |g|= 8.66e-05  |ddm|= 2.92
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563701028806  LUMO = 1.60306787063654
  mo_energy =
[-0.9045637   1.60306787  7.5641797  18.06121616 35.94394109 61.20657618]
E1 = -3.866137128168416  E_coul = 1.0285067284745337
cycle= 26 E= -2.83763039969388  delta_E= -3.46e-07  |g|= 7.05e-05  |ddm|= 2.93
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904564352374507  LUMO = 1.60305768619454
  mo_energy =
[-0.90456435  1.60305769  7.56413112 18.06101947 35.94360235 61.20566783]
E1 = -3.866138149841269  E_coul = 1.028508395034159
cycle= 27 E= -2.83762975480711  delta_E= 6.45e-07  |g|= 0.000181  |ddm|= 15.4
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904564396453824  LUMO = 1.60305494918589
  mo_energy =
[-0.9045644   1.60305495  7.56411708 18.0609682  35.94351538 61.20544174]
E1 = -3.866138446610477  E_coul = 1.0285081202807733
cycle= 28 E= -2.8376303263297  delta_E= -5.72e-07  |g|= 0.000147  |ddm|= 4.12
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904564768491864  LUMO = 1.60304811955482
  mo_energy =
[-0.90456477  1.60304812  7.56408317 18.06084781 35.94332205 61.20500476]
E1 = -3.8661391062807007  E_coul = 1.028507433991428
cycle= 29 E= -2.83763167228927  delta_E= -1.35e-06  |g|= 4.79e-05  |ddm|= 9.32
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563809521481  LUMO = 1.60306535499463
  mo_energy =
[-0.90456381  1.60306535  7.56416924 18.06116923 35.9438611  61.20631063]
E1 = -3.8661374323266777  E_coul = 1.0285062244569139
cycle= 30 E= -2.83763120786976  delta_E= 4.64e-07  |g|= 4.55e-06  |ddm|= 24.5
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563226291931  LUMO = 1.60307746922959
  mo_energy =
[-0.90456323  1.60307747  7.56423287 18.06136364 35.94414208 61.20674912]
E1 = -3.8661363493607794  E_coul = 1.0285057166700302
cycle= 31 E= -2.83763063269075  delta_E= 5.75e-07  |g|= 1e-05  |ddm|= 14.1
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562304173065  LUMO = 1.60309541886358
  mo_energy =
[-0.9045623   1.60309542  7.56432597 18.0616706  35.944619   61.20769928]
E1 = -3.866134697740208  E_coul = 1.0285037218290325
cycle= 32 E= -2.83763097591118  delta_E= -3.43e-07  |g|= 9.29e-05  |ddm|= 22.6
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563047953382  LUMO = 1.60307946456069
  mo_energy =
[-0.90456305  1.60307946  7.56424289 18.06140733 35.94422558 61.20696914]
E1 = -3.8661361587971927  E_coul = 1.028504268057745
cycle= 33 E= -2.83763189073945  delta_E= -9.15e-07  |g|= 0.000118  |ddm|= 19.5
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563473995209  LUMO = 1.60307072552163
  mo_energy =
[-0.90456347  1.60307073  7.56419697 18.06125496 35.94398601 61.20650533]
E1 = -3.8661369610969527  E_coul = 1.0285077154691202
cycle= 34 E= -2.83762924562783  delta_E= 2.65e-06  |g|= 0.000155  |ddm|=   11
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456322027316  LUMO = 1.60307568533566
  mo_energy =
[-0.90456322  1.60307569  7.56422321 18.06132998 35.9440898  61.20665499]
E1 = -3.866136530769739  E_coul = 1.028507680814882
cycle= 35 E= -2.83762884995486  delta_E= 3.96e-07  |g|= 0.000189  |ddm|= 5.44
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562803281352  LUMO = 1.60308347641524
  mo_energy =
[-0.9045628   1.60308348  7.5642626  18.06147042 35.94431927 61.20717652]
E1 = -3.866135786728378  E_coul = 1.0285046206142063
cycle= 36 E= -2.83763116611417  delta_E= -2.32e-06  |g|= 7.43e-05  |ddm|= 10.6
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562919879941  LUMO = 1.60308159045148
  mo_energy =
[-0.90456292  1.60308159  7.56425346 18.06143194 35.94424968 61.20699487]
E1 = -3.8661359763611607  E_coul = 1.0285053975110812
cycle= 37 E= -2.83763057885008  delta_E= 5.87e-07  |g|= 3.45e-06  |ddm|= 2.94
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456320057953  LUMO = 1.60307594233824
  mo_energy =
[-0.9045632   1.60307594  7.56422478 18.06133868 35.94410785 61.20668643]
E1 = -3.866136505200579  E_coul = 1.0285039291052192
cycle= 38 E= -2.83763257609536  delta_E= -2e-06  |g|= 0.000172  |ddm|= 7.15
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563491636999  LUMO = 1.60307028705174
  mo_energy =
[-0.90456349  1.60307029  7.5641956  18.06124117 35.94395526 61.20637858]
E1 = -3.866137029095616  E_coul = 1.0285051357645119
cycle= 39 E= -2.8376318933311  delta_E= 6.83e-07  |g|= 7.42e-05  |ddm|= 7.22
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563375063726  LUMO = 1.60307258761311
  mo_energy =
[-0.90456338  1.60307259  7.56420743 18.06127763 35.94400855 61.20647774]
E1 = -3.8661368193325987  E_coul = 1.0285048993567876
cycle= 40 E= -2.83763191997581  delta_E= -2.66e-08  |g|= 9.31e-05  |ddm|= 2.75
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90456343881102  LUMO = 1.60307140428638
  mo_energy =
[-0.90456344  1.6030714   7.56420034 18.06124672 35.94394632 61.20633892]
E1 = -3.8661369241555237  E_coul = 1.0285058453587876
cycle= 41 E= -2.83763107879674  delta_E= 8.41e-07  |g|= 8.09e-06  |ddm|= 1.85
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562995843024  LUMO = 1.60308011052208
  mo_energy =
[-0.904563    1.60308011  7.56424588 18.0613939  35.94417331 61.20677634]
E1 = -3.8661361309780284  E_coul = 1.0285046330953242
cycle= 42 E= -2.8376314978827  delta_E= -4.19e-07  |g|= 8.58e-05  |ddm|= 10.8
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562806324285  LUMO = 1.60308428883607
  mo_energy =
[-0.90456281  1.60308429  7.5642683  18.06145824 35.94426363 61.20689348]
E1 = -3.8661357696866974  E_coul = 1.028505588471886
cycle= 43 E= -2.83763018121481  delta_E= 1.32e-06  |g|= 3e-05  |ddm|= 4.54
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562712752164  LUMO = 1.60308556232375
  mo_energy =
[-0.90456271  1.60308556  7.564274   18.06148139 35.94430183 61.20700145]
E1 = -3.8661356385986805  E_coul = 1.028504217143218
cycle= 44 E= -2.83763142145546  delta_E= -1.24e-06  |g|= 8.65e-05  |ddm|= 1.93
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904562916212291  LUMO = 1.60308060818483
  mo_energy =
[-0.90456292  1.60308061  7.56424669 18.06141739 35.94423213 61.20701867]
E1 = -3.8661360424623776  E_coul = 1.028504282999459
cycle= 45 E= -2.83763175946292  delta_E= -3.38e-07  |g|= 0.000124  |ddm|= 4.45
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563264745754  LUMO = 1.60307461649375
  mo_energy =
[-0.90456326  1.60307462  7.56421759 18.06130123 35.94403169 61.20651   ]
E1 = -3.866136643097399  E_coul = 1.0285072205186119
cycle= 46 E= -2.83762942257879  delta_E= 2.34e-06  |g|= 0.00013  |ddm|=    9
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563157494437  LUMO = 1.60307662388221
  mo_energy =
[-0.90456316  1.60307662  7.56422783 18.06133722 35.94409003 61.20663549]
E1 = -3.866136454004771  E_coul = 1.028504051561835
cycle= 47 E= -2.83763240244294  delta_E= -2.98e-06  |g|= 0.000145  |ddm|= 2.68
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563403149071  LUMO = 1.60307148018921
  mo_energy =
[-0.9045634   1.60307148  7.56420061 18.06125565 35.94397222 61.2064461 ]
E1 = -3.8661369105055883  E_coul = 1.0285049831846569
cycle= 48 E= -2.83763192732093  delta_E= 4.75e-07  |g|= 7.63e-05  |ddm|= 5.91
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563365215218  LUMO = 1.60307278261591
  mo_energy =
[-0.90456337  1.60307278  7.56420871 18.06126999 35.94398327 61.20639963]
E1 = -3.8661368225436363  E_coul = 1.0285044898281819
cycle= 49 E= -2.83763233271545  delta_E= -4.05e-07  |g|= 0.000129  |ddm|= 0.743
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904563111760938  LUMO = 1.6030779390475
  mo_energy =
[-0.90456311  1.60307794  7.56423516 18.06135915 35.94412249 61.20668673]
E1 = -3.8661363386631846  E_coul = 1.0285051351021084
cycle= 50 E= -2.83763120356108  delta_E= 1.13e-06  |g|= 2.72e-05  |ddm|= 6.65
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8661363386631846  E_coul = 1.0285051351021084

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904563034214134  LUMO = 1.6030677656752
  mo_energy =
[-0.90456303  1.60306777  7.56417792 18.06122458 35.94398048 61.20673008]
E1 = -3.8661373019724  E_coul = 1.028509678294474
Extra cycle  E= -2.83762762367793  delta_E= 3.58e-06  |g|= 0.000308  |ddm|= 10.1
    CPU time for scf_cycle      0.53 sec, wall time      0.54 sec
exp = [6.32904855 5.58030452 4.91251606 4.21903948 3.81553688 0.37767749]
E = -2.837627623677926
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:51 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.32226155478        1
[INPUT] 0    0    [1    /1   ]  5.57432611493        1
[INPUT] 0    0    [1    /1   ]  4.907257867          1
[INPUT] 0    0    [1    /1   ]  4.21477372527        1
[INPUT] 0    0    [1    /1   ]  3.8116543614         1
[INPUT] 0    0    [1    /1   ]  0.377573658065       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.322261554778433, 1.0]], [0, [5.574326114932574, 1.0]], [0, [4.907257867000597, 1.0]], [0, [4.214773725269111, 1.0]], [0, [3.811654361402977, 1.0]], [0, [0.3775736580649279, 1.0]]]}
ecp = {}
CPU time:        48.58
Set gradient conv threshold to 3.16228e-05
cond(S) = 981432125.9333843

WARN: Singularity detected in overlap matrix (condition number = 9.81e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8566450528001903  E_coul = 1.0242264735744864
init E= -2.8324185792257
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906692444971674  LUMO = 1.59787133570233
  mo_energy =
[-0.90669244  1.59787134  7.55209476 18.03833522 35.90298073 61.14123863]
E1 = -3.866392693355728  E_coul = 1.0287665429365365
cycle= 1 E= -2.83762615041919  delta_E= -0.00521  |g|= 0.00607  |ddm|= 1.04e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904430695562457  LUMO = 1.6018333536382
  mo_energy =
[-0.9044307   1.60183335  7.55705965 18.04346217 35.90826459 61.14597397]
E1 = -3.8661441230927154  E_coul = 1.0285149775402778
cycle= 2 E= -2.83762914555244  delta_E= -3e-06  |g|= 0.00041  |ddm|=  619
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904564544815739  LUMO = 1.6017504877312
  mo_energy =
[-0.90456454  1.60175049  7.55673474 18.04275216 35.90725169 61.14430854]
E1 = -3.866143833370429  E_coul = 1.0285146378595338
cycle= 3 E= -2.8376291955109  delta_E= -5e-08  |g|= 1.73e-05  |ddm|=  104
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904555418671149  LUMO = 1.60175642880935
  mo_energy =
[-0.90455542  1.60175643  7.55674275 18.04280442 35.90739916 61.14485087]
E1 = -3.8661456634218636  E_coul = 1.0285171372221409
cycle= 4 E= -2.83762852619972  delta_E= 6.69e-07  |g|= 5.93e-05  |ddm|= 3.37
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904555843908933  LUMO = 1.6017678658494
  mo_energy =
[-0.90455584  1.60176787  7.5568026  18.04300326 35.90769446 61.14545281]
E1 = -3.8661443042741133  E_coul = 1.0285125448610222
cycle= 5 E= -2.83763175941309  delta_E= -3.23e-06  |g|= 0.000312  |ddm|= 16.4
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557680602372  LUMO = 1.60173924573248
  mo_energy =
[-0.90455768  1.60173925  7.5566615  18.04248503 35.90683953 61.14337073]
E1 = -3.8661470239869695  E_coul = 1.0285158868360051
cycle= 6 E= -2.83763113715096  delta_E= 6.22e-07  |g|= 9.57e-05  |ddm|= 39.7
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557648978725  LUMO = 1.60173316783889
  mo_energy =
[-0.90455765  1.60173317  7.55662965 18.04238038 35.90667912 61.14303943]
E1 = -3.866147681904617  E_coul = 1.0285203600467931
cycle= 7 E= -2.83762732185782  delta_E= 3.82e-06  |g|= 0.000272  |ddm|= 8.46
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556666105424  LUMO = 1.60174784340871
  mo_energy =
[-0.90455667  1.60174784  7.55670481 18.04262038 35.90704367 61.14375539]
E1 = -3.8661463992907286  E_coul = 1.0285190157141595
cycle= 8 E= -2.83762738357657  delta_E= -6.17e-08  |g|= 0.000199  |ddm|= 17.6
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556155073718  LUMO = 1.60175778919322
  mo_energy =
[-0.90455616  1.60175779  7.5567574  18.0427823  35.90728355 61.14416045]
E1 = -3.866145518965054  E_coul = 1.0285174085791338
cycle= 9 E= -2.83762811038592  delta_E= -7.27e-07  |g|= 0.000111  |ddm|= 11.7
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556013912173  LUMO = 1.60176134639404
  mo_energy =
[-0.90455601  1.60176135  7.55677478 18.04284969 35.90739835 61.14446221]
E1 = -3.8661451453484035  E_coul = 1.0285175555446135
cycle= 10 E= -2.83762758980379  delta_E= 5.21e-07  |g|= 0.000158  |ddm|=  5.4
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556217896407  LUMO = 1.60175896351769
  mo_energy =
[-0.90455622  1.60175896  7.55676207 18.04281615 35.90735449 61.14442128]
E1 = -3.866145320242076  E_coul = 1.0285157097351711
cycle= 11 E= -2.8376296105069  delta_E= -2.02e-06  |g|= 5.19e-05  |ddm|= 2.22
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556276421059  LUMO = 1.60175813696286
  mo_energy =
[-0.90455628  1.60175814  7.55675804 18.04279911 35.90732385 61.14434297]
E1 = -3.8661453998165114  E_coul = 1.0285175562110591
cycle= 12 E= -2.83762784360545  delta_E= 1.77e-06  |g|= 0.000125  |ddm|= 1.28
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556029487435  LUMO = 1.60176304836899
  mo_energy =
[-0.90455603  1.60176305  7.55678356 18.04287982 35.90744542 61.14457105]
E1 = -3.8661449529622844  E_coul = 1.028517898388129
cycle= 13 E= -2.83762705457416  delta_E= 7.89e-07  |g|= 0.000171  |ddm|= 5.98
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555286272677  LUMO = 1.60177647195586
  mo_energy =
[-0.90455529  1.60177647  7.55685138 18.04311527 35.9078207  61.1454073 ]
E1 = -3.8661436868425483  E_coul = 1.0285132453643893
cycle= 14 E= -2.83763044147816  delta_E= -3.39e-06  |g|= 0.000205  |ddm|= 17.8
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554883127776  LUMO = 1.60178405619849
  mo_energy =
[-0.90455488  1.60178406  7.5568912  18.04323558 35.90799646 61.14570411]
E1 = -3.8661430186370835  E_coul = 1.0285155391906353
cycle= 15 E= -2.83762747944645  delta_E= 2.96e-06  |g|= 4.55e-05  |ddm|= 8.77
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554782025404  LUMO = 1.60178510311735
  mo_energy =
[-0.90455478  1.6017851   7.55689654 18.04325267 35.90802217 61.14575013]
E1 = -3.866142936459597  E_coul = 1.0285129157474446
cycle= 16 E= -2.83763002071215  delta_E= -2.54e-06  |g|= 0.000206  |ddm|= 1.18
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554800318786  LUMO = 1.60178389976874
  mo_energy =
[-0.9045548   1.6017839   7.55688622 18.0432552  35.90806173 61.14608298]
E1 = -3.866142936879898  E_coul = 1.0285144424312813
cycle= 17 E= -2.83762849444862  delta_E= 1.53e-06  |g|= 7.22e-05  |ddm|= 1.34
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554948125392  LUMO = 1.60178219492674
  mo_energy =
[-0.90455495  1.60178219  7.55687815 18.04322461 35.90800921 61.14593971]
E1 = -3.8661430940928323  E_coul = 1.0285159912553614
cycle= 18 E= -2.83762710283747  delta_E= 1.39e-06  |g|= 6.9e-05  |ddm|= 2.39
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555285738188  LUMO = 1.60177796597528
  mo_energy =
[-0.90455529  1.60177797  7.55686057 18.04312502 35.90781207 61.14527072]
E1 = -3.86614358160828  E_coul = 1.0285158117265998
cycle= 19 E= -2.83762776988168  delta_E= -6.67e-07  |g|= 5.49e-05  |ddm|= 8.37
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554463288314  LUMO = 1.60179369096605
  mo_energy =
[-0.90455446  1.60179369  7.55693963 18.04341468 35.90829095 61.14639167]
E1 = -3.866142056176867  E_coul = 1.0285143113406967
cycle= 20 E= -2.83762774483617  delta_E= 2.5e-08  |g|= 4.21e-05  |ddm|=   22
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554536729274  LUMO = 1.60179256228231
  mo_energy =
[-0.90455454  1.60179256  7.55693585 18.04338807 35.90823491 61.14616288]
E1 = -3.8661422095289835  E_coul = 1.0285150077425005
cycle= 21 E= -2.83762720178648  delta_E= 5.43e-07  |g|= 3.39e-05  |ddm|= 2.62
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557978882528  LUMO = 1.6017233356915
  mo_energy =
[-0.90455798  1.60172334  7.5565819  18.04223053 35.9064772  61.1425642 ]
E1 = -3.866148682649291  E_coul = 1.0285220053706414
cycle= 22 E= -2.83762667727865  delta_E= 5.25e-07  |g|= 0.000383  |ddm|= 87.8
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554420223022  LUMO = 1.60179354749251
  mo_energy =
[-0.90455442  1.60179355  7.5569384  18.04341102 35.90828702 61.14640325]
E1 = -3.8661420771618578  E_coul = 1.0285135191546817
cycle= 23 E= -2.83762855800718  delta_E= -1.88e-06  |g|= 0.000112  |ddm|= 90.2
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554473712704  LUMO = 1.60179261886935
  mo_energy =
[-0.90455447  1.60179262  7.55693376 18.04339305 35.90825652 61.14632722]
E1 = -3.8661421678368058  E_coul = 1.0285124257134328
cycle= 24 E= -2.83762974212337  delta_E= -1.18e-06  |g|= 0.000209  |ddm|= 1.35
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554370835461  LUMO = 1.60179451196629
  mo_energy =
[-0.90455437  1.60179451  7.55694298 18.04342778 35.90831461 61.14647799]
E1 = -3.8661419788826508  E_coul = 1.0285124317160803
cycle= 25 E= -2.83762954716657  delta_E= 1.95e-07  |g|= 0.000209  |ddm|= 2.75
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554371106134  LUMO = 1.60179439777322
  mo_energy =
[-0.90455437  1.6017944   7.55694212 18.04342739 35.90831676 61.14649967]
E1 = -3.8661419828307353  E_coul = 1.0285123490848587
cycle= 26 E= -2.83762963374588  delta_E= -8.66e-08  |g|= 0.000211  |ddm|= 0.0398
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554562775409  LUMO = 1.60179076427027
  mo_energy =
[-0.90455456  1.60179076  7.5569236  18.04336478 35.90821787 61.14629494]
E1 = -3.8661423221254005  E_coul = 1.0285151199294476
cycle= 27 E= -2.83762720219595  delta_E= 2.43e-06  |g|= 2.77e-05  |ddm|= 4.71
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554532948398  LUMO = 1.60179153367168
  mo_energy =
[-0.90455453  1.60179153  7.55692766 18.04337358 35.90822523 61.14629276]
E1 = -3.8661422561341436  E_coul = 1.0285149300630632
cycle= 28 E= -2.83762732607108  delta_E= -1.24e-07  |g|= 2.05e-05  |ddm|= 0.705
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554497264665  LUMO = 1.60179196639719
  mo_energy =
[-0.9045545   1.60179197  7.55692962 18.04338479 35.90824845 61.14636619]
E1 = -3.86614220831382  E_coul = 1.028513479856425
cycle= 29 E= -2.83762872845739  delta_E= -1.4e-06  |g|= 0.000113  |ddm|= 0.867
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455460146524  LUMO = 1.60178999435074
  mo_energy =
[-0.9045546   1.60178999  7.55691959 18.04335164 35.90819747 61.14626074]
E1 = -3.8661423923395812  E_coul = 1.028513457129406
cycle= 30 E= -2.83762893521018  delta_E= -2.07e-07  |g|= 0.000118  |ddm|= 2.51
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904546628409755  LUMO = 1.6019361540247
  mo_energy =
[-0.90454663  1.60193615  7.55763547 18.04617354 35.91303545 61.15852029]
E1 = -3.8661277099149767  E_coul = 1.0285003302446005
cycle= 31 E= -2.83762737967038  delta_E= 1.56e-06  |g|= 0.000801  |ddm|=  218
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555958547687  LUMO = 1.60175940771352
  mo_energy =
[-0.90455596  1.60175941  7.55676198 18.04282543 35.9073742  61.14455074]
E1 = -3.8661452821764004  E_coul = 1.028515685861935
cycle= 32 E= -2.83762959631447  delta_E= -2.22e-06  |g|= 5.08e-05  |ddm|=  258
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555977191784  LUMO = 1.60176011328074
  mo_energy =
[-0.90455598  1.60176011  7.55676664 18.0428324  35.90737674 61.14450192]
E1 = -3.8661452311144204  E_coul = 1.028519426640275
cycle= 33 E= -2.83762580447415  delta_E= 3.79e-06  |g|= 0.000296  |ddm|= 0.375
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555174705986  LUMO = 1.60177612550317
  mo_energy =
[-0.90455517  1.60177613  7.55684868 18.04310763 35.90780754 61.14539468]
E1 = -3.866143732070823  E_coul = 1.028514455366829
cycle= 34 E= -2.83762927670399  delta_E= -3.47e-06  |g|= 9.15e-05  |ddm|= 20.7
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555156428551  LUMO = 1.60177644698915
  mo_energy =
[-0.90455516  1.60177645  7.55685025 18.04311202 35.90781364 61.1454101 ]
E1 = -3.866143703378329  E_coul = 1.028515875193578
cycle= 35 E= -2.83762782818475  delta_E= 1.45e-06  |g|= 3.97e-05  |ddm|= 0.373
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555230126583  LUMO = 1.6017751313543
  mo_energy =
[-0.90455523  1.60177513  7.55684377 18.04309216 35.90778608 61.14535061]
E1 = -3.866143827793274  E_coul = 1.0285152403247402
cycle= 36 E= -2.83762858746853  delta_E= -7.59e-07  |g|= 2.23e-05  |ddm|= 1.62
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555412493579  LUMO = 1.60177186867347
  mo_energy =
[-0.90455541  1.60177187  7.55682699 18.04303354 35.90769071 61.14515695]
E1 = -3.8661441310355755  E_coul = 1.0285142727372234
cycle= 37 E= -2.83762985829835  delta_E= -1.27e-06  |g|= 0.000124  |ddm|=  4.3
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555591096697  LUMO = 1.60176848216898
  mo_energy =
[-0.90455559  1.60176848  7.55680997 18.04297391 35.90759526 61.14493392]
E1 = -3.8661444555584867  E_coul = 1.0285143287426897
cycle= 38 E= -2.8376301268158  delta_E= -2.69e-07  |g|= 0.000127  |ddm|= 4.57
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555780906645  LUMO = 1.60176484899964
  mo_energy =
[-0.90455578  1.60176485  7.55679158 18.04291406 35.90750488 61.1447463 ]
E1 = -3.866144795051129  E_coul = 1.0285151678117095
cycle= 39 E= -2.83762962723942  delta_E= 5e-07  |g|= 6.88e-05  |ddm|= 4.58
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555086201734  LUMO = 1.60178046487603
  mo_energy =
[-0.90455509  1.60178046  7.55687297 18.04316477 35.90787111 61.1453725 ]
E1 = -3.866143362312202  E_coul = 1.0285119541298895
cycle= 40 E= -2.83763140818231  delta_E= -1.78e-06  |g|= 0.000288  |ddm|= 18.8
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553257138867  LUMO = 1.60181621791479
  mo_energy =
[-0.90455326  1.60181622  7.55705607 18.0437899  35.90886304 61.14747182]
E1 = -3.8661400071475334  E_coul = 1.0285104139010695
cycle= 41 E= -2.83762959324646  delta_E= 1.81e-06  |g|= 0.000284  |ddm|= 46.7
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556494221101  LUMO = 1.60175291810288
  mo_energy =
[-0.90455649  1.60175292  7.55673104 18.04270657 35.90717791 61.14408101]
E1 = -3.866145900890129  E_coul = 1.0285194063283443
cycle= 42 E= -2.83762649456178  delta_E= 3.1e-06  |g|= 0.00028  |ddm|=   81
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555487745478  LUMO = 1.60177148234822
  mo_energy =
[-0.90455549  1.60177148  7.55682445 18.04304291 35.90772745 61.14531768]
E1 = -3.86614412158606  E_coul = 1.0285141712480292
cycle= 43 E= -2.83762995033803  delta_E= -3.46e-06  |g|= 0.000141  |ddm|= 25.5
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555790583283  LUMO = 1.60176586772352
  mo_energy =
[-0.90455579  1.60176587  7.55679619 18.04294148 35.90756122 61.14492697]
E1 = -3.8661446600477025  E_coul = 1.0285166558715844
cycle= 44 E= -2.83762800417612  delta_E= 1.95e-06  |g|= 7.23e-05  |ddm|=  7.7
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555668096104  LUMO = 1.60176827600908
  mo_energy =
[-0.90455567  1.60176828  7.5568084  18.04298496 35.90763186 61.14508478]
E1 = -3.8661444292190135  E_coul = 1.0285153661853508
cycle= 45 E= -2.83762906303366  delta_E= -1.06e-06  |g|= 4.49e-05  |ddm|= 3.28
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555583463373  LUMO = 1.60177022911577
  mo_energy =
[-0.90455558  1.60177023  7.55681885 18.04301547 35.90767477 61.14515104]
E1 = -3.8661442565016615  E_coul = 1.028515260381583
cycle= 46 E= -2.83762899612008  delta_E= 6.69e-08  |g|= 3.86e-05  |ddm|=  2.2
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555385437344  LUMO = 1.60177411851069
  mo_energy =
[-0.90455539  1.60177412  7.55683853 18.04307819 35.90776813 61.14535346]
E1 = -3.866143893423014  E_coul = 1.0285162057128985
cycle= 47 E= -2.83762768771012  delta_E= 1.31e-06  |g|= 7.58e-05  |ddm|= 4.86
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455502158493  LUMO = 1.60178098703403
  mo_energy =
[-0.90455502  1.60178099  7.5568729  18.0432029  35.90797329 61.14584629]
E1 = -3.8661432276315346  E_coul = 1.028512266409676
cycle= 48 E= -2.83763096122186  delta_E= -3.27e-06  |g|= 0.000265  |ddm|= 9.57
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455499000702  LUMO = 1.60178167249152
  mo_energy =
[-0.90455499  1.60178167  7.5568764  18.04321521 35.9079934  61.14589128]
E1 = -3.8661431622528926  E_coul = 1.0285152184407658
cycle= 49 E= -2.83762794381213  delta_E= 3.02e-06  |g|= 1.79e-05  |ddm|= 0.924
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554051893025  LUMO = 1.60179846149196
  mo_energy =
[-0.90455405  1.60179846  7.55696005 18.04352902 35.90851758 61.1471286 ]
E1 = -3.866141525544261  E_coul = 1.028513963338651
cycle= 50 E= -2.83762756220561  delta_E= 3.82e-07  |g|= 5.81e-05  |ddm|= 23.9
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.866141525544261  E_coul = 1.028513963338651

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904556799480687  LUMO = 1.60178909652237
  mo_energy =
[-0.9045568   1.6017891   7.55692535 18.04333496 35.90813057 61.14583024]
E1 = -3.8661420391058865  E_coul = 1.0285139104320193
Extra cycle  E= -2.83762812867387  delta_E= -5.66e-07  |g|= 4.98e-05  |ddm|= 13.2
    CPU time for scf_cycle      0.51 sec, wall time      0.51 sec
exp = [6.32226155 5.57432611 4.90725787 4.21477373 3.81165436 0.37757366]
E = -2.837628128673867
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:52 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.32158285568        1
[INPUT] 0    0    [1    /1   ]  5.57372827405        1
[INPUT] 0    0    [1    /1   ]  4.90673204769        1
[INPUT] 0    0    [1    /1   ]  4.21434714996        1
[INPUT] 0    0    [1    /1   ]  3.81126610911        1
[INPUT] 0    0    [1    /1   ]  0.377563274837       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.321582855677471, 1.0]], [0, [5.573728274053524, 1.0]], [0, [4.906732047687727, 1.0]], [0, [4.214347149961449, 1.0]], [0, [3.8112661091084252, 1.0]], [0, [0.3775632748365182, 1.0]]]}
ecp = {}
CPU time:        49.35
Set gradient conv threshold to 3.16228e-05
cond(S) = 981567465.4795338

WARN: Singularity detected in overlap matrix (condition number = 9.82e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8566453280311213  E_coul = 1.024234368788738
init E= -2.83241095924238
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906684022490222  LUMO = 1.59789890662924
  mo_energy =
[-0.90668402  1.59789891  7.55216506 18.03930875 35.90379564 61.14422682]
E1 = -3.866378207390021  E_coul = 1.028756938205009
cycle= 1 E= -2.83762126918501  delta_E= -0.00521  |g|= 0.00607  |ddm|= 1.03e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904433068312175  LUMO = 1.60178351351769
  mo_energy =
[-0.90443307  1.60178351  7.5567505  18.04319296 35.90713544 61.14494999]
E1 = -3.8661352240143443  E_coul = 1.0285102915636293
cycle= 2 E= -2.83762493245071  delta_E= -3.66e-06  |g|= 0.000437  |ddm|=  703
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904564672691347  LUMO = 1.60169116767278
  mo_energy =
[-0.90456467  1.60169117  7.55637278 18.0422966  35.9058454  61.14258834]
E1 = -3.8661366096531187  E_coul = 1.0285134272269436
cycle= 3 E= -2.83762318242618  delta_E= 1.75e-06  |g|= 0.000164  |ddm|=  123
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904552271753764  LUMO = 1.60174583636681
  mo_energy =
[-0.90455227  1.60174584  7.55663253 18.04311005 35.907087   61.14502951]
E1 = -3.866134286338961  E_coul = 1.0285113361410678
cycle= 4 E= -2.83762295019789  delta_E= 2.32e-07  |g|= 2.77e-05  |ddm|= 52.2
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904555884276858  LUMO = 1.60173704361035
  mo_energy =
[-0.90455588  1.60173704  7.55659612 18.04297503 35.9068465  61.144458  ]
E1 = -3.866134276229907  E_coul = 1.028512069428918
cycle= 5 E= -2.83762220680099  delta_E= 7.43e-07  |g|= 8.2e-05  |ddm|= 6.15
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555469304245  LUMO = 1.60174368062962
  mo_energy =
[-0.90455547  1.60174368  7.55662956 18.04310244 35.90706468 61.14495839]
E1 = -3.8661336441154983  E_coul = 1.02850870057658
cycle= 6 E= -2.83762494353892  delta_E= -2.74e-06  |g|= 0.0002  |ddm|= 9.43
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556274285808  LUMO = 1.60173000336777
  mo_energy =
[-0.90455627  1.60173     7.55655929 18.04287324 35.90671113 61.14425767]
E1 = -3.86613487704326  E_coul = 1.0285107590363993
cycle= 7 E= -2.83762411800686  delta_E= 8.26e-07  |g|= 7.57e-05  |ddm|= 16.9
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556354507461  LUMO = 1.60172683051453
  mo_energy =
[-0.90455635  1.60172683  7.5565432  18.04281669 35.90662071 61.14404626]
E1 = -3.8661352066963257  E_coul = 1.0285114768146915
cycle= 8 E= -2.83762372988163  delta_E= 3.88e-07  |g|= 2.17e-05  |ddm|=  4.5
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455630881953  LUMO = 1.60172619278892
  mo_energy =
[-0.90455631  1.60172619  7.5565399  18.04280495 35.90660266 61.14400533]
E1 = -3.8661352904259547  E_coul = 1.0285112189002659
cycle= 9 E= -2.83762407152569  delta_E= -3.42e-07  |g|= 5.36e-05  |ddm|= 1.04
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556310068289  LUMO = 1.60172492184644
  mo_energy =
[-0.90455631  1.60172492  7.55653381 18.04277991 35.90655892 61.14387574]
E1 = -3.8661354423775203  E_coul = 1.0285130915028233
cycle= 10 E= -2.8376223508747  delta_E= 1.72e-06  |g|= 0.000115  |ddm|= 2.15
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556106206668  LUMO = 1.60172761053805
  mo_energy =
[-0.90455611  1.60172761  7.55654762 18.04282548 35.90663022 61.14401087]
E1 = -3.8661352137509795  E_coul = 1.0285121028902895
cycle= 11 E= -2.83762311086069  delta_E= -7.6e-07  |g|= 4.53e-05  |ddm|= 3.23
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556045909494  LUMO = 1.60172826819803
  mo_energy =
[-0.90455605  1.60172827  7.55655074 18.04284021 35.90665865 61.14409062]
E1 = -3.8661351499902628  E_coul = 1.028510177166688
cycle= 12 E= -2.83762497282357  delta_E= -1.86e-06  |g|= 0.000137  |ddm|= 1.09
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556550446594  LUMO = 1.60172098594473
  mo_energy =
[-0.90455655  1.60172099  7.55651322 18.04272407 35.90648776 61.14378787]
E1 = -3.8661357711527566  E_coul = 1.028511156250697
cycle= 13 E= -2.83762461490206  delta_E= 3.58e-07  |g|= 7.41e-05  |ddm|=  8.4
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556991615055  LUMO = 1.60171230418419
  mo_energy =
[-0.90455699  1.6017123   7.55646887 18.04257417 35.90625173 61.1432928 ]
E1 = -3.8661365883460443  E_coul = 1.0285139609593463
cycle= 14 E= -2.8376226273867  delta_E= 1.99e-06  |g|= 0.000146  |ddm|= 11.3
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556853739903  LUMO = 1.60171382707306
  mo_energy =
[-0.90455685  1.60171383  7.5564778  18.04259693 35.90628473 61.14330959]
E1 = -3.8661364931427595  E_coul = 1.0285122689696868
cycle= 15 E= -2.83762422417307  delta_E= -1.6e-06  |g|= 9.29e-06  |ddm|= 1.23
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556599659367  LUMO = 1.60171808349303
  mo_energy =
[-0.9045566   1.60171808  7.5564993  18.04267273 35.90640821 61.14359039]
E1 = -3.8661360952603956  E_coul = 1.0285111273323932
cycle= 16 E= -2.837624967928  delta_E= -7.44e-07  |g|= 8.85e-05  |ddm|=  5.7
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556587792716  LUMO = 1.60171779379307
  mo_energy =
[-0.90455659  1.60171779  7.55649786 18.04266738 35.90639965 61.14356203]
E1 = -3.8661361330501722  E_coul = 1.0285131095423095
cycle= 17 E= -2.83762302350786  delta_E= 1.94e-06  |g|= 9.79e-05  |ddm|= 0.497
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556484087952  LUMO = 1.6017188748644
  mo_energy =
[-0.90455648  1.60171887  7.55650253 18.04269211 35.90644938 61.14372351]
E1 = -3.8661360197691423  E_coul = 1.0285128648237634
cycle= 18 E= -2.83762315494538  delta_E= -1.31e-07  |g|= 7.25e-05  |ddm|= 1.99
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556904199492  LUMO = 1.60171016366383
  mo_energy =
[-0.9045569   1.60171016  7.55645728 18.04254744 35.90623134 61.14331929]
E1 = -3.8661368210230957  E_coul = 1.0285099418933437
cycle= 19 E= -2.83762687912975  delta_E= -3.72e-06  |g|= 0.00024  |ddm|= 10.7
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556773217171  LUMO = 1.60171290638735
  mo_energy =
[-0.90455677  1.60171291  7.55647107 18.04259396 35.9063063  61.14349126]
E1 = -3.8661365574886912  E_coul = 1.028511942574581
cycle= 20 E= -2.83762461491411  delta_E= 2.26e-06  |g|= 5.26e-05  |ddm|= 3.63
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554906791526  LUMO = 1.60174748123471
  mo_energy =
[-0.90455491  1.60174748  7.5566407  18.04321829 35.90733242 61.14603019]
E1 = -3.866133148294647  E_coul = 1.0285097224537922
cycle= 21 E= -2.83762342584085  delta_E= 1.19e-06  |g|= 0.000141  |ddm|= 48.9
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556315204237  LUMO = 1.60172784440358
  mo_energy =
[-0.90455632  1.60172784  7.55655217 18.04280293 35.90654876 61.14357336]
E1 = -3.8661352417231836  E_coul = 1.0285108388292548
cycle= 22 E= -2.83762440289393  delta_E= -9.77e-07  |g|= 7.52e-05  |ddm|= 33.8
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556419905771  LUMO = 1.60172524540452
  mo_energy =
[-0.90455642  1.60172525  7.55653883 18.04275814 35.9064796  61.14342946]
E1 = -3.8661354922871234  E_coul = 1.028512087409064
cycle= 23 E= -2.83762340487806  delta_E= 9.98e-07  |g|= 3.53e-05  |ddm|= 3.44
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556292286724  LUMO = 1.60172693570055
  mo_energy =
[-0.90455629  1.60172694  7.5565467  18.04279116 35.90653893 61.14360655]
E1 = -3.8661353217180143  E_coul = 1.0285124546474418
cycle= 24 E= -2.83762286707057  delta_E= 5.38e-07  |g|= 7.2e-05  |ddm|= 2.64
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556070579511  LUMO = 1.60173083386626
  mo_energy =
[-0.90455607  1.60173083  7.55656627 18.04285827 35.90664608 61.14385415]
E1 = -3.866134955408941  E_coul = 1.028508384603434
cycle= 25 E= -2.83762657080551  delta_E= -3.7e-06  |g|= 0.000284  |ddm|= 5.12
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556660532954  LUMO = 1.60171932844167
  mo_energy =
[-0.90455666  1.60171933  7.55650739 18.04266066 35.90633671 61.14321149]
E1 = -3.866136031997855  E_coul = 1.0285143734492583
cycle= 26 E= -2.8376216585486  delta_E= 4.91e-06  |g|= 0.000221  |ddm|= 14.9
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455653162445  LUMO = 1.60172178523308
  mo_energy =
[-0.90455653  1.60172179  7.55651999 18.04270219 35.90640076 61.14333986]
E1 = -3.86613580429256  E_coul = 1.0285127978058803
cycle= 27 E= -2.83762300648668  delta_E= -1.35e-06  |g|= 8.69e-05  |ddm|=  3.1
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455652342173  LUMO = 1.60172190340928
  mo_energy =
[-0.90455652  1.6017219   7.55652044 18.04270565 35.90640778 61.14336622]
E1 = -3.8661357877030498  E_coul = 1.0285131165038544
cycle= 28 E= -2.8376226711992  delta_E= 3.35e-07  |g|= 0.000108  |ddm|= 0.302
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556503183118  LUMO = 1.60172247253676
  mo_energy =
[-0.9045565   1.60172247  7.55652377 18.04271368 35.90641745 61.14336287]
E1 = -3.866135743611634  E_coul = 1.028510478872762
cycle= 29 E= -2.83762526473887  delta_E= -2.59e-06  |g|= 0.000138  |ddm|= 0.495
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558481821517  LUMO = 1.60168174180866
  mo_energy =
[-0.90455848  1.60168174  7.55631353 18.04202211 35.90535155 61.1412505 ]
E1 = -3.866139537205934  E_coul = 1.0285139867877102
cycle= 30 E= -2.83762555041822  delta_E= -2.86e-07  |g|= 3.44e-05  |ddm|= 51.7
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556075906786  LUMO = 1.60172823133052
  mo_energy =
[-0.90455608  1.60172823  7.55655069 18.0428236  35.90661223 61.14393917]
E1 = -3.866135169165982  E_coul = 1.0285133392407124
cycle= 31 E= -2.83762182992527  delta_E= 3.72e-06  |g|= 0.000149  |ddm|= 60.5
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555797160196  LUMO = 1.60173434767325
  mo_energy =
[-0.9045558   1.60173435  7.5565829  18.04292613 35.90676633 61.14419976]
E1 = -3.8661346113114425  E_coul = 1.0285100106929983
cycle= 32 E= -2.83762460061844  delta_E= -2.77e-06  |g|= 0.000121  |ddm|= 7.44
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556219387923  LUMO = 1.60172610270129
  mo_energy =
[-0.90455622  1.6017261   7.5565402  18.04278515 35.90654706 61.14377308]
E1 = -3.866135369411988  E_coul = 1.0285126599502141
cycle= 33 E= -2.83762270946177  delta_E= 1.89e-06  |g|= 7.82e-05  |ddm|= 10.4
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555442517418  LUMO = 1.60174104314704
  mo_energy =
[-0.90455544  1.60174104  7.55661674 18.04304039 35.90694577 61.14460026]
E1 = -3.8661339781978237  E_coul = 1.0285103495290997
cycle= 34 E= -2.83762362866872  delta_E= -9.19e-07  |g|= 7.79e-05  |ddm|= 19.2
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455589533128  LUMO = 1.60173276947358
  mo_energy =
[-0.9045559   1.60173277  7.55657547 18.04289016 35.90669869 61.14402289]
E1 = -3.8661347779395565  E_coul = 1.0285104925100212
cycle= 35 E= -2.83762428542954  delta_E= -6.57e-07  |g|= 9.23e-05  |ddm|= 11.5
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556135230869  LUMO = 1.60172828156372
  mo_energy =
[-0.90455614  1.60172828  7.55655314 18.04281085 35.90657127 61.14371846]
E1 = -3.8661352130479965  E_coul = 1.0285124761995716
cycle= 36 E= -2.83762273684842  delta_E= 1.55e-06  |g|= 7.07e-05  |ddm|= 6.15
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556146329203  LUMO = 1.60172812440906
  mo_energy =
[-0.90455615  1.60172812  7.5565524  18.04280615 35.90656145 61.14369852]
E1 = -3.866135230571121  E_coul = 1.0285110304398581
cycle= 37 E= -2.83762420013126  delta_E= -1.46e-06  |g|= 6.15e-05  |ddm|= 0.328
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556052353926  LUMO = 1.60172983276253
  mo_energy =
[-0.90455605  1.60172983  7.556561   18.04283806 35.90661538 61.14382104]
E1 = -3.866135066663978  E_coul = 1.0285133599325134
cycle= 38 E= -2.83762170673146  delta_E= 2.49e-06  |g|= 0.000172  |ddm|= 2.39
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556006658638  LUMO = 1.60173056364589
  mo_energy =
[-0.90455601  1.60173056  7.55656421 18.04285407 35.90664545 61.14391681]
E1 = -3.866134984082977  E_coul = 1.0285116106559637
cycle= 39 E= -2.83762337342701  delta_E= -1.67e-06  |g|= 1.18e-05  |ddm|= 1.33
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556116796956  LUMO = 1.60172811521238
  mo_energy =
[-0.90455612  1.60172812  7.55655115 18.04281443 35.90658822 61.14383487]
E1 = -3.8661352025259994  E_coul = 1.0285103658641805
cycle= 40 E= -2.83762483666182  delta_E= -1.46e-06  |g|= 0.000116  |ddm|= 2.84
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556111633562  LUMO = 1.60172846911647
  mo_energy =
[-0.90455611  1.60172847  7.55655369 18.0428194  35.90659333 61.14380689]
E1 = -3.866135183174033  E_coul = 1.0285115282700512
cycle= 41 E= -2.83762365490398  delta_E= 1.18e-06  |g|= 1.12e-05  |ddm|= 0.141
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556186893151  LUMO = 1.60172704427954
  mo_energy =
[-0.90455619  1.60172704  7.55654642 18.04279581 35.90655739 61.14373574]
E1 = -3.8661353143020603  E_coul = 1.0285131607078646
cycle= 42 E= -2.8376221535942  delta_E= 1.5e-06  |g|= 0.000128  |ddm|= 1.78
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556416558359  LUMO = 1.60172149437248
  mo_energy =
[-0.90455642  1.60172149  7.55651713 18.04270876 35.90643393 61.14351812]
E1 = -3.86613582057552  E_coul = 1.0285116328037545
cycle= 43 E= -2.83762418777177  delta_E= -2.03e-06  |g|= 3.83e-05  |ddm|= 6.49
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555254207302  LUMO = 1.60174343695059
  mo_energy =
[-0.90455525  1.60174344  7.55662645 18.04309957 35.90706689 61.14502564]
E1 = -3.866133691109675  E_coul = 1.0285094393843655
cycle= 44 E= -2.83762425172531  delta_E= -6.4e-08  |g|= 0.000152  |ddm|= 30.2
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556234272157  LUMO = 1.60172632617848
  mo_energy =
[-0.90455623  1.60172633  7.55654266 18.0427932  35.90656487 61.14378197]
E1 = -3.8661353625353807  E_coul = 1.0285107533366162
cycle= 45 E= -2.83762460919876  delta_E= -3.57e-07  |g|= 8.74e-05  |ddm|=   24
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556249064788  LUMO = 1.6017259598396
  mo_energy =
[-0.90455625  1.60172596  7.5565403  18.04279041 35.906565   61.1438135 ]
E1 = -3.8661353820122715  E_coul = 1.0285131669111682
cycle= 46 E= -2.8376222151011  delta_E= 2.39e-06  |g|= 0.00013  |ddm|= 0.082
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556392027313  LUMO = 1.60172335209354
  mo_energy =
[-0.90455639  1.60172335  7.55652738 18.04274365 35.90648863 61.14363459]
E1 = -3.866135635263871  E_coul = 1.0285152760652525
cycle= 47 E= -2.83762035919862  delta_E= 1.86e-06  |g|= 0.000319  |ddm|= 3.61
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556367700244  LUMO = 1.6017240809351
  mo_energy =
[-0.90455637  1.60172408  7.55653153 18.04275571 35.9065058  61.14365122]
E1 = -3.866135573026507  E_coul = 1.0285138016776334
cycle= 48 E= -2.83762177134887  delta_E= -1.41e-06  |g|= 0.00017  |ddm|= 0.791
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556072786238  LUMO = 1.60172989858655
  mo_energy =
[-0.90455607  1.6017299   7.55656159 18.04285249 35.90665288 61.14393733]
E1 = -3.8661350383876116  E_coul = 1.0285121406865303
cycle= 49 E= -2.83762289770108  delta_E= -1.13e-06  |g|= 4.86e-05  |ddm|= 7.22
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555938637739  LUMO = 1.60173239229823
  mo_energy =
[-0.90455594  1.60173239  7.55657415 18.04289571 35.90672157 61.14409447]
E1 = -3.8661348014682795  E_coul = 1.0285108554047262
cycle= 50 E= -2.83762394606355  delta_E= -1.05e-06  |g|= 7e-05  |ddm|= 3.32
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8661348014682795  E_coul = 1.0285108554047262

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904556545350909  LUMO = 1.60172108098568
  mo_energy =
[-0.90455655  1.60172108  7.55651847 18.0426763  35.90634794 61.14317557]
E1 = -3.8661359381276674  E_coul = 1.0285145279224668
Extra cycle  E= -2.8376214102052  delta_E= 2.54e-06  |g|= 0.000232  |ddm|= 16.9
    CPU time for scf_cycle      0.49 sec, wall time      0.49 sec
exp = [6.32158286 5.57372827 4.90673205 4.21434715 3.81126611 0.37756327]
E = -2.837621410205201
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:53 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.32151498577        1
[INPUT] 0    0    [1    /1   ]  5.57366848997        1
[INPUT] 0    0    [1    /1   ]  4.90667946576        1
[INPUT] 0    0    [1    /1   ]  4.21430449243        1
[INPUT] 0    0    [1    /1   ]  3.81122728388        1
[INPUT] 0    0    [1    /1   ]  0.377562236514       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.321514985767376, 1.0]], [0, [5.573668489965619, 1.0]], [0, [4.906679465756441, 1.0]], [0, [4.214304492430682, 1.0]], [0, [3.8112272838789703, 1.0]], [0, [0.37756223651367726, 1.0]]]}
ecp = {}
CPU time:        50.10
Set gradient conv threshold to 3.16228e-05
cond(S) = 981581011.2643152

WARN: Singularity detected in overlap matrix (condition number = 9.82e+08). SCF may be inaccurate and hard to converge.

E1 = -3.856645355966328  E_coul = 1.0242336469010025
init E= -2.83241170906533
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906684718948063  LUMO = 1.59788585062564
  mo_energy =
[-0.90668472  1.59788585  7.55212063 18.03883512 35.90260508 61.14034458]
E1 = -3.866379084241681  E_coul = 1.0287562553421488
cycle= 1 E= -2.83762282889953  delta_E= -0.00521  |g|= 0.00608  |ddm|= 1.03e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904434193613075  LUMO = 1.60175242504028
  mo_energy =
[-0.90443419  1.60175243  7.55661047 18.04244273 35.90556512 61.14058373]
E1 = -3.86613779522501  E_coul = 1.028515169343212
cycle= 2 E= -2.8376226258818  delta_E= 2.03e-07  |g|= 0.000423  |ddm|=  724
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904560805283939  LUMO = 1.60173941213312
  mo_energy =
[-0.90456081  1.60173941  7.55663447 18.04291993 35.90644999 61.14281608]
E1 = -3.8661319399870524  E_coul = 1.028509545958592
cycle= 3 E= -2.83762239402846  delta_E= 2.32e-07  |g|= 1.37e-05  |ddm|= 21.3
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904555558503999  LUMO = 1.60174664775508
  mo_energy =
[-0.90455556  1.60174665  7.55666322 18.04296309 35.9064845  61.14284619]
E1 = -3.866132780909445  E_coul = 1.0285108311614168
cycle= 4 E= -2.83762194974803  delta_E= 4.44e-07  |g|= 4.07e-05  |ddm|= 1.27
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904555609628253  LUMO = 1.60175414228565
  mo_energy =
[-0.90455561  1.60175414  7.55670393 18.04310968 35.90671969 61.14325837]
E1 = -3.8661319613619947  E_coul = 1.0285089263542304
cycle= 5 E= -2.83762303500776  delta_E= -1.09e-06  |g|= 0.000103  |ddm|= 10.4
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556296429671  LUMO = 1.60174492717136
  mo_energy =
[-0.9045563   1.60174493  7.55665837 18.04294062 35.90643842 61.14259192]
E1 = -3.866132804924718  E_coul = 1.028510494988313
cycle= 6 E= -2.83762230993641  delta_E= 7.25e-07  |g|= 8.37e-06  |ddm|= 12.6
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455617422385  LUMO = 1.601746092717
  mo_energy =
[-0.90455617  1.60174609  7.55666431 18.04295635 35.90645783 61.14261765]
E1 = -3.866132719991546  E_coul = 1.0285111257630692
cycle= 7 E= -2.83762159422848  delta_E= 7.16e-07  |g|= 7.45e-05  |ddm|= 1.09
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555951185219  LUMO = 1.60174988162354
  mo_energy =
[-0.90455595  1.60174988  7.55668343 18.04302121 35.90656049 61.14285618]
E1 = -3.8661323678286807  E_coul = 1.0285109551835012
cycle= 8 E= -2.83762141264518  delta_E= 1.82e-07  |g|= 8.03e-05  |ddm|= 4.92
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555814107176  LUMO = 1.60175266205189
  mo_energy =
[-0.90455581  1.60175266  7.55669699 18.04307101 35.90664227 61.14306521]
E1 = -3.866132087117466  E_coul = 1.0285101336120772
cycle= 9 E= -2.83762195350539  delta_E= -5.41e-07  |g|= 9.97e-06  |ddm|= 3.99
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555829200174  LUMO = 1.60175327647495
  mo_energy =
[-0.90455583  1.60175328  7.55670086 18.04307552 35.90663999 61.14300053]
E1 = -3.8661320408095143  E_coul = 1.0285118850749742
cycle= 10 E= -2.83762015573454  delta_E= 1.8e-06  |g|= 0.000185  |ddm|= 0.244
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555444967116  LUMO = 1.60175958150747
  mo_energy =
[-0.90455544  1.60175958  7.55673252 18.04318849 35.9068238  61.14342775]
E1 = -3.8661314482812172  E_coul = 1.0285099309566816
cycle= 11 E= -2.83762151732454  delta_E= -1.36e-06  |g|= 1.29e-05  |ddm|= 8.51
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555440599323  LUMO = 1.60176065545936
  mo_energy =
[-0.90455544  1.60176066  7.55673832 18.04320444 35.90684478 61.14345535]
E1 = -3.8661313412317675  E_coul = 1.0285106978115852
cycle= 12 E= -2.83762064342018  delta_E= 8.74e-07  |g|= 9.52e-05  |ddm|= 1.25
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555440834005  LUMO = 1.60176017994634
  mo_energy =
[-0.90455544  1.60176018  7.55673576 18.04319726 35.90683524 61.14344179]
E1 = -3.8661313894218985  E_coul = 1.0285090254261489
cycle= 13 E= -2.83762236399575  delta_E= -1.72e-06  |g|= 6.49e-05  |ddm|= 0.568
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555389422651  LUMO = 1.601761299535
  mo_energy =
[-0.90455539  1.6017613   7.55674146 18.04321678 35.9068659  61.14350736]
E1 = -3.8661312814556723  E_coul = 1.0285090421055756
cycle= 14 E= -2.8376222393501  delta_E= 1.25e-07  |g|= 5.75e-05  |ddm|= 1.49
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554986192107  LUMO = 1.60176822922981
  mo_energy =
[-0.90455499  1.60176823  7.5567761  18.04334081 35.9070693  61.14399274]
E1 = -3.8661306215589217  E_coul = 1.0285076931467119
cycle= 15 E= -2.83762292841221  delta_E= -6.89e-07  |g|= 0.000159  |ddm|= 9.47
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554462384269  LUMO = 1.60177838743563
  mo_energy =
[-0.90455446  1.60177839  7.55682695 18.04352105 35.90735745 61.14461489]
E1 = -3.866129639145542  E_coul = 1.0285092641354874
cycle= 16 E= -2.83762037501005  delta_E= 2.55e-06  |g|= 2.75e-05  |ddm|= 13.8
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555303248805  LUMO = 1.60176316763225
  mo_energy =
[-0.9045553   1.60176317  7.55675101 18.04324779 35.90690942 61.14354302]
E1 = -3.8661311064600086  E_coul = 1.0285076075440165
cycle= 17 E= -2.83762349891599  delta_E= -3.12e-06  |g|= 0.000186  |ddm|=   21
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555355578851  LUMO = 1.60176178482588
  mo_energy =
[-0.90455536  1.60176178  7.55674268 18.04323633 35.90690841 61.14365068]
E1 = -3.866131193819409  E_coul = 1.0285081688610098
cycle= 18 E= -2.8376230249584  delta_E= 4.74e-07  |g|= 0.000148  |ddm|= 0.56
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556779601121  LUMO = 1.60173553225426
  mo_energy =
[-0.90455678  1.60173553  7.55661047 18.04275699 35.90611729 61.1418292 ]
E1 = -3.8661337161930276  E_coul = 1.028512241687115
cycle= 19 E= -2.83762147450591  delta_E= 1.55e-06  |g|= 0.000138  |ddm|= 36.3
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555871406855  LUMO = 1.6017525283576
  mo_energy =
[-0.90455587  1.60175253  7.5566979  18.0430491  35.90657914 61.1427811 ]
E1 = -3.8661321470780723  E_coul = 1.0285121322445834
cycle= 20 E= -2.83762001483349  delta_E= 1.46e-06  |g|= 0.000195  |ddm|= 21.7
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555613574431  LUMO = 1.60175737211446
  mo_energy =
[-0.90455561  1.60175737  7.55672319 18.04313515 35.90671729 61.14306146]
E1 = -3.8661317027516673  E_coul = 1.028509790970009
cycle= 21 E= -2.83762191178166  delta_E= -1.9e-06  |g|= 5e-06  |ddm|= 6.23
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555538726735  LUMO = 1.6017583643205
  mo_energy =
[-0.90455554  1.60175836  7.55672779 18.04315497 35.90675384 61.14316777]
E1 = -3.866131602927745  E_coul = 1.0285102207483559
cycle= 22 E= -2.83762138217939  delta_E= 5.3e-07  |g|= 3.93e-05  |ddm|= 1.58
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555430605966  LUMO = 1.60176030613556
  mo_energy =
[-0.90455543  1.60176031  7.55673755 18.04318953 35.90680993 61.14330162]
E1 = -3.8661314171817183  E_coul = 1.0285105831269588
cycle= 23 E= -2.83762083405476  delta_E= 5.48e-07  |g|= 7.97e-05  |ddm|= 2.64
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555311938652  LUMO = 1.60176245322976
  mo_energy =
[-0.90455531  1.60176245  7.55674808 18.04322693 35.90687003 61.14345558]
E1 = -3.8661312074514935  E_coul = 1.0285125394541046
cycle= 24 E= -2.83761866799739  delta_E= 2.17e-06  |g|= 0.000276  |ddm|= 2.96
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455497811056  LUMO = 1.6017688945282
  mo_energy =
[-0.90455498  1.60176889  7.55678098 18.04333893 35.90704711 61.14382468]
E1 = -3.866130602774515  E_coul = 1.0285111127341549
cycle= 25 E= -2.83761949004036  delta_E= -8.22e-07  |g|= 0.000178  |ddm|= 8.39
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554953464109  LUMO = 1.60176934393456
  mo_energy =
[-0.90455495  1.60176934  7.55678327 18.0433462  35.90705803 61.14384685]
E1 = -3.8661305617361474  E_coul = 1.028508369780714
cycle= 26 E= -2.83762219195543  delta_E= -2.7e-06  |g|= 8.35e-05  |ddm|= 0.551
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554684926575  LUMO = 1.60177413846669
  mo_energy =
[-0.90455468  1.60177414  7.55680717 18.043433   35.90720082 61.14418442]
E1 = -3.8661300993220435  E_coul = 1.028508393366963
cycle= 27 E= -2.83762170595508  delta_E= 4.86e-07  |g|= 6.57e-05  |ddm|= 6.64
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553912958784  LUMO = 1.60178823581089
  mo_energy =
[-0.90455391  1.60178824  7.55687845 18.04368735 35.9076183  61.14514547]
E1 = -3.8661287571598257  E_coul = 1.0285075942246005
cycle= 28 E= -2.83762116293523  delta_E= 5.43e-07  |g|= 8.78e-05  |ddm|= 19.2
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554353408506  LUMO = 1.6017790629149
  mo_energy =
[-0.90455435  1.60177906  7.55682922 18.04353604 35.90738964 61.14474464]
E1 = -3.866129568192358  E_coul = 1.028507627721656
cycle= 29 E= -2.8376219404707  delta_E= -7.78e-07  |g|= 0.00011  |ddm|= 10.8
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553678407607  LUMO = 1.6017925035412
  mo_energy =
[-0.90455368  1.6017925   7.5568985  18.04376287 35.9077373  61.14544069]
E1 = -3.866128320804379  E_coul = 1.0285061760965866
cycle= 30 E= -2.83762214470779  delta_E= -2.04e-07  |g|= 0.000197  |ddm|= 16.9
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553025539605  LUMO = 1.60180511653019
  mo_energy =
[-0.90455303  1.60180512  7.55696337 18.04398763 35.90809787 61.14617328]
E1 = -3.8661271405999793  E_coul = 1.0285047948813766
cycle= 31 E= -2.8376223457186  delta_E= -2.01e-07  |g|= 0.000263  |ddm|= 16.6
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553027739282  LUMO = 1.60180682793039
  mo_energy =
[-0.90455303  1.60180683  7.5569744  18.0440075  35.90811116 61.1460898 ]
E1 = -3.866127017035776  E_coul = 1.028504665984266
cycle= 32 E= -2.83762235105151  delta_E= -5.33e-09  |g|= 0.000279  |ddm|= 0.987
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554130282123  LUMO = 1.60178525238609
  mo_energy =
[-0.90455413  1.60178525  7.55686363 18.04363817 35.90753722 61.14494029]
E1 = -3.8661290254991116  E_coul = 1.0285077874552135
cycle= 33 E= -2.8376212380439  delta_E= 1.11e-06  |g|= 7.74e-05  |ddm|= 27.5
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555150552386  LUMO = 1.60176663389745
  mo_energy =
[-0.90455515  1.60176663  7.55677007 18.04329359 35.90696589 61.14362236]
E1 = -3.866130824640385  E_coul = 1.0285107028918659
cycle= 34 E= -2.83762012174852  delta_E= 1.12e-06  |g|= 0.000138  |ddm|=   26
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553827738446  LUMO = 1.6017903175393
  mo_energy =
[-0.90455383  1.60179032  7.55688676 18.04373299 35.90770295 61.14549942]
E1 = -3.866128490557104  E_coul = 1.0285080436420038
cycle= 35 E= -2.8376204469151  delta_E= -3.25e-07  |g|= 4.04e-05  |ddm|= 34.1
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455333469384  LUMO = 1.60179952679564
  mo_energy =
[-0.90455333  1.60179953  7.55693227 18.0439003  35.90798125 61.14620579]
E1 = -3.866127587183659  E_coul = 1.0285049144881098
cycle= 36 E= -2.83762267269555  delta_E= -2.23e-06  |g|= 0.000288  |ddm|=   13
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553270710309  LUMO = 1.60180062002492
  mo_energy =
[-0.90455327  1.60180062  7.5569377  18.04392294 35.90802044 61.14628795]
E1 = -3.8661274783257236  E_coul = 1.0285073633359514
cycle= 37 E= -2.83762011498977  delta_E= 2.56e-06  |g|= 6.44e-05  |ddm|= 1.66
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904552978040358  LUMO = 1.60180577002868
  mo_energy =
[-0.90455298  1.60180577  7.55696336 18.04401457 35.90816842 61.14665334]
E1 = -3.8661269813754346  E_coul = 1.028502820852613
cycle= 38 E= -2.83762416052282  delta_E= -4.05e-06  |g|= 0.000457  |ddm|= 7.06
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904552269631525  LUMO = 1.60181921751829
  mo_energy =
[-0.90455227  1.60181922  7.5570319  18.04425347 35.90855179 61.14746813]
E1 = -3.8661257118927437  E_coul = 1.0285048745973382
cycle= 39 E= -2.83762083729541  delta_E= 3.32e-06  |g|= 0.000212  |ddm|= 17.8
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553343757835  LUMO = 1.60179808878335
  mo_energy =
[-0.90455334  1.60179809  7.55692507 18.04387811 35.90794697 61.14609943]
E1 = -3.866127738276876  E_coul = 1.0285078001868961
cycle= 40 E= -2.83761993808998  delta_E= 8.99e-07  |g|= 2.45e-05  |ddm|= 28.5
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553367209396  LUMO = 1.60179758767769
  mo_energy =
[-0.90455337  1.60179759  7.55692287 18.04387023 35.90793428 61.14605118]
E1 = -3.8661277926223696  E_coul = 1.0285067557768286
cycle= 41 E= -2.83762103684554  delta_E= -1.1e-06  |g|= 0.000134  |ddm|= 0.762
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553126673769  LUMO = 1.6018020432328
  mo_energy =
[-0.90455313  1.60180204  7.55694521 18.0439503  35.90806494 61.14633548]
E1 = -3.8661273654492376  E_coul = 1.028508194633542
cycle= 42 E= -2.8376191708157  delta_E= 1.87e-06  |g|= 2.87e-05  |ddm|= 6.07
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904552919524513  LUMO = 1.6018109574426
  mo_energy =
[-0.90455292  1.60181096  7.556999   18.0440323  35.90808842 61.14583936]
E1 = -3.8661267411533475  E_coul = 1.0285046317167594
cycle= 43 E= -2.83762210943659  delta_E= -2.94e-06  |g|= 0.000256  |ddm|= 4.65
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904552864093064  LUMO = 1.6018149686878
  mo_energy =
[-0.90455286  1.60181497  7.55701802 18.04412531 35.90826631 61.146328  ]
E1 = -3.866126263706047  E_coul = 1.0285023479842417
cycle= 44 E= -2.83762391572181  delta_E= -1.81e-06  |g|= 0.000442  |ddm|= 7.64
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904549251465008  LUMO = 1.60188850530482
  mo_energy =
[-0.90454925  1.60188851  7.55739803 18.04536741 35.91016933 61.15000751]
E1 = -3.8661194453737533  E_coul = 1.0284969318409565
cycle= 45 E= -2.8376225135328  delta_E= 1.4e-06  |g|= 0.00065  |ddm|= 92.4
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554393047906  LUMO = 1.60178165464805
  mo_energy =
[-0.90455439  1.60178165  7.55684359 18.04358948 35.90748469 61.14496381]
E1 = -3.8661292907054365  E_coul = 1.0285071256784257
cycle= 46 E= -2.83762216502701  delta_E= 3.49e-07  |g|= 0.000155  |ddm|=  132
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554283009642  LUMO = 1.6017833584444
  mo_energy =
[-0.90455428  1.60178336  7.55685212 18.04361892 35.90752985 61.14505741]
E1 = -3.8661291314918897  E_coul = 1.0285095802600699
cycle= 47 E= -2.83761955123182  delta_E= 2.61e-06  |g|= 7.75e-05  |ddm|= 2.21
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455385458808  LUMO = 1.60179162332159
  mo_energy =
[-0.90455385  1.60179162  7.55689461 18.04375473 35.90773364 61.14545019]
E1 = -3.866128372467587  E_coul = 1.0285056747917056
cycle= 48 E= -2.83762269767588  delta_E= -3.15e-06  |g|= 0.000247  |ddm|= 10.2
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554523489511  LUMO = 1.60177908498037
  mo_energy =
[-0.90455452  1.60177908  7.55683149 18.04353281 35.90737591 61.14463928]
E1 = -3.866129570935038  E_coul = 1.0285080668782918
cycle= 49 E= -2.83762150405675  delta_E= 1.19e-06  |g|= 7.89e-05  |ddm|= 16.9
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554654363874  LUMO = 1.60177587340971
  mo_energy =
[-0.90455465  1.60177587  7.55681513 18.0434749  35.90728288 61.14442459]
E1 = -3.8661298878434134  E_coul = 1.0285078263145286
cycle= 50 E= -2.83762206152888  delta_E= -5.57e-07  |g|= 0.000113  |ddm|= 4.44
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8661298878434134  E_coul = 1.0285078263145286

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904557117709545  LUMO = 1.60175361300545
  mo_energy =
[-0.90455712  1.60175361  7.5567104  18.04307937 35.90661717 61.14273118]
E1 = -3.8661317769556542  E_coul = 1.0285091968671762
Extra cycle  E= -2.83762258008848  delta_E= -5.19e-07  |g|= 4.76e-05  |ddm|= 29.6
    CPU time for scf_cycle      0.50 sec, wall time      0.50 sec
exp = [6.32151499 5.57366849 4.90667947 4.21430449 3.81122728 0.37756224]
E = -2.8376225800884782
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:53 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.32150819878        1
[INPUT] 0    0    [1    /1   ]  5.57366251156        1
[INPUT] 0    0    [1    /1   ]  4.90667420756        1
[INPUT] 0    0    [1    /1   ]  4.21430022668        1
[INPUT] 0    0    [1    /1   ]  3.81122340136        1
[INPUT] 0    0    [1    /1   ]  0.377562132681       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.321508198776366, 1.0]], [0, [5.573662511556829, 1.0]], [0, [4.906674207563312, 1.0]], [0, [4.214300226677606, 1.0]], [0, [3.811223401356025, 1.0]], [0, [0.37756213268139316, 1.0]]]}
ecp = {}
CPU time:        50.86
Set gradient conv threshold to 3.16228e-05
cond(S) = 981582382.5792105

WARN: Singularity detected in overlap matrix (condition number = 9.82e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8566453588029113  E_coul = 1.0242141360455457
init E= -2.83243122275737
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906705451041709  LUMO = 1.59748192704872
  mo_energy =
[-0.90670545  1.59748193  7.55005175 18.0318922  35.89173455 61.11754406]
E1 = -3.8664168570747472  E_coul = 1.0287763099424712
cycle= 1 E= -2.83764054713228  delta_E= -0.00521  |g|= 0.00608  |ddm|= 1.08e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.90443302137393  LUMO = 1.60142733518999
  mo_energy =
[-0.90443302  1.60142734  7.55490093 18.0365965  35.89635901 61.12099874]
E1 = -3.866172996246127  E_coul = 1.0285294139908017
cycle= 2 E= -2.83764358225533  delta_E= -3.04e-06  |g|= 0.000416  |ddm|=  669
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904564420851871  LUMO = 1.60134768023794
  mo_energy =
[-0.90456442  1.60134768  7.55459419 18.03590613 35.89536383 61.11900991]
E1 = -3.866173231897081  E_coul = 1.0285295604589035
cycle= 3 E= -2.83764367143818  delta_E= -8.92e-08  |g|= 1.5e-05  |ddm|=  108
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904555219439868  LUMO = 1.60135280903208
  mo_energy =
[-0.90455522  1.60135281  7.55459567 18.035901   35.89536123 61.11916998]
E1 = -3.8661751792620223  E_coul = 1.0285309987718088
cycle= 4 E= -2.83764418049021  delta_E= -5.09e-07  |g|= 4.69e-05  |ddm|= 6.47
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.90455667724925  LUMO = 1.60134233487519
  mo_energy =
[-0.90455668  1.60134233  7.55454286 18.03573651 35.89511582 61.11875087]
E1 = -3.8661758718187866  E_coul = 1.028531981680388
cycle= 5 E= -2.8376438901384  delta_E= 2.9e-07  |g|= 1.59e-05  |ddm|= 11.2
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556322169432  LUMO = 1.60134616704845
  mo_energy =
[-0.90455632  1.60134617  7.55456481 18.03577876 35.89514981 61.11863284]
E1 = -3.866175649992691  E_coul = 1.0285323298457727
cycle= 6 E= -2.83764332014692  delta_E= 5.7e-07  |g|= 6.84e-05  |ddm|=  2.2
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556041011951  LUMO = 1.60135052930065
  mo_energy =
[-0.90455604  1.60135053  7.55458679 18.03586046 35.89528665 61.11895186]
E1 = -3.866175241309478  E_coul = 1.028532379256827
cycle= 7 E= -2.83764286205265  delta_E= 4.58e-07  |g|= 9.15e-05  |ddm|= 6.07
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555848772442  LUMO = 1.6013546869134
  mo_energy =
[-0.90455585  1.60135469  7.55460754 18.03593763 35.89541579 61.11926699]
E1 = -3.8661748280647976  E_coul = 1.0285314432096537
cycle= 8 E= -2.83764338485514  delta_E= -5.23e-07  |g|= 1.11e-05  |ddm|= 5.98
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555878039454  LUMO = 1.60135586658586
  mo_energy =
[-0.90455588  1.60135587  7.55461479 18.03594836 35.89541786 61.11919418]
E1 = -3.866174731168057  E_coul = 1.0285328388984463
cycle= 9 E= -2.83764189226961  delta_E= 1.49e-06  |g|= 0.000142  |ddm|= 0.691
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555661638441  LUMO = 1.60136114488987
  mo_energy =
[-0.90455566  1.60136114  7.5546423  18.03603525 35.89554841 61.11945694]
E1 = -3.8661742369369896  E_coul = 1.0285322124252372
cycle= 10 E= -2.83764202451175  delta_E= -1.32e-07  |g|= 0.000108  |ddm|= 6.58
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555664233124  LUMO = 1.60136022010226
  mo_energy =
[-0.90455566  1.60136022  7.55463783 18.03601719 35.89551684 61.11936074]
E1 = -3.8661743460764773  E_coul = 1.0285308692690995
cycle= 11 E= -2.83764347680738  delta_E= -1.45e-06  |g|= 2.34e-05  |ddm|= 1.55
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555616492043  LUMO = 1.60136145245719
  mo_energy =
[-0.90455562  1.60136145  7.55464466 18.03603541 35.89554027 61.11937653]
E1 = -3.8661742418376788  E_coul = 1.0285295329362159
cycle= 12 E= -2.83764470890146  delta_E= -1.23e-06  |g|= 0.000127  |ddm|= 1.25
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555660137857  LUMO = 1.6013611820828
  mo_energy =
[-0.90455566  1.60136118  7.55464347 18.0360305  35.89553155 61.119351  ]
E1 = -3.866174262256113  E_coul = 1.0285283669659313
cycle= 13 E= -2.83764589529018  delta_E= -1.19e-06  |g|= 0.000251  |ddm|= 0.368
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555105528037  LUMO = 1.60136911316969
  mo_energy =
[-0.90455511  1.60136911  7.55468182 18.03618519 35.89580259 61.12007122]
E1 = -3.8661734919005464  E_coul = 1.0285271860469563
cycle= 14 E= -2.83764630585359  delta_E= -4.11e-07  |g|= 0.000326  |ddm|= 11.9
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553813129249  LUMO = 1.60139481829594
  mo_energy =
[-0.90455381  1.60139482  7.55481347 18.0366165  35.89646533 61.1214378 ]
E1 = -3.866171104419823  E_coul = 1.0285257389062843
cycle= 15 E= -2.83764536551354  delta_E= 9.4e-07  |g|= 0.000343  |ddm|= 32.6
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555368950534  LUMO = 1.60136735181563
  mo_energy =
[-0.90455537  1.60136735  7.55467841 18.03610259 35.89559785 61.11925071]
E1 = -3.8661737996629433  E_coul = 1.0285308721644775
cycle= 16 E= -2.83764292749847  delta_E= 2.44e-06  |g|= 4.22e-05  |ddm|= 39.8
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555253805178  LUMO = 1.60136908150453
  mo_energy =
[-0.90455525  1.60136908  7.55468645 18.03614034 35.8956686  61.11946451]
E1 = -3.8661736141157057  E_coul = 1.028530178938829
cycle= 17 E= -2.83764343517688  delta_E= -5.08e-07  |g|= 3.82e-05  |ddm|=    3
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555723592846  LUMO = 1.60135988785725
  mo_energy =
[-0.90455572  1.60135989  7.55463938 18.03598212 35.89541949 61.1189124 ]
E1 = -3.8661744726202243  E_coul = 1.028532100559951
cycle= 18 E= -2.83764237206027  delta_E= 1.06e-06  |g|= 0.000104  |ddm|=   12
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555778331921  LUMO = 1.60135848465697
  mo_energy =
[-0.90455578  1.60135848  7.55463199 18.03595852 35.89538418 61.1188593 ]
E1 = -3.866174602185485  E_coul = 1.0285318979341354
cycle= 19 E= -2.83764270425135  delta_E= -3.32e-07  |g|= 7.16e-05  |ddm|= 1.74
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555534536549  LUMO = 1.60136281485816
  mo_energy =
[-0.90455553  1.60136281  7.55465384 18.03603088 35.89549624 61.11910534]
E1 = -3.8661741991872676  E_coul = 1.0285303594385409
cycle= 20 E= -2.83764383974873  delta_E= -1.14e-06  |g|= 5.43e-05  |ddm|= 5.55
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455532506969  LUMO = 1.60136764359248
  mo_energy =
[-0.90455533  1.60136764  7.55467997 18.03610077 35.89558514 61.11918367]
E1 = -3.8661737860231207  E_coul = 1.0285329370064447
cycle= 21 E= -2.83764084901668  delta_E= 2.99e-06  |g|= 0.000216  |ddm|= 4.97
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554162829711  LUMO = 1.60138936945348
  mo_energy =
[-0.90455416  1.60138937  7.55478982 18.03648546 35.89620401 61.12055968]
E1 = -3.8661717281741814  E_coul = 1.0285256123374156
cycle= 22 E= -2.83764611583677  delta_E= -5.27e-06  |g|= 0.000375  |ddm|= 29.2
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553640926569  LUMO = 1.60139903139341
  mo_energy =
[-0.90455364  1.60139903  7.5548377  18.03666222 35.89649618 61.12127589]
E1 = -3.8661707850356106  E_coul = 1.0285266742601227
cycle= 23 E= -2.83764411077549  delta_E= 2.01e-06  |g|= 0.000243  |ddm|= 13.7
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554076377397  LUMO = 1.60138976501385
  mo_energy =
[-0.90455408  1.60138977  7.55478848 18.03651205 35.89627578 61.12091817]
E1 = -3.8661716105359565  E_coul = 1.0285274801020816
cycle= 24 E= -2.83764413043387  delta_E= -1.97e-08  |g|= 0.000207  |ddm|= 10.8
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554141555534  LUMO = 1.60138922994141
  mo_energy =
[-0.90455414  1.60138923  7.55478705 18.03649163 35.89622723 61.12072854]
E1 = -3.8661716940708932  E_coul = 1.0285295429946615
cycle= 25 E= -2.83764215107623  delta_E= 1.98e-06  |g|= 1.09e-05  |ddm|= 1.79
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554187540192  LUMO = 1.60138874514834
  mo_energy =
[-0.90455419  1.60138875  7.55478549 18.03648015 35.89620274 61.12061923]
E1 = -3.8661717571597687  E_coul = 1.028529952277392
cycle= 26 E= -2.83764180488238  delta_E= 3.46e-07  |g|= 1.44e-05  |ddm|= 1.12
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554292734725  LUMO = 1.60138676860941
  mo_energy =
[-0.90455429  1.60138677  7.55477537 18.03644127 35.89613477 61.1204411 ]
E1 = -3.866171950820917  E_coul = 1.0285284861188926
cycle= 27 E= -2.83764346470202  delta_E= -1.66e-06  |g|= 0.000123  |ddm|= 2.93
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554022802595  LUMO = 1.60139212517647
  mo_energy =
[-0.90455402  1.60139213  7.55480203 18.03653554 35.89628663 61.12081466]
E1 = -3.866171430530913  E_coul = 1.0285286046248365
cycle= 28 E= -2.83764282590608  delta_E= 6.39e-07  |g|= 7.95e-05  |ddm|= 7.35
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904551355591171  LUMO = 1.60144126994851
  mo_energy =
[-0.90455136  1.60144127  7.55504808 18.03740744 35.89770163 61.1241678 ]
E1 = -3.8661667246182256  E_coul = 1.028524240035557
cycle= 29 E= -2.83764248458267  delta_E= 3.41e-07  |g|= 0.000293  |ddm|= 67.1
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556425305775  LUMO = 1.60134462703933
  mo_energy =
[-0.90455643  1.60134463  7.55456063 18.03571929 35.89500761 61.11812132]
E1 = -3.866175894702965  E_coul = 1.0285325239851777
cycle= 30 E= -2.83764337071779  delta_E= -8.86e-07  |g|= 7.43e-05  |ddm|=  129
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555610879528  LUMO = 1.60136111961309
  mo_energy =
[-0.90455561  1.60136112  7.55464555 18.03600604 35.8954595  61.11903043]
E1 = -3.8661743581427253  E_coul = 1.0285302115845087
cycle= 31 E= -2.83764414655822  delta_E= -7.76e-07  |g|= 6.19e-05  |ddm|= 21.4
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555822361978  LUMO = 1.60135685408371
  mo_energy =
[-0.90455582  1.60135685  7.55462352 18.03593507 35.89535187 61.11882119]
E1 = -3.866174751049962  E_coul = 1.028531571530609
cycle= 32 E= -2.83764317951935  delta_E= 9.67e-07  |g|= 5.82e-05  |ddm|= 5.31
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9045556407828  LUMO = 1.6013595050071
  mo_energy =
[-0.90455564  1.60135951  7.55463535 18.03599047 35.89545533 61.11914793]
E1 = -3.8661744670053  E_coul = 1.0285288204913914
cycle= 33 E= -2.83764564651391  delta_E= -2.47e-06  |g|= 0.0002  |ddm|= 4.57
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556214976402  LUMO = 1.60134831611889
  mo_energy =
[-0.90455621  1.60134832  7.55457766 18.03580047 35.89515975 61.11853384]
E1 = -3.8661754984936656  E_coul = 1.0285319885405122
cycle= 34 E= -2.83764350995315  delta_E= 2.14e-06  |g|= 5.45e-05  |ddm|= 14.2
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455622693477  LUMO = 1.60134779534978
  mo_energy =
[-0.90455623  1.6013478   7.55457384 18.03580553 35.89518667 61.11868311]
E1 = -3.8661755075063167  E_coul = 1.0285328010141397
cycle= 35 E= -2.83764270649218  delta_E= 8.03e-07  |g|= 0.00011  |ddm|= 0.588
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555998318526  LUMO = 1.6013524087557
  mo_energy =
[-0.904556    1.60135241  7.55459758 18.03588471 35.89531103 61.11893756]
E1 = -3.86617507905493  E_coul = 1.0285329874856686
cycle= 36 E= -2.83764209156926  delta_E= 6.15e-07  |g|= 0.000151  |ddm|= 5.94
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555794427199  LUMO = 1.60135661197643
  mo_energy =
[-0.90455579  1.60135661  7.55461904 18.03595668 35.89542318 61.11917238]
E1 = -3.8661746842669604  E_coul = 1.0285331584686042
cycle= 37 E= -2.83764152579836  delta_E= 5.66e-07  |g|= 0.000179  |ddm|= 5.45
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555296150611  LUMO = 1.60136665066396
  mo_energy =
[-0.9045553   1.60136665  7.55467077 18.03612885 35.89569213 61.11972267]
E1 = -3.8661737514585437  E_coul = 1.028529954438738
cycle= 38 E= -2.83764379701981  delta_E= -2.27e-06  |g|= 7.32e-05  |ddm|= 12.9
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555127173955  LUMO = 1.60136970917384
  mo_energy =
[-0.90455513  1.60136971  7.5546853  18.03619287 35.89580789 61.12005512]
E1 = -3.8661734288765492  E_coul = 1.0285298044736584
cycle= 39 E= -2.83764362440289  delta_E= 1.73e-07  |g|= 6.39e-05  |ddm|= 5.07
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555129881519  LUMO = 1.60136956649406
  mo_energy =
[-0.90455513  1.60136957  7.55468469 18.03618701 35.89579465 61.12000778]
E1 = -3.866173451350386  E_coul = 1.0285297417784753
cycle= 40 E= -2.83764370957191  delta_E= -8.52e-08  |g|= 7.6e-05  |ddm|= 0.459
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555159452648  LUMO = 1.60136918763984
  mo_energy =
[-0.90455516  1.60136919  7.55468295 18.03618028 35.8957832  61.11996981]
E1 = -3.8661734886716723  E_coul = 1.028530265474821
cycle= 41 E= -2.83764322319685  delta_E= 4.86e-07  |g|= 3.16e-05  |ddm|= 0.556
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455487989736  LUMO = 1.60137460858786
  mo_energy =
[-0.90455488  1.60137461  7.55471054 18.03627482 35.89593399 61.12030346]
E1 = -3.8661729787881165  E_coul = 1.0285320046523703
cycle= 42 E= -2.83764097413575  delta_E= 2.25e-06  |g|= 0.000141  |ddm|= 7.16
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554742149046  LUMO = 1.60137806805518
  mo_energy =
[-0.90455474  1.60137807  7.55472976 18.03631891 35.89598217 61.12029168]
E1 = -3.8661727006078648  E_coul = 1.0285281162029536
cycle= 43 E= -2.83764458440491  delta_E= -3.61e-06  |g|= 0.000189  |ddm|= 3.04
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9045541607621  LUMO = 1.60138916422963
  mo_energy =
[-0.90455416  1.60138916  7.55478463 18.03651505 35.89629816 61.12105132]
E1 = -3.8661716220726876  E_coul = 1.028528688745536
cycle= 44 E= -2.83764293332715  delta_E= 1.65e-06  |g|= 9.4e-05  |ddm|= 15.3
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554777452092  LUMO = 1.6013765128413
  mo_energy =
[-0.90455478  1.60137651  7.55471831 18.03629983 35.89596872 61.12043972]
E1 = -3.866172774944736  E_coul = 1.0285312297142426
cycle= 45 E= -2.83764154523049  delta_E= 1.39e-06  |g|= 8.96e-05  |ddm|= 15.7
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556175495618  LUMO = 1.60134870558905
  mo_energy =
[-0.90455618  1.60134871  7.55457281 18.03584173 35.89528009 61.1191583 ]
E1 = -3.8661752850836977  E_coul = 1.028531744070364
cycle= 46 E= -2.83764354101333  delta_E= -2e-06  |g|= 2.25e-05  |ddm|= 33.7
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555929342007  LUMO = 1.60135602243127
  mo_energy =
[-0.90455593  1.60135602  7.55461375 18.03596709 35.89546611 61.11944423]
E1 = -3.8661746331968967  E_coul = 1.0285318082727486
cycle= 47 E= -2.83764282492415  delta_E= 7.16e-07  |g|= 5.11e-05  |ddm|=  8.6
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555646750791  LUMO = 1.60136207939534
  mo_energy =
[-0.90455565  1.60136208  7.55464696 18.03605592 35.8955862  61.11958474]
E1 = -3.8661741296436523  E_coul = 1.0285291338365288
cycle= 48 E= -2.83764499580712  delta_E= -2.17e-06  |g|= 0.000168  |ddm|= 6.19
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556005936476  LUMO = 1.60135525394147
  mo_energy =
[-0.90455601  1.60135525  7.55461261 18.03593551 35.8953936  61.11915602]
E1 = -3.866174780331568  E_coul = 1.0285320549109618
cycle= 49 E= -2.83764272542061  delta_E= 2.27e-06  |g|= 7.24e-05  |ddm|= 9.21
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555785361225  LUMO = 1.60135958764934
  mo_energy =
[-0.90455579  1.60135959  7.55463479 18.03600668 35.89549883 61.11935166]
E1 = -3.8661743800642148  E_coul = 1.0285319030671334
cycle= 50 E= -2.83764247699708  delta_E= 2.48e-07  |g|= 8.7e-05  |ddm|= 5.37
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8661743800642148  E_coul = 1.0285319030671334

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904555287010567  LUMO = 1.60137500848551
  mo_energy =
[-0.90455529  1.60137501  7.55471184 18.03629914 35.89599172 61.12052435]
E1 = -3.8661727706165903  E_coul = 1.0285290817162875
Extra cycle  E= -2.8376436889003  delta_E= -1.21e-06  |g|= 0.000127  |ddm|=   23
    CPU time for scf_cycle      0.51 sec, wall time      0.52 sec
exp = [6.3215082  5.57366251 4.90667421 4.21430023 3.8112234  0.37756213]
E = -2.837643688900303
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:54 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.32150819878        1
[INPUT] 0    0    [1    /1   ]  5.57366251156        1
[INPUT] 0    0    [1    /1   ]  4.90667420756        1
[INPUT] 0    0    [1    /1   ]  4.21430022668        1
[INPUT] 0    0    [1    /1   ]  3.81122340136        1
[INPUT] 0    0    [1    /1   ]  0.377562132681       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.321508198776366, 1.0]], [0, [5.573662511556829, 1.0]], [0, [4.906674207563312, 1.0]], [0, [4.214300226677606, 1.0]], [0, [3.811223401356025, 1.0]], [0, [0.37756213268139316, 1.0]]]}
ecp = {}
CPU time:        51.62
Set gradient conv threshold to 3.16228e-05
cond(S) = 981582382.5792105

WARN: Singularity detected in overlap matrix (condition number = 9.82e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8566453588029113  E_coul = 1.0242141360455457
init E= -2.83243122275737
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906705451041709  LUMO = 1.59748192704872
  mo_energy =
[-0.90670545  1.59748193  7.55005175 18.0318922  35.89173455 61.11754406]
E1 = -3.8664168570747472  E_coul = 1.0287763099424712
cycle= 1 E= -2.83764054713228  delta_E= -0.00521  |g|= 0.00608  |ddm|= 1.08e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.90443302137393  LUMO = 1.60142733518999
  mo_energy =
[-0.90443302  1.60142734  7.55490093 18.0365965  35.89635901 61.12099874]
E1 = -3.866172996246127  E_coul = 1.0285294139908017
cycle= 2 E= -2.83764358225533  delta_E= -3.04e-06  |g|= 0.000416  |ddm|=  669
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904564420851871  LUMO = 1.60134768023794
  mo_energy =
[-0.90456442  1.60134768  7.55459419 18.03590613 35.89536383 61.11900991]
E1 = -3.866173231897081  E_coul = 1.0285295604589035
cycle= 3 E= -2.83764367143818  delta_E= -8.92e-08  |g|= 1.5e-05  |ddm|=  108
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904555219439868  LUMO = 1.60135280903208
  mo_energy =
[-0.90455522  1.60135281  7.55459567 18.035901   35.89536123 61.11916998]
E1 = -3.8661751792620223  E_coul = 1.0285309987718088
cycle= 4 E= -2.83764418049021  delta_E= -5.09e-07  |g|= 4.69e-05  |ddm|= 6.47
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.90455667724925  LUMO = 1.60134233487519
  mo_energy =
[-0.90455668  1.60134233  7.55454286 18.03573651 35.89511582 61.11875087]
E1 = -3.8661758718187866  E_coul = 1.028531981680388
cycle= 5 E= -2.8376438901384  delta_E= 2.9e-07  |g|= 1.59e-05  |ddm|= 11.2
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556322169432  LUMO = 1.60134616704845
  mo_energy =
[-0.90455632  1.60134617  7.55456481 18.03577876 35.89514981 61.11863284]
E1 = -3.866175649992691  E_coul = 1.0285323298457727
cycle= 6 E= -2.83764332014692  delta_E= 5.7e-07  |g|= 6.84e-05  |ddm|=  2.2
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556041011951  LUMO = 1.60135052930065
  mo_energy =
[-0.90455604  1.60135053  7.55458679 18.03586046 35.89528665 61.11895186]
E1 = -3.866175241309478  E_coul = 1.028532379256827
cycle= 7 E= -2.83764286205265  delta_E= 4.58e-07  |g|= 9.15e-05  |ddm|= 6.07
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555848772442  LUMO = 1.6013546869134
  mo_energy =
[-0.90455585  1.60135469  7.55460754 18.03593763 35.89541579 61.11926699]
E1 = -3.8661748280647976  E_coul = 1.0285314432096537
cycle= 8 E= -2.83764338485514  delta_E= -5.23e-07  |g|= 1.11e-05  |ddm|= 5.98
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555878039454  LUMO = 1.60135586658586
  mo_energy =
[-0.90455588  1.60135587  7.55461479 18.03594836 35.89541786 61.11919418]
E1 = -3.866174731168057  E_coul = 1.0285328388984463
cycle= 9 E= -2.83764189226961  delta_E= 1.49e-06  |g|= 0.000142  |ddm|= 0.691
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555661638441  LUMO = 1.60136114488987
  mo_energy =
[-0.90455566  1.60136114  7.5546423  18.03603525 35.89554841 61.11945694]
E1 = -3.8661742369369896  E_coul = 1.0285322124252372
cycle= 10 E= -2.83764202451175  delta_E= -1.32e-07  |g|= 0.000108  |ddm|= 6.58
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555664233124  LUMO = 1.60136022010226
  mo_energy =
[-0.90455566  1.60136022  7.55463783 18.03601719 35.89551684 61.11936074]
E1 = -3.8661743460764773  E_coul = 1.0285308692690995
cycle= 11 E= -2.83764347680738  delta_E= -1.45e-06  |g|= 2.34e-05  |ddm|= 1.55
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555616492043  LUMO = 1.60136145245719
  mo_energy =
[-0.90455562  1.60136145  7.55464466 18.03603541 35.89554027 61.11937653]
E1 = -3.8661742418376788  E_coul = 1.0285295329362159
cycle= 12 E= -2.83764470890146  delta_E= -1.23e-06  |g|= 0.000127  |ddm|= 1.25
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555660137857  LUMO = 1.6013611820828
  mo_energy =
[-0.90455566  1.60136118  7.55464347 18.0360305  35.89553155 61.119351  ]
E1 = -3.866174262256113  E_coul = 1.0285283669659313
cycle= 13 E= -2.83764589529018  delta_E= -1.19e-06  |g|= 0.000251  |ddm|= 0.368
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555105528037  LUMO = 1.60136911316969
  mo_energy =
[-0.90455511  1.60136911  7.55468182 18.03618519 35.89580259 61.12007122]
E1 = -3.8661734919005464  E_coul = 1.0285271860469563
cycle= 14 E= -2.83764630585359  delta_E= -4.11e-07  |g|= 0.000326  |ddm|= 11.9
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553813129249  LUMO = 1.60139481829594
  mo_energy =
[-0.90455381  1.60139482  7.55481347 18.0366165  35.89646533 61.1214378 ]
E1 = -3.866171104419823  E_coul = 1.0285257389062843
cycle= 15 E= -2.83764536551354  delta_E= 9.4e-07  |g|= 0.000343  |ddm|= 32.6
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555368950534  LUMO = 1.60136735181563
  mo_energy =
[-0.90455537  1.60136735  7.55467841 18.03610259 35.89559785 61.11925071]
E1 = -3.8661737996629433  E_coul = 1.0285308721644775
cycle= 16 E= -2.83764292749847  delta_E= 2.44e-06  |g|= 4.22e-05  |ddm|= 39.8
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555253805178  LUMO = 1.60136908150453
  mo_energy =
[-0.90455525  1.60136908  7.55468645 18.03614034 35.8956686  61.11946451]
E1 = -3.8661736141157057  E_coul = 1.028530178938829
cycle= 17 E= -2.83764343517688  delta_E= -5.08e-07  |g|= 3.82e-05  |ddm|=    3
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555723592846  LUMO = 1.60135988785725
  mo_energy =
[-0.90455572  1.60135989  7.55463938 18.03598212 35.89541949 61.1189124 ]
E1 = -3.8661744726202243  E_coul = 1.028532100559951
cycle= 18 E= -2.83764237206027  delta_E= 1.06e-06  |g|= 0.000104  |ddm|=   12
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555778331921  LUMO = 1.60135848465697
  mo_energy =
[-0.90455578  1.60135848  7.55463199 18.03595852 35.89538418 61.1188593 ]
E1 = -3.866174602185485  E_coul = 1.0285318979341354
cycle= 19 E= -2.83764270425135  delta_E= -3.32e-07  |g|= 7.16e-05  |ddm|= 1.74
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555534536549  LUMO = 1.60136281485816
  mo_energy =
[-0.90455553  1.60136281  7.55465384 18.03603088 35.89549624 61.11910534]
E1 = -3.8661741991872676  E_coul = 1.0285303594385409
cycle= 20 E= -2.83764383974873  delta_E= -1.14e-06  |g|= 5.43e-05  |ddm|= 5.55
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455532506969  LUMO = 1.60136764359248
  mo_energy =
[-0.90455533  1.60136764  7.55467997 18.03610077 35.89558514 61.11918367]
E1 = -3.8661737860231207  E_coul = 1.0285329370064447
cycle= 21 E= -2.83764084901668  delta_E= 2.99e-06  |g|= 0.000216  |ddm|= 4.97
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554162829711  LUMO = 1.60138936945348
  mo_energy =
[-0.90455416  1.60138937  7.55478982 18.03648546 35.89620401 61.12055968]
E1 = -3.8661717281741814  E_coul = 1.0285256123374156
cycle= 22 E= -2.83764611583677  delta_E= -5.27e-06  |g|= 0.000375  |ddm|= 29.2
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553640926569  LUMO = 1.60139903139341
  mo_energy =
[-0.90455364  1.60139903  7.5548377  18.03666222 35.89649618 61.12127589]
E1 = -3.8661707850356106  E_coul = 1.0285266742601227
cycle= 23 E= -2.83764411077549  delta_E= 2.01e-06  |g|= 0.000243  |ddm|= 13.7
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554076377397  LUMO = 1.60138976501385
  mo_energy =
[-0.90455408  1.60138977  7.55478848 18.03651205 35.89627578 61.12091817]
E1 = -3.8661716105359565  E_coul = 1.0285274801020816
cycle= 24 E= -2.83764413043387  delta_E= -1.97e-08  |g|= 0.000207  |ddm|= 10.8
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554141555534  LUMO = 1.60138922994141
  mo_energy =
[-0.90455414  1.60138923  7.55478705 18.03649163 35.89622723 61.12072854]
E1 = -3.8661716940708932  E_coul = 1.0285295429946615
cycle= 25 E= -2.83764215107623  delta_E= 1.98e-06  |g|= 1.09e-05  |ddm|= 1.79
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554187540192  LUMO = 1.60138874514834
  mo_energy =
[-0.90455419  1.60138875  7.55478549 18.03648015 35.89620274 61.12061923]
E1 = -3.8661717571597687  E_coul = 1.028529952277392
cycle= 26 E= -2.83764180488238  delta_E= 3.46e-07  |g|= 1.44e-05  |ddm|= 1.12
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554292734725  LUMO = 1.60138676860941
  mo_energy =
[-0.90455429  1.60138677  7.55477537 18.03644127 35.89613477 61.1204411 ]
E1 = -3.866171950820917  E_coul = 1.0285284861188926
cycle= 27 E= -2.83764346470202  delta_E= -1.66e-06  |g|= 0.000123  |ddm|= 2.93
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554022802595  LUMO = 1.60139212517647
  mo_energy =
[-0.90455402  1.60139213  7.55480203 18.03653554 35.89628663 61.12081466]
E1 = -3.866171430530913  E_coul = 1.0285286046248365
cycle= 28 E= -2.83764282590608  delta_E= 6.39e-07  |g|= 7.95e-05  |ddm|= 7.35
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904551355591171  LUMO = 1.60144126994851
  mo_energy =
[-0.90455136  1.60144127  7.55504808 18.03740744 35.89770163 61.1241678 ]
E1 = -3.8661667246182256  E_coul = 1.028524240035557
cycle= 29 E= -2.83764248458267  delta_E= 3.41e-07  |g|= 0.000293  |ddm|= 67.1
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556425305775  LUMO = 1.60134462703933
  mo_energy =
[-0.90455643  1.60134463  7.55456063 18.03571929 35.89500761 61.11812132]
E1 = -3.866175894702965  E_coul = 1.0285325239851777
cycle= 30 E= -2.83764337071779  delta_E= -8.86e-07  |g|= 7.43e-05  |ddm|=  129
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555610879528  LUMO = 1.60136111961309
  mo_energy =
[-0.90455561  1.60136112  7.55464555 18.03600604 35.8954595  61.11903043]
E1 = -3.8661743581427253  E_coul = 1.0285302115845087
cycle= 31 E= -2.83764414655822  delta_E= -7.76e-07  |g|= 6.19e-05  |ddm|= 21.4
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555822361978  LUMO = 1.60135685408371
  mo_energy =
[-0.90455582  1.60135685  7.55462352 18.03593507 35.89535187 61.11882119]
E1 = -3.866174751049962  E_coul = 1.028531571530609
cycle= 32 E= -2.83764317951935  delta_E= 9.67e-07  |g|= 5.82e-05  |ddm|= 5.31
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9045556407828  LUMO = 1.6013595050071
  mo_energy =
[-0.90455564  1.60135951  7.55463535 18.03599047 35.89545533 61.11914793]
E1 = -3.8661744670053  E_coul = 1.0285288204913914
cycle= 33 E= -2.83764564651391  delta_E= -2.47e-06  |g|= 0.0002  |ddm|= 4.57
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556214976402  LUMO = 1.60134831611889
  mo_energy =
[-0.90455621  1.60134832  7.55457766 18.03580047 35.89515975 61.11853384]
E1 = -3.8661754984936656  E_coul = 1.0285319885405122
cycle= 34 E= -2.83764350995315  delta_E= 2.14e-06  |g|= 5.45e-05  |ddm|= 14.2
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455622693477  LUMO = 1.60134779534978
  mo_energy =
[-0.90455623  1.6013478   7.55457384 18.03580553 35.89518667 61.11868311]
E1 = -3.8661755075063167  E_coul = 1.0285328010141397
cycle= 35 E= -2.83764270649218  delta_E= 8.03e-07  |g|= 0.00011  |ddm|= 0.588
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555998318526  LUMO = 1.6013524087557
  mo_energy =
[-0.904556    1.60135241  7.55459758 18.03588471 35.89531103 61.11893756]
E1 = -3.86617507905493  E_coul = 1.0285329874856686
cycle= 36 E= -2.83764209156926  delta_E= 6.15e-07  |g|= 0.000151  |ddm|= 5.94
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555794427199  LUMO = 1.60135661197643
  mo_energy =
[-0.90455579  1.60135661  7.55461904 18.03595668 35.89542318 61.11917238]
E1 = -3.8661746842669604  E_coul = 1.0285331584686042
cycle= 37 E= -2.83764152579836  delta_E= 5.66e-07  |g|= 0.000179  |ddm|= 5.45
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555296150611  LUMO = 1.60136665066396
  mo_energy =
[-0.9045553   1.60136665  7.55467077 18.03612885 35.89569213 61.11972267]
E1 = -3.8661737514585437  E_coul = 1.028529954438738
cycle= 38 E= -2.83764379701981  delta_E= -2.27e-06  |g|= 7.32e-05  |ddm|= 12.9
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555127173955  LUMO = 1.60136970917384
  mo_energy =
[-0.90455513  1.60136971  7.5546853  18.03619287 35.89580789 61.12005512]
E1 = -3.8661734288765492  E_coul = 1.0285298044736584
cycle= 39 E= -2.83764362440289  delta_E= 1.73e-07  |g|= 6.39e-05  |ddm|= 5.07
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555129881519  LUMO = 1.60136956649406
  mo_energy =
[-0.90455513  1.60136957  7.55468469 18.03618701 35.89579465 61.12000778]
E1 = -3.866173451350386  E_coul = 1.0285297417784753
cycle= 40 E= -2.83764370957191  delta_E= -8.52e-08  |g|= 7.6e-05  |ddm|= 0.459
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555159452648  LUMO = 1.60136918763984
  mo_energy =
[-0.90455516  1.60136919  7.55468295 18.03618028 35.8957832  61.11996981]
E1 = -3.8661734886716723  E_coul = 1.028530265474821
cycle= 41 E= -2.83764322319685  delta_E= 4.86e-07  |g|= 3.16e-05  |ddm|= 0.556
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455487989736  LUMO = 1.60137460858786
  mo_energy =
[-0.90455488  1.60137461  7.55471054 18.03627482 35.89593399 61.12030346]
E1 = -3.8661729787881165  E_coul = 1.0285320046523703
cycle= 42 E= -2.83764097413575  delta_E= 2.25e-06  |g|= 0.000141  |ddm|= 7.16
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554742149046  LUMO = 1.60137806805518
  mo_energy =
[-0.90455474  1.60137807  7.55472976 18.03631891 35.89598217 61.12029168]
E1 = -3.8661727006078648  E_coul = 1.0285281162029536
cycle= 43 E= -2.83764458440491  delta_E= -3.61e-06  |g|= 0.000189  |ddm|= 3.04
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9045541607621  LUMO = 1.60138916422963
  mo_energy =
[-0.90455416  1.60138916  7.55478463 18.03651505 35.89629816 61.12105132]
E1 = -3.8661716220726876  E_coul = 1.028528688745536
cycle= 44 E= -2.83764293332715  delta_E= 1.65e-06  |g|= 9.4e-05  |ddm|= 15.3
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554777452092  LUMO = 1.6013765128413
  mo_energy =
[-0.90455478  1.60137651  7.55471831 18.03629983 35.89596872 61.12043972]
E1 = -3.866172774944736  E_coul = 1.0285312297142426
cycle= 45 E= -2.83764154523049  delta_E= 1.39e-06  |g|= 8.96e-05  |ddm|= 15.7
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556175495618  LUMO = 1.60134870558905
  mo_energy =
[-0.90455618  1.60134871  7.55457281 18.03584173 35.89528009 61.1191583 ]
E1 = -3.8661752850836977  E_coul = 1.028531744070364
cycle= 46 E= -2.83764354101333  delta_E= -2e-06  |g|= 2.25e-05  |ddm|= 33.7
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555929342007  LUMO = 1.60135602243127
  mo_energy =
[-0.90455593  1.60135602  7.55461375 18.03596709 35.89546611 61.11944423]
E1 = -3.8661746331968967  E_coul = 1.0285318082727486
cycle= 47 E= -2.83764282492415  delta_E= 7.16e-07  |g|= 5.11e-05  |ddm|=  8.6
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555646750791  LUMO = 1.60136207939534
  mo_energy =
[-0.90455565  1.60136208  7.55464696 18.03605592 35.8955862  61.11958474]
E1 = -3.8661741296436523  E_coul = 1.0285291338365288
cycle= 48 E= -2.83764499580712  delta_E= -2.17e-06  |g|= 0.000168  |ddm|= 6.19
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556005936476  LUMO = 1.60135525394147
  mo_energy =
[-0.90455601  1.60135525  7.55461261 18.03593551 35.8953936  61.11915602]
E1 = -3.866174780331568  E_coul = 1.0285320549109618
cycle= 49 E= -2.83764272542061  delta_E= 2.27e-06  |g|= 7.24e-05  |ddm|= 9.21
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555785361225  LUMO = 1.60135958764934
  mo_energy =
[-0.90455579  1.60135959  7.55463479 18.03600668 35.89549883 61.11935166]
E1 = -3.8661743800642148  E_coul = 1.0285319030671334
cycle= 50 E= -2.83764247699708  delta_E= 2.48e-07  |g|= 8.7e-05  |ddm|= 5.37
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8661743800642148  E_coul = 1.0285319030671334

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904555287010567  LUMO = 1.60137500848551
  mo_energy =
[-0.90455529  1.60137501  7.55471184 18.03629914 35.89599172 61.12052435]
E1 = -3.8661727706165903  E_coul = 1.0285290817162875
Extra cycle  E= -2.8376436889003  delta_E= -1.21e-06  |g|= 0.000127  |ddm|=   23
    CPU time for scf_cycle      0.50 sec, wall time      0.50 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 981582382.5792105

WARN: Singularity detected in overlap matrix (condition number = 9.82e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8661727706165903  E_coul = 1.0285290817162875
init E= -2.8376436889003
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.904557303685409  LUMO = 1.60135453599225
  mo_energy =
[-0.9045573   1.60135454  7.55461822 18.03590316 35.8952944  61.1185721 ]
E1 = -3.866174685665068  E_coul = 1.028530732845105
cycle= 1 E= -2.83764395281996  delta_E= -2.64e-07  |g|= 3.3e-05  |ddm|= 30.8
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904556609999507  LUMO = 1.60135049470709
  mo_energy =
[-0.90455661  1.60135049  7.55459429 18.03580113 35.89509866 61.11809795]
E1 = -3.8661753133948227  E_coul = 1.0285295085773636
cycle= 2 E= -2.83764580481746  delta_E= -1.85e-06  |g|= 0.000164  |ddm|= 8.63
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904558786099103  LUMO = 1.60129919215421
  mo_energy =
[-0.90455879  1.60129919  7.55432987 18.0349451  35.89380226 61.11547584]
E1 = -3.866180157650295  E_coul = 1.0285342460581268
cycle= 3 E= -2.83764591159217  delta_E= -1.07e-07  |g|= 4.7e-05  |ddm|= 65.2
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558000834038  LUMO = 1.60133191701485
  mo_energy =
[-0.904558    1.60133192  7.55450011 18.03550309 35.8946522  61.11719448]
E1 = -3.8661768963751557  E_coul = 1.0285337702297457
cycle= 4 E= -2.83764312614541  delta_E= 2.79e-06  |g|= 0.000171  |ddm|= 43.2
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455782735863  LUMO = 1.60133572990271
  mo_energy =
[-0.90455783  1.60133573  7.55451914 18.0355755  35.89477479 61.11749272]
E1 = -3.8661765129545573  E_coul = 1.0285291233642353
cycle= 5 E= -2.83764738959032  delta_E= -4.26e-06  |g|= 0.000253  |ddm|=  5.6
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558172285377  LUMO = 1.60132991722614
  mo_energy =
[-0.90455817  1.60132992  7.55448955 18.03547376 35.89461219 61.117146  ]
E1 = -3.866177046740365  E_coul = 1.0285329082004842
cycle= 6 E= -2.83764413853988  delta_E= 3.25e-06  |g|= 7.1e-05  |ddm|= 7.58
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558200968278  LUMO = 1.60132908896597
  mo_energy =
[-0.9045582   1.60132909  7.55448531 18.03545937 35.8945899  61.11710037]
E1 = -3.866177128327969  E_coul = 1.0285349667285095
cycle= 7 E= -2.83764216159946  delta_E= 1.98e-06  |g|= 0.000261  |ddm|= 1.11
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558295923026  LUMO = 1.60132708163323
  mo_energy =
[-0.9045583   1.60132708  7.55447511 18.03542379 35.89453295 61.11697469]
E1 = -3.8661773213320623  E_coul = 1.028533698557875
cycle= 8 E= -2.83764362277419  delta_E= -1.46e-06  |g|= 0.000128  |ddm|= 2.71
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558334590148  LUMO = 1.60132602556673
  mo_energy =
[-0.90455833  1.60132603  7.55446958 18.03540736 35.8945098  61.11693437]
E1 = -3.8661774197968426  E_coul = 1.0285330150669825
cycle= 9 E= -2.83764440472986  delta_E= -7.82e-07  |g|= 7.3e-05  |ddm|= 1.26
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558591583336  LUMO = 1.60131579974204
  mo_energy =
[-0.90455859  1.6013158   7.55441564 18.0352397  35.89426375 61.11648664]
E1 = -3.866178408447854  E_coul = 1.0285343953493162
cycle= 10 E= -2.83764401309854  delta_E= 3.92e-07  |g|= 0.00015  |ddm|= 12.8
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558775473035  LUMO = 1.60133962826294
  mo_energy =
[-0.90455878  1.60133963  7.55453583 18.0356975  35.89502337 61.11840787]
E1 = -3.866175637945485  E_coul = 1.0285304941608697
cycle= 11 E= -2.83764514378462  delta_E= -1.13e-06  |g|= 9.95e-05  |ddm|=   38
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556364721202  LUMO = 1.60132774567136
  mo_energy =
[-0.90455636  1.60132775  7.55446609 18.03546747 35.89468514 61.11786796]
E1 = -3.866177524370003  E_coul = 1.0285347994441554
cycle= 12 E= -2.83764272492585  delta_E= 2.42e-06  |g|= 0.000201  |ddm|= 21.2
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554354198198  LUMO = 1.60136360389455
  mo_energy =
[-0.90455435  1.6013636   7.55465007 18.0360629  35.89559079 61.11963046]
E1 = -3.8661742851633214  E_coul = 1.028529010534231
cycle= 13 E= -2.83764527462909  delta_E= -2.55e-06  |g|= 0.000189  |ddm|= 44.6
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455615626047  LUMO = 1.60134493949773
  mo_energy =
[-0.90455616  1.60134494  7.55456042 18.03574169 35.89507037 61.118319  ]
E1 = -3.86617589563372  E_coul = 1.0285325272982908
cycle= 14 E= -2.83764336833543  delta_E= 1.91e-06  |g|= 7.73e-05  |ddm|= 24.3
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555972476899  LUMO = 1.6013485981284
  mo_energy =
[-0.90455597  1.6013486   7.55457913 18.03580643 35.89517341 61.11854845]
E1 = -3.866175548963335  E_coul = 1.0285311885192236
cycle= 15 E= -2.83764436044411  delta_E= -9.92e-07  |g|= 3.07e-05  |ddm|= 4.88
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455618238926  LUMO = 1.60134498284209
  mo_energy =
[-0.90455618  1.60134498  7.55456056 18.03574523 35.89507874 61.11835512]
E1 = -3.866175875823917  E_coul = 1.0285321715416733
cycle= 16 E= -2.83764370428224  delta_E= 6.56e-07  |g|= 4.02e-05  |ddm|= 4.54
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556152184256  LUMO = 1.60134559452194
  mo_energy =
[-0.90455615  1.60134559  7.55456332 18.03575666 35.89509872 61.11841612]
E1 = -3.8661758099852586  E_coul = 1.0285308326576186
cycle= 17 E= -2.83764497732764  delta_E= -1.27e-06  |g|= 7.61e-05  |ddm|= 0.98
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556266929891  LUMO = 1.60134350506774
  mo_energy =
[-0.90455627  1.60134351  7.55455211 18.03572095 35.89504316 61.11832645]
E1 = -3.8661759907447992  E_coul = 1.0285307720858403
cycle= 18 E= -2.83764521865896  delta_E= -2.41e-07  |g|= 8e-05  |ddm|= 2.48
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455645717847  LUMO = 1.60134054176862
  mo_energy =
[-0.90455646  1.60134054  7.55453642 18.03567402 35.8949749  61.11822284]
E1 = -3.8661762378073505  E_coul = 1.028533748918631
cycle= 19 E= -2.83764248888872  delta_E= 2.73e-06  |g|= 0.00017  |ddm|= 3.29
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555791129668  LUMO = 1.60134987131795
  mo_energy =
[-0.90455579  1.60134987  7.55458216 18.0358404  35.89524769 61.11888946]
E1 = -3.866175372555863  E_coul = 1.02853236059216
cycle= 20 E= -2.8376430119637  delta_E= -5.23e-07  |g|= 7.39e-05  |ddm|= 12.7
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555890016835  LUMO = 1.60134987157768
  mo_energy =
[-0.90455589  1.60134987  7.55458226 18.03584173 35.89524996 61.11890377]
E1 = -3.8661753418539595  E_coul = 1.0285331376002569
cycle= 21 E= -2.8376422042537  delta_E= 8.08e-07  |g|= 0.000158  |ddm|= 0.285
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555773237111  LUMO = 1.60135192605277
  mo_energy =
[-0.90455577  1.60135193  7.55459216 18.0358814  35.89531847 61.1190863 ]
E1 = -3.8661751341949553  E_coul = 1.0285317734780692
cycle= 22 E= -2.83764336071689  delta_E= -1.16e-06  |g|= 2.95e-05  |ddm|= 3.13
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555832305578  LUMO = 1.60135068474896
  mo_energy =
[-0.90455583  1.60135068  7.55458518 18.03586228 35.89529283 61.11906556]
E1 = -3.866175235199453  E_coul = 1.0285297283957833
cycle= 23 E= -2.83764550680367  delta_E= -2.15e-06  |g|= 0.00016  |ddm|= 1.25
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555937573952  LUMO = 1.60134882666742
  mo_energy =
[-0.90455594  1.60134883  7.55457553 18.03583084 35.89524397 61.11897044]
E1 = -3.866175401889687  E_coul = 1.0285293811567076
cycle= 24 E= -2.83764602073298  delta_E= -5.14e-07  |g|= 0.000211  |ddm|=  2.3
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556181309347  LUMO = 1.60134437607594
  mo_energy =
[-0.90455618  1.60134438  7.55455286 18.03575455 35.89512434 61.11872114]
E1 = -3.866175813938142  E_coul = 1.0285335984024346
cycle= 25 E= -2.83764221553571  delta_E= 3.81e-06  |g|= 0.000161  |ddm|= 5.73
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555684125008  LUMO = 1.60135424441974
  mo_energy =
[-0.90455568  1.60135424  7.55460398 18.0359213  35.89538175 61.11922358]
E1 = -3.8661749088637256  E_coul = 1.0285301806077534
cycle= 26 E= -2.83764472825597  delta_E= -2.51e-06  |g|= 0.000102  |ddm|= 12.4
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555198861913  LUMO = 1.60136416934277
  mo_energy =
[-0.9045552   1.60136417  7.5546555  18.03608572 35.89563036 61.11969387]
E1 = -3.866174001089962  E_coul = 1.0285327660827193
cycle= 27 E= -2.83764123500724  delta_E= 3.49e-06  |g|= 0.000171  |ddm|= 12.2
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556437921592  LUMO = 1.60134049033869
  mo_energy =
[-0.90455644  1.60134049  7.55453605 18.03566718 35.89495969 61.11819993]
E1 = -3.866176257570091  E_coul = 1.0285331903935546
cycle= 28 E= -2.83764306717654  delta_E= -1.83e-06  |g|= 0.000118  |ddm|= 31.9
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555965923931  LUMO = 1.60134940656143
  mo_energy =
[-0.90455597  1.60134941  7.5545815  18.03582418 35.89521027 61.11872905]
E1 = -3.866175420618566  E_coul = 1.0285328180103954
cycle= 29 E= -2.83764260260817  delta_E= 4.65e-07  |g|= 0.000121  |ddm|= 11.8
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556039220554  LUMO = 1.60134790181921
  mo_energy =
[-0.90455604  1.6013479   7.55457389 18.03579385 35.89515744 61.11859876]
E1 = -3.8661755708659715  E_coul = 1.028532277528361
cycle= 30 E= -2.83764329333761  delta_E= -6.91e-07  |g|= 6.5e-05  |ddm|= 2.27
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555966641798  LUMO = 1.60134944835667
  mo_energy =
[-0.90455597  1.60134945  7.55458203 18.03582068 35.89519926 61.11868167]
E1 = -3.8661754297197617  E_coul = 1.028532255194071
cycle= 31 E= -2.83764317452569  delta_E= 1.19e-07  |g|= 7.61e-05  |ddm|= 1.94
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555656401921  LUMO = 1.60135518669454
  mo_energy =
[-0.90455566  1.60135519  7.55461118 18.0359205  35.89535821 61.1190329 ]
E1 = -3.8661748922524066  E_coul = 1.0285321138427226
cycle= 32 E= -2.83764277840968  delta_E= 3.96e-07  |g|= 7.06e-05  |ddm|= 7.55
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555220412141  LUMO = 1.6013633161917
  mo_energy =
[-0.90455522  1.60136332  7.55465226 18.03606455 35.8955899  61.1195475 ]
E1 = -3.8661741217575685  E_coul = 1.028531757246095
cycle= 33 E= -2.83764236451147  delta_E= 4.14e-07  |g|= 7.83e-05  |ddm|= 10.9
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555493204352  LUMO = 1.60135767840297
  mo_energy =
[-0.90455549  1.60135768  7.55462264 18.03597055 35.8954475  61.11929088]
E1 = -3.866174632133315  E_coul = 1.0285332408486754
cycle= 34 E= -2.83764139128464  delta_E= 9.73e-07  |g|= 0.000188  |ddm|= 6.89
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555228753195  LUMO = 1.60136284137507
  mo_energy =
[-0.90455523  1.60136284  7.55464946 18.0360578  35.89558174 61.11954546]
E1 = -3.866174161864472  E_coul = 1.0285324263913354
cycle= 35 E= -2.83764173547314  delta_E= -3.44e-07  |g|= 0.000138  |ddm|= 6.42
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555198124024  LUMO = 1.60136357531092
  mo_energy =
[-0.9045552   1.60136358  7.5546532  18.03607004 35.89559986 61.11957896]
E1 = -3.8661740921093135  E_coul = 1.0285311222195408
cycle= 36 E= -2.83764296988977  delta_E= -1.23e-06  |g|= 1.82e-05  |ddm|= 0.932
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455526881922  LUMO = 1.60136222136838
  mo_energy =
[-0.90455527  1.60136222  7.55464521 18.03604914 35.89557143 61.11958276]
E1 = -3.8661741925626307  E_coul = 1.028529166528671
cycle= 37 E= -2.83764502603396  delta_E= -2.06e-06  |g|= 0.000166  |ddm|= 1.23
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555278577324  LUMO = 1.60136259419748
  mo_energy =
[-0.90455528  1.60136259  7.55464868 18.03605376 35.89557403 61.119526  ]
E1 = -3.866174185132223  E_coul = 1.0285295055350612
cycle= 38 E= -2.83764467959716  delta_E= 3.46e-07  |g|= 0.000135  |ddm|= 0.128
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554829295295  LUMO = 1.60137059564585
  mo_energy =
[-0.90455483  1.6013706   7.55468757 18.03619442 35.89580185 61.12009307]
E1 = -3.8661733988426636  E_coul = 1.0285287703873787
cycle= 39 E= -2.83764462845529  delta_E= 5.11e-08  |g|= 0.000172  |ddm|= 11.2
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553044448999  LUMO = 1.60140724197736
  mo_energy =
[-0.90455304  1.60140724  7.55487752 18.03680522 35.89672638 61.12188462]
E1 = -3.866170033212745  E_coul = 1.0285283666760232
cycle= 40 E= -2.83764166653672  delta_E= 2.96e-06  |g|= 4.3e-05  |ddm|= 45.5
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555729335022  LUMO = 1.6013550739541
  mo_energy =
[-0.90455573  1.60135507  7.55461339 18.03590533 35.89531031 61.11876304]
E1 = -3.866174964258361  E_coul = 1.0285289931728097
cycle= 41 E= -2.83764597108555  delta_E= -4.3e-06  |g|= 0.000217  |ddm|= 68.7
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556580138769  LUMO = 1.6013390083308
  mo_energy =
[-0.90455658  1.60133901  7.55453268 18.0356165  35.89484047 61.11768869]
E1 = -3.8661765054194217  E_coul = 1.0285343844179105
cycle= 42 E= -2.83764212100151  delta_E= 3.85e-06  |g|= 0.000228  |ddm|= 22.1
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556139749472  LUMO = 1.60134604202681
  mo_energy =
[-0.90455614  1.60134604  7.55456585 18.03574503 35.89505636 61.11829049]
E1 = -3.866175796419982  E_coul = 1.0285324984331632
cycle= 43 E= -2.83764329798682  delta_E= -1.18e-06  |g|= 7.58e-05  |ddm|= 10.5
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556197140367  LUMO = 1.60134493985393
  mo_energy =
[-0.9045562   1.60134494  7.55456058 18.03572307 35.89501734 61.11817248]
E1 = -3.866175911902163  E_coul = 1.0285305210787885
cycle= 44 E= -2.83764539082337  delta_E= -2.09e-06  |g|= 0.000108  |ddm|= 1.78
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556533483669  LUMO = 1.60133811316248
  mo_energy =
[-0.90455653  1.60133811  7.55452578 18.03560714 35.8948373  61.11777708]
E1 = -3.8661765535502464  E_coul = 1.0285314911021501
cycle= 45 E= -2.8376450624481  delta_E= 3.28e-07  |g|= 3.86e-05  |ddm|= 8.85
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556496467113  LUMO = 1.60133802142708
  mo_energy =
[-0.9045565   1.60133802  7.55452365 18.03561561 35.89486629 61.11793255]
E1 = -3.8661765255518517  E_coul = 1.0285353325210744
cycle= 46 E= -2.83764119303078  delta_E= 3.87e-06  |g|= 0.00031  |ddm|= 0.993
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555818732571  LUMO = 1.60135105352867
  mo_energy =
[-0.90455582  1.60135105  7.55458985 18.03584738 35.89523946 61.11876284]
E1 = -3.866175290056671  E_coul = 1.0285311028210595
cycle= 47 E= -2.83764418723561  delta_E= -2.99e-06  |g|= 5.09e-05  |ddm|= 17.5
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455578166427  LUMO = 1.60135212727688
  mo_energy =
[-0.90455578  1.60135213  7.55459605 18.03585794 35.89524451 61.11871924]
E1 = -3.86617521111519  E_coul = 1.028530872963837
cycle= 48 E= -2.83764433815135  delta_E= -1.51e-07  |g|= 5.74e-05  |ddm|= 0.675
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555706014582  LUMO = 1.60135352566592
  mo_energy =
[-0.90455571  1.60135353  7.55460296 18.03588353 35.89528692 61.11882404]
E1 = -3.8661750739512204  E_coul = 1.0285316589958855
cycle= 49 E= -2.83764341495533  delta_E= 9.23e-07  |g|= 2.49e-05  |ddm|= 1.99
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555505427051  LUMO = 1.60135728536982
  mo_energy =
[-0.90455551  1.60135729  7.55462183 18.03595023 35.89539474 61.11907346]
E1 = -3.8661747143602936  E_coul = 1.0285314485760917
cycle= 50 E= -2.8376432657842  delta_E= 1.49e-07  |g|= 2.58e-05  |ddm|= 5.12
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8661747143602936  E_coul = 1.0285314485760917

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904555908612278  LUMO = 1.60136113301659
  mo_energy =
[-0.90455591  1.60136113  7.55464342 18.03603749 35.89554896 61.11940295]
E1 = -3.866174180249907  E_coul = 1.0285302971833366
Extra cycle  E= -2.83764388306657  delta_E= -6.17e-07  |g|= 5.84e-05  |ddm|= 7.14
    CPU time for scf_cycle      0.53 sec, wall time      0.53 sec
exp = [6.3215082  5.57366251 4.90667421 4.21430023 3.8112234  0.37756213]
grad_E = [-3.51124374e-04 -1.80687755e-04 -4.45572735e-05  2.10959250e-04
  4.69630784e-04 -2.05806804e-04]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:57 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  8901.80448983        1
[INPUT] 0    0    [1    /1   ]  7841.9872086         1
[INPUT] 0    0    [1    /1   ]  6898.44750759        1
[INPUT] 0    0    [1    /1   ]  5598.5979592         1
[INPUT] 0    0    [1    /1   ]  5097.32978268        1
[INPUT] 0    0    [1    /1   ]  136.774006987        1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [8901.804489833077, 1.0]], [0, [7841.987208599888, 1.0]], [0, [6898.447507594071, 1.0]], [0, [5598.597959200314, 1.0]], [0, [5097.329782678619, 1.0]], [0, [136.77400698738646, 1.0]]]}
ecp = {}
CPU time:        54.51
Set gradient conv threshold to 3.16228e-05
cond(S) = 315116923.58034295

WARN: Singularity detected in overlap matrix (condition number = 3.15e+08). SCF may be inaccurate and hard to converge.

E1 = 17.095496830248123  E_coul = 0.002031273776702471
init E= 17.0975281040248
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = 167.211720556718  LUMO = 3039.72246377913
  mo_energy =
[  167.21172056  3039.72246378 11766.51990497 27343.20744
 51983.53309965 91427.85680021]
E1 = 334.0807521150986  E_coul = 13.090079660783939
cycle= 1 E= 347.170831775883  delta_E=  330  |g|= 3.33  |ddm|= 2.15e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = 180.129660521947  LUMO = 3071.73667926537
  mo_energy =
[  180.12966052  3071.73667927 11800.57913644 27377.8391389
 52018.57664008 91463.37300411]
E1 = 334.082433479447  E_coul = 13.086801976039233
cycle= 2 E= 347.169235455486  delta_E= -0.0016  |g|= 0.0116  |ddm|= 62.8
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = 180.128009765635  LUMO = 3071.72876853378
  mo_energy =
[  180.12800977  3071.72876853 11800.56448268 27377.82303471
 52018.55926126 91463.35380495]
E1 = 334.08244572566167  E_coul = 13.086789708847293
cycle= 3 E= 347.169235434509  delta_E= -2.1e-08  |g|= 1.8e-05  |ddm|= 0.18
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = 180.128012581404  LUMO = 3071.72878036989
  mo_energy =
[  180.12801258  3071.72878037 11800.56449773 27377.82304223
 52018.55925857 91463.35379899]
E1 = 334.08244570672224  E_coul = 13.086789726649991
cycle= 4 E= 347.169235433372  delta_E= -1.14e-09  |g|= 6.28e-07  |ddm|= 0.000316
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 180.128012582301  LUMO = 3071.72878381652
  mo_energy =
[  180.12801258  3071.72878382 11800.56451233 27377.82307641
 52018.5593203  91463.3538946 ]
E1 = 334.08244570606405  E_coul = 13.08678972491924
cycle= 5 E= 347.169235430983  delta_E= -2.39e-09  |g|= 1.52e-06  |ddm|= 1.4e-05
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 180.128012580491  LUMO = 3071.7287815022
  mo_energy =
[  180.12801258  3071.7287815  11800.56450255 27377.82305365
 52018.55927936 91463.35382982]
E1 = 334.0824457068959  E_coul = 13.086789723341594
cycle= 6 E= 347.169235430238  delta_E= -7.46e-10  |g|= 1.77e-06  |ddm|= 9.47e-06
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
E1 = 334.0824457068959  E_coul = 13.086789723341594
  HOMO = 180.128012576185  LUMO = 3071.72877597419
  mo_energy =
[  180.12801258  3071.72877597 11800.56447883 27377.8229965
 52018.55917151 91463.35365198]
E1 = 334.082445707752  E_coul = 13.086789724643086
Extra cycle  E= 347.169235432395  delta_E= 2.16e-09  |g|= 1.53e-06  |ddm|= 2.35e-05
    CPU time for scf_cycle      0.09 sec, wall time      0.09 sec
exp = [8901.80448983 7841.9872086  6898.44750759 5598.5979592  5097.32978268
  136.77400699]
E = 347.1692354323951
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:57 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  895.869806362        1
[INPUT] 0    0    [1    /1   ]  789.21501712         1
[INPUT] 0    0    [1    /1   ]  694.260757546        1
[INPUT] 0    0    [1    /1   ]  563.652666124        1
[INPUT] 0    0    [1    /1   ]  513.163079329        1
[INPUT] 0    0    [1    /1   ]  14.0172066182        1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [895.8698063622064, 1.0]], [0, [789.2150171203899, 1.0]], [0, [694.2607575462142, 1.0]], [0, [563.6526661240413, 1.0]], [0, [513.1630793290824, 1.0]], [0, [14.0172066181519, 1.0]]]}
ecp = {}
CPU time:        54.86
Set gradient conv threshold to 3.16228e-05
cond(S) = 317135042.86273396

WARN: Singularity detected in overlap matrix (condition number = 3.17e+08). SCF may be inaccurate and hard to converge.

E1 = 15.47573983088021  E_coul = 0.13527534038512312
init E= 15.6110151712653
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = 9.83379726987899  LUMO = 283.312506199011
  mo_energy =
[   9.83379727  283.3125062  1154.15260704 2713.24861811 5190.83184793
 9127.73039111]
E1 = 18.105764550794333  E_coul = 4.223469576842383
cycle= 1 E= 22.3292341276367  delta_E= 6.72  |g|= 0.726  |ddm|= 2.1e+05
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = 13.2759326709556  LUMO = 291.972986138127
  mo_energy =
[  13.27593267  291.97298614 1163.48246746 2722.76270615 5200.47854853
 9137.53008689]
E1 = 18.107583225023742  E_coul = 4.220802365977118
cycle= 2 E= 22.3283855910009  delta_E= -0.000849  |g|= 0.00848  |ddm|= 52.4
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = 13.27457161615  LUMO = 291.966767873148
  mo_energy =
[  13.27457162  291.96676787 1163.47080397 2722.74984422 5200.46460333
 9137.514579  ]
E1 = 18.107615726173126  E_coul = 4.220769735113623
cycle= 3 E= 22.3283854612868  delta_E= -1.3e-07  |g|= 3.37e-05  |ddm|= 0.539
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = 13.2745776790779  LUMO = 291.966795413432
  mo_energy =
[  13.27457768  291.96679541 1163.47084986 2722.74989385 5200.46465413
 9137.51462884]
E1 = 18.107615599734743  E_coul = 4.22076986148827
cycle= 4 E= 22.328385461223  delta_E= -6.37e-11  |g|= 1.33e-07  |ddm|= 0.00253
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = 18.107615599734743  E_coul = 4.22076986148827
  HOMO = 13.2745776613404  LUMO = 291.966794807352
  mo_energy =
[  13.27457766  291.96679481 1163.47084738 2722.74988778 5200.46464249
 9137.5146087 ]
E1 = 18.107615600116546  E_coul = 4.220769861122042
Extra cycle  E= 22.3283854612386  delta_E= 1.56e-11  |g|= 7.55e-08  |ddm|= 1.14e-05
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [895.86980636 789.21501712 694.26075755 563.65266612 513.16307933
  14.01720662]
E = 22.32838546123859
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:58 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  95.2763380151        1
[INPUT] 0    0    [1    /1   ]  83.9377979724        1
[INPUT] 0    0    [1    /1   ]  73.8420825414        1
[INPUT] 0    0    [1    /1   ]  60.1581368164        1
[INPUT] 0    0    [1    /1   ]  54.7464089941        1
[INPUT] 0    0    [1    /1   ]  1.74152658123        1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [95.27633801511939, 1.0]], [0, [83.93779797244015, 1.0]], [0, [73.8420825414284, 1.0]], [0, [60.158136816413986, 1.0]], [0, [54.74640899412866, 1.0]], [0, [1.741526581228444, 1.0]]]}
ecp = {}
CPU time:        55.20
Set gradient conv threshold to 3.16228e-05
cond(S) = 336822699.6388478

WARN: Singularity detected in overlap matrix (condition number = 3.37e+08). SCF may be inaccurate and hard to converge.

E1 = -1.9653367954175363  E_coul = 0.9243536038508371
init E= -1.0409831915667
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.535923593341207  LUMO = 25.3687888925661
  mo_energy =
[-5.35923593e-01  2.53687889e+01  1.15978294e+02  2.79289861e+02
  5.42447938e+02  9.51265250e+02]
E1 = -3.4699502392063284  E_coul = 1.5427975055135614
cycle= 1 E= -1.92715273369277  delta_E= -0.886  |g|= 0.0469  |ddm|= 8.9e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.192183460566768  LUMO = 26.2536336819626
  mo_energy =
[-1.92183461e-01  2.62536337e+01  1.17011795e+02  2.80366971e+02
  5.43560596e+02  9.52425546e+02]
E1 = -3.469650446503655  E_coul = 1.542485669394777
cycle= 2 E= -1.92716477710888  delta_E= -1.2e-05  |g|= 0.000983  |ddm|= 28.7
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.192344358973886  LUMO = 26.2530756359327
  mo_energy =
[-1.92344359e-01  2.62530756e+01  1.17010493e+02  2.80365498e+02
  5.43558922e+02  9.52423523e+02]
E1 = -3.469635916103672  E_coul = 1.5424711287460138
cycle= 3 E= -1.92716478735766  delta_E= -1.02e-08  |g|= 9.38e-06  |ddm|= 1.03
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.19234707626003  LUMO = 26.2530669781706
  mo_energy =
[-1.92347076e-01  2.62530670e+01  1.17010482e+02  2.80365498e+02
  5.43558936e+02  9.52423566e+02]
E1 = -3.4696357397842568  E_coul = 1.5424709516429445
cycle= 4 E= -1.92716478814131  delta_E= -7.84e-10  |g|= 9.4e-07  |ddm|= 0.0337
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = -3.4696357397842568  E_coul = 1.5424709516429445
  HOMO = -0.192346918222965  LUMO = 26.2530670830546
  mo_energy =
[-1.92346918e-01  2.62530671e+01  1.17010481e+02  2.80365491e+02
  5.43558921e+02  9.52423533e+02]
E1 = -3.4696357506352653  E_coul = 1.542470961132575
Extra cycle  E= -1.92716478950269  delta_E= -1.36e-09  |g|= 4.9e-07  |ddm|= 0.00268
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [95.27633802 83.93779797 73.84208254 60.15813682 54.74640899  1.74152658]
E = -1.9271647895026902
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:58 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  15.2169911804        1
[INPUT] 0    0    [1    /1   ]  13.4100760576        1
[INPUT] 0    0    [1    /1   ]  11.8002150409        1
[INPUT] 0    0    [1    /1   ]  9.80868388565        1
[INPUT] 0    0    [1    /1   ]  8.90474196063        1
[INPUT] 0    0    [1    /1   ]  0.513958577536       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [15.216991180410668, 1.0]], [0, [13.41007605764516, 1.0]], [0, [11.800215040949821, 1.0]], [0, [9.808683885651245, 1.0]], [0, [8.904741960633288, 1.0]], [0, [0.5139585775360982, 1.0]]]}
ecp = {}
CPU time:        55.55
Set gradient conv threshold to 3.16228e-05
cond(S) = 489448495.79065895

WARN: Singularity detected in overlap matrix (condition number = 4.89e+08). SCF may be inaccurate and hard to converge.

E1 = -3.785566130691802  E_coul = 1.0226504173394746
init E= -2.76291571335233
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.888460460435023  LUMO = 3.47445451097474
  mo_energy =
[ -0.88846046   3.47445451  17.64366222  43.10513821  85.39718356
 147.86042656]
E1 = -3.826389366315545  E_coul = 1.0263441263662416
cycle= 1 E= -2.8000452399493  delta_E= -0.0371  |g|= 0.0267  |ddm|= 1.09e+05
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.886864390645489  LUMO = 3.48092784002235
  mo_energy =
[ -0.88686439   3.48092784  17.64319672  43.10190931  85.39152542
 147.85022215]
E1 = -3.824667695254586  E_coul = 1.0245931101406587
cycle= 2 E= -2.80007458511393  delta_E= -2.93e-05  |g|= 0.00112  |ddm|= 2.47e+03
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.887778469760472  LUMO = 3.47958858646947
  mo_energy =
[ -0.88777847   3.47958859  17.64039773  43.09855607  85.38765761
 147.84543723]
E1 = -3.824561295054824  E_coul = 1.0244867817949561
cycle= 3 E= -2.80007451325987  delta_E= 7.19e-08  |g|= 2.71e-05  |ddm|= 99.6
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.887795343168304  LUMO = 3.47956935678622
  mo_energy =
[ -0.88779534   3.47956936  17.64037077  43.09856767  85.38770735
 147.84559367]
E1 = -3.8245587627371345  E_coul = 1.0244841231541024
cycle= 4 E= -2.80007463958303  delta_E= -1.26e-07  |g|= 1.11e-05  |ddm|= 2.07
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.887795249010432  LUMO = 3.47956583121973
  mo_energy =
[ -0.88779525   3.47956583  17.64035102  43.09851746  85.38763352
 147.84547471]
E1 = -3.8245589987754047  E_coul = 1.0244844520995222
cycle= 5 E= -2.80007454667588  delta_E= 9.29e-08  |g|= 7.93e-06  |ddm|= 0.721
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795145569431  LUMO = 3.47956730115044
  mo_energy =
[ -0.88779515   3.4795673   17.64035875  43.09853668  85.38766036
 147.84548924]
E1 = -3.824558932173931  E_coul = 1.024484293105712
cycle= 6 E= -2.80007463906822  delta_E= -9.24e-08  |g|= 3.68e-06  |ddm|= 0.237
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795157778471  LUMO = 3.47956683867093
  mo_energy =
[ -0.88779516   3.47956684  17.64035587  43.09852974  85.3876515
 147.845502  ]
E1 = -3.8245589552288712  E_coul = 1.024484138222372
cycle= 7 E= -2.8000748170065  delta_E= -1.78e-07  |g|= 2.27e-05  |ddm|= 0.0723
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795204161329  LUMO = 3.47956542595752
  mo_energy =
[ -0.8877952    3.47956543  17.6403482   43.09850577  85.38760914
 147.8454142 ]
E1 = -3.8245590337578523  E_coul = 1.024484013479988
cycle= 8 E= -2.80007502027786  delta_E= -2.03e-07  |g|= 3.99e-05  |ddm|= 0.313
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795264424423  LUMO = 3.47956348158831
  mo_energy =
[ -0.88779526   3.47956348  17.64033765  43.09847276  85.38755074
 147.84529156]
E1 = -3.824559142170257  E_coul = 1.0244848019134698
cycle= 9 E= -2.80007434025679  delta_E= 6.8e-07  |g|= 4.03e-05  |ddm|= 0.43
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795183287542  LUMO = 3.4795654215963
  mo_energy =
[ -0.88779518   3.47956542  17.64034803  43.09850206  85.38759799
 147.8453739 ]
E1 = -3.8245590396992797  E_coul = 1.0244840792055356
cycle= 10 E= -2.80007496049374  delta_E= -6.2e-07  |g|= 3.73e-05  |ddm|= 0.382
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795217447718  LUMO = 3.47956426240455
  mo_energy =
[ -0.88779522   3.47956426  17.6403416   43.0984797   85.38755486
 147.84527431]
E1 = -3.82455910583992  E_coul = 1.024484720650088
cycle= 11 E= -2.80007438518983  delta_E= 5.75e-07  |g|= 3.04e-05  |ddm|= 0.281
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795180121584  LUMO = 3.47956435680014
  mo_energy =
[ -0.88779518   3.47956436  17.64034168  43.09847523  85.38754036
 147.84522739]
E1 = -3.8245591094730687  E_coul = 1.024484290396196
cycle= 12 E= -2.80007481907687  delta_E= -4.34e-07  |g|= 6.87e-06  |ddm|= 0.046
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795171225049  LUMO = 3.47956480894035
  mo_energy =
[ -0.88779517   3.47956481  17.64034439  43.0984869   85.38756566
 147.84528812]
E1 = -3.8245590820067403  E_coul = 1.0244844257642014
cycle= 13 E= -2.80007465624254  delta_E= 1.63e-07  |g|= 6.35e-06  |ddm|= 0.135
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795179750465  LUMO = 3.47956441450932
  mo_energy =
[ -0.88779518   3.47956441  17.64034217  43.098481    85.38755679
 147.84528078]
E1 = -3.824559103543749  E_coul = 1.0244843117787439
cycle= 14 E= -2.80007479176501  delta_E= -1.36e-07  |g|= 8.37e-06  |ddm|= 0.0752
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795188120197  LUMO = 3.47956394015824
  mo_energy =
[ -0.88779519   3.47956394  17.64033971  43.09847257  85.38754045
 147.84523142]
E1 = -3.824559132409909  E_coul = 1.0244847513730215
cycle= 15 E= -2.80007438103689  delta_E= 4.11e-07  |g|= 4.04e-05  |ddm|= 0.119
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795122460267  LUMO = 3.47956543043331
  mo_energy =
[ -0.88779512   3.47956543  17.64034767  43.09849765  85.38758488
 147.8453246 ]
E1 = -3.824559052389669  E_coul = 1.0244845496374797
cycle= 16 E= -2.80007450275219  delta_E= -1.22e-07  |g|= 2e-05  |ddm|= 0.324
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795056613743  LUMO = 3.47956720287274
  mo_energy =
[ -0.88779506   3.4795672   17.64035723  43.09852687  85.38763571
 147.84542826]
E1 = -3.8245589559783832  E_coul = 1.0244841856267726
cycle= 17 E= -2.80007477035161  delta_E= -2.68e-07  |g|= 1.85e-05  |ddm|= 0.379
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795122023049  LUMO = 3.47956570133185
  mo_energy =
[ -0.88779512   3.4795657   17.64034923  43.0985036   85.38759684
 147.84535367]
E1 = -3.8245590352070558  E_coul = 1.0244847835193898
cycle= 18 E= -2.80007425168767  delta_E= 5.19e-07  |g|= 4.72e-05  |ddm|= 0.303
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795033705462  LUMO = 3.47956807865747
  mo_energy =
[ -0.88779503   3.47956808  17.64036212  43.09854638  85.38767653
 147.84553545]
E1 = -3.8245589037140677  E_coul = 1.0244841621847924
cycle= 19 E= -2.80007474152928  delta_E= -4.9e-07  |g|= 2.08e-05  |ddm|= 0.547
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795090944899  LUMO = 3.47956681526639
  mo_energy =
[ -0.88779509   3.47956682  17.64035541  43.09852768  85.38764623
 147.84548192]
E1 = -3.8245589693396242  E_coul = 1.0244847783576048
cycle= 20 E= -2.80007419098202  delta_E= 5.51e-07  |g|= 4.29e-05  |ddm|= 0.244
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795021174755  LUMO = 3.47956897106643
  mo_energy =
[ -0.88779502   3.47956897  17.64036699  43.09856049  85.38769963
 147.84558248]
E1 = -3.8245588512603876  E_coul = 1.0244842457283083
cycle= 21 E= -2.80007460553208  delta_E= -4.15e-07  |g|= 5.99e-06  |ddm|= 0.439
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795029270418  LUMO = 3.47956912309601
  mo_energy =
[ -0.88779503   3.47956912  17.64036788  43.09856339  85.38770501
 147.84559521]
E1 = -3.824558840318025  E_coul = 1.0244841119453332
cycle= 22 E= -2.80007472837269  delta_E= -1.23e-07  |g|= 2.06e-05  |ddm|= 0.0408
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795037746039  LUMO = 3.47956929995272
  mo_energy =
[ -0.88779504   3.4795693   17.64036884  43.09856702  85.38771259
 147.84562311]
E1 = -3.8245588271586013  E_coul = 1.0244841404526355
cycle= 23 E= -2.80007468670597  delta_E= 4.17e-08  |g|= 1.8e-05  |ddm|= 0.053
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795094981743  LUMO = 3.47956824457669
  mo_energy =
[ -0.88779509   3.47956824  17.6403633   43.09854919  85.38768037
 147.84555178]
E1 = -3.8245588818270693  E_coul = 1.0244846147819173
cycle= 24 E= -2.80007426704515  delta_E= 4.2e-07  |g|= 3.58e-05  |ddm|= 0.228
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795076238702  LUMO = 3.47956901647997
  mo_energy =
[ -0.88779508   3.47956902  17.64036752  43.09856308  85.38770581
 147.84560803]
E1 = -3.8245588371818653  E_coul = 1.0244842065262476
cycle= 25 E= -2.80007463065562  delta_E= -3.64e-07  |g|= 6.42e-06  |ddm|= 0.181
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795066189789  LUMO = 3.47956944201367
  mo_energy =
[ -0.88779507   3.47956944  17.64036983  43.09857263  85.38772606
 147.84566505]
E1 = -3.8245588111513587  E_coul = 1.0244840629527843
cycle= 26 E= -2.80007474819857  delta_E= -1.18e-07  |g|= 2.86e-05  |ddm|= 0.123
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795142230915  LUMO = 3.47956776285427
  mo_energy =
[ -0.88779514   3.47956776  17.64036093  43.0985437   85.38767287
 147.84554157]
E1 = -3.8245589015113532  E_coul = 1.0244839546519562
cycle= 27 E= -2.8000749468594  delta_E= -1.99e-07  |g|= 4.1e-05  |ddm|= 0.374
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795168015559  LUMO = 3.47956704800534
  mo_energy =
[ -0.88779517   3.47956705  17.64035703  43.09853255  85.38765506
 147.84551325]
E1 = -3.824558939997576  E_coul = 1.024484269541638
cycle= 28 E= -2.80007467045594  delta_E= 2.76e-07  |g|= 6.93e-06  |ddm|= 0.144
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795229886102  LUMO = 3.47956539062369
  mo_energy =
[ -0.88779523   3.47956539  17.64034816  43.09850708  85.38761288
 147.84543377]
E1 = -3.8245590294444693  E_coul = 1.024484500087613
cycle= 29 E= -2.80007452935686  delta_E= 1.41e-07  |g|= 1.36e-05  |ddm|= 0.337
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795209182237  LUMO = 3.47956567798494
  mo_energy =
[ -0.88779521   3.47956568  17.64034968  43.09851122  85.38761922
 147.84544215]
E1 = -3.8245590160814764  E_coul = 1.024484448483105
cycle= 30 E= -2.80007456759837  delta_E= -3.82e-08  |g|= 4.94e-06  |ddm|= 0.0504
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795178101516  LUMO = 3.47956627132765
  mo_energy =
[ -0.88779518   3.47956627  17.64035283  43.09851868  85.38762866
 147.84544603]
E1 = -3.8245589867671548  E_coul = 1.0244841425893585
cycle= 31 E= -2.8000748441778  delta_E= -2.77e-07  |g|= 2.43e-05  |ddm|= 0.0985
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.88779518781236  LUMO = 3.47956576892455
  mo_energy =
[ -0.88779519   3.47956577  17.6403501   43.09850972  85.38761247
 147.8454088 ]
E1 = -3.8245590167029717  E_coul = 1.0244845318469866
cycle= 32 E= -2.80007448485599  delta_E= 3.59e-07  |g|= 1.34e-05  |ddm|= 0.121
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.88779520661401  LUMO = 3.47956507640316
  mo_energy =
[ -0.88779521   3.47956508  17.64034628  43.09849533  85.38758365
 147.8453357 ]
E1 = -3.8245590574721517  E_coul = 1.0244844751186566
cycle= 33 E= -2.8000745823535  delta_E= -9.75e-08  |g|= 9.45e-06  |ddm|= 0.182
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795186758981  LUMO = 3.47956531633581
  mo_energy =
[ -0.88779519   3.47956532  17.64034753  43.09849621  85.38758107
 147.84531218]
E1 = -3.8245590488718273  E_coul = 1.0244840118413074
cycle= 34 E= -2.80007503703052  delta_E= -4.55e-07  |g|= 3.97e-05  |ddm|= 0.00986
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795208094795  LUMO = 3.47956432517699
  mo_energy =
[ -0.88779521   3.47956433  17.64034202  43.0984803   85.3875551
 147.84526666]
E1 = -3.8245591048000804  E_coul = 1.0244846074940515
cycle= 35 E= -2.80007449730603  delta_E= 5.4e-07  |g|= 2.37e-05  |ddm|= 0.207
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795139177809  LUMO = 3.47956589703246
  mo_energy =
[ -0.88779514   3.4795659   17.64035049  43.09850549  85.38759787
 147.84534683]
E1 = -3.8245590219439545  E_coul = 1.0244849133915537
cycle= 36 E= -2.8000741085524  delta_E= 3.89e-07  |g|= 5.53e-05  |ddm|= 0.322
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795063809931  LUMO = 3.47956786524336
  mo_energy =
[ -0.88779506   3.47956787  17.64036109  43.09853518  85.38764553
 147.84542714]
E1 = -3.8245589170390124  E_coul = 1.0244842022526803
cycle= 37 E= -2.80007471478633  delta_E= -6.06e-07  |g|= 1.5e-05  |ddm|= 0.388
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795093970769  LUMO = 3.47956722956887
  mo_energy =
[ -0.88779509   3.47956723  17.6403576   43.09852302  85.38762194
 147.84537258]
E1 = -3.8245589508543945  E_coul = 1.0244845203967599
cycle= 38 E= -2.80007443045763  delta_E= 2.84e-07  |g|= 1.9e-05  |ddm|= 0.147
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795080900194  LUMO = 3.4795676841117
  mo_energy =
[ -0.88779508   3.47956768  17.64035999  43.09853046  85.38763541
 147.84540461]
E1 = -3.8245589249915257  E_coul = 1.0244848702807512
cycle= 39 E= -2.80007405471077  delta_E= 3.76e-07  |g|= 5.76e-05  |ddm|= 0.102
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887794986143125  LUMO = 3.47957035585588
  mo_energy =
[ -0.88779499   3.47957036  17.64037424  43.09857332  85.38770875
 147.84555751]
E1 = -3.82455877811832  E_coul = 1.0244841962695217
cycle= 40 E= -2.8000745818488  delta_E= -5.27e-07  |g|= 1.07e-05  |ddm|= 0.57
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795013125612  LUMO = 3.4795699969474
  mo_energy =
[ -0.88779501   3.47957     17.64037243  43.09856847  85.38770117
 147.84554453]
E1 = -3.8245587945939357  E_coul = 1.0244845285526927
cycle= 41 E= -2.80007426604124  delta_E= 3.16e-07  |g|= 2.67e-05  |ddm|= 0.0634
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887794989980979  LUMO = 3.47957103886059
  mo_energy =
[ -0.88779499   3.47957104  17.64037805  43.09858575  85.38773097
 147.8456107 ]
E1 = -3.824558734333668  E_coul = 1.0244845282661619
cycle= 42 E= -2.80007420606751  delta_E= 6e-08  |g|= 3.28e-05  |ddm|= 0.234
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887794905789442  LUMO = 3.47957384974154
  mo_energy =
[ -0.88779491   3.47957385  17.64039339  43.09863291  85.38781284
 147.84577682]
E1 = -3.824558577418877  E_coul = 1.0244837965506097
cycle= 43 E= -2.80007478086827  delta_E= -5.75e-07  |g|= 4.05e-05  |ddm|= 0.614
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887794974225203  LUMO = 3.4795728050218
  mo_energy =
[ -0.88779497   3.47957281  17.64038791  43.09861802  85.38778983
 147.84574267]
E1 = -3.8245586273573084  E_coul = 1.024484175260449
cycle= 44 E= -2.80007445209686  delta_E= 3.29e-07  |g|= 6e-06  |ddm|= 0.189
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795041809586  LUMO = 3.47957158200662
  mo_energy =
[ -0.88779504   3.47957158  17.64038143  43.09859899  85.38775746
 147.84567935]
E1 = -3.824558689084471  E_coul = 1.0244838816169641
cycle= 45 E= -2.80007480746751  delta_E= -3.55e-07  |g|= 4.1e-05  |ddm|= 0.241
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795067650314  LUMO = 3.47957124654091
  mo_energy =
[ -0.88779507   3.47957125  17.64037977  43.09859433  85.3877503
 147.84566577]
E1 = -3.8245587047766096  E_coul = 1.0244835981739338
cycle= 46 E= -2.80007510660268  delta_E= -2.99e-07  |g|= 7.13e-05  |ddm|= 0.0624
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795167597814  LUMO = 3.47956890030308
  mo_energy =
[ -0.88779517   3.4795689   17.64036729  43.09855751  85.38768824
 147.84554435]
E1 = -3.824558829461286  E_coul = 1.0244839750052972
cycle= 47 E= -2.80007485445599  delta_E= 2.52e-07  |g|= 3.55e-05  |ddm|= 0.482
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795273488957  LUMO = 3.47956616623233
  mo_energy =
[ -0.88779527   3.47956617  17.64035268  43.09851338  85.387612
 147.84538534]
E1 = -3.824558977586158  E_coul = 1.0244843951018254
cycle= 48 E= -2.80007458248433  delta_E= 2.72e-07  |g|= 5.9e-06  |ddm|= 0.578
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795263810352  LUMO = 3.47956545783317
  mo_energy =
[ -0.88779526   3.47956546  17.64034873  43.09850196  85.38759359
 147.84535114]
E1 = -3.8245590229289226  E_coul = 1.0244844658558407
cycle= 49 E= -2.80007455707308  delta_E= 2.54e-08  |g|= 4.96e-06  |ddm|= 0.163
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.887795270723732  LUMO = 3.4795652366006
  mo_energy =
[ -0.88779527   3.47956524  17.6403475   43.09849507  85.38757694
 147.84529671]
E1 = -3.8245590373507246  E_coul = 1.024484610265093
cycle= 50 E= -2.80007442708563  delta_E= 1.3e-07  |g|= 2.89e-05  |ddm|= 0.0841
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8245590373507246  E_coul = 1.024484610265093

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.887794908422969  LUMO = 3.47957187964229
  mo_energy =
[ -0.88779491   3.47957188  17.64038259  43.0986115   85.3877928
 147.84578141]
E1 = -3.824558690501751  E_coul = 1.02448361471026
Extra cycle  E= -2.80007507579149  delta_E= -6.49e-07  |g|= 7.28e-05  |ddm|= 1.48
    CPU time for scf_cycle      0.49 sec, wall time      0.49 sec
exp = [15.21699118 13.41007606 11.80021504  9.80868389  8.90474196  0.51395858]
E = -2.800075075791491
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:34:59 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  7.21105649694        1
[INPUT] 0    0    [1    /1   ]  6.35730386617        1
[INPUT] 0    0    [1    /1   ]  5.5960282909         1
[INPUT] 0    0    [1    /1   ]  4.77373859257        1
[INPUT] 0    0    [1    /1   ]  4.32057525728        1
[INPUT] 0    0    [1    /1   ]  0.391201777167       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [7.211056496939796, 1.0]], [0, [6.357303866165662, 1.0]], [0, [5.5960282909019625, 1.0]], [0, [4.77373859257497, 1.0]], [0, [4.3205752572837515, 1.0]], [0, [0.39120177716686366, 1.0]]]}
ecp = {}
CPU time:        56.32
Set gradient conv threshold to 3.16228e-05
cond(S) = 840996809.5981282

WARN: Singularity detected in overlap matrix (condition number = 8.41e+08). SCF may be inaccurate and hard to converge.

E1 = -3.854713057407649  E_coul = 1.024112892363069
init E= -2.83060016504458
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906366957337837  LUMO = 1.77252587243634
  mo_energy =
[-0.90636696  1.77252587  8.53422748 20.5017527  40.80351269 69.70719592]
E1 = -3.8643609042125853  E_coul = 1.0275037721514726
cycle= 1 E= -2.83685713206111  delta_E= -0.00626  |g|= 0.00555  |ddm|= 2.94e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904677404612517  LUMO = 1.77620078992459
  mo_energy =
[-0.9046774   1.77620079  8.53803292 20.50551081 40.8072257  69.71032669]
E1 = -3.8638064163490835  E_coul = 1.0269469001315747
cycle= 2 E= -2.83685951621751  delta_E= -2.38e-06  |g|= 0.00017  |ddm|= 1.09e+03
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904970291392715  LUMO = 1.77596627746197
  mo_energy =
[-0.90497029  1.77596628  8.53738816 20.50448771 40.80589403 69.70834999]
E1 = -3.8637707663413923  E_coul = 1.0269126217218116
cycle= 3 E= -2.83685814461958  delta_E= 1.37e-06  |g|= 0.000126  |ddm|=   32
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904972983064171  LUMO = 1.77599304263171
  mo_energy =
[-0.90497298  1.77599304  8.53753887 20.50500632 40.80673343 69.71004658]
E1 = -3.863767150167421  E_coul = 1.0269073241361
cycle= 4 E= -2.83685982603132  delta_E= -1.68e-06  |g|= 0.00016  |ddm|= 30.1
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90497474988322  LUMO = 1.77597322361694
  mo_energy =
[-0.90497475  1.77597322  8.53743575 20.50467433 40.80620745 69.70901172]
E1 = -3.8637687603419617  E_coul = 1.0269077673316178
cycle= 5 E= -2.83686099301034  delta_E= -1.17e-06  |g|= 0.000185  |ddm|=   18
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975407417006  LUMO = 1.77595999013517
  mo_energy =
[-0.90497541  1.77595999  8.5373671  20.5044446  40.80583834 69.70818545]
E1 = -3.8637700079257375  E_coul = 1.0269107280975744
cycle= 6 E= -2.83685927982816  delta_E= 1.71e-06  |g|= 2.78e-05  |ddm|= 13.5
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975111051029  LUMO = 1.77596279403645
  mo_energy =
[-0.90497511  1.77596279  8.53738237 20.50447846 40.80587358 69.70816778]
E1 = -3.8637698240488945  E_coul = 1.0269103635138295
cycle= 7 E= -2.83685946053506  delta_E= -1.81e-07  |g|= 6.52e-06  |ddm|= 1.64
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904974994802597  LUMO = 1.7759633888702
  mo_energy =
[-0.90497499  1.77596339  8.53738499 20.50448486 40.80588103 69.70818609]
E1 = -3.863769790682639  E_coul = 1.0269086718633171
cycle= 8 E= -2.83686111881932  delta_E= -1.66e-06  |g|= 0.000141  |ddm|= 0.365
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975205267987  LUMO = 1.77595830677642
  mo_energy =
[-0.90497521  1.77595831  8.53735821 20.50439781 40.80574535 69.70791321]
E1 = -3.8637702723651093  E_coul = 1.0269086663717149
cycle= 9 E= -2.83686160599339  delta_E= -4.87e-07  |g|= 0.000164  |ddm|= 5.09
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975690722806  LUMO = 1.77594813016073
  mo_energy =
[-0.90497569  1.77594813  8.53730477 20.50421805 40.805455   69.70729619]
E1 = -3.86377122910418  E_coul = 1.0269123974033172
cycle= 10 E= -2.83685883170086  delta_E= 2.77e-06  |g|= 0.000137  |ddm|= 10.4
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975585645923  LUMO = 1.77595125719281
  mo_energy =
[-0.90497559  1.77595126  8.53732104 20.5042754  40.80554966 69.70751336]
E1 = -3.8637709165622334  E_coul = 1.0269120470247706
cycle= 11 E= -2.83685886953746  delta_E= -3.78e-08  |g|= 0.000127  |ddm|= 3.42
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975468483879  LUMO = 1.77595310392412
  mo_energy =
[-0.90497547  1.7759531   8.53733047 20.50430998 40.80560867 69.70765555]
E1 = -3.8637707440571583  E_coul = 1.0269085439294028
cycle= 12 E= -2.83686220012776  delta_E= -3.33e-06  |g|= 0.00019  |ddm|= 1.99
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904977328830804  LUMO = 1.7759221519786
  mo_energy =
[-0.90497733  1.77592215  8.53716917 20.50378159 40.80477439 69.70592008]
E1 = -3.86377353639354  E_coul = 1.0269149425229958
cycle= 13 E= -2.83685859387054  delta_E= 3.61e-06  |g|= 0.00028  |ddm|= 30.3
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904976352947788  LUMO = 1.77593671153713
  mo_energy =
[-0.90497635  1.77593671  8.53724555 20.50402027 40.80513797 69.70662296]
E1 = -3.8637722750459806  E_coul = 1.0269124916148633
cycle= 14 E= -2.83685978343112  delta_E= -1.19e-06  |g|= 0.000102  |ddm|= 13.4
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904976440542415  LUMO = 1.77593384695555
  mo_energy =
[-0.90497644  1.77593385  8.53722969 20.50397643 40.80507825 69.70655326]
E1 = -3.8637725348118717  E_coul = 1.0269124279593604
cycle= 15 E= -2.83686010685251  delta_E= -3.23e-07  |g|= 8.31e-05  |ddm|= 2.48
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904976807677322  LUMO = 1.7759260389737
  mo_energy =
[-0.90497681  1.77592604  8.53718881 20.50384633 40.80487796 69.7061511 ]
E1 = -3.863773262009889  E_coul = 1.0269125257419278
cycle= 16 E= -2.83686073626796  delta_E= -6.29e-07  |g|= 6.1e-05  |ddm|= 7.64
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904976573740021  LUMO = 1.77593010114167
  mo_energy =
[-0.90497657  1.7759301   8.53720965 20.50391643 40.80498736 69.70638399]
E1 = -3.8637728862454033  E_coul = 1.0269122944000955
cycle= 17 E= -2.83686059184531  delta_E= 1.44e-07  |g|= 5.61e-05  |ddm|= 4.09
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975946619602  LUMO = 1.7759416544945
  mo_energy =
[-0.90497595  1.77594165  8.53727021 20.5041216  40.80531937 69.70707738]
E1 = -3.8637718202705047  E_coul = 1.0269115401094449
cycle= 18 E= -2.83686028016106  delta_E= 3.12e-07  |g|= 3.5e-05  |ddm|= 11.7
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90497669762935  LUMO = 1.77592627258988
  mo_energy =
[-0.9049767   1.77592627  8.53718847 20.50386521 40.80492761 69.70634476]
E1 = -3.8637732218788168  E_coul = 1.0269134739012693
cycle= 19 E= -2.83685974797755  delta_E= 5.32e-07  |g|= 0.00014  |ddm|= 14.7
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904978089587098  LUMO = 1.77589846499157
  mo_energy =
[-0.90497809  1.77589846  8.53704267 20.50337318 40.80413277 69.70464383]
E1 = -3.8637758203711505  E_coul = 1.0269145604856464
cycle= 20 E= -2.8368612598855  delta_E= -1.51e-06  |g|= 0.000134  |ddm|= 28.4
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975057582345  LUMO = 1.77596074078443
  mo_energy =
[-0.90497506  1.77596074  8.53737169 20.50443179 40.80578875 69.70794661]
E1 = -3.8637700840519593  E_coul = 1.0269099923945888
cycle= 21 E= -2.83686009165737  delta_E= 1.17e-06  |g|= 3.27e-05  |ddm|= 60.9
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904974995422284  LUMO = 1.77596276891094
  mo_energy =
[-0.904975    1.77596277  8.53738224 20.50447997 40.80588006 69.70819949]
E1 = -3.863769860316272  E_coul = 1.0269086982577504
cycle= 22 E= -2.83686116205852  delta_E= -1.07e-06  |g|= 0.000147  |ddm|= 2.77
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975677359011  LUMO = 1.77594961149931
  mo_energy =
[-0.90497568  1.77594961  8.53731339 20.50424801 40.80550392 69.70737721]
E1 = -3.8637710834382406  E_coul = 1.026910987738582
cycle= 23 E= -2.83686009569966  delta_E= 1.07e-06  |g|= 8.63e-06  |ddm|= 13.4
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975638734428  LUMO = 1.77595055558098
  mo_energy =
[-0.90497564  1.77595056  8.53731838 20.50426018 40.80551823 69.70739786]
E1 = -3.8637709990241236  E_coul = 1.026911456309494
cycle= 24 E= -2.83685954271463  delta_E= 5.53e-07  |g|= 5.71e-05  |ddm|= 0.756
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975471130821  LUMO = 1.77595416733876
  mo_energy =
[-0.90497547  1.77595417  8.53733763 20.5043191  40.8056072  69.70756661]
E1 = -3.8637706700140098  E_coul = 1.0269107703294895
cycle= 25 E= -2.83685989968452  delta_E= -3.57e-07  |g|= 1.53e-05  |ddm|= 3.39
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975408008777  LUMO = 1.77595546077901
  mo_energy =
[-0.90497541  1.77595546  8.53734423 20.5043416  40.80564319 69.70764809]
E1 = -3.863770545301241  E_coul = 1.0269124036524557
cycle= 26 E= -2.83685814164879  delta_E= 1.76e-06  |g|= 0.000159  |ddm|= 1.35
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975008308193  LUMO = 1.77596368759426
  mo_energy =
[-0.90497501  1.77596369  8.53738806 20.50447489 40.80584236 69.70800017]
E1 = -3.8637698016051654  E_coul = 1.0269103199953087
cycle= 27 E= -2.83685948160986  delta_E= -1.34e-06  |g|= 1.17e-05  |ddm|= 7.64
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904974946071174  LUMO = 1.77596484117392
  mo_energy =
[-0.90497495  1.77596484  8.53739416 20.50449576 40.80587642 69.70805828]
E1 = -3.8637696968248836  E_coul = 1.0269092420817976
cycle= 28 E= -2.83686045474309  delta_E= -9.73e-07  |g|= 7.56e-05  |ddm|= 1.15
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975874305171  LUMO = 1.77594434698141
  mo_energy =
[-0.90497587  1.77594435  8.53728317 20.50417625 40.80541951 69.70733876]
E1 = -3.863771517821829  E_coul = 1.0269107893513454
cycle= 29 E= -2.83686072847048  delta_E= -2.74e-07  |g|= 3.72e-05  |ddm|= 18.1
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975397705295  LUMO = 1.7759534599286
  mo_energy =
[-0.9049754   1.77595346  8.53733053 20.504331   40.8056636  69.70785727]
E1 = -3.863770672824493  E_coul = 1.0269110468095173
cycle= 30 E= -2.83685962601498  delta_E= 1.1e-06  |g|= 2.57e-05  |ddm|= 9.05
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904974796165225  LUMO = 1.77596463459045
  mo_energy =
[-0.9049748   1.77596463  8.53738821 20.50452985 40.80599019 69.70859762]
E1 = -3.863769622889794  E_coul = 1.0269101698535317
cycle= 31 E= -2.83685945303626  delta_E= 1.73e-07  |g|= 2.07e-06  |ddm|= 11.6
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904974810747491  LUMO = 1.77596473179347
  mo_energy =
[-0.90497481  1.77596473  8.53738841 20.50454099 40.80601978 69.70872026]
E1 = -3.8637695899267075  E_coul = 1.0269093617234166
cycle= 32 E= -2.83686022820329  delta_E= -7.75e-07  |g|= 9.01e-05  |ddm|=  0.7
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975027086224  LUMO = 1.77596143515633
  mo_energy =
[-0.90497503  1.77596144  8.53737263 20.50447716 40.80590675 69.70841685]
E1 = -3.8637699177694698  E_coul = 1.026909630411855
cycle= 33 E= -2.83686028735761  delta_E= -5.92e-08  |g|= 8.14e-05  |ddm|= 3.89
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975140213617  LUMO = 1.77595964115723
  mo_energy =
[-0.90497514  1.77595964  8.53736389 20.50444206 40.80584437 69.70823956]
E1 = -3.863770095995464  E_coul = 1.0269086876412492
cycle= 34 E= -2.83686140835422  delta_E= -1.12e-06  |g|= 0.000173  |ddm|= 2.12
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975342093888  LUMO = 1.77595602563287
  mo_energy =
[-0.90497534  1.77595603  8.53734526 20.50437724 40.80573697 69.70799238]
E1 = -3.8637704348242736  E_coul = 1.02691042717132
cycle= 35 E= -2.83686000765295  delta_E= 1.4e-06  |g|= 1.7e-05  |ddm|= 3.77
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975536155522  LUMO = 1.77595235228842
  mo_energy =
[-0.90497554  1.77595235  8.53732556 20.50431868 40.80565121 69.70786429]
E1 = -3.863770757223578  E_coul = 1.02691191470858
cycle= 36 E= -2.836858842515  delta_E= 1.17e-06  |g|= 9.87e-05  |ddm|= 3.27
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975538310262  LUMO = 1.77595387984499
  mo_energy =
[-0.90497554  1.77595388  8.53733617 20.50433279 40.80565117 69.70771421]
E1 = -3.863770658353548  E_coul = 1.0269096392786279
cycle= 37 E= -2.83686101907492  delta_E= -2.18e-06  |g|= 9.02e-05  |ddm|= 0.403
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975908002933  LUMO = 1.77594681755156
  mo_energy =
[-0.90497591  1.77594682  8.53729923 20.50420263 40.80543402 69.70722719]
E1 = -3.863771321240926  E_coul = 1.0269127244794831
cycle= 38 E= -2.83685859676144  delta_E= 2.42e-06  |g|= 0.000164  |ddm|= 7.42
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904976350090799  LUMO = 1.77593904848337
  mo_energy =
[-0.90497635  1.77593905  8.53725947 20.50405988 40.8051952  69.70667541]
E1 = -3.863772059130705  E_coul = 1.026912152999937
cycle= 39 E= -2.83685990613077  delta_E= -1.31e-06  |g|= 8.48e-05  |ddm|= 8.34
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904976403553556  LUMO = 1.77593919556081
  mo_energy =
[-0.9049764   1.7759392   8.53726276 20.50404456 40.80514187 69.7063834 ]
E1 = -3.8637720995540685  E_coul = 1.026912159432544
cycle= 40 E= -2.83685994012152  delta_E= -3.4e-08  |g|= 8.81e-05  |ddm|= 1.28
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904976452627841  LUMO = 1.77593881819903
  mo_energy =
[-0.90497645  1.77593882  8.53726115 20.50403696 40.80512417 69.70628092]
E1 = -3.8637721368812787  E_coul = 1.026911856265503
cycle= 41 E= -2.83686028061578  delta_E= -3.4e-07  |g|= 4.95e-05  |ddm|= 0.524
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904976403222194  LUMO = 1.77593968647934
  mo_energy =
[-0.9049764   1.77593969  8.53726446 20.50406893 40.80519705 69.70658125]
E1 = -3.8637720103160422  E_coul = 1.0269127683425925
cycle= 42 E= -2.83685924197345  delta_E= 1.04e-06  |g|= 0.000148  |ddm|= 2.04
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90497547564907  LUMO = 1.77595658678598
  mo_energy =
[-0.90497548  1.77595659  8.53735143 20.50438467 40.80573314 69.70786013]
E1 = -3.8637704013771197  E_coul = 1.0269101740390656
cycle= 43 E= -2.83686022733805  delta_E= -9.85e-07  |g|= 3.54e-05  |ddm|= 18.3
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975644613625  LUMO = 1.77595290471122
  mo_energy =
[-0.90497564  1.7759529   8.53733092 20.50431852 40.80563121 69.70769798]
E1 = -3.8637707347592416  E_coul = 1.0269108422897166
cycle= 44 E= -2.83685989246952  delta_E= 3.35e-07  |g|= 1.3e-05  |ddm|= 3.57
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904976116986709  LUMO = 1.77594256842515
  mo_energy =
[-0.90497612  1.77594257  8.53727456 20.50414165 40.80535767 69.70720229]
E1 = -3.8637716636488113  E_coul = 1.026911677383969
cycle= 45 E= -2.83685998626484  delta_E= -9.38e-08  |g|= 4.8e-05  |ddm|= 9.77
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975334439064  LUMO = 1.77595724331737
  mo_energy =
[-0.90497533  1.77595724  8.53735112 20.50438865 40.80574395 69.70798083]
E1 = -3.863770316255542  E_coul = 1.0269102793656257
cycle= 46 E= -2.83686003688992  delta_E= -5.06e-08  |g|= 1.49e-05  |ddm|= 14.4
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975710127914  LUMO = 1.77594950198449
  mo_energy =
[-0.90497571  1.7759495   8.5373107  20.50427335 40.80558739 69.70777909]
E1 = -3.863771011124081  E_coul = 1.0269109880912792
cycle= 47 E= -2.8368600230328  delta_E= 1.39e-08  |g|= 8.54e-06  |ddm|= 6.81
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975749517818  LUMO = 1.77594888755233
  mo_energy =
[-0.90497575  1.77594889  8.53730709 20.50426397 40.80557311 69.70776679]
E1 = -3.8637710568395742  E_coul = 1.0269116228856257
cycle= 48 E= -2.83685943395395  delta_E= 5.89e-07  |g|= 6.05e-05  |ddm|= 0.428
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904975730331155  LUMO = 1.77594899962254
  mo_energy =
[-0.90497573  1.775949    8.53730725 20.50426968 40.8055882  69.70785408]
E1 = -3.863771034883753  E_coul = 1.0269112453811187
cycle= 49 E= -2.83685978950263  delta_E= -3.56e-07  |g|= 2.71e-05  |ddm|= 0.413
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90497601713595  LUMO = 1.77594337807052
  mo_energy =
[-0.90497602  1.77594338  8.53727898 20.50415895 40.80539097 69.7073123 ]
E1 = -3.863771593279176  E_coul = 1.026912163025432
cycle= 50 E= -2.83685943025374  delta_E= 3.59e-07  |g|= 8.84e-05  |ddm|= 6.59
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.863771593279176  E_coul = 1.026912163025432

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904973633662826  LUMO = 1.77596737661446
  mo_energy =
[-0.90497363  1.77596738  8.53740166 20.50451856 40.80591223 69.70820039]
E1 = -3.863769741064547  E_coul = 1.0269112266831528
Extra cycle  E= -2.83685851438139  delta_E= 9.16e-07  |g|= 9.57e-05  |ddm|= 19.7
    CPU time for scf_cycle      0.50 sec, wall time      0.50 sec
exp = [7.2110565  6.35730387 5.59602829 4.77373859 4.32057526 0.39120178]
E = -2.8368585143813942
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:00 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.41046302859        1
[INPUT] 0    0    [1    /1   ]  5.65202664702        1
[INPUT] 0    0    [1    /1   ]  4.9756096159         1
[INPUT] 0    0    [1    /1   ]  4.27024406327        1
[INPUT] 0    0    [1    /1   ]  3.86215858695        1
[INPUT] 0    0    [1    /1   ]  0.37892609713        1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.410463028592709, 1.0]], [0, [5.652026647017712, 1.0]], [0, [4.975609615897177, 1.0]], [0, [4.270244063267342, 1.0]], [0, [3.8621585869487975, 1.0]], [0, [0.3789260971299402, 1.0]]]}
ecp = {}
CPU time:        57.10
Set gradient conv threshold to 3.16228e-05
cond(S) = 964446204.7442676

WARN: Singularity detected in overlap matrix (condition number = 9.64e+08). SCF may be inaccurate and hard to converge.

E1 = -3.856591918342618  E_coul = 1.02421837130385
init E= -2.83237354703877
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906701508136085  LUMO = 1.61502985928983
  mo_energy =
[-0.90670151  1.61502986  7.64884107 18.28085226 36.38645889 61.98445946]
E1 = -3.866298865360172  E_coul = 1.028663843603348
cycle= 1 E= -2.83763502175682  delta_E= -0.00526  |g|= 0.00581  |ddm|= 5.96e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.90448639316217  LUMO = 1.61894374990534
  mo_energy =
[-0.90448639  1.61894375  7.65356839 18.28541518 36.39093807 61.98772168]
E1 = -3.8660218811507527  E_coul = 1.0283847648836235
cycle= 2 E= -2.83763711626713  delta_E= -2.09e-06  |g|= 0.000357  |ddm|=  439
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904634329179972  LUMO = 1.61886486780588
  mo_energy =
[-0.90463433  1.61886487  7.65331194 18.28492404 36.39020854 61.98617471]
E1 = -3.8660164405381123  E_coul = 1.028381853862016
cycle= 3 E= -2.8376345866761  delta_E= 2.53e-06  |g|= 0.000232  |ddm|= 71.2
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904624121214199  LUMO = 1.61893353006396
  mo_energy =
[-0.90462412  1.61893353  7.65364767 18.28602928 36.3919432  61.98985049]
E1 = -3.866011886549147  E_coul = 1.0283753801253357
cycle= 4 E= -2.83763650642381  delta_E= -1.92e-06  |g|= 0.000233  |ddm|= 75.8
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904629626265889  LUMO = 1.618888105402
  mo_energy =
[-0.90462963  1.61888811  7.65342374 18.28528892 36.39078113 61.98737293]
E1 = -3.866015279706304  E_coul = 1.0283766392373062
cycle= 5 E= -2.837638640469  delta_E= -2.13e-06  |g|= 0.000235  |ddm|= 50.6
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904630193294095  LUMO = 1.61886925805956
  mo_energy =
[-0.90463019  1.61886926  7.65332658 18.28496181 36.39026948 61.98626963]
E1 = -3.8660171604875706  E_coul = 1.0283793034492144
cycle= 6 E= -2.83763785703836  delta_E= 7.83e-07  |g|= 7.46e-05  |ddm|= 24.7
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904630055677956  LUMO = 1.61886421126161
  mo_energy =
[-0.90463006  1.61886421  7.65329941 18.28486827 36.39012235 61.9859762 ]
E1 = -3.866017737609703  E_coul = 1.0283792541953156
cycle= 7 E= -2.83763848341439  delta_E= -6.26e-07  |g|= 0.000107  |ddm|= 7.26
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90463005233895  LUMO = 1.61885859032527
  mo_energy =
[-0.90463005  1.61885859  7.65326947 18.2847671  36.38996273 61.98565406]
E1 = -3.866018336817031  E_coul = 1.0283805173401233
cycle= 8 E= -2.83763781947691  delta_E= 6.64e-07  |g|= 1.76e-05  |ddm|= 7.68
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629873278722  LUMO = 1.61885731497129
  mo_energy =
[-0.90462987  1.61885731  7.65326213 18.2847402  36.38991775 61.98555122]
E1 = -3.8660185220739987  E_coul = 1.0283788714995603
cycle= 9 E= -2.83763965057444  delta_E= -1.83e-06  |g|= 0.000175  |ddm|= 2.23
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904630006926105  LUMO = 1.61885122728934
  mo_energy =
[-0.90463001  1.61885123  7.65323022 18.28463555 36.38975675 61.98522672]
E1 = -3.8660191323433404  E_coul = 1.0283809897536829
cycle= 10 E= -2.83763814258966  delta_E= 1.51e-06  |g|= 1.06e-05  |ddm|= 7.86
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629824774349  LUMO = 1.61885654002823
  mo_energy =
[-0.90462982  1.61885654  7.65325756 18.28472979 36.38990662 61.98555298]
E1 = -3.8660186057004275  E_coul = 1.0283796983746742
cycle= 11 E= -2.83763890732575  delta_E= -7.65e-07  |g|= 0.000109  |ddm|= 7.05
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629885119522  LUMO = 1.6188531408763
  mo_energy =
[-0.90462989  1.61885314  7.65324012 18.28466808 36.38980756 61.9853289 ]
E1 = -3.8660189633046613  E_coul = 1.0283802098371786
cycle= 12 E= -2.83763875346748  delta_E= 1.54e-07  |g|= 7.1e-05  |ddm|= 4.74
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904634615779925  LUMO = 1.61878120765395
  mo_energy =
[-0.90463462  1.61878121  7.65288096 18.28346395 36.38793277 61.98108102]
E1 = -3.866025524739454  E_coul = 1.0283862211559245
cycle= 13 E= -2.83763930358353  delta_E= -5.5e-07  |g|= 0.000194  |ddm|= 89.5
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904630363415937  LUMO = 1.6188456571002
  mo_energy =
[-0.90463036  1.61884566  7.65319979 18.28455328 36.38964779 61.98513159]
E1 = -3.866019572158138  E_coul = 1.0283819821214275
cycle= 14 E= -2.83763759003671  delta_E= 1.71e-06  |g|= 5.03e-05  |ddm|= 81.8
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904630169508425  LUMO = 1.61884621816996
  mo_energy =
[-0.90463017  1.61884622  7.65320204 18.28456112 36.38965951 61.98515253]
E1 = -3.8660195619297286  E_coul = 1.0283817106192474
cycle= 15 E= -2.83763785131048  delta_E= -2.61e-07  |g|= 2.51e-05  |ddm|= 0.382
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629908491332  LUMO = 1.61884863355953
  mo_energy =
[-0.90462991  1.61884863  7.65321435 18.28459919 36.38971614 61.98524663]
E1 = -3.8660193822707702  E_coul = 1.0283802802356918
cycle= 16 E= -2.83763910203508  delta_E= -1.25e-06  |g|= 8.74e-05  |ddm|= 2.52
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904630046283249  LUMO = 1.61884361579342
  mo_energy =
[-0.90463005  1.61884362  7.65318815 18.28451488 36.38958886 61.98500217]
E1 = -3.8660198758281337  E_coul = 1.0283826217074286
cycle= 17 E= -2.8376372541207  delta_E= 1.85e-06  |g|= 0.0001  |ddm|=  6.3
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629424135766  LUMO = 1.61885336646004
  mo_energy =
[-0.90462942  1.61885337  7.65323771 18.28468147 36.38985084 61.98554776]
E1 = -3.866018995034328  E_coul = 1.0283824024700825
cycle= 18 E= -2.83763659256425  delta_E= 6.62e-07  |g|= 0.000116  |ddm|= 12.1
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904628982872563  LUMO = 1.61886043061105
  mo_energy =
[-0.90462898  1.61886043  7.6532737  18.2848036  36.39004546 61.98596608]
E1 = -3.8660183529514875  E_coul = 1.0283804611116758
cycle= 19 E= -2.83763789183981  delta_E= -1.3e-06  |g|= 3.61e-05  |ddm|= 8.84
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904628757470256  LUMO = 1.61886332348506
  mo_energy =
[-0.90462876  1.61886332  7.65328882 18.28485364 36.39012315 61.98609758]
E1 = -3.866018113604363  E_coul = 1.0283794942511957
cycle= 20 E= -2.83763861935317  delta_E= -7.28e-07  |g|= 0.000122  |ddm|= 3.34
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904628831275779  LUMO = 1.61886128467624
  mo_energy =
[-0.90462883  1.61886128  7.65327953 18.28480799 36.39003717 61.98583258]
E1 = -3.866018354770605  E_coul = 1.028380308568963
cycle= 21 E= -2.83763804620164  delta_E= 5.73e-07  |g|= 5.42e-05  |ddm|=  3.7
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629222266708  LUMO = 1.61885118047968
  mo_energy =
[-0.90462922  1.61885118  7.65323022 18.2846132  36.38970472 61.98496641]
E1 = -3.8660194213874504  E_coul = 1.0283820823735892
cycle= 22 E= -2.83763733901386  delta_E= 7.07e-07  |g|= 8.28e-05  |ddm|= 15.2
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904628965203982  LUMO = 1.61885458979278
  mo_energy =
[-0.90462897  1.61885459  7.65324636 18.28467652 36.38981305 61.98526342]
E1 = -3.866019093369187  E_coul = 1.0283805461092093
cycle= 23 E= -2.83763854725998  delta_E= -1.21e-06  |g|= 5.48e-05  |ddm|= 4.83
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629154792119  LUMO = 1.61885029229092
  mo_energy =
[-0.90462915  1.61885029  7.65322476 18.28459224 36.38966939 61.98492927]
E1 = -3.8660195287767825  E_coul = 1.0283814294710378
cycle= 24 E= -2.83763809930574  delta_E= 4.48e-07  |g|= 8.62e-06  |ddm|= 6.25
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629735126052  LUMO = 1.61883950545893
  mo_energy =
[-0.90462974  1.61883951  7.65317061 18.2843938  36.3893398  61.98415713]
E1 = -3.8660205711999076  E_coul = 1.0283833637288105
cycle= 25 E= -2.8376372074711  delta_E= 8.92e-07  |g|= 0.000145  |ddm|= 14.7
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904630406822761  LUMO = 1.61883117670177
  mo_energy =
[-0.90463041  1.61883118  7.65312813 18.28425412 36.38912295 61.98371268]
E1 = -3.8660212754763266  E_coul = 1.0283837677815768
cycle= 26 E= -2.83763750769475  delta_E= -3e-07  |g|= 0.000147  |ddm|= 9.72
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629672796307  LUMO = 1.61884395536509
  mo_energy =
[-0.90462967  1.61884396  7.65319241 18.28449447 36.38952739 61.98466301]
E1 = -3.8660200477043754  E_coul = 1.0283818595416452
cycle= 27 E= -2.83763818816273  delta_E= -6.8e-07  |g|= 2.79e-05  |ddm|= 17.6
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629609127421  LUMO = 1.61884372199188
  mo_energy =
[-0.90462961  1.61884372  7.65319066 18.28448586 36.38951074 61.9846375 ]
E1 = -3.8660200873568145  E_coul = 1.0283839443464111
cycle= 28 E= -2.8376361430104  delta_E= 2.05e-06  |g|= 0.000218  |ddm|= 0.557
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629300869117  LUMO = 1.61884734888047
  mo_energy =
[-0.9046293   1.61884735  7.65320809 18.28455175 36.38962223 61.98492619]
E1 = -3.8660197550400937  E_coul = 1.0283828896789353
cycle= 29 E= -2.83763686536116  delta_E= -7.22e-07  |g|= 0.000139  |ddm|=  4.9
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904628932061256  LUMO = 1.61885092430893
  mo_energy =
[-0.90462893  1.61885092  7.65322447 18.28462642 36.38976211 61.98533388]
E1 = -3.8660194157763694  E_coul = 1.0283821254491354
cycle= 30 E= -2.83763729032723  delta_E= -4.25e-07  |g|= 6.28e-05  |ddm|= 5.57
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904628842324209  LUMO = 1.61885331940206
  mo_energy =
[-0.90462884  1.61885332  7.65323927 18.28464764 36.3897658  61.98517493]
E1 = -3.8660192666668416  E_coul = 1.028381565120724
cycle= 31 E= -2.83763770154612  delta_E= -4.11e-07  |g|= 3.15e-05  |ddm|= 0.981
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904628323393245  LUMO = 1.61886229476653
  mo_energy =
[-0.90462832  1.61886229  7.65328615 18.28480669 36.39001743 61.98563733]
E1 = -3.866018457800513  E_coul = 1.0283802055752864
cycle= 32 E= -2.83763825222523  delta_E= -5.51e-07  |g|= 5.58e-05  |ddm|= 11.1
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90462853522582  LUMO = 1.61885733147434
  mo_energy =
[-0.90462854  1.61885733  7.65325863 18.28474199 36.38994341 61.9856329 ]
E1 = -3.866018859344631  E_coul = 1.0283801843759994
cycle= 33 E= -2.83763867496863  delta_E= -4.23e-07  |g|= 9.03e-05  |ddm|= 4.37
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904628823442153  LUMO = 1.61885176494812
  mo_energy =
[-0.90462882  1.61885176  7.65323034 18.28463247 36.38975541 61.98519281]
E1 = -3.866019405905923  E_coul = 1.0283797154987098
cycle= 34 E= -2.83763969040721  delta_E= -1.02e-06  |g|= 0.000152  |ddm|= 7.92
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629412562421  LUMO = 1.61883977922155
  mo_energy =
[-0.90462941  1.61883978  7.65316945 18.284413   36.3893934  61.98436184]
E1 = -3.8660205671837584  E_coul = 1.0283835428305097
cycle= 35 E= -2.83763702435325  delta_E= 2.67e-06  |g|= 0.000148  |ddm|= 16.2
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629688441506  LUMO = 1.61883503774414
  mo_energy =
[-0.90462969  1.61883504  7.65314508 18.28433329 36.38927083 61.98411824]
E1 = -3.8660209968216543  E_coul = 1.0283820979945335
cycle= 36 E= -2.83763889882712  delta_E= -1.87e-06  |g|= 2.46e-06  |ddm|= 5.75
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629239155188  LUMO = 1.61884470376782
  mo_energy =
[-0.90462924  1.6188447   7.65319418 18.28450262 36.38954049 61.98471596]
E1 = -3.8660200639297737  E_coul = 1.028382342869185
cycle= 37 E= -2.83763772106059  delta_E= 1.18e-06  |g|= 5.64e-05  |ddm|= 12.6
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629210594163  LUMO = 1.61884530940275
  mo_energy =
[-0.90462921  1.61884531  7.65319729 18.28451312 36.38955715 61.98475165]
E1 = -3.8660200062697547  E_coul = 1.028382076690085
cycle= 38 E= -2.83763792957967  delta_E= -2.09e-07  |g|= 4.54e-05  |ddm|= 0.776
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629282053304  LUMO = 1.61884356063293
  mo_energy =
[-0.90462928  1.61884356  7.65318819 18.28448421 36.38951372 61.98466632]
E1 = -3.866020170685834  E_coul = 1.0283858020144374
cycle= 39 E= -2.8376343686714  delta_E= 3.56e-06  |g|= 0.000392  |ddm|= 2.13
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90462939511905  LUMO = 1.6188411478067
  mo_energy =
[-0.9046294   1.61884115  7.65317571 18.28443942 36.38943936 61.98450785]
E1 = -3.86602040164003  E_coul = 1.0283823422731064
cycle= 40 E= -2.83763805936692  delta_E= -3.69e-06  |g|= 4.7e-05  |ddm|= 3.22
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629686477136  LUMO = 1.61883577123846
  mo_energy =
[-0.90462969  1.61883577  7.65314849 18.28432539 36.38923544 61.98400847]
E1 = -3.866020940941132  E_coul = 1.0283819644822096
cycle= 41 E= -2.83763897645892  delta_E= -9.17e-07  |g|= 5.51e-06  |ddm|= 8.15
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90462906921972  LUMO = 1.61884819798066
  mo_energy =
[-0.90462907  1.6188482   7.6532113  18.28455604 36.38961598 61.98487409]
E1 = -3.866019728125751  E_coul = 1.0283814150497013
cycle= 42 E= -2.83763831307605  delta_E= 6.63e-07  |g|= 2.73e-06  |ddm|=   17
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904626582566903  LUMO = 1.61889704155673
  mo_energy =
[-0.90462658  1.61889704  7.65346202 18.28544079 36.39106527 61.9880508 ]
E1 = -3.86601510104326  E_coul = 1.0283763482438206
cycle= 43 E= -2.83763875279944  delta_E= -4.4e-07  |g|= 0.000283  |ddm|= 64.1
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904628843161041  LUMO = 1.61885269273765
  mo_energy =
[-0.90462884  1.61885269  7.65323543 18.28463881 36.38975164 61.98514099]
E1 = -3.8660193206889506  E_coul = 1.0283818833563294
cycle= 44 E= -2.83763743733262  delta_E= 1.32e-06  |g|= 6.11e-05  |ddm|= 58.4
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904628718790152  LUMO = 1.61885501222772
  mo_energy =
[-0.90462872  1.61885501  7.65324685 18.28468114 36.38982188 61.98531699]
E1 = -3.8660190923749913  E_coul = 1.02838199760529
cycle= 45 E= -2.8376370947697  delta_E= 3.43e-07  |g|= 7.79e-05  |ddm|= 3.22
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904628622069038  LUMO = 1.61885679972832
  mo_energy =
[-0.90462862  1.6188568   7.65325572 18.28471765 36.3898863  61.98547678]
E1 = -3.8660189124713966  E_coul = 1.0283779284091865
cycle= 46 E= -2.83764098406221  delta_E= -3.89e-06  |g|= 0.000282  |ddm|= 2.68
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629020626535  LUMO = 1.61884906845733
  mo_energy =
[-0.90462902  1.61884907  7.653216   18.2845854  36.38968011 61.98505395]
E1 = -3.8660196316695576  E_coul = 1.0283814773654978
cycle= 47 E= -2.83763815430406  delta_E= 2.83e-06  |g|= 7.26e-06  |ddm|= 9.64
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629339079887  LUMO = 1.61884309158933
  mo_energy =
[-0.90462934  1.61884309  7.65318584 18.28447916 36.38950848 61.98465587]
E1 = -3.8660202029892763  E_coul = 1.0283792190921044
cycle= 48 E= -2.83764098389717  delta_E= -2.83e-06  |g|= 0.000225  |ddm|= 7.89
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629587483732  LUMO = 1.61883826375311
  mo_energy =
[-0.90462959  1.61883826  7.65316095 18.28439856 36.38938515 61.98441115]
E1 = -3.866020647365303  E_coul = 1.0283838890673942
cycle= 49 E= -2.83763675829791  delta_E= 4.23e-06  |g|= 0.000192  |ddm|= 5.87
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904629453425619  LUMO = 1.61884085825682
  mo_energy =
[-0.90462945  1.61884086  7.65317383 18.28444719 36.38946677 61.98461298]
E1 = -3.8660203901825296  E_coul = 1.0283825173752112
cycle= 50 E= -2.83763787280732  delta_E= -1.11e-06  |g|= 7.25e-05  |ddm|= 3.66
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8660203901825296  E_coul = 1.0283825173752112

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904627677765513  LUMO = 1.61885547433306
  mo_energy =
[-0.90462768  1.61885547  7.65324429 18.28470828 36.3899088  61.98570789]
E1 = -3.866019233620841  E_coul = 1.0283810590310374
Extra cycle  E= -2.8376381745898  delta_E= -3.02e-07  |g|= 3.68e-05  |ddm|=   18
    CPU time for scf_cycle      0.49 sec, wall time      0.49 sec
exp = [6.41046303 5.65202665 4.97560962 4.27024406 3.86215859 0.3789261 ]
E = -2.8376381745898036
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:00 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.35275511578        1
[INPUT] 0    0    [1    /1   ]  5.60118926465        1
[INPUT] 0    0    [1    /1   ]  4.93088895776        1
[INPUT] 0    0    [1    /1   ]  4.23395146341        1
[INPUT] 0    0    [1    /1   ]  3.8291152631         1
[INPUT] 0    0    [1    /1   ]  0.3780412487         1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.3527551157804405, 1.0]], [0, [5.60118926465048, 1.0]], [0, [4.93088895776066, 1.0]], [0, [4.233951463405484, 1.0]], [0, [3.829115263103054, 1.0]], [0, [0.37804124870025635, 1.0]]]}
ecp = {}
CPU time:        57.86
Set gradient conv threshold to 3.16228e-05
cond(S) = 975467311.5222713

WARN: Singularity detected in overlap matrix (condition number = 9.75e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8566304829273594  E_coul = 1.0242307398553505
init E= -2.83239974307201
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.90668944005401  LUMO = 1.60393756909716
  mo_energy =
[-0.90668944  1.60393757  7.58622794 18.12459611 36.07401498 61.4411239 ]
E1 = -3.86635021372048  E_coul = 1.028725185923465
cycle= 1 E= -2.83762502779702  delta_E= -0.00523  |g|= 0.00597  |ddm|= 8.68e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904450780820522  LUMO = 1.60786096224297
  mo_energy =
[-0.90445078  1.60786096  7.59101201 18.12925426 36.07862704 61.44469087]
E1 = -3.866092194167173  E_coul = 1.0284635778954037
cycle= 2 E= -2.83762861627177  delta_E= -3.59e-06  |g|= 0.000423  |ddm|=  567
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904590266200442  LUMO = 1.60776343258084
  mo_energy =
[-0.90459027  1.60776343  7.59063388 18.12832547 36.07722944 61.44177146]
E1 = -3.8660917650627935  E_coul = 1.0284660927793252
cycle= 3 E= -2.83762567228347  delta_E= 2.94e-06  |g|= 0.00028  |ddm|=  116
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904576813668968  LUMO = 1.60784477876344
  mo_energy =
[-0.90457681  1.60784478  7.59102274 18.1296444  36.07933295 61.44652353]
E1 = -3.8660865947046914  E_coul = 1.0284589820414534
cycle= 4 E= -2.83762761266324  delta_E= -1.94e-06  |g|= 0.000255  |ddm|= 91.6
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904583521542509  LUMO = 1.60779533436786
  mo_energy =
[-0.90458352  1.60779533  7.59078491 18.12881945 36.07799986 61.44343065]
E1 = -3.866090221076695  E_coul = 1.02846291692841
cycle= 5 E= -2.83762730414828  delta_E= 3.09e-07  |g|= 1.1e-05  |ddm|= 57.5
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904583044453642  LUMO = 1.60779409034898
  mo_energy =
[-0.90458304  1.60779409  7.59077515 18.12880715 36.07800347 61.44356153]
E1 = -3.866090418864736  E_coul = 1.028463058899779
cycle= 6 E= -2.83762735996496  delta_E= -5.58e-08  |g|= 8.59e-06  |ddm|= 1.18
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582831428665  LUMO = 1.60779350492229
  mo_energy =
[-0.90458283  1.6077935   7.59077123 18.12879324 36.07798091 61.44352193]
E1 = -3.8660905351612262  E_coul = 1.0284628803502185
cycle= 7 E= -2.83762765481101  delta_E= -2.95e-07  |g|= 3.25e-05  |ddm|= 1.26
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582755548929  LUMO = 1.60779207978825
  mo_energy =
[-0.90458276  1.60779208  7.59076359 18.12876418 36.077932   61.44340966]
E1 = -3.866090713981283  E_coul = 1.0284633654834965
cycle= 8 E= -2.83762734849779  delta_E= 3.06e-07  |g|= 5.21e-06  |ddm|= 2.35
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582633837034  LUMO = 1.60779235192439
  mo_energy =
[-0.90458263  1.60779235  7.59076491 18.12876507 36.07792995 61.44339087]
E1 = -3.8660907260923225  E_coul = 1.0284631139132925
cycle= 9 E= -2.83762761217903  delta_E= -2.64e-07  |g|= 1.19e-05  |ddm|= 0.129
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90458256282393  LUMO = 1.60779175789625
  mo_energy =
[-0.90458256  1.60779176  7.59076118 18.12875898 36.07792811 61.44342019]
E1 = -3.866090792562188  E_coul = 1.028463931579573
cycle= 10 E= -2.83762686098262  delta_E= 7.51e-07  |g|= 5.5e-05  |ddm|= 0.503
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582411728568  LUMO = 1.60779296731867
  mo_energy =
[-0.90458241  1.60779297  7.59076679 18.12878087 36.07796561 61.44351869]
E1 = -3.866090692946673  E_coul = 1.0284627022469177
cycle= 11 E= -2.83762799069976  delta_E= -1.13e-06  |g|= 6e-05  |ddm|=  1.6
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582456130647  LUMO = 1.60779124794345
  mo_energy =
[-0.90458246  1.60779125  7.59075808 18.12875001 36.07791628 61.44341072]
E1 = -3.866090871687703  E_coul = 1.0284632813818828
cycle= 12 E= -2.83762759030582  delta_E= 4e-07  |g|= 1.26e-05  |ddm|= 2.41
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582187277257  LUMO = 1.60778673635366
  mo_energy =
[-0.90458219  1.60778674  7.59073424 18.12865975 36.07776695 61.44307954]
E1 = -3.866091456002944  E_coul = 1.028464647553948
cycle= 13 E= -2.837626808449  delta_E= 7.82e-07  |g|= 8.11e-05  |ddm|= 7.51
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904581464677467  LUMO = 1.60779782394056
  mo_energy =
[-0.90458146  1.60779782  7.59079064 18.12885274 36.07807604 61.44374629]
E1 = -3.8660904513699865  E_coul = 1.028461584509504
cycle= 14 E= -2.83762886686048  delta_E= -2.06e-06  |g|= 0.000147  |ddm|= 14.1
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582575370493  LUMO = 1.60778130162799
  mo_energy =
[-0.90458258  1.6077813   7.59070406 18.12857917 36.07765735 61.44298374]
E1 = -3.866091860993363  E_coul = 1.0284627365398618
cycle= 15 E= -2.8376291244535  delta_E= -2.58e-07  |g|= 0.000117  |ddm|= 19.2
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582647095785  LUMO = 1.60777953666776
  mo_energy =
[-0.90458265  1.60777954  7.59069518 18.12854654 36.07760305 61.44285275]
E1 = -3.866092038801598  E_coul = 1.0284653909836579
cycle= 16 E= -2.83762664781794  delta_E= 2.48e-06  |g|= 0.000121  |ddm|=  2.5
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582620118582  LUMO = 1.6077799374532
  mo_energy =
[-0.90458262  1.60777994  7.59069724 18.12855284 36.07761217 61.44286899]
E1 = -3.8660920043892673  E_coul = 1.028464035148753
cycle= 17 E= -2.83762796924051  delta_E= -1.32e-06  |g|= 1.29e-05  |ddm|= 0.456
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582606662242  LUMO = 1.60777968395908
  mo_energy =
[-0.90458261  1.60777968  7.59069585 18.12854768 36.07760344 61.44285044]
E1 = -3.866092035787757  E_coul = 1.0284624298883465
cycle= 18 E= -2.83762960589941  delta_E= -1.64e-06  |g|= 0.000155  |ddm|= 0.409
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582691332993  LUMO = 1.60777764933793
  mo_energy =
[-0.90458269  1.60777765  7.5906856  18.12851048 36.07754228 61.44270669]
E1 = -3.866092239561902  E_coul = 1.028464873147265
cycle= 19 E= -2.83762736641464  delta_E= 2.24e-06  |g|= 7.5e-05  |ddm|= 2.85
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582618943781  LUMO = 1.60777794095666
  mo_energy =
[-0.90458262  1.60777794  7.59068673 18.12851534 36.07755052 61.44272699]
E1 = -3.8660922227580263  E_coul = 1.02846289068851
cycle= 20 E= -2.83762933206952  delta_E= -1.97e-06  |g|= 0.00012  |ddm|= 0.341
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582697671465  LUMO = 1.60777550149109
  mo_energy =
[-0.9045827   1.6077755   7.59067443 18.12847    36.0774758  61.44255199]
E1 = -3.866092474542774  E_coul = 1.0284646711119663
cycle= 21 E= -2.83762780343081  delta_E= 1.53e-06  |g|= 3.68e-05  |ddm|= 3.51
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904583093134294  LUMO = 1.60776769097034
  mo_energy =
[-0.90458309  1.60776769  7.59063384 18.12833792 36.07727154 61.44214791]
E1 = -3.86609319281017  E_coul = 1.0284657590270856
cycle= 22 E= -2.83762743378308  delta_E= 3.7e-07  |g|= 0.000116  |ddm|= 9.69
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904585378325009  LUMO = 1.60773534469146
  mo_energy =
[-0.90458538  1.60773534  7.5904828  18.12772516 36.07620539 61.43914677]
E1 = -3.8660964174130252  E_coul = 1.0284717372013334
cycle= 23 E= -2.83762468021169  delta_E= 2.75e-06  |g|= 0.000561  |ddm|= 48.6
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904583650379234  LUMO = 1.60776042125905
  mo_energy =
[-0.90458365  1.60776042  7.59060133 18.12819565 36.07701883 61.44137341]
E1 = -3.8660939430934254  E_coul = 1.0284672651703346
cycle= 24 E= -2.83762667792309  delta_E= -2e-06  |g|= 0.000218  |ddm|=   37
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904583922468281  LUMO = 1.60775443620027
  mo_energy =
[-0.90458392  1.60775444  7.59057031 18.1280957  36.0768676  61.44108142]
E1 = -3.8660945015704704  E_coul = 1.0284673965605653
cycle= 25 E= -2.83762710500991  delta_E= -4.27e-07  |g|= 0.000202  |ddm|= 7.42
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904583992822902  LUMO = 1.60775298403226
  mo_energy =
[-0.90458399  1.60775298  7.59056381 18.12806187 36.07680204 61.44087508]
E1 = -3.866094671723773  E_coul = 1.0284676241924164
cycle= 26 E= -2.83762704753136  delta_E= 5.75e-08  |g|= 0.000225  |ddm|= 2.75
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904583549190984  LUMO = 1.60776043896401
  mo_energy =
[-0.90458355  1.60776044  7.59060124 18.12819471 36.07701899 61.44137704]
E1 = -3.8660939689385914  E_coul = 1.028465253979315
cycle= 27 E= -2.83762871495928  delta_E= -1.67e-06  |g|= 4.21e-05  |ddm|= 9.98
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904584073582704  LUMO = 1.60774964204799
  mo_energy =
[-0.90458407  1.60774964  7.59054641 18.12799843 36.07669816 61.44067587]
E1 = -3.8660950124550446  E_coul = 1.028467440594493
cycle= 28 E= -2.83762757186055  delta_E= 1.14e-06  |g|= 0.000203  |ddm|= 14.7
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904583610988329  LUMO = 1.60775746903006
  mo_energy =
[-0.90458361  1.60775747  7.59058554 18.12813986 36.07692867 61.44119183]
E1 = -3.866094268755357  E_coul = 1.0284672094231904
cycle= 29 E= -2.83762705933217  delta_E= 5.13e-07  |g|= 0.000205  |ddm|= 10.6
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904583866417591  LUMO = 1.60774923475517
  mo_energy =
[-0.90458387  1.60774923  7.5905408  18.12800468 36.07673378 61.440929  ]
E1 = -3.8660950266222187  E_coul = 1.0284681695764908
cycle= 30 E= -2.83762685704573  delta_E= 2.02e-07  |g|= 0.000254  |ddm|= 9.57
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904584384782014  LUMO = 1.607738650587
  mo_energy =
[-0.90458438  1.60773865  7.5904904  18.12780434 36.07638856 61.43999073]
E1 = -3.8660961305824437  E_coul = 1.0284653833638906
cycle= 31 E= -2.83763074721855  delta_E= -3.89e-06  |g|= 4.08e-05  |ddm|= 16.1
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904578013646048  LUMO = 1.60787316766958
  mo_energy =
[-0.90457801  1.60787317  7.59117647 18.13015031 36.08010701 61.44799188]
E1 = -3.8660832593522274  E_coul = 1.0284553140061843
cycle= 32 E= -2.83762794534604  delta_E= 2.8e-06  |g|= 0.000421  |ddm|=  176
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582256903904  LUMO = 1.60778438697346
  mo_energy =
[-0.90458226  1.60778439  7.59072135 18.12861721 36.07770001 61.44296349]
E1 = -3.8660916718869234  E_coul = 1.028462711201658
cycle= 33 E= -2.83762896068527  delta_E= -1.02e-06  |g|= 0.000104  |ddm|=  115
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582483408777  LUMO = 1.60777978643799
  mo_energy =
[-0.90458248  1.60777979  7.59069759 18.12854    36.07758134 61.44272014]
E1 = -3.866092098827862  E_coul = 1.0284655894062675
cycle= 34 E= -2.83762650942159  delta_E= 2.45e-06  |g|= 0.000151  |ddm|= 5.73
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582377784422  LUMO = 1.60778149817014
  mo_energy =
[-0.90458238  1.6077815   7.59070574 18.12857443 36.07764288 61.44289189]
E1 = -3.8660919238817466  E_coul = 1.0284634104703752
cycle= 35 E= -2.83762851341137  delta_E= -2e-06  |g|= 6.04e-05  |ddm|= 2.68
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582382579184  LUMO = 1.60778171260525
  mo_energy =
[-0.90458238  1.60778171  7.59070713 18.12857424 36.07763666 61.44285452]
E1 = -3.8660919113160985  E_coul = 1.0284611952033125
cycle= 36 E= -2.83763071611279  delta_E= -2.2e-06  |g|= 0.000253  |ddm|= 0.0359
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582766375588  LUMO = 1.60777425637226
  mo_energy =
[-0.90458277  1.60777426  7.5906692  18.12844206 36.07742535 61.44239479]
E1 = -3.8660926198825556  E_coul = 1.02846540150261
cycle= 37 E= -2.83762721837995  delta_E= 3.5e-06  |g|= 9.79e-05  |ddm|= 9.85
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582800830801  LUMO = 1.60777406679939
  mo_energy =
[-0.9045828   1.60777407  7.59066839 18.12843728 36.07741549 61.44236043]
E1 = -3.866092637501716  E_coul = 1.028467074693071
cycle= 38 E= -2.83762556280865  delta_E= 1.66e-06  |g|= 0.000256  |ddm|= 0.362
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582667840823  LUMO = 1.6077770002086
  mo_energy =
[-0.90458267  1.607777    7.59068353 18.12848987 36.07749973 61.44254097]
E1 = -3.8660923557379006  E_coul = 1.0284642710213803
cycle= 39 E= -2.83762808471652  delta_E= -2.52e-06  |g|= 2.79e-05  |ddm|=  3.9
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582419912  LUMO = 1.6077824564467
  mo_energy =
[-0.90458242  1.60778246  7.59071116 18.12859157 36.07766853 61.44292839]
E1 = -3.866091817201588  E_coul = 1.028464273584109
cycle= 40 E= -2.83762754361748  delta_E= 5.41e-07  |g|= 3.85e-05  |ddm|= 7.65
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904584943786752  LUMO = 1.60773211741458
  mo_energy =
[-0.90458494  1.60773212  7.59045321 18.1277059  36.07626258 61.43997102]
E1 = -3.8660965703895345  E_coul = 1.0284702262613816
cycle= 41 E= -2.83762634412815  delta_E= 1.2e-06  |g|= 0.000371  |ddm|= 65.6
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582684999993  LUMO = 1.60777573002865
  mo_energy =
[-0.90458268  1.60777573  7.59067476 18.12848588 36.07752155 61.44273568]
E1 = -3.8660924179201044  E_coul = 1.0284647571803107
cycle= 42 E= -2.83762766073979  delta_E= -1.32e-06  |g|= 4.27e-05  |ddm|= 58.1
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90458297117241  LUMO = 1.60777090649545
  mo_energy =
[-0.90458297  1.60777091  7.5906512  18.12839598 36.07736972 61.44234199]
E1 = -3.8660928933321155  E_coul = 1.0284629116573256
cycle= 43 E= -2.83762998167479  delta_E= -2.32e-06  |g|= 0.00014  |ddm|= 6.94
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904583161225834  LUMO = 1.60776697920363
  mo_energy =
[-0.90458316  1.60776698  7.59063082 18.12833655 36.07728802 61.44220301]
E1 = -3.8660932476388625  E_coul = 1.028467901903954
cycle= 44 E= -2.83762534573491  delta_E= 4.64e-06  |g|= 0.000305  |ddm|= 4.46
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582225818554  LUMO = 1.60778514364552
  mo_energy =
[-0.90458223  1.60778514  7.59072302 18.12865368 36.07779105 61.44329361]
E1 = -3.8660915252514036  E_coul = 1.0284654919246563
cycle= 45 E= -2.83762603332675  delta_E= -6.88e-07  |g|= 0.000156  |ddm|= 23.8
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904581845250269  LUMO = 1.60779258079085
  mo_energy =
[-0.90458185  1.60779258  7.59076027 18.1287847  36.07800089 61.44379113]
E1 = -3.8660908043344318  E_coul = 1.028463475204583
cycle= 46 E= -2.83762732912985  delta_E= -1.3e-06  |g|= 1.81e-05  |ddm|= 10.1
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904582075809857  LUMO = 1.60778908838699
  mo_energy =
[-0.90458208  1.60778909  7.59074335 18.12871391 36.077874   61.44344713]
E1 = -3.8660911541831813  E_coul = 1.0284644766183755
cycle= 47 E= -2.83762667756481  delta_E= 6.52e-07  |g|= 7.32e-05  |ddm|= 5.39
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904581790834972  LUMO = 1.60779515066444
  mo_energy =
[-0.90458179  1.60779515  7.59077538 18.12880804 36.07800629 61.44364927]
E1 = -3.86609061352313  E_coul = 1.0284634276748454
cycle= 48 E= -2.83762718584828  delta_E= -5.08e-07  |g|= 7.5e-06  |ddm|= 6.85
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904581712600226  LUMO = 1.60779713883122
  mo_energy =
[-0.90458171  1.60779714  7.59078662 18.12883783 36.07804405 61.44367272]
E1 = -3.86609044798804  E_coul = 1.028464220204516
cycle= 49 E= -2.83762622778352  delta_E= 9.58e-07  |g|= 8.97e-05  |ddm|= 1.95
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904581356927072  LUMO = 1.60780377500217
  mo_energy =
[-0.90458136  1.60780378  7.59082062 18.12895326 36.07822612 61.44405999]
E1 = -3.8660898276217535  E_coul = 1.0284629122596938
cycle= 50 E= -2.83762691536206  delta_E= -6.88e-07  |g|= 2.91e-06  |ddm|= 8.54
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8660898276217535  E_coul = 1.0284629122596938

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904582001574899  LUMO = 1.60780100735181
  mo_energy =
[-0.904582    1.60780101  7.59080619 18.1289362  36.07823042 61.44420357]
E1 = -3.866089881204405  E_coul = 1.028463401441349
Extra cycle  E= -2.83762647976306  delta_E= 4.36e-07  |g|= 2.99e-05  |ddm|= 0.335
    CPU time for scf_cycle      0.50 sec, wall time      0.50 sec
exp = [6.35275512 5.60118926 4.93088896 4.23395146 3.82911526 0.37804125]
E = -2.837626479763056
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:01 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.32478917604        1
[INPUT] 0    0    [1    /1   ]  5.57655286554        1
[INPUT] 0    0    [1    /1   ]  4.90921679584        1
[INPUT] 0    0    [1    /1   ]  4.21636363859        1
[INPUT] 0    0    [1    /1   ]  3.81310207603        1
[INPUT] 0    0    [1    /1   ]  0.377612440645       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.324789176037766, 1.0]], [0, [5.576552865538589, 1.0]], [0, [4.909216795837785, 1.0]], [0, [4.216363638592905, 1.0]], [0, [3.813102076028104, 1.0]], [0, [0.3776124406449999, 1.0]]]}
ecp = {}
CPU time:        58.63
Set gradient conv threshold to 3.16228e-05
cond(S) = 980935294.7145513

WARN: Singularity detected in overlap matrix (condition number = 9.81e+08). SCF may be inaccurate and hard to converge.

E1 = -3.856643996730204  E_coul = 1.0242311155224413
init E= -2.83241288120776
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906687660881106  LUMO = 1.59846954790149
  mo_energy =
[-0.90668766  1.59846955  7.5554296  18.04707291 35.91955428 61.17017589]
E1 = -3.866380708055729  E_coul = 1.0287566872772462
cycle= 1 E= -2.83762402077848  delta_E= -0.00521  |g|= 0.00605  |ddm|= 1.02e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904434562230602  LUMO = 1.60237904125853
  mo_energy =
[-0.90443456  1.60237904  7.56014427 18.0513368  35.92345084 61.17164703]
E1 = -3.8661350337678684  E_coul = 1.0285102550354874
cycle= 2 E= -2.83762477873238  delta_E= -7.58e-07  |g|= 0.000398  |ddm|=  672
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904564512134342  LUMO = 1.60234072250014
  mo_energy =
[-0.90456451  1.60234072  7.56003602 18.05141978 35.92374932 61.17314231]
E1 = -3.8661307389544  E_coul = 1.0285065159910085
cycle= 3 E= -2.83762422296339  delta_E= 5.56e-07  |g|= 5.43e-05  |ddm|= 44.8
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904557607965121  LUMO = 1.60235601466389
  mo_energy =
[-0.90455761  1.60235601  7.56009953 18.05164598 35.9241381  61.17411649]
E1 = -3.8661310121676986  E_coul = 1.0285052961164929
cycle= 4 E= -2.83762571605121  delta_E= -1.49e-06  |g|= 0.000149  |ddm|= 13.5
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904560120618967  LUMO = 1.60232710295631
  mo_energy =
[-0.90456012  1.6023271   7.55995599 18.05114839 35.92334353 61.17237235]
E1 = -3.866133487502234  E_coul = 1.0285078720451986
cycle= 5 E= -2.83762561545704  delta_E= 1.01e-07  |g|= 2.12e-05  |ddm|= 36.8
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559537336443  LUMO = 1.60232854473702
  mo_energy =
[-0.90455954  1.60232854  7.559965   18.0511464  35.92330854 61.17207784]
E1 = -3.866133586143483  E_coul = 1.0285086458597847
cycle= 6 E= -2.8376249402837  delta_E= 6.75e-07  |g|= 6.36e-05  |ddm|= 1.72
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559087802996  LUMO = 1.60233266936274
  mo_energy =
[-0.90455909  1.60233267  7.55998523 18.05121906 35.92342894 61.17236159]
E1 = -3.8661332502180574  E_coul = 1.0285085220836852
cycle= 7 E= -2.83762472813437  delta_E= 2.12e-07  |g|= 6.85e-05  |ddm|= 5.18
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558843253549  LUMO = 1.60233570777465
  mo_energy =
[-0.90455884  1.60233571  7.55999997 18.05127539 35.92352436 61.1725919 ]
E1 = -3.866132969672022  E_coul = 1.0285079612744197
cycle= 8 E= -2.8376250083976  delta_E= -2.8e-07  |g|= 2.87e-05  |ddm|= 4.24
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558788114407  LUMO = 1.60233628758738
  mo_energy =
[-0.90455879  1.60233629  7.56000223 18.05128615 35.92354424 61.17267329]
E1 = -3.8661329063499394  E_coul = 1.0285095975172116
cycle= 9 E= -2.83762330883273  delta_E= 1.7e-06  |g|= 0.000165  |ddm|= 1.01
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455847694537  LUMO = 1.60234259907516
  mo_energy =
[-0.90455848  1.6023426   7.56003508 18.05139236 35.9237073  61.17298376]
E1 = -3.866132327776093  E_coul = 1.028507009527075
cycle= 10 E= -2.83762531824902  delta_E= -2.01e-06  |g|= 3.11e-05  |ddm|= 7.82
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558661924679  LUMO = 1.60234111084665
  mo_energy =
[-0.90455866  1.60234111  7.56002692 18.05137634 35.92369365 61.1730162 ]
E1 = -3.866132407209662  E_coul = 1.028509669616803
cycle= 11 E= -2.83762273759286  delta_E= 2.58e-06  |g|= 0.00021  |ddm|= 0.847
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558346967473  LUMO = 1.60234641482064
  mo_energy =
[-0.90455835  1.60234641  7.56005384 18.05146986 35.92384387 61.17333792]
E1 = -3.8661319164813612  E_coul = 1.028506679979179
cycle= 12 E= -2.83762523650218  delta_E= -2.5e-06  |g|= 5.09e-05  |ddm|= 6.95
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455815675709  LUMO = 1.60234924104432
  mo_energy =
[-0.90455816  1.60234924  7.56006721 18.05152172 35.9239311  61.1735662 ]
E1 = -3.8661316374545005  E_coul = 1.0285055752916772
cycle= 13 E= -2.83762606216282  delta_E= -8.26e-07  |g|= 0.000157  |ddm|= 4.12
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558291925347  LUMO = 1.60234691200556
  mo_energy =
[-0.90455829  1.60234691  7.56005601 18.0514751  35.92384804 61.17334131]
E1 = -3.8661318749671016  E_coul = 1.0285071604534404
cycle= 14 E= -2.83762471451366  delta_E= 1.35e-06  |g|= 1.97e-05  |ddm|= 3.63
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557905770297  LUMO = 1.60235362622243
  mo_energy =
[-0.90455791  1.60235363  7.56009014 18.05159386 35.92403973 61.17376016]
E1 = -3.8661312509104664  E_coul = 1.0285051238846197
cycle= 15 E= -2.83762612702585  delta_E= -1.41e-06  |g|= 0.000158  |ddm|= 8.84
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557547861684  LUMO = 1.60236095748595
  mo_energy =
[-0.90455755  1.60236096  7.56012809 18.05171489 35.924223   61.17412319]
E1 = -3.866130576254968  E_coul = 1.0285056446072964
cycle= 16 E= -2.83762493164767  delta_E= 1.2e-06  |g|= 9.57e-05  |ddm|= 9.05
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557499643003  LUMO = 1.60236217832077
  mo_energy =
[-0.9045575   1.60236218  7.56013465 18.0517392  35.92426339 61.17417913]
E1 = -3.8661304603756146  E_coul = 1.028505806041143
cycle= 17 E= -2.83762465433447  delta_E= 2.77e-07  |g|= 7.9e-05  |ddm|= 1.67
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558118640365  LUMO = 1.602349939045
  mo_energy =
[-0.90455812  1.60234994  7.56006974 18.05154229 35.9239735  61.17370001]
E1 = -3.866131539035365  E_coul = 1.0285057458505507
cycle= 18 E= -2.83762579318481  delta_E= -1.14e-06  |g|= 0.000122  |ddm|= 14.1
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558164466292  LUMO = 1.60235005123901
  mo_energy =
[-0.90455816  1.60235005  7.5600703  18.05154557 35.92397853 61.17371184]
E1 = -3.8661315116878945  E_coul = 1.028505372679396
cycle= 19 E= -2.8376261390085  delta_E= -3.46e-07  |g|= 0.000171  |ddm|= 0.343
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559697461753  LUMO = 1.60232176257425
  mo_energy =
[-0.9045597   1.60232176  7.55992774 18.05103499 35.92314165 61.17179804]
E1 = -3.866134216911886  E_coul = 1.028509565499975
cycle= 20 E= -2.83762465141191  delta_E= 1.49e-06  |g|= 0.000107  |ddm|= 38.6
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559007784365  LUMO = 1.60233599676255
  mo_energy =
[-0.90455901  1.602336    7.56000402 18.0512636  35.92347587 61.1723221 ]
E1 = -3.8661329700174507  E_coul = 1.0285068966619004
cycle= 21 E= -2.83762607335555  delta_E= -1.42e-06  |g|= 7.16e-05  |ddm|= 16.2
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559067871408  LUMO = 1.60233442844247
  mo_energy =
[-0.90455907  1.60233443  7.55999596 18.05123684 35.92343566 61.17223753]
E1 = -3.8661331226951887  E_coul = 1.0285108123465792
cycle= 22 E= -2.83762231034861  delta_E= 3.76e-06  |g|= 0.000287  |ddm|= 2.07
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9045585794366  LUMO = 1.60234303062961
  mo_energy =
[-0.90455858  1.60234303  7.56003853 18.05139255 35.92369262 61.17285981]
E1 = -3.8661322878001436  E_coul = 1.0285091381885825
cycle= 23 E= -2.83762314961156  delta_E= -8.39e-07  |g|= 0.000167  |ddm|=   12
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558272280749  LUMO = 1.60234902614427
  mo_energy =
[-0.90455827  1.60234903  7.56006902 18.05149689 35.92385743 61.17322304]
E1 = -3.8661317192270106  E_coul = 1.0285067177052551
cycle= 24 E= -2.83762500152176  delta_E= -1.85e-06  |g|= 3.7e-05  |ddm|=  7.9
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558304563943  LUMO = 1.60234835265876
  mo_energy =
[-0.9045583   1.60234835  7.56006544 18.05148646 35.92384275 61.17320256]
E1 = -3.866131778232557  E_coul = 1.0285064607014847
cycle= 25 E= -2.83762531753107  delta_E= -3.16e-07  |g|= 5.97e-05  |ddm|= 0.753
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558384924381  LUMO = 1.6023467054421
  mo_energy =
[-0.90455838  1.60234671  7.56005682 18.05145895 35.92380129 61.17312821]
E1 = -3.866131928166473  E_coul = 1.0285060382580935
cycle= 26 E= -2.83762588990838  delta_E= -5.72e-07  |g|= 0.000108  |ddm|= 2.01
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558404593055  LUMO = 1.60234642681591
  mo_energy =
[-0.9045584   1.60234643  7.56005598 18.05144974 35.92378052 61.17304877]
E1 = -3.866131971097377  E_coul = 1.028506811856265
cycle= 27 E= -2.83762515924111  delta_E= 7.31e-07  |g|= 4.31e-05  |ddm|= 0.835
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558314482153  LUMO = 1.6023478458244
  mo_energy =
[-0.90455831  1.60234785  7.56006277 18.05147582 35.92382403 61.17316525]
E1 = -3.8661318298550995  E_coul = 1.0285051779776442
cycle= 28 E= -2.83762665187746  delta_E= -1.49e-06  |g|= 0.000185  |ddm|= 2.07
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557816142175  LUMO = 1.60235664239002
  mo_energy =
[-0.90455782  1.60235664  7.56010637 18.05163291 35.92408047 61.17376853]
E1 = -3.8661309813851616  E_coul = 1.0285055918876347
cycle= 29 E= -2.83762538949753  delta_E= 1.26e-06  |g|= 0.000117  |ddm|= 12.1
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557227916637  LUMO = 1.6023676678705
  mo_energy =
[-0.90455723  1.60236767  7.56016128 18.05183578 35.92441621 61.17458184]
E1 = -3.8661299018330064  E_coul = 1.028504925207214
cycle= 30 E= -2.83762497662579  delta_E= 4.13e-07  |g|= 0.000131  |ddm|= 15.6
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558623167405  LUMO = 1.60234192878687
  mo_energy =
[-0.90455862  1.60234193  7.56003301 18.05138445 35.9236913  61.17290329]
E1 = -3.8661323756264467  E_coul = 1.0285114567520004
cycle= 31 E= -2.83762091887445  delta_E= 4.06e-06  |g|= 0.000362  |ddm|= 34.8
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557834696389  LUMO = 1.60235757170802
  mo_energy =
[-0.90455783  1.60235757  7.56011429 18.05164318 35.92408238 61.17361184]
E1 = -3.866130953151152  E_coul = 1.0285072907015769
cycle= 32 E= -2.83762366244957  delta_E= -2.74e-06  |g|= 5.22e-05  |ddm|= 19.1
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557845573673  LUMO = 1.60235738592611
  mo_energy =
[-0.90455785  1.60235739  7.56011347 18.05163788 35.92407125 61.17357033]
E1 = -3.8661309763233733  E_coul = 1.0285063662424903
cycle= 33 E= -2.83762461008088  delta_E= -9.48e-07  |g|= 4.33e-05  |ddm|= 0.424
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455770780481  LUMO = 1.60236018389509
  mo_energy =
[-0.90455771  1.60236018  7.56012771 18.05168685 35.92414857 61.17373704]
E1 = -3.8661307098091235  E_coul = 1.028507543972834
cycle= 34 E= -2.83762316583629  delta_E= 1.44e-06  |g|= 9.05e-05  |ddm|= 3.71
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557189593952  LUMO = 1.60236997907062
  mo_energy =
[-0.90455719  1.60236998  7.56017728 18.05185093 35.92440267 61.17427889]
E1 = -3.8661297935005536  E_coul = 1.028504560576234
cycle= 35 E= -2.83762523292432  delta_E= -2.07e-06  |g|= 0.000144  |ddm|= 12.5
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556553497434  LUMO = 1.60238248294689
  mo_energy =
[-0.90455655  1.60238248  7.56024149 18.05206586 35.92474049 61.1749595 ]
E1 = -3.866128630517767  E_coul = 1.0285032776914884
cycle= 36 E= -2.83762535282628  delta_E= -1.2e-07  |g|= 0.000228  |ddm|=   16
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555654215823  LUMO = 1.60239923351903
  mo_energy =
[-0.90455565  1.60239923  7.56032491 18.0523701  35.92523992 61.176168  ]
E1 = -3.8661269973365355  E_coul = 1.0285032646178687
cycle= 37 E= -2.83762373271867  delta_E= 1.62e-06  |g|= 0.000168  |ddm|= 23.4
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556289273881  LUMO = 1.60238574482916
  mo_energy =
[-0.90455629  1.60238574  7.56025506 18.05214425 35.92489843 61.17552518]
E1 = -3.8661282490062674  E_coul = 1.0285032998621313
cycle= 38 E= -2.83762494914414  delta_E= -1.22e-06  |g|= 0.000207  |ddm|= 16.8
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556115580151  LUMO = 1.60238912540194
  mo_energy =
[-0.90455612  1.60238913  7.56027297 18.05220149 35.92498632 61.17567879]
E1 = -3.8661279470958654  E_coul = 1.0285032014282727
cycle= 39 E= -2.83762474566759  delta_E= 2.03e-07  |g|= 0.000195  |ddm|= 4.07
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557491437916  LUMO = 1.60236142767737
  mo_energy =
[-0.90455749  1.60236143  7.56013096 18.05172853 35.92425346 61.17420228]
E1 = -3.8661305386935845  E_coul = 1.0285039337383897
cycle= 40 E= -2.83762660495519  delta_E= -1.86e-06  |g|= 0.000245  |ddm|= 35.4
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558862443242  LUMO = 1.60233522584133
  mo_energy =
[-0.90455886  1.60233523  7.55999841 18.05128336 35.92355761 61.17266864]
E1 = -3.8661330075068268  E_coul = 1.0285102668810304
cycle= 41 E= -2.8376227406258  delta_E= 3.86e-06  |g|= 0.000224  |ddm|=   34
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557597962464  LUMO = 1.60236101934734
  mo_energy =
[-0.9045576   1.60236102  7.56012978 18.0517205  35.92423412 61.17409727]
E1 = -3.8661305753934223  E_coul = 1.0285070309409219
cycle= 42 E= -2.8376235444525  delta_E= -8.04e-07  |g|= 3.83e-05  |ddm|= 33.2
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557719271  LUMO = 1.60235917114746
  mo_energy =
[-0.90455772  1.60235917  7.56012046 18.05168354 35.92416939 61.17394497]
E1 = -3.866130751970344  E_coul = 1.0285050270240192
cycle= 43 E= -2.83762572494632  delta_E= -2.18e-06  |g|= 0.000156  |ddm|= 2.69
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557996359173  LUMO = 1.60235438039041
  mo_energy =
[-0.904558    1.60235438  7.56009669 18.05159691 35.92402748 61.17360608]
E1 = -3.866131214581902  E_coul = 1.028504415244553
cycle= 44 E= -2.83762679933735  delta_E= -1.07e-06  |g|= 0.000228  |ddm|= 6.66
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558557788744  LUMO = 1.60234352852672
  mo_energy =
[-0.90455856  1.60234353  7.56004151 18.05140561 35.92371987 61.17291033]
E1 = -3.866132243767695  E_coul = 1.0285037242886947
cycle= 45 E= -2.837628519479  delta_E= -1.72e-06  |g|= 0.000331  |ddm|= 14.5
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559338179042  LUMO = 1.60232831295791
  mo_energy =
[-0.90455934  1.60232831  7.55996339 18.05113716 35.92329005 61.17199141]
E1 = -3.866133671611707  E_coul = 1.0285100305792958
cycle= 46 E= -2.83762364103241  delta_E= 4.88e-06  |g|= 0.000191  |ddm|=   20
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455873395876  LUMO = 1.60233985703599
  mo_energy =
[-0.90455873  1.60233986  7.56002194 18.05133904 35.92361151 61.17271412]
E1 = -3.86613257704766  E_coul = 1.0285092922453325
cycle= 47 E= -2.83762328480233  delta_E= 3.56e-07  |g|= 0.000171  |ddm|= 15.3
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455820800393  LUMO = 1.60234970473404
  mo_energy =
[-0.90455821  1.6023497   7.56007158 18.05151848 35.9239069  61.17340053]
E1 = -3.8661316298729553  E_coul = 1.0285069788033345
cycle= 48 E= -2.83762465106962  delta_E= -1.37e-06  |g|= 2.48e-05  |ddm|= 13.6
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455813929252  LUMO = 1.60235122287315
  mo_energy =
[-0.90455814  1.60235122  7.56007977 18.05154025 35.92393483 61.17342384]
E1 = -3.8661315010275557  E_coul = 1.0285058927461823
cycle= 49 E= -2.83762560828137  delta_E= -9.57e-07  |g|= 0.000104  |ddm|= 1.54
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558583903058  LUMO = 1.6023425385132
  mo_energy =
[-0.90455858  1.60234254  7.56003518 18.05139381 35.92370867 61.17296999]
E1 = -3.866132305742793  E_coul = 1.028508363105265
cycle= 50 E= -2.83762394263753  delta_E= 1.67e-06  |g|= 8.25e-05  |ddm|=   11
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.866132305742793  E_coul = 1.028508363105265

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904557789805093  LUMO = 1.60236197699968
  mo_energy =
[-0.90455779  1.60236198  7.5601371  18.05170623 35.92416558 61.17375063]
E1 = -3.8661305168962596  E_coul = 1.0285045138870341
Extra cycle  E= -2.83762600300923  delta_E= -2.06e-06  |g|= 0.000182  |ddm|= 23.2
    CPU time for scf_cycle      0.49 sec, wall time      0.49 sec
exp = [6.32478918 5.57655287 4.9092168  4.21636364 3.81310208 0.37761244]
E = -2.8376260030092255
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:02 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.3218362965         1
[INPUT] 0    0    [1    /1   ]  5.57395154696        1
[INPUT] 0    0    [1    /1   ]  4.90692846639        1
[INPUT] 0    0    [1    /1   ]  4.21450656787        1
[INPUT] 0    0    [1    /1   ]  3.81141126882        1
[INPUT] 0    0    [1    /1   ]  0.377567163478       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.3218362965025054, 1.0]], [0, [5.573951546955005, 1.0]], [0, [4.9069284663907595, 1.0]], [0, [4.214506567869136, 1.0]], [0, [3.8114112688232327, 1.0]], [0, [0.3775671634777538, 1.0]]]}
ecp = {}
CPU time:        59.40
Set gradient conv threshold to 3.16228e-05
cond(S) = 981517652.1094602

WARN: Singularity detected in overlap matrix (condition number = 9.82e+08). SCF may be inaccurate and hard to converge.

E1 = -3.856645224693281  E_coul = 1.0242234793097464
init E= -2.83242174538353
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906695578590923  LUMO = 1.59772977860719
  mo_energy =
[-0.90669558  1.59772978  7.55133257 18.03608643 35.89885    61.13275255]
E1 = -3.8663987978666574  E_coul = 1.0287664010078845
cycle= 1 E= -2.83763239685877  delta_E= -0.00521  |g|= 0.00608  |ddm|= 1.05e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904433903088254  LUMO = 1.60163334935853
  mo_energy =
[-0.9044339   1.60163335  7.55598922 18.04016367 35.90248084 61.13416403]
E1 = -3.8661565306300263  E_coul = 1.0285241562820848
cycle= 2 E= -2.83763237434794  delta_E= 2.25e-08  |g|= 0.000412  |ddm|=  702
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904561222043461  LUMO = 1.60161645724502
  mo_energy =
[-0.90456122  1.60161646  7.55599777 18.04055866 35.9032029  61.13590624]
E1 = -3.866151007432961  E_coul = 1.0285162422698795
cycle= 3 E= -2.83763476516308  delta_E= -2.39e-06  |g|= 0.000247  |ddm|= 27.1
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.90455887474729  LUMO = 1.60156722086398
  mo_energy =
[-0.90455887  1.60156722  7.5557472  18.03957358 35.90153361 61.13169842]
E1 = -3.866157416032905  E_coul = 1.0285246199389129
cycle= 4 E= -2.83763279609399  delta_E= 1.97e-06  |g|= 0.000233  |ddm|=   79
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904553739930906  LUMO = 1.60161571284655
  mo_energy =
[-0.90455374  1.60161571  7.55597937 18.04043251 35.90296107 61.13518614]
E1 = -3.8661533090097056  E_coul = 1.028519832225925
cycle= 5 E= -2.83763347678378  delta_E= -6.81e-07  |g|= 6.04e-05  |ddm|= 62.9
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455561139023  LUMO = 1.60160441827423
  mo_energy =
[-0.90455561  1.60160442  7.55592362 18.04026595 35.90271942 61.1348173 ]
E1 = -3.8661539710052892  E_coul = 1.0285212478249564
cycle= 6 E= -2.83763272318033  delta_E= 7.54e-07  |g|= 4.06e-05  |ddm|= 10.3
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555667681365  LUMO = 1.60160721446997
  mo_energy =
[-0.90455567  1.60160721  7.55593841 18.04031202 35.90278589 61.13493433]
E1 = -3.8661536624733035  E_coul = 1.0285189729874793
cycle= 7 E= -2.83763468948582  delta_E= -1.97e-06  |g|= 0.000159  |ddm|= 3.81
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455625291132  LUMO = 1.60159920040443
  mo_energy =
[-0.90455625  1.6015992   7.55589936 18.04016872 35.90255037 61.13435526]
E1 = -3.866154406855784  E_coul = 1.0285222254118747
cycle= 8 E= -2.83763218144391  delta_E= 2.51e-06  |g|= 0.00012  |ddm|=   11
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556007080643  LUMO = 1.6016037880743
  mo_energy =
[-0.90455601  1.60160379  7.55592231 18.04025145 35.90268536 61.13466385]
E1 = -3.866153965438984  E_coul = 1.028520422397044
cycle= 9 E= -2.83763354304194  delta_E= -1.36e-06  |g|= 2.77e-05  |ddm|= 6.32
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556133582767  LUMO = 1.60160246022187
  mo_energy =
[-0.90455613  1.60160246  7.55591593 18.04022838 35.90264766 61.13457178]
E1 = -3.8661540810857096  E_coul = 1.0285212543709212
cycle= 10 E= -2.83763282671479  delta_E= 7.16e-07  |g|= 3.41e-05  |ddm|= 1.73
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555914899073  LUMO = 1.60160501964554
  mo_energy =
[-0.90455591  1.60160502  7.555929   18.04026707 35.90270297 61.13466472]
E1 = -3.8661538758333145  E_coul = 1.0285202269001463
cycle= 11 E= -2.83763364893317  delta_E= -8.22e-07  |g|= 4.12e-05  |ddm|= 2.76
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555923842895  LUMO = 1.60160456787259
  mo_energy =
[-0.90455592  1.60160457  7.55592669 18.04025843 35.90268832 61.13462955]
E1 = -3.8661539241295673  E_coul = 1.0285225468482444
cycle= 12 E= -2.83763137728132  delta_E= 2.27e-06  |g|= 0.000165  |ddm|= 0.679
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555807222613  LUMO = 1.60161115694143
  mo_energy =
[-0.90455581  1.60161116  7.55596166 18.04036912 35.9028541  61.13492196]
E1 = -3.866153271403478  E_coul = 1.0285199530969098
cycle= 13 E= -2.83763331830657  delta_E= -1.94e-06  |g|= 3.47e-05  |ddm|= 8.45
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455529083936  LUMO = 1.60161918640748
  mo_energy =
[-0.90455529  1.60161919  7.55600095 18.04051654 35.90310048 61.13553642]
E1 = -3.866152502452564  E_coul = 1.0285196523982372
cycle= 14 E= -2.83763285005433  delta_E= 4.68e-07  |g|= 3.3e-05  |ddm|= 11.3
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555550980132  LUMO = 1.60161347591984
  mo_energy =
[-0.90455555  1.60161348  7.55597288 18.04041002 35.90292277 61.13509581]
E1 = -3.8661530833983475  E_coul = 1.0285198376971705
cycle= 15 E= -2.83763324570118  delta_E= -3.96e-07  |g|= 4.77e-05  |ddm|= 8.39
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555506147277  LUMO = 1.60161435744127
  mo_energy =
[-0.90455551  1.60161436  7.55597717 18.04042614 35.90294967 61.13516579]
E1 = -3.8661529945564004  E_coul = 1.0285187712988315
cycle= 16 E= -2.83763422325757  delta_E= -9.78e-07  |g|= 0.000136  |ddm|= 1.29
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555707325514  LUMO = 1.60161106371927
  mo_energy =
[-0.90455571  1.60161106  7.5559619  18.04035689 35.90282412 61.13481351]
E1 = -3.866153344177023  E_coul = 1.0285200879665846
cycle= 17 E= -2.83763325621044  delta_E= 9.67e-07  |g|= 2.39e-05  |ddm|= 5.52
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455547272655  LUMO = 1.60161568414164
  mo_energy =
[-0.90455547  1.60161568  7.55598562 18.04043248 35.9029381  61.13504029]
E1 = -3.8661529185750987  E_coul = 1.0285200759095834
cycle= 18 E= -2.83763284266552  delta_E= 4.14e-07  |g|= 1.05e-05  |ddm|= 5.72
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555574548966  LUMO = 1.60161345487747
  mo_energy =
[-0.90455557  1.60161345  7.55597426 18.04040295 35.90290027 61.13499281]
E1 = -3.866153118748017  E_coul = 1.0285201123270504
cycle= 19 E= -2.83763300642097  delta_E= -1.64e-07  |g|= 1.69e-05  |ddm|= 2.39
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554930091661  LUMO = 1.60162636642652
  mo_energy =
[-0.90455493  1.60162637  7.55604048 18.04063079 35.90326426 61.13577493]
E1 = -3.866151898939263  E_coul = 1.0285210815621162
cycle= 20 E= -2.83763081737715  delta_E= 2.19e-06  |g|= 0.000123  |ddm|= 17.1
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558277072055  LUMO = 1.60156229085512
  mo_energy =
[-0.90455828  1.60156229  7.55571099 18.03953323 35.90154882 61.13222862]
E1 = -3.8661578283561724  E_coul = 1.0285233348522143
cycle= 21 E= -2.83763449350396  delta_E= -3.68e-06  |g|= 8.1e-05  |ddm|= 81.9
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556288004641  LUMO = 1.60159851320819
  mo_energy =
[-0.90455629  1.60159851  7.55589569 18.04016953 35.9025672  61.13439834]
E1 = -3.866154451501539  E_coul = 1.0285235569968294
cycle= 22 E= -2.83763089450471  delta_E= 3.6e-06  |g|= 0.000232  |ddm|= 47.6
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555881718647  LUMO = 1.60160646355676
  mo_energy =
[-0.90455588  1.60160646  7.55593679 18.04030278 35.90277129 61.13480996]
E1 = -3.8661537211327652  E_coul = 1.0285214231714173
cycle= 23 E= -2.83763229796135  delta_E= -1.4e-06  |g|= 6.71e-05  |ddm|= 9.94
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555746221219  LUMO = 1.60160904213685
  mo_energy =
[-0.90455575  1.60160904  7.5559498  18.04034532 35.90283658 61.13495215]
E1 = -3.866153480070012  E_coul = 1.0285209858108222
cycle= 24 E= -2.83763249425919  delta_E= -1.96e-07  |g|= 4.79e-05  |ddm|= 3.29
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555537922962  LUMO = 1.60161281931821
  mo_energy =
[-0.90455554  1.60161282  7.55596855 18.0404133  35.90294833 61.13522407]
E1 = -3.8661531145339003  E_coul = 1.028520250829971
cycle= 25 E= -2.83763286370393  delta_E= -3.69e-07  |g|= 9.05e-06  |ddm|= 5.26
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555508595332  LUMO = 1.60161365308842
  mo_energy =
[-0.90455551  1.60161365  7.55597286 18.04042923 35.90297462 61.13528105]
E1 = -3.866153031412927  E_coul = 1.028520009575796
cycle= 26 E= -2.83763302183713  delta_E= -1.58e-07  |g|= 3.64e-05  |ddm|= 1.19
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555531207398  LUMO = 1.60161352645986
  mo_energy =
[-0.90455553  1.60161353  7.55597245 18.04042558 35.90296587 61.13524763]
E1 = -3.8661530455842446  E_coul = 1.0285197885466697
cycle= 27 E= -2.83763325703757  delta_E= -2.35e-07  |g|= 4.47e-05  |ddm|= 0.303
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555569861646  LUMO = 1.60161296500318
  mo_energy =
[-0.90455557  1.60161297  7.55596925 18.04041889 35.90295939 61.13526089]
E1 = -3.866153084845659  E_coul = 1.0285193020066856
cycle= 28 E= -2.83763378283897  delta_E= -5.26e-07  |g|= 9.65e-05  |ddm|= 0.403
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555819843704  LUMO = 1.60160840014352
  mo_energy =
[-0.90455582  1.6016084   7.55594607 18.04033875 35.90283085 61.13497811]
E1 = -3.8661535135010374  E_coul = 1.028522933141541
cycle= 29 E= -2.8376305803595  delta_E= 3.2e-06  |g|= 0.00022  |ddm|= 6.04
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553677504518  LUMO = 1.60165002737495
  mo_energy =
[-0.90455368  1.60165003  7.55615928 18.04104339 35.90392359 61.13728741]
E1 = -3.8661496386895706  E_coul = 1.0285167891569347
cycle= 30 E= -2.83763284953264  delta_E= -2.27e-06  |g|= 0.000178  |ddm|= 53.2
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555290391438  LUMO = 1.60161856551192
  mo_energy =
[-0.90455529  1.60161857  7.55599707 18.04051884 35.90312018 61.13563815]
E1 = -3.8661525375046666  E_coul = 1.0285191481116687
cycle= 31 E= -2.837633389393  delta_E= -5.4e-07  |g|= 9.8e-05  |ddm|= 39.4
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555433258257  LUMO = 1.60161598435853
  mo_energy =
[-0.90455543  1.60161598  7.5559839  18.04047672 35.90305607 61.13550534]
E1 = -3.866152772812567  E_coul = 1.0285179698780909
cycle= 32 E= -2.83763480293448  delta_E= -1.41e-06  |g|= 0.000205  |ddm|= 3.19
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555777276648  LUMO = 1.6016095977416
  mo_energy =
[-0.90455578  1.6016096   7.55595192 18.04036246 35.90287006 61.13505158]
E1 = -3.8661533883179438  E_coul = 1.0285218435693373
cycle= 33 E= -2.83763154474861  delta_E= 3.26e-06  |g|= 0.000124  |ddm|= 8.79
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555455756841  LUMO = 1.60161566745831
  mo_energy =
[-0.90455546  1.60161567  7.55598311 18.04046355 35.90302494 61.13536941]
E1 = -3.8661528302866426  E_coul = 1.0285233725243264
cycle= 34 E= -2.83762945776232  delta_E= 2.09e-06  |g|= 0.000292  |ddm|=  7.6
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554879682735  LUMO = 1.60162648724888
  mo_energy =
[-0.90455488  1.60162649  7.55603764 18.04065512 35.90333389 61.13607109]
E1 = -3.8661517996144545  E_coul = 1.0285185914749908
cycle= 35 E= -2.83763320813946  delta_E= -3.75e-06  |g|= 0.000102  |ddm|= 14.6
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554671299194  LUMO = 1.6016306420637
  mo_energy =
[-0.90455467  1.60163064  7.55605925 18.04072269 35.90343473 61.13625621]
E1 = -3.8661514224540636  E_coul = 1.0285202553146164
cycle= 36 E= -2.83763116713945  delta_E= 2.04e-06  |g|= 6.08e-05  |ddm|= 5.02
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554225906254  LUMO = 1.601638949864
  mo_energy =
[-0.90455423  1.60163895  7.55610106 18.04086788 35.90366683 61.1367753 ]
E1 = -3.866150633658434  E_coul = 1.028518710571015
cycle= 37 E= -2.83763192308742  delta_E= -7.56e-07  |g|= 5.98e-05  |ddm|= 11.1
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554859478352  LUMO = 1.60162648144836
  mo_energy =
[-0.90455486  1.60162648  7.55603723 18.04065758 35.90334115 61.13610971]
E1 = -3.866151793369377  E_coul = 1.028521310958563
cycle= 38 E= -2.83763048241081  delta_E= 1.44e-06  |g|= 0.000142  |ddm|= 15.8
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555145090216  LUMO = 1.60162035054128
  mo_energy =
[-0.90455515  1.60162035  7.55600527 18.04056444 35.90321219 61.13588471]
E1 = -3.866152346836525  E_coul = 1.028519741904665
cycle= 39 E= -2.83763260493186  delta_E= -2.12e-06  |g|= 4e-05  |ddm|= 7.06
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554853978596  LUMO = 1.60162567321071
  mo_energy =
[-0.90455485  1.60162567  7.55603227 18.04066462 35.90338276 61.1362872 ]
E1 = -3.866151838726699  E_coul = 1.0285203354784054
cycle= 40 E= -2.83763150324829  delta_E= 1.1e-06  |g|= 4.12e-05  |ddm|= 7.47
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553460893107  LUMO = 1.60165298732472
  mo_energy =
[-0.90455346  1.60165299  7.55617307 18.04113663 35.90412293 61.1377904 ]
E1 = -3.8661493006396794  E_coul = 1.0285165071887121
cycle= 41 E= -2.83763279345097  delta_E= -1.29e-06  |g|= 0.000196  |ddm|= 35.1
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904552901140287  LUMO = 1.60166526458232
  mo_energy =
[-0.9045529   1.60166526  7.556237   18.04131702 35.90436583 61.13819312]
E1 = -3.866148203614192  E_coul = 1.0285146561567633
cycle= 42 E= -2.83763354745743  delta_E= -7.54e-07  |g|= 0.000323  |ddm|= 13.7
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553717277084  LUMO = 1.60164982631793
  mo_energy =
[-0.90455372  1.60164983  7.55615851 18.04105487 35.90396153 61.1373814 ]
E1 = -3.8661496456190263  E_coul = 1.0285166040764524
cycle= 43 E= -2.83763304154257  delta_E= 5.06e-07  |g|= 0.000205  |ddm|= 19.8
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553129017036  LUMO = 1.60166174935876
  mo_energy =
[-0.90455313  1.60166175  7.55622067 18.04125248 35.90425995 61.13794628]
E1 = -3.86614855744368  E_coul = 1.0285177701085004
cycle= 44 E= -2.83763078733518  delta_E= 2.25e-06  |g|= 3.86e-05  |ddm|= 14.6
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553967817427  LUMO = 1.60164546623157
  mo_energy =
[-0.90455397  1.60164547  7.55613751 18.04095968 35.9037862  61.13688095]
E1 = -3.8661501034681076  E_coul = 1.0285182689150323
cycle= 45 E= -2.83763183455308  delta_E= -1.05e-06  |g|= 6.31e-05  |ddm|= 21.9
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553954569586  LUMO = 1.60164554283344
  mo_energy =
[-0.90455395  1.60164554  7.55613811 18.04096883 35.90381002 61.13693751]
E1 = -3.8661500932376915  E_coul = 1.0285161483570948
cycle= 46 E= -2.8376339448806  delta_E= -2.11e-06  |g|= 0.000251  |ddm|= 0.471
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555008635602  LUMO = 1.60162614769487
  mo_energy =
[-0.90455501  1.60162615  7.55604126 18.0406193  35.90324012 61.13560113]
E1 = -3.8661519651433585  E_coul = 1.0285200320622987
cycle= 47 E= -2.83763193308106  delta_E= 2.01e-06  |g|= 3.25e-05  |ddm|= 26.8
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904554297548097  LUMO = 1.60163549772582
  mo_energy =
[-0.9045543   1.6016355   7.55608213 18.04081206 35.90359133 61.13667602]
E1 = -3.8661509544019492  E_coul = 1.0285167439770468
cycle= 48 E= -2.8376342104249  delta_E= -2.28e-06  |g|= 0.000251  |ddm|= 16.1
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556172521595  LUMO = 1.60160014560947
  mo_energy =
[-0.90455617  1.60160015  7.55590499 18.04019551 35.90260466 61.13441248]
E1 = -3.8661543301670083  E_coul = 1.0285205060987812
cycle= 49 E= -2.83763382406823  delta_E= 3.86e-07  |g|= 4.27e-05  |ddm|= 47.5
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556503046744  LUMO = 1.60159493561414
  mo_energy =
[-0.9045565   1.60159494  7.55587878 18.04009088 35.90242032 61.13400066]
E1 = -3.8661548288495626  E_coul = 1.028521845035112
cycle= 50 E= -2.83763298381445  delta_E= 8.4e-07  |g|= 7.27e-05  |ddm|= 7.62
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8661548288495626  E_coul = 1.028521845035112

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904555569428231  LUMO = 1.60160730276248
  mo_energy =
[-0.90455557  1.6016073   7.55593651 18.04031019 35.90278797 61.13509354]
E1 = -3.8661536294638825  E_coul = 1.0285208783525628
Extra cycle  E= -2.83763275111132  delta_E= 2.33e-07  |g|= 1.81e-05  |ddm|= 17.9
    CPU time for scf_cycle      0.50 sec, wall time      0.50 sec
exp = [6.3218363  5.57395155 4.90692847 4.21450657 3.81141127 0.37756716]
E = -2.83763275111132
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:03 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.32154100855        1
[INPUT] 0    0    [1    /1   ]  5.5736914151         1
[INPUT] 0    0    [1    /1   ]  4.90669963345        1
[INPUT] 0    0    [1    /1   ]  4.2143208608         1
[INPUT] 0    0    [1    /1   ]  3.8112421881         1
[INPUT] 0    0    [1    /1   ]  0.377562635761       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.32154100854898, 1.0]], [0, [5.573691415096646, 1.0]], [0, [4.906699633446057, 1.0]], [0, [4.214320860796759, 1.0]], [0, [3.811242188102746, 1.0]], [0, [0.3775626357610292, 1.0]]]}
ecp = {}
CPU time:        60.17
Set gradient conv threshold to 3.16228e-05
cond(S) = 981575835.8045877

WARN: Singularity detected in overlap matrix (condition number = 9.82e+08). SCF may be inaccurate and hard to converge.

E1 = -3.856645345054704  E_coul = 1.024235590829698
init E= -2.83240975422501
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906682718075037  LUMO = 1.59791755191191
  mo_energy =
[-0.90668272  1.59791755  7.55226358 18.03964997 35.90430101 61.1455904 ]
E1 = -3.8663758447898333  E_coul = 1.0287606399405669
cycle= 1 E= -2.83761520484927  delta_E= -0.00521  |g|= 0.00606  |ddm|= 1.02e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904428168241142  LUMO = 1.60189134306456
  mo_energy =
[-0.90442817  1.60189134  7.55730459 18.04512228 35.91018372 61.15200663]
E1 = -3.866124108255734  E_coul = 1.0285057634002621
cycle= 2 E= -2.83761834485547  delta_E= -3.14e-06  |g|= 0.00041  |ddm|=  582
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904563844505033  LUMO = 1.60180823613114
  mo_energy =
[-0.90456384  1.60180824  7.55699335 18.04440266 35.90911261 61.14964524]
E1 = -3.8661236124696208  E_coul = 1.0285044767161826
cycle= 3 E= -2.83761913575344  delta_E= -7.91e-07  |g|= 6.67e-05  |ddm|=  105
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904555652565514  LUMO = 1.60179821429894
  mo_energy =
[-0.90455565  1.60179821  7.55692298 18.04413113 35.90868202 61.14873975]
E1 = -3.8661270291906176  E_coul = 1.0285083658602892
cycle= 4 E= -2.83761866333033  delta_E= 4.72e-07  |g|= 5.66e-05  |ddm|=   28
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904555246083441  LUMO = 1.60181011564208
  mo_energy =
[-0.90455525  1.60181012  7.5569821  18.04433857 35.90901354 61.14951843]
E1 = -3.8661258141805224  E_coul = 1.028507068232461
cycle= 5 E= -2.83761874594806  delta_E= -8.26e-08  |g|= 4.37e-06  |ddm|=   16
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555559182906  LUMO = 1.60180938272488
  mo_energy =
[-0.90455556  1.60180938  7.55697975 18.04432665 35.90898934 61.14942251]
E1 = -3.8661258269939376  E_coul = 1.028507238978265
cycle= 6 E= -2.83761858801567  delta_E= 1.58e-07  |g|= 8.15e-06  |ddm|= 0.735
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555607054658  LUMO = 1.60181042222941
  mo_energy =
[-0.90455561  1.60181042  7.55698615 18.04433881 35.9089981  61.14937108]
E1 = -3.866125728625183  E_coul = 1.0285048412275852
cycle= 7 E= -2.8376208873976  delta_E= -2.3e-06  |g|= 0.000199  |ddm|= 0.847
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556196273021  LUMO = 1.60179974674327
  mo_energy =
[-0.9045562   1.60179975  7.5569311  18.04415925 35.90872107 61.14881529]
E1 = -3.86612669915152  E_coul = 1.0285076517167289
cycle= 8 E= -2.83761904743479  delta_E= 1.84e-06  |g|= 1.28e-05  |ddm|= 13.3
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556092472832  LUMO = 1.60180060531836
  mo_energy =
[-0.90455609  1.60180061  7.55693582 18.04417143 35.90873775 61.14883668]
E1 = -3.866126648719325  E_coul = 1.0285098154707977
cycle= 9 E= -2.83761683324853  delta_E= 2.21e-06  |g|= 0.000209  |ddm|= 0.692
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455567336811  LUMO = 1.60180814789747
  mo_energy =
[-0.90455567  1.60180815  7.55697487 18.04429967 35.90893651 61.14922302]
E1 = -3.8661259648614017  E_coul = 1.0285059768098352
cycle= 10 E= -2.83761998805157  delta_E= -3.15e-06  |g|= 0.000107  |ddm|= 9.39
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555798311095  LUMO = 1.60180577635431
  mo_energy =
[-0.9045558   1.60180578  7.55696285 18.04425825 35.90887082 61.14907824]
E1 = -3.8661261890430896  E_coul = 1.0285076617478692
cycle= 11 E= -2.83761852729522  delta_E= 1.46e-06  |g|= 4.47e-05  |ddm|= 3.14
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555712234171  LUMO = 1.60180767536452
  mo_energy =
[-0.90455571  1.60180768  7.55697264 18.04429184 35.90892439 61.14919141]
E1 = -3.8661260071980377  E_coul = 1.0285074406878973
cycle= 12 E= -2.83761856651014  delta_E= -3.92e-08  |g|= 2.07e-05  |ddm|= 2.51
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455564909065  LUMO = 1.60180908445406
  mo_energy =
[-0.90455565  1.60180908  7.55698008 18.04431424 35.90895648 61.14924323]
E1 = -3.8661258806734398  E_coul = 1.0285076049526176
cycle= 13 E= -2.83761827572082  delta_E= 2.91e-07  |g|= 4.91e-05  |ddm|= 1.63
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455562615498  LUMO = 1.6018096486266
  mo_energy =
[-0.90455563  1.60180965  7.55698274 18.04432505 35.90897561 61.14929942]
E1 = -3.866125819337661  E_coul = 1.02850646931542
cycle= 14 E= -2.83761935002224  delta_E= -1.07e-06  |g|= 6.13e-05  |ddm|= 0.899
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555714568065  LUMO = 1.60180799094987
  mo_energy =
[-0.90455571  1.60180799  7.55697419 18.04429676 35.90893195 61.14921499]
E1 = -3.866125971464419  E_coul = 1.0285060012455631
cycle= 15 E= -2.83761997021886  delta_E= -6.2e-07  |g|= 0.000102  |ddm|= 2.09
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555653455827  LUMO = 1.60180905349705
  mo_energy =
[-0.90455565  1.60180905  7.55697945 18.04431517 35.90896197 61.14929045]
E1 = -3.866125870159861  E_coul = 1.028507526608836
cycle= 16 E= -2.83761834355102  delta_E= 1.63e-06  |g|= 3.95e-05  |ddm|= 1.43
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555140518378  LUMO = 1.60181882864137
  mo_energy =
[-0.90455514  1.60181883  7.55702957 18.04448477 35.90922864 61.14983021]
E1 = -3.866124959074185  E_coul = 1.0285072367092054
cycle= 17 E= -2.83761772236498  delta_E= 6.21e-07  |g|= 6.32e-05  |ddm|= 12.6
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556182657664  LUMO = 1.60179830479313
  mo_energy =
[-0.90455618  1.6017983   7.55692368 18.04412462 35.9086577  61.14865349]
E1 = -3.866126876698659  E_coul = 1.0285063400618468
cycle= 18 E= -2.83762053663681  delta_E= -2.81e-06  |g|= 0.000104  |ddm|= 26.7
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556214851182  LUMO = 1.60179692211593
  mo_energy =
[-0.90455621  1.60179692  7.55691549 18.04411625 35.90866612 61.14876389]
E1 = -3.866126971267606  E_coul = 1.0285069425272315
cycle= 19 E= -2.83762002874037  delta_E= 5.08e-07  |g|= 6.37e-05  |ddm|= 0.497
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556244089736  LUMO = 1.60179643692963
  mo_energy =
[-0.90455624  1.60179644  7.55691326 18.04411027 35.90865817 61.14873322]
E1 = -3.866127016494351  E_coul = 1.0285083011717446
cycle= 20 E= -2.83761871532261  delta_E= 1.31e-06  |g|= 6.55e-05  |ddm|= 0.553
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556065170048  LUMO = 1.60179940835031
  mo_energy =
[-0.90455607  1.60179941  7.55692735 18.04416789 35.90875931 61.14901323]
E1 = -3.8661267124192875  E_coul = 1.0285084685036783
cycle= 21 E= -2.83761824391561  delta_E= 4.71e-07  |g|= 8.9e-05  |ddm|=  4.6
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455597165365  LUMO = 1.60180125703826
  mo_energy =
[-0.90455597  1.60180126  7.55693687 18.0442021  35.90881511 61.14912605]
E1 = -3.8661265365424344  E_coul = 1.02850995014748
cycle= 22 E= -2.83761658639495  delta_E= 1.66e-06  |g|= 0.000227  |ddm|= 2.51
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455558513773  LUMO = 1.60180874684848
  mo_energy =
[-0.90455559  1.60180875  7.55697474 18.04433572 35.90903053 61.14961137]
E1 = -3.866125819286093  E_coul = 1.0285062909551401
cycle= 23 E= -2.83761952833095  delta_E= -2.94e-06  |g|= 7.51e-05  |ddm|= 10.1
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555534296243  LUMO = 1.60180989126028
  mo_energy =
[-0.90455553  1.60180989  7.55698073 18.04435899 35.90907058 61.14969774]
E1 = -3.8661257080408573  E_coul = 1.0285079092471208
cycle= 24 E= -2.83761779879374  delta_E= 1.73e-06  |g|= 7.99e-05  |ddm|= 1.67
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555466741765  LUMO = 1.60181147531395
  mo_energy =
[-0.90455547  1.60181148  7.55698905 18.04438942 35.90912154 61.1498142 ]
E1 = -3.8661255547551088  E_coul = 1.028506522443962
cycle= 25 E= -2.83761903231115  delta_E= -1.23e-06  |g|= 5.38e-05  |ddm|= 2.23
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555685151623  LUMO = 1.60180839354425
  mo_energy =
[-0.90455569  1.60180839  7.556975   18.04432764 35.90901049 61.14948385]
E1 = -3.866125877685093  E_coul = 1.0285070027274434
cycle= 26 E= -2.83761887495765  delta_E= 1.57e-07  |g|= 7.69e-06  |ddm|= 5.03
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555565918426  LUMO = 1.60181047825379
  mo_energy =
[-0.90455557  1.60181048  7.55698495 18.04436689 35.90907695 61.14965762]
E1 = -3.8661256657995797  E_coul = 1.0285060065848157
cycle= 27 E= -2.83761965921476  delta_E= -7.84e-07  |g|= 9.56e-05  |ddm|= 3.12
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555507921765  LUMO = 1.60181154991725
  mo_energy =
[-0.90455551  1.60181155  7.55699003 18.04438497 35.90910616 61.14974345]
E1 = -3.866125558151892  E_coul = 1.0285070623275174
cycle= 28 E= -2.83761849582437  delta_E= 1.16e-06  |g|= 1.37e-05  |ddm|= 1.51
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555240792449  LUMO = 1.60181679923528
  mo_energy =
[-0.90455524  1.6018168   7.55701684 18.04447711 35.90925236 61.1500534 ]
E1 = -3.8661250619084275  E_coul = 1.0285062011626709
cycle= 29 E= -2.83761886074576  delta_E= -3.65e-07  |g|= 6.74e-05  |ddm|= 6.91
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555087345709  LUMO = 1.60181989631446
  mo_energy =
[-0.90455509  1.6018199   7.55703216 18.04453389 35.90934571 61.15028507]
E1 = -3.8661247536390224  E_coul = 1.0285080956253103
cycle= 30 E= -2.83761665801371  delta_E= 2.2e-06  |g|= 0.00013  |ddm|= 4.42
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556455456654  LUMO = 1.60179347750627
  mo_energy =
[-0.90455646  1.60179348  7.556897   18.04408828 35.90865787 61.14886257]
E1 = -3.8661272135985305  E_coul = 1.0285088583726991
cycle= 31 E= -2.83761835522583  delta_E= -1.7e-06  |g|= 0.000106  |ddm|= 33.6
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555568790682  LUMO = 1.60181047257673
  mo_energy =
[-0.90455557  1.60181047  7.55698416 18.04437169 35.90909322 61.1497721 ]
E1 = -3.8661256408248783  E_coul = 1.028506985389241
cycle= 32 E= -2.83761865543564  delta_E= -3e-07  |g|= 2.38e-05  |ddm|= 21.4
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555685700992  LUMO = 1.60180839533508
  mo_energy =
[-0.90455569  1.6018084   7.55697377 18.04433013 35.90902066 61.14959729]
E1 = -3.8661258457116943  E_coul = 1.0285081020279823
cycle= 33 E= -2.83761774368371  delta_E= 9.12e-07  |g|= 8.14e-05  |ddm|=  3.1
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555508451052  LUMO = 1.60181169227892
  mo_energy =
[-0.90455551  1.60181169  7.55699054 18.0443865  35.90910947 61.14979199]
E1 = -3.8661255380989807  E_coul = 1.028507027226257
cycle= 34 E= -2.83761851087272  delta_E= -7.67e-07  |g|= 1.14e-05  |ddm|= 4.26
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555468035859  LUMO = 1.60181254478552
  mo_energy =
[-0.90455547  1.60181254  7.55699513 18.04439998 35.90912952 61.14982801]
E1 = -3.8661254633951474  E_coul = 1.028504907776634
cycle= 35 E= -2.83762055561851  delta_E= -2.04e-06  |g|= 0.000185  |ddm|= 0.974
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555523216776  LUMO = 1.6018112547276
  mo_energy =
[-0.90455552  1.60181125  7.55698815 18.04438024 35.90910257 61.14979531]
E1 = -3.8661255758273296  E_coul = 1.0285060284820076
cycle= 36 E= -2.83761954734532  delta_E= 1.01e-06  |g|= 9.67e-05  |ddm|=  1.4
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555650279432  LUMO = 1.60180902419035
  mo_energy =
[-0.90455565  1.60180902  7.55697724 18.04433588 35.90902448 61.14959412]
E1 = -3.866125800153681  E_coul = 1.0285090685183536
cycle= 37 E= -2.83761673163533  delta_E= 2.82e-06  |g|= 0.000177  |ddm|=  3.4
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455538785366  LUMO = 1.60181388194491
  mo_energy =
[-0.90455539  1.60181388  7.5570018  18.04442262 35.90916447 61.14989718]
E1 = -3.866125338035347  E_coul = 1.0285055030979604
cycle= 38 E= -2.83761983493739  delta_E= -3.1e-06  |g|= 0.000126  |ddm|= 6.53
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555518224283  LUMO = 1.60181141334565
  mo_energy =
[-0.90455552  1.60181141  7.55698907 18.04438083 35.90909953 61.14976472]
E1 = -3.866125565089706  E_coul = 1.0285071982531466
cycle= 39 E= -2.83761836683656  delta_E= 1.47e-06  |g|= 2.4e-05  |ddm|= 3.11
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904553146086495  LUMO = 1.60186069766236
  mo_energy =
[-0.90455315  1.6018607   7.55724742 18.0451901  35.91030993 61.15192136]
E1 = -3.8661210929948364  E_coul = 1.0285037176789942
cycle= 40 E= -2.83761737531584  delta_E= 9.92e-07  |g|= 8.87e-05  |ddm|= 59.3
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555799146496  LUMO = 1.6018056249753
  mo_energy =
[-0.9045558   1.60180562  7.55695936 18.04427766 35.9089339  61.14939703]
E1 = -3.8661261172584434  E_coul = 1.0285053159079438
cycle= 41 E= -2.8376208013505  delta_E= -3.43e-06  |g|= 0.000174  |ddm|= 67.1
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556336092585  LUMO = 1.60179488063932
  mo_energy =
[-0.90455634  1.60179488  7.55690356 18.04409672 35.90865593 61.14886018]
E1 = -3.86612710244005  E_coul = 1.0285072832037754
cycle= 42 E= -2.83761981923627  delta_E= 9.82e-07  |g|= 3.57e-05  |ddm|= 13.3
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556428865139  LUMO = 1.60179305717403
  mo_energy =
[-0.90455643  1.60179306  7.55689406 18.04406811 35.90861324 61.14877217]
E1 = -3.8661272656616092  E_coul = 1.028511427700525
cycle= 43 E= -2.83761583796108  delta_E= 3.98e-06  |g|= 0.000336  |ddm|= 2.15
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555563125736  LUMO = 1.60180967323256
  mo_energy =
[-0.90455556  1.60180967  7.5569787  18.04435664 35.90906945 61.14975227]
E1 = -3.866125701386644  E_coul = 1.0285062763012511
cycle= 44 E= -2.83761942508539  delta_E= -3.59e-06  |g|= 7.68e-05  |ddm|= 21.7
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555553041709  LUMO = 1.60180990945768
  mo_energy =
[-0.90455555  1.60180991  7.55697992 18.04436389 35.90908477 61.14979262]
E1 = -3.8661256749724195  E_coul = 1.028505968687125
cycle= 45 E= -2.83761970628529  delta_E= -2.81e-07  |g|= 0.000104  |ddm|= 0.497
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555947801612  LUMO = 1.60180242199288
  mo_energy =
[-0.90455595  1.60180242  7.55694166 18.04423358 35.90887864 61.14935854]
E1 = -3.866126377112534  E_coul = 1.0285053314856203
cycle= 46 E= -2.83762104562691  delta_E= -1.34e-06  |g|= 0.000194  |ddm|= 9.76
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556113077524  LUMO = 1.60179944422799
  mo_energy =
[-0.90455611  1.60179944  7.55692695 18.04417914 35.90878908 61.14914952]
E1 = -3.866126668185421  E_coul = 1.0285069670087637
cycle= 47 E= -2.83761970117666  delta_E= 1.34e-06  |g|= 6.15e-05  |ddm|= 4.19
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455625373346  LUMO = 1.60179729537862
  mo_energy =
[-0.90455625  1.6017973   7.55691702 18.04413704 35.90871393 61.14892232]
E1 = -3.8661268911778777  E_coul = 1.0285066002579215
cycle= 48 E= -2.83762029091996  delta_E= -5.9e-07  |g|= 9.45e-05  |ddm|= 3.43
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557000234701  LUMO = 1.60178326232682
  mo_energy =
[-0.904557    1.60178326  7.55684614 18.04388814 35.90831347 61.1480298 ]
E1 = -3.8661282290309122  E_coul = 1.0285073363116575
cycle= 49 E= -2.83762089271925  delta_E= -6.02e-07  |g|= 9.03e-05  |ddm|= 18.9
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556600032906  LUMO = 1.60179128453596
  mo_energy =
[-0.9045566   1.60179128  7.55688723 18.04402861 35.90853624 61.14849573]
E1 = -3.8661274733456774  E_coul = 1.028506749042872
cycle= 50 E= -2.83762072430281  delta_E= 1.68e-07  |g|= 0.000111  |ddm|= 10.5
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8661274733456774  E_coul = 1.028506749042872

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904556987711793  LUMO = 1.60177140281975
  mo_energy =
[-0.90455699  1.6017714   7.55678484 18.04365513 35.90792429 61.14711184]
E1 = -3.8661295599144103  E_coul = 1.028510917381526
Extra cycle  E= -2.83761864253288  delta_E= 2.08e-06  |g|= 0.0002  |ddm|=   29
    CPU time for scf_cycle      0.49 sec, wall time      0.50 sec
exp = [6.32154101 5.57369142 4.90669963 4.21432086 3.81124219 0.37756264]
E = -2.8376186425328846
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:03 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.32151147975        1
[INPUT] 0    0    [1    /1   ]  5.57366540191        1
[INPUT] 0    0    [1    /1   ]  4.90667675015        1
[INPUT] 0    0    [1    /1   ]  4.21430229009        1
[INPUT] 0    0    [1    /1   ]  3.81122528003        1
[INPUT] 0    0    [1    /1   ]  0.377562182989       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.321511479753627, 1.0]], [0, [5.5736654019108105, 1.0]], [0, [4.906676750151586, 1.0]], [0, [4.214302290089521, 1.0]], [0, [3.811225280030697, 1.0]], [0, [0.3775621829893568, 1.0]]]}
ecp = {}
CPU time:        60.94
Set gradient conv threshold to 3.16228e-05
cond(S) = 981581723.1291282

WARN: Singularity detected in overlap matrix (condition number = 9.82e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8566453570002484  E_coul = 1.0242277264904436
init E= -2.8324176305098
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906691020823906  LUMO = 1.59775884025674
  mo_energy =
[-0.90669102  1.59775884  7.55146377 18.03677777 35.89951554 61.13418179]
E1 = -3.8663907057506477  E_coul = 1.0287660372559853
cycle= 1 E= -2.83762466849466  delta_E= -0.00521  |g|= 0.00607  |ddm|= 1.04e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904430208653048  LUMO = 1.60171577676357
  mo_energy =
[-0.90443021  1.60171578  7.55639638 18.04190838 35.90491637 61.1397977 ]
E1 = -3.866142291612448  E_coul = 1.028513027459435
cycle= 2 E= -2.83762926415301  delta_E= -4.6e-06  |g|= 0.000484  |ddm|=  617
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904565671195869  LUMO = 1.60160429984784
  mo_energy =
[-0.90456567  1.6016043   7.55593413 18.04064264 35.90293809 61.13549398]
E1 = -3.866144941735373  E_coul = 1.028517960194213
cycle= 3 E= -2.83762698154116  delta_E= 2.28e-06  |g|= 0.00023  |ddm|=  148
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904551406176089  LUMO = 1.60166879526317
  mo_energy =
[-0.90455141  1.6016688   7.55622681 18.04170263 35.90471209 61.13994044]
E1 = -3.866141614694849  E_coul = 1.0285153101998723
cycle= 4 E= -2.83762630449498  delta_E= 6.77e-07  |g|= 2.03e-05  |ddm|= 72.6
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904555460441378  LUMO = 1.60166590428436
  mo_energy =
[-0.90455546  1.6016659   7.55622971 18.04165469 35.90456842 61.1392098 ]
E1 = -3.8661410698846153  E_coul = 1.02851413619224
cycle= 5 E= -2.83762693369238  delta_E= -6.29e-07  |g|= 4.63e-05  |ddm|= 0.993
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555825575231  LUMO = 1.60166219117003
  mo_energy =
[-0.90455583  1.60166219  7.5562124  18.04158561 35.9044486  61.13886017]
E1 = -3.8661414036984807  E_coul = 1.0285141401072566
cycle= 6 E= -2.83762726359122  delta_E= -3.3e-07  |g|= 6.35e-05  |ddm|= 5.35
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9045560017809  LUMO = 1.60165918596027
  mo_energy =
[-0.904556    1.60165919  7.55619801 18.04152818 35.90435046 61.13858713]
E1 = -3.8661417065499717  E_coul = 1.0285149104881812
cycle= 7 E= -2.83762679606179  delta_E= 4.68e-07  |g|= 4.31e-06  |ddm|= 4.56
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556001765044  LUMO = 1.60165943147259
  mo_energy =
[-0.904556    1.60165943  7.55619949 18.04152843 35.90434591 61.13856703]
E1 = -3.866141688115808  E_coul = 1.028512902312628
cycle= 8 E= -2.83762878580318  delta_E= -1.99e-06  |g|= 0.000188  |ddm|= 0.0369
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556369228205  LUMO = 1.6016527818173
  mo_energy =
[-0.90455637  1.60165278  7.55616591 18.04140708 35.90414548 61.13811189]
E1 = -3.866142320185275  E_coul = 1.028517149586913
cycle= 9 E= -2.83762517059836  delta_E= 3.62e-06  |g|= 0.000182  |ddm|= 9.13
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555977879033  LUMO = 1.60165885478528
  mo_energy =
[-0.90455598  1.60165885  7.55619665 18.04150925 35.90430433 61.13845643]
E1 = -3.866141771388591  E_coul = 1.0285115131427685
cycle= 10 E= -2.83763025824582  delta_E= -5.09e-06  |g|= 0.000306  |ddm|= 7.65
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556727713814  LUMO = 1.60164552921687
  mo_energy =
[-0.90455673  1.60164553  7.55612903 18.04127193 35.90392065 61.13761762]
E1 = -3.8661430168322766  E_coul = 1.0285148662725423
cycle= 11 E= -2.83762815055973  delta_E= 2.11e-06  |g|= 6.17e-05  |ddm|= 17.8
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556667643987  LUMO = 1.6016448665789
  mo_energy =
[-0.90455667  1.60164487  7.55612584 18.0412561  35.90389184 61.13752879]
E1 = -3.8661431206110723  E_coul = 1.0285168854809064
cycle= 12 E= -2.83762623513017  delta_E= 1.92e-06  |g|= 0.000119  |ddm|= 1.46
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556524260899  LUMO = 1.60164770029253
  mo_energy =
[-0.90455652  1.6016477   7.55614041 18.04130481 35.9039669  61.137673  ]
E1 = -3.866142856062855  E_coul = 1.0285160489747232
cycle= 13 E= -2.83762680708813  delta_E= -5.72e-07  |g|= 6.39e-05  |ddm|= 3.63
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556777781905  LUMO = 1.6016430765705
  mo_energy =
[-0.90455678  1.60164308  7.55611634 18.04122758 35.90385005 61.13746364]
E1 = -3.8661432709438763  E_coul = 1.028514935457852
cycle= 14 E= -2.83762833548602  delta_E= -1.53e-06  |g|= 5.76e-05  |ddm|= 5.62
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557050255611  LUMO = 1.60163785555231
  mo_energy =
[-0.90455705  1.60163786  7.55608884 18.0411376  35.90370939 61.13722046]
E1 = -3.866143738792239  E_coul = 1.0285144022849497
cycle= 15 E= -2.83762933650729  delta_E= -1e-06  |g|= 0.000142  |ddm|= 6.43
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557150802997  LUMO = 1.60163560904785
  mo_energy =
[-0.90455715  1.60163561  7.55607649 18.04110112 35.90365609 61.13715599]
E1 = -3.866143930971954  E_coul = 1.0285163392458843
cycle= 16 E= -2.83762759172607  delta_E= 1.74e-06  |g|= 3.58e-05  |ddm|= 2.49
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556750962413  LUMO = 1.60164243344399
  mo_energy =
[-0.90455675  1.60164243  7.55611027 18.04122523 35.90386315 61.13768005]
E1 = -3.866143272415002  E_coul = 1.0285151469112084
cycle= 17 E= -2.83762812550379  delta_E= -5.34e-07  |g|= 4.15e-05  |ddm|= 9.57
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557804892691  LUMO = 1.60162159838689
  mo_energy =
[-0.9045578   1.6016216   7.55600345 18.0408671  35.90330252 61.13650552]
E1 = -3.8661452219277392  E_coul = 1.0285162193974722
cycle= 18 E= -2.83762900253027  delta_E= -8.77e-07  |g|= 2.43e-05  |ddm|= 26.9
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555601684077  LUMO = 1.6016654559327
  mo_energy =
[-0.9045556   1.60166546  7.55623185 18.04159494 35.90440348 61.13852939]
E1 = -3.8661412310505012  E_coul = 1.028514843234253
cycle= 19 E= -2.83762638781625  delta_E= 2.61e-06  |g|= 1.48e-05  |ddm|= 53.6
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555681902454  LUMO = 1.60166413226478
  mo_energy =
[-0.90455568  1.60166413  7.55622483 18.04157773 35.90438174 61.13851271]
E1 = -3.8661413378930565  E_coul = 1.0285159477634682
cycle= 20 E= -2.83762539012959  delta_E= 9.98e-07  |g|= 0.000125  |ddm|= 1.27
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555611016813  LUMO = 1.6016651645425
  mo_energy =
[-0.90455561  1.60166516  7.55622898 18.04161072 35.90445538 61.13877212]
E1 = -3.8661411992079238  E_coul = 1.0285141783309373
cycle= 21 E= -2.83762702087699  delta_E= -1.63e-06  |g|= 4.37e-05  |ddm|= 2.68
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555939900255  LUMO = 1.60165946929913
  mo_energy =
[-0.90455594  1.60165947  7.55620091 18.0415099  35.90429056 61.13836434]
E1 = -3.8661417484995075  E_coul = 1.0285142226128496
cycle= 22 E= -2.83762752588666  delta_E= -5.05e-07  |g|= 6.43e-05  |ddm|= 7.86
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556031008162  LUMO = 1.60165786646128
  mo_energy =
[-0.90455603  1.60165787  7.5561932  18.04147984 35.90424032 61.13823353]
E1 = -3.866141910531296  E_coul = 1.0285152711874086
cycle= 23 E= -2.83762663934389  delta_E= 8.87e-07  |g|= 3.21e-05  |ddm|= 2.38
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555898243508  LUMO = 1.60166017930376
  mo_energy =
[-0.9045559   1.60166018  7.55620462 18.04152545 35.9043197  61.13843599]
E1 = -3.866141680037297  E_coul = 1.0285149650279475
cycle= 24 E= -2.83762671500935  delta_E= -7.57e-08  |g|= 8.65e-06  |ddm|= 3.48
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455593974123  LUMO = 1.60165932527159
  mo_energy =
[-0.90455594  1.60165933  7.55619999 18.0415097  35.90429449 61.13839593]
E1 = -3.8661417567557708  E_coul = 1.0285153247912449
cycle= 25 E= -2.83762643196453  delta_E= 2.83e-07  |g|= 3.27e-05  |ddm|= 1.08
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555861256034  LUMO = 1.6016610814959
  mo_energy =
[-0.90455586  1.60166108  7.55620965 18.04153604 35.90432945 61.13842785]
E1 = -3.866141608890409  E_coul = 1.0285152462233764
cycle= 26 E= -2.83762636266703  delta_E= 6.93e-08  |g|= 3.61e-05  |ddm|= 1.81
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555798718139  LUMO = 1.60166239755785
  mo_energy =
[-0.9045558   1.6016624   7.55621705 18.04155598 35.90435614 61.13844116]
E1 = -3.866141501318767  E_coul = 1.0285147751350663
cycle= 27 E= -2.8376267261837  delta_E= -3.64e-07  |g|= 1.25e-05  |ddm|= 1.32
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555809702098  LUMO = 1.60166221522064
  mo_energy =
[-0.90455581  1.60166222  7.55621602 18.04155263 35.90435056 61.1384341 ]
E1 = -3.8661415158104946  E_coul = 1.028512706633015
cycle= 28 E= -2.83762880917748  delta_E= -2.08e-06  |g|= 0.000189  |ddm|= 0.208
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555848216349  LUMO = 1.60166140482156
  mo_energy =
[-0.90455585  1.6016614   7.55621175 18.04153949 35.9043313  61.13840185]
E1 = -3.8661415887967805  E_coul = 1.0285146870424153
cycle= 29 E= -2.83762690175437  delta_E= 1.91e-06  |g|= 1.06e-05  |ddm|= 0.962
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555709990108  LUMO = 1.60166456806408
  mo_energy =
[-0.90455571  1.60166457  7.55622877 18.04159308 35.90441253 61.13853908]
E1 = -3.8661413042349118  E_coul = 1.0285135422643061
cycle= 30 E= -2.83762776197061  delta_E= -8.6e-07  |g|= 0.0001  |ddm|= 3.81
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555542580583  LUMO = 1.60166759239703
  mo_energy =
[-0.90455554  1.60166759  7.55624356 18.04164538 35.90449462 61.13872767]
E1 = -3.8661410096248825  E_coul = 1.0285151442454266
cycle= 31 E= -2.83762586537946  delta_E= 1.9e-06  |g|= 5.48e-05  |ddm|= 4.13
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556232615081  LUMO = 1.6016545211297
  mo_energy =
[-0.90455623  1.60165452  7.5561772  18.041412   35.90411602 61.13785364]
E1 = -3.8661422548383633  E_coul = 1.028514090811929
cycle= 32 E= -2.83762816402643  delta_E= -2.3e-06  |g|= 8.32e-05  |ddm|= 17.7
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455659541278  LUMO = 1.60164655561897
  mo_energy =
[-0.9045566   1.60164656  7.55613572 18.04129185 35.90395246 61.13759888]
E1 = -3.8661429740277353  E_coul = 1.0285168718198123
cycle= 33 E= -2.83762610220792  delta_E= 2.06e-06  |g|= 0.000144  |ddm|= 9.08
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556111697716  LUMO = 1.6016548443259
  mo_energy =
[-0.90455611  1.60165484  7.55617551 18.04144543 35.90421107 61.13828457]
E1 = -3.8661421439105057  E_coul = 1.02851302701253
cycle= 34 E= -2.83762911689798  delta_E= -3.01e-06  |g|= 0.000192  |ddm|= 12.2
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556505465397  LUMO = 1.60164747985905
  mo_energy =
[-0.90455651  1.60164748  7.55613823 18.04131932 35.90401375 61.13786466]
E1 = -3.8661428352104457  E_coul = 1.0285169423005194
cycle= 35 E= -2.83762589290993  delta_E= 3.22e-06  |g|= 0.000146  |ddm|= 9.57
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455640231984  LUMO = 1.60164976964838
  mo_energy =
[-0.9045564   1.60164977  7.5561505  18.0413553  35.90406576 61.1379486 ]
E1 = -3.8661426343309295  E_coul = 1.0285151168575388
cycle= 36 E= -2.83762751747339  delta_E= -1.62e-06  |g|= 2.24e-05  |ddm|= 2.59
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556234610333  LUMO = 1.60165325207677
  mo_energy =
[-0.90455623  1.60165325  7.55616878 18.04141187 35.90414942 61.1381039 ]
E1 = -3.866142319024687  E_coul = 1.028516292132038
cycle= 37 E= -2.83762602689265  delta_E= 1.49e-06  |g|= 0.000104  |ddm|= 4.18
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556178199313  LUMO = 1.60165442448912
  mo_energy =
[-0.90455618  1.60165442  7.55617467 18.04143292 35.90418396 61.13818803]
E1 = -3.866142204899204  E_coul = 1.0285156386650383
cycle= 38 E= -2.83762656623417  delta_E= -5.39e-07  |g|= 4.22e-05  |ddm|= 1.62
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555950057272  LUMO = 1.60165892302332
  mo_energy =
[-0.90455595  1.60165892  7.55619812 18.04150548 35.90429147 61.13838274]
E1 = -3.8661417985198603  E_coul = 1.0285155656717286
cycle= 39 E= -2.83762623284813  delta_E= 3.33e-07  |g|= 6.02e-05  |ddm|= 5.39
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556512750462  LUMO = 1.60164841283197
  mo_energy =
[-0.90455651  1.60164841  7.55614576 18.04132464 35.90400436 61.13768573]
E1 = -3.866142806304941  E_coul = 1.0285163362996332
cycle= 40 E= -2.83762647000531  delta_E= -2.37e-07  |g|= 7.84e-05  |ddm|= 14.1
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556215399672  LUMO = 1.60165471286408
  mo_energy =
[-0.90455622  1.60165471  7.55617807 18.04142898 35.90416112 61.13799493]
E1 = -3.8661422163303953  E_coul = 1.0285147012085774
cycle= 41 E= -2.83762751512182  delta_E= -1.05e-06  |g|= 3.23e-05  |ddm|= 7.93
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556274590109  LUMO = 1.60165256717847
  mo_energy =
[-0.90455627  1.60165257  7.55616558 18.04139728 35.90412017 61.13798082]
E1 = -3.8661423909876085  E_coul = 1.0285136404128494
cycle= 42 E= -2.83762875057476  delta_E= -1.24e-06  |g|= 0.000142  |ddm|= 2.02
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556031013753  LUMO = 1.6016571480966
  mo_energy =
[-0.90455603  1.60165715  7.55618885 18.04147184 35.9042318  61.13820861]
E1 = -3.8661419674928137  E_coul = 1.0285166433294202
cycle= 43 E= -2.83762532416339  delta_E= 3.43e-06  |g|= 0.000147  |ddm|= 5.69
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555417829622  LUMO = 1.60166880528079
  mo_energy =
[-0.90455542  1.60166881  7.55624781 18.04167853 35.90456525 61.13896603]
E1 = -3.866140857647572  E_coul = 1.028514828125305
cycle= 44 E= -2.83762602952227  delta_E= -7.05e-07  |g|= 3.48e-05  |ddm|= 15.7
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555563787683  LUMO = 1.60166658468324
  mo_energy =
[-0.90455556  1.60166658  7.55623758 18.04163608 35.90449343 61.13878439]
E1 = -3.8661410860520182  E_coul = 1.0285139089608581
cycle= 45 E= -2.83762717709116  delta_E= -1.15e-06  |g|= 5.74e-05  |ddm|= 3.43
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555802641904  LUMO = 1.60166194936144
  mo_energy =
[-0.9045558   1.60166195  7.55621417 18.04155165 35.90435472 61.13846844]
E1 = -3.866141532907571  E_coul = 1.0285128446271172
cycle= 46 E= -2.83762868828045  delta_E= -1.51e-06  |g|= 0.000171  |ddm|= 6.39
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556083633237  LUMO = 1.60165629708454
  mo_energy =
[-0.90455608  1.6016563   7.55618494 18.04145518 35.90420566 61.1381786 ]
E1 = -3.866142056486264  E_coul = 1.0285139299640118
cycle= 47 E= -2.83762812652225  delta_E= 5.62e-07  |g|= 0.000112  |ddm|= 7.16
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556317160691  LUMO = 1.60165200930931
  mo_energy =
[-0.90455632  1.60165201  7.55616351 18.04137688 35.9040764  61.13787646]
E1 = -3.866142471132389  E_coul = 1.0285175664643402
cycle= 48 E= -2.83762490466805  delta_E= 3.22e-06  |g|= 0.000218  |ddm|= 5.98
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556111561457  LUMO = 1.60165557606124
  mo_energy =
[-0.90455611  1.60165558  7.55618055 18.04144416 35.90419079 61.13817543]
E1 = -3.866142109862482  E_coul = 1.0285143102313214
cycle= 49 E= -2.83762779963116  delta_E= -2.89e-06  |g|= 7.5e-05  |ddm|= 5.35
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556157094696  LUMO = 1.60165502915977
  mo_energy =
[-0.90455616  1.60165503  7.55617828 18.04143284 35.90416985 61.13810433]
E1 = -3.866142171094855  E_coul = 1.0285165242855157
cycle= 50 E= -2.83762564680934  delta_E= 2.15e-06  |g|= 0.000134  |ddm|= 0.994
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.866142171094855  E_coul = 1.0285165242855157

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904554561432702  LUMO = 1.60168305162349
  mo_energy =
[-0.90455456  1.60168305  7.55632103 18.0419239  35.90495938 61.13983653]
E1 = -3.866139572933842  E_coul = 1.0285142788412769
Extra cycle  E= -2.83762529409257  delta_E= 3.53e-07  |g|= 2.67e-05  |ddm|= 36.6
    CPU time for scf_cycle      0.50 sec, wall time      0.50 sec
exp = [6.32151148 5.5736654  4.90667675 4.21430229 3.81122528 0.37756218]
E = -2.8376252940925655
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:04 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.32151147975        1
[INPUT] 0    0    [1    /1   ]  5.57366540191        1
[INPUT] 0    0    [1    /1   ]  4.90667675015        1
[INPUT] 0    0    [1    /1   ]  4.21430229009        1
[INPUT] 0    0    [1    /1   ]  3.81122528003        1
[INPUT] 0    0    [1    /1   ]  0.377562182989       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.321511479753627, 1.0]], [0, [5.5736654019108105, 1.0]], [0, [4.906676750151586, 1.0]], [0, [4.214302290089521, 1.0]], [0, [3.811225280030697, 1.0]], [0, [0.3775621829893568, 1.0]]]}
ecp = {}
CPU time:        61.72
Set gradient conv threshold to 3.16228e-05
cond(S) = 981581723.1291282

WARN: Singularity detected in overlap matrix (condition number = 9.82e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8566453570002484  E_coul = 1.0242277264904436
init E= -2.8324176305098
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906691020823906  LUMO = 1.59775884025674
  mo_energy =
[-0.90669102  1.59775884  7.55146377 18.03677777 35.89951554 61.13418179]
E1 = -3.8663907057506477  E_coul = 1.0287660372559853
cycle= 1 E= -2.83762466849466  delta_E= -0.00521  |g|= 0.00607  |ddm|= 1.04e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904430208653048  LUMO = 1.60171577676357
  mo_energy =
[-0.90443021  1.60171578  7.55639638 18.04190838 35.90491637 61.1397977 ]
E1 = -3.866142291612448  E_coul = 1.028513027459435
cycle= 2 E= -2.83762926415301  delta_E= -4.6e-06  |g|= 0.000484  |ddm|=  617
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904565671195869  LUMO = 1.60160429984784
  mo_energy =
[-0.90456567  1.6016043   7.55593413 18.04064264 35.90293809 61.13549398]
E1 = -3.866144941735373  E_coul = 1.028517960194213
cycle= 3 E= -2.83762698154116  delta_E= 2.28e-06  |g|= 0.00023  |ddm|=  148
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904551406176089  LUMO = 1.60166879526317
  mo_energy =
[-0.90455141  1.6016688   7.55622681 18.04170263 35.90471209 61.13994044]
E1 = -3.866141614694849  E_coul = 1.0285153101998723
cycle= 4 E= -2.83762630449498  delta_E= 6.77e-07  |g|= 2.03e-05  |ddm|= 72.6
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904555460441378  LUMO = 1.60166590428436
  mo_energy =
[-0.90455546  1.6016659   7.55622971 18.04165469 35.90456842 61.1392098 ]
E1 = -3.8661410698846153  E_coul = 1.02851413619224
cycle= 5 E= -2.83762693369238  delta_E= -6.29e-07  |g|= 4.63e-05  |ddm|= 0.993
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555825575231  LUMO = 1.60166219117003
  mo_energy =
[-0.90455583  1.60166219  7.5562124  18.04158561 35.9044486  61.13886017]
E1 = -3.8661414036984807  E_coul = 1.0285141401072566
cycle= 6 E= -2.83762726359122  delta_E= -3.3e-07  |g|= 6.35e-05  |ddm|= 5.35
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9045560017809  LUMO = 1.60165918596027
  mo_energy =
[-0.904556    1.60165919  7.55619801 18.04152818 35.90435046 61.13858713]
E1 = -3.8661417065499717  E_coul = 1.0285149104881812
cycle= 7 E= -2.83762679606179  delta_E= 4.68e-07  |g|= 4.31e-06  |ddm|= 4.56
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556001765044  LUMO = 1.60165943147259
  mo_energy =
[-0.904556    1.60165943  7.55619949 18.04152843 35.90434591 61.13856703]
E1 = -3.866141688115808  E_coul = 1.028512902312628
cycle= 8 E= -2.83762878580318  delta_E= -1.99e-06  |g|= 0.000188  |ddm|= 0.0369
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556369228205  LUMO = 1.6016527818173
  mo_energy =
[-0.90455637  1.60165278  7.55616591 18.04140708 35.90414548 61.13811189]
E1 = -3.866142320185275  E_coul = 1.028517149586913
cycle= 9 E= -2.83762517059836  delta_E= 3.62e-06  |g|= 0.000182  |ddm|= 9.13
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555977879033  LUMO = 1.60165885478528
  mo_energy =
[-0.90455598  1.60165885  7.55619665 18.04150925 35.90430433 61.13845643]
E1 = -3.866141771388591  E_coul = 1.0285115131427685
cycle= 10 E= -2.83763025824582  delta_E= -5.09e-06  |g|= 0.000306  |ddm|= 7.65
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556727713814  LUMO = 1.60164552921687
  mo_energy =
[-0.90455673  1.60164553  7.55612903 18.04127193 35.90392065 61.13761762]
E1 = -3.8661430168322766  E_coul = 1.0285148662725423
cycle= 11 E= -2.83762815055973  delta_E= 2.11e-06  |g|= 6.17e-05  |ddm|= 17.8
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556667643987  LUMO = 1.6016448665789
  mo_energy =
[-0.90455667  1.60164487  7.55612584 18.0412561  35.90389184 61.13752879]
E1 = -3.8661431206110723  E_coul = 1.0285168854809064
cycle= 12 E= -2.83762623513017  delta_E= 1.92e-06  |g|= 0.000119  |ddm|= 1.46
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556524260899  LUMO = 1.60164770029253
  mo_energy =
[-0.90455652  1.6016477   7.55614041 18.04130481 35.9039669  61.137673  ]
E1 = -3.866142856062855  E_coul = 1.0285160489747232
cycle= 13 E= -2.83762680708813  delta_E= -5.72e-07  |g|= 6.39e-05  |ddm|= 3.63
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556777781905  LUMO = 1.6016430765705
  mo_energy =
[-0.90455678  1.60164308  7.55611634 18.04122758 35.90385005 61.13746364]
E1 = -3.8661432709438763  E_coul = 1.028514935457852
cycle= 14 E= -2.83762833548602  delta_E= -1.53e-06  |g|= 5.76e-05  |ddm|= 5.62
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557050255611  LUMO = 1.60163785555231
  mo_energy =
[-0.90455705  1.60163786  7.55608884 18.0411376  35.90370939 61.13722046]
E1 = -3.866143738792239  E_coul = 1.0285144022849497
cycle= 15 E= -2.83762933650729  delta_E= -1e-06  |g|= 0.000142  |ddm|= 6.43
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557150802997  LUMO = 1.60163560904785
  mo_energy =
[-0.90455715  1.60163561  7.55607649 18.04110112 35.90365609 61.13715599]
E1 = -3.866143930971954  E_coul = 1.0285163392458843
cycle= 16 E= -2.83762759172607  delta_E= 1.74e-06  |g|= 3.58e-05  |ddm|= 2.49
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556750962413  LUMO = 1.60164243344399
  mo_energy =
[-0.90455675  1.60164243  7.55611027 18.04122523 35.90386315 61.13768005]
E1 = -3.866143272415002  E_coul = 1.0285151469112084
cycle= 17 E= -2.83762812550379  delta_E= -5.34e-07  |g|= 4.15e-05  |ddm|= 9.57
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557804892691  LUMO = 1.60162159838689
  mo_energy =
[-0.9045578   1.6016216   7.55600345 18.0408671  35.90330252 61.13650552]
E1 = -3.8661452219277392  E_coul = 1.0285162193974722
cycle= 18 E= -2.83762900253027  delta_E= -8.77e-07  |g|= 2.43e-05  |ddm|= 26.9
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555601684077  LUMO = 1.6016654559327
  mo_energy =
[-0.9045556   1.60166546  7.55623185 18.04159494 35.90440348 61.13852939]
E1 = -3.8661412310505012  E_coul = 1.028514843234253
cycle= 19 E= -2.83762638781625  delta_E= 2.61e-06  |g|= 1.48e-05  |ddm|= 53.6
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555681902454  LUMO = 1.60166413226478
  mo_energy =
[-0.90455568  1.60166413  7.55622483 18.04157773 35.90438174 61.13851271]
E1 = -3.8661413378930565  E_coul = 1.0285159477634682
cycle= 20 E= -2.83762539012959  delta_E= 9.98e-07  |g|= 0.000125  |ddm|= 1.27
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555611016813  LUMO = 1.6016651645425
  mo_energy =
[-0.90455561  1.60166516  7.55622898 18.04161072 35.90445538 61.13877212]
E1 = -3.8661411992079238  E_coul = 1.0285141783309373
cycle= 21 E= -2.83762702087699  delta_E= -1.63e-06  |g|= 4.37e-05  |ddm|= 2.68
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555939900255  LUMO = 1.60165946929913
  mo_energy =
[-0.90455594  1.60165947  7.55620091 18.0415099  35.90429056 61.13836434]
E1 = -3.8661417484995075  E_coul = 1.0285142226128496
cycle= 22 E= -2.83762752588666  delta_E= -5.05e-07  |g|= 6.43e-05  |ddm|= 7.86
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556031008162  LUMO = 1.60165786646128
  mo_energy =
[-0.90455603  1.60165787  7.5561932  18.04147984 35.90424032 61.13823353]
E1 = -3.866141910531296  E_coul = 1.0285152711874086
cycle= 23 E= -2.83762663934389  delta_E= 8.87e-07  |g|= 3.21e-05  |ddm|= 2.38
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555898243508  LUMO = 1.60166017930376
  mo_energy =
[-0.9045559   1.60166018  7.55620462 18.04152545 35.9043197  61.13843599]
E1 = -3.866141680037297  E_coul = 1.0285149650279475
cycle= 24 E= -2.83762671500935  delta_E= -7.57e-08  |g|= 8.65e-06  |ddm|= 3.48
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455593974123  LUMO = 1.60165932527159
  mo_energy =
[-0.90455594  1.60165933  7.55619999 18.0415097  35.90429449 61.13839593]
E1 = -3.8661417567557708  E_coul = 1.0285153247912449
cycle= 25 E= -2.83762643196453  delta_E= 2.83e-07  |g|= 3.27e-05  |ddm|= 1.08
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555861256034  LUMO = 1.6016610814959
  mo_energy =
[-0.90455586  1.60166108  7.55620965 18.04153604 35.90432945 61.13842785]
E1 = -3.866141608890409  E_coul = 1.0285152462233764
cycle= 26 E= -2.83762636266703  delta_E= 6.93e-08  |g|= 3.61e-05  |ddm|= 1.81
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555798718139  LUMO = 1.60166239755785
  mo_energy =
[-0.9045558   1.6016624   7.55621705 18.04155598 35.90435614 61.13844116]
E1 = -3.866141501318767  E_coul = 1.0285147751350663
cycle= 27 E= -2.8376267261837  delta_E= -3.64e-07  |g|= 1.25e-05  |ddm|= 1.32
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555809702098  LUMO = 1.60166221522064
  mo_energy =
[-0.90455581  1.60166222  7.55621602 18.04155263 35.90435056 61.1384341 ]
E1 = -3.8661415158104946  E_coul = 1.028512706633015
cycle= 28 E= -2.83762880917748  delta_E= -2.08e-06  |g|= 0.000189  |ddm|= 0.208
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555848216349  LUMO = 1.60166140482156
  mo_energy =
[-0.90455585  1.6016614   7.55621175 18.04153949 35.9043313  61.13840185]
E1 = -3.8661415887967805  E_coul = 1.0285146870424153
cycle= 29 E= -2.83762690175437  delta_E= 1.91e-06  |g|= 1.06e-05  |ddm|= 0.962
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555709990108  LUMO = 1.60166456806408
  mo_energy =
[-0.90455571  1.60166457  7.55622877 18.04159308 35.90441253 61.13853908]
E1 = -3.8661413042349118  E_coul = 1.0285135422643061
cycle= 30 E= -2.83762776197061  delta_E= -8.6e-07  |g|= 0.0001  |ddm|= 3.81
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555542580583  LUMO = 1.60166759239703
  mo_energy =
[-0.90455554  1.60166759  7.55624356 18.04164538 35.90449462 61.13872767]
E1 = -3.8661410096248825  E_coul = 1.0285151442454266
cycle= 31 E= -2.83762586537946  delta_E= 1.9e-06  |g|= 5.48e-05  |ddm|= 4.13
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556232615081  LUMO = 1.6016545211297
  mo_energy =
[-0.90455623  1.60165452  7.5561772  18.041412   35.90411602 61.13785364]
E1 = -3.8661422548383633  E_coul = 1.028514090811929
cycle= 32 E= -2.83762816402643  delta_E= -2.3e-06  |g|= 8.32e-05  |ddm|= 17.7
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455659541278  LUMO = 1.60164655561897
  mo_energy =
[-0.9045566   1.60164656  7.55613572 18.04129185 35.90395246 61.13759888]
E1 = -3.8661429740277353  E_coul = 1.0285168718198123
cycle= 33 E= -2.83762610220792  delta_E= 2.06e-06  |g|= 0.000144  |ddm|= 9.08
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556111697716  LUMO = 1.6016548443259
  mo_energy =
[-0.90455611  1.60165484  7.55617551 18.04144543 35.90421107 61.13828457]
E1 = -3.8661421439105057  E_coul = 1.02851302701253
cycle= 34 E= -2.83762911689798  delta_E= -3.01e-06  |g|= 0.000192  |ddm|= 12.2
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556505465397  LUMO = 1.60164747985905
  mo_energy =
[-0.90455651  1.60164748  7.55613823 18.04131932 35.90401375 61.13786466]
E1 = -3.8661428352104457  E_coul = 1.0285169423005194
cycle= 35 E= -2.83762589290993  delta_E= 3.22e-06  |g|= 0.000146  |ddm|= 9.57
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455640231984  LUMO = 1.60164976964838
  mo_energy =
[-0.9045564   1.60164977  7.5561505  18.0413553  35.90406576 61.1379486 ]
E1 = -3.8661426343309295  E_coul = 1.0285151168575388
cycle= 36 E= -2.83762751747339  delta_E= -1.62e-06  |g|= 2.24e-05  |ddm|= 2.59
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556234610333  LUMO = 1.60165325207677
  mo_energy =
[-0.90455623  1.60165325  7.55616878 18.04141187 35.90414942 61.1381039 ]
E1 = -3.866142319024687  E_coul = 1.028516292132038
cycle= 37 E= -2.83762602689265  delta_E= 1.49e-06  |g|= 0.000104  |ddm|= 4.18
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556178199313  LUMO = 1.60165442448912
  mo_energy =
[-0.90455618  1.60165442  7.55617467 18.04143292 35.90418396 61.13818803]
E1 = -3.866142204899204  E_coul = 1.0285156386650383
cycle= 38 E= -2.83762656623417  delta_E= -5.39e-07  |g|= 4.22e-05  |ddm|= 1.62
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555950057272  LUMO = 1.60165892302332
  mo_energy =
[-0.90455595  1.60165892  7.55619812 18.04150548 35.90429147 61.13838274]
E1 = -3.8661417985198603  E_coul = 1.0285155656717286
cycle= 39 E= -2.83762623284813  delta_E= 3.33e-07  |g|= 6.02e-05  |ddm|= 5.39
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556512750462  LUMO = 1.60164841283197
  mo_energy =
[-0.90455651  1.60164841  7.55614576 18.04132464 35.90400436 61.13768573]
E1 = -3.866142806304941  E_coul = 1.0285163362996332
cycle= 40 E= -2.83762647000531  delta_E= -2.37e-07  |g|= 7.84e-05  |ddm|= 14.1
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556215399672  LUMO = 1.60165471286408
  mo_energy =
[-0.90455622  1.60165471  7.55617807 18.04142898 35.90416112 61.13799493]
E1 = -3.8661422163303953  E_coul = 1.0285147012085774
cycle= 41 E= -2.83762751512182  delta_E= -1.05e-06  |g|= 3.23e-05  |ddm|= 7.93
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556274590109  LUMO = 1.60165256717847
  mo_energy =
[-0.90455627  1.60165257  7.55616558 18.04139728 35.90412017 61.13798082]
E1 = -3.8661423909876085  E_coul = 1.0285136404128494
cycle= 42 E= -2.83762875057476  delta_E= -1.24e-06  |g|= 0.000142  |ddm|= 2.02
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556031013753  LUMO = 1.6016571480966
  mo_energy =
[-0.90455603  1.60165715  7.55618885 18.04147184 35.9042318  61.13820861]
E1 = -3.8661419674928137  E_coul = 1.0285166433294202
cycle= 43 E= -2.83762532416339  delta_E= 3.43e-06  |g|= 0.000147  |ddm|= 5.69
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555417829622  LUMO = 1.60166880528079
  mo_energy =
[-0.90455542  1.60166881  7.55624781 18.04167853 35.90456525 61.13896603]
E1 = -3.866140857647572  E_coul = 1.028514828125305
cycle= 44 E= -2.83762602952227  delta_E= -7.05e-07  |g|= 3.48e-05  |ddm|= 15.7
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555563787683  LUMO = 1.60166658468324
  mo_energy =
[-0.90455556  1.60166658  7.55623758 18.04163608 35.90449343 61.13878439]
E1 = -3.8661410860520182  E_coul = 1.0285139089608581
cycle= 45 E= -2.83762717709116  delta_E= -1.15e-06  |g|= 5.74e-05  |ddm|= 3.43
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555802641904  LUMO = 1.60166194936144
  mo_energy =
[-0.9045558   1.60166195  7.55621417 18.04155165 35.90435472 61.13846844]
E1 = -3.866141532907571  E_coul = 1.0285128446271172
cycle= 46 E= -2.83762868828045  delta_E= -1.51e-06  |g|= 0.000171  |ddm|= 6.39
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556083633237  LUMO = 1.60165629708454
  mo_energy =
[-0.90455608  1.6016563   7.55618494 18.04145518 35.90420566 61.1381786 ]
E1 = -3.866142056486264  E_coul = 1.0285139299640118
cycle= 47 E= -2.83762812652225  delta_E= 5.62e-07  |g|= 0.000112  |ddm|= 7.16
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556317160691  LUMO = 1.60165200930931
  mo_energy =
[-0.90455632  1.60165201  7.55616351 18.04137688 35.9040764  61.13787646]
E1 = -3.866142471132389  E_coul = 1.0285175664643402
cycle= 48 E= -2.83762490466805  delta_E= 3.22e-06  |g|= 0.000218  |ddm|= 5.98
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556111561457  LUMO = 1.60165557606124
  mo_energy =
[-0.90455611  1.60165558  7.55618055 18.04144416 35.90419079 61.13817543]
E1 = -3.866142109862482  E_coul = 1.0285143102313214
cycle= 49 E= -2.83762779963116  delta_E= -2.89e-06  |g|= 7.5e-05  |ddm|= 5.35
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556157094696  LUMO = 1.60165502915977
  mo_energy =
[-0.90455616  1.60165503  7.55617828 18.04143284 35.90416985 61.13810433]
E1 = -3.866142171094855  E_coul = 1.0285165242855157
cycle= 50 E= -2.83762564680934  delta_E= 2.15e-06  |g|= 0.000134  |ddm|= 0.994
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.866142171094855  E_coul = 1.0285165242855157

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904554561432702  LUMO = 1.60168305162349
  mo_energy =
[-0.90455456  1.60168305  7.55632103 18.0419239  35.90495938 61.13983653]
E1 = -3.866139572933842  E_coul = 1.0285142788412769
Extra cycle  E= -2.83762529409257  delta_E= 3.53e-07  |g|= 2.67e-05  |ddm|= 36.6
    CPU time for scf_cycle      0.50 sec, wall time      0.50 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 981581723.1291282

WARN: Singularity detected in overlap matrix (condition number = 9.82e+08). SCF may be inaccurate and hard to converge.

E1 = -3.866139572933842  E_coul = 1.0285142788412769
init E= -2.83762529409257
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.904555507625298  LUMO = 1.6016897641639
  mo_energy =
[-0.90455551  1.60168976  7.55635998 18.04202502 35.90507227 61.13990245]
E1 = -3.866138669161691  E_coul = 1.0285119117678923
cycle= 1 E= -2.8376267573938  delta_E= -1.46e-06  |g|= 0.000122  |ddm|= 9.28
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904557422971317  LUMO = 1.60165893073386
  mo_energy =
[-0.90455742  1.60165893  7.55619932 18.04154056 35.90436726 61.13869579]
E1 = -3.8661413081291247  E_coul = 1.028515386141616
cycle= 2 E= -2.83762592198751  delta_E= 8.35e-07  |g|= 7.34e-05  |ddm|= 35.1
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904556772908063  LUMO = 1.60166388768432
  mo_energy =
[-0.90455677  1.60166389  7.55622293 18.04162552 35.90450822 61.13901944]
E1 = -3.866140931926497  E_coul = 1.0285160340541393
cycle= 3 E= -2.83762489787236  delta_E= 1.02e-06  |g|= 0.000149  |ddm|= 6.01
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556403364628  LUMO = 1.60167017131859
  mo_energy =
[-0.9045564   1.60167017  7.55625507 18.04173641 35.90468642 61.13939961]
E1 = -3.866140355527711  E_coul = 1.0285126519754766
cycle= 4 E= -2.83762770355223  delta_E= -2.81e-06  |g|= 0.000153  |ddm|= 8.19
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556858389928  LUMO = 1.60166178428916
  mo_energy =
[-0.90455686  1.60166178  7.55621344 18.04157877 35.90441968 61.13875642]
E1 = -3.866141182086047  E_coul = 1.0285134240544649
cycle= 5 E= -2.83762775803158  delta_E= -5.45e-08  |g|= 0.00012  |ddm|= 12.1
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557042153927  LUMO = 1.60165815992795
  mo_energy =
[-0.90455704  1.60165816  7.55619576 18.04150803 35.90429736 61.13844665]
E1 = -3.8661415521854208  E_coul = 1.028514116676466
cycle= 6 E= -2.83762743550895  delta_E= 3.23e-07  |g|= 5.35e-05  |ddm|= 5.51
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557089973545  LUMO = 1.60165694759759
  mo_energy =
[-0.90455709  1.60165695  7.55618943 18.04148798 35.90426713 61.13839517]
E1 = -3.866141665345891  E_coul = 1.0285158525672813
cycle= 7 E= -2.83762581277861  delta_E= 1.62e-06  |g|= 0.0001  |ddm|= 1.49
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557036135317  LUMO = 1.60165772779581
  mo_energy =
[-0.90455704  1.60165773  7.55619326 18.04150202 35.90429032 61.13844761]
E1 = -3.8661415926471787  E_coul = 1.0285143230610019
cycle= 8 E= -2.83762726958618  delta_E= -1.46e-06  |g|= 4.54e-05  |ddm|= 1.06
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557064403404  LUMO = 1.60165708708972
  mo_energy =
[-0.90455706  1.60165709  7.5561902  18.04148933 35.90426815 61.1383854 ]
E1 = -3.8661416611651354  E_coul = 1.028516160780964
cycle= 9 E= -2.83762550038417  delta_E= 1.77e-06  |g|= 0.000131  |ddm|= 1.02
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558180412355  LUMO = 1.60163576787308
  mo_energy =
[-0.90455818  1.60163577  7.55608778 18.04106331 35.90351498 61.13639304]
E1 = -3.8661438902855365  E_coul = 1.02851502534677
cycle= 10 E= -2.83762886493877  delta_E= -3.36e-06  |g|= 5.43e-05  |ddm|= 33.6
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556059405841  LUMO = 1.60168538499229
  mo_energy =
[-0.90455606  1.60168538  7.55633892 18.04197272 35.90501228 61.13984228]
E1 = -3.8661389728181357  E_coul = 1.0285118929929842
cycle= 11 E= -2.83762707982515  delta_E= 1.79e-06  |g|= 0.000147  |ddm|= 69.8
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557148776883  LUMO = 1.60166168836297
  mo_energy =
[-0.90455715  1.60166169  7.55621848 18.04155903 35.90435623 61.13836935]
E1 = -3.866141248709958  E_coul = 1.0285140406287117
cycle= 12 E= -2.83762720808125  delta_E= -1.28e-07  |g|= 4.55e-05  |ddm|= 31.7
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556917735263  LUMO = 1.60166620331024
  mo_energy =
[-0.90455692  1.6016662   7.55624168 18.04164104 35.90449122 61.13866   ]
E1 = -3.8661408183897237  E_coul = 1.0285178080111712
cycle= 13 E= -2.83762301037855  delta_E= 4.2e-06  |g|= 0.000322  |ddm|= 6.11
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556093367138  LUMO = 1.60168232268479
  mo_energy =
[-0.90455609  1.60168232  7.55632356 18.04192776 35.9049531  61.13967803]
E1 = -3.8661392819458698  E_coul = 1.0285132952131477
cycle= 14 E= -2.83762598673272  delta_E= -2.98e-06  |g|= 3.55e-05  |ddm|= 21.6
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556133029386  LUMO = 1.60168112360727
  mo_energy =
[-0.90455613  1.60168112  7.55631662 18.04190155 35.9049075  61.13959927]
E1 = -3.8661393910095816  E_coul = 1.028512766218315
cycle= 15 E= -2.83762662479127  delta_E= -6.38e-07  |g|= 8.45e-05  |ddm|= 1.66
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556389633994  LUMO = 1.60167673413698
  mo_energy =
[-0.90455639  1.60167673  7.55629423 18.04182257 35.90477816 61.13931773]
E1 = -3.8661397990119197  E_coul = 1.0285102948169422
cycle= 16 E= -2.83762950419498  delta_E= -2.88e-06  |g|= 0.000336  |ddm|= 5.86
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556992295507  LUMO = 1.60166552791622
  mo_energy =
[-0.90455699  1.60166553  7.55623721 18.04162352 35.90445785 61.13861737]
E1 = -3.86614085533004  E_coul = 1.0285137608347728
cycle= 17 E= -2.83762709449527  delta_E= 2.41e-06  |g|= 5.57e-05  |ddm|= 14.9
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455707864518  LUMO = 1.60166435551909
  mo_energy =
[-0.90455708  1.60166436  7.5562317  18.04160115 35.90441904 61.13850859]
E1 = -3.866140970827394  E_coul = 1.0285142057237802
cycle= 18 E= -2.83762676510361  delta_E= 3.29e-07  |g|= 1.4e-05  |ddm|= 1.77
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557414237469  LUMO = 1.60165619202333
  mo_energy =
[-0.90455741  1.60165619  7.55618925 18.04146085 35.90420089 61.13806639]
E1 = -3.866141745951835  E_coul = 1.0285152492942076
cycle= 19 E= -2.83762649665763  delta_E= 2.68e-07  |g|= 4.48e-05  |ddm|= 10.5
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557388305397  LUMO = 1.6016569987198
  mo_energy =
[-0.90455739  1.601657    7.55619262 18.04146849 35.90420708 61.13810874]
E1 = -3.866141659687832  E_coul = 1.0285138253810402
cycle= 20 E= -2.83762783430679  delta_E= -1.34e-06  |g|= 7.97e-05  |ddm|= 0.972
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557184301728  LUMO = 1.60166105983336
  mo_energy =
[-0.90455718  1.60166106  7.55621373 18.04153876 35.90431705 61.13832072]
E1 = -3.8661412852558197  E_coul = 1.0285167176239032
cycle= 21 E= -2.83762456763192  delta_E= 3.27e-06  |g|= 0.000195  |ddm|= 5.16
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557639501408  LUMO = 1.60165241590242
  mo_energy =
[-0.90455764  1.60165242  7.55616957 18.04138782 35.90407742 61.13780833]
E1 = -3.8661420950202063  E_coul = 1.028513107253324
cycle= 22 E= -2.83762898776688  delta_E= -4.42e-06  |g|= 0.000167  |ddm|= 11.3
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557903872682  LUMO = 1.60164810530389
  mo_energy =
[-0.9045579   1.60164811  7.55614827 18.04130678 35.9039393  61.13746446]
E1 = -3.866142513275873  E_coul = 1.0285172215723972
cycle= 23 E= -2.83762529170348  delta_E= 3.7e-06  |g|= 0.000206  |ddm|= 6.21
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559329717042  LUMO = 1.60162103599689
  mo_energy =
[-0.90455933  1.60162104  7.55601266 18.04082149 35.90315214 61.13563402]
E1 = -3.8661451253147976  E_coul = 1.0285187756760679
cycle= 24 E= -2.83762634963873  delta_E= -1.06e-06  |g|= 0.000235  |ddm|= 37.2
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557339586949  LUMO = 1.60165861627731
  mo_energy =
[-0.90455734  1.60165862  7.55620012 18.04150301 35.9042677  61.13830382]
E1 = -3.866141468277313  E_coul = 1.0285143494737088
cycle= 25 E= -2.8376271188036  delta_E= -7.69e-07  |g|= 1.88e-05  |ddm|= 52.5
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9045573043013  LUMO = 1.60165769477263
  mo_energy =
[-0.9045573   1.60165769  7.55619127 18.04151142 35.9043179  61.13866881]
E1 = -3.8661414541139045  E_coul = 1.0285143271702253
cycle= 26 E= -2.83762712694368  delta_E= -8.14e-09  |g|= 3.19e-05  |ddm|= 1.67
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557424124118  LUMO = 1.6016550694402
  mo_energy =
[-0.90455742  1.60165507  7.55617656 18.04147168 35.90426422 61.13863072]
E1 = -3.866141670058601  E_coul = 1.0285164547231767
cycle= 27 E= -2.83762521533542  delta_E= 1.91e-06  |g|= 0.000158  |ddm|=  2.6
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557176154763  LUMO = 1.60165972942592
  mo_energy =
[-0.90455718  1.60165973  7.55619865 18.04156591 35.90443272 61.13910818]
E1 = -3.866141180919539  E_coul = 1.0285154105439538
cycle= 28 E= -2.83762577037559  delta_E= -5.55e-07  |g|= 6.71e-05  |ddm|= 7.53
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556601749015  LUMO = 1.60167187521718
  mo_energy =
[-0.9045566   1.60167188  7.5562608  18.04177853 35.90476893 61.13983285]
E1 = -3.866140026197383  E_coul = 1.0285127848810576
cycle= 29 E= -2.83762724131633  delta_E= -1.47e-06  |g|= 0.000124  |ddm|= 16.1
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557717218195  LUMO = 1.60165095944487
  mo_energy =
[-0.90455772  1.60165096  7.55615513 18.04141755 35.9042003  61.1385574 ]
E1 = -3.866142008017781  E_coul = 1.0285149774100186
cycle= 30 E= -2.83762703060776  delta_E= 2.11e-07  |g|= 5.92e-06  |ddm|= 27.6
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557522373876  LUMO = 1.60165462319713
  mo_energy =
[-0.90455752  1.60165462  7.55617344 18.04148075 35.90430067 61.13879055]
E1 = -3.8661416578296928  E_coul = 1.0285139383756192
cycle= 31 E= -2.83762771945407  delta_E= -6.89e-07  |g|= 7.85e-05  |ddm|= 4.91
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557717409049  LUMO = 1.60165079165804
  mo_energy =
[-0.90455772  1.60165079  7.55615354 18.04141594 35.90420124 61.13859626]
E1 = -3.866142010158698  E_coul = 1.0285171097716
cycle= 32 E= -2.8376249003871  delta_E= 2.82e-06  |g|= 0.000192  |ddm|= 4.79
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558631156318  LUMO = 1.60163448451742
  mo_energy =
[-0.90455863  1.60163448  7.55607589 18.04110841 35.90367533 61.13712553]
E1 = -3.866143680585971  E_coul = 1.0285135429297314
cycle= 33 E= -2.83763013765624  delta_E= -5.24e-06  |g|= 0.0002  |ddm|= 24.9
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904555207346921  LUMO = 1.60169984795024
  mo_energy =
[-0.90455521  1.60169985  7.55640706 18.04225442 35.90550159 61.14116751]
E1 = -3.86613747337358  E_coul = 1.0285084902033537
cycle= 34 E= -2.83762898317023  delta_E= 1.15e-06  |g|= 0.000413  |ddm|= 87.1
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557935434374  LUMO = 1.60164818156793
  mo_energy =
[-0.90455794  1.60164818  7.55614645 18.04133102 35.90400543 61.13776447]
E1 = -3.8661424176013806  E_coul = 1.028515058387163
cycle= 35 E= -2.83762735921422  delta_E= 1.62e-06  |g|= 7.18e-06  |ddm|= 70.2
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558101853354  LUMO = 1.60164511958076
  mo_energy =
[-0.9045581   1.60164512  7.55613115 18.04127447 35.90391115 61.13753923]
E1 = -3.8661427149977245  E_coul = 1.0285151675460256
cycle= 36 E= -2.8376275474517  delta_E= -1.88e-07  |g|= 2.08e-05  |ddm|= 4.32
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558307524423  LUMO = 1.60164091934043
  mo_energy =
[-0.90455831  1.60164092  7.55610973 18.04120209 35.90379788 61.13729021]
E1 = -3.8661431131332837  E_coul = 1.0285168071414001
cycle= 37 E= -2.83762630599188  delta_E= 1.24e-06  |g|= 0.000131  |ddm|=  5.5
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558462093514  LUMO = 1.60163779453309
  mo_energy =
[-0.90455846  1.60163779  7.55609362 18.04114568 35.903706   61.13709688]
E1 = -3.8661434066484093  E_coul = 1.0285150194415125
cycle= 38 E= -2.8376283872069  delta_E= -2.08e-06  |g|= 4.31e-05  |ddm|= 4.16
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558497059056  LUMO = 1.60163708302375
  mo_energy =
[-0.9045585   1.60163708  7.55609003 18.04113592 35.90369362 61.13707276]
E1 = -3.8661434716826477  E_coul = 1.0285173274668877
cycle= 39 E= -2.83762614421576  delta_E= 2.24e-06  |g|= 0.000165  |ddm|= 0.804
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558520915075  LUMO = 1.60163664455649
  mo_energy =
[-0.90455852  1.60163664  7.55608844 18.04112534 35.90367202 61.13698746]
E1 = -3.8661435297571343  E_coul = 1.0285154499236153
cycle= 40 E= -2.83762807983352  delta_E= -1.94e-06  |g|= 1.55e-05  |ddm|= 0.995
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558957913206  LUMO = 1.60162807490094
  mo_energy =
[-0.90455896  1.60162807  7.55604453 18.04097596 35.90343592 61.1364912 ]
E1 = -3.8661443336309618  E_coul = 1.0285171731809633
cycle= 41 E= -2.83762716045  delta_E= 9.19e-07  |g|= 0.000109  |ddm|= 11.2
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904559010950162  LUMO = 1.601626913974
  mo_energy =
[-0.90455901  1.60162691  7.5560385  18.04095766 35.90341003 61.13644484]
E1 = -3.8661444405941734  E_coul = 1.0285177324424126
cycle= 42 E= -2.83762670815176  delta_E= 4.52e-07  |g|= 0.000163  |ddm|= 1.39
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558698071395  LUMO = 1.60162726184697
  mo_energy =
[-0.9045587   1.60162726  7.55603137 18.04102491 35.90361179 61.13736453]
E1 = -3.8661442203482825  E_coul = 1.028517420602542
cycle= 43 E= -2.83762679974574  delta_E= -9.16e-08  |g|= 0.000125  |ddm|= 6.65
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558839072653  LUMO = 1.60162262699993
  mo_energy =
[-0.90455884  1.60162263  7.55601105 18.04093513 35.90346261 61.13690072]
E1 = -3.866144763864159  E_coul = 1.028516836342308
cycle= 44 E= -2.83762792752185  delta_E= -1.13e-06  |g|= 4.26e-05  |ddm|= 8.08
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90455686165943  LUMO = 1.60165850065365
  mo_energy =
[-0.90455686  1.6016585   7.55619478 18.04155898 35.90444723 61.13891659]
E1 = -3.866141435610828  E_coul = 1.0285155640980124
cycle= 45 E= -2.83762587151282  delta_E= 2.06e-06  |g|= 6.22e-05  |ddm|= 46.3
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904556346284626  LUMO = 1.6016764745179
  mo_energy =
[-0.90455635  1.60167647  7.55629305 18.04181103 35.90474706 61.13914427]
E1 = -3.866139855240015  E_coul = 1.0285125082261417
cycle= 46 E= -2.83762734701387  delta_E= -1.48e-06  |g|= 0.000109  |ddm|= 18.5
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904557133798622  LUMO = 1.60165749180563
  mo_energy =
[-0.90455713  1.60165749  7.55618751 18.04152743 35.90437417 61.13889127]
E1 = -3.8661414427487943  E_coul = 1.0285112849598612
cycle= 47 E= -2.83763015778893  delta_E= -2.81e-06  |g|= 0.000318  |ddm|= 19.1
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558527084761  LUMO = 1.60163205682885
  mo_energy =
[-0.90455853  1.60163206  7.55605919 18.04107991 35.90365853 61.13731495]
E1 = -3.8661438531582064  E_coul = 1.0285175568222018
cycle= 48 E= -2.837626296336  delta_E= 3.86e-06  |g|= 0.000151  |ddm|= 33.9
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558467046579  LUMO = 1.60163298424322
  mo_energy =
[-0.90455847  1.60163298  7.55606321 18.0411006  35.90369813 61.13745028]
E1 = -3.866143747204354  E_coul = 1.0285161658041848
cycle= 49 E= -2.83762758140017  delta_E= -1.29e-06  |g|= 2.48e-05  |ddm|= 1.74
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904558573084367  LUMO = 1.60163104560561
  mo_energy =
[-0.90455857  1.60163105  7.55605343 18.04106638 35.90364312 61.13732799]
E1 = -3.866143931138691  E_coul = 1.028517744078992
cycle= 50 E= -2.8376261870597  delta_E= 1.39e-06  |g|= 0.000163  |ddm|=  2.6
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.866143931138691  E_coul = 1.028517744078992

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904554221730741  LUMO = 1.60167435566471
  mo_energy =
[-0.90455422  1.60167436  7.55627636 18.04174136 35.9046322  61.13892034]
E1 = -3.8661406699009118  E_coul = 1.0285136765762282
Extra cycle  E= -2.83762699332468  delta_E= -8.06e-07  |g|= 6.13e-05  |ddm|= 45.7
    CPU time for scf_cycle      0.52 sec, wall time      0.53 sec
exp = [6.32151148 5.5736654  4.90667675 4.21430229 3.81122528 0.37756218]
grad_E = [-4.02779959e-04 -2.43241596e-04 -4.86635543e-05  2.96467481e-04
  5.66307463e-04 -4.48366278e-04]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:07 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  45860.1399189        1
[INPUT] 0    0    [1    /1   ]  40400.1762781        1
[INPUT] 0    0    [1    /1   ]  35539.2566814        1
[INPUT] 0    0    [1    /1   ]  28841.7567699        1
[INPUT] 0    0    [1    /1   ]  26259.5292777        1
[INPUT] 0    0    [1    /1   ]  703.465653596        1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [45860.1399188775, 1.0]], [0, [40400.17627810881, 1.0]], [0, [35539.25668142463, 1.0]], [0, [28841.75676994875, 1.0]], [0, [26259.529277727685, 1.0]], [0, [703.4656535957051, 1.0]]]}
ecp = {}
CPU time:        64.61
Set gradient conv threshold to 3.16228e-05
cond(S) = 314936187.8128533

WARN: Singularity detected in overlap matrix (condition number = 3.15e+08). SCF may be inaccurate and hard to converge.

E1 = 10.330942337610065  E_coul = 5.1777006589253905e-05
init E= 10.3309941146167
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = 964.327654383904  LUMO = 15986.7099337973
  mo_energy =
[   964.32765438  15986.7099338   61047.36923654 141411.3269456
 268386.68320133 472039.19214021]
E1 = 1928.5725921783571  E_coul = 29.630679681228465
cycle= 1 E= 1958.20327185959  delta_E= 1.95e+03  |g|= 7.64  |ddm|= 1.18e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = 993.916178760619  LUMO = 16059.9622730906
  mo_energy =
[   993.91617876  16059.96227309  61125.15368003 141490.38184852
 268466.64525002 472120.18570777]
E1 = 1928.574192712441  E_coul = 29.62748251763916
cycle= 2 E= 1958.20167523008  delta_E= -0.0016  |g|= 0.0116  |ddm|= 32.3
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = 993.914575032665  LUMO = 16059.9544957269
  mo_energy =
[   993.91457503  16059.95449573  61125.13926458 141490.36593339
 268466.6279576  472120.1664542 ]
E1 = 1928.5741979456473  E_coul = 29.627477287956378
cycle= 3 E= 1958.2016752336  delta_E= 3.52e-09  |g|= 8.32e-06  |ddm|= 0.04
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = 993.914576262141  LUMO = 16059.9545052657
  mo_energy =
[   993.91457626  16059.95450527  61125.13928914 141490.36597939
 268466.62804276 472120.16662913]
E1 = 1928.5741979348572  E_coul = 29.62747730047609
cycle= 4 E= 1958.20167523533  delta_E= 1.73e-09  |g|= 2.48e-06  |ddm|= 3.61e-05
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.914576257798  LUMO = 16059.9545006451
  mo_energy =
[   993.91457626  16059.95450065  61125.1392673  141490.36591768
 268466.62789841 472120.16632586]
E1 = 1928.574197934038  E_coul = 29.627477307880547
cycle= 5 E= 1958.20167524192  delta_E= 6.59e-09  |g|= 8.83e-06  |ddm|= 6.17e-06
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.914576268206  LUMO = 16059.95451288
  mo_energy =
[   993.91457627  16059.95451288  61125.13932195 141490.36605915
 268466.62819556 472120.16687619]
E1 = 1928.574197935266  E_coul = 29.6274772939369
cycle= 6 E= 1958.2016752292  delta_E= -1.27e-08  |g|= 4.12e-06  |ddm|= 1.45e-05
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.91457626351  LUMO = 16059.9545073402
  mo_energy =
[   993.91457626  16059.95450734  61125.13929731 141490.36599578
 268466.62806295 472120.16662888]
E1 = 1928.5741979323304  E_coul = 29.627477301668204
cycle= 7 E= 1958.201675234  delta_E= 4.8e-09  |g|= 4.5e-06  |ddm|= 6.47e-06
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.914576261514  LUMO = 16059.9545049676
  mo_energy =
[   993.91457626  16059.95450497  61125.13928713 141490.36597119
 268466.62801566 472120.16654624]
E1 = 1928.5741979390336  E_coul = 29.627477304158354
cycle= 8 E= 1958.20167524319  delta_E= 9.19e-09  |g|= 5.84e-06  |ddm|= 2.6e-06
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.914576272625  LUMO = 16059.9545182913
  mo_energy =
[   993.91457627  16059.95451829  61125.13934484 141490.36611314
 268466.62829485 472120.16703476]
E1 = 1928.574197927557  E_coul = 29.62747729396613
cycle= 9 E= 1958.20167522152  delta_E= -2.17e-08  |g|= 9.01e-06  |ddm|= 1.47e-05
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.91457626288  LUMO = 16059.954506684
  mo_energy =
[   993.91457626  16059.95450668  61125.13929411 141490.36598548
 268466.62803331 472120.1665508 ]
E1 = 1928.5741979324162  E_coul = 29.6274773042535
cycle= 10 E= 1958.20167523667  delta_E= 1.51e-08  |g|= 5.01e-06  |ddm|= 1.32e-05
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.914576270407  LUMO = 16059.9545157682
  mo_energy =
[   993.91457627  16059.95451577  61125.13933314 141490.36608068
 268466.62822166 472120.16688896]
E1 = 1928.5741979386166  E_coul = 29.627477277755094
cycle= 11 E= 1958.20167521637  delta_E= -2.03e-08  |g|= 1.36e-05  |ddm|= 1e-05
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.914576264737  LUMO = 16059.9545090495
  mo_energy =
[   993.91457626  16059.95450905  61125.13930372 141490.36600674
 268466.62807041 472120.16660929]
E1 = 1928.574197934627  E_coul = 29.62747730547168
cycle= 12 E= 1958.2016752401  delta_E= 2.37e-08  |g|= 3.95e-06  |ddm|= 7.75e-06
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.914576264593  LUMO = 16059.9545087924
  mo_energy =
[   993.91457626  16059.95450879  61125.13930315 141490.36600753
 268466.62807657 472120.1666264 ]
E1 = 1928.5741979214965  E_coul = 29.62747730288062
cycle= 13 E= 1958.20167522438  delta_E= -1.57e-08  |g|= 2.33e-06  |ddm|= 3.13e-08
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.914576269997  LUMO = 16059.9545151265
  mo_energy =
[   993.91457627  16059.95451513  61125.13933102 141490.36607892
 268466.62822871 472120.16692794]
E1 = 1928.5741979348861  E_coul = 29.627477301065856
cycle= 14 E= 1958.20167523595  delta_E= 1.16e-08  |g|= 1.19e-06  |ddm|= 7.4e-06
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.914576273037  LUMO = 16059.9545189899
  mo_energy =
[   993.91457627  16059.95451899  61125.13934658 141490.36611226
 268466.62828089 472120.16698927]
E1 = 1928.574197931752  E_coul = 29.627477301993718
cycle= 15 E= 1958.20167523375  delta_E= -2.21e-09  |g|= 1.01e-06  |ddm|= 3.61e-06
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.914576268812  LUMO = 16059.9545137175
  mo_energy =
[   993.91457627  16059.95451372  61125.13932474 141490.36606258
 268466.6281937  472120.16685688]
E1 = 1928.5741979295997  E_coul = 29.627477285203202
cycle= 16 E= 1958.2016752148  delta_E= -1.89e-08  |g|= 1.14e-05  |ddm|= 5.28e-06
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.914576271542  LUMO = 16059.9545170193
  mo_energy =
[   993.91457627  16059.95451702  61125.13933859 141490.36609503
 268466.62825369 472120.16695307]
E1 = 1928.5741979363631  E_coul = 29.627477303590513
cycle= 17 E= 1958.20167523995  delta_E= 2.52e-08  |g|= 2.14e-06  |ddm|= 3.43e-06
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.914576271045  LUMO = 16059.9545166518
  mo_energy =
[   993.91457627  16059.95451665  61125.13933543 141490.36608102
 268466.62821146 472120.16685699]
E1 = 1928.5741979245065  E_coul = 29.62747729696109
cycle= 18 E= 1958.20167522147  delta_E= -1.85e-08  |g|= 5.34e-06  |ddm|= 1.19e-06
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.914576272442  LUMO = 16059.9545182741
  mo_energy =
[   993.91457627  16059.95451827  61125.13934255 141490.3660987
 268466.6282455  472120.16690861]
E1 = 1928.5741979264026  E_coul = 29.627477306757143
cycle= 19 E= 1958.20167523316  delta_E= 1.17e-08  |g|= 6.38e-07  |ddm|= 1.8e-06
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.914576274017  LUMO = 16059.9545201877
  mo_energy =
[   993.91457627  16059.95452019  61125.13935029 141490.36611568
 268466.62827471 472120.16695204]
E1 = 1928.5741979299385  E_coul = 29.6274773172011
cycle= 20 E= 1958.20167524714  delta_E= 1.4e-08  |g|= 5.96e-06  |ddm|= 1.93e-06
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.914576269921  LUMO = 16059.9545151485
  mo_energy =
[   993.91457627  16059.95451515  61125.13932957 141490.3660685
 268466.62818869 472120.16680569]
E1 = 1928.5741979301927  E_coul = 29.627477300160287
cycle= 21 E= 1958.20167523035  delta_E= -1.68e-08  |g|= 1.59e-06  |ddm|= 5.16e-06
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.914576274641  LUMO = 16059.9545209705
  mo_energy =
[   993.91457627  16059.95452097  61125.1393535  141490.36612297
 268466.62828748 472120.1669748 ]
E1 = 1928.5741979283846  E_coul = 29.62747729543373
cycle= 22 E= 1958.20167522382  delta_E= -6.53e-09  |g|= 8.7e-06  |ddm|= 5.9e-06
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.914576273583  LUMO = 16059.9545196104
  mo_energy =
[   993.91457627  16059.95451961  61125.13934819 141490.36611188
 268466.62827002 472120.16695288]
E1 = 1928.5741979346076  E_coul = 29.627477303031274
cycle= 23 E= 1958.20167523764  delta_E= 1.38e-08  |g|= 2.25e-06  |ddm|= 1.29e-06
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = 993.914576267677  LUMO = 16059.9545125131
  mo_energy =
[   993.91457627  16059.95451251  61125.13931772 141490.36603765
 268466.62812371 472120.16669103]
E1 = 1928.5741979329173  E_coul = 29.627477305578477
cycle= 24 E= 1958.2016752385  delta_E= 8.57e-10  |g|= 2.03e-06  |ddm|= 7.8e-06
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
E1 = 1928.5741979329173  E_coul = 29.627477305578477
  HOMO = 993.914576266835  LUMO = 16059.9545110512
  mo_energy =
[   993.91457627  16059.95451105  61125.1393145  141490.36604324
 268466.62817054 472120.16684113]
E1 = 1928.5741979421502  E_coul = 29.627477298544008
Extra cycle  E= 1958.20167524069  delta_E= 2.2e-09  |g|= 3.32e-06  |ddm|= 1.15e-07
    CPU time for scf_cycle      0.26 sec, wall time      0.26 sec
exp = [45860.13991888 40400.17627811 35539.25668142 28841.75676995
 26259.52927773   703.4656536 ]
E = 1958.2016752406942
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:08 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  4591.70335222        1
[INPUT] 0    0    [1    /1   ]  4045.03392667        1
[INPUT] 0    0    [1    /1   ]  3558.34167722        1
[INPUT] 0    0    [1    /1   ]  2887.96854906        1
[INPUT] 0    0    [1    /1   ]  2629.38303052        1
[INPUT] 0    0    [1    /1   ]  70.6863713243        1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [4591.703352219529, 1.0]], [0, [4045.0339266726005, 1.0]], [0, [3558.3416772176, 1.0]], [0, [2887.968549055956, 1.0]], [0, [2629.383030524796, 1.0]], [0, [70.68637132426093, 1.0]]]}
ecp = {}
CPU time:        65.16
Set gradient conv threshold to 3.16228e-05
cond(S) = 315328552.200579

WARN: Singularity detected in overlap matrix (condition number = 3.15e+08). SCF may be inaccurate and hard to converge.

E1 = 19.04060898019916  E_coul = 0.007938018717350986
init E= 19.0485469989165
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = 79.1907229394621  LUMO = 1545.42435370183
  mo_energy =
[   79.19072294  1545.4243537   6039.76212421 14066.38850025
 26774.03196928 47089.11969056]
E1 = 157.80907786861798  E_coul = 9.423221111764354
cycle= 1 E= 167.232298980382  delta_E=  148  |g|= 2.32  |ddm|= 4.81e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = 88.3269978219839  LUMO = 1568.10168515392
  mo_energy =
[   88.32699782  1568.10168515  6063.92606125 14090.96540729
 26798.90446304 47114.33105164]
E1 = 157.81081673004283  E_coul = 9.4199498473966
cycle= 2 E= 167.230766577439  delta_E= -0.00153  |g|= 0.0114  |ddm|= 75.6
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = 88.3253457815491  LUMO = 1568.09382122804
  mo_energy =
[   88.32534578  1568.09382123  6063.91145223 14090.94930071
 26798.8870064  47114.31167414]
E1 = 157.8108338396564  E_coul = 9.419932695902862
cycle= 3 E= 167.230766535559  delta_E= -4.19e-08  |g|= 2.44e-05  |ddm|= 0.307
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = 88.3253496376551  LUMO = 1568.09384278993
  mo_energy =
[   88.32534964  1568.09384279  6063.91149626 14090.94936688
 26798.88710438 47114.31181846]
E1 = 157.81083380500561  E_coul = 9.419932730722678
cycle= 4 E= 167.230766535728  delta_E= 1.69e-10  |g|= 1.64e-07  |ddm|= 0.000774
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = 157.81083380500561  E_coul = 9.419932730722678
  HOMO = 88.3253496329046  LUMO = 1568.09384232061
  mo_energy =
[   88.32534963  1568.09384232  6063.91149451 14090.94936377
 26798.88710147 47114.31181906]
E1 = 157.8108338044461  E_coul = 9.419932730652675
Extra cycle  E= 167.230766535099  delta_E= -6.3e-10  |g|= 3.97e-08  |ddm|= 3.29e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [4591.70335222 4045.03392667 3558.34167722 2887.96854906 2629.38303052
   70.68637132]
E = 167.23076653509878
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:08 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  464.859695554        1
[INPUT] 0    0    [1    /1   ]  409.519691529        1
[INPUT] 0    0    [1    /1   ]  360.250176797        1
[INPUT] 0    0    [1    /1   ]  292.589726967        1
[INPUT] 0    0    [1    /1   ]  266.368405805        1
[INPUT] 0    0    [1    /1   ]  7.40844309712        1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [464.8596955537311, 1.0]], [0, [409.5196915289798, 1.0]], [0, [360.2501767968964, 1.0]], [0, [292.58972696667615, 1.0]], [0, [266.36840580450723, 1.0]], [0, [7.408443097116516, 1.0]]]}
ecp = {}
CPU time:        65.54
Set gradient conv threshold to 3.16228e-05
cond(S) = 319233685.788559

WARN: Singularity detected in overlap matrix (condition number = 3.19e+08). SCF may be inaccurate and hard to converge.

E1 = 10.014635964620988  E_coul = 0.3130172412524481
init E= 10.3276532058734
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = 3.39404354621257  LUMO = 141.36069014384
  mo_energy =
[3.39404355e+00 1.41360690e+02 5.91159421e+02 1.39772857e+03
 2.68280829e+03 4.71620671e+03]
E1 = 4.7736136752426965  E_coul = 3.085654152269081
cycle= 1 E= 7.85926782751178  delta_E= -2.47  |g|= 0.344  |ddm|= 2.78e+05
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = 5.47226249350363  LUMO = 146.6525011263
  mo_energy =
[   5.47226249  146.65250113  596.9234216  1403.62153055 2688.79442214
 4722.30104251]
E1 = 4.775182126086153  E_coul = 3.0836818510022415
cycle= 2 E= 7.85886397708839  delta_E= -0.000404  |g|= 0.00588  |ddm|= 4.97
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = 5.47125105124618  LUMO = 146.648035125488
  mo_energy =
[   5.47125105  146.64803513  596.91493711 1403.61215688 2688.78422523
 4722.28963569]
E1 = 4.775216330822008  E_coul = 3.083647522806858
cycle= 3 E= 7.85886385362887  delta_E= -1.23e-07  |g|= 2.42e-05  |ddm|= 0.108
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = 5.47125577681536  LUMO = 146.648055907241
  mo_energy =
[   5.47125578  146.64805591  596.91497239 1403.61219607 2688.78426744
 4722.28968214]
E1 = 4.775216192890925  E_coul = 3.0836476607362795
cycle= 4 E= 7.8588638536272  delta_E= -1.66e-12  |g|= 9.71e-08  |ddm|= 0.00054
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
E1 = 4.775216192890925  E_coul = 3.0836476607362795
  HOMO = 5.47125575718133  LUMO = 146.648055783918
  mo_energy =
[   5.47125576  146.64805578  596.91497207 1403.61219541 2688.78426619
 4722.28967972]
E1 = 4.775216193398764  E_coul = 3.0836476602282623
Extra cycle  E= 7.85886385362703  delta_E= -1.78e-13  |g|= 1.55e-09  |ddm|= 2.25e-06
    CPU time for scf_cycle      0.07 sec, wall time      0.07 sec
exp = [464.85969555 409.51969153 360.2501768  292.58972697 266.3684058
   7.4084431 ]
E = 7.858863853627026
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:08 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  52.1753298872        1
[INPUT] 0    0    [1    /1   ]  45.9682680146        1
[INPUT] 0    0    [1    /1   ]  40.4410267548        1
[INPUT] 0    0    [1    /1   ]  33.0518447577        1
[INPUT] 0    0    [1    /1   ]  30.0669433325        1
[INPUT] 0    0    [1    /1   ]  1.0806502744         1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [52.17532988715138, 1.0]], [0, [45.96826801461771, 1.0]], [0, [40.44102675482607, 1.0]], [0, [33.051844757748185, 1.0]], [0, [30.066943332478356, 1.0]], [0, [1.0806502744020727, 1.0]]]}
ecp = {}
CPU time:        65.90
Set gradient conv threshold to 3.16228e-05
cond(S) = 356426630.9846833

WARN: Singularity detected in overlap matrix (condition number = 3.56e+08). SCF may be inaccurate and hard to converge.

E1 = -3.356379538143678  E_coul = 1.015130848923019
init E= -2.34124868922066
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.762260239474575  LUMO = 13.0338678073175
  mo_energy =
[ -0.76226024  13.03386781  62.24159147 151.05691469 295.21092157
 516.51423039]
E1 = -3.78388187447315  E_coul = 1.255835417762834
cycle= 1 E= -2.52804645671032  delta_E= -0.187  |g|= 0.0235  |ddm|= 8.6e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.636112626876231  LUMO = 13.3394785903949
  mo_energy =
[ -0.63611263  13.33947859  62.61068252 151.44430561 295.61331933
 516.937146  ]
E1 = -3.783217333919772  E_coul = 1.2551559776004348
cycle= 2 E= -2.52806135631934  delta_E= -1.49e-05  |g|= 0.00105  |ddm|= 95.9
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.63646876153145  LUMO = 13.3384384562534
  mo_energy =
[ -0.63646876  13.33843846  62.60852258 151.44186821 295.61061111
 516.93400935]
E1 = -3.7831816430021346  E_coul = 1.2551202411566624
cycle= 3 E= -2.52806140184547  delta_E= -4.55e-08  |g|= 4.78e-06  |ddm|= 6.55
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.636470669764982  LUMO = 13.3384308768347
  mo_energy =
[ -0.63647067  13.33843088  62.60850381 151.441836   295.61056511
 516.93394721]
E1 = -3.783181484311856  E_coul = 1.2551200858907587
cycle= 4 E= -2.5280613984211  delta_E= 3.42e-09  |g|= 3.92e-07  |ddm|= 0.0384
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.63647066268584  LUMO = 13.3384312200686
  mo_energy =
[ -0.63647066  13.33843122  62.60850522 151.44183799 295.61056496
 516.93393559]
E1 = -3.7831814826905066  E_coul = 1.255120067515389
cycle= 5 E= -2.52806141517512  delta_E= -1.68e-08  |g|= 3.45e-06  |ddm|= 0.00142
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.636470666483063  LUMO = 13.3384304061751
  mo_energy =
[ -0.63647067  13.33843041  62.6085012  151.44182731 295.61054609
 516.93390454]
E1 = -3.78318148830563  E_coul = 1.2551200828885607
cycle= 6 E= -2.52806140541707  delta_E= 9.76e-09  |g|= 6.12e-07  |ddm|= 0.00663
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.636470665129424  LUMO = 13.3384304123056
  mo_energy =
[ -0.63647067  13.33843041  62.60850115 151.44182659 295.61054366
 516.93389611]
E1 = -3.7831814884351784  E_coul = 1.2551200855823528
cycle= 7 E= -2.52806140285283  delta_E= 2.56e-09  |g|= 7.34e-07  |ddm|= 0.000388
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.636470663827661  LUMO = 13.3384304860878
  mo_energy =
[ -0.63647066  13.33843049  62.60850151 151.4418276  295.61054558
 516.93390026]
E1 = -3.783181488053302  E_coul = 1.2551200664080842
cycle= 8 E= -2.52806142164522  delta_E= -1.88e-08  |g|= 4.47e-06  |ddm|= 0.000595
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.636470666104142  LUMO = 13.3384300489442
  mo_energy =
[ -0.63647067  13.33843005  62.60849935 151.4418215  295.61053388
 516.93387614]
E1 = -3.783181491136636  E_coul = 1.2551200997306824
cycle= 9 E= -2.52806139140595  delta_E= 3.02e-08  |g|= 3.51e-06  |ddm|= 0.00383
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.636470662154484  LUMO = 13.3384303567219
  mo_energy =
[ -0.63647066  13.33843036  62.60850076 151.4418246  295.6105381
 516.9338796 ]
E1 = -3.7831814892850195  E_coul = 1.255120083766051
cycle= 10 E= -2.52806140551897  delta_E= -1.41e-08  |g|= 2.23e-07  |ddm|= 0.00199
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.636470661976775  LUMO = 13.3384303618805
  mo_energy =
[ -0.63647066  13.33843036  62.60850082 151.44182498 295.61053908
 516.93388167]
E1 = -3.7831814892409326  E_coul = 1.2551200541857792
cycle= 11 E= -2.52806143505515  delta_E= -2.95e-08  |g|= 7.19e-06  |ddm|= 0.000158
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.636470665597303  LUMO = 13.3384297832445
  mo_energy =
[ -0.63647067  13.33842978  62.60849798 151.44181712 295.61052432
 516.93385314]
E1 = -3.7831814932394994  E_coul = 1.2551200746752147
cycle= 12 E= -2.52806141856428  delta_E= 1.65e-08  |g|= 2.39e-06  |ddm|= 0.00488
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.636470667519447  LUMO = 13.3384293937099
  mo_energy =
[ -0.63647067  13.33842939  62.60849606 151.44181173 295.61051393
 516.93383112]
E1 = -3.783181496002293  E_coul = 1.2551200778298226
cycle= 13 E= -2.52806141817247  delta_E= 3.92e-10  |g|= 1.6e-06  |ddm|= 0.00337
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
E1 = -3.783181496002293  E_coul = 1.2551200778298226
  HOMO = -0.63647067013808  LUMO = 13.3384284294233
  mo_energy =
[ -0.63647067  13.33842843  62.60849133 151.44179866 295.61048956
 516.93378348]
E1 = -3.7831815030497538  E_coul = 1.2551200963457294
Extra cycle  E= -2.52806140670402  delta_E= 1.15e-08  |g|= 3.22e-06  |ddm|= 0.00844
    CPU time for scf_cycle      0.16 sec, wall time      0.16 sec
exp = [52.17532989 45.96826801 40.44102675 33.05184476 30.06694333  1.08065027]
E = -2.5280614067040243
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:09 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  10.9068933205        1
[INPUT] 0    0    [1    /1   ]  9.61312566318        1
[INPUT] 0    0    [1    /1   ]  8.46011175062        1
[INPUT] 0    0    [1    /1   ]  7.09805653686        1
[INPUT] 0    0    [1    /1   ]  6.43679708528        1
[INPUT] 0    0    [1    /1   ]  0.447870992131       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [10.906893320493403, 1.0]], [0, [9.613125663181501, 1.0]], [0, [8.460111750619035, 1.0]], [0, [7.098056536855388, 1.0]], [0, [6.4367970852754635, 1.0]], [0, [0.44787099213062836, 1.0]]]}
ecp = {}
CPU time:        66.34
Set gradient conv threshold to 3.16228e-05
cond(S) = 589721454.7767432

WARN: Singularity detected in overlap matrix (condition number = 5.9e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8268777099766886  E_coul = 1.0230261022414135
init E= -2.80385160773528
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.899773562629168  LUMO = 2.52866779226341
  mo_energy =
[ -0.89977356   2.52866779  12.6880005   30.8580382   61.30324634
 105.60256536]
E1 = -3.845468476520382  E_coul = 1.0226445636965145
cycle= 1 E= -2.82282391282387  delta_E= -0.019  |g|= 0.0185  |ddm|= 1.04e+05
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.9000972265338  LUMO = 2.53134538574136
  mo_energy =
[ -0.90009723   2.53134539  12.68625053  30.85458939  61.29830718
 105.5946731 ]
E1 = -3.844078390648735  E_coul = 1.021238036093831
cycle= 2 E= -2.8228403545549  delta_E= -1.64e-05  |g|= 0.000903  |ddm|= 2.9e+03
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.900814458414881  LUMO = 2.53052343647173
  mo_energy =
[ -0.90081446   2.53052344  12.68443178  30.85231903  61.29561334
 105.59114696]
E1 = -3.8439838678450697  E_coul = 1.0211440226660198
cycle= 3 E= -2.82283984517905  delta_E= 5.09e-07  |g|= 7.81e-05  |ddm|=  132
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.900850628810448  LUMO = 2.53049569208619
  mo_energy =
[ -0.90085063   2.53049569  12.6844146   30.85245594  61.29591481
 105.59189478]
E1 = -3.8439774926935373  E_coul = 1.021136393124271
cycle= 4 E= -2.82284109956927  delta_E= -1.25e-06  |g|= 0.000121  |ddm|= 12.3
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.900852270882001  LUMO = 2.53046798521355
  mo_energy =
[ -0.90085227   2.53046799  12.68426557  30.85200381  61.29518169
 105.59050076]
E1 = -3.843979511386184  E_coul = 1.0211389806146156
cycle= 5 E= -2.82284053077157  delta_E= 5.69e-07  |g|= 3.99e-05  |ddm|= 11.5
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900851668655793  LUMO = 2.53047229184596
  mo_energy =
[ -0.90085167   2.53047229  12.68428756  30.85205982  61.2952604
 105.59059754]
E1 = -3.8439792893479536  E_coul = 1.0211394493321329
cycle= 6 E= -2.82283984001582  delta_E= 6.91e-07  |g|= 9.05e-05  |ddm|= 1.26
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90085115979772  LUMO = 2.53048041877197
  mo_energy =
[ -0.90085116   2.53048042  12.6843313   30.85218475  61.29545179
 105.59091222]
E1 = -3.8439787129428757  E_coul = 1.0211386504545892
cycle= 7 E= -2.82284006248829  delta_E= -2.22e-07  |g|= 4.24e-05  |ddm|= 3.18
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900851040089495  LUMO = 2.5304830578472
  mo_energy =
[ -0.90085104   2.53048306  12.68434573  30.85222884  61.29552304
 105.59104644]
E1 = -3.8439785131234228  E_coul = 1.0211389973070737
cycle= 8 E= -2.82283951581635  delta_E= 5.47e-07  |g|= 8.86e-05  |ddm|= 1.13
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90085088095195  LUMO = 2.53048690669734
  mo_energy =
[ -0.90085088   2.53048691  12.68436659  30.85229585  61.29563697
 105.59128651]
E1 = -3.843978213493557  E_coul = 1.0211388789031874
cycle= 9 E= -2.82283933459037  delta_E= 1.81e-07  |g|= 9.02e-05  |ddm|= 1.74
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850747131369  LUMO = 2.53049012858486
  mo_energy =
[ -0.90085075   2.53049013  12.68438411  30.85235202  61.29573223
 105.59148934]
E1 = -3.8439779631310484  E_coul = 1.0211381988217791
cycle= 10 E= -2.82283976430927  delta_E= -4.3e-07  |g|= 2.51e-05  |ddm|= 1.46
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850771266089  LUMO = 2.53049109228515
  mo_energy =
[ -0.90085077   2.53049109  12.68438975  30.85236741  61.29575476
 105.59152056]
E1 = -3.8439778774261866  E_coul = 1.021137402402748
cycle= 11 E= -2.82284047502344  delta_E= -7.11e-07  |g|= 4.65e-05  |ddm|= 0.427
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850850419525  LUMO = 2.53048979851616
  mo_energy =
[ -0.90085085   2.5304898   12.68438289  30.85234428  61.29571363
 105.59142371]
E1 = -3.843977973826724  E_coul = 1.0211383306628847
cycle= 12 E= -2.82283964316384  delta_E= 8.32e-07  |g|= 5.02e-05  |ddm|= 0.592
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850644200227  LUMO = 2.53049385991796
  mo_energy =
[ -0.90085064   2.53049386  12.68440491  30.85241306  61.29582816
 105.59165638]
E1 = -3.843977669044607  E_coul = 1.021137398065425
cycle= 13 E= -2.82284027097918  delta_E= -6.28e-07  |g|= 3.56e-05  |ddm|= 1.76
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850529086879  LUMO = 2.5304953726852
  mo_energy =
[ -0.90085053   2.53049537  12.68441293  30.85243483  61.29585949
 105.59169854]
E1 = -3.843977566993826  E_coul = 1.021137033179964
cycle= 14 E= -2.82284053381386  delta_E= -2.63e-07  |g|= 7.2e-05  |ddm|= 0.551
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850202275701  LUMO = 2.53050088772401
  mo_energy =
[ -0.9008502    2.53050089  12.68444234  30.85254201  61.29605819
 105.59218444]
E1 = -3.843977147288593  E_coul = 1.0211372290518648
cycle= 15 E= -2.82283991823673  delta_E= 6.16e-07  |g|= 3.45e-05  |ddm|= 2.69
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850283172546  LUMO = 2.53050053945543
  mo_energy =
[ -0.90085028   2.53050054  12.68444095  30.85253545  61.29604584
 105.59214614]
E1 = -3.8439771627638324  E_coul = 1.021135841255077
cycle= 16 E= -2.82284132150876  delta_E= -1.4e-06  |g|= 0.00017  |ddm|= 0.156
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850156238435  LUMO = 2.53050418529231
  mo_energy =
[ -0.90085016   2.53050419  12.68446102  30.85259404  61.29613814
 105.59232567]
E1 = -3.843976880941708  E_coul = 1.021136653240047
cycle= 17 E= -2.82284022770166  delta_E= 1.09e-06  |g|= 7.65e-05  |ddm|= 1.53
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850570546289  LUMO = 2.53049569126337
  mo_energy =
[ -0.90085057   2.53049569  12.68441541  30.85243845  61.29586314
 105.59169951]
E1 = -3.8439775377885197  E_coul = 1.0211367121018542
cycle= 18 E= -2.82284082568667  delta_E= -5.98e-07  |g|= 8.16e-05  |ddm|=    4
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90085089427538  LUMO = 2.5304891854669
  mo_energy =
[ -0.90085089   2.53048919  12.68437959  30.85234207  61.29572319
 105.59151429]
E1 = -3.843978008042643  E_coul = 1.0211367220624368
cycle= 19 E= -2.82284128598021  delta_E= -4.6e-07  |g|= 0.000126  |ddm|= 2.46
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900851446351082  LUMO = 2.53047799862389
  mo_energy =
[ -0.90085145   2.530478    12.6843189   30.85213696  61.29535951
 105.59068478]
E1 = -3.8439788648737525  E_coul = 1.0211393147457535
cycle= 20 E= -2.822839550128  delta_E= 1.74e-06  |g|= 0.000109  |ddm|= 5.19
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900851079641049  LUMO = 2.53048546998362
  mo_energy =
[ -0.90085108   2.53048547  12.68435966  30.85226705  61.29557902
 105.59113294]
E1 = -3.8439783021953278  E_coul = 1.0211372995993027
cycle= 21 E= -2.82284100259603  delta_E= -1.45e-06  |g|= 6.38e-05  |ddm|=  3.3
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900851292875149  LUMO = 2.53048080253268
  mo_energy =
[ -0.90085129   2.5304808   12.68433414  30.85219349  61.29546598
 105.59094041]
E1 = -3.8439786510462866  E_coul = 1.021137962484535
cycle= 22 E= -2.82284068856175  delta_E= 3.14e-07  |g|= 1.79e-05  |ddm|=  1.9
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90085134776555  LUMO = 2.53047949916317
  mo_energy =
[ -0.90085135   2.5304795   12.68432696  30.85217319  61.29543411
 105.59087592]
E1 = -3.8439787485411023  E_coul = 1.0211390296346547
cycle= 23 E= -2.82283971890645  delta_E= 9.7e-07  |g|= 7.43e-05  |ddm|= 0.521
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90085119886466  LUMO = 2.53048271027508
  mo_energy =
[ -0.9008512    2.53048271  12.68434449  30.85222448  61.29551434
 105.59101499]
E1 = -3.843978507927225  E_coul = 1.0211392862095412
cycle= 24 E= -2.82283922171768  delta_E= 4.97e-07  |g|= 0.000108  |ddm|= 1.33
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900851015436762  LUMO = 2.53048673459392
  mo_energy =
[ -0.90085102   2.53048673  12.68436643  30.85229028  61.29562019
 105.59121172]
E1 = -3.843978204840814  E_coul = 1.0211385007849785
cycle= 25 E= -2.82283970405584  delta_E= -4.82e-07  |g|= 5.08e-05  |ddm|=  1.7
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850979819445  LUMO = 2.53048751778855
  mo_energy =
[ -0.90085098   2.53048752  12.68437067  30.85230283  61.29564037
 105.59125368]
E1 = -3.843978145690142  E_coul = 1.0211378648666947
cycle= 26 E= -2.82284028082345  delta_E= -5.77e-07  |g|= 9.58e-06  |ddm|= 0.328
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850998945056  LUMO = 2.53048724229453
  mo_energy =
[ -0.900851     2.53048724  12.68436936  30.85229393  61.29561936
 105.59117729]
E1 = -3.8439781712846224  E_coul = 1.0211388698876478
cycle= 27 E= -2.82283930139697  delta_E= 9.79e-07  |g|= 9.23e-05  |ddm|= 0.229
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90085074020197  LUMO = 2.53049270432636
  mo_energy =
[ -0.90085074   2.5304927   12.68439899  30.85239221  61.29579069
 105.59155512]
E1 = -3.8439777518391223  E_coul = 1.0211368738113866
cycle= 28 E= -2.82284087802774  delta_E= -1.58e-06  |g|= 9.5e-05  |ddm|= 2.51
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90085082047394  LUMO = 2.53049101281261
  mo_energy =
[ -0.90085082   2.53049101  12.68438982  30.85236008  61.29573201
 105.59141174]
E1 = -3.843977883085126  E_coul = 1.021137734378064
cycle= 29 E= -2.82284014870706  delta_E= 7.29e-07  |g|= 6.67e-06  |ddm|= 0.811
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850689379494  LUMO = 2.53049386909527
  mo_energy =
[ -0.90085069   2.53049387  12.68440537  30.85240704  61.29580733
 105.59155254]
E1 = -3.8439776671678554  E_coul = 1.0211369422258092
cycle= 30 E= -2.82284072494205  delta_E= -5.76e-07  |g|= 7.76e-05  |ddm|= 1.21
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850440984498  LUMO = 2.53049932050206
  mo_energy =
[ -0.90085044   2.53049932  12.68443514  30.85249696  61.29595318
 105.591833  ]
E1 = -3.843977255800964  E_coul = 1.0211367583016362
cycle= 31 E= -2.82284049749933  delta_E= 2.27e-07  |g|= 7.34e-05  |ddm|= 2.31
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850314417913  LUMO = 2.53050212424577
  mo_energy =
[ -0.90085031   2.53050212  12.68445049  30.85254366  61.29602988
 105.59198118]
E1 = -3.8439770447925716  E_coul = 1.0211369911316093
cycle= 32 E= -2.82284005366096  delta_E= 4.44e-07  |g|= 4.42e-05  |ddm|= 1.19
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850660997699  LUMO = 2.53049451463087
  mo_energy =
[ -0.90085066   2.53049451  12.68440889  30.85241966  61.29583096
 105.59161735]
E1 = -3.8439776165256236  E_coul = 1.0211373035122508
cycle= 33 E= -2.82284031301337  delta_E= -2.59e-07  |g|= 4.2e-05  |ddm|= 3.19
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850793638663  LUMO = 2.53049177858449
  mo_energy =
[ -0.90085079   2.53049178  12.68439423  30.85237535  61.29575861
 105.59146006]
E1 = -3.843977823089086  E_coul = 1.0211368228484552
cycle= 34 E= -2.82284100024063  delta_E= -6.87e-07  |g|= 8.79e-05  |ddm|= 1.16
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850912395602  LUMO = 2.53048917509697
  mo_energy =
[ -0.90085091   2.53048918  12.68437996  30.85233974  61.29570992
 105.59140926]
E1 = -3.843978010809584  E_coul = 1.0211380432096282
cycle= 35 E= -2.82283996759996  delta_E= 1.03e-06  |g|= 1.33e-05  |ddm|= 0.93
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900851373570804  LUMO = 2.53047899013164
  mo_energy =
[ -0.90085137   2.53047899  12.6843244   30.85216362  61.29541457
 105.59079966]
E1 = -3.8439787891475965  E_coul = 1.0211384537596222
cycle= 36 E= -2.82284033538797  delta_E= -3.68e-07  |g|= 2.3e-05  |ddm|= 4.51
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900851187582768  LUMO = 2.53048304988571
  mo_energy =
[ -0.90085119   2.53048305  12.68434645  30.85223663  61.29554057
 105.59108971]
E1 = -3.8439784749256405  E_coul = 1.021139464656961
cycle= 37 E= -2.82283901026868  delta_E= 1.33e-06  |g|= 0.000133  |ddm|= 1.87
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90085083939869  LUMO = 2.53049050604893
  mo_energy =
[ -0.90085084   2.53049051  12.6843867   30.85236103  61.29574567
 105.59150886]
E1 = -3.843977908087445  E_coul = 1.0211370484675315
cycle= 38 E= -2.82284085961991  delta_E= -1.85e-06  |g|= 7.65e-05  |ddm|= 3.24
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90085088954361  LUMO = 2.53048939585196
  mo_energy =
[ -0.90085089   2.5304894   12.68438066  30.85234352  61.29571876
 105.59145996]
E1 = -3.8439779915945693  E_coul = 1.0211377726463167
cycle= 39 E= -2.82284021894825  delta_E= 6.41e-07  |g|= 1.03e-05  |ddm|= 0.456
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90085089547945  LUMO = 2.53048927832303
  mo_energy =
[ -0.9008509    2.53048928  12.68437999  30.85234343  61.29572143
 105.59147944]
E1 = -3.8439779984267517  E_coul = 1.02113782849346
cycle= 40 E= -2.82284016993329  delta_E= 4.9e-08  |g|= 9.3e-06  |ddm|= 0.00622
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850802231928  LUMO = 2.53049131985789
  mo_energy =
[ -0.9008508    2.53049132  12.68439105  30.8523763   61.29577369
 105.59158028]
E1 = -3.8439778441418473  E_coul = 1.02113793148344
cycle= 41 E= -2.82283991265841  delta_E= 2.57e-07  |g|= 6.2e-06  |ddm|= 0.859
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850776410085  LUMO = 2.53049190282056
  mo_energy =
[ -0.90085078   2.5304919   12.68439427  30.85238528  61.29578701
 105.59160012]
E1 = -3.8439778008962935  E_coul = 1.0211376791365767
cycle= 42 E= -2.82284012175972  delta_E= -2.09e-07  |g|= 9.81e-06  |ddm|= 0.231
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850756724959  LUMO = 2.53049234999755
  mo_energy =
[ -0.90085076   2.53049235  12.6843967   30.85239273  61.29579928
 105.59162539]
E1 = -3.8439777668534605  E_coul = 1.021137920612321
cycle= 43 E= -2.82283984624114  delta_E= 2.76e-07  |g|= 1.2e-05  |ddm|= 0.193
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850763082019  LUMO = 2.53049223630118
  mo_energy =
[ -0.90085076   2.53049224  12.6843961   30.85239118  61.29579709
 105.59162327]
E1 = -3.8439777749141855  E_coul = 1.021137004398175
cycle= 44 E= -2.82284077051601  delta_E= -9.24e-07  |g|= 7.38e-05  |ddm|= 0.0413
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850127002179  LUMO = 2.53050581463688
  mo_energy =
[ -0.90085013   2.53050581  12.6844694   30.85261897  61.29617527
 105.59240428]
E1 = -3.8439767424927958  E_coul = 1.0211363149912673
cycle= 45 E= -2.82284042750153  delta_E= 3.43e-07  |g|= 0.000106  |ddm|= 5.92
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900851000697932  LUMO = 2.53048687632339
  mo_energy =
[ -0.900851     2.53048688  12.68436687  30.85231043  61.2956784
 105.59142356]
E1 = -3.8439781754543154  E_coul = 1.0211381668057844
cycle= 46 E= -2.82284000864853  delta_E= 4.19e-07  |g|= 1.5e-05  |ddm|= 8.04
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850834026921  LUMO = 2.53049072684075
  mo_energy =
[ -0.90085083   2.53049073  12.68438796  30.85237085  61.29577067
 105.5915714 ]
E1 = -3.8439778868098498  E_coul = 1.0211376066390028
cycle= 47 E= -2.82284028017085  delta_E= -2.72e-07  |g|= 3.28e-05  |ddm|= 1.57
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90085083178834  LUMO = 2.53049085273891
  mo_energy =
[ -0.90085083   2.53049085  12.68438875  30.85236577  61.29575093
 105.59147715]
E1 = -3.8439778839024634  E_coul = 1.021138374431507
cycle= 48 E= -2.82283950947096  delta_E= 7.71e-07  |g|= 4.94e-05  |ddm|= 0.108
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850688591905  LUMO = 2.53049401170442
  mo_energy =
[ -0.90085069   2.53049401  12.68440587  30.85241859  61.29583781
 105.59165675]
E1 = -3.8439776429655974  E_coul = 1.021138136325703
cycle= 49 E= -2.82283950663989  delta_E= 2.83e-09  |g|= 3.71e-05  |ddm|= 1.37
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.900850665988153  LUMO = 2.53049446190603
  mo_energy =
[ -0.90085067   2.53049446  12.6844082   30.85242704  61.29585387
 105.59170269]
E1 = -3.8439776072015372  E_coul = 1.0211376856893424
cycle= 50 E= -2.82283992151219  delta_E= -4.15e-07  |g|= 1.09e-05  |ddm|= 0.223
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8439776072015372  E_coul = 1.0211376856893424

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.900851117886595  LUMO = 2.53049308177398
  mo_energy =
[ -0.90085112   2.53049308  12.68440382  30.85239724  61.29578259
 105.59142013]
E1 = -3.843977653640585  E_coul = 1.0211370204883248
Extra cycle  E= -2.82284063315226  delta_E= -7.12e-07  |g|= 6.47e-05  |ddm|=  0.7
    CPU time for scf_cycle      0.50 sec, wall time      0.50 sec
exp = [10.90689332  9.61312566  8.46011175  7.09805654  6.43679709  0.44787099]
E = -2.82284063315226
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:10 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.78004966383        1
[INPUT] 0    0    [1    /1   ]  5.97761142804        1
[INPUT] 0    0    [1    /1   ]  5.2620202502         1
[INPUT] 0    0    [1    /1   ]  4.50267771477        1
[INPUT] 0    0    [1    /1   ]  4.07378246056        1
[INPUT] 0    0    [1    /1   ]  0.384593063903       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.780049663827604, 1.0]], [0, [5.977611428037879, 1.0]], [0, [5.262020250198331, 1.0]], [0, [4.502677714766108, 1.0]], [0, [4.073782460555174, 1.0]], [0, [0.38459306390348397, 1.0]]]}
ecp = {}
CPU time:        67.13
Set gradient conv threshold to 3.16228e-05
cond(S) = 901328344.9579072

WARN: Singularity detected in overlap matrix (condition number = 9.01e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8560208316819264  E_coul = 1.0241860824788278
init E= -2.8318347492031
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906624179870183  LUMO = 1.68754121107284
  mo_energy =
[-0.90662418  1.68754121  8.05701138 19.305307   38.42473174 65.54714709]
E1 = -3.8656085419186206  E_coul = 1.0281661276109895
cycle= 1 E= -2.83744241430763  delta_E= -0.00561  |g|= 0.00517  |ddm|= 1.18e+04
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904638748837146  LUMO = 1.69135423919964
  mo_energy =
[-0.90463875  1.69135424  8.06134536 19.30952389 38.42885018 65.55014261]
E1 = -3.865199946740645  E_coul = 1.0277551088572818
cycle= 2 E= -2.83744483788336  delta_E= -2.42e-06  |g|= 0.000241  |ddm|=  369
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904856152997536  LUMO = 1.6911922096178
  mo_energy =
[-0.90485615  1.69119221  8.06084674 19.30859491 38.4275553  65.54792726]
E1 = -3.865180374946842  E_coul = 1.0277357097643902
cycle= 3 E= -2.83744466518245  delta_E= 1.73e-07  |g|= 2.37e-05  |ddm|= 26.8
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904854452107606  LUMO = 1.69119856701961
  mo_energy =
[-0.90485445  1.69119857  8.06087663 19.30869703 38.42773535 65.5482781 ]
E1 = -3.865180143442165  E_coul = 1.0277363439395735
cycle= 4 E= -2.83744379950259  delta_E= 8.66e-07  |g|= 8.4e-05  |ddm|= 3.94
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854076772611  LUMO = 1.69120636017972
  mo_energy =
[-0.90485408  1.69120636  8.06091554 19.30884513 38.42798829 65.54890011]
E1 = -3.8651793630559275  E_coul = 1.0277342338809226
cycle= 5 E= -2.837445129175  delta_E= -1.33e-06  |g|= 8.15e-05  |ddm|=   10
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854614470802  LUMO = 1.69119953993789
  mo_energy =
[-0.90485461  1.69119954  8.0608797  19.30873373 38.42781841 65.54860903]
E1 = -3.8651799276530916  E_coul = 1.0277369039540247
cycle= 6 E= -2.83744302369907  delta_E= 2.11e-06  |g|= 0.000136  |ddm|= 6.78
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854165762203  LUMO = 1.69120785542852
  mo_energy =
[-0.90485417  1.69120786  8.06092282 19.30887399 38.42803566 65.5490466 ]
E1 = -3.8651791622279585  E_coul = 1.0277336887364121
cycle= 7 E= -2.83744547349155  delta_E= -2.45e-06  |g|= 0.000126  |ddm|= 9.15
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854511278382  LUMO = 1.69120211148725
  mo_energy =
[-0.90485451  1.69120211  8.06089312 19.30877226 38.42787205 65.54870277]
E1 = -3.865179688113363  E_coul = 1.0277352778557995
cycle= 8 E= -2.83744441025756  delta_E= 1.06e-06  |g|= 8.58e-07  |ddm|= 6.52
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854520583915  LUMO = 1.69120204375536
  mo_energy =
[-0.90485452  1.69120204  8.06089263 19.3087723  38.42787468 65.54873297]
E1 = -3.8651796889934094  E_coul = 1.0277345573304826
cycle= 9 E= -2.83744513166293  delta_E= -7.21e-07  |g|= 5.9e-05  |ddm|= 0.0518
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854608499332  LUMO = 1.69120118494919
  mo_energy =
[-0.90485461  1.69120118  8.06088771 19.30876342 38.42786881 65.54876539]
E1 = -3.8651797408544843  E_coul = 1.0277349564867289
cycle= 10 E= -2.83744478436776  delta_E= 3.47e-07  |g|= 3.62e-05  |ddm|= 0.412
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854320617023  LUMO = 1.69120551540717
  mo_energy =
[-0.90485432  1.69120552  8.06091041 19.30883418 38.42797519 65.54895056]
E1 = -3.8651793687402205  E_coul = 1.027735335452666
cycle= 11 E= -2.83744403328755  delta_E= 7.51e-07  |g|= 1.14e-05  |ddm|= 4.41
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854301796008  LUMO = 1.69120620402611
  mo_energy =
[-0.9048543   1.6912062   8.06091428 19.30884331 38.42798542 65.5489501 ]
E1 = -3.865179309784266  E_coul = 1.0277348950074614
cycle= 12 E= -2.8374444147768  delta_E= -3.81e-07  |g|= 1.62e-05  |ddm|= 0.564
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854412447893  LUMO = 1.69120489706583
  mo_energy =
[-0.90485441  1.6912049   8.06090773 19.30882009 38.42794679 65.54886466]
E1 = -3.86517942409864  E_coul = 1.0277354209109326
cycle= 13 E= -2.83744400318771  delta_E= 4.12e-07  |g|= 2.46e-05  |ddm|= 1.48
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854361995127  LUMO = 1.6912058703918
  mo_energy =
[-0.90485436  1.69120587  8.06091282 19.30883824 38.42797718 65.54893057]
E1 = -3.8651793319473535  E_coul = 1.0277362464702091
cycle= 14 E= -2.83744308547714  delta_E= 9.18e-07  |g|= 0.000106  |ddm|= 1.16
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854615151896  LUMO = 1.69120132621511
  mo_energy =
[-0.90485462  1.69120133  8.06088916 19.30876326 38.42786349 65.54871747]
E1 = -3.8651797450846246  E_coul = 1.0277361918928725
cycle= 15 E= -2.83744355319175  delta_E= -4.68e-07  |g|= 7.87e-05  |ddm|= 4.88
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854521932253  LUMO = 1.69120310248288
  mo_energy =
[-0.90485452  1.6912031   8.06089834 19.30879072 38.42790222 65.54877964]
E1 = -3.8651795826761464  E_coul = 1.0277351307765747
cycle= 16 E= -2.83744445189957  delta_E= -8.99e-07  |g|= 1.64e-05  |ddm|= 1.84
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854544203091  LUMO = 1.69120293497041
  mo_energy =
[-0.90485454  1.69120293  8.06089815 19.30878407 38.42788449 65.54868918]
E1 = -3.865179611656272  E_coul = 1.0277333132661386
cycle= 17 E= -2.83744629839013  delta_E= -1.85e-06  |g|= 0.000184  |ddm|= 0.568
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854705464099  LUMO = 1.69120034145688
  mo_energy =
[-0.90485471  1.69120034  8.06088555 19.30872975 38.42778453 65.54841278]
E1 = -3.86517987379235  E_coul = 1.0277360240076316
cycle= 18 E= -2.83744384978472  delta_E= 2.45e-06  |g|= 6.65e-05  |ddm|= 3.63
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854411510977  LUMO = 1.69120537824476
  mo_energy =
[-0.90485441  1.69120538  8.06091178 19.30881919 38.4279299  65.54871893]
E1 = -3.865179409799234  E_coul = 1.0277365677850254
cycle= 19 E= -2.83744284201421  delta_E= 1.01e-06  |g|= 0.00013  |ddm|= 5.74
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9048544119642  LUMO = 1.69120544225849
  mo_energy =
[-0.90485441  1.69120544  8.06091221 19.30881882 38.42792734 65.5487044 ]
E1 = -3.865179407015223  E_coul = 1.0277355800062833
cycle= 20 E= -2.83744382700894  delta_E= -9.85e-07  |g|= 4.08e-05  |ddm|= 0.0329
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854450590214  LUMO = 1.69120470430694
  mo_energy =
[-0.90485445  1.6912047   8.06090843 19.30880611 38.42790716 65.54866062]
E1 = -3.865179476501465  E_coul = 1.0277354089842188
cycle= 21 E= -2.83744406751725  delta_E= -2.41e-07  |g|= 2.1e-05  |ddm|= 0.843
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854449980278  LUMO = 1.69120475677571
  mo_energy =
[-0.90485445  1.69120476  8.06090885 19.30880632 38.42790627 65.54864934]
E1 = -3.865179474926086  E_coul = 1.0277362678163324
cycle= 22 E= -2.83744320710975  delta_E= 8.6e-07  |g|= 0.000103  |ddm|= 0.0217
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854418442226  LUMO = 1.69120532546337
  mo_energy =
[-0.90485442  1.69120533  8.06091173 19.30881684 38.42792402 65.54869264]
E1 = -3.865179420232871  E_coul = 1.0277360159631221
cycle= 23 E= -2.83744340426975  delta_E= -1.97e-07  |g|= 7.94e-05  |ddm|= 0.695
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854748200597  LUMO = 1.69119917308652
  mo_energy =
[-0.90485475  1.69119917  8.06088044 19.30870935 38.42775272 65.54831461]
E1 = -3.865180003457844  E_coul = 1.0277355875258796
cycle= 24 E= -2.83744441593196  delta_E= -1.01e-06  |g|= 2e-05  |ddm|= 7.14
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854435561842  LUMO = 1.69120471205492
  mo_energy =
[-0.90485444  1.69120471  8.06090833 19.30880728 38.42790906 65.54866212]
E1 = -3.865179475649133  E_coul = 1.027735981214682
cycle= 25 E= -2.83744349443445  delta_E= 9.21e-07  |g|= 7.82e-05  |ddm|= 6.52
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854040682871  LUMO = 1.69121204815169
  mo_energy =
[-0.90485404  1.69121205  8.0609458  19.30893914 38.42812422 65.54914516]
E1 = -3.865178777945484  E_coul = 1.0277359208220804
cycle= 26 E= -2.8374428571234  delta_E= 6.37e-07  |g|= 9.02e-05  |ddm|= 8.67
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854056199152  LUMO = 1.69121176517423
  mo_energy =
[-0.90485406  1.69121177  8.06094434 19.30893446 38.42811672 65.54913752]
E1 = -3.8651788040034902  E_coul = 1.027734789077388
cycle= 27 E= -2.8374440149261  delta_E= -1.16e-06  |g|= 1.3e-05  |ddm|= 0.308
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854070019442  LUMO = 1.69121151449254
  mo_energy =
[-0.90485407  1.69121151  8.06094312 19.30892988 38.42810928 65.54912172]
E1 = -3.8651788282112007  E_coul = 1.0277354417487228
cycle= 28 E= -2.83744338646248  delta_E= 6.28e-07  |g|= 5.81e-05  |ddm|= 0.306
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854044153524  LUMO = 1.69121208588636
  mo_energy =
[-0.90485404  1.69121209  8.06094627 19.30893953 38.42812321 65.54913581]
E1 = -3.8651787779856415  E_coul = 1.0277349815092798
cycle= 29 E= -2.83744379647636  delta_E= -4.1e-07  |g|= 1.3e-05  |ddm|= 0.573
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904853968579008  LUMO = 1.69121348493984
  mo_energy =
[-0.90485397  1.69121348  8.06095295 19.30896434 38.42816364 65.5492453 ]
E1 = -3.8651786364515703  E_coul = 1.0277335930849483
cycle= 30 E= -2.83744504336662  delta_E= -1.25e-06  |g|= 0.000105  |ddm|= 1.77
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854060857449  LUMO = 1.69121181625695
  mo_energy =
[-0.90485406  1.69121182  8.0609444  19.30893308 38.42810937 65.54910563]
E1 = -3.8651787952482186  E_coul = 1.027733836195326
cycle= 31 E= -2.83744495905289  delta_E= 8.43e-08  |g|= 9.59e-05  |ddm|= 2.04
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854218524371  LUMO = 1.69120882536564
  mo_energy =
[-0.90485422  1.69120883  8.06092871 19.30888467 38.42803582 65.54895054]
E1 = -3.865179065914652  E_coul = 1.0277344927983636
cycle= 32 E= -2.83744457311629  delta_E= 3.86e-07  |g|= 4.6e-05  |ddm|= 3.16
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904853824749473  LUMO = 1.69121642528108
  mo_energy =
[-0.90485382  1.69121643  8.06096786 19.30901082 38.42823029 65.5493589 ]
E1 = -3.865178362684224  E_coul = 1.0277334689335134
cycle= 33 E= -2.83744489375071  delta_E= -3.21e-07  |g|= 0.000112  |ddm|= 8.33
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904853776544163  LUMO = 1.69121758575658
  mo_energy =
[-0.90485378  1.69121759  8.06097322 19.3090498  38.42831652 65.54964836]
E1 = -3.865178202955201  E_coul = 1.0277324983650928
cycle= 34 E= -2.83744570459011  delta_E= -8.11e-07  |g|= 0.000193  |ddm|= 2.67
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904853131032545  LUMO = 1.69122968123133
  mo_energy =
[-0.90485313  1.69122968  8.06103654 19.30925248 38.42863072 65.55028726]
E1 = -3.8651771049787618  E_coul = 1.027734067633541
cycle= 35 E= -2.83744303734522  delta_E= 2.67e-06  |g|= 1.07e-05  |ddm|=   13
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904855238253967  LUMO = 1.69118909765428
  mo_energy =
[-0.90485524  1.6911891   8.06082599 19.30854704 38.4275138  65.547932  ]
E1 = -3.8651808943021835  E_coul = 1.0277374955466843
cycle= 36 E= -2.8374433987555  delta_E= -3.61e-07  |g|= 0.000149  |ddm|= 45.9
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854497662446  LUMO = 1.69120442427941
  mo_energy =
[-0.9048545   1.69120442  8.06090693 19.30880113 38.42789678 65.54863972]
E1 = -3.865179495109069  E_coul = 1.0277356045770805
cycle= 37 E= -2.83744389053199  delta_E= -4.92e-07  |g|= 4.3e-05  |ddm|= 16.3
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854482595483  LUMO = 1.69120468751487
  mo_energy =
[-0.90485448  1.69120469  8.06090846 19.30880544 38.42790403 65.5486588 ]
E1 = -3.8651794739406142  E_coul = 1.027734551185926
cycle= 38 E= -2.83744492275469  delta_E= -1.03e-06  |g|= 5.03e-05  |ddm|= 0.249
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854511864667  LUMO = 1.69120398145685
  mo_energy =
[-0.90485451  1.69120398  8.06090471 19.30879375 38.42788681 65.54862433]
E1 = -3.8651795394300166  E_coul = 1.0277353415329928
cycle= 39 E= -2.83744419789702  delta_E= 7.25e-07  |g|= 1.55e-05  |ddm|= 0.759
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854425004103  LUMO = 1.69120537678136
  mo_energy =
[-0.90485443  1.69120538  8.06091158 19.3088216  38.42793645 65.54875874]
E1 = -3.8651794000572455  E_coul = 1.0277359694645358
cycle= 40 E= -2.83744343059271  delta_E= 7.67e-07  |g|= 8.53e-05  |ddm|= 1.87
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854263547589  LUMO = 1.69120814585116
  mo_energy =
[-0.90485426  1.69120815  8.06092543 19.30887492 38.42802944 65.54899641]
E1 = -3.8651791292518056  E_coul = 1.0277346054385397
cycle= 41 E= -2.83744452381327  delta_E= -1.09e-06  |g|= 3.1e-05  |ddm|= 3.55
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854265001884  LUMO = 1.69120789865612
  mo_energy =
[-0.90485427  1.6912079   8.06092344 19.30887497 38.428036   65.54905352]
E1 = -3.8651791355280953  E_coul = 1.0277357116926735
cycle= 42 E= -2.83744342383542  delta_E= 1.1e-06  |g|= 5.82e-05  |ddm|= 0.149
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854075332799  LUMO = 1.69121163141736
  mo_energy =
[-0.90485408  1.69121163  8.06094305 19.30893891 38.42813614 65.54925284]
E1 = -3.865178792395141  E_coul = 1.0277354957597653
cycle= 43 E= -2.83744329663538  delta_E= 1.27e-07  |g|= 5.05e-05  |ddm|= 4.11
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854018036264  LUMO = 1.69121290074384
  mo_energy =
[-0.90485402  1.6912129   8.06094981 19.30895818 38.42816277 65.54929392]
E1 = -3.86517867907423  E_coul = 1.0277331239047576
cycle= 44 E= -2.83744555516947  delta_E= -2.26e-06  |g|= 0.000155  |ddm|= 1.25
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904853990903563  LUMO = 1.69121234501685
  mo_energy =
[-0.90485399  1.69121235  8.06094592 19.30896259 38.4281925  65.54946136]
E1 = -3.8651787032320724  E_coul = 1.0277346799232023
cycle= 45 E= -2.83744402330887  delta_E= 1.53e-06  |g|= 2.74e-05  |ddm|= 0.392
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854081604802  LUMO = 1.69120994587167
  mo_energy =
[-0.90485408  1.69120995  8.06093198 19.30893002 38.42815456 65.54945654]
E1 = -3.8651788949687984  E_coul = 1.0277343432402117
cycle= 46 E= -2.83744455172859  delta_E= -5.28e-07  |g|= 4.85e-05  |ddm|= 1.85
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904853605431747  LUMO = 1.69121881965647
  mo_energy =
[-0.90485361  1.69121882  8.06097725 19.30908913 38.42841511 65.55005788]
E1 = -3.8651780495675068  E_coul = 1.0277346543428276
cycle= 47 E= -2.83744339522468  delta_E= 1.16e-06  |g|= 7.58e-06  |ddm|= 10.5
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854084212811  LUMO = 1.69121003179344
  mo_energy =
[-0.90485408  1.69121003  8.06093227 19.30893146 38.42815558 65.54945482]
E1 = -3.865178886037018  E_coul = 1.0277336687535825
cycle= 48 E= -2.83744521728344  delta_E= -1.82e-06  |g|= 0.000124  |ddm|= 10.4
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90485498794902  LUMO = 1.69119437151377
  mo_energy =
[-0.90485499  1.69119437  8.06085166 19.30864801 38.42768456 65.54838125]
E1 = -3.8651803520542045  E_coul = 1.0277352208761386
cycle= 49 E= -2.83744513117807  delta_E= 8.61e-08  |g|= 4.81e-05  |ddm|= 18.4
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904854909026967  LUMO = 1.69119741000629
  mo_energy =
[-0.90485491  1.69119741  8.06087155 19.30867735 38.42769497 65.54817696]
E1 = -3.8651801574312423  E_coul = 1.0277361938655216
cycle= 50 E= -2.83744396356572  delta_E= 1.17e-06  |g|= 7.65e-05  |ddm|= 1.15
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8651801574312423  E_coul = 1.0277361938655216

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904853884887735  LUMO = 1.69120960316614
  mo_energy =
[-0.90485388  1.6912096   8.06092897 19.30893258 38.42816813 65.54950252]
E1 = -3.865178958895405  E_coul = 1.027734405813767
Extra cycle  E= -2.83744455308164  delta_E= -5.9e-07  |g|= 5.73e-05  |ddm|=   17
    CPU time for scf_cycle      0.49 sec, wall time      0.49 sec
exp = [6.78004966 5.97761143 5.26202025 4.50267771 4.07378246 0.38459306]
E = -2.837444553081638
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:10 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.38499419705        1
[INPUT] 0    0    [1    /1   ]  5.62959006047        1
[INPUT] 0    0    [1    /1   ]  4.95587258976        1
[INPUT] 0    0    [1    /1   ]  4.25422667632        1
[INPUT] 0    0    [1    /1   ]  3.84757523701        1
[INPUT] 0    0    [1    /1   ]  0.378535579406       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.384994197054696, 1.0]], [0, [5.629590060471803, 1.0]], [0, [4.9558725897604425, 1.0]], [0, [4.254226676317661, 1.0]], [0, [3.8475752370146763, 1.0]], [0, [0.3785355794063867, 1.0]]]}
ecp = {}
CPU time:        67.92
Set gradient conv threshold to 3.16228e-05
cond(S) = 969267486.5281507

WARN: Singularity detected in overlap matrix (condition number = 9.69e+08). SCF may be inaccurate and hard to converge.

E1 = -3.856610700340705  E_coul = 1.024231111796371
init E= -2.83237958854433
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906689229541057  LUMO = 1.61027524737984
  mo_energy =
[-0.90668923  1.61027525  7.6219264  18.21436191 36.25250202 61.75327547]
E1 = -3.86630944662505  E_coul = 1.0286862671467842
cycle= 1 E= -2.83762317947827  delta_E= -0.00524  |g|= 0.00587  |ddm|= 6.97e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904469278697337  LUMO = 1.6142076587547
  mo_energy =
[-0.90446928  1.61420766  7.62676996 18.21926534 36.2574846  61.75762883]
E1 = -3.866037860935902  E_coul = 1.0284122945424514
cycle= 2 E= -2.83762556639345  delta_E= -2.39e-06  |g|= 0.000369  |ddm|=  464
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904614667105044  LUMO = 1.61412779578017
  mo_energy =
[-0.90461467  1.6141278   7.62650274 18.21871578 36.25665171 61.75568586]
E1 = -3.866033573786602  E_coul = 1.0284075644549122
cycle= 3 E= -2.83762600933169  delta_E= -4.43e-07  |g|= 3.86e-05  |ddm|= 79.6
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904607710705363  LUMO = 1.61412232418577
  mo_energy =
[-0.90460771  1.61412232  7.626454   18.21855087 36.25640591 61.75531993]
E1 = -3.866036023771433  E_coul = 1.0284103334946504
cycle= 4 E= -2.83762569027678  delta_E= 3.19e-07  |g|= 4.28e-05  |ddm|= 16.9
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904607780806465  LUMO = 1.61412969995919
  mo_energy =
[-0.90460778  1.6141297   7.62649177 18.21868829 36.2566329  61.75592601]
E1 = -3.8660351795467887  E_coul = 1.028406977619188
cycle= 5 E= -2.8376282019276  delta_E= -2.51e-06  |g|= 0.00022  |ddm|= 10.6
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904609149634604  LUMO = 1.61410601924176
  mo_energy =
[-0.90460915  1.61410602  7.62637079 18.21829311 36.25602749 61.7546799 ]
E1 = -3.866037340494379  E_coul = 1.0284113543920153
cycle= 6 E= -2.83762598610236  delta_E= 2.22e-06  |g|= 8.37e-05  |ddm|=   29
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608571152703  LUMO = 1.61411156847229
  mo_energy =
[-0.90460857  1.61411157  7.62639843 18.21838536 36.256174   61.75497686]
E1 = -3.866036901546491  E_coul = 1.0284135773402243
cycle= 7 E= -2.83762332420627  delta_E= 2.66e-06  |g|= 0.000297  |ddm|= 6.38
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607667948931  LUMO = 1.61412739662486
  mo_energy =
[-0.90460767  1.6141274   7.62648016 18.21865424 36.25659091 61.75579988]
E1 = -3.866035466088424  E_coul = 1.0284090867906728
cycle= 8 E= -2.83762637929775  delta_E= -3.06e-06  |g|= 4.46e-05  |ddm|= 19.4
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607869285704  LUMO = 1.61412503534337
  mo_energy =
[-0.90460787  1.61412504  7.62646777 18.2186169  36.25653466 61.75570449]
E1 = -3.8660356499894766  E_coul = 1.0284094553260954
cycle= 9 E= -2.83762619466338  delta_E= 1.85e-07  |g|= 2.7e-05  |ddm|= 2.49
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607960272601  LUMO = 1.61412425037848
  mo_energy =
[-0.90460796  1.61412425  7.62646399 18.21860284 36.25651132 61.75565276]
E1 = -3.8660357140153003  E_coul = 1.028410957688607
cycle= 10 E= -2.83762475632669  delta_E= 1.44e-06  |g|= 0.000114  |ddm|= 0.987
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607879387861  LUMO = 1.61412672657446
  mo_energy =
[-0.90460788  1.61412673  7.62647673 18.21864824 36.25658596 61.75582241]
E1 = -3.86603546335525  E_coul = 1.0284075402026243
cycle= 11 E= -2.83762792315263  delta_E= -3.17e-06  |g|= 0.00019  |ddm|= 3.43
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90460809284974  LUMO = 1.61412226325217
  mo_energy =
[-0.90460809  1.61412226  7.62645411 18.21857216 36.25646753 61.75556189]
E1 = -3.866035890990339  E_coul = 1.0284103448065596
cycle= 12 E= -2.83762554618378  delta_E= 2.38e-06  |g|= 6.16e-05  |ddm|= 5.73
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608017017748  LUMO = 1.61412340582504
  mo_energy =
[-0.90460802  1.61412341  7.62645923 18.21859821 36.25651828 61.75571595]
E1 = -3.866035764450956  E_coul = 1.0284114858016769
cycle= 13 E= -2.83762427864928  delta_E= 1.27e-06  |g|= 0.000151  |ddm|= 2.06
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607556560479  LUMO = 1.61413222272194
  mo_energy =
[-0.90460756  1.61413222  7.62650462 18.21874701 36.25674776 61.75617959]
E1 = -3.866034950124315  E_coul = 1.028408092856868
cycle= 14 E= -2.83762685726745  delta_E= -2.58e-06  |g|= 0.000133  |ddm|= 10.9
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607011174869  LUMO = 1.61414292551115
  mo_energy =
[-0.90460701  1.61414293  7.62656032 18.21892782 36.25702567 61.75671536]
E1 = -3.866033970177008  E_coul = 1.0284073758080374
cycle= 15 E= -2.83762659436897  delta_E= 2.63e-07  |g|= 0.000144  |ddm|=   13
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607515193514  LUMO = 1.6141323582105
  mo_energy =
[-0.90460752  1.61413236  7.62650423 18.21875571 36.25677228 61.75629839]
E1 = -3.866034915989801  E_coul = 1.0284083912888191
cycle= 16 E= -2.83762652470098  delta_E= 6.97e-08  |g|= 9.27e-05  |ddm|= 12.2
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607523375968  LUMO = 1.61413258747731
  mo_energy =
[-0.90460752  1.61413259  7.62650571 18.21875862 36.2567754  61.75629339]
E1 = -3.8660348967000404  E_coul = 1.0284070362736901
cycle= 17 E= -2.83762786042635  delta_E= -1.34e-06  |g|= 0.000208  |ddm|= 0.171
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607581825476  LUMO = 1.61413153228404
  mo_energy =
[-0.90460758  1.61413153  7.62649994 18.21874446 36.25675861 61.75628149]
E1 = -3.8660349808630006  E_coul = 1.0284084664420383
cycle= 18 E= -2.83762651442096  delta_E= 1.35e-06  |g|= 9.83e-05  |ddm|= 0.957
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607925406992  LUMO = 1.61412542327755
  mo_energy =
[-0.90460793  1.61412542  7.62646888 18.21863541 36.25658096 61.75588235]
E1 = -3.8660355569533897  E_coul = 1.0284102410659324
cycle= 19 E= -2.83762531588746  delta_E= 1.2e-06  |g|= 4.51e-05  |ddm|= 8.03
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607296978091  LUMO = 1.61413788757811
  mo_energy =
[-0.9046073   1.61413789  7.62653309 18.2188456  36.25690433 61.75652172]
E1 = -3.866034400871553  E_coul = 1.0284109503046492
cycle= 20 E= -2.8376234505669  delta_E= 1.87e-06  |g|= 0.000163  |ddm|= 15.4
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607482142499  LUMO = 1.61413604528369
  mo_energy =
[-0.90460748  1.61413605  7.62652621 18.21879053 36.25678282 61.75609683]
E1 = -3.8660346353482207  E_coul = 1.028410824642982
cycle= 21 E= -2.83762381070524  delta_E= -3.6e-07  |g|= 0.000152  |ddm|= 4.47
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608455763677  LUMO = 1.61411760025431
  mo_energy =
[-0.90460846  1.6141176   7.62643167 18.21847032 36.25627507 61.75500669]
E1 = -3.866036360049841  E_coul = 1.0284095844673462
cycle= 22 E= -2.83762677558249  delta_E= -2.96e-06  |g|= 2.85e-05  |ddm|= 23.5
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608415561168  LUMO = 1.61411635084443
  mo_energy =
[-0.90460842  1.61411635  7.62642387 18.21847291 36.25631328 61.75523155]
E1 = -3.866036436744425  E_coul = 1.0284091469394743
cycle= 23 E= -2.83762728980495  delta_E= -5.14e-07  |g|= 8.47e-05  |ddm|= 0.222
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608768002971  LUMO = 1.61410996082437
  mo_energy =
[-0.90460877  1.61410996  7.62639218 18.21835766 36.25612433 61.75479266]
E1 = -3.86603705668858  E_coul = 1.028410754102674
cycle= 24 E= -2.83762630258591  delta_E= 9.87e-07  |g|= 4.75e-05  |ddm|= 8.69
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90460831181799  LUMO = 1.61411828004594
  mo_energy =
[-0.90460831  1.61411828  7.626434   18.21850555 36.25636375 61.75533009]
E1 = -3.8660362628719565  E_coul = 1.0284098965400823
cycle= 25 E= -2.83762636633187  delta_E= -6.37e-08  |g|= 2.19e-05  |ddm|=   11
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608056211653  LUMO = 1.61412333937143
  mo_energy =
[-0.90460806  1.61412334  7.62646061 18.21858567 36.25647898 61.7555077 ]
E1 = -3.8660358117351223  E_coul = 1.0284092038962707
cycle= 26 E= -2.83762660783885  delta_E= -2.42e-07  |g|= 4.3e-05  |ddm|= 5.74
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607994162725  LUMO = 1.61412425591799
  mo_energy =
[-0.90460799  1.61412426  7.626465   18.21860611 36.25651821 61.75561764]
E1 = -3.8660357171680055  E_coul = 1.0284096323390548
cycle= 27 E= -2.83762608482895  delta_E= 5.23e-07  |g|= 5.72e-06  |ddm|= 1.52
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608075876971  LUMO = 1.61412240223109
  mo_energy =
[-0.90460808  1.6141224   7.62645528 18.21857594 36.25647378 61.755544  ]
E1 = -3.8660358866344158  E_coul = 1.028409768956095
cycle= 28 E= -2.83762611767832  delta_E= -3.28e-08  |g|= 6.44e-06  |ddm|= 2.18
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608151570929  LUMO = 1.61412079992086
  mo_energy =
[-0.90460815  1.6141208   7.62644657 18.21855001 36.2564362  61.75549481]
E1 = -3.866036025068412  E_coul = 1.0284089337072477
cycle= 29 E= -2.83762709136116  delta_E= -9.74e-07  |g|= 8.63e-05  |ddm|= 1.76
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608534653277  LUMO = 1.61411337229545
  mo_energy =
[-0.90460853  1.61411337  7.62640875 18.21842137 36.25623426 61.75506712]
E1 = -3.8660367266891362  E_coul = 1.0284108779049934
cycle= 30 E= -2.83762584878414  delta_E= 1.24e-06  |g|= 5.73e-05  |ddm|= 9.52
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608479180999  LUMO = 1.61411464563776
  mo_energy =
[-0.90460848  1.61411465  7.62641546 18.21844058 36.25626046 61.75510351]
E1 = -3.866036612985999  E_coul = 1.0284109060177147
cycle= 31 E= -2.83762570696828  delta_E= 1.42e-07  |g|= 6.99e-05  |ddm|=  1.4
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608363766233  LUMO = 1.61411679771236
  mo_energy =
[-0.90460836  1.6141168   7.62642631 18.21847836 36.25632112 61.75523959]
E1 = -3.866036408290764  E_coul = 1.02841088138803
cycle= 32 E= -2.83762552690273  delta_E= 1.8e-07  |g|= 7.95e-05  |ddm|= 2.82
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608296247911  LUMO = 1.61411804738113
  mo_energy =
[-0.9046083   1.61411805  7.62643271 18.21850069 36.25635707 61.75531538]
E1 = -3.866036290704693  E_coul = 1.0284089182539664
cycle= 33 E= -2.83762737245073  delta_E= -1.85e-06  |g|= 9.84e-05  |ddm|= 1.63
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608414660219  LUMO = 1.61411574566574
  mo_energy =
[-0.90460841  1.61411575  7.62642061 18.21846439 36.25630532 61.75524392]
E1 = -3.8660364947673536  E_coul = 1.0284096213764875
cycle= 34 E= -2.83762687339087  delta_E= 4.99e-07  |g|= 5.79e-05  |ddm|= 2.59
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608457129355  LUMO = 1.6141150483324
  mo_energy =
[-0.90460846  1.61411505  7.62641713 18.21844892 36.25627589 61.75517392]
E1 = -3.8660365639357472  E_coul = 1.0284088352648995
cycle= 35 E= -2.83762772867085  delta_E= -8.55e-07  |g|= 0.000118  |ddm|= 1.09
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608702387895  LUMO = 1.6141100601669
  mo_energy =
[-0.9046087   1.61411006  7.6263912  18.21836751 36.25615492 61.7549461 ]
E1 = -3.8660370198400993  E_coul = 1.0284130995283198
cycle= 36 E= -2.83762392031178  delta_E= 3.81e-06  |g|= 0.000254  |ddm|= 5.94
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904609560518693  LUMO = 1.61409383142054
  mo_energy =
[-0.90460956  1.61409383  7.62631027 18.21807596 36.25567886 61.75380746]
E1 = -3.866038597860999  E_coul = 1.0284107538392135
cycle= 37 E= -2.83762784402179  delta_E= -3.92e-06  |g|= 2.65e-05  |ddm|= 22.1
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9046080372996  LUMO = 1.61412429294555
  mo_energy =
[-0.90460804  1.61412429  7.62646567 18.21859728 36.25649009 61.75551908]
E1 = -3.866035725007767  E_coul = 1.0284104194279051
cycle= 38 E= -2.83762530557986  delta_E= 2.54e-06  |g|= 7.03e-05  |ddm|= 38.7
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607915688148  LUMO = 1.61412614453019
  mo_energy =
[-0.90460792  1.61412614  7.62647463 18.21863643 36.25656133 61.75571467]
E1 = -3.8660355356129004  E_coul = 1.0284091584349415
cycle= 39 E= -2.83762637717796  delta_E= -1.07e-06  |g|= 3.94e-05  |ddm|= 2.94
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608137465777  LUMO = 1.61412156684867
  mo_energy =
[-0.90460814  1.61412157  7.62645071 18.21855557 36.2564322  61.75543879]
E1 = -3.866035961645264  E_coul = 1.0284103639745725
cycle= 40 E= -2.83762559767069  delta_E= 7.8e-07  |g|= 5.15e-05  |ddm|= 5.82
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608151994165  LUMO = 1.61412117412054
  mo_energy =
[-0.90460815  1.61412117  7.6264484  18.21854858 36.25642258 61.75544683]
E1 = -3.86603599405815  E_coul = 1.0284092605783766
cycle= 41 E= -2.83762673347977  delta_E= -1.14e-06  |g|= 6.47e-05  |ddm|= 0.399
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608097183284  LUMO = 1.61412246411264
  mo_energy =
[-0.9046081   1.61412246  7.62645565 18.21856723 36.25644628 61.75545364]
E1 = -3.866035888845177  E_coul = 1.0284128183089067
cycle= 42 E= -2.83762307053627  delta_E= 3.66e-06  |g|= 0.000282  |ddm|=  1.2
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607560383305  LUMO = 1.61413250823232
  mo_energy =
[-0.90460756  1.61413251  7.6265064  18.21874779 36.2567406  61.75612621]
E1 = -3.8660349267030343  E_coul = 1.028409799686077
cycle= 43 E= -2.83762512701696  delta_E= -2.06e-06  |g|= 5.02e-05  |ddm|= 13.4
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607392383215  LUMO = 1.61413546925722
  mo_energy =
[-0.90460739  1.61413547  7.62652102 18.21880169 36.25683019 61.75635008]
E1 = -3.8660346390029607  E_coul = 1.028409169170069
cycle= 44 E= -2.83762546983289  delta_E= -3.43e-07  |g|= 1.2e-05  |ddm|= 4.09
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607749914134  LUMO = 1.61412875812967
  mo_energy =
[-0.90460775  1.61412876  7.62648719 18.21868163 36.25663564 61.75590817]
E1 = -3.866035282928877  E_coul = 1.0284096311365507
cycle= 45 E= -2.83762565179233  delta_E= -1.82e-07  |g|= 8.11e-06  |ddm|= 8.95
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607378413599  LUMO = 1.6141361577326
  mo_energy =
[-0.90460738  1.61413616  7.62652579 18.21881128 36.25684077 61.75631697]
E1 = -3.8660345956888422  E_coul = 1.0284077063322272
cycle= 46 E= -2.83762688935662  delta_E= -1.24e-06  |g|= 0.000134  |ddm|= 9.32
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90460727389459  LUMO = 1.61413830174038
  mo_energy =
[-0.90460727  1.6141383   7.62653682 18.21884473 36.25688998 61.75641474]
E1 = -3.866034400405781  E_coul = 1.0284056279744982
cycle= 47 E= -2.83762877243128  delta_E= -1.88e-06  |g|= 0.000312  |ddm|=  2.5
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904606945942714  LUMO = 1.61414470453665
  mo_energy =
[-0.90460695  1.6141447   7.62656973 18.21895637 36.2570673  61.75679657]
E1 = -3.866033800391875  E_coul = 1.0284089080949816
cycle= 48 E= -2.83762489229689  delta_E= 3.88e-06  |g|= 6.26e-06  |ddm|= 8.18
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607241986468  LUMO = 1.61413926296893
  mo_energy =
[-0.90460724  1.61413926  7.62654215 18.21886196 36.25691626 61.75645054]
E1 = -3.8660343138307787  E_coul = 1.0284093622822523
cycle= 49 E= -2.83762495154853  delta_E= -5.93e-08  |g|= 3.77e-05  |ddm|= 7.05
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904606245578387  LUMO = 1.61415758106957
  mo_energy =
[-0.90460625  1.61415758  7.62663374 18.21919544 36.25746615 61.75776196]
E1 = -3.866032539177223  E_coul = 1.0284061642048763
cycle= 50 E= -2.83762637497235  delta_E= -1.42e-06  |g|= 0.000186  |ddm|=   25
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.866032539177223  E_coul = 1.0284061642048763

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904610105664837  LUMO = 1.61411373154427
  mo_energy =
[-0.90461011  1.61411373  7.62641191 18.21846998 36.25634243 61.75547854]
E1 = -3.866036169471561  E_coul = 1.028409356537365
Extra cycle  E= -2.8376268129342  delta_E= -4.38e-07  |g|= 4.38e-05  |ddm|= 50.8
    CPU time for scf_cycle      0.49 sec, wall time      0.49 sec
exp = [6.3849942  5.62959006 4.95587259 4.25422668 3.84757524 0.37853558]
E = -2.8376268129341957
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:11 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.38499419705        1
[INPUT] 0    0    [1    /1   ]  5.62959006047        1
[INPUT] 0    0    [1    /1   ]  4.95587258976        1
[INPUT] 0    0    [1    /1   ]  4.25422667632        1
[INPUT] 0    0    [1    /1   ]  3.84757523701        1
[INPUT] 0    0    [1    /1   ]  0.378535579406       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.384994197054696, 1.0]], [0, [5.629590060471803, 1.0]], [0, [4.9558725897604425, 1.0]], [0, [4.254226676317661, 1.0]], [0, [3.8475752370146763, 1.0]], [0, [0.3785355794063867, 1.0]]]}
ecp = {}
CPU time:        68.70
Set gradient conv threshold to 3.16228e-05
cond(S) = 969267486.5281507

WARN: Singularity detected in overlap matrix (condition number = 9.69e+08). SCF may be inaccurate and hard to converge.

E1 = -3.856610700340705  E_coul = 1.024231111796371
init E= -2.83237958854433
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906689229541057  LUMO = 1.61027524737984
  mo_energy =
[-0.90668923  1.61027525  7.6219264  18.21436191 36.25250202 61.75327547]
E1 = -3.86630944662505  E_coul = 1.0286862671467842
cycle= 1 E= -2.83762317947827  delta_E= -0.00524  |g|= 0.00587  |ddm|= 6.97e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904469278697337  LUMO = 1.6142076587547
  mo_energy =
[-0.90446928  1.61420766  7.62676996 18.21926534 36.2574846  61.75762883]
E1 = -3.866037860935902  E_coul = 1.0284122945424514
cycle= 2 E= -2.83762556639345  delta_E= -2.39e-06  |g|= 0.000369  |ddm|=  464
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904614667105044  LUMO = 1.61412779578017
  mo_energy =
[-0.90461467  1.6141278   7.62650274 18.21871578 36.25665171 61.75568586]
E1 = -3.866033573786602  E_coul = 1.0284075644549122
cycle= 3 E= -2.83762600933169  delta_E= -4.43e-07  |g|= 3.86e-05  |ddm|= 79.6
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904607710705363  LUMO = 1.61412232418577
  mo_energy =
[-0.90460771  1.61412232  7.626454   18.21855087 36.25640591 61.75531993]
E1 = -3.866036023771433  E_coul = 1.0284103334946504
cycle= 4 E= -2.83762569027678  delta_E= 3.19e-07  |g|= 4.28e-05  |ddm|= 16.9
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904607780806465  LUMO = 1.61412969995919
  mo_energy =
[-0.90460778  1.6141297   7.62649177 18.21868829 36.2566329  61.75592601]
E1 = -3.8660351795467887  E_coul = 1.028406977619188
cycle= 5 E= -2.8376282019276  delta_E= -2.51e-06  |g|= 0.00022  |ddm|= 10.6
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904609149634604  LUMO = 1.61410601924176
  mo_energy =
[-0.90460915  1.61410602  7.62637079 18.21829311 36.25602749 61.7546799 ]
E1 = -3.866037340494379  E_coul = 1.0284113543920153
cycle= 6 E= -2.83762598610236  delta_E= 2.22e-06  |g|= 8.37e-05  |ddm|=   29
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608571152703  LUMO = 1.61411156847229
  mo_energy =
[-0.90460857  1.61411157  7.62639843 18.21838536 36.256174   61.75497686]
E1 = -3.866036901546491  E_coul = 1.0284135773402243
cycle= 7 E= -2.83762332420627  delta_E= 2.66e-06  |g|= 0.000297  |ddm|= 6.38
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607667948931  LUMO = 1.61412739662486
  mo_energy =
[-0.90460767  1.6141274   7.62648016 18.21865424 36.25659091 61.75579988]
E1 = -3.866035466088424  E_coul = 1.0284090867906728
cycle= 8 E= -2.83762637929775  delta_E= -3.06e-06  |g|= 4.46e-05  |ddm|= 19.4
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607869285704  LUMO = 1.61412503534337
  mo_energy =
[-0.90460787  1.61412504  7.62646777 18.2186169  36.25653466 61.75570449]
E1 = -3.8660356499894766  E_coul = 1.0284094553260954
cycle= 9 E= -2.83762619466338  delta_E= 1.85e-07  |g|= 2.7e-05  |ddm|= 2.49
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607960272601  LUMO = 1.61412425037848
  mo_energy =
[-0.90460796  1.61412425  7.62646399 18.21860284 36.25651132 61.75565276]
E1 = -3.8660357140153003  E_coul = 1.028410957688607
cycle= 10 E= -2.83762475632669  delta_E= 1.44e-06  |g|= 0.000114  |ddm|= 0.987
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607879387861  LUMO = 1.61412672657446
  mo_energy =
[-0.90460788  1.61412673  7.62647673 18.21864824 36.25658596 61.75582241]
E1 = -3.86603546335525  E_coul = 1.0284075402026243
cycle= 11 E= -2.83762792315263  delta_E= -3.17e-06  |g|= 0.00019  |ddm|= 3.43
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90460809284974  LUMO = 1.61412226325217
  mo_energy =
[-0.90460809  1.61412226  7.62645411 18.21857216 36.25646753 61.75556189]
E1 = -3.866035890990339  E_coul = 1.0284103448065596
cycle= 12 E= -2.83762554618378  delta_E= 2.38e-06  |g|= 6.16e-05  |ddm|= 5.73
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608017017748  LUMO = 1.61412340582504
  mo_energy =
[-0.90460802  1.61412341  7.62645923 18.21859821 36.25651828 61.75571595]
E1 = -3.866035764450956  E_coul = 1.0284114858016769
cycle= 13 E= -2.83762427864928  delta_E= 1.27e-06  |g|= 0.000151  |ddm|= 2.06
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607556560479  LUMO = 1.61413222272194
  mo_energy =
[-0.90460756  1.61413222  7.62650462 18.21874701 36.25674776 61.75617959]
E1 = -3.866034950124315  E_coul = 1.028408092856868
cycle= 14 E= -2.83762685726745  delta_E= -2.58e-06  |g|= 0.000133  |ddm|= 10.9
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607011174869  LUMO = 1.61414292551115
  mo_energy =
[-0.90460701  1.61414293  7.62656032 18.21892782 36.25702567 61.75671536]
E1 = -3.866033970177008  E_coul = 1.0284073758080374
cycle= 15 E= -2.83762659436897  delta_E= 2.63e-07  |g|= 0.000144  |ddm|=   13
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607515193514  LUMO = 1.6141323582105
  mo_energy =
[-0.90460752  1.61413236  7.62650423 18.21875571 36.25677228 61.75629839]
E1 = -3.866034915989801  E_coul = 1.0284083912888191
cycle= 16 E= -2.83762652470098  delta_E= 6.97e-08  |g|= 9.27e-05  |ddm|= 12.2
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607523375968  LUMO = 1.61413258747731
  mo_energy =
[-0.90460752  1.61413259  7.62650571 18.21875862 36.2567754  61.75629339]
E1 = -3.8660348967000404  E_coul = 1.0284070362736901
cycle= 17 E= -2.83762786042635  delta_E= -1.34e-06  |g|= 0.000208  |ddm|= 0.171
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607581825476  LUMO = 1.61413153228404
  mo_energy =
[-0.90460758  1.61413153  7.62649994 18.21874446 36.25675861 61.75628149]
E1 = -3.8660349808630006  E_coul = 1.0284084664420383
cycle= 18 E= -2.83762651442096  delta_E= 1.35e-06  |g|= 9.83e-05  |ddm|= 0.957
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607925406992  LUMO = 1.61412542327755
  mo_energy =
[-0.90460793  1.61412542  7.62646888 18.21863541 36.25658096 61.75588235]
E1 = -3.8660355569533897  E_coul = 1.0284102410659324
cycle= 19 E= -2.83762531588746  delta_E= 1.2e-06  |g|= 4.51e-05  |ddm|= 8.03
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607296978091  LUMO = 1.61413788757811
  mo_energy =
[-0.9046073   1.61413789  7.62653309 18.2188456  36.25690433 61.75652172]
E1 = -3.866034400871553  E_coul = 1.0284109503046492
cycle= 20 E= -2.8376234505669  delta_E= 1.87e-06  |g|= 0.000163  |ddm|= 15.4
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607482142499  LUMO = 1.61413604528369
  mo_energy =
[-0.90460748  1.61413605  7.62652621 18.21879053 36.25678282 61.75609683]
E1 = -3.8660346353482207  E_coul = 1.028410824642982
cycle= 21 E= -2.83762381070524  delta_E= -3.6e-07  |g|= 0.000152  |ddm|= 4.47
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608455763677  LUMO = 1.61411760025431
  mo_energy =
[-0.90460846  1.6141176   7.62643167 18.21847032 36.25627507 61.75500669]
E1 = -3.866036360049841  E_coul = 1.0284095844673462
cycle= 22 E= -2.83762677558249  delta_E= -2.96e-06  |g|= 2.85e-05  |ddm|= 23.5
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608415561168  LUMO = 1.61411635084443
  mo_energy =
[-0.90460842  1.61411635  7.62642387 18.21847291 36.25631328 61.75523155]
E1 = -3.866036436744425  E_coul = 1.0284091469394743
cycle= 23 E= -2.83762728980495  delta_E= -5.14e-07  |g|= 8.47e-05  |ddm|= 0.222
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608768002971  LUMO = 1.61410996082437
  mo_energy =
[-0.90460877  1.61410996  7.62639218 18.21835766 36.25612433 61.75479266]
E1 = -3.86603705668858  E_coul = 1.028410754102674
cycle= 24 E= -2.83762630258591  delta_E= 9.87e-07  |g|= 4.75e-05  |ddm|= 8.69
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90460831181799  LUMO = 1.61411828004594
  mo_energy =
[-0.90460831  1.61411828  7.626434   18.21850555 36.25636375 61.75533009]
E1 = -3.8660362628719565  E_coul = 1.0284098965400823
cycle= 25 E= -2.83762636633187  delta_E= -6.37e-08  |g|= 2.19e-05  |ddm|=   11
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608056211653  LUMO = 1.61412333937143
  mo_energy =
[-0.90460806  1.61412334  7.62646061 18.21858567 36.25647898 61.7555077 ]
E1 = -3.8660358117351223  E_coul = 1.0284092038962707
cycle= 26 E= -2.83762660783885  delta_E= -2.42e-07  |g|= 4.3e-05  |ddm|= 5.74
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607994162725  LUMO = 1.61412425591799
  mo_energy =
[-0.90460799  1.61412426  7.626465   18.21860611 36.25651821 61.75561764]
E1 = -3.8660357171680055  E_coul = 1.0284096323390548
cycle= 27 E= -2.83762608482895  delta_E= 5.23e-07  |g|= 5.72e-06  |ddm|= 1.52
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608075876971  LUMO = 1.61412240223109
  mo_energy =
[-0.90460808  1.6141224   7.62645528 18.21857594 36.25647378 61.755544  ]
E1 = -3.8660358866344158  E_coul = 1.028409768956095
cycle= 28 E= -2.83762611767832  delta_E= -3.28e-08  |g|= 6.44e-06  |ddm|= 2.18
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608151570929  LUMO = 1.61412079992086
  mo_energy =
[-0.90460815  1.6141208   7.62644657 18.21855001 36.2564362  61.75549481]
E1 = -3.866036025068412  E_coul = 1.0284089337072477
cycle= 29 E= -2.83762709136116  delta_E= -9.74e-07  |g|= 8.63e-05  |ddm|= 1.76
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608534653277  LUMO = 1.61411337229545
  mo_energy =
[-0.90460853  1.61411337  7.62640875 18.21842137 36.25623426 61.75506712]
E1 = -3.8660367266891362  E_coul = 1.0284108779049934
cycle= 30 E= -2.83762584878414  delta_E= 1.24e-06  |g|= 5.73e-05  |ddm|= 9.52
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608479180999  LUMO = 1.61411464563776
  mo_energy =
[-0.90460848  1.61411465  7.62641546 18.21844058 36.25626046 61.75510351]
E1 = -3.866036612985999  E_coul = 1.0284109060177147
cycle= 31 E= -2.83762570696828  delta_E= 1.42e-07  |g|= 6.99e-05  |ddm|=  1.4
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608363766233  LUMO = 1.61411679771236
  mo_energy =
[-0.90460836  1.6141168   7.62642631 18.21847836 36.25632112 61.75523959]
E1 = -3.866036408290764  E_coul = 1.02841088138803
cycle= 32 E= -2.83762552690273  delta_E= 1.8e-07  |g|= 7.95e-05  |ddm|= 2.82
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608296247911  LUMO = 1.61411804738113
  mo_energy =
[-0.9046083   1.61411805  7.62643271 18.21850069 36.25635707 61.75531538]
E1 = -3.866036290704693  E_coul = 1.0284089182539664
cycle= 33 E= -2.83762737245073  delta_E= -1.85e-06  |g|= 9.84e-05  |ddm|= 1.63
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608414660219  LUMO = 1.61411574566574
  mo_energy =
[-0.90460841  1.61411575  7.62642061 18.21846439 36.25630532 61.75524392]
E1 = -3.8660364947673536  E_coul = 1.0284096213764875
cycle= 34 E= -2.83762687339087  delta_E= 4.99e-07  |g|= 5.79e-05  |ddm|= 2.59
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608457129355  LUMO = 1.6141150483324
  mo_energy =
[-0.90460846  1.61411505  7.62641713 18.21844892 36.25627589 61.75517392]
E1 = -3.8660365639357472  E_coul = 1.0284088352648995
cycle= 35 E= -2.83762772867085  delta_E= -8.55e-07  |g|= 0.000118  |ddm|= 1.09
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608702387895  LUMO = 1.6141100601669
  mo_energy =
[-0.9046087   1.61411006  7.6263912  18.21836751 36.25615492 61.7549461 ]
E1 = -3.8660370198400993  E_coul = 1.0284130995283198
cycle= 36 E= -2.83762392031178  delta_E= 3.81e-06  |g|= 0.000254  |ddm|= 5.94
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904609560518693  LUMO = 1.61409383142054
  mo_energy =
[-0.90460956  1.61409383  7.62631027 18.21807596 36.25567886 61.75380746]
E1 = -3.866038597860999  E_coul = 1.0284107538392135
cycle= 37 E= -2.83762784402179  delta_E= -3.92e-06  |g|= 2.65e-05  |ddm|= 22.1
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9046080372996  LUMO = 1.61412429294555
  mo_energy =
[-0.90460804  1.61412429  7.62646567 18.21859728 36.25649009 61.75551908]
E1 = -3.866035725007767  E_coul = 1.0284104194279051
cycle= 38 E= -2.83762530557986  delta_E= 2.54e-06  |g|= 7.03e-05  |ddm|= 38.7
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607915688148  LUMO = 1.61412614453019
  mo_energy =
[-0.90460792  1.61412614  7.62647463 18.21863643 36.25656133 61.75571467]
E1 = -3.8660355356129004  E_coul = 1.0284091584349415
cycle= 39 E= -2.83762637717796  delta_E= -1.07e-06  |g|= 3.94e-05  |ddm|= 2.94
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608137465777  LUMO = 1.61412156684867
  mo_energy =
[-0.90460814  1.61412157  7.62645071 18.21855557 36.2564322  61.75543879]
E1 = -3.866035961645264  E_coul = 1.0284103639745725
cycle= 40 E= -2.83762559767069  delta_E= 7.8e-07  |g|= 5.15e-05  |ddm|= 5.82
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608151994165  LUMO = 1.61412117412054
  mo_energy =
[-0.90460815  1.61412117  7.6264484  18.21854858 36.25642258 61.75544683]
E1 = -3.86603599405815  E_coul = 1.0284092605783766
cycle= 41 E= -2.83762673347977  delta_E= -1.14e-06  |g|= 6.47e-05  |ddm|= 0.399
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608097183284  LUMO = 1.61412246411264
  mo_energy =
[-0.9046081   1.61412246  7.62645565 18.21856723 36.25644628 61.75545364]
E1 = -3.866035888845177  E_coul = 1.0284128183089067
cycle= 42 E= -2.83762307053627  delta_E= 3.66e-06  |g|= 0.000282  |ddm|=  1.2
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607560383305  LUMO = 1.61413250823232
  mo_energy =
[-0.90460756  1.61413251  7.6265064  18.21874779 36.2567406  61.75612621]
E1 = -3.8660349267030343  E_coul = 1.028409799686077
cycle= 43 E= -2.83762512701696  delta_E= -2.06e-06  |g|= 5.02e-05  |ddm|= 13.4
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607392383215  LUMO = 1.61413546925722
  mo_energy =
[-0.90460739  1.61413547  7.62652102 18.21880169 36.25683019 61.75635008]
E1 = -3.8660346390029607  E_coul = 1.028409169170069
cycle= 44 E= -2.83762546983289  delta_E= -3.43e-07  |g|= 1.2e-05  |ddm|= 4.09
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607749914134  LUMO = 1.61412875812967
  mo_energy =
[-0.90460775  1.61412876  7.62648719 18.21868163 36.25663564 61.75590817]
E1 = -3.866035282928877  E_coul = 1.0284096311365507
cycle= 45 E= -2.83762565179233  delta_E= -1.82e-07  |g|= 8.11e-06  |ddm|= 8.95
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607378413599  LUMO = 1.6141361577326
  mo_energy =
[-0.90460738  1.61413616  7.62652579 18.21881128 36.25684077 61.75631697]
E1 = -3.8660345956888422  E_coul = 1.0284077063322272
cycle= 46 E= -2.83762688935662  delta_E= -1.24e-06  |g|= 0.000134  |ddm|= 9.32
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90460727389459  LUMO = 1.61413830174038
  mo_energy =
[-0.90460727  1.6141383   7.62653682 18.21884473 36.25688998 61.75641474]
E1 = -3.866034400405781  E_coul = 1.0284056279744982
cycle= 47 E= -2.83762877243128  delta_E= -1.88e-06  |g|= 0.000312  |ddm|=  2.5
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904606945942714  LUMO = 1.61414470453665
  mo_energy =
[-0.90460695  1.6141447   7.62656973 18.21895637 36.2570673  61.75679657]
E1 = -3.866033800391875  E_coul = 1.0284089080949816
cycle= 48 E= -2.83762489229689  delta_E= 3.88e-06  |g|= 6.26e-06  |ddm|= 8.18
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607241986468  LUMO = 1.61413926296893
  mo_energy =
[-0.90460724  1.61413926  7.62654215 18.21886196 36.25691626 61.75645054]
E1 = -3.8660343138307787  E_coul = 1.0284093622822523
cycle= 49 E= -2.83762495154853  delta_E= -5.93e-08  |g|= 3.77e-05  |ddm|= 7.05
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904606245578387  LUMO = 1.61415758106957
  mo_energy =
[-0.90460625  1.61415758  7.62663374 18.21919544 36.25746615 61.75776196]
E1 = -3.866032539177223  E_coul = 1.0284061642048763
cycle= 50 E= -2.83762637497235  delta_E= -1.42e-06  |g|= 0.000186  |ddm|=   25
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.866032539177223  E_coul = 1.0284061642048763

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904610105664837  LUMO = 1.61411373154427
  mo_energy =
[-0.90461011  1.61411373  7.62641191 18.21846998 36.25634243 61.75547854]
E1 = -3.866036169471561  E_coul = 1.028409356537365
Extra cycle  E= -2.8376268129342  delta_E= -4.38e-07  |g|= 4.38e-05  |ddm|= 50.8
    CPU time for scf_cycle      0.49 sec, wall time      0.49 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 969267486.5281507

WARN: Singularity detected in overlap matrix (condition number = 9.69e+08). SCF may be inaccurate and hard to converge.

E1 = -3.866036169471561  E_coul = 1.028409356537365
init E= -2.8376268129342
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.90460872820332  LUMO = 1.61410783614481
  mo_energy =
[-0.90460873  1.61410784  7.62638031 18.21834864 36.25615012 61.75497892]
E1 = -3.866037238127834  E_coul = 1.0284116967403065
cycle= 1 E= -2.83762554138753  delta_E= 1.27e-06  |g|= 0.000104  |ddm|= 12.4
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904606922390935  LUMO = 1.61413435998147
  mo_energy =
[-0.90460692  1.61413436  7.62651658 18.21874503 36.25669725 61.7558891 ]
E1 = -3.8660349837719727  E_coul = 1.0284074161816819
cycle= 2 E= -2.83762756759029  delta_E= -2.03e-06  |g|= 0.000168  |ddm|= 28.8
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904608038403248  LUMO = 1.61411926931089
  mo_energy =
[-0.90460804  1.61411927  7.62643846 18.21851024 36.25635767 61.75529557]
E1 = -3.866036240787987  E_coul = 1.0284093993804166
cycle= 3 E= -2.83762684140757  delta_E= 7.26e-07  |g|= 4.91e-05  |ddm|= 16.5
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608218542322  LUMO = 1.61411578693505
  mo_energy =
[-0.90460822  1.61411579  7.62642007 18.21845589 36.25627868 61.75515356]
E1 = -3.866036546881605  E_coul = 1.0284093621789074
cycle= 4 E= -2.8376271847027  delta_E= -3.43e-07  |g|= 6.71e-05  |ddm|= 3.91
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608423237146  LUMO = 1.61411162889763
  mo_energy =
[-0.90460842  1.61411163  7.62639864 18.21838463 36.25616819 61.75491648]
E1 = -3.866036937761674  E_coul = 1.0284099025926257
cycle= 5 E= -2.83762703516905  delta_E= 1.5e-07  |g|= 4.52e-05  |ddm|= 5.26
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608543217334  LUMO = 1.6141092064589
  mo_energy =
[-0.90460854  1.61410921  7.62638673 18.21833877 36.25609108 61.75473124]
E1 = -3.8660371834507363  E_coul = 1.0284116945879473
cycle= 6 E= -2.83762548886279  delta_E= 1.55e-06  |g|= 0.000105  |ddm|= 3.51
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608355279323  LUMO = 1.61411273131637
  mo_energy =
[-0.90460836  1.61411273  7.62640532 18.21839334 36.25616842 61.75484224]
E1 = -3.866036877325234  E_coul = 1.0284114329069485
cycle= 7 E= -2.83762544441829  delta_E= 4.44e-08  |g|= 0.000103  |ddm|= 3.85
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608212034351  LUMO = 1.61411523519142
  mo_energy =
[-0.90460821  1.61411524  7.62641778 18.21843767 36.25623956 61.75500732]
E1 = -3.86603663716236  E_coul = 1.0284106608192332
cycle= 8 E= -2.83762597634313  delta_E= -5.32e-07  |g|= 4.35e-05  |ddm|= 3.34
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608148411902  LUMO = 1.61411637881877
  mo_energy =
[-0.90460815  1.61411638  7.62642347 18.21845538 36.25626497 61.75505438]
E1 = -3.866036530866418  E_coul = 1.0284123201851965
cycle= 9 E= -2.83762421068122  delta_E= 1.77e-06  |g|= 0.000208  |ddm|= 1.37
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607885038147  LUMO = 1.61412114360962
  mo_energy =
[-0.90460789  1.61412114  7.62644738 18.21853931 36.25639994 61.75536191]
E1 = -3.8660360778069838  E_coul = 1.028410938507123
cycle= 10 E= -2.83762513929986  delta_E= -9.29e-07  |g|= 9.16e-05  |ddm|= 6.27
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607608141788  LUMO = 1.61412694972594
  mo_energy =
[-0.90460761  1.61412695  7.62647683 18.2186411  36.25656101 61.75571361]
E1 = -3.8660355177209684  E_coul = 1.0284104244069259
cycle= 11 E= -2.83762509331404  delta_E= 4.6e-08  |g|= 7.64e-05  |ddm|= 7.62
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607414335118  LUMO = 1.61413103147618
  mo_energy =
[-0.90460741  1.61413103  7.62649841 18.21870806 36.25666129 61.7558982 ]
E1 = -3.8660351495854766  E_coul = 1.0284101082667958
cycle= 12 E= -2.83762504131868  delta_E= 5.2e-08  |g|= 6.56e-05  |ddm|= 4.79
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607248848296  LUMO = 1.61413430143297
  mo_energy =
[-0.90460725  1.6141343   7.62651543 18.21876261 36.25674439 61.75606032]
E1 = -3.8660348508025235  E_coul = 1.0284117069513756
cycle= 13 E= -2.83762314385115  delta_E= 1.9e-06  |g|= 0.000225  |ddm|= 3.95
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904606954314318  LUMO = 1.61413975125157
  mo_energy =
[-0.90460695  1.61413975  7.626543   18.21885561 36.25688938 61.75636309]
E1 = -3.8660343386568066  E_coul = 1.0284071696622759
cycle= 14 E= -2.83762716899453  delta_E= -4.03e-06  |g|= 0.000176  |ddm|= 6.92
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90460680528869  LUMO = 1.61414202887987
  mo_energy =
[-0.90460681  1.61414203  7.62655328 18.21890511 36.25698161 61.75664809]
E1 = -3.8660340889177807  E_coul = 1.0284073405430227
cycle= 15 E= -2.83762674837476  delta_E= 4.21e-07  |g|= 0.000153  |ddm|= 3.95
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904606497665326  LUMO = 1.61414775033436
  mo_energy =
[-0.9046065   1.61414775  7.62658223 18.21900576 36.25714339 61.75700339]
E1 = -3.8660335473527674  E_coul = 1.028408973680939
cycle= 16 E= -2.83762457367183  delta_E= 2.17e-06  |g|= 2.15e-05  |ddm|= 7.46
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904606285187034  LUMO = 1.61415204720763
  mo_energy =
[-0.90460629  1.61415205  7.62660429 18.21908892 36.25728525 61.75735522]
E1 = -3.8660331290784185  E_coul = 1.028407445216673
cycle= 17 E= -2.83762568386175  delta_E= -1.11e-06  |g|= 0.000111  |ddm|= 6.05
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904606523878839  LUMO = 1.61414750443793
  mo_energy =
[-0.90460652  1.6141475   7.6265818  18.21901016 36.25715802 61.75703668]
E1 = -3.866033568292735  E_coul = 1.0284068503106376
cycle= 18 E= -2.8376267179821  delta_E= -1.03e-06  |g|= 0.000164  |ddm|= 6.06
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904606119536098  LUMO = 1.61415544522287
  mo_energy =
[-0.90460612  1.61415545  7.62662284 18.21915643 36.2573987  61.75758308]
E1 = -3.866032810964376  E_coul = 1.0284046994696727
cycle= 19 E= -2.8376281114947  delta_E= -1.39e-06  |g|= 0.000342  |ddm|= 10.6
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904604872398289  LUMO = 1.61417823720396
  mo_energy =
[-0.90460487  1.61417824  7.62673807 18.21955417 36.25803532 61.75899015]
E1 = -3.866030660504515  E_coul = 1.0284047312687996
cycle= 20 E= -2.83762592923572  delta_E= 2.18e-06  |g|= 0.000264  |ddm|= 29.5
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904606887272316  LUMO = 1.61413880295645
  mo_energy =
[-0.90460689  1.6141388   7.62653321 18.21888403 36.25699818 61.75699193]
E1 = -3.866034279893023  E_coul = 1.0284081957659674
cycle= 21 E= -2.83762608412706  delta_E= -1.55e-07  |g|= 9.24e-05  |ddm|= 48.4
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608511470312  LUMO = 1.61410837974193
  mo_energy =
[-0.90460851  1.61410838  7.62637776 18.21835386 36.25615564 61.75517013]
E1 = -3.8660371357227494  E_coul = 1.0284092187556777
cycle= 22 E= -2.83762791696707  delta_E= -1.83e-06  |g|= 0.000117  |ddm|=   39
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90460900971673  LUMO = 1.61410017521439
  mo_energy =
[-0.90460901  1.61410018  7.62633816 18.21820152 36.25590247 61.75452026]
E1 = -3.8660379548995287  E_coul = 1.0284129235331214
cycle= 23 E= -2.83762503136641  delta_E= 2.89e-06  |g|= 0.000183  |ddm|= 11.7
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608098783513  LUMO = 1.61411842598191
  mo_energy =
[-0.9046081   1.61411843  7.62643377 18.2184998  36.25634802 61.75530962]
E1 = -3.866036306873366  E_coul = 1.0284107959681468
cycle= 24 E= -2.83762551090522  delta_E= -4.8e-07  |g|= 6.92e-05  |ddm|= 21.5
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90460805517597  LUMO = 1.61411898459049
  mo_energy =
[-0.90460806  1.61411898  7.62643656 18.21850768 36.25635913 61.75532718]
E1 = -3.866036260065989  E_coul = 1.028409973665129
cycle= 25 E= -2.83762628640086  delta_E= -7.75e-07  |g|= 5.3e-06  |ddm|= 0.59
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608098978119  LUMO = 1.61411798924529
  mo_energy =
[-0.9046081   1.61411799  7.62643131 18.21849053 36.25633184 61.75527126]
E1 = -3.8660363521170464  E_coul = 1.0284093272335786
cycle= 26 E= -2.83762702488347  delta_E= -7.38e-07  |g|= 6.58e-05  |ddm|= 1.24
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608185541782  LUMO = 1.61411648278075
  mo_energy =
[-0.90460819  1.61411648  7.62642441 18.21846087 36.25627942 61.75510684]
E1 = -3.8660365134921797  E_coul = 1.0284092307053512
cycle= 27 E= -2.83762728278683  delta_E= -2.58e-07  |g|= 7.7e-05  |ddm|= 2.42
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608203371109  LUMO = 1.61411599030073
  mo_energy =
[-0.9046082   1.61411599  7.62642199 18.21845301 36.25626808 61.75508236]
E1 = -3.866036562454272  E_coul = 1.0284094138373812
cycle= 28 E= -2.83762714861689  delta_E= 1.34e-07  |g|= 6.35e-05  |ddm|= 0.631
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608298459764  LUMO = 1.61411406019562
  mo_energy =
[-0.9046083   1.61411406  7.62641206 18.21842251 36.25622326 61.75498927]
E1 = -3.8660367398761335  E_coul = 1.0284104468825899
cycle= 29 E= -2.83762629299354  delta_E= 8.56e-07  |g|= 3.02e-05  |ddm|= 2.29
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608401489372  LUMO = 1.61411156644962
  mo_energy =
[-0.9046084   1.61411157  7.62639888 18.21838361 36.25616784 61.7548969 ]
E1 = -3.8660369660242275  E_coul = 1.0284105602235944
cycle= 30 E= -2.83762640580063  delta_E= -1.13e-07  |g|= 2.13e-05  |ddm|= 2.85
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608271635866  LUMO = 1.61411402368728
  mo_energy =
[-0.90460827  1.61411402  7.62641148 18.21842586 36.25623364 61.75502858]
E1 = -3.8660367372797517  E_coul = 1.0284115718906424
cycle= 31 E= -2.83762516538911  delta_E= 1.24e-06  |g|= 0.000125  |ddm|= 3.09
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608141660112  LUMO = 1.61411641511259
  mo_energy =
[-0.90460814  1.61411642  7.62642349 18.2184675  36.25630023 61.75518681]
E1 = -3.866036509018847  E_coul = 1.0284119614273257
cycle= 32 E= -2.83762454759152  delta_E= 6.18e-07  |g|= 0.000156  |ddm|= 3.14
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608088571209  LUMO = 1.61411788651589
  mo_energy =
[-0.90460809  1.61411789  7.62643205 18.2184891  36.25632734 61.75518965]
E1 = -3.8660363913265567  E_coul = 1.0284116103797967
cycle= 33 E= -2.83762478094676  delta_E= -2.33e-07  |g|= 0.000141  |ddm|= 1.33
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607858714316  LUMO = 1.6141224808731
  mo_energy =
[-0.90460786  1.61412248  7.62645611 18.21856534 36.25644268 61.75539945]
E1 = -3.866035974301322  E_coul = 1.0284109073176668
cycle= 34 E= -2.83762506698366  delta_E= -2.86e-07  |g|= 9.2e-05  |ddm|= 5.48
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607526514864  LUMO = 1.61412902679133
  mo_energy =
[-0.90460753  1.61412903  7.62648949 18.21867602 36.2566128  61.75576437]
E1 = -3.866035358880671  E_coul = 1.028409699185012
cycle= 35 E= -2.83762565969566  delta_E= -5.93e-07  |g|= 1.72e-05  |ddm|= 8.24
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607426178616  LUMO = 1.61413084588212
  mo_energy =
[-0.90460743  1.61413085  7.62649826 18.21870917 36.25666787 61.75590527]
E1 = -3.866035176855104  E_coul = 1.0284094852467305
cycle= 36 E= -2.83762569160837  delta_E= -3.19e-08  |g|= 1.68e-06  |ddm|= 2.58
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607237357041  LUMO = 1.61413459648937
  mo_energy =
[-0.90460724  1.6141346   7.62651735 18.21877189 36.25676406 61.75611447]
E1 = -3.866034823992767  E_coul = 1.0284097553739198
cycle= 37 E= -2.83762506861885  delta_E= 6.23e-07  |g|= 3.86e-05  |ddm|=  4.7
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90460706677796  LUMO = 1.61413800166649
  mo_energy =
[-0.90460707  1.614138    7.62653522 18.21882746 36.25684708 61.75626501]
E1 = -3.8660345158986633  E_coul = 1.028407945379526
cycle= 38 E= -2.83762657051914  delta_E= -1.5e-06  |g|= 0.0001  |ddm|= 4.01
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904606605309413  LUMO = 1.6141472800773
  mo_energy =
[-0.90460661  1.61414728  7.62658354 18.21898018 36.25707723 61.75670821]
E1 = -3.8660336676074123  E_coul = 1.0284091241722988
cycle= 39 E= -2.83762454343511  delta_E= 2.03e-06  |g|= 3.97e-05  |ddm|= 11.1
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904606771356658  LUMO = 1.61414459667862
  mo_energy =
[-0.90460677  1.6141446   7.62657086 18.21892894 36.2569879  61.75644858]
E1 = -3.866033941832659  E_coul = 1.0284073062389494
cycle= 40 E= -2.83762663559371  delta_E= -2.09e-06  |g|= 0.000141  |ddm|= 4.06
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904606850499122  LUMO = 1.61414257722807
  mo_energy =
[-0.90460685  1.61414258  7.62655916 18.21890028 36.25695308 61.75646071]
E1 = -3.8660341008451713  E_coul = 1.0284100867112729
cycle= 41 E= -2.8376240141339  delta_E= 2.62e-06  |g|= 0.000101  |ddm|= 1.76
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607342148664  LUMO = 1.61413270525611
  mo_energy =
[-0.90460734  1.61413271  7.6265079  18.21873694 36.25670756 61.75601116]
E1 = -3.8660350064088482  E_coul = 1.028410340048047
cycle= 42 E= -2.8376246663608  delta_E= -6.52e-07  |g|= 7.58e-05  |ddm|= 11.9
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904607511139015  LUMO = 1.61412985582664
  mo_energy =
[-0.90460751  1.61412986  7.62649351 18.21868805 36.25663369 61.75586486]
E1 = -3.8660352715478323  E_coul = 1.0284074347718164
cycle= 43 E= -2.83762783677602  delta_E= -3.17e-06  |g|= 0.00018  |ddm|= 3.59
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608882502886  LUMO = 1.61410371648251
  mo_energy =
[-0.90460888  1.61410372  7.62635941 18.2182491  36.25595722 61.75447238]
E1 = -3.8660376957740694  E_coul = 1.0284108208037221
cycle= 44 E= -2.83762687497035  delta_E= 9.62e-07  |g|= 1.54e-05  |ddm|= 32.4
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608340778415  LUMO = 1.61411262251024
  mo_energy =
[-0.90460834  1.61411262  7.62640438 18.2183972  36.25618418 61.7549118 ]
E1 = -3.866036877116175  E_coul = 1.0284110558083075
cycle= 45 E= -2.83762582130787  delta_E= 1.05e-06  |g|= 6.44e-05  |ddm|=   11
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608126109489  LUMO = 1.6141170326248
  mo_energy =
[-0.90460813  1.61411703  7.62642751 18.21846937 36.25629165 61.75510784]
E1 = -3.86603647715747  E_coul = 1.0284089579918256
cycle= 46 E= -2.83762751916564  delta_E= -1.7e-06  |g|= 0.000101  |ddm|=  5.2
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608310491956  LUMO = 1.6141136595065
  mo_energy =
[-0.90460831  1.61411366  7.62641037 18.21841091 36.25619808 61.75490869]
E1 = -3.8660367918720877  E_coul = 1.0284102967562387
cycle= 47 E= -2.83762649511585  delta_E= 1.02e-06  |g|= 2.46e-05  |ddm|= 4.31
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90460827566738  LUMO = 1.61411385600256
  mo_energy =
[-0.90460828  1.61411386  7.62641045 18.21842383 36.25623232 61.75505369]
E1 = -3.866036747570773  E_coul = 1.0284103809065355
cycle= 48 E= -2.83762636666424  delta_E= 1.28e-07  |g|= 1.04e-05  |ddm|= 1.11
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904608197797586  LUMO = 1.61411562743304
  mo_energy =
[-0.9046082   1.61411563  7.62642039 18.2184484  36.25626252 61.75506625]
E1 = -3.8660366041085727  E_coul = 1.028411544371902
cycle= 49 E= -2.83762505973667  delta_E= 1.31e-06  |g|= 0.000122  |ddm|= 1.62
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90460808551078  LUMO = 1.6141178535723
  mo_energy =
[-0.90460809  1.61411785  7.62643199 18.21848477 36.25631658 61.75516586]
E1 = -3.866036402217826  E_coul = 1.0284103221671546
cycle= 50 E= -2.83762608005067  delta_E= -1.02e-06  |g|= 1.91e-05  |ddm|= 2.64
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.866036402217826  E_coul = 1.0284103221671546

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904607878980345  LUMO = 1.61412455677535
  mo_energy =
[-0.90460788  1.61412456  7.62646978 18.21857304 36.25641776 61.75514732]
E1 = -3.866035845479862  E_coul = 1.028411030445159
Extra cycle  E= -2.8376248150347  delta_E= 1.27e-06  |g|= 0.000127  |ddm|= 5.94
    CPU time for scf_cycle      0.53 sec, wall time      0.54 sec
exp = [6.3849942  5.62959006 4.95587259 4.25422668 3.84757524 0.37853558]
grad_E = [-3.84047469e-04 -2.26605208e-04  2.36034535e-05  3.71438102e-04
  6.82300931e-04 -3.16209090e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:14 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.38978343519        1
[INPUT] 0    0    [1    /1   ]  5.63379935392        1
[INPUT] 0    0    [1    /1   ]  4.95997601442        1
[INPUT] 0    0    [1    /1   ]  4.25800792602        1
[INPUT] 0    0    [1    /1   ]  3.85113185404        1
[INPUT] 0    0    [1    /1   ]  0.379203807377       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.389783435191572, 1.0]], [0, [5.633799353919097, 1.0]], [0, [4.959976014420727, 1.0]], [0, [4.258007926016358, 1.0]], [0, [3.8511318540408057, 1.0]], [0, [0.37920380737718223, 1.0]]]}
ecp = {}
CPU time:        71.63
Set gradient conv threshold to 3.16228e-05
cond(S) = 972722329.4528106

WARN: Singularity detected in overlap matrix (condition number = 9.73e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8565761921902473  E_coul = 1.0242325568500679
init E= -2.83234363534018
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906696359908115  LUMO = 1.61280207689743
  mo_energy =
[-0.90669636  1.61280208  7.62873228 18.22665193 36.27636664 61.78815797]
E1 = -3.8665445853590072  E_coul = 1.0289012985504231
cycle= 1 E= -2.83764328680858  delta_E= -0.0053  |g|= 0.00598  |ddm|= 9.06e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904371867286201  LUMO = 1.6167566949669
  mo_energy =
[-0.90437187  1.61675669  7.63333108 18.23024818 36.27913101 61.78729217]
E1 = -3.866292785713246  E_coul = 1.02865043547704
cycle= 2 E= -2.83764235023621  delta_E= 9.37e-07  |g|= 0.000441  |ddm|=  663
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904503274051139  LUMO = 1.6167496686154
  mo_energy =
[-0.90450327  1.61674967  7.63339794 18.23092205 36.28036113 61.79051268]
E1 = -3.866284345727945  E_coul = 1.028642435383069
cycle= 3 E= -2.83764191034488  delta_E= 4.4e-07  |g|= 3e-05  |ddm|= 4.89
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904499031026304  LUMO = 1.61676010574864
  mo_energy =
[-0.90449903  1.61676011  7.63344859 18.23106026 36.28056483 61.79075244]
E1 = -3.86628457063787  E_coul = 1.028643566270104
cycle= 4 E= -2.83764100436777  delta_E= 9.06e-07  |g|= 7.82e-05  |ddm|= 8.22
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904498801493854  LUMO = 1.61677471509421
  mo_energy =
[-0.9044988   1.61677472  7.63352324 18.23132124 36.28097848 61.79165857]
E1 = -3.866283027888939  E_coul = 1.0286384464399594
cycle= 5 E= -2.83764458144898  delta_E= -3.58e-06  |g|= 0.000319  |ddm|= 19.8
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500831094257  LUMO = 1.61674201377591
  mo_energy =
[-0.90450083  1.61674201  7.63335702 18.23076122 36.28009697 61.78979736]
E1 = -3.866285988228513  E_coul = 1.0286422007862963
cycle= 6 E= -2.83764378744222  delta_E= 7.94e-07  |g|= 9.06e-05  |ddm|= 40.8
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500851157643  LUMO = 1.61673492376605
  mo_energy =
[-0.90450085  1.61673492  7.63331785 18.23064541 36.27993002 61.78956874]
E1 = -3.866286683056365  E_coul = 1.0286449494809324
cycle= 7 E= -2.83764173357543  delta_E= 2.05e-06  |g|= 0.000123  |ddm|= 8.41
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500279416205  LUMO = 1.61674094280202
  mo_energy =
[-0.90450028  1.61674094  7.63334771 18.23074781 36.28009397 61.78992397]
E1 = -3.866286186991317  E_coul = 1.0286442624038818
cycle= 8 E= -2.83764192458744  delta_E= -1.91e-07  |g|= 7.53e-05  |ddm|= 7.23
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499994373396  LUMO = 1.61674430823181
  mo_energy =
[-0.90449999  1.61674431  7.63336482 18.23080239 36.28017786 61.79008988]
E1 = -3.8662859115880015  E_coul = 1.0286450483642307
cycle= 9 E= -2.83764086322377  delta_E= 1.06e-06  |g|= 0.000161  |ddm|= 3.83
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499649296066  LUMO = 1.616749926797
  mo_energy =
[-0.90449965  1.61674993  7.63339321 18.23089957 36.28033251 61.790432  ]
E1 = -3.8662853972858553  E_coul = 1.028643384773223
cycle= 10 E= -2.83764201251263  delta_E= -1.15e-06  |g|= 2.33e-05  |ddm|= 7.15
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499898055457  LUMO = 1.61674966372171
  mo_energy =
[-0.9044999   1.61674966  7.63339344 18.23089074 36.28030787 61.79031667]
E1 = -3.8662853885262902  E_coul = 1.0286424509412289
cycle= 11 E= -2.83764293758506  delta_E= -9.25e-07  |g|= 5.97e-05  |ddm|= 0.581
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500550466912  LUMO = 1.61673832647793
  mo_energy =
[-0.90450055  1.61673833  7.63333636 18.23069041 36.27998439 61.78959222]
E1 = -3.8662864509485804  E_coul = 1.0286458686144218
cycle= 12 E= -2.83764058233416  delta_E= 2.36e-06  |g|= 0.000218  |ddm|= 14.9
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500378351138  LUMO = 1.61674137519475
  mo_energy =
[-0.90450038  1.61674138  7.63335207 18.23074241 36.28006566 61.78975488]
E1 = -3.866286175506743  E_coul = 1.0286439767848272
cycle= 13 E= -2.83764219872192  delta_E= -1.62e-06  |g|= 6e-05  |ddm|= 3.75
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90449904414864  LUMO = 1.61676246322158
  mo_energy =
[-0.90449904  1.61676246  7.63346059 18.23108865 36.28059095 61.79078046]
E1 = -3.8662843260092012  E_coul = 1.028641248391778
cycle= 14 E= -2.83764307761742  delta_E= -8.79e-07  |g|= 0.00011  |ddm|= 24.9
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499724077838  LUMO = 1.61674941591281
  mo_energy =
[-0.90449972  1.61674942  7.63339084 18.23089234 36.28032169 61.79043049]
E1 = -3.866285429325781  E_coul = 1.0286427662824758
cycle= 15 E= -2.83764266304331  delta_E= 4.15e-07  |g|= 3.77e-05  |ddm|= 13.7
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499825329826  LUMO = 1.61674773067749
  mo_energy =
[-0.90449983  1.61674773  7.63338277 18.23085883 36.28026285 61.79027785]
E1 = -3.8662855998895544  E_coul = 1.0286442249144194
cycle= 16 E= -2.83764137497514  delta_E= 1.29e-06  |g|= 0.000102  |ddm|= 2.56
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499697335169  LUMO = 1.61675001369106
  mo_energy =
[-0.9044997   1.61675001  7.63339419 18.23090153 36.28033446 61.7904448 ]
E1 = -3.86628538016737  E_coul = 1.0286445971017684
cycle= 17 E= -2.8376407830656  delta_E= 5.92e-07  |g|= 0.000128  |ddm|= 3.16
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9044995665577  LUMO = 1.61675300634008
  mo_energy =
[-0.90449957  1.61675301  7.63341056 18.23094635 36.28039439 61.79049957]
E1 = -3.8662851275787573  E_coul = 1.0286431890386634
cycle= 18 E= -2.83764193854009  delta_E= -1.16e-06  |g|= 2.07e-05  |ddm|= 3.05
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90449952568749  LUMO = 1.61675386480594
  mo_energy =
[-0.90449953  1.61675386  7.6334152  18.23096409 36.28042616 61.79056617]
E1 = -3.8662850483472933  E_coul = 1.028643837513775
cycle= 19 E= -2.83764121083352  delta_E= 7.28e-07  |g|= 8.56e-05  |ddm|= 1.19
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499252560106  LUMO = 1.61675874997889
  mo_energy =
[-0.90449925  1.61675875  7.63343955 18.23105269 36.28057288 61.79092157]
E1 = -3.866284579886018  E_coul = 1.0286445910045372
cycle= 20 E= -2.83763998888148  delta_E= 1.22e-06  |g|= 0.000185  |ddm|= 6.65
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499046856491  LUMO = 1.61676282529628
  mo_energy =
[-0.90449905  1.61676283  7.63346017 18.23112496 36.2806898  61.79118969]
E1 = -3.8662841916165047  E_coul = 1.0286397339951436
cycle= 21 E= -2.83764445762136  delta_E= -4.47e-06  |g|= 0.000255  |ddm|=  5.4
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499024685938  LUMO = 1.61676377265433
  mo_energy =
[-0.90449902  1.61676377  7.63346607 18.23113372 36.28069249 61.79112243]
E1 = -3.8662841299800865  E_coul = 1.028642031300562
cycle= 22 E= -2.83764209867952  delta_E= 2.36e-06  |g|= 3.23e-05  |ddm|= 0.415
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499007920471  LUMO = 1.61676412593067
  mo_energy =
[-0.90449901  1.61676413  7.63346778 18.23113994 36.28070246 61.79114686]
E1 = -3.8662840946201698  E_coul = 1.0286431776859348
cycle= 23 E= -2.83764091693423  delta_E= 1.18e-06  |g|= 7.45e-05  |ddm|= 0.49
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498673847424  LUMO = 1.61677031705503
  mo_energy =
[-0.90449867  1.61677032  7.63349918 18.23125194 36.28088558 61.79154704]
E1 = -3.8662835097854082  E_coul = 1.028641110913784
cycle= 24 E= -2.83764239887162  delta_E= -1.48e-06  |g|= 9.81e-05  |ddm|= 8.22
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498508870621  LUMO = 1.61677392167335
  mo_energy =
[-0.90449851  1.61677392  7.63351888 18.23130535 36.28095783 61.79162747]
E1 = -3.8662832088503563  E_coul = 1.0286410095859366
cycle= 25 E= -2.83764219926442  delta_E= 2e-07  |g|= 8.64e-05  |ddm|= 3.63
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498763849723  LUMO = 1.61676824777783
  mo_energy =
[-0.90449876  1.61676825  7.63348789 18.23122371 36.28085448 61.7915647 ]
E1 = -3.8662836826655322  E_coul = 1.0286423126060296
cycle= 26 E= -2.8376413700595  delta_E= 8.29e-07  |g|= 7.27e-06  |ddm|= 5.56
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498502060341  LUMO = 1.61677309090166
  mo_energy =
[-0.9044985   1.61677309  7.63351133 18.23131119 36.28100046 61.79195891]
E1 = -3.866283201019724  E_coul = 1.0286398661270457
cycle= 27 E= -2.83764333489268  delta_E= -1.96e-06  |g|= 0.000194  |ddm|= 6.86
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498094343925  LUMO = 1.61678073359227
  mo_energy =
[-0.90449809  1.61678073  7.63355005 18.23145003 36.28122732 61.7924909 ]
E1 = -3.866282472810794  E_coul = 1.0286403405430682
cycle= 28 E= -2.83764213226773  delta_E= 1.2e-06  |g|= 0.000132  |ddm|= 10.3
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499946866061  LUMO = 1.61674403412955
  mo_energy =
[-0.90449995  1.61674403  7.63335909 18.2308134  36.28022207 61.79048522]
E1 = -3.866285840357504  E_coul = 1.0286438815928698
cycle= 29 E= -2.83764195876463  delta_E= 1.74e-07  |g|= 4.63e-05  |ddm|= 45.8
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499216037867  LUMO = 1.61675986750856
  mo_energy =
[-0.90449922  1.61675987  7.6334431  18.23108429 36.28063961 61.79117692]
E1 = -3.8662844120013204  E_coul = 1.0286429715702563
cycle= 30 E= -2.83764144043106  delta_E= 5.18e-07  |g|= 3.39e-05  |ddm|=   19
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499105150622  LUMO = 1.61676252260212
  mo_energy =
[-0.90449911  1.61676252  7.63345736 18.23113341 36.28072048 61.79133386]
E1 = -3.866284167758499  E_coul = 1.0286417600643036
cycle= 31 E= -2.8376424076942  delta_E= -9.67e-07  |g|= 6.44e-05  |ddm|= 3.39
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499366400032  LUMO = 1.6167574199705
  mo_energy =
[-0.90449937  1.61675742  7.63343085 18.23104832 36.28059057 61.79108382]
E1 = -3.8662846301496443  E_coul = 1.028641313200001
cycle= 32 E= -2.83764331694964  delta_E= -9.09e-07  |g|= 0.000143  |ddm|= 6.15
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499647684784  LUMO = 1.61675230298515
  mo_energy =
[-0.90449965  1.6167523   7.63340536 18.23095156 36.2804273  61.79068417]
E1 = -3.8662851289939786  E_coul = 1.0286421404197086
cycle= 33 E= -2.83764298857427  delta_E= 3.28e-07  |g|= 6.94e-05  |ddm|= 7.22
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499833619682  LUMO = 1.61674843479676
  mo_energy =
[-0.90449983  1.61674843  7.63338516 18.23088865 36.28033282 61.79052349]
E1 = -3.8662854762031125  E_coul = 1.0286417437336166
cycle= 34 E= -2.8376437324695  delta_E= -7.44e-07  |g|= 0.000122  |ddm|= 4.52
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500185020687  LUMO = 1.61674142997062
  mo_energy =
[-0.90450019  1.61674143  7.63334879 18.23077218 36.28015509 61.79016698]
E1 = -3.8662861154820303  E_coul = 1.0286442040544002
cycle= 35 E= -2.83764191142763  delta_E= 1.82e-06  |g|= 7.18e-05  |ddm|=  8.5
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499981603078  LUMO = 1.61674543113829
  mo_energy =
[-0.90449998  1.61674543  7.63336972 18.23084032 36.28026211 61.79037868]
E1 = -3.8662857523687277  E_coul = 1.0286433786804987
cycle= 36 E= -2.83764237368823  delta_E= -4.62e-07  |g|= 1.31e-05  |ddm|= 4.89
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499992495337  LUMO = 1.61674505826334
  mo_energy =
[-0.90449999  1.61674506  7.63336747 18.2308357  36.28025745 61.7903862 ]
E1 = -3.866285779521221  E_coul = 1.0286449412955134
cycle= 37 E= -2.83764083822571  delta_E= 1.54e-06  |g|= 0.000143  |ddm|= 0.262
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499864124533  LUMO = 1.61674751538631
  mo_energy =
[-0.90449986  1.61674752  7.63338012 18.23087541 36.28031674 61.79050577]
E1 = -3.866285555419016  E_coul = 1.0286440662343046
cycle= 38 E= -2.83764148918471  delta_E= -6.51e-07  |g|= 7.7e-05  |ddm|= 2.95
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499977886316  LUMO = 1.61674522208402
  mo_energy =
[-0.90449998  1.61674522  7.63336837 18.23083159 36.28024241 61.79033792]
E1 = -3.8662857747844033  E_coul = 1.0286437569397178
cycle= 39 E= -2.83764201784469  delta_E= -5.29e-07  |g|= 3.74e-05  |ddm|= 3.16
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500324979509  LUMO = 1.6167391420935
  mo_energy =
[-0.90450032  1.61673914  7.63333848 18.23071293 36.28003553 61.78981255]
E1 = -3.866286376403059  E_coul = 1.028643320182637
cycle= 40 E= -2.83764305622042  delta_E= -1.04e-06  |g|= 1.68e-05  |ddm|= 8.91
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499949053272  LUMO = 1.61674579802837
  mo_energy =
[-0.90449995  1.6167458   7.63337115 18.23084284 36.28025768 61.7903914 ]
E1 = -3.8662857112956206  E_coul = 1.0286439422652598
cycle= 41 E= -2.83764176903036  delta_E= 1.29e-06  |g|= 5.99e-05  |ddm|= 9.83
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499306200013  LUMO = 1.61675932962185
  mo_energy =
[-0.90449931  1.61675933  7.63344182 18.23105993 36.28057616 61.79091663]
E1 = -3.866284495127867  E_coul = 1.0286427786209336
cycle= 42 E= -2.83764171650693  delta_E= 5.25e-08  |g|= 6.73e-06  |ddm|= 15.7
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499080114677  LUMO = 1.61676263234735
  mo_energy =
[-0.90449908  1.61676263  7.63345909 18.23110813 36.28064747 61.791072  ]
E1 = -3.8662842182538646  E_coul = 1.028642994326533
cycle= 43 E= -2.83764122392733  delta_E= 4.93e-07  |g|= 4.85e-05  |ddm|= 3.53
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499089012795  LUMO = 1.61676251979872
  mo_energy =
[-0.90449909  1.61676252  7.63345851 18.23111315 36.28066345 61.7911273 ]
E1 = -3.8662842190366637  E_coul = 1.0286432468614615
cycle= 44 E= -2.8376409721752  delta_E= 2.52e-07  |g|= 6.52e-05  |ddm|= 0.27
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499004515141  LUMO = 1.61676431832494
  mo_energy =
[-0.904499    1.61676432  7.63346791 18.23114446 36.28071313 61.79123159]
E1 = -3.8662840531001033  E_coul = 1.028642115961125
cycle= 45 E= -2.83764193713898  delta_E= -9.65e-07  |g|= 2.4e-05  |ddm|= 2.25
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90449924403304  LUMO = 1.61675939733013
  mo_energy =
[-0.90449924  1.6167594   7.63344192 18.23106456 36.2805944  61.79102391]
E1 = -3.866284491729141  E_coul = 1.0286451251384452
cycle= 46 E= -2.8376393665907  delta_E= 2.57e-06  |g|= 0.000238  |ddm|=  5.7
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499090653081  LUMO = 1.61676220475076
  mo_energy =
[-0.90449909  1.6167622   7.63345603 18.23111886 36.28068721 61.79124259]
E1 = -3.866284219239896  E_coul = 1.0286415259219703
cycle= 47 E= -2.83764269331793  delta_E= -3.33e-06  |g|= 0.000101  |ddm|= 3.98
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499256415069  LUMO = 1.61675894463561
  mo_energy =
[-0.90449926  1.61675894  7.63343914 18.23106342 36.2806009  61.79106327]
E1 = -3.8662845193613893  E_coul = 1.0286426686247676
cycle= 48 E= -2.83764185073662  delta_E= 8.43e-07  |g|= 9.39e-06  |ddm|= 4.05
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498945447751  LUMO = 1.61676572103628
  mo_energy =
[-0.90449895  1.61676572  7.63347451 18.23118074 36.28078291 61.79140069]
E1 = -3.866283893805536  E_coul = 1.028642947947836
cycle= 49 E= -2.8376409458577  delta_E= 9.05e-07  |g|= 5.99e-05  |ddm|= 8.42
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498488350551  LUMO = 1.6167741548845
  mo_energy =
[-0.90449849  1.61677415  7.63351633 18.23134633 36.2810658  61.79206625]
E1 = -3.86628305588013  E_coul = 1.0286405256635165
cycle= 50 E= -2.83764253021661  delta_E= -1.58e-06  |g|= 0.000143  |ddm|= 12.3
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.86628305588013  E_coul = 1.0286405256635165

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904501002441653  LUMO = 1.61674495015091
  mo_energy =
[-0.904501    1.61674495  7.63337181 18.23082651 36.28022126 61.79026468]
E1 = -3.8662855881390414  E_coul = 1.0286418924844054
Extra cycle  E= -2.83764369565464  delta_E= -1.17e-06  |g|= 0.000107  |ddm|=   37
    CPU time for scf_cycle      0.50 sec, wall time      0.50 sec
exp = [6.38978344 5.63379935 4.95997601 4.25800793 3.85113185 0.37920381]
E = -2.837643695654636
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:15 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.38978343519        1
[INPUT] 0    0    [1    /1   ]  5.63379935392        1
[INPUT] 0    0    [1    /1   ]  4.95997601442        1
[INPUT] 0    0    [1    /1   ]  4.25800792602        1
[INPUT] 0    0    [1    /1   ]  3.85113185404        1
[INPUT] 0    0    [1    /1   ]  0.379203807377       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.389783435191572, 1.0]], [0, [5.633799353919097, 1.0]], [0, [4.959976014420727, 1.0]], [0, [4.258007926016358, 1.0]], [0, [3.8511318540408057, 1.0]], [0, [0.37920380737718223, 1.0]]]}
ecp = {}
CPU time:        72.44
Set gradient conv threshold to 3.16228e-05
cond(S) = 972722329.4528106

WARN: Singularity detected in overlap matrix (condition number = 9.73e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8565761921902473  E_coul = 1.0242325568500679
init E= -2.83234363534018
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906696359908115  LUMO = 1.61280207689743
  mo_energy =
[-0.90669636  1.61280208  7.62873228 18.22665193 36.27636664 61.78815797]
E1 = -3.8665445853590072  E_coul = 1.0289012985504231
cycle= 1 E= -2.83764328680858  delta_E= -0.0053  |g|= 0.00598  |ddm|= 9.06e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904371867286201  LUMO = 1.6167566949669
  mo_energy =
[-0.90437187  1.61675669  7.63333108 18.23024818 36.27913101 61.78729217]
E1 = -3.866292785713246  E_coul = 1.02865043547704
cycle= 2 E= -2.83764235023621  delta_E= 9.37e-07  |g|= 0.000441  |ddm|=  663
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904503274051139  LUMO = 1.6167496686154
  mo_energy =
[-0.90450327  1.61674967  7.63339794 18.23092205 36.28036113 61.79051268]
E1 = -3.866284345727945  E_coul = 1.028642435383069
cycle= 3 E= -2.83764191034488  delta_E= 4.4e-07  |g|= 3e-05  |ddm|= 4.89
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904499031026304  LUMO = 1.61676010574864
  mo_energy =
[-0.90449903  1.61676011  7.63344859 18.23106026 36.28056483 61.79075244]
E1 = -3.86628457063787  E_coul = 1.028643566270104
cycle= 4 E= -2.83764100436777  delta_E= 9.06e-07  |g|= 7.82e-05  |ddm|= 8.22
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904498801493854  LUMO = 1.61677471509421
  mo_energy =
[-0.9044988   1.61677472  7.63352324 18.23132124 36.28097848 61.79165857]
E1 = -3.866283027888939  E_coul = 1.0286384464399594
cycle= 5 E= -2.83764458144898  delta_E= -3.58e-06  |g|= 0.000319  |ddm|= 19.8
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500831094257  LUMO = 1.61674201377591
  mo_energy =
[-0.90450083  1.61674201  7.63335702 18.23076122 36.28009697 61.78979736]
E1 = -3.866285988228513  E_coul = 1.0286422007862963
cycle= 6 E= -2.83764378744222  delta_E= 7.94e-07  |g|= 9.06e-05  |ddm|= 40.8
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500851157643  LUMO = 1.61673492376605
  mo_energy =
[-0.90450085  1.61673492  7.63331785 18.23064541 36.27993002 61.78956874]
E1 = -3.866286683056365  E_coul = 1.0286449494809324
cycle= 7 E= -2.83764173357543  delta_E= 2.05e-06  |g|= 0.000123  |ddm|= 8.41
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500279416205  LUMO = 1.61674094280202
  mo_energy =
[-0.90450028  1.61674094  7.63334771 18.23074781 36.28009397 61.78992397]
E1 = -3.866286186991317  E_coul = 1.0286442624038818
cycle= 8 E= -2.83764192458744  delta_E= -1.91e-07  |g|= 7.53e-05  |ddm|= 7.23
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499994373396  LUMO = 1.61674430823181
  mo_energy =
[-0.90449999  1.61674431  7.63336482 18.23080239 36.28017786 61.79008988]
E1 = -3.8662859115880015  E_coul = 1.0286450483642307
cycle= 9 E= -2.83764086322377  delta_E= 1.06e-06  |g|= 0.000161  |ddm|= 3.83
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499649296066  LUMO = 1.616749926797
  mo_energy =
[-0.90449965  1.61674993  7.63339321 18.23089957 36.28033251 61.790432  ]
E1 = -3.8662853972858553  E_coul = 1.028643384773223
cycle= 10 E= -2.83764201251263  delta_E= -1.15e-06  |g|= 2.33e-05  |ddm|= 7.15
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499898055457  LUMO = 1.61674966372171
  mo_energy =
[-0.9044999   1.61674966  7.63339344 18.23089074 36.28030787 61.79031667]
E1 = -3.8662853885262902  E_coul = 1.0286424509412289
cycle= 11 E= -2.83764293758506  delta_E= -9.25e-07  |g|= 5.97e-05  |ddm|= 0.581
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500550466912  LUMO = 1.61673832647793
  mo_energy =
[-0.90450055  1.61673833  7.63333636 18.23069041 36.27998439 61.78959222]
E1 = -3.8662864509485804  E_coul = 1.0286458686144218
cycle= 12 E= -2.83764058233416  delta_E= 2.36e-06  |g|= 0.000218  |ddm|= 14.9
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500378351138  LUMO = 1.61674137519475
  mo_energy =
[-0.90450038  1.61674138  7.63335207 18.23074241 36.28006566 61.78975488]
E1 = -3.866286175506743  E_coul = 1.0286439767848272
cycle= 13 E= -2.83764219872192  delta_E= -1.62e-06  |g|= 6e-05  |ddm|= 3.75
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90449904414864  LUMO = 1.61676246322158
  mo_energy =
[-0.90449904  1.61676246  7.63346059 18.23108865 36.28059095 61.79078046]
E1 = -3.8662843260092012  E_coul = 1.028641248391778
cycle= 14 E= -2.83764307761742  delta_E= -8.79e-07  |g|= 0.00011  |ddm|= 24.9
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499724077838  LUMO = 1.61674941591281
  mo_energy =
[-0.90449972  1.61674942  7.63339084 18.23089234 36.28032169 61.79043049]
E1 = -3.866285429325781  E_coul = 1.0286427662824758
cycle= 15 E= -2.83764266304331  delta_E= 4.15e-07  |g|= 3.77e-05  |ddm|= 13.7
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499825329826  LUMO = 1.61674773067749
  mo_energy =
[-0.90449983  1.61674773  7.63338277 18.23085883 36.28026285 61.79027785]
E1 = -3.8662855998895544  E_coul = 1.0286442249144194
cycle= 16 E= -2.83764137497514  delta_E= 1.29e-06  |g|= 0.000102  |ddm|= 2.56
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499697335169  LUMO = 1.61675001369106
  mo_energy =
[-0.9044997   1.61675001  7.63339419 18.23090153 36.28033446 61.7904448 ]
E1 = -3.86628538016737  E_coul = 1.0286445971017684
cycle= 17 E= -2.8376407830656  delta_E= 5.92e-07  |g|= 0.000128  |ddm|= 3.16
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9044995665577  LUMO = 1.61675300634008
  mo_energy =
[-0.90449957  1.61675301  7.63341056 18.23094635 36.28039439 61.79049957]
E1 = -3.8662851275787573  E_coul = 1.0286431890386634
cycle= 18 E= -2.83764193854009  delta_E= -1.16e-06  |g|= 2.07e-05  |ddm|= 3.05
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90449952568749  LUMO = 1.61675386480594
  mo_energy =
[-0.90449953  1.61675386  7.6334152  18.23096409 36.28042616 61.79056617]
E1 = -3.8662850483472933  E_coul = 1.028643837513775
cycle= 19 E= -2.83764121083352  delta_E= 7.28e-07  |g|= 8.56e-05  |ddm|= 1.19
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499252560106  LUMO = 1.61675874997889
  mo_energy =
[-0.90449925  1.61675875  7.63343955 18.23105269 36.28057288 61.79092157]
E1 = -3.866284579886018  E_coul = 1.0286445910045372
cycle= 20 E= -2.83763998888148  delta_E= 1.22e-06  |g|= 0.000185  |ddm|= 6.65
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499046856491  LUMO = 1.61676282529628
  mo_energy =
[-0.90449905  1.61676283  7.63346017 18.23112496 36.2806898  61.79118969]
E1 = -3.8662841916165047  E_coul = 1.0286397339951436
cycle= 21 E= -2.83764445762136  delta_E= -4.47e-06  |g|= 0.000255  |ddm|=  5.4
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499024685938  LUMO = 1.61676377265433
  mo_energy =
[-0.90449902  1.61676377  7.63346607 18.23113372 36.28069249 61.79112243]
E1 = -3.8662841299800865  E_coul = 1.028642031300562
cycle= 22 E= -2.83764209867952  delta_E= 2.36e-06  |g|= 3.23e-05  |ddm|= 0.415
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499007920471  LUMO = 1.61676412593067
  mo_energy =
[-0.90449901  1.61676413  7.63346778 18.23113994 36.28070246 61.79114686]
E1 = -3.8662840946201698  E_coul = 1.0286431776859348
cycle= 23 E= -2.83764091693423  delta_E= 1.18e-06  |g|= 7.45e-05  |ddm|= 0.49
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498673847424  LUMO = 1.61677031705503
  mo_energy =
[-0.90449867  1.61677032  7.63349918 18.23125194 36.28088558 61.79154704]
E1 = -3.8662835097854082  E_coul = 1.028641110913784
cycle= 24 E= -2.83764239887162  delta_E= -1.48e-06  |g|= 9.81e-05  |ddm|= 8.22
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498508870621  LUMO = 1.61677392167335
  mo_energy =
[-0.90449851  1.61677392  7.63351888 18.23130535 36.28095783 61.79162747]
E1 = -3.8662832088503563  E_coul = 1.0286410095859366
cycle= 25 E= -2.83764219926442  delta_E= 2e-07  |g|= 8.64e-05  |ddm|= 3.63
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498763849723  LUMO = 1.61676824777783
  mo_energy =
[-0.90449876  1.61676825  7.63348789 18.23122371 36.28085448 61.7915647 ]
E1 = -3.8662836826655322  E_coul = 1.0286423126060296
cycle= 26 E= -2.8376413700595  delta_E= 8.29e-07  |g|= 7.27e-06  |ddm|= 5.56
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498502060341  LUMO = 1.61677309090166
  mo_energy =
[-0.9044985   1.61677309  7.63351133 18.23131119 36.28100046 61.79195891]
E1 = -3.866283201019724  E_coul = 1.0286398661270457
cycle= 27 E= -2.83764333489268  delta_E= -1.96e-06  |g|= 0.000194  |ddm|= 6.86
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498094343925  LUMO = 1.61678073359227
  mo_energy =
[-0.90449809  1.61678073  7.63355005 18.23145003 36.28122732 61.7924909 ]
E1 = -3.866282472810794  E_coul = 1.0286403405430682
cycle= 28 E= -2.83764213226773  delta_E= 1.2e-06  |g|= 0.000132  |ddm|= 10.3
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499946866061  LUMO = 1.61674403412955
  mo_energy =
[-0.90449995  1.61674403  7.63335909 18.2308134  36.28022207 61.79048522]
E1 = -3.866285840357504  E_coul = 1.0286438815928698
cycle= 29 E= -2.83764195876463  delta_E= 1.74e-07  |g|= 4.63e-05  |ddm|= 45.8
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499216037867  LUMO = 1.61675986750856
  mo_energy =
[-0.90449922  1.61675987  7.6334431  18.23108429 36.28063961 61.79117692]
E1 = -3.8662844120013204  E_coul = 1.0286429715702563
cycle= 30 E= -2.83764144043106  delta_E= 5.18e-07  |g|= 3.39e-05  |ddm|=   19
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499105150622  LUMO = 1.61676252260212
  mo_energy =
[-0.90449911  1.61676252  7.63345736 18.23113341 36.28072048 61.79133386]
E1 = -3.866284167758499  E_coul = 1.0286417600643036
cycle= 31 E= -2.8376424076942  delta_E= -9.67e-07  |g|= 6.44e-05  |ddm|= 3.39
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499366400032  LUMO = 1.6167574199705
  mo_energy =
[-0.90449937  1.61675742  7.63343085 18.23104832 36.28059057 61.79108382]
E1 = -3.8662846301496443  E_coul = 1.028641313200001
cycle= 32 E= -2.83764331694964  delta_E= -9.09e-07  |g|= 0.000143  |ddm|= 6.15
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499647684784  LUMO = 1.61675230298515
  mo_energy =
[-0.90449965  1.6167523   7.63340536 18.23095156 36.2804273  61.79068417]
E1 = -3.8662851289939786  E_coul = 1.0286421404197086
cycle= 33 E= -2.83764298857427  delta_E= 3.28e-07  |g|= 6.94e-05  |ddm|= 7.22
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499833619682  LUMO = 1.61674843479676
  mo_energy =
[-0.90449983  1.61674843  7.63338516 18.23088865 36.28033282 61.79052349]
E1 = -3.8662854762031125  E_coul = 1.0286417437336166
cycle= 34 E= -2.8376437324695  delta_E= -7.44e-07  |g|= 0.000122  |ddm|= 4.52
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500185020687  LUMO = 1.61674142997062
  mo_energy =
[-0.90450019  1.61674143  7.63334879 18.23077218 36.28015509 61.79016698]
E1 = -3.8662861154820303  E_coul = 1.0286442040544002
cycle= 35 E= -2.83764191142763  delta_E= 1.82e-06  |g|= 7.18e-05  |ddm|=  8.5
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499981603078  LUMO = 1.61674543113829
  mo_energy =
[-0.90449998  1.61674543  7.63336972 18.23084032 36.28026211 61.79037868]
E1 = -3.8662857523687277  E_coul = 1.0286433786804987
cycle= 36 E= -2.83764237368823  delta_E= -4.62e-07  |g|= 1.31e-05  |ddm|= 4.89
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499992495337  LUMO = 1.61674505826334
  mo_energy =
[-0.90449999  1.61674506  7.63336747 18.2308357  36.28025745 61.7903862 ]
E1 = -3.866285779521221  E_coul = 1.0286449412955134
cycle= 37 E= -2.83764083822571  delta_E= 1.54e-06  |g|= 0.000143  |ddm|= 0.262
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499864124533  LUMO = 1.61674751538631
  mo_energy =
[-0.90449986  1.61674752  7.63338012 18.23087541 36.28031674 61.79050577]
E1 = -3.866285555419016  E_coul = 1.0286440662343046
cycle= 38 E= -2.83764148918471  delta_E= -6.51e-07  |g|= 7.7e-05  |ddm|= 2.95
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499977886316  LUMO = 1.61674522208402
  mo_energy =
[-0.90449998  1.61674522  7.63336837 18.23083159 36.28024241 61.79033792]
E1 = -3.8662857747844033  E_coul = 1.0286437569397178
cycle= 39 E= -2.83764201784469  delta_E= -5.29e-07  |g|= 3.74e-05  |ddm|= 3.16
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500324979509  LUMO = 1.6167391420935
  mo_energy =
[-0.90450032  1.61673914  7.63333848 18.23071293 36.28003553 61.78981255]
E1 = -3.866286376403059  E_coul = 1.028643320182637
cycle= 40 E= -2.83764305622042  delta_E= -1.04e-06  |g|= 1.68e-05  |ddm|= 8.91
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499949053272  LUMO = 1.61674579802837
  mo_energy =
[-0.90449995  1.6167458   7.63337115 18.23084284 36.28025768 61.7903914 ]
E1 = -3.8662857112956206  E_coul = 1.0286439422652598
cycle= 41 E= -2.83764176903036  delta_E= 1.29e-06  |g|= 5.99e-05  |ddm|= 9.83
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499306200013  LUMO = 1.61675932962185
  mo_energy =
[-0.90449931  1.61675933  7.63344182 18.23105993 36.28057616 61.79091663]
E1 = -3.866284495127867  E_coul = 1.0286427786209336
cycle= 42 E= -2.83764171650693  delta_E= 5.25e-08  |g|= 6.73e-06  |ddm|= 15.7
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499080114677  LUMO = 1.61676263234735
  mo_energy =
[-0.90449908  1.61676263  7.63345909 18.23110813 36.28064747 61.791072  ]
E1 = -3.8662842182538646  E_coul = 1.028642994326533
cycle= 43 E= -2.83764122392733  delta_E= 4.93e-07  |g|= 4.85e-05  |ddm|= 3.53
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499089012795  LUMO = 1.61676251979872
  mo_energy =
[-0.90449909  1.61676252  7.63345851 18.23111315 36.28066345 61.7911273 ]
E1 = -3.8662842190366637  E_coul = 1.0286432468614615
cycle= 44 E= -2.8376409721752  delta_E= 2.52e-07  |g|= 6.52e-05  |ddm|= 0.27
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499004515141  LUMO = 1.61676431832494
  mo_energy =
[-0.904499    1.61676432  7.63346791 18.23114446 36.28071313 61.79123159]
E1 = -3.8662840531001033  E_coul = 1.028642115961125
cycle= 45 E= -2.83764193713898  delta_E= -9.65e-07  |g|= 2.4e-05  |ddm|= 2.25
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90449924403304  LUMO = 1.61675939733013
  mo_energy =
[-0.90449924  1.6167594   7.63344192 18.23106456 36.2805944  61.79102391]
E1 = -3.866284491729141  E_coul = 1.0286451251384452
cycle= 46 E= -2.8376393665907  delta_E= 2.57e-06  |g|= 0.000238  |ddm|=  5.7
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499090653081  LUMO = 1.61676220475076
  mo_energy =
[-0.90449909  1.6167622   7.63345603 18.23111886 36.28068721 61.79124259]
E1 = -3.866284219239896  E_coul = 1.0286415259219703
cycle= 47 E= -2.83764269331793  delta_E= -3.33e-06  |g|= 0.000101  |ddm|= 3.98
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499256415069  LUMO = 1.61675894463561
  mo_energy =
[-0.90449926  1.61675894  7.63343914 18.23106342 36.2806009  61.79106327]
E1 = -3.8662845193613893  E_coul = 1.0286426686247676
cycle= 48 E= -2.83764185073662  delta_E= 8.43e-07  |g|= 9.39e-06  |ddm|= 4.05
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498945447751  LUMO = 1.61676572103628
  mo_energy =
[-0.90449895  1.61676572  7.63347451 18.23118074 36.28078291 61.79140069]
E1 = -3.866283893805536  E_coul = 1.028642947947836
cycle= 49 E= -2.8376409458577  delta_E= 9.05e-07  |g|= 5.99e-05  |ddm|= 8.42
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498488350551  LUMO = 1.6167741548845
  mo_energy =
[-0.90449849  1.61677415  7.63351633 18.23134633 36.2810658  61.79206625]
E1 = -3.86628305588013  E_coul = 1.0286405256635165
cycle= 50 E= -2.83764253021661  delta_E= -1.58e-06  |g|= 0.000143  |ddm|= 12.3
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.86628305588013  E_coul = 1.0286405256635165

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904501002441653  LUMO = 1.61674495015091
  mo_energy =
[-0.904501    1.61674495  7.63337181 18.23082651 36.28022126 61.79026468]
E1 = -3.8662855881390414  E_coul = 1.0286418924844054
Extra cycle  E= -2.83764369565464  delta_E= -1.17e-06  |g|= 0.000107  |ddm|=   37
    CPU time for scf_cycle      0.51 sec, wall time      0.51 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 972722329.4528106

WARN: Singularity detected in overlap matrix (condition number = 9.73e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8662855881390414  E_coul = 1.0286418924844054
init E= -2.83764369565464
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.904500901671819  LUMO = 1.61672325143175
  mo_energy =
[-0.9045009   1.61672325  7.63325717 18.23045163 36.27964396 61.78898359]
E1 = -3.8662879130519574  E_coul = 1.0286475697611217
cycle= 1 E= -2.83764034329084  delta_E= 3.35e-06  |g|= 0.000305  |ddm|= 29.6
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904496387530325  LUMO = 1.6167878901642
  mo_energy =
[-0.90449639  1.61678789  7.63358111 18.23156103 36.28140823 61.79288332]
E1 = -3.8662821186459966  E_coul = 1.0286389225760533
cycle= 2 E= -2.83764319606994  delta_E= -2.85e-06  |g|= 0.000255  |ddm|= 81.3
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904498171627527  LUMO = 1.61677011191579
  mo_energy =
[-0.90449817  1.61677011  7.6334929  18.23126371 36.28093592 61.79186948]
E1 = -3.8662835545053063  E_coul = 1.0286406261388739
cycle= 3 E= -2.83764292836643  delta_E= 2.68e-07  |g|= 0.000158  |ddm|= 20.8
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498526935271  LUMO = 1.61676581084183
  mo_energy =
[-0.90449853  1.61676581  7.6334724  18.23118419 36.28080083 61.79152473]
E1 = -3.8662839540459184  E_coul = 1.0286387563065016
cycle= 4 E= -2.83764519773942  delta_E= -2.27e-06  |g|= 0.000347  |ddm|= 5.99
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499291813639  LUMO = 1.61675204159915
  mo_energy =
[-0.90449929  1.61675204  7.63340242 18.23094528 36.28042203 61.7907111 ]
E1 = -3.8662852308472364  E_coul = 1.0286429831608008
cycle= 5 E= -2.83764224768644  delta_E= 2.95e-06  |g|= 4.5e-06  |ddm|= 17.6
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499269576858  LUMO = 1.61675266060611
  mo_energy =
[-0.90449927  1.61675266  7.63340522 18.23095685 36.28044225 61.79077655]
E1 = -3.8662851614948144  E_coul = 1.0286465100289826
cycle= 6 E= -2.83763865146583  delta_E= 3.6e-06  |g|= 0.000324  |ddm|= 0.997
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498532899652  LUMO = 1.61676718277355
  mo_energy =
[-0.90449853  1.61676718  7.63347938 18.23121057 36.28084453 61.79163684]
E1 = -3.8662837965308348  E_coul = 1.028642870177011
cycle= 7 E= -2.83764092635382  delta_E= -2.27e-06  |g|= 4.04e-05  |ddm|= 18.7
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498395466163  LUMO = 1.61677063496578
  mo_energy =
[-0.9044984   1.61677063  7.63349741 18.23126905 36.28093408 61.79181505]
E1 = -3.8662834711335337  E_coul = 1.0286425347736385
cycle= 8 E= -2.83764093635989  delta_E= -1e-08  |g|= 4.51e-05  |ddm|=  4.3
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498294096358  LUMO = 1.61677282114527
  mo_energy =
[-0.90449829  1.61677282  7.63350803 18.23131293 36.28101181 61.79202383]
E1 = -3.8662832428395375  E_coul = 1.02864213120317
cycle= 9 E= -2.83764111163637  delta_E= -1.75e-07  |g|= 3.38e-06  |ddm|= 3.38
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498111576937  LUMO = 1.61678023031872
  mo_energy =
[-0.90449811  1.61678023  7.63354666 18.23144295 36.28121617 61.7924625 ]
E1 = -3.866282501713055  E_coul = 1.0286395420233883
cycle= 10 E= -2.83764295968967  delta_E= -1.85e-06  |g|= 0.00021  |ddm|= 9.81
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90449693477783  LUMO = 1.61679651870079
  mo_energy =
[-0.90449693  1.61679652  7.63362782 18.23172583 36.28166835 61.79347014]
E1 = -3.866281038613376  E_coul = 1.0286384664181234
cycle= 11 E= -2.83764257219525  delta_E= 3.87e-07  |g|= 0.000248  |ddm|= 20.7
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904497847541123  LUMO = 1.61678025607755
  mo_energy =
[-0.90449785  1.61678026  7.63354494 18.23144376 36.28122185 61.79252483]
E1 = -3.8662825405443693  E_coul = 1.028640829715633
cycle= 12 E= -2.83764171082874  delta_E= 8.61e-07  |g|= 0.0001  |ddm|= 20.7
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904497338328056  LUMO = 1.61679048668216
  mo_energy =
[-0.90449734  1.61679049  7.63359706 18.23162282 36.28150699 61.79314394]
E1 = -3.8662815734310874  E_coul = 1.0286400819036925
cycle= 13 E= -2.83764149152739  delta_E= 2.19e-07  |g|= 0.000127  |ddm|= 13.3
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904496508717449  LUMO = 1.61680725373709
  mo_energy =
[-0.90449651  1.61680725  7.63368256 18.23192312 36.28199114 61.7942062 ]
E1 = -3.866279976341114  E_coul = 1.0286395858486221
cycle= 14 E= -2.83764039049249  delta_E= 1.1e-06  |g|= 9.72e-05  |ddm|= 22.1
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498822292974  LUMO = 1.616764444981
  mo_energy =
[-0.90449882  1.61676444  7.63346615 18.2311633  36.28076592 61.79147231]
E1 = -3.866284024109432  E_coul = 1.0286419662912043
cycle= 15 E= -2.83764205781823  delta_E= -1.67e-06  |g|= 4.29e-05  |ddm|= 56.4
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499401863052  LUMO = 1.61675276875275
  mo_energy =
[-0.9044994   1.61675277  7.63340431 18.23097347 36.28048714 61.7910214 ]
E1 = -3.8662850577080925  E_coul = 1.0286441693060444
cycle= 16 E= -2.83764088840205  delta_E= 1.17e-06  |g|= 0.000113  |ddm|= 13.4
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499034367532  LUMO = 1.61676001684145
  mo_energy =
[-0.90449903  1.61676002  7.63344159 18.23109723 36.28068028 61.79139326]
E1 = -3.8662843864986276  E_coul = 1.0286415429688414
cycle= 17 E= -2.83764284352979  delta_E= -1.96e-06  |g|= 0.000117  |ddm|= 9.09
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499575650174  LUMO = 1.6167510873197
  mo_energy =
[-0.90449958  1.61675109  7.63339818 18.2309285  36.28039003 61.79062591]
E1 = -3.8662852632500337  E_coul = 1.0286404660879838
cycle= 18 E= -2.83764479716205  delta_E= -1.95e-06  |g|= 0.000225  |ddm|= 12.9
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500258734031  LUMO = 1.61673678900293
  mo_energy =
[-0.90450026  1.61673679  7.63332365 18.23068964 36.28002705 61.78994219]
E1 = -3.866286570064923  E_coul = 1.0286437170722507
cycle= 19 E= -2.83764285299267  delta_E= 1.94e-06  |g|= 1.02e-05  |ddm|= 17.3
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90450014476104  LUMO = 1.61673931668816
  mo_energy =
[-0.90450014  1.61673932  7.63333796 18.23072583 36.28007257 61.78995654]
E1 = -3.8662863705478725  E_coul = 1.0286432691132532
cycle= 20 E= -2.83764310143462  delta_E= -2.48e-07  |g|= 1.96e-05  |ddm|=  2.3
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500112476394  LUMO = 1.61673968369483
  mo_energy =
[-0.90450011  1.61673968  7.63333945 18.23073875 36.28010215 61.79006467]
E1 = -3.866286321980799  E_coul = 1.0286459382026425
cycle= 21 E= -2.83764038377816  delta_E= 2.72e-06  |g|= 0.000228  |ddm|= 0.996
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499661135716  LUMO = 1.61674814725335
  mo_energy =
[-0.90449966  1.61674815  7.63338234 18.23089048 36.28034968 61.79062747]
E1 = -3.866285520569967  E_coul = 1.0286425965868606
cycle= 22 E= -2.83764292398311  delta_E= -2.54e-06  |g|= 4.92e-05  |ddm|= 11.2
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904499786888028  LUMO = 1.61674572272356
  mo_energy =
[-0.90449979  1.61674572  7.63336976 18.23084733 36.28027952 61.79047204]
E1 = -3.8662857451686214  E_coul = 1.0286413724752363
cycle= 23 E= -2.83764437269339  delta_E= -1.45e-06  |g|= 0.00018  |ddm|= 3.12
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500134298632  LUMO = 1.61673952808491
  mo_energy =
[-0.90450013  1.61673953  7.63333871 18.23073507 36.28009404 61.79001995]
E1 = -3.86628633652941  E_coul = 1.0286437924783842
cycle= 24 E= -2.83764254405103  delta_E= 1.83e-06  |g|= 2.88e-05  |ddm|= 8.39
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500609399367  LUMO = 1.61673094038255
  mo_energy =
[-0.90450061  1.61673094  7.6332957  18.23057997 36.27983838 61.78941564]
E1 = -3.866287156681149  E_coul = 1.0286445675769562
cycle= 25 E= -2.83764258910419  delta_E= -4.51e-08  |g|= 5.33e-05  |ddm|= 11.6
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501173047904  LUMO = 1.61671869187622
  mo_energy =
[-0.90450117  1.61671869  7.63323043 18.23038713 36.27956325 61.78899449]
E1 = -3.86628823841339  E_coul = 1.0286467723244366
cycle= 26 E= -2.83764146608895  delta_E= 1.12e-06  |g|= 0.000215  |ddm|= 13.7
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500575663645  LUMO = 1.61673108036193
  mo_energy =
[-0.90450058  1.61673108  7.63329575 18.23058844 36.27985962 61.78949263]
E1 = -3.8662871318294063  E_coul = 1.0286461305105898
cycle= 27 E= -2.83764100131882  delta_E= 4.65e-07  |g|= 0.000205  |ddm|= 14.4
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500523654146  LUMO = 1.61673194923483
  mo_energy =
[-0.90450052  1.61673195  7.63329991 18.23060636 36.27989195 61.7895812 ]
E1 = -3.866287042767522  E_coul = 1.0286430996983909
cycle= 28 E= -2.83764394306913  delta_E= -2.94e-06  |g|= 7.27e-05  |ddm|= 1.37
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904500498347468  LUMO = 1.61673257573913
  mo_energy =
[-0.9045005   1.61673258  7.63330339 18.23061243 36.27989487 61.78955139]
E1 = -3.8662869957121972  E_coul = 1.0286431658132469
cycle= 29 E= -2.83764382989895  delta_E= 1.13e-07  |g|= 5.97e-05  |ddm|= 0.407
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501170105176  LUMO = 1.61671985014763
  mo_energy =
[-0.90450117  1.61671985  7.63323866 18.23038644 36.27952886 61.78872821]
E1 = -3.866288194820915  E_coul = 1.0286460254444685
cycle= 30 E= -2.83764216937645  delta_E= 1.66e-06  |g|= 0.00014  |ddm|= 16.7
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501700380796  LUMO = 1.61671000005089
  mo_energy =
[-0.9045017   1.61671     7.63318895 18.23021831 36.27926611 61.78817032]
E1 = -3.866289117241561  E_coul = 1.028649237123185
cycle= 31 E= -2.83763988011838  delta_E= 2.29e-06  |g|= 0.000414  |ddm|= 12.6
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501885218786  LUMO = 1.61670674713012
  mo_energy =
[-0.90450189  1.61670675  7.63317307 18.23015532 36.27915525 61.78786648]
E1 = -3.8662894379685584  E_coul = 1.0286466650466788
cycle= 32 E= -2.83764277292188  delta_E= -2.89e-06  |g|= 0.000161  |ddm|= 4.76
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501429037072  LUMO = 1.6167165487339
  mo_energy =
[-0.90450143  1.61671655  7.633225   18.23031212 36.2793857  61.78827621]
E1 = -3.8662885663850974  E_coul = 1.0286453768400639
cycle= 33 E= -2.83764318954503  delta_E= -4.17e-07  |g|= 8.96e-05  |ddm|= 11.2
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501400979084  LUMO = 1.61671665597078
  mo_energy =
[-0.9045014   1.61671666  7.63322472 18.23032569 36.27942398 61.78843895]
E1 = -3.86628852986495  E_coul = 1.028647968002123
cycle= 34 E= -2.83764056186283  delta_E= 2.63e-06  |g|= 0.000323  |ddm|= 1.12
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501457793832  LUMO = 1.61671556668216
  mo_energy =
[-0.90450146  1.61671557  7.63321912 18.23030645 36.27939314 61.78837319]
E1 = -3.8662886311237084  E_coul = 1.0286468059812883
cycle= 35 E= -2.83764182514242  delta_E= -1.26e-06  |g|= 0.000218  |ddm|=  1.4
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90450280092181  LUMO = 1.61668944829405
  mo_energy =
[-0.9045028   1.61668945  7.63308564 18.22984499 36.2786545  61.78678984]
E1 = -3.8662910845408054  E_coul = 1.0286496993018037
cycle= 36 E= -2.837641385239  delta_E= 4.4e-07  |g|= 0.000373  |ddm|= 33.9
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904501028275917  LUMO = 1.61672287536662
  mo_energy =
[-0.90450103  1.61672288  7.6332554  18.23044222 36.27962489 61.78897927]
E1 = -3.866287926542741  E_coul = 1.028647116354721
cycle= 37 E= -2.83764081018802  delta_E= 5.75e-07  |g|= 0.000266  |ddm|= 44.1
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498954479768  LUMO = 1.6167625916122
  mo_energy =
[-0.90449895  1.61676259  7.63345874 18.23112932 36.28070741 61.79127492]
E1 = -3.866284224748612  E_coul = 1.0286435093920203
cycle= 38 E= -2.83764071535659  delta_E= 9.48e-08  |g|= 7.85e-05  |ddm|= 50.6
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498229223921  LUMO = 1.61677527726288
  mo_energy =
[-0.90449823  1.61677528  7.63352217 18.23134319 36.2810426  61.7919906 ]
E1 = -3.8662830430588038  E_coul = 1.0286427662363
cycle= 39 E= -2.8376402768225  delta_E= 4.39e-07  |g|= 6.57e-05  |ddm|= 16.1
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498208468258  LUMO = 1.61677568069016
  mo_energy =
[-0.90449821  1.61677568  7.63352427 18.23135461 36.28106574 61.79203753]
E1 = -3.8662830015710092  E_coul = 1.0286426400602622
cycle= 40 E= -2.83764036151075  delta_E= -8.47e-08  |g|= 5.5e-05  |ddm|= 0.739
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498134685856  LUMO = 1.61677726436649
  mo_energy =
[-0.90449813  1.61677726  7.63353237 18.2313831  36.28111146 61.79214612]
E1 = -3.8662828496730364  E_coul = 1.028640439907648
cycle= 41 E= -2.83764240976539  delta_E= -2.05e-06  |g|= 0.000138  |ddm|= 2.11
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498269431489  LUMO = 1.61677452567667
  mo_energy =
[-0.90449827  1.61677453  7.63351787 18.23133732 36.28104173 61.7920184 ]
E1 = -3.866283095386565  E_coul = 1.0286417929012284
cycle= 42 E= -2.83764130248534  delta_E= 1.11e-06  |g|= 1.51e-05  |ddm|= 3.24
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498391803301  LUMO = 1.61677187439597
  mo_energy =
[-0.90449839  1.61677187  7.63350342 18.23129695 36.28098595 61.79194482]
E1 = -3.8662833206776916  E_coul = 1.0286438721221476
cycle= 43 E= -2.83763944855554  delta_E= 1.85e-06  |g|= 0.000156  |ddm|= 2.78
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498132891038  LUMO = 1.61677714702625
  mo_energy =
[-0.90449813  1.61677715  7.63353083 18.23138498 36.28111945 61.79219998]
E1 = -3.866282838430696  E_coul = 1.0286414724469222
cycle= 44 E= -2.83764136598377  delta_E= -1.92e-06  |g|= 3.93e-05  |ddm|=  6.4
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498017803861  LUMO = 1.6167793918083
  mo_energy =
[-0.90449802  1.61677939  7.63354198 18.23142513 36.28118491 61.79237208]
E1 = -3.866282617064902  E_coul = 1.028638867251265
cycle= 45 E= -2.83764374981364  delta_E= -2.38e-06  |g|= 0.000276  |ddm|= 3.12
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904494846651555  LUMO = 1.6168414803466
  mo_energy =
[-0.90449485  1.61684148  7.63386367 18.23246003 36.28276727 61.79545387]
E1 = -3.8662769526303475  E_coul = 1.0286345412292839
cycle= 46 E= -2.83764241140106  delta_E= 1.34e-06  |g|= 0.00042  |ddm|= 75.3
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904497942995394  LUMO = 1.61678113578752
  mo_energy =
[-0.90449794  1.61678114  7.63355083 18.23145929 36.28124453 61.79249348]
E1 = -3.866282447685092  E_coul = 1.0286401445277373
cycle= 47 E= -2.83764230315735  delta_E= 1.08e-07  |g|= 0.00015  |ddm|= 72.8
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498297473607  LUMO = 1.61677421931106
  mo_energy =
[-0.9044983   1.61677422  7.63351498 18.23134195 36.28106272 61.79213693]
E1 = -3.8662830808860007  E_coul = 1.0286407459528009
cycle= 48 E= -2.8376423349332  delta_E= -3.18e-08  |g|= 0.000118  |ddm|= 8.51
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498715141699  LUMO = 1.61676579858847
  mo_energy =
[-0.90449872  1.6167658   7.63347138 18.23120071 36.28084625 61.79171062]
E1 = -3.866283853751214  E_coul = 1.0286420358645225
cycle= 49 E= -2.83764181788669  delta_E= 5.17e-07  |g|= 3.26e-05  |ddm|= 10.3
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904498649595857  LUMO = 1.61676692050014
  mo_energy =
[-0.90449865  1.61676692  7.63347706 18.23122254 36.28088328 61.7918029 ]
E1 = -3.8662837443377414  E_coul = 1.0286413118893614
cycle= 50 E= -2.83764243244838  delta_E= -6.15e-07  |g|= 0.000101  |ddm|= 1.62
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8662837443377414  E_coul = 1.0286413118893614

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904500560334293  LUMO = 1.61674645704665
  mo_energy =
[-0.90450056  1.61674646  7.6333764  18.23085967 36.28028437 61.79043198]
E1 = -3.8662854944712515  E_coul = 1.028644088506127
Extra cycle  E= -2.83764140596512  delta_E= 1.03e-06  |g|= 8.63e-05  |ddm|=   26
    CPU time for scf_cycle      0.52 sec, wall time      0.52 sec
exp = [6.38978344 5.63379935 4.95997601 4.25800793 3.85113185 0.37920381]
grad_E = [-3.39964956e-04 -1.63134707e-04 -2.08523647e-06  2.76192762e-04
  5.87299546e-04 -1.48508711e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:18 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.39063753123        1
[INPUT] 0    0    [1    /1   ]  5.63431975047        1
[INPUT] 0    0    [1    /1   ]  4.96075425236        1
[INPUT] 0    0    [1    /1   ]  4.25881618406        1
[INPUT] 0    0    [1    /1   ]  3.85153880516        1
[INPUT] 0    0    [1    /1   ]  0.379351445738       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.390637531229853, 1.0]], [0, [5.634319750473802, 1.0]], [0, [4.960754252361755, 1.0]], [0, [4.258816184057306, 1.0]], [0, [3.85153880516281, 1.0]], [0, [0.37935144573819685, 1.0]]]}
ecp = {}
CPU time:        75.41
Set gradient conv threshold to 3.16228e-05
cond(S) = 973466441.2733095

WARN: Singularity detected in overlap matrix (condition number = 9.73e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8565682060504773  E_coul = 1.024234639014293
init E= -2.83233356703618
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.90669620036168  LUMO = 1.61333743106425
  mo_energy =
[-0.9066962   1.61333743  7.63002267 18.22914435 36.28118245 61.7963533 ]
E1 = -3.866595976571177  E_coul = 1.0289554250100414
cycle= 1 E= -2.83764055156114  delta_E= -0.00531  |g|= 0.006  |ddm|= 9.5e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904343430181558  LUMO = 1.61740015955294
  mo_energy =
[-0.90434343  1.61740016  7.63509047 18.23433282 36.28655198 61.80144552]
E1 = -3.8663386944157208  E_coul = 1.0286953268382706
cycle= 2 E= -2.83764336757745  delta_E= -2.82e-06  |g|= 0.000397  |ddm|=  569
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.90448170483858  LUMO = 1.61731470631613
  mo_energy =
[-0.9044817   1.61731471  7.63476573 18.23365633 36.28560755 61.79987813]
E1 = -3.866336959208529  E_coul = 1.028693018794686
cycle= 3 E= -2.83764394041384  delta_E= -5.73e-07  |g|= 5.2e-05  |ddm|= 95.3
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904473783664695  LUMO = 1.61731027326932
  mo_energy =
[-0.90447378  1.61731027  7.6347276  18.23346715 36.28528181 61.79896073]
E1 = -3.866339784974787  E_coul = 1.0286974629974865
cycle= 4 E= -2.8376423219773  delta_E= 1.62e-06  |g|= 0.00017  |ddm|= 21.7
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904472596386956  LUMO = 1.61734053883723
  mo_energy =
[-0.9044726   1.61734054  7.63487886 18.23403015 36.28622004 61.80127396]
E1 = -3.866336700674721  E_coul = 1.0286954860434565
cycle= 5 E= -2.83764121463126  delta_E= 1.11e-06  |g|= 0.000104  |ddm|= 42.7
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472838208675  LUMO = 1.61735076270126
  mo_energy =
[-0.90447284  1.61735076  7.63493557 18.23419947 36.2864621  61.80164217]
E1 = -3.866335620162818  E_coul = 1.0286929815619277
cycle= 6 E= -2.83764263860089  delta_E= -1.42e-06  |g|= 7.35e-05  |ddm|= 12.8
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473518885433  LUMO = 1.61734573371579
  mo_energy =
[-0.90447352  1.61734573  7.63491219 18.23410758 36.28630191 61.80121947]
E1 = -3.8663360157919495  E_coul = 1.0286924072316657
cycle= 7 E= -2.83764360856028  delta_E= -9.7e-07  |g|= 0.00013  |ddm|= 6.52
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474025666272  LUMO = 1.61733859836765
  mo_energy =
[-0.90447403  1.6173386   7.63487602 18.23398724 36.28611301 61.80081667]
E1 = -3.8663366394221885  E_coul = 1.028692742299681
cycle= 8 E= -2.83764389712251  delta_E= -2.89e-07  |g|= 0.00012  |ddm|= 8.68
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474316389317  LUMO = 1.61733321932607
  mo_energy =
[-0.90447432  1.61733322  7.63484763 18.23390051 36.2859847  61.80059237]
E1 = -3.8663371089106158  E_coul = 1.028694971070468
cycle= 9 E= -2.83764213784015  delta_E= 1.76e-06  |g|= 5.18e-05  |ddm|= 6.13
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474194565602  LUMO = 1.61733528481187
  mo_energy =
[-0.90447419  1.61733528  7.6348588  18.23393022 36.28602297 61.80062151]
E1 = -3.866336943841617  E_coul = 1.028694821855863
cycle= 10 E= -2.83764212198575  delta_E= 1.59e-08  |g|= 5.64e-05  |ddm|= 1.99
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473941030716  LUMO = 1.61733415874111
  mo_energy =
[-0.90447394  1.61733416  7.63485057 18.23391612 36.28601394 61.80068452]
E1 = -3.8663370838583346  E_coul = 1.0286929161101348
cycle= 11 E= -2.8376441677482  delta_E= -2.05e-06  |g|= 0.000126  |ddm|= 1.02
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474850826254  LUMO = 1.61732345443635
  mo_energy =
[-0.90447485  1.61732345  7.63479695 18.23373369 36.28572229 61.80004524]
E1 = -3.8663379911255724  E_coul = 1.0286964091890098
cycle= 12 E= -2.83764158193656  delta_E= 2.59e-06  |g|= 0.000141  |ddm|=   13
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474150892198  LUMO = 1.61733523863366
  mo_energy =
[-0.90447415  1.61733524  7.63485838 18.23392415 36.2860058  61.80056035]
E1 = -3.866336965017033  E_coul = 1.0286945603204132
cycle= 13 E= -2.83764240469662  delta_E= -8.23e-07  |g|= 4.71e-05  |ddm|= 13.6
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474134226752  LUMO = 1.61733520247784
  mo_energy =
[-0.90447413  1.6173352   7.63485701 18.23393142 36.28602944 61.80068653]
E1 = -3.8663369370903906  E_coul = 1.0286930327551171
cycle= 14 E= -2.83764390433527  delta_E= -1.5e-06  |g|= 0.000102  |ddm|= 0.818
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474324530504  LUMO = 1.61733132177078
  mo_energy =
[-0.90447432  1.61733132  7.63483648 18.23387015 36.28594117 61.80054089]
E1 = -3.8663372788027983  E_coul = 1.028693699693008
cycle= 15 E= -2.83764357910979  delta_E= 3.25e-07  |g|= 7.4e-05  |ddm|= 4.37
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474530644378  LUMO = 1.61732701698353
  mo_energy =
[-0.90447453  1.61732702  7.6348141  18.23379881 36.28583373 61.80033549]
E1 = -3.866337672995728  E_coul = 1.0286938090881677
cycle= 16 E= -2.83764386390756  delta_E= -2.85e-07  |g|= 7.24e-05  |ddm|=  5.2
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474578754786  LUMO = 1.61732553102709
  mo_energy =
[-0.90447458  1.61732553  7.63480617 18.23377472 36.28579918 61.80028726]
E1 = -3.866337810973182  E_coul = 1.0286953070827436
cycle= 17 E= -2.83764250389044  delta_E= 1.36e-06  |g|= 5.67e-05  |ddm|= 1.73
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474664845072  LUMO = 1.61732317380628
  mo_energy =
[-0.90447466  1.61732317  7.63479322 18.23373954 36.28575251 61.80024548]
E1 = -3.8663380136427037  E_coul = 1.0286946888168709
cycle= 18 E= -2.83764332482583  delta_E= -8.21e-07  |g|= 2.71e-05  |ddm|= 2.41
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474903943192  LUMO = 1.61731817638752
  mo_energy =
[-0.9044749   1.61731818  7.63476758 18.23365435 36.28562007 61.79996847]
E1 = -3.8663384818104163  E_coul = 1.0286951575501508
cycle= 19 E= -2.83764332426027  delta_E= 5.66e-10  |g|= 9.94e-06  |ddm|=  6.3
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
E1 = -3.8663384818104163  E_coul = 1.0286951575501508
  HOMO = -0.904474083368599  LUMO = 1.61732428949851
  mo_energy =
[-0.90447408  1.61732429  7.6348031  18.23372993 36.28570182 61.79984269]
E1 = -3.8663382072999233  E_coul = 1.0286937835312064
Extra cycle  E= -2.83764442376872  delta_E= -1.1e-06  |g|= 0.000102  |ddm|= 3.16
    CPU time for scf_cycle      0.22 sec, wall time      0.22 sec
exp = [6.39063753 5.63431975 4.96075425 4.25881618 3.85153881 0.37935145]
E = -2.837644423768717
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:18 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.39063753123        1
[INPUT] 0    0    [1    /1   ]  5.63431975047        1
[INPUT] 0    0    [1    /1   ]  4.96075425236        1
[INPUT] 0    0    [1    /1   ]  4.25881618406        1
[INPUT] 0    0    [1    /1   ]  3.85153880516        1
[INPUT] 0    0    [1    /1   ]  0.379351445738       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.390637531229853, 1.0]], [0, [5.634319750473802, 1.0]], [0, [4.960754252361755, 1.0]], [0, [4.258816184057306, 1.0]], [0, [3.85153880516281, 1.0]], [0, [0.37935144573819685, 1.0]]]}
ecp = {}
CPU time:        75.96
Set gradient conv threshold to 3.16228e-05
cond(S) = 973466441.2733095

WARN: Singularity detected in overlap matrix (condition number = 9.73e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8565682060504773  E_coul = 1.024234639014293
init E= -2.83233356703618
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.90669620036168  LUMO = 1.61333743106425
  mo_energy =
[-0.9066962   1.61333743  7.63002267 18.22914435 36.28118245 61.7963533 ]
E1 = -3.866595976571177  E_coul = 1.0289554250100414
cycle= 1 E= -2.83764055156114  delta_E= -0.00531  |g|= 0.006  |ddm|= 9.5e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904343430181558  LUMO = 1.61740015955294
  mo_energy =
[-0.90434343  1.61740016  7.63509047 18.23433282 36.28655198 61.80144552]
E1 = -3.8663386944157208  E_coul = 1.0286953268382706
cycle= 2 E= -2.83764336757745  delta_E= -2.82e-06  |g|= 0.000397  |ddm|=  569
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.90448170483858  LUMO = 1.61731470631613
  mo_energy =
[-0.9044817   1.61731471  7.63476573 18.23365633 36.28560755 61.79987813]
E1 = -3.866336959208529  E_coul = 1.028693018794686
cycle= 3 E= -2.83764394041384  delta_E= -5.73e-07  |g|= 5.2e-05  |ddm|= 95.3
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904473783664695  LUMO = 1.61731027326932
  mo_energy =
[-0.90447378  1.61731027  7.6347276  18.23346715 36.28528181 61.79896073]
E1 = -3.866339784974787  E_coul = 1.0286974629974865
cycle= 4 E= -2.8376423219773  delta_E= 1.62e-06  |g|= 0.00017  |ddm|= 21.7
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904472596386956  LUMO = 1.61734053883723
  mo_energy =
[-0.9044726   1.61734054  7.63487886 18.23403015 36.28622004 61.80127396]
E1 = -3.866336700674721  E_coul = 1.0286954860434565
cycle= 5 E= -2.83764121463126  delta_E= 1.11e-06  |g|= 0.000104  |ddm|= 42.7
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472838208675  LUMO = 1.61735076270126
  mo_energy =
[-0.90447284  1.61735076  7.63493557 18.23419947 36.2864621  61.80164217]
E1 = -3.866335620162818  E_coul = 1.0286929815619277
cycle= 6 E= -2.83764263860089  delta_E= -1.42e-06  |g|= 7.35e-05  |ddm|= 12.8
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473518885433  LUMO = 1.61734573371579
  mo_energy =
[-0.90447352  1.61734573  7.63491219 18.23410758 36.28630191 61.80121947]
E1 = -3.8663360157919495  E_coul = 1.0286924072316657
cycle= 7 E= -2.83764360856028  delta_E= -9.7e-07  |g|= 0.00013  |ddm|= 6.52
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474025666272  LUMO = 1.61733859836765
  mo_energy =
[-0.90447403  1.6173386   7.63487602 18.23398724 36.28611301 61.80081667]
E1 = -3.8663366394221885  E_coul = 1.028692742299681
cycle= 8 E= -2.83764389712251  delta_E= -2.89e-07  |g|= 0.00012  |ddm|= 8.68
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474316389317  LUMO = 1.61733321932607
  mo_energy =
[-0.90447432  1.61733322  7.63484763 18.23390051 36.2859847  61.80059237]
E1 = -3.8663371089106158  E_coul = 1.028694971070468
cycle= 9 E= -2.83764213784015  delta_E= 1.76e-06  |g|= 5.18e-05  |ddm|= 6.13
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474194565602  LUMO = 1.61733528481187
  mo_energy =
[-0.90447419  1.61733528  7.6348588  18.23393022 36.28602297 61.80062151]
E1 = -3.866336943841617  E_coul = 1.028694821855863
cycle= 10 E= -2.83764212198575  delta_E= 1.59e-08  |g|= 5.64e-05  |ddm|= 1.99
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473941030716  LUMO = 1.61733415874111
  mo_energy =
[-0.90447394  1.61733416  7.63485057 18.23391612 36.28601394 61.80068452]
E1 = -3.8663370838583346  E_coul = 1.0286929161101348
cycle= 11 E= -2.8376441677482  delta_E= -2.05e-06  |g|= 0.000126  |ddm|= 1.02
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474850826254  LUMO = 1.61732345443635
  mo_energy =
[-0.90447485  1.61732345  7.63479695 18.23373369 36.28572229 61.80004524]
E1 = -3.8663379911255724  E_coul = 1.0286964091890098
cycle= 12 E= -2.83764158193656  delta_E= 2.59e-06  |g|= 0.000141  |ddm|=   13
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474150892198  LUMO = 1.61733523863366
  mo_energy =
[-0.90447415  1.61733524  7.63485838 18.23392415 36.2860058  61.80056035]
E1 = -3.866336965017033  E_coul = 1.0286945603204132
cycle= 13 E= -2.83764240469662  delta_E= -8.23e-07  |g|= 4.71e-05  |ddm|= 13.6
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474134226752  LUMO = 1.61733520247784
  mo_energy =
[-0.90447413  1.6173352   7.63485701 18.23393142 36.28602944 61.80068653]
E1 = -3.8663369370903906  E_coul = 1.0286930327551171
cycle= 14 E= -2.83764390433527  delta_E= -1.5e-06  |g|= 0.000102  |ddm|= 0.818
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474324530504  LUMO = 1.61733132177078
  mo_energy =
[-0.90447432  1.61733132  7.63483648 18.23387015 36.28594117 61.80054089]
E1 = -3.8663372788027983  E_coul = 1.028693699693008
cycle= 15 E= -2.83764357910979  delta_E= 3.25e-07  |g|= 7.4e-05  |ddm|= 4.37
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474530644378  LUMO = 1.61732701698353
  mo_energy =
[-0.90447453  1.61732702  7.6348141  18.23379881 36.28583373 61.80033549]
E1 = -3.866337672995728  E_coul = 1.0286938090881677
cycle= 16 E= -2.83764386390756  delta_E= -2.85e-07  |g|= 7.24e-05  |ddm|=  5.2
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474578754786  LUMO = 1.61732553102709
  mo_energy =
[-0.90447458  1.61732553  7.63480617 18.23377472 36.28579918 61.80028726]
E1 = -3.866337810973182  E_coul = 1.0286953070827436
cycle= 17 E= -2.83764250389044  delta_E= 1.36e-06  |g|= 5.67e-05  |ddm|= 1.73
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474664845072  LUMO = 1.61732317380628
  mo_energy =
[-0.90447466  1.61732317  7.63479322 18.23373954 36.28575251 61.80024548]
E1 = -3.8663380136427037  E_coul = 1.0286946888168709
cycle= 18 E= -2.83764332482583  delta_E= -8.21e-07  |g|= 2.71e-05  |ddm|= 2.41
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474903943192  LUMO = 1.61731817638752
  mo_energy =
[-0.9044749   1.61731818  7.63476758 18.23365435 36.28562007 61.79996847]
E1 = -3.8663384818104163  E_coul = 1.0286951575501508
cycle= 19 E= -2.83764332426027  delta_E= 5.66e-10  |g|= 9.94e-06  |ddm|=  6.3
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
E1 = -3.8663384818104163  E_coul = 1.0286951575501508
  HOMO = -0.904474083368599  LUMO = 1.61732428949851
  mo_energy =
[-0.90447408  1.61732429  7.6348031  18.23372993 36.28570182 61.79984269]
E1 = -3.8663382072999233  E_coul = 1.0286937835312064
Extra cycle  E= -2.83764442376872  delta_E= -1.1e-06  |g|= 0.000102  |ddm|= 3.16
    CPU time for scf_cycle      0.22 sec, wall time      0.22 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 973466441.2733095

WARN: Singularity detected in overlap matrix (condition number = 9.73e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8663382072999233  E_coul = 1.0286937835312064
init E= -2.83764442376872
    CPU time for initialize scf      0.03 sec, wall time      0.03 sec
  HOMO = -0.904475320194733  LUMO = 1.6173024139803
  mo_energy =
[-0.90447532  1.61730241  7.6346895  18.23334449 36.28508881 61.79862146]
E1 = -3.866340183512372  E_coul = 1.0286971224228418
cycle= 1 E= -2.83764306108953  delta_E= 1.36e-06  |g|= 0.000132  |ddm|= 27.4
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904472969454438  LUMO = 1.61732811486512
  mo_energy =
[-0.90447297  1.61732811  7.63481508 18.2338102  36.28586807 61.80044326]
E1 = -3.8663379510627323  E_coul = 1.0286965503754602
cycle= 2 E= -2.83764140068727  delta_E= 1.66e-06  |g|= 0.00015  |ddm|= 33.4
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904472695174947  LUMO = 1.61734420724064
  mo_energy =
[-0.9044727   1.61734421  7.6348997  18.23408801 36.28629418 61.80129764]
E1 = -3.8663363309724725  E_coul = 1.0286943603349004
cycle= 3 E= -2.83764197063757  delta_E= -5.7e-07  |g|= 1.97e-05  |ddm|= 21.1
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472998385874  LUMO = 1.61734078237515
  mo_energy =
[-0.904473    1.61734078  7.63488292 18.23402616 36.28619138 61.80105201]
E1 = -3.866336631178494  E_coul = 1.028691560170992
cycle= 4 E= -2.8376450710075  delta_E= -3.1e-06  |g|= 0.000248  |ddm|= 4.48
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473598837874  LUMO = 1.61733010973957
  mo_energy =
[-0.9044736   1.61733011  7.63482863 18.23384186 36.28590105 61.80044049]
E1 = -3.8663376156074007  E_coul = 1.0286931782181157
cycle= 5 E= -2.83764443738928  delta_E= 6.34e-07  |g|= 0.000142  |ddm|= 13.5
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473958988577  LUMO = 1.61732395426875
  mo_energy =
[-0.90447396  1.61732395  7.63479768 18.2337297  36.2857158  61.80001453]
E1 = -3.8663381950945004  E_coul = 1.028694103380286
cycle= 6 E= -2.83764409171421  delta_E= 3.46e-07  |g|= 7.68e-05  |ddm|= 8.26
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474159478491  LUMO = 1.61732030040098
  mo_energy =
[-0.90447416  1.6173203   7.63477876 18.23366838 36.28562031 61.79984232]
E1 = -3.866338522375154  E_coul = 1.0286944830889861
cycle= 7 E= -2.83764403928617  delta_E= 5.24e-08  |g|= 5.35e-05  |ddm|= 4.39
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474271556762  LUMO = 1.61731802046327
  mo_energy =
[-0.90447427  1.61731802  7.63476679 18.23363018 36.28556281 61.79973694]
E1 = -3.866338728372712  E_coul = 1.0286952700187373
cycle= 8 E= -2.83764345835398  delta_E= 5.81e-07  |g|= 1.16e-05  |ddm|= 2.72
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474246423472  LUMO = 1.61731845216332
  mo_energy =
[-0.90447425  1.61731845  7.6347688  18.23363678 36.28557183 61.79975179]
E1 = -3.8663386868537493  E_coul = 1.028697173959417
cycle= 9 E= -2.83764151289433  delta_E= 1.95e-06  |g|= 0.00019  |ddm|= 0.54
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474106545139  LUMO = 1.61732140679213
  mo_energy =
[-0.90447411  1.61732141  7.634784   18.2336855  36.28564497 61.79990469]
E1 = -3.866338411595092  E_coul = 1.0286959083363474
cycle= 10 E= -2.83764250325874  delta_E= -9.9e-07  |g|= 7.68e-05  |ddm|= 3.65
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473982771717  LUMO = 1.61732416381401
  mo_energy =
[-0.90447398  1.61732416  7.63479847 18.23372729 36.28570296 61.79999941]
E1 = -3.8663381658125147  E_coul = 1.0286962253048912
cycle= 11 E= -2.83764194050762  delta_E= 5.63e-07  |g|= 0.000117  |ddm|= 3.06
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473530169841  LUMO = 1.61733302697371
  mo_energy =
[-0.90447353  1.61733303  7.6348441  18.23387808 36.2859368  61.80046636]
E1 = -3.8663373486843158  E_coul = 1.0286938342786363
cycle= 12 E= -2.83764351440568  delta_E= -1.57e-06  |g|= 7.2e-05  |ddm|=   11
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473539896183  LUMO = 1.61733253799506
  mo_energy =
[-0.90447354  1.61733254  7.63484128 18.23387438 36.28593774 61.80049757]
E1 = -3.8663373853419674  E_coul = 1.0286946017501
cycle= 13 E= -2.83764278359187  delta_E= 7.31e-07  |g|= 3.37e-06  |ddm|= 0.246
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473576042822  LUMO = 1.61733188313385
  mo_energy =
[-0.90447358  1.61733188  7.63483809 18.2338622  36.28591737 61.80044501]
E1 = -3.866337450430834  E_coul = 1.028695459428175
cycle= 14 E= -2.83764199100266  delta_E= 7.93e-07  |g|= 8.01e-05  |ddm|= 0.938
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473399560251  LUMO = 1.61733532407666
  mo_energy =
[-0.9044734   1.61733532  7.63485584 18.23391881 36.28600352 61.80060376]
E1 = -3.866337137918446  E_coul = 1.0286937381699206
cycle= 15 E= -2.83764339974853  delta_E= -1.41e-06  |g|= 6.64e-05  |ddm|= 4.13
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447302541106  LUMO = 1.61734295104681
  mo_energy =
[-0.90447303  1.61734295  7.63489541 18.23404513 36.28619415 61.80096532]
E1 = -3.8663364413209473  E_coul = 1.0286943414261984
cycle= 16 E= -2.83764209989475  delta_E= 1.3e-06  |g|= 3.38e-05  |ddm|=  9.2
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472800289242  LUMO = 1.61734832004347
  mo_energy =
[-0.9044728   1.61734832  7.63492474 18.23412304 36.28629624 61.80108906]
E1 = -3.866335985034266  E_coul = 1.0286924238674506
cycle= 17 E= -2.83764356116682  delta_E= -1.46e-06  |g|= 0.000133  |ddm|= 5.43
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472974145464  LUMO = 1.61734494461505
  mo_energy =
[-0.90447297  1.61734494  7.63490692 18.23405745 36.28618421 61.80084761]
E1 = -3.8663362993615213  E_coul = 1.0286927930838627
cycle= 18 E= -2.83764350627766  delta_E= 5.49e-08  |g|= 9.74e-05  |ddm|= 4.57
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472813595375  LUMO = 1.61734858542079
  mo_energy =
[-0.90447281  1.61734859  7.634926   18.23411769 36.28627474 61.80100789]
E1 = -3.86633596413101  E_coul = 1.0286919704673312
cycle= 19 E= -2.83764399366368  delta_E= -4.87e-07  |g|= 0.000162  |ddm|= 4.38
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472966994196  LUMO = 1.61734613408911
  mo_energy =
[-0.90447297  1.61734613  7.63491258 18.23406837 36.28618794 61.80085677]
E1 = -3.8663361794332007  E_coul = 1.0286942246741249
cycle= 20 E= -2.83764195475908  delta_E= 2.04e-06  |g|= 4.76e-05  |ddm|= 3.19
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447272499908  LUMO = 1.61735064130873
  mo_energy =
[-0.90447272  1.61735064  7.63493522 18.23415413 36.28633146 61.80119904]
E1 = -3.8663357422634337  E_coul = 1.028691606566519
cycle= 21 E= -2.83764413569691  delta_E= -2.18e-06  |g|= 0.000192  |ddm|= 6.34
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472118682951  LUMO = 1.617362230256
  mo_energy =
[-0.90447212  1.61736223  7.63499499 18.23436601 36.28668023 61.80193397]
E1 = -3.8663346624343506  E_coul = 1.0286907182230107
cycle= 22 E= -2.83764394421134  delta_E= 1.91e-07  |g|= 0.000235  |ddm|= 15.2
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472765543713  LUMO = 1.61734676137266
  mo_energy =
[-0.90447277  1.61734676  7.63491127 18.23413963 36.2863828  61.80164034]
E1 = -3.8663359801723347  E_coul = 1.0286925918512895
cycle= 23 E= -2.83764338832105  delta_E= 5.56e-07  |g|= 0.000131  |ddm|= 15.8
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471673016609  LUMO = 1.61736587106508
  mo_energy =
[-0.90447167  1.61736587  7.6350048  18.23450802 36.28702255 61.803277  ]
E1 = -3.866334087788228  E_coul = 1.0286918399619123
cycle= 24 E= -2.83764224782632  delta_E= 1.14e-06  |g|= 0.000127  |ddm|= 27.9
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474255449641  LUMO = 1.61731577464796
  mo_energy =
[-0.90447426  1.61731577  7.63475264 18.23359451 36.28551005 61.79977745]
E1 = -3.866338898033102  E_coul = 1.0286974909925681
cycle= 25 E= -2.83764140704053  delta_E= 8.41e-07  |g|= 0.000205  |ddm|= 68.1
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472816427358  LUMO = 1.61734656547277
  mo_energy =
[-0.90447282  1.61734657  7.6349115  18.23412452 36.28634186 61.8014636 ]
E1 = -3.8663360287013053  E_coul = 1.0286922260761515
cycle= 26 E= -2.83764380262515  delta_E= -2.4e-06  |g|= 0.000165  |ddm|= 38.9
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447285263883  LUMO = 1.61734625718503
  mo_energy =
[-0.90447285  1.61734626  7.63491031 18.23411445 36.28631932 61.80138487]
E1 = -3.866336066976865  E_coul = 1.0286915549091644
cycle= 27 E= -2.8376445120677  delta_E= -7.09e-07  |g|= 0.000217  |ddm|= 0.768
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472979602672  LUMO = 1.61734389827196
  mo_energy =
[-0.90447298  1.6173439   7.63489806 18.2340723  36.2862516  61.80124624]
E1 = -3.866336284432151  E_coul = 1.0286923154231074
cycle= 28 E= -2.83764396900904  delta_E= 5.43e-07  |g|= 0.000164  |ddm|= 3.01
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473317083925  LUMO = 1.61733803028882
  mo_energy =
[-0.90447332  1.61733803  7.63486955 18.23396158 36.28606365 61.80075449]
E1 = -3.8663368675061243  E_coul = 1.0286934843248914
cycle= 29 E= -2.83764338318123  delta_E= 5.86e-07  |g|= 7.13e-05  |ddm|= 8.48
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473338810723  LUMO = 1.61733728948989
  mo_energy =
[-0.90447334  1.61733729  7.6348653  18.23395062 36.28605081 61.80075535]
E1 = -3.8663369296490573  E_coul = 1.0286931572178584
cycle= 30 E= -2.8376437724312  delta_E= -3.89e-07  |g|= 0.000114  |ddm|= 0.707
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473515427223  LUMO = 1.61733411229969
  mo_energy =
[-0.90447352  1.61733411  7.63484998 18.23389254 36.28595163 61.80048428]
E1 = -3.866337246311452  E_coul = 1.028695587897144
cycle= 31 E= -2.83764165841431  delta_E= 2.11e-06  |g|= 0.000105  |ddm|= 4.59
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473183352654  LUMO = 1.61734039910891
  mo_energy =
[-0.90447318  1.6173404   7.6348827  18.23400311 36.28612703 61.8008317 ]
E1 = -3.8663366711797735  E_coul = 1.0286938357313076
cycle= 32 E= -2.83764283544847  delta_E= -1.18e-06  |g|= 3.62e-05  |ddm|=  7.9
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472345453161  LUMO = 1.61735697536412
  mo_energy =
[-0.90447235  1.61735698  7.63496698 18.2342985  36.28660505 61.80190067]
E1 = -3.866335098927259  E_coul = 1.0286918134744054
cycle= 33 E= -2.83764328545285  delta_E= -4.5e-07  |g|= 0.000146  |ddm|= 21.9
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472964514679  LUMO = 1.61734752325449
  mo_energy =
[-0.90447296  1.61734752  7.63492735 18.23409718 36.28622617 61.8006014 ]
E1 = -3.8663361833852212  E_coul = 1.0286918599060884
cycle= 34 E= -2.83764432347913  delta_E= -1.04e-06  |g|= 0.000177  |ddm|= 17.2
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472899970815  LUMO = 1.61734911887079
  mo_energy =
[-0.9044729   1.61734912  7.63493529 18.23412322 36.28626567 61.80069479]
E1 = -3.866336027440886  E_coul = 1.0286919967374673
cycle= 35 E= -2.83764403070342  delta_E= 2.93e-07  |g|= 0.000162  |ddm|= 2.07
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472940497521  LUMO = 1.61734853327103
  mo_energy =
[-0.90447294  1.61734853  7.63493171 18.23411536 36.28625776 61.8007095 ]
E1 = -3.8663360648831526  E_coul = 1.0286898622650384
cycle= 36 E= -2.83764620261811  delta_E= -2.17e-06  |g|= 0.000349  |ddm|= 0.365
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472452834728  LUMO = 1.61735819226566
  mo_energy =
[-0.90447245  1.61735819  7.63498098 18.23428166 36.28651783 61.80125321]
E1 = -3.8663351603445335  E_coul = 1.0286912095546539
cycle= 37 E= -2.83764395078988  delta_E= 2.25e-06  |g|= 0.000193  |ddm|= 12.3
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472867283755  LUMO = 1.61735028834958
  mo_energy =
[-0.90447287  1.61735029  7.63494074 18.23415881 36.28633635 61.80089057]
E1 = -3.866335875806981  E_coul = 1.0286934449722873
cycle= 38 E= -2.83764243083469  delta_E= 1.52e-06  |g|= 3.48e-05  |ddm|= 9.25
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472165927896  LUMO = 1.61736255208732
  mo_energy =
[-0.90447217  1.61736255  7.63500292 18.23437389 36.28668247 61.80166932]
E1 = -3.8663347326387583  E_coul = 1.0286917928885588
cycle= 39 E= -2.8376429397502  delta_E= -5.09e-07  |g|= 0.000138  |ddm|= 15.9
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474995282096  LUMO = 1.61730587764018
  mo_energy =
[-0.904475    1.61730588  7.63470973 18.23340239 36.28517375 61.79866997]
E1 = -3.866339962399782  E_coul = 1.028696128603609
cycle= 40 E= -2.83764383379617  delta_E= -8.94e-07  |g|= 4.58e-05  |ddm|= 70.7
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474718843797  LUMO = 1.61730903642295
  mo_energy =
[-0.90447472  1.61730904  7.63472238 18.23345694 36.28526639 61.7989902 ]
E1 = -3.8663396234302985  E_coul = 1.0286947113299025
cycle= 41 E= -2.8376449121004  delta_E= -1.08e-06  |g|= 7.55e-05  |ddm|= 5.04
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475000292617  LUMO = 1.61730379658188
  mo_energy =
[-0.904475    1.6173038   7.63469552 18.23336662 36.28512595 61.79871376]
E1 = -3.8663401087217104  E_coul = 1.0286964593466992
cycle= 42 E= -2.83764364937501  delta_E= 1.26e-06  |g|= 5.39e-05  |ddm|= 6.59
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474753498834  LUMO = 1.61730888223644
  mo_energy =
[-0.90447475  1.61730888  7.63472194 18.23344443 36.28523528 61.79891035]
E1 = -3.8663396527798444  E_coul = 1.028697120771003
cycle= 43 E= -2.83764253200884  delta_E= 1.12e-06  |g|= 0.000161  |ddm|= 5.77
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474452006047  LUMO = 1.61731426426253
  mo_energy =
[-0.90447445  1.61731426  7.63474822 18.23354703 36.28540986 61.79934592]
E1 = -3.8663391179612616  E_coul = 1.0286962307500251
cycle= 44 E= -2.83764288721124  delta_E= -3.55e-07  |g|= 8.68e-05  |ddm|= 7.81
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474109704922  LUMO = 1.61732102300476
  mo_energy =
[-0.90447411  1.61732102  7.63478298 18.23366317 36.2855916  61.79971969]
E1 = -3.8663384908514598  E_coul = 1.0286954946264841
cycle= 45 E= -2.83764299622498  delta_E= -1.09e-07  |g|= 5.42e-05  |ddm|= 8.52
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473980361717  LUMO = 1.61732363904203
  mo_energy =
[-0.90447398  1.61732364  7.63479627 18.23371025 36.28566719 61.79988486]
E1 = -3.866338241069572  E_coul = 1.0286967104858895
cycle= 46 E= -2.83764153058368  delta_E= 1.47e-06  |g|= 0.000152  |ddm|= 3.48
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473814845853  LUMO = 1.617327176755
  mo_energy =
[-0.90447381  1.61732718  7.63481485 18.23376702 36.28575067 61.80003038]
E1 = -3.866337923412183  E_coul = 1.028694904671018
cycle= 47 E= -2.83764301874116  delta_E= -1.49e-06  |g|= 3.06e-05  |ddm|=  4.1
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473512100295  LUMO = 1.61733251629472
  mo_energy =
[-0.90447351  1.61733252  7.63484053 18.23387489 36.28594294 61.80054956]
E1 = -3.8663373781475845  E_coul = 1.028694184053071
cycle= 48 E= -2.83764319409451  delta_E= -1.75e-07  |g|= 3.92e-05  |ddm|= 8.25
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473703366803  LUMO = 1.61732910537134
  mo_energy =
[-0.9044737   1.61732911  7.63482396 18.23380901 36.28582943 61.80025743]
E1 = -3.866337719282452  E_coul = 1.0286928901650856
cycle= 49 E= -2.83764482911737  delta_E= -1.64e-06  |g|= 0.000166  |ddm|= 5.01
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473750828385  LUMO = 1.61732818433862
  mo_energy =
[-0.90447375  1.61732818  7.63481916 18.23379404 36.28580663 61.80020685]
E1 = -3.866337802204087  E_coul = 1.028693917764195
cycle= 50 E= -2.83764388443989  delta_E= 9.45e-07  |g|= 7.91e-05  |ddm|=  1.1
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.866337802204087  E_coul = 1.028693917764195

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904474983352252  LUMO = 1.61731242965471
  mo_energy =
[-0.90447498  1.61731243  7.63474011 18.23352024 36.28536425 61.79917588]
E1 = -3.866339181617003  E_coul = 1.0286958478020745
Extra cycle  E= -2.83764333381493  delta_E= 5.51e-07  |g|= 4.71e-05  |ddm|= 19.8
    CPU time for scf_cycle      0.54 sec, wall time      0.54 sec
exp = [6.39063753 5.63431975 4.96075425 4.25881618 3.85153881 0.37935145]
grad_E = [-3.36446337e-04 -1.68790530e-04  5.00200809e-06  2.99603147e-04
  5.42057435e-04 -1.11043394e-03]
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:21 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.39007078787        1
[INPUT] 0    0    [1    /1   ]  5.63315229174        1
[INPUT] 0    0    [1    /1   ]  4.96043805144        1
[INPUT] 0    0    [1    /1   ]  4.25880024037        1
[INPUT] 0    0    [1    /1   ]  3.85061084265        1
[INPUT] 0    0    [1    /1   ]  0.379427570345       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.390070787866517, 1.0]], [0, [5.633152291741956, 1.0]], [0, [4.960438051438949, 1.0]], [0, [4.258800240369958, 1.0]], [0, [3.850610842649003, 1.0]], [0, [0.3794275703450934, 1.0]]]}
ecp = {}
CPU time:        78.70
Set gradient conv threshold to 3.16228e-05
cond(S) = 974016627.8048617

WARN: Singularity detected in overlap matrix (condition number = 9.74e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8565638625176852  E_coul = 1.0242452242396956
init E= -2.83231863827799
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906686460589346  LUMO = 1.61360044027828
  mo_energy =
[-0.90668646  1.61360044  7.63026002 18.23009555 36.28172842 61.8000659 ]
E1 = -3.8666143935957993  E_coul = 1.0289788468623082
cycle= 1 E= -2.83763554673349  delta_E= -0.00532  |g|= 0.00601  |ddm|= 9.63e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904329231511292  LUMO = 1.61760883179026
  mo_energy =
[-0.90432923  1.61760883  7.63502499 18.23413611 36.2851785  61.80063006]
E1 = -3.8663638958538638  E_coul = 1.0287253146213415
cycle= 2 E= -2.83763858123252  delta_E= -3.03e-06  |g|= 0.000409  |ddm|=  660
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904464151715419  LUMO = 1.61752348120378
  mo_energy =
[-0.90446415  1.61752348  7.63469336 18.23342085 36.28417769 61.79890854]
E1 = -3.8663631225777433  E_coul = 1.0287263288398805
cycle= 3 E= -2.83763679373786  delta_E= 1.79e-06  |g|= 0.000155  |ddm|=  103
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.90445283584009  LUMO = 1.61757960066395
  mo_energy =
[-0.90445284  1.6175796   7.63496744 18.23423597 36.28537563 61.80097066]
E1 = -3.866360505187423  E_coul = 1.028723955716598
cycle= 4 E= -2.83763654947083  delta_E= 2.44e-07  |g|= 9.98e-06  |ddm|= 51.4
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904456196226508  LUMO = 1.61756926038324
  mo_energy =
[-0.9044562   1.61756926  7.63491918 18.2341252  36.28524601 61.80089203]
E1 = -3.866360578223344  E_coul = 1.0287236178352084
cycle= 5 E= -2.83763696038814  delta_E= -4.11e-07  |g|= 4.26e-05  |ddm|= 4.27
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456400234253  LUMO = 1.61756704858666
  mo_energy =
[-0.9044564   1.61756705  7.6349093  18.23407213 36.28514207 61.80058074]
E1 = -3.866360811239692  E_coul = 1.0287230922280644
cycle= 6 E= -2.83763771901163  delta_E= -7.59e-07  |g|= 7.92e-05  |ddm|= 4.03
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456656732388  LUMO = 1.6175612657748
  mo_energy =
[-0.90445666  1.61756127  7.63487886 18.23397799 36.28500401 61.80032739]
E1 = -3.8663613363351677  E_coul = 1.0287233503811861
cycle= 7 E= -2.83763798595398  delta_E= -2.67e-07  |g|= 9.14e-05  |ddm|= 6.79
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456818054422  LUMO = 1.61755740020738
  mo_energy =
[-0.90445682  1.6175574   7.63485939 18.23390633 36.28488407 61.80004761]
E1 = -3.8663617219008626  E_coul = 1.0287263297395322
cycle= 8 E= -2.83763539216133  delta_E= 2.59e-06  |g|= 0.000169  |ddm|= 5.42
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456405857754  LUMO = 1.61756405364417
  mo_energy =
[-0.90445641  1.61756405  7.6348932  18.23401961 36.28506189 61.80042689]
E1 = -3.8663611207616952  E_coul = 1.0287247452468586
cycle= 9 E= -2.83763637551484  delta_E= -9.83e-07  |g|= 6.26e-05  |ddm|= 8.26
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456285212396  LUMO = 1.61756546061591
  mo_energy =
[-0.90445629  1.61756546  7.63489955 18.23404973 36.28511776 61.80059355]
E1 = -3.8663609778459143  E_coul = 1.0287241651451418
cycle= 10 E= -2.83763681270077  delta_E= -4.37e-07  |g|= 2.23e-05  |ddm|= 2.33
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456306692155  LUMO = 1.61756460927736
  mo_energy =
[-0.90445631  1.61756461  7.63489442 18.2340403  36.28511121 61.80062549]
E1 = -3.866361039935563  E_coul = 1.0287252776852982
cycle= 11 E= -2.83763576225026  delta_E= 1.05e-06  |g|= 0.000102  |ddm|= 0.542
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456163994805  LUMO = 1.61756734746918
  mo_energy =
[-0.90445616  1.61756735  7.63490833 18.2340906  36.28519442 61.80081963]
E1 = -3.8663607782896023  E_coul = 1.0287255025845734
cycle= 12 E= -2.83763527570503  delta_E= 4.87e-07  |g|= 0.000125  |ddm|= 3.71
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456046729028  LUMO = 1.61757092738197
  mo_energy =
[-0.90445605  1.61757093  7.63492697 18.23415305 36.28529331 61.80102818]
E1 = -3.866360430635385  E_coul = 1.0287234233251472
cycle= 13 E= -2.83763700731024  delta_E= -1.73e-06  |g|= 5.18e-05  |ddm|= 4.64
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456064918422  LUMO = 1.61757057918288
  mo_energy =
[-0.90445606  1.61757058  7.63492535 18.23414903 36.28528839 61.80100687]
E1 = -3.86636046353785  E_coul = 1.0287237466293409
cycle= 14 E= -2.83763671690851  delta_E= 2.9e-07  |g|= 1.2e-05  |ddm|= 0.39
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904455938003573  LUMO = 1.61757286858934
  mo_energy =
[-0.90445594  1.61757287  7.63493682 18.23419008 36.28535502 61.8011652 ]
E1 = -3.8663602455893686  E_coul = 1.0287225010567778
cycle= 15 E= -2.83763774453259  delta_E= -1.03e-06  |g|= 0.000122  |ddm|= 3.07
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904455747783194  LUMO = 1.61757635300553
  mo_energy =
[-0.90445575  1.61757635  7.63495458 18.23425236 36.28545618 61.8013916 ]
E1 = -3.8663599195330494  E_coul = 1.028721302835434
cycle= 16 E= -2.83763861669762  delta_E= -8.72e-07  |g|= 0.000226  |ddm|= 4.56
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904455577199773  LUMO = 1.61757876957852
  mo_energy =
[-0.90445558  1.61757877  7.63496534 18.23430651 36.28555905 61.80170995]
E1 = -3.8663596554063133  E_coul = 1.0287224404901585
cycle= 17 E= -2.83763721491616  delta_E= 1.4e-06  |g|= 0.000112  |ddm|= 4.29
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904455501495736  LUMO = 1.61758032935699
  mo_energy =
[-0.9044555   1.61758033  7.63497445 18.23432914 36.28558805 61.80170904]
E1 = -3.866359539337485  E_coul = 1.028722600445904
cycle= 18 E= -2.83763693889158  delta_E= 2.76e-07  |g|= 7.52e-05  |ddm|= 1.33
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904455542663398  LUMO = 1.61758116239589
  mo_energy =
[-0.90445554  1.61758116  7.63498161 18.23432449 36.28555217 61.80146541]
E1 = -3.866359526546848  E_coul = 1.0287225504435504
cycle= 19 E= -2.8376369761033  delta_E= -3.72e-08  |g|= 8.05e-05  |ddm|= 0.937
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904455940407228  LUMO = 1.61757462006618
  mo_energy =
[-0.90445594  1.61757462  7.63494951 18.23420244 36.28534511 61.80092313]
E1 = -3.866360163571548  E_coul = 1.0287229251357701
cycle= 20 E= -2.83763723843578  delta_E= -2.62e-07  |g|= 6.84e-05  |ddm|= 9.26
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456937670572  LUMO = 1.61755543076983
  mo_energy =
[-0.90445694  1.61755543  7.6348506  18.23387999 36.28484586 61.7998835 ]
E1 = -3.866361919639872  E_coul = 1.0287232770314763
cycle= 21 E= -2.8376386426084  delta_E= -1.4e-06  |g|= 0.000129  |ddm|= 23.6
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904457482459444  LUMO = 1.61754428500159
  mo_energy =
[-0.90445748  1.61754429  7.63479316 18.23367743 36.28451945 61.79923432]
E1 = -3.866362968513977  E_coul = 1.0287252959851465
cycle= 22 E= -2.83763767252883  delta_E= 9.7e-07  |g|= 2.99e-05  |ddm|= 14.6
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904457274363829  LUMO = 1.61754761308261
  mo_energy =
[-0.90445727  1.61754761  7.63480901 18.23374442 36.28463908 61.79956821]
E1 = -3.866362630887105  E_coul = 1.0287238296255852
cycle= 23 E= -2.83763880126152  delta_E= -1.13e-06  |g|= 9.57e-05  |ddm|= 5.14
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904457339431822  LUMO = 1.6175457828215
  mo_energy =
[-0.90445734  1.61754578  7.63479859 18.23371712 36.28460434 61.79955411]
E1 = -3.8663627815598485  E_coul = 1.0287260271839451
cycle= 24 E= -2.8376367543759  delta_E= 2.05e-06  |g|= 9.61e-05  |ddm|= 1.74
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904457000390749  LUMO = 1.61755204586475
  mo_energy =
[-0.904457    1.61755205  7.63483    18.23382929 36.28478727 61.79998254]
E1 = -3.8663621837443327  E_coul = 1.0287252439814765
cycle= 25 E= -2.83763693976286  delta_E= -1.85e-07  |g|= 4.62e-05  |ddm|= 8.39
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456908631902  LUMO = 1.61755375014375
  mo_energy =
[-0.90445691  1.61755375  7.63483853 18.23386252 36.28484368 61.80012297]
E1 = -3.8663620157562955  E_coul = 1.0287230548464683
cycle= 26 E= -2.83763896090983  delta_E= -2.02e-06  |g|= 0.000142  |ddm|= 2.46
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904457091847766  LUMO = 1.61755024393211
  mo_energy =
[-0.90445709  1.61755024  7.63482093 18.23379511 36.28472875 61.79984756]
E1 = -3.866362358242554  E_coul = 1.0287253816731219
cycle= 27 E= -2.83763697656943  delta_E= 1.98e-06  |g|= 5e-05  |ddm|= 4.98
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904457237674337  LUMO = 1.61754686524712
  mo_energy =
[-0.90445724  1.61754687  7.63480211 18.23374118 36.2846496  61.79974077]
E1 = -3.8663626418528727  E_coul = 1.0287251632621444
cycle= 28 E= -2.83763747859073  delta_E= -5.02e-07  |g|= 1.94e-05  |ddm|= 3.57
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904459298467641  LUMO = 1.61751043949304
  mo_energy =
[-0.9044593   1.61751044  7.63462198 18.23307231 36.28353728 61.79705558]
E1 = -3.866366166846498  E_coul = 1.0287290113475707
cycle= 29 E= -2.83763715549893  delta_E= 3.23e-07  |g|= 0.00023  |ddm|= 50.3
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904457578843514  LUMO = 1.61754130466276
  mo_energy =
[-0.90445758  1.6175413   7.63477346 18.23366212 36.28454733 61.79959222]
E1 = -3.866363120028728  E_coul = 1.0287260871907895
cycle= 30 E= -2.83763703283794  delta_E= 1.23e-07  |g|= 7.82e-05  |ddm|= 44.5
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904457538670761  LUMO = 1.61754225869036
  mo_energy =
[-0.90445754  1.61754226  7.63477839 18.23367846 36.28457295 61.79964988]
E1 = -3.8663630300168195  E_coul = 1.0287248775773077
cycle= 31 E= -2.83763815243951  delta_E= -1.12e-06  |g|= 3.21e-05  |ddm|= 1.22
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904457365243632  LUMO = 1.61754587767138
  mo_energy =
[-0.90445737  1.61754588  7.63479706 18.2337393  36.28466594 61.799836  ]
E1 = -3.866362694636088  E_coul = 1.0287271484780018
cycle= 32 E= -2.83763554615809  delta_E= 2.61e-06  |g|= 0.000192  |ddm|= 4.48
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904457122793523  LUMO = 1.61755054983124
  mo_energy =
[-0.90445712  1.61755055  7.63482078 18.23381905 36.2847915  61.80011417]
E1 = -3.8663622572936136  E_coul = 1.0287260776968046
cycle= 33 E= -2.83763617959681  delta_E= -6.33e-07  |g|= 0.000121  |ddm|= 5.96
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456885353783  LUMO = 1.61755445410174
  mo_energy =
[-0.90445689  1.61755445  7.63483999 18.23389166 36.28491482 61.8004094 ]
E1 = -3.8663618808706928  E_coul = 1.0287223882642864
cycle= 34 E= -2.83763949260641  delta_E= -3.31e-06  |g|= 0.000212  |ddm|= 5.47
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904457060684463  LUMO = 1.6175523590433
  mo_energy =
[-0.90445706  1.61755236  7.63483113 18.23384785 36.28482995 61.80012724]
E1 = -3.866362106953586  E_coul = 1.0287265220416226
cycle= 35 E= -2.83763558491196  delta_E= 3.91e-06  |g|= 0.000177  |ddm|= 3.64
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90445664970093  LUMO = 1.61755936537877
  mo_energy =
[-0.90445665  1.61755937  7.63486461 18.23398328 36.28506562 61.80078101]
E1 = -3.8663613971994164  E_coul = 1.0287249219225147
cycle= 36 E= -2.8376364752769  delta_E= -8.9e-07  |g|= 4.58e-05  |ddm|= 10.5
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456420325985  LUMO = 1.61756474881386
  mo_energy =
[-0.90445642  1.61756475  7.63489378 18.23407586 36.28520594 61.80100552]
E1 = -3.8663609170234543  E_coul = 1.0287244738262753
cycle= 37 E= -2.83763644319718  delta_E= 3.21e-08  |g|= 1.95e-05  |ddm|= 6.32
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90445610663202  LUMO = 1.61757154344639
  mo_energy =
[-0.90445611  1.61757154  7.63493139 18.23417402 36.28533126 61.80109105]
E1 = -3.8663603613034314  E_coul = 1.0287243785640552
cycle= 38 E= -2.83763598273938  delta_E= 4.6e-07  |g|= 5.63e-05  |ddm|= 6.48
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904455918357293  LUMO = 1.61757365951622
  mo_energy =
[-0.90445592  1.61757366  7.63493972 18.23422152 36.28542509 61.80141071]
E1 = -3.866360118886975  E_coul = 1.02872435201084
cycle= 39 E= -2.83763576687614  delta_E= 2.16e-07  |g|= 4.4e-05  |ddm|= 4.02
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904455866461392  LUMO = 1.61757501022717
  mo_energy =
[-0.90445587  1.61757501  7.63494785 18.23423479 36.28543298 61.80135682]
E1 = -3.866360028310189  E_coul = 1.0287228110035789
cycle= 40 E= -2.83763721730661  delta_E= -1.45e-06  |g|= 9.02e-05  |ddm|= 0.73
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456130225437  LUMO = 1.61757012983793
  mo_energy =
[-0.90445613  1.61757013  7.63492351 18.23414727 36.28528979 61.80101553]
E1 = -3.866360496176849  E_coul = 1.0287229491923704
cycle= 41 E= -2.83763754698448  delta_E= -3.3e-07  |g|= 9.73e-05  |ddm|= 6.58
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456363034045  LUMO = 1.61756577746777
  mo_energy =
[-0.90445636  1.61756578  7.63490175 18.23406985 36.28516365 61.80071439]
E1 = -3.866360913192596  E_coul = 1.0287227011428144
cycle= 42 E= -2.83763821204978  delta_E= -6.65e-07  |g|= 0.000141  |ddm|= 5.83
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456167390689  LUMO = 1.61756938952446
  mo_energy =
[-0.90445617  1.61756939  7.63492031 18.23413014 36.28525755 61.80091019]
E1 = -3.8663605843443123  E_coul = 1.028723424615586
cycle= 43 E= -2.83763715972873  delta_E= 1.05e-06  |g|= 6.09e-05  |ddm|= 4.42
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456427883339  LUMO = 1.6175651716793
  mo_energy =
[-0.90445643  1.61756517  7.63490015 18.23404818 36.28511435 61.80051632]
E1 = -3.8663610094510954  E_coul = 1.028724014891107
cycle= 44 E= -2.83763699455999  delta_E= 1.65e-07  |g|= 1.95e-05  |ddm|= 6.34
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456670175081  LUMO = 1.61755998939968
  mo_energy =
[-0.90445667  1.61755999  7.6348737  18.23394088 36.28492603 61.80007435]
E1 = -3.866361525428764  E_coul = 1.0287234795028934
cycle= 45 E= -2.83763804592587  delta_E= -1.05e-06  |g|= 8e-05  |ddm|= 7.72
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904457070587953  LUMO = 1.61755125421426
  mo_energy =
[-0.90445707  1.61755125  7.63482897 18.23379426 36.28470101 61.79958502]
E1 = -3.866362347299704  E_coul = 1.028725246298376
cycle= 46 E= -2.83763710100133  delta_E= 9.45e-07  |g|= 4.16e-05  |ddm|=   11
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456785261391  LUMO = 1.6175571575823
  mo_energy =
[-0.90445679  1.61755716  7.63485988 18.23389456 36.28485474 61.79987659]
E1 = -3.866361807944815  E_coul = 1.0287243343011847
cycle= 47 E= -2.83763747364363  delta_E= -3.73e-07  |g|= 1.44e-05  |ddm|= 7.21
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904456938649782  LUMO = 1.61755394950634
  mo_energy =
[-0.90445694  1.61755395  7.63484328 18.23383991 36.28477037 61.79970578]
E1 = -3.8663621054982036  E_coul = 1.0287235134010384
cycle= 48 E= -2.83763859209717  delta_E= -1.12e-06  |g|= 0.00011  |ddm|=    4
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904457053845302  LUMO = 1.61755171044795
  mo_energy =
[-0.90445705  1.61755171  7.63483212 18.23379834 36.28470102 61.79953877]
E1 = -3.8663623250010537  E_coul = 1.0287243281963583
cycle= 49 E= -2.8376379968047  delta_E= 5.95e-07  |g|= 2.78e-05  |ddm|= 3.13
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904457036115633  LUMO = 1.61755196843716
  mo_energy =
[-0.90445704  1.61755197  7.63483313 18.23379855 36.28469803 61.79954869]
E1 = -3.8663623019289495  E_coul = 1.0287260384998282
cycle= 50 E= -2.83763626342912  delta_E= 1.73e-06  |g|= 0.000124  |ddm|= 0.187
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8663623019289495  E_coul = 1.0287260384998282

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904455112609926  LUMO = 1.61757764030431
  mo_energy =
[-0.90445511  1.61757764  7.63496308 18.23425765 36.28544934 61.80119869]
E1 = -3.866360041460024  E_coul = 1.0287228469032836
Extra cycle  E= -2.83763719455674  delta_E= -9.31e-07  |g|= 7.78e-05  |ddm|= 32.5
    CPU time for scf_cycle      0.49 sec, wall time      0.49 sec
exp = [6.39007079 5.63315229 4.96043805 4.25880024 3.85061084 0.37942757]
E = -2.8376371945567405
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:22 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.39058085689        1
[INPUT] 0    0    [1    /1   ]  5.6342030046         1
[INPUT] 0    0    [1    /1   ]  4.96072263227        1
[INPUT] 0    0    [1    /1   ]  4.25881458969        1
[INPUT] 0    0    [1    /1   ]  3.85144600891        1
[INPUT] 0    0    [1    /1   ]  0.379359058199       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.39058085689352, 1.0]], [0, [5.634203004600617, 1.0]], [0, [4.960722632269475, 1.0]], [0, [4.258814589688571, 1.0]], [0, [3.851446008911429, 1.0]], [0, [0.3793590581988865, 1.0]]]}
ecp = {}
CPU time:        79.54
Set gradient conv threshold to 3.16228e-05
cond(S) = 973521014.199722

WARN: Singularity detected in overlap matrix (condition number = 9.74e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8565677765831516  E_coul = 1.0242445551436814
init E= -2.83232322143947
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906685885737937  LUMO = 1.61354325120328
  mo_energy =
[-0.90668589  1.61354325  7.6309625  18.23240371 36.28630662 61.80775899]
E1 = -3.8665809011312966  E_coul = 1.0289473914753537
cycle= 1 E= -2.83763350965594  delta_E= -0.00531  |g|= 0.00599  |ddm|= 9.28e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904343933234261  LUMO = 1.61753948586373
  mo_energy =
[-0.90434393  1.61753949  7.63571172 18.23647924 36.28984607 61.80867085]
E1 = -3.8663279879329164  E_coul = 1.028691506141864
cycle= 2 E= -2.83763648179105  delta_E= -2.97e-06  |g|= 0.000406  |ddm|=  639
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904480066162199  LUMO = 1.6174567845306
  mo_energy =
[-0.90448007  1.61745678  7.63540286 18.2357778  36.28880463 61.80647898]
E1 = -3.8663267406537107  E_coul = 1.0286919530655345
cycle= 3 E= -2.83763478758818  delta_E= 1.69e-06  |g|= 0.000177  |ddm|=  102
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.90446909092828  LUMO = 1.61750229543251
  mo_energy =
[-0.90446909  1.6175023   7.63560429 18.23654419 36.29011355 61.809874  ]
E1 = -3.8663245765630316  E_coul = 1.028690026530256
cycle= 4 E= -2.83763455003278  delta_E= 2.38e-07  |g|= 4.54e-05  |ddm|=   52
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904472134558043  LUMO = 1.61749924767686
  mo_energy =
[-0.90447213  1.61749925  7.63560771 18.23645763 36.28987927 61.80870723]
E1 = -3.8663244296486106  E_coul = 1.0286898219555827
cycle= 5 E= -2.83763460769303  delta_E= -5.77e-08  |g|= 1.02e-05  |ddm|= 6.12
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472273585983  LUMO = 1.61749947341315
  mo_energy =
[-0.90447227  1.61749947  7.63561029 18.23644763 36.28984234 61.80856816]
E1 = -3.866324404482769  E_coul = 1.0286882128057284
cycle= 6 E= -2.83763619167704  delta_E= -1.58e-06  |g|= 0.000141  |ddm|= 0.661
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472790611113  LUMO = 1.61748994479955
  mo_energy =
[-0.90447279  1.61748994  7.63556067 18.2362883  36.28959758 61.80809978]
E1 = -3.8663252563062165  E_coul = 1.02869044011754
cycle= 7 E= -2.83763481618868  delta_E= 1.38e-06  |g|= 2.5e-05  |ddm|= 11.4
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472648908149  LUMO = 1.61749094298905
  mo_energy =
[-0.90447265  1.61749094  7.63556518 18.2363093  36.2896374  61.80822392]
E1 = -3.866325170147218  E_coul = 1.028689357472987
cycle= 8 E= -2.83763581267423  delta_E= -9.96e-07  |g|= 6.39e-05  |ddm|= 1.52
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472750973844  LUMO = 1.61748768322043
  mo_energy =
[-0.90447275  1.61748768  7.63554744 18.23626101 36.28957432 61.80815848]
E1 = -3.8663254595902683  E_coul = 1.0286894695060298
cycle= 9 E= -2.83763599008424  delta_E= -1.77e-07  |g|= 7.2e-05  |ddm|= 3.42
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472815225618  LUMO = 1.61748505807411
  mo_energy =
[-0.90447282  1.61748506  7.635533   18.23621645 36.28950739 61.80804648]
E1 = -3.8663257040414245  E_coul = 1.0286921056131393
cycle= 10 E= -2.83763359842828  delta_E= 2.39e-06  |g|= 0.000157  |ddm|= 3.11
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472561956545  LUMO = 1.61748804519526
  mo_energy =
[-0.90447256  1.61748805  7.63554684 18.23626853 36.28959473 61.80829017]
E1 = -3.8663254232919413  E_coul = 1.0286911417478353
cycle= 11 E= -2.83763428154411  delta_E= -6.83e-07  |g|= 8.3e-05  |ddm|= 4.09
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472444468087  LUMO = 1.61748988313688
  mo_energy =
[-0.90447244  1.61748988  7.63555582 18.23630421 36.2896564  61.80845031]
E1 = -3.866325243153487  E_coul = 1.028691239359396
cycle= 12 E= -2.83763400379409  delta_E= 2.78e-07  |g|= 8.79e-05  |ddm|= 2.69
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472462103813  LUMO = 1.61749111250583
  mo_energy =
[-0.90447246  1.61749111  7.63556335 18.23631809 36.28966592 61.80840199]
E1 = -3.866325140242377  E_coul = 1.0286896473798075
cycle= 13 E= -2.83763549286257  delta_E= -1.49e-06  |g|= 4.2e-05  |ddm|= 0.861
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472901020539  LUMO = 1.61748271124257
  mo_energy =
[-0.9044729   1.61748271  7.63551986 18.23617981 36.28945663 61.80798314]
E1 = -3.8663259026191508  E_coul = 1.0286893554040117
cycle= 14 E= -2.83763654721514  delta_E= -1.05e-06  |g|= 0.000114  |ddm|= 10.1
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472086238704  LUMO = 1.61749742839887
  mo_energy =
[-0.90447209  1.61749743  7.6355946  18.2364411  36.28988071 61.80891859]
E1 = -3.866324526075423  E_coul = 1.0286900384286382
cycle= 15 E= -2.83763448764678  delta_E= 2.06e-06  |g|= 8.22e-06  |ddm|= 19.2
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472235670315  LUMO = 1.6174950501063
  mo_energy =
[-0.90447224  1.61749505  7.63558256 18.23639018 36.28978756 61.80869234]
E1 = -3.866324757601432  E_coul = 1.0286921983719282
cycle= 16 E= -2.8376325592295  delta_E= 1.93e-06  |g|= 0.000206  |ddm|= 3.59
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471740309547  LUMO = 1.61750457485038
  mo_energy =
[-0.90447174  1.61750457  7.63563083 18.23655517 36.29004847 61.80926706]
E1 = -3.86632386085987  E_coul = 1.0286906903018056
cycle= 17 E= -2.83763317055806  delta_E= -6.11e-07  |g|= 9.33e-05  |ddm|= 12.3
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471702021818  LUMO = 1.61750569769462
  mo_energy =
[-0.9044717   1.6175057   7.63563729 18.23656912 36.29006211 61.80924962]
E1 = -3.8663237728178537  E_coul = 1.0286897773778751
cycle= 18 E= -2.83763399543998  delta_E= -8.25e-07  |g|= 2.65e-05  |ddm|= 0.887
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471995137917  LUMO = 1.61750011212812
  mo_energy =
[-0.904472    1.61750011  7.63560871 18.23647786 36.28992407 61.80897772]
E1 = -3.866324284112121  E_coul = 1.0286899258063202
cycle= 19 E= -2.8376343583058  delta_E= -3.63e-07  |g|= 1.5e-05  |ddm|= 6.75
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472179009754  LUMO = 1.61749678980608
  mo_energy =
[-0.90447218  1.61749679  7.63559224 18.23641543 36.28981891 61.80871737]
E1 = -3.866324609825883  E_coul = 1.0286879963332904
cycle= 20 E= -2.83763661349259  delta_E= -2.26e-06  |g|= 0.000175  |ddm|=  4.7
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472630244782  LUMO = 1.61748803197459
  mo_energy =
[-0.90447263  1.61748803  7.63554717 18.23626825 36.2895919  61.80826192]
E1 = -3.8663254148319797  E_coul = 1.0286914004220493
cycle= 21 E= -2.83763401440993  delta_E= 2.6e-06  |g|= 0.000105  |ddm|= 10.8
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472271016743  LUMO = 1.61749501778013
  mo_energy =
[-0.90447227  1.61749502  7.63558263 18.23639295 36.28979334 61.80872198]
E1 = -3.866324749483899  E_coul = 1.0286904467288402
cycle= 22 E= -2.83763430275506  delta_E= -2.88e-07  |g|= 3.99e-05  |ddm|= 9.25
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447177249887  LUMO = 1.61750432703267
  mo_energy =
[-0.90447177  1.61750433  7.6356297  18.23656245 36.29007236 61.80936486]
E1 = -3.8663238615539472  E_coul = 1.0286902427087865
cycle= 23 E= -2.83763361884516  delta_E= 6.84e-07  |g|= 5.19e-05  |ddm|= 12.5
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471742504999  LUMO = 1.61750489461168
  mo_energy =
[-0.90447174  1.61750489  7.63563251 18.23657517 36.2900959  61.80942803]
E1 = -3.8663238023905717  E_coul = 1.0286875912620614
cycle= 24 E= -2.83763621112851  delta_E= -2.59e-06  |g|= 0.000182  |ddm|= 0.927
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472123296828  LUMO = 1.6174977016367
  mo_energy =
[-0.90447212  1.6174977   7.63559644 18.23644816 36.2898909  61.8089524 ]
E1 = -3.8663244887541897  E_coul = 1.0286889244889377
cycle= 25 E= -2.83763556426525  delta_E= 6.47e-07  |g|= 8.55e-05  |ddm|= 9.53
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447227223244  LUMO = 1.61749484857405
  mo_energy =
[-0.90447227  1.61749485  7.63558192 18.23639908 36.28981372 61.80878815]
E1 = -3.8663247557181983  E_coul = 1.0286891501052213
cycle= 26 E= -2.83763560561298  delta_E= -4.13e-08  |g|= 7.66e-05  |ddm|= 3.63
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472402732842  LUMO = 1.61749235041865
  mo_energy =
[-0.9044724   1.61749235  7.63556903 18.23635481 36.28974269 61.80864345]
E1 = -3.8663249882010104  E_coul = 1.028689999906101
cycle= 27 E= -2.83763498829491  delta_E= 6.17e-07  |g|= 8.38e-06  |ddm|=  3.2
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472465062749  LUMO = 1.61749071823331
  mo_energy =
[-0.90447247  1.61749072  7.63555984 18.23632752 36.28970278 61.8085975 ]
E1 = -3.8663251271287176  E_coul = 1.0286943565070426
cycle= 28 E= -2.83763077062167  delta_E= 4.22e-06  |g|= 0.000378  |ddm|= 1.76
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471519728882  LUMO = 1.61750915501243
  mo_energy =
[-0.90447152  1.61750916  7.63565443 18.23664388 36.29019905 61.80962853]
E1 = -3.8663234163592564  E_coul = 1.0286915217273325
cycle= 29 E= -2.83763189463192  delta_E= -1.12e-06  |g|= 0.000198  |ddm|= 23.2
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471661772315  LUMO = 1.61750645233091
  mo_energy =
[-0.90447166  1.61750645  7.63564091 18.23659413 36.29011645 61.80942832]
E1 = -3.8663236800670306  E_coul = 1.028688765095576
cycle= 30 E= -2.83763491497145  delta_E= -3.02e-06  |g|= 6.35e-05  |ddm|= 3.74
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471598734465  LUMO = 1.61750750691144
  mo_energy =
[-0.9044716   1.61750751  7.63564595 18.23661234 36.29014593 61.80950969]
E1 = -3.8663235765091013  E_coul = 1.0286904955296865
cycle= 31 E= -2.83763308097941  delta_E= 1.83e-06  |g|= 0.0001  |ddm|= 1.46
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471651980044  LUMO = 1.61750646782311
  mo_energy =
[-0.90447165  1.61750647  7.63564067 18.23659469 36.2901186  61.80945209]
E1 = -3.86632367370315  E_coul = 1.0286887536234146
cycle= 32 E= -2.83763492007974  delta_E= -1.84e-06  |g|= 6.49e-05  |ddm|= 1.31
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471625241068  LUMO = 1.61750700648879
  mo_energy =
[-0.90447163  1.61750701  7.63564345 18.23660408 36.29013336 61.80948219]
E1 = -3.8663236235855  E_coul = 1.028687154125263
cycle= 33 E= -2.83763646946024  delta_E= -1.55e-06  |g|= 0.000208  |ddm|= 0.681
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471259857917  LUMO = 1.61751398957859
  mo_energy =
[-0.90447126  1.61751399  7.63567886 18.23672534 36.29032578 61.8099023 ]
E1 = -3.8663229664354275  E_coul = 1.0286876862272871
cycle= 34 E= -2.83763528020814  delta_E= 1.19e-06  |g|= 0.000142  |ddm|=    9
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904470456852165  LUMO = 1.61752910270258
  mo_energy =
[-0.90447046  1.6175291   7.6357554  18.23699379 36.29075873 61.81086425]
E1 = -3.866321534541706  E_coul = 1.028685685491447
cycle= 35 E= -2.83763584905026  delta_E= -5.69e-07  |g|= 0.000266  |ddm|= 19.9
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904469720457293  LUMO = 1.61754383425806
  mo_energy =
[-0.90446972  1.61754383  7.63583153 18.23724984 36.29116028 61.81168872]
E1 = -3.866320165562225  E_coul = 1.0286858069360338
cycle= 36 E= -2.83763435862619  delta_E= 1.49e-06  |g|= 0.000189  |ddm|= 18.6
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471816204876  LUMO = 1.61750325876195
  mo_energy =
[-0.90447182  1.61750326  7.63562373 18.23654685 36.29004835 61.80933489]
E1 = -3.8663239444335398  E_coul = 1.0286913908407416
cycle= 37 E= -2.8376325535928  delta_E= 1.81e-06  |g|= 0.000165  |ddm|= 51.5
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471812753874  LUMO = 1.61750272964404
  mo_energy =
[-0.90447181  1.61750273  7.6356198  18.23654425 36.29005455 61.80940382]
E1 = -3.8663239690261157  E_coul = 1.0286880717698945
cycle= 38 E= -2.83763589725622  delta_E= -3.34e-06  |g|= 0.00015  |ddm|= 0.0731
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472167518768  LUMO = 1.61749654609562
  mo_energy =
[-0.90447217  1.61749655  7.63558871 18.23642768 36.2898583  61.808941  ]
E1 = -3.8663245638816393  E_coul = 1.0286890083154994
cycle= 39 E= -2.83763555556614  delta_E= 3.42e-07  |g|= 7.94e-05  |ddm|= 8.59
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472765760222  LUMO = 1.61748496813125
  mo_energy =
[-0.90447277  1.61748497  7.63552935 18.23623123 36.28955649 61.80833112]
E1 = -3.8663256379088686  E_coul = 1.0286898641232505
cycle= 40 E= -2.83763577378562  delta_E= -2.18e-07  |g|= 4.33e-05  |ddm|= 14.4
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472958715914  LUMO = 1.61748099952824
  mo_energy =
[-0.90447296  1.617481    7.6355086  18.236171   36.28947309 61.80819288]
E1 = -3.866325991824039  E_coul = 1.0286902529268114
cycle= 41 E= -2.83763573889723  delta_E= 3.49e-08  |g|= 4.32e-05  |ddm|= 4.42
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472856698268  LUMO = 1.61748367790435
  mo_energy =
[-0.90447286  1.61748368  7.63552361 18.23620723 36.2895158  61.80819009]
E1 = -3.8663257771424147  E_coul = 1.0286912804572068
cycle= 42 E= -2.83763449668521  delta_E= 1.24e-06  |g|= 7.19e-05  |ddm|= 2.36
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447266688184  LUMO = 1.61748719468798
  mo_energy =
[-0.90447267  1.61748719  7.63554087 18.23626983 36.28961751 61.80844206]
E1 = -3.866325434020329  E_coul = 1.0286903281701838
cycle= 43 E= -2.83763510585015  delta_E= -6.09e-07  |g|= 7.92e-06  |ddm|= 4.81
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472579088189  LUMO = 1.61748878607528
  mo_energy =
[-0.90447258  1.61748879  7.63554899 18.2362946  36.28965351 61.80851351]
E1 = -3.8663252900905385  E_coul = 1.0286922708683761
cycle= 44 E= -2.83763301922216  delta_E= 2.09e-06  |g|= 0.000183  |ddm|= 1.87
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472226754082  LUMO = 1.61749534076208
  mo_energy =
[-0.90447223  1.61749534  7.63558237 18.2364092  36.2898374  61.80891819]
E1 = -3.866324677633828  E_coul = 1.0286918961631302
cycle= 45 E= -2.8376327814707  delta_E= 2.38e-07  |g|= 0.000178  |ddm|= 8.45
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472303298819  LUMO = 1.61749418380114
  mo_energy =
[-0.9044723   1.61749418  7.63557702 18.23638781 36.28980189 61.80883254]
E1 = -3.8663247938164935  E_coul = 1.028690379114228
cycle= 46 E= -2.83763441470227  delta_E= -1.63e-06  |g|= 2.65e-05  |ddm|= 1.69
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471819731667  LUMO = 1.6175032623514
  mo_energy =
[-0.90447182  1.61750326  7.63562331 18.23654556 36.29005186 61.80936461]
E1 = -3.8663239462568493  E_coul = 1.0286891155380813
cycle= 47 E= -2.83763483071877  delta_E= -4.16e-07  |g|= 4.89e-05  |ddm|= 11.6
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471884877836  LUMO = 1.61750217863606
  mo_energy =
[-0.90447188  1.61750218  7.63561836 18.23651992 36.29000123 61.80919759]
E1 = -3.8663240675001904  E_coul = 1.028688600186228
cycle= 48 E= -2.83763546731396  delta_E= -6.37e-07  |g|= 0.00011  |ddm|= 2.01
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471996843647  LUMO = 1.61750048369691
  mo_energy =
[-0.904472    1.61750048  7.63561073 18.23648175 36.28992765 61.80896625]
E1 = -3.866324254093778  E_coul = 1.0286890852878205
cycle= 49 E= -2.83763516880596  delta_E= 2.99e-07  |g|= 5.86e-05  |ddm|= 3.03
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471838862821  LUMO = 1.61750315113957
  mo_energy =
[-0.90447184  1.61750315  7.63562342 18.23653354 36.29001817 61.80922049]
E1 = -3.8663239825038977  E_coul = 1.0286909749688289
cycle= 50 E= -2.83763300753507  delta_E= 2.16e-06  |g|= 0.000125  |ddm|= 4.03
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8663239825038977  E_coul = 1.0286909749688289

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904471016388468  LUMO = 1.61752768132888
  mo_energy =
[-0.90447102  1.61752768  7.63574985 18.23698283 36.29074782 61.81083449]
E1 = -3.8663215378553173  E_coul = 1.028686025532623
Extra cycle  E= -2.83763551232269  delta_E= -2.5e-06  |g|= 0.000229  |ddm|= 33.5
    CPU time for scf_cycle      0.49 sec, wall time      0.49 sec
exp = [6.39058086 5.634203   4.96072263 4.25881459 3.85144601 0.37935906]
E = -2.837635512322694
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:23 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.3906318638         1
[INPUT] 0    0    [1    /1   ]  5.63430807589        1
[INPUT] 0    0    [1    /1   ]  4.96075109035        1
[INPUT] 0    0    [1    /1   ]  4.25881602462        1
[INPUT] 0    0    [1    /1   ]  3.85152952554        1
[INPUT] 0    0    [1    /1   ]  0.379352206984       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.390631863796219, 1.0]], [0, [5.634308075886484, 1.0]], [0, [4.960751090352527, 1.0]], [0, [4.258816024620432, 1.0]], [0, [3.851529525537672, 1.0]], [0, [0.3793522069842658, 1.0]]]}
ecp = {}
CPU time:        80.38
Set gradient conv threshold to 3.16228e-05
cond(S) = 973471960.7971184

WARN: Singularity detected in overlap matrix (condition number = 9.73e+08). SCF may be inaccurate and hard to converge.

E1 = -3.856568164004543  E_coul = 1.0242403025748552
init E= -2.83232786142969
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906690237656014  LUMO = 1.61345348264192
  mo_energy =
[-0.90669024  1.61345348  7.63060372 18.23110287 36.28425433 61.80307969]
E1 = -3.8665855251075834  E_coul = 1.0289490759059234
cycle= 1 E= -2.83763644920166  delta_E= -0.00531  |g|= 0.00599  |ddm|= 9.36e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904344557167414  LUMO = 1.61747713518256
  mo_energy =
[-0.90434456  1.61747714  7.63548737 18.2356231  36.28849499 61.80549677]
E1 = -3.866330688234542  E_coul = 1.028693892559309
cycle= 2 E= -2.83763679567523  delta_E= -3.46e-07  |g|= 0.000385  |ddm|=  610
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904478924693177  LUMO = 1.61744695895004
  mo_energy =
[-0.90447892  1.61744696  7.63544965 18.23584572 36.28891701 61.80648481]
E1 = -3.8663242836276948  E_coul = 1.0286873584242038
cycle= 3 E= -2.83763692520349  delta_E= -1.3e-07  |g|= 2.12e-05  |ddm|= 32.9
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904473868851094  LUMO = 1.617447181293
  mo_energy =
[-0.90447387  1.61744718  7.63544437 18.2357868  36.28879781 61.80599028]
E1 = -3.866325819679201  E_coul = 1.0286897321235924
cycle= 4 E= -2.83763608755561  delta_E= 8.38e-07  |g|= 8.27e-05  |ddm|= 8.35
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904473261582713  LUMO = 1.61746189557423
  mo_energy =
[-0.90447326  1.6174619   7.63551407 18.23605447 36.28924354 61.80719268]
E1 = -3.866324252703148  E_coul = 1.0286879788264274
cycle= 5 E= -2.83763627387672  delta_E= -1.86e-07  |g|= 9.82e-06  |ddm|= 21.4
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473719284906  LUMO = 1.61745835730338
  mo_energy =
[-0.90447372  1.61745836  7.63549417 18.23602511 36.28923526 61.80738677]
E1 = -3.8663244137838015  E_coul = 1.0286894817212568
cycle= 6 E= -2.83763493206254  delta_E= 1.34e-06  |g|= 0.00012  |ddm|= 1.19
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473402347962  LUMO = 1.61746616174311
  mo_energy =
[-0.9044734   1.61746616  7.63553456 18.23616349 36.2894561  61.80783556]
E1 = -3.8663236670233156  E_coul = 1.0286887486279936
cycle= 7 E= -2.83763491839532  delta_E= 1.37e-08  |g|= 8.68e-05  |ddm|= 10.2
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473332303175  LUMO = 1.61746999553496
  mo_energy =
[-0.90447333  1.61747     7.63555406 18.23623184 36.28956448 61.80809524]
E1 = -3.866323265152133  E_coul = 1.0286869137813353
cycle= 8 E= -2.8376363513708  delta_E= -1.43e-06  |g|= 6.63e-05  |ddm|= 5.36
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447361904014  LUMO = 1.61746677917506
  mo_energy =
[-0.90447362  1.61746678  7.6355381  18.23617835 36.28948059 61.80791486]
E1 = -3.866323536743941  E_coul = 1.0286882303816975
cycle= 9 E= -2.83763530636224  delta_E= 1.05e-06  |g|= 4.58e-05  |ddm|= 3.84
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473607993401  LUMO = 1.61746775994455
  mo_energy =
[-0.90447361  1.61746776  7.63554352 18.23619894 36.28951681 61.8079947 ]
E1 = -3.8663234364378463  E_coul = 1.0286863879043853
cycle= 10 E= -2.83763704853346  delta_E= -1.74e-06  |g|= 0.000129  |ddm|= 1.44
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473084874244  LUMO = 1.61747094906043
  mo_energy =
[-0.90447308  1.61747095  7.63556159 18.2362239  36.28952115 61.80778228]
E1 = -3.866323329697608  E_coul = 1.0286881571469133
cycle= 11 E= -2.83763517255069  delta_E= 1.88e-06  |g|= 4.12e-05  |ddm|= 0.673
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447365148348  LUMO = 1.61746753095026
  mo_energy =
[-0.90447365  1.61746753  7.63554217 18.23620795 36.28954772 61.80811   ]
E1 = -3.8663234277014213  E_coul = 1.0286870665298817
cycle= 12 E= -2.83763636117154  delta_E= -1.19e-06  |g|= 6.47e-05  |ddm|= 0.0857
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473828985297  LUMO = 1.61746506159993
  mo_energy =
[-0.90447383  1.61746506  7.63552985 18.23616375 36.28947493 61.807927  ]
E1 = -3.866323652593941  E_coul = 1.0286883931408721
cycle= 13 E= -2.83763525945307  delta_E= 1.1e-06  |g|= 4.97e-05  |ddm|= 3.24
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473665035291  LUMO = 1.61746840606998
  mo_energy =
[-0.90447367  1.61746841  7.63554694 18.23621893 36.28955864 61.80809684]
E1 = -3.866323342469434  E_coul = 1.0286859783768796
cycle= 14 E= -2.83763736409255  delta_E= -2.1e-06  |g|= 0.000156  |ddm|= 4.09
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474572046973  LUMO = 1.6174539822154
  mo_energy =
[-0.90447457  1.61745398  7.63547364 18.23597275 36.28917117 61.80729319]
E1 = -3.866324643290962  E_coul = 1.0286900056585833
cycle= 15 E= -2.83763463763238  delta_E= 2.73e-06  |g|= 0.000166  |ddm|= 17.9
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473734936502  LUMO = 1.61746814164158
  mo_energy =
[-0.90447373  1.61746814  7.63554642 18.23620801 36.28952982 61.80798646]
E1 = -3.866323377677146  E_coul = 1.0286868875206632
cycle= 16 E= -2.83763649015648  delta_E= -1.85e-06  |g|= 8.54e-05  |ddm|=   17
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473791944022  LUMO = 1.61746753250227
  mo_energy =
[-0.90447379  1.61746753  7.63554418 18.23619294 36.28949894 61.80786731]
E1 = -3.866323451755943  E_coul = 1.0286863231841283
cycle= 17 E= -2.83763712857181  delta_E= -6.38e-07  |g|= 0.000127  |ddm|=  1.3
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474034789859  LUMO = 1.61746316346514
  mo_energy =
[-0.90447403  1.61746316  7.63552215 18.23611475 36.28937134 61.80756591]
E1 = -3.866323865049768  E_coul = 1.028686024113153
cycle= 18 E= -2.83763784093662  delta_E= -7.12e-07  |g|= 0.000179  |ddm|= 5.81
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474263833971  LUMO = 1.61745867897892
  mo_energy =
[-0.90447426  1.61745868  7.63549935 18.23603582 36.28924447 61.80728574]
E1 = -3.8663242882526  E_coul = 1.0286885734131135
cycle= 19 E= -2.83763571483949  delta_E= 2.13e-06  |g|= 4.36e-05  |ddm|= 5.84
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474222106478  LUMO = 1.6174593252309
  mo_energy =
[-0.90447422  1.61745933  7.63550287 18.23604637 36.28926032 61.80731009]
E1 = -3.8663242351708362  E_coul = 1.0286890031019025
cycle= 20 E= -2.83763523206893  delta_E= 4.83e-07  |g|= 9.23e-05  |ddm|= 0.694
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474196121374  LUMO = 1.61745974415292
  mo_energy =
[-0.9044742   1.61745974  7.63550494 18.23605334 36.28927119 61.80733423]
E1 = -3.8663241959002486  E_coul = 1.0286900289225713
cycle= 21 E= -2.83763416697768  delta_E= 1.07e-06  |g|= 0.000185  |ddm|= 0.529
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447413357965  LUMO = 1.61746078904789
  mo_energy =
[-0.90447413  1.61746079  7.63551026 18.23607124 36.28929967 61.80739408]
E1 = -3.8663241004180944  E_coul = 1.0286866497577367
cycle= 22 E= -2.83763745066036  delta_E= -3.28e-06  |g|= 0.000118  |ddm|= 1.31
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474258056164  LUMO = 1.61745825899532
  mo_energy =
[-0.90447426  1.61745826  7.63549772 18.23602755 36.28923044 61.80722428]
E1 = -3.8663243463753925  E_coul = 1.0286890200554615
cycle= 23 E= -2.83763532631993  delta_E= 2.12e-06  |g|= 7.84e-05  |ddm|= 3.37
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474198140264  LUMO = 1.61745920337667
  mo_energy =
[-0.9044742   1.6174592   7.63550265 18.23604152 36.28925028 61.80726042]
E1 = -3.8663242667451363  E_coul = 1.0286889095099945
cycle= 24 E= -2.83763535723514  delta_E= -3.09e-08  |g|= 7.66e-05  |ddm|=    1
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474415105181  LUMO = 1.61745486403094
  mo_energy =
[-0.90447442  1.61745486  7.63547986 18.23597096 36.28914496 61.80707234]
E1 = -3.8663246549968746  E_coul = 1.028687891507354
cycle= 25 E= -2.83763676348952  delta_E= -1.41e-06  |g|= 3.58e-05  |ddm|= 5.06
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474363883248  LUMO = 1.61745571700854
  mo_energy =
[-0.90447436  1.61745572  7.63548387 18.23598909 36.2891773  61.80716856]
E1 = -3.8663245643764905  E_coul = 1.028688104562576
cycle= 26 E= -2.83763645981391  delta_E= 3.04e-07  |g|= 1.28e-05  |ddm|=  1.4
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473301067484  LUMO = 1.61747534880137
  mo_energy =
[-0.9044733   1.61747535  7.63558342 18.23633528 36.28973595 61.80840882]
E1 = -3.8663227215929474  E_coul = 1.028684811591952
cycle= 27 E= -2.837637910001  delta_E= -1.45e-06  |g|= 0.000238  |ddm|= 25.6
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474235910427  LUMO = 1.61745782913344
  mo_energy =
[-0.90447424  1.61745783  7.63549415 18.23602139 36.28922578 61.80728028]
E1 = -3.86632436847844  E_coul = 1.0286869216993242
cycle= 28 E= -2.83763744677912  delta_E= 4.63e-07  |g|= 0.000122  |ddm|=   23
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474497970568  LUMO = 1.6174530103637
  mo_energy =
[-0.9044745   1.61745301  7.63547019 18.23593385 36.28908154 61.8069383 ]
E1 = -3.8663248344747854  E_coul = 1.02868788084259
cycle= 29 E= -2.8376369536322  delta_E= 4.93e-07  |g|= 4.7e-05  |ddm|= 6.59
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474872732329  LUMO = 1.6174459259844
  mo_energy =
[-0.90447487  1.61744593  7.63543432 18.23581078 36.28888571 61.80650742]
E1 = -3.8663255004878434  E_coul = 1.0286894341036297
cycle= 30 E= -2.83763606638421  delta_E= 8.87e-07  |g|= 6.81e-05  |ddm|= 9.14
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474774261051  LUMO = 1.61744801130043
  mo_energy =
[-0.90447477  1.61744801  7.63544518 18.2358418  36.28892809 61.80657623]
E1 = -3.866325314879416  E_coul = 1.0286901148362322
cycle= 31 E= -2.83763520004318  delta_E= 8.66e-07  |g|= 0.000128  |ddm|= 2.29
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474919397823  LUMO = 1.61744525274362
  mo_energy =
[-0.90447492  1.61744525  7.63543118 18.23579326 36.28884962 61.80639674]
E1 = -3.8663255749371395  E_coul = 1.0286880986010234
cycle= 32 E= -2.83763747633612  delta_E= -2.28e-06  |g|= 6.55e-05  |ddm|=  3.6
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447520138564  LUMO = 1.61743977505747
  mo_energy =
[-0.9044752   1.61743978  7.63540317 18.23569859 36.28870028 61.80607849]
E1 = -3.8663260856499497  E_coul = 1.0286912892066016
cycle= 33 E= -2.83763479644335  delta_E= 2.68e-06  |g|= 0.000223  |ddm|= 6.96
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475222840579  LUMO = 1.61743956704411
  mo_energy =
[-0.90447522  1.61743957  7.63540272 18.23569247 36.2886863  61.80601358]
E1 = -3.8663261186394644  E_coul = 1.028689896606454
cycle= 34 E= -2.83763622203301  delta_E= -1.43e-06  |g|= 8.61e-05  |ddm|= 0.618
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475267192029  LUMO = 1.61743879317461
  mo_energy =
[-0.90447527  1.61743879  7.63539897 18.2356756  36.28865525 61.80593107]
E1 = -3.8663261990505493  E_coul = 1.028691190888318
cycle= 35 E= -2.83763500816223  delta_E= 1.21e-06  |g|= 0.000214  |ddm|= 1.26
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475787555901  LUMO = 1.61743078069592
  mo_energy =
[-0.90447579  1.61743078  7.63536348 18.23550072 36.28832736 61.80491584]
E1 = -3.8663270835464854  E_coul = 1.0286901676498201
cycle= 36 E= -2.83763691589667  delta_E= -1.91e-06  |g|= 0.0001  |ddm|= 14.1
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474604439344  LUMO = 1.61745624232164
  mo_energy =
[-0.9044746   1.61745624  7.63549656 18.23591953 36.28895564 61.80609643]
E1 = -3.866324764253879  E_coul = 1.0286889630923557
cycle= 37 E= -2.83763580116152  delta_E= 1.11e-06  |g|= 8.04e-05  |ddm|= 30.4
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473620430335  LUMO = 1.6174714762738
  mo_energy =
[-0.90447362  1.61747148  7.63557303 18.23619232 36.28940111 61.8070791 ]
E1 = -3.8663233513624555  E_coul = 1.0286869413666164
cycle= 38 E= -2.83763640999584  delta_E= -6.09e-07  |g|= 4.61e-05  |ddm|= 19.9
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473920526605  LUMO = 1.61746263742167
  mo_energy =
[-0.90447392  1.61746264  7.63552215 18.23607346 36.28926829 61.807148  ]
E1 = -3.866324052962033  E_coul = 1.0286905641232598
cycle= 39 E= -2.83763348883877  delta_E= 2.92e-06  |g|= 0.000244  |ddm|= 7.49
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473391703732  LUMO = 1.61747247338117
  mo_energy =
[-0.90447339  1.61747247  7.63557094 18.23626001 36.28958418 61.80793342]
E1 = -3.8663230853261323  E_coul = 1.0286894180009394
cycle= 40 E= -2.83763366732519  delta_E= -1.78e-07  |g|= 0.000192  |ddm|=   14
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472887220458  LUMO = 1.61748172808021
  mo_energy =
[-0.90447289  1.61748173  7.63561565 18.23644059 36.28989698 61.80876394]
E1 = -3.8663221446826057  E_coul = 1.0286858628645439
cycle= 41 E= -2.83763628181806  delta_E= -2.61e-06  |g|= 0.000125  |ddm|= 13.9
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473317607799  LUMO = 1.6174742420595
  mo_energy =
[-0.90447332  1.61747424  7.6355783  18.23630493 36.28967288 61.80823629]
E1 = -3.8663228590967607  E_coul = 1.028686794057868
cycle= 42 E= -2.83763606503889  delta_E= 2.17e-07  |g|= 4.65e-05  |ddm|= 10.1
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473374200594  LUMO = 1.61747261083929
  mo_energy =
[-0.90447337  1.61747261  7.635569   18.23628661 36.28965783 61.8082533 ]
E1 = -3.8663229856969976  E_coul = 1.02868710835285
cycle= 43 E= -2.83763587734415  delta_E= 1.88e-07  |g|= 5.8e-05  |ddm|= 1.22
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473533000621  LUMO = 1.61746977329323
  mo_energy =
[-0.90447353  1.61746977  7.63555555 18.23622745 36.28955096 61.8079529 ]
E1 = -3.866323283845813  E_coul = 1.0286894239773847
cycle= 44 E= -2.83763385986843  delta_E= 2.02e-06  |g|= 0.000165  |ddm|= 4.57
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472493259582  LUMO = 1.61749003049513
  mo_energy =
[-0.90447249  1.61749003  7.63566027 18.2365747  36.29009326 61.80905114]
E1 = -3.866321419291588  E_coul = 1.02868459532769
cycle= 45 E= -2.8376368239639  delta_E= -2.96e-06  |g|= 0.000205  |ddm|= 25.2
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471678526209  LUMO = 1.61750619499637
  mo_energy =
[-0.90447168  1.61750619  7.63574083 18.23686933 36.29057943 61.81023805]
E1 = -3.8663198414936133  E_coul = 1.0286839153622191
cycle= 46 E= -2.83763592613139  delta_E= 8.98e-07  |g|= 0.00021  |ddm|= 22.3
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472158358678  LUMO = 1.61749725122086
  mo_energy =
[-0.90447216  1.61749725  7.63569544 18.23671217 36.29032646 61.80966626]
E1 = -3.8663206817829616  E_coul = 1.028683524116007
cycle= 47 E= -2.83763715766695  delta_E= -1.23e-06  |g|= 0.000281  |ddm|= 11.6
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447242225342  LUMO = 1.61749208398291
  mo_energy =
[-0.90447242  1.61749208  7.63566837 18.23662141 36.29018392 61.80939276]
E1 = -3.8663211537854165  E_coul = 1.0286843333811357
cycle= 48 E= -2.83763682040428  delta_E= 3.37e-07  |g|= 0.000227  |ddm|= 6.41
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472964665397  LUMO = 1.61748254394568
  mo_energy =
[-0.90447296  1.61748254  7.63562219 18.23643639 36.28986455 61.80855121]
E1 = -3.866322114955794  E_coul = 1.0286856556812267
cycle= 49 E= -2.83763645927457  delta_E= 3.61e-07  |g|= 0.000126  |ddm|= 14.2
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472918452917  LUMO = 1.61748258474461
  mo_energy =
[-0.90447292  1.61748258  7.63562125 18.23644162 36.2898816  61.80863946]
E1 = -3.8663220940017338  E_coul = 1.028686247559736
cycle= 50 E= -2.837635846442  delta_E= 6.13e-07  |g|= 8.6e-05  |ddm|= 0.618
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8663220940017338  E_coul = 1.028686247559736

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904474799496579  LUMO = 1.61746617902588
  mo_energy =
[-0.9044748   1.61746618  7.63554327 18.23615079 36.28939062 61.80735879]
E1 = -3.8663234445000043  E_coul = 1.0286875457950295
Extra cycle  E= -2.83763589870498  delta_E= -5.23e-08  |g|= 1.11e-05  |ddm|= 20.9
    CPU time for scf_cycle      0.49 sec, wall time      0.49 sec
exp = [6.39063186 5.63430808 4.96075109 4.25881602 3.85152953 0.37935221]
E = -2.837635898704975
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:24 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.39063696449        1
[INPUT] 0    0    [1    /1   ]  5.63431858302        1
[INPUT] 0    0    [1    /1   ]  4.96075393616        1
[INPUT] 0    0    [1    /1   ]  4.25881616811        1
[INPUT] 0    0    [1    /1   ]  3.8515378772         1
[INPUT] 0    0    [1    /1   ]  0.379351521863       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.3906369644864895, 1.0]], [0, [5.63431858301507, 1.0]], [0, [4.960753936160832, 1.0]], [0, [4.2588161681136185, 1.0]], [0, [3.851537877200296, 1.0]], [0, [0.37935152186280374, 1.0]]]}
ecp = {}
CPU time:        81.21
Set gradient conv threshold to 3.16228e-05
cond(S) = 973466997.0622606

WARN: Singularity detected in overlap matrix (condition number = 9.73e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8565682020123875  E_coul = 1.0242346518380692
init E= -2.83233355017432
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906696198342122  LUMO = 1.6133354578663
  mo_energy =
[-0.9066962   1.61333546  7.63000575 18.22910993 36.28115794 61.79669247]
E1 = -3.866596092673101  E_coul = 1.0289568067308115
cycle= 1 E= -2.83763928594229  delta_E= -0.00531  |g|= 0.006  |ddm|= 9.5e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904342102573361  LUMO = 1.61742305575308
  mo_energy =
[-0.9043421   1.61742306  7.63520124 18.23472402 36.28719888 61.80326893]
E1 = -3.8663365235471345  E_coul = 1.0286945974292803
cycle= 2 E= -2.83764192611785  delta_E= -2.64e-06  |g|= 0.000391  |ddm|=  538
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904481398438634  LUMO = 1.61733919029217
  mo_energy =
[-0.9044814   1.61733919  7.63488516 18.23409421 36.28633511 61.80197855]
E1 = -3.866334280785207  E_coul = 1.0286908794668455
cycle= 3 E= -2.83764340131836  delta_E= -1.48e-06  |g|= 0.000137  |ddm|= 89.5
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904474885251311  LUMO = 1.61731159530324
  mo_energy =
[-0.90447489  1.6173116   7.63472846 18.23352053 36.28541427 61.79977334]
E1 = -3.8663391720026254  E_coul = 1.0286984001349937
cycle= 4 E= -2.83764077186763  delta_E= 2.63e-06  |g|= 0.000269  |ddm|= 49.8
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904471150093106  LUMO = 1.61737240451095
  mo_energy =
[-0.90447115  1.6173724   7.63503925 18.23453628 36.28698348 61.80303474]
E1 = -3.8663337260621504  E_coul = 1.0286903430391443
cycle= 5 E= -2.83764338302301  delta_E= -2.61e-06  |g|= 0.000234  |ddm|= 73.4
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474195141416  LUMO = 1.61734174817755
  mo_energy =
[-0.9044742   1.61734175  7.63488463 18.23402911 36.28619249 61.80145462]
E1 = -3.8663361417606725  E_coul = 1.0286927535124994
cycle= 6 E= -2.83764338824817  delta_E= -5.23e-09  |g|= 0.000115  |ddm|= 34.8
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447453986644  LUMO = 1.61733490757757
  mo_energy =
[-0.90447454  1.61733491  7.63485057 18.23391115 36.28600306 61.80097927]
E1 = -3.866336803297604  E_coul = 1.0286948439999233
cycle= 7 E= -2.83764195929768  delta_E= 1.43e-06  |g|= 5.84e-05  |ddm|= 9.11
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474301545034  LUMO = 1.61733779716489
  mo_energy =
[-0.9044743   1.6173378   7.6348652  18.23396216 36.28608636 61.80115628]
E1 = -3.8663365572248303  E_coul = 1.0286953688151372
cycle= 8 E= -2.83764118840969  delta_E= 7.71e-07  |g|= 0.000106  |ddm|= 3.57
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474033811735  LUMO = 1.61734273528003
  mo_energy =
[-0.90447403  1.61734274  7.6348911  18.23404243 36.28620561 61.80136948]
E1 = -3.8663361219414174  E_coul = 1.0286915693896954
cycle= 9 E= -2.83764455255172  delta_E= -3.36e-06  |g|= 0.000212  |ddm|= 5.71
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474440135329  LUMO = 1.61733499518655
  mo_energy =
[-0.90447444  1.617335    7.63485096 18.23391163 36.28600413 61.80097904]
E1 = -3.866336824440021  E_coul = 1.0286953102206817
cycle= 10 E= -2.83764151421934  delta_E= 3.04e-06  |g|= 9.88e-05  |ddm|= 9.44
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474024071127  LUMO = 1.61734042439772
  mo_energy =
[-0.90447402  1.61734042  7.63487882 18.23400179 36.28614405 61.80125242]
E1 = -3.866336368759387  E_coul = 1.0286923548795315
cycle= 11 E= -2.83764401387986  delta_E= -2.5e-06  |g|= 0.000152  |ddm|= 6.31
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474620519634  LUMO = 1.61733107255163
  mo_energy =
[-0.90447462  1.61733107  7.63483161 18.23383883 36.28588292 61.80068139]
E1 = -3.866337219023993  E_coul = 1.0286953133549777
cycle= 12 E= -2.83764190566901  delta_E= 2.11e-06  |g|= 8.86e-05  |ddm|= 11.9
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474408626431  LUMO = 1.61733420455168
  mo_energy =
[-0.90447441  1.6173342   7.63484682 18.23389471 36.28597552 61.80091437]
E1 = -3.866336922258369  E_coul = 1.0286944243583416
cycle= 13 E= -2.83764249790003  delta_E= -5.92e-07  |g|= 1.78e-05  |ddm|= 4.27
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447516825275  LUMO = 1.61732008957307
  mo_energy =
[-0.90447517  1.61732009  7.63477465 18.23365003 36.2855881  61.80010283]
E1 = -3.8663382281171508  E_coul = 1.0286962568486735
cycle= 14 E= -2.83764197126848  delta_E= 5.27e-07  |g|= 0.000126  |ddm|= 17.9
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474823954967  LUMO = 1.6173263905228
  mo_energy =
[-0.90447482  1.61732639  7.6348065  18.23375973 36.28576406 61.80049997]
E1 = -3.866337637267819  E_coul = 1.0286961584583756
cycle= 15 E= -2.83764147880944  delta_E= 4.92e-07  |g|= 0.000134  |ddm|= 8.17
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474838145724  LUMO = 1.61732588604889
  mo_energy =
[-0.90447484  1.61732589  7.63480388 18.23374943 36.28574622 61.80046188]
E1 = -3.866337689214007  E_coul = 1.0286942058335546
cycle= 16 E= -2.83764348338045  delta_E= -2e-06  |g|= 3.94e-05  |ddm|= 0.747
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475125689152  LUMO = 1.61731966793923
  mo_energy =
[-0.90447513  1.61731967  7.63477134 18.2336451  36.28558776 61.80016711]
E1 = -3.866338258130423  E_coul = 1.028696516008639
cycle= 17 E= -2.83764174212178  delta_E= 1.74e-06  |g|= 0.000141  |ddm|= 7.52
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474668715838  LUMO = 1.61732833488411
  mo_energy =
[-0.90447467  1.61732833  7.63481595 18.23378991 36.28581088 61.80062211]
E1 = -3.8663374663818124  E_coul = 1.0286945695722605
cycle= 18 E= -2.83764289680955  delta_E= -1.15e-06  |g|= 4.34e-06  |ddm|= 10.6
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9044750222517  LUMO = 1.61732068113964
  mo_energy =
[-0.90447502  1.61732068  7.63477598 18.23366003 36.28560957 61.80023576]
E1 = -3.8663381691002554  E_coul = 1.0286954468187728
cycle= 19 E= -2.83764272228148  delta_E= 1.75e-07  |g|= 6.19e-05  |ddm|= 9.37
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474366230412  LUMO = 1.61733296653087
  mo_energy =
[-0.90447437  1.61733297  7.63483677 18.23388573 36.28598667 61.80112421]
E1 = -3.8663369708226547  E_coul = 1.028694970510361
cycle= 20 E= -2.83764200031229  delta_E= 7.22e-07  |g|= 5.6e-05  |ddm|= 17.1
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474462377004  LUMO = 1.61733289955517
  mo_energy =
[-0.90447446  1.6173329   7.63483872 18.23388602 36.28598266 61.80100933]
E1 = -3.866337001147092  E_coul = 1.028695032961873
cycle= 21 E= -2.83764196818522  delta_E= 3.21e-08  |g|= 5.81e-05  |ddm|= 0.652
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474122491065  LUMO = 1.61733981056816
  mo_energy =
[-0.90447412  1.61733981  7.63487585 18.23399372 36.28613847 61.80126257]
E1 = -3.8663364047869804  E_coul = 1.028694212498217
cycle= 22 E= -2.83764219228876  delta_E= -2.24e-07  |g|= 1.04e-05  |ddm|= 7.58
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473991032967  LUMO = 1.61734290556565
  mo_energy =
[-0.90447399  1.61734291  7.63489379 18.2340322  36.2861781  61.80126343]
E1 = -3.8663361729760175  E_coul = 1.0286951901377461
cycle= 23 E= -2.83764098283827  delta_E= 1.21e-06  |g|= 0.000119  |ddm|= 2.38
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473608402635  LUMO = 1.61734945426664
  mo_energy =
[-0.90447361  1.61734945  7.63492573 18.23415336 36.28637954 61.80174939]
E1 = -3.86633553143981  E_coul = 1.0286909934180593
cycle= 24 E= -2.83764453802175  delta_E= -3.56e-06  |g|= 0.000244  |ddm|= 9.21
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474288063892  LUMO = 1.61733651460174
  mo_energy =
[-0.90447429  1.61733651  7.63485967 18.23393375 36.2860361  61.80102362]
E1 = -3.8663367308309637  E_coul = 1.0286937386456312
cycle= 25 E= -2.83764299218533  delta_E= 1.55e-06  |g|= 5.2e-05  |ddm|= 16.2
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474353536091  LUMO = 1.61733520101021
  mo_energy =
[-0.90447435  1.6173352   7.63485302 18.23390862 36.28599368 61.8009207 ]
E1 = -3.8663368592214042  E_coul = 1.028694621228121
cycle= 26 E= -2.83764223799328  delta_E= 7.54e-07  |g|= 3.72e-05  |ddm|= 1.86
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474274440601  LUMO = 1.61733675401598
  mo_energy =
[-0.90447427  1.61733675  7.63486096 18.23393433 36.28603304 61.80100331]
E1 = -3.866336715963114  E_coul = 1.0286944965362839
cycle= 27 E= -2.83764221942683  delta_E= 1.86e-08  |g|= 3.55e-05  |ddm|= 1.91
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474186583729  LUMO = 1.6173383421142
  mo_energy =
[-0.90447419  1.61733834  7.63486871 18.23396423 36.2860838  61.80112825]
E1 = -3.8663365586531633  E_coul = 1.0286946306704776
cycle= 28 E= -2.83764192798269  delta_E= 2.91e-07  |g|= 4.44e-05  |ddm|= 2.28
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474100846636  LUMO = 1.61733996409861
  mo_energy =
[-0.9044741   1.61733996  7.63487715 18.23398936 36.2861195  61.80118862]
E1 = -3.866336414543564  E_coul = 1.0286944897038612
cycle= 29 E= -2.8376419248397  delta_E= 3.14e-09  |g|= 3.68e-05  |ddm|= 1.83
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474010366288  LUMO = 1.61734179564383
  mo_energy =
[-0.90447401  1.6173418   7.63488653 18.23401875 36.28616206 61.80126711]
E1 = -3.866336246547697  E_coul = 1.0286936496354597
cycle= 30 E= -2.83764259691224  delta_E= -6.72e-07  |g|= 2.86e-05  |ddm|= 2.18
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474029242414  LUMO = 1.61734118642478
  mo_energy =
[-0.90447403  1.61734119  7.63488283 18.23401032 36.28615186 61.80126398]
E1 = -3.8663362921201303  E_coul = 1.0286919914952026
cycle= 31 E= -2.83764430062493  delta_E= -1.7e-06  |g|= 0.000176  |ddm|= 0.493
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474394171956  LUMO = 1.61733408515718
  mo_energy =
[-0.90447439  1.61733409  7.63484651 18.2338894  36.28596376 61.80087307]
E1 = -3.866336951140043  E_coul = 1.0286942452184655
cycle= 32 E= -2.83764270592158  delta_E= 1.59e-06  |g|= 1.48e-05  |ddm|= 8.91
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474427254841  LUMO = 1.61733342319334
  mo_energy =
[-0.90447443  1.61733342  7.63484327 18.23387656 36.28594148 61.80081485]
E1 = -3.8663370177427496  E_coul = 1.0286952463246994
cycle= 33 E= -2.83764177141805  delta_E= 9.35e-07  |g|= 9.41e-05  |ddm|= 0.977
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474329712405  LUMO = 1.61733509771949
  mo_energy =
[-0.90447433  1.6173351   7.63485145 18.23390955 36.28599892 61.80096052]
E1 = -3.866336850641986  E_coul = 1.0286951652279857
cycle= 34 E= -2.837641685414  delta_E= 8.6e-08  |g|= 7.55e-05  |ddm|= 2.49
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9044742869728  LUMO = 1.61733601970052
  mo_energy =
[-0.90447429  1.61733602  7.63485636 18.23392462 36.28602086 61.80099568]
E1 = -3.866336768326728  E_coul = 1.028693783562163
cycle= 35 E= -2.83764298476456  delta_E= -1.3e-06  |g|= 4.76e-05  |ddm|= 1.06
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474367571813  LUMO = 1.61733475607351
  mo_energy =
[-0.90447437  1.61733476  7.63485067 18.23389767 36.28597142 61.80085571]
E1 = -3.866336904946364  E_coul = 1.0286957557669465
cycle= 36 E= -2.83764114917942  delta_E= 1.84e-06  |g|= 0.000137  |ddm|= 2.14
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474368426129  LUMO = 1.61733463549468
  mo_energy =
[-0.90447437  1.61733464  7.63485001 18.23389616 36.28597038 61.80086302]
E1 = -3.86633691642903  E_coul = 1.028693489603274
cycle= 37 E= -2.83764342682576  delta_E= -2.28e-06  |g|= 8.29e-05  |ddm|= 0.111
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474649682189  LUMO = 1.61732904990435
  mo_energy =
[-0.90447465  1.61732905  7.63482149 18.23379993 36.28581967 61.80053864]
E1 = -3.8663374397339973  E_coul = 1.0286958528666663
cycle= 38 E= -2.83764158686733  delta_E= 1.84e-06  |g|= 0.000114  |ddm|= 7.12
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474996150307  LUMO = 1.61732208397023
  mo_energy =
[-0.904475    1.61732208  7.63478573 18.2336858  36.2856481  61.8002028 ]
E1 = -3.8663380789419852  E_coul = 1.028696980956319
cycle= 39 E= -2.83764109798567  delta_E= 4.89e-07  |g|= 0.000197  |ddm|= 8.43
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474418874293  LUMO = 1.61733505413018
  mo_energy =
[-0.90447442  1.61733505  7.63485567 18.23388926 36.28593583 61.80061706]
E1 = -3.8663369518908315  E_coul = 1.0286970317634025
cycle= 40 E= -2.83763992012743  delta_E= 1.18e-06  |g|= 0.00027  |ddm|= 14.1
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473769801887  LUMO = 1.61734683336007
  mo_energy =
[-0.90447377  1.61734683  7.63491493 18.23410389 36.2862899  61.80143188]
E1 = -3.866335830323625  E_coul = 1.028691933469831
cycle= 41 E= -2.83764389685379  delta_E= -3.98e-06  |g|= 0.00017  |ddm|= 15.9
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474190212377  LUMO = 1.61733866220502
  mo_energy =
[-0.90447419  1.61733866  7.63487239 18.2339576  36.28605237 61.80092889]
E1 = -3.866336582623965  E_coul = 1.0286946937781196
cycle= 42 E= -2.83764188884585  delta_E= 2.01e-06  |g|= 6.39e-05  |ddm|= 10.5
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474130666595  LUMO = 1.61733928401407
  mo_energy =
[-0.90447413  1.61733928  7.63487445 18.23397509 36.28609011 61.80106332]
E1 = -3.866336501213357  E_coul = 1.028694112691748
cycle= 43 E= -2.83764238852161  delta_E= -5e-07  |g|= 1.04e-05  |ddm|= 1.49
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473994572788  LUMO = 1.61734158393956
  mo_energy =
[-0.90447399  1.61734158  7.63488548 18.23401745 36.28616066 61.80124369]
E1 = -3.866336272290256  E_coul = 1.0286920972229427
cycle= 44 E= -2.83764417506731  delta_E= -1.79e-06  |g|= 0.000172  |ddm|=  3.3
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474338355034  LUMO = 1.61733483980781
  mo_energy =
[-0.90447434  1.61733484  7.6348508  18.23390312 36.28598434 61.80088523]
E1 = -3.8663368953439554  E_coul = 1.0286930589643737
cycle= 45 E= -2.83764383637958  delta_E= 3.39e-07  |g|= 0.00011  |ddm|= 8.39
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474373813261  LUMO = 1.61733370151153
  mo_energy =
[-0.90447437  1.6173337   7.63484448 18.23389302 36.28598082 61.80091641]
E1 = -3.866336983421232  E_coul = 1.0286969311596574
cycle= 46 E= -2.83764005226157  delta_E= 3.78e-06  |g|= 0.000239  |ddm|= 0.739
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474154394205  LUMO = 1.6173377643148
  mo_energy =
[-0.90447415  1.61733776  7.63486467 18.2339662  36.28610096 61.80121055]
E1 = -3.866336590983345  E_coul = 1.0286948498460908
cycle= 47 E= -2.83764174113725  delta_E= -1.69e-06  |g|= 5.95e-05  |ddm|= 5.55
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473965987665  LUMO = 1.61734158788574
  mo_energy =
[-0.90447397  1.61734159  7.63488454 18.23403172 36.28620296 61.80141496]
E1 = -3.8663362394005674  E_coul = 1.028693934887155
cycle= 48 E= -2.83764230451341  delta_E= -5.63e-07  |g|= 3.91e-06  |ddm|= 4.75
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474082673143  LUMO = 1.6173394780236
  mo_energy =
[-0.90447408  1.61733948  7.63487389 18.23399365 36.28614126 61.80127996]
E1 = -3.8663364389154307  E_coul = 1.028695171185954
cycle= 49 E= -2.83764126772948  delta_E= 1.04e-06  |g|= 0.000103  |ddm|= 2.79
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473946766869  LUMO = 1.61734199899638
  mo_energy =
[-0.90447395  1.617342    7.63488643 18.23403916 36.28621629 61.80146519]
E1 = -3.8663361947681243  E_coul = 1.028693356063338
cycle= 50 E= -2.83764283870479  delta_E= -1.57e-06  |g|= 5.86e-05  |ddm|= 3.46
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8663361947681243  E_coul = 1.028693356063338

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904474741341916  LUMO = 1.61732985139078
  mo_energy =
[-0.90447474  1.61732985  7.63482368 18.23382055 36.28586295 61.80072606]
E1 = -3.866337276934835  E_coul = 1.0286949223263369
Extra cycle  E= -2.8376423546085  delta_E= 4.84e-07  |g|= 3.56e-05  |ddm|= 15.3
    CPU time for scf_cycle      0.51 sec, wall time      0.51 sec
exp = [6.39063696 5.63431858 4.96075394 4.25881617 3.85153788 0.37935152]
E = -2.8376423546084983
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:25 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.39063747456        1
[INPUT] 0    0    [1    /1   ]  5.63431963373        1
[INPUT] 0    0    [1    /1   ]  4.96075422074        1
[INPUT] 0    0    [1    /1   ]  4.25881618246        1
[INPUT] 0    0    [1    /1   ]  3.85153871237        1
[INPUT] 0    0    [1    /1   ]  0.379351453351       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.390637474555517, 1.0]], [0, [5.634319633727928, 1.0]], [0, [4.960754220741663, 1.0]], [0, [4.258816182462937, 1.0]], [0, [3.8515387123665583, 1.0]], [0, [0.37935145335065756, 1.0]]]}
ecp = {}
CPU time:        82.07
Set gradient conv threshold to 3.16228e-05
cond(S) = 973466535.0320837

WARN: Singularity detected in overlap matrix (condition number = 9.73e+08). SCF may be inaccurate and hard to converge.

E1 = -3.856568206123625  E_coul = 1.0242421358081386
init E= -2.83232607031549
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906688275964903  LUMO = 1.61349348558635
  mo_energy =
[-0.90668828  1.61349349  7.63082829 18.23181741 36.28536316 61.80512831]
E1 = -3.866581507676471  E_coul = 1.0289462698416765
cycle= 1 E= -2.83763523783479  delta_E= -0.00531  |g|= 0.00599  |ddm|= 9.31e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.02 sec
  HOMO = -0.904345356992492  LUMO = 1.61749753292866
  mo_energy =
[-0.90434536  1.61749753  7.635611   18.23607598 36.28927542 61.80729517]
E1 = -3.866327847737682  E_coul = 1.0286952869880934
cycle= 2 E= -2.83763256074959  delta_E= 2.68e-06  |g|= 0.000523  |ddm|=  626
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904475901906845  LUMO = 1.6175303663546
  mo_energy =
[-0.9044759   1.61753037  7.6358942  18.23737399 36.29136918 61.81172028]
E1 = -3.866315732955386  E_coul = 1.0286820501541754
cycle= 3 E= -2.83763368280121  delta_E= -1.12e-06  |g|= 0.000116  |ddm|= 45.8
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.90447579535072  LUMO = 1.61749879908939
  mo_energy =
[-0.9044758   1.6174988   7.63572856 18.23683635 36.29055414 61.81018174]
E1 = -3.8663191539189414  E_coul = 1.0286816712277644
cycle= 4 E= -2.83763748269118  delta_E= -3.8e-06  |g|= 0.000346  |ddm|=   37
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904478125366604  LUMO = 1.61742551368301
  mo_energy =
[-0.90447813  1.61742551  7.63535331 18.2355026  36.28837906 61.80521941]
E1 = -3.866326522603622  E_coul = 1.0286911973356072
cycle= 5 E= -2.83763532526801  delta_E= 2.16e-06  |g|= 0.000242  |ddm|=  101
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475157484218  LUMO = 1.61744271342873
  mo_energy =
[-0.90447516  1.61744271  7.63543381 18.23579992 36.28888256 61.80646252]
E1 = -3.866325398716102  E_coul = 1.0286882302298042
cycle= 6 E= -2.8376371684863  delta_E= -1.84e-06  |g|= 1.21e-05  |ddm|= 19.5
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474866514597  LUMO = 1.61744088818182
  mo_energy =
[-0.90447487  1.61744089  7.63542365 18.2357686  36.28884006 61.80638085]
E1 = -3.866325673116928  E_coul = 1.0286884275602528
cycle= 7 E= -2.83763724555668  delta_E= -7.71e-08  |g|= 1.5e-05  |ddm|= 2.96
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474727621425  LUMO = 1.6174404753026
  mo_energy =
[-0.90447473  1.61744048  7.63542202 18.23575604 36.28881533 61.80626943]
E1 = -3.866325780331243  E_coul = 1.0286905494095078
cycle= 8 E= -2.83763523092174  delta_E= 2.01e-06  |g|= 0.000185  |ddm|= 1.42
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474174396994  LUMO = 1.61744845340506
  mo_energy =
[-0.90447417  1.61744845  7.63546153 18.23590012 36.28905375 61.80682334]
E1 = -3.8663250456154867  E_coul = 1.0286899033962702
cycle= 9 E= -2.83763514221922  delta_E= 8.87e-08  |g|= 0.00015  |ddm|= 10.6
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474839704709  LUMO = 1.61744833080016
  mo_energy =
[-0.90447484  1.61744833  7.63546265 18.23590204 36.28905169 61.80680294]
E1 = -3.8663248875500296  E_coul = 1.0286893697832262
cycle= 10 E= -2.8376355177668  delta_E= -3.76e-07  |g|= 0.000112  |ddm|= 1.05
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473909303436  LUMO = 1.61745917370103
  mo_energy =
[-0.90447391  1.61745917  7.63551648 18.23609321 36.2893652  61.8075205 ]
E1 = -3.866323952692019  E_coul = 1.028690206337722
cycle= 11 E= -2.8376337463543  delta_E= 1.77e-06  |g|= 0.000229  |ddm|= 13.7
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473485584497  LUMO = 1.61746841515017
  mo_energy =
[-0.90447349  1.61746842  7.63556274 18.23625792 36.28963168 61.80816312]
E1 = -3.866323044497689  E_coul = 1.0286873864333559
cycle= 12 E= -2.83763565806433  delta_E= -1.91e-06  |g|= 1.2e-05  |ddm|= 12.6
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447324867124  LUMO = 1.61747100470623
  mo_energy =
[-0.90447325  1.617471    7.63557631 18.2362968  36.28968769 61.80824961]
E1 = -3.86632285079959  E_coul = 1.0286869168074764
cycle= 13 E= -2.83763593399211  delta_E= -2.76e-07  |g|= 4.12e-05  |ddm|= 2.57
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473423140495  LUMO = 1.61746921313547
  mo_energy =
[-0.90447342  1.61746921  7.63556791 18.23626425 36.28963304 61.80810676]
E1 = -3.866323009716683  E_coul = 1.0286875185174822
cycle= 14 E= -2.8376354911992  delta_E= 4.43e-07  |g|= 1.4e-05  |ddm|= 2.42
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473271610568  LUMO = 1.61747138852283
  mo_energy =
[-0.90447327  1.61747139  7.63557861 18.23630306 36.28969604 61.80825362]
E1 = -3.8663228081386705  E_coul = 1.0286882163023223
cycle= 15 E= -2.83763459183635  delta_E= 8.99e-07  |g|= 8.53e-05  |ddm|= 2.88
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472883074207  LUMO = 1.6174786746944
  mo_energy =
[-0.90447288  1.61747867  7.63561478 18.23643603 36.28991561 61.80878283]
E1 = -3.8663220994543313  E_coul = 1.0286855436074172
cycle= 16 E= -2.83763655584691  delta_E= -1.96e-06  |g|= 0.00012  |ddm|=   10
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472889356996  LUMO = 1.61747999970151
  mo_energy =
[-0.90447289  1.61748     7.63562178 18.23645727 36.28994585 61.80885673]
E1 = -3.866321958665849  E_coul = 1.0286837603485994
cycle= 17 E= -2.83763819831725  delta_E= -1.64e-06  |g|= 0.0003  |ddm|= 1.72
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472896117441  LUMO = 1.6174819162686
  mo_energy =
[-0.9044729   1.61748192  7.63563224 18.23648721 36.28998727 61.80891956]
E1 = -3.8663217647343537  E_coul = 1.0286869777971066
cycle= 18 E= -2.83763478693725  delta_E= 3.41e-06  |g|= 1.9e-05  |ddm|= 2.28
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904471090832283  LUMO = 1.61751297337841
  mo_energy =
[-0.90447109  1.61751297  7.63578793 18.2370267  36.29084597 61.81087289]
E1 = -3.866318859395213  E_coul = 1.028683428440346
cycle= 19 E= -2.83763543095487  delta_E= -6.44e-07  |g|= 0.000189  |ddm|= 40.3
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473640679636  LUMO = 1.61746631087016
  mo_energy =
[-0.90447364  1.61746631  7.6355562  18.23619798 36.28950406 61.80763981]
E1 = -3.866323351293698  E_coul = 1.0286896793380036
cycle= 20 E= -2.83763367195569  delta_E= 1.76e-06  |g|= 0.00022  |ddm|= 62.8
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472943717404  LUMO = 1.61747863938654
  mo_energy =
[-0.90447294  1.61747864  7.63561706 18.23643625 36.28991271 61.80867281]
E1 = -3.866322134053875  E_coul = 1.0286868426469629
cycle= 21 E= -2.83763529140691  delta_E= -1.62e-06  |g|= 1.14e-05  |ddm|= 17.8
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472839380733  LUMO = 1.61748105379785
  mo_energy =
[-0.90447284  1.61748105  7.63562895 18.23648245 36.28999017 61.80886674]
E1 = -3.8663218865421127  E_coul = 1.0286850131419547
cycle= 22 E= -2.83763687340016  delta_E= -1.58e-06  |g|= 0.000166  |ddm|= 3.54
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472961284563  LUMO = 1.6174787566701
  mo_energy =
[-0.90447296  1.61747876  7.63561727 18.23645016 36.28994899 61.80878947]
E1 = -3.866322091551532  E_coul = 1.0286859694132755
cycle= 23 E= -2.83763612213826  delta_E= 7.51e-07  |g|= 9.48e-05  |ddm|= 2.49
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447340383595  LUMO = 1.61747108979547
  mo_energy =
[-0.9044734   1.61747109  7.63557833 18.23631689 36.28973639 61.80834184]
E1 = -3.866322798082452  E_coul = 1.0286869540054324
cycle= 24 E= -2.83763584407702  delta_E= 2.78e-07  |g|= 2.84e-05  |ddm|= 9.75
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473339650883  LUMO = 1.61747268960596
  mo_energy =
[-0.90447334  1.61747269  7.63558675 18.23634084 36.28976957 61.80838769]
E1 = -3.866322653776271  E_coul = 1.0286860264889421
cycle= 25 E= -2.83763662728733  delta_E= -7.83e-07  |g|= 0.000105  |ddm|= 1.77
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473296659145  LUMO = 1.61747323285014
  mo_energy =
[-0.9044733   1.61747323  7.63558827 18.23635544 36.28980191 61.80853018]
E1 = -3.866322573043193  E_coul = 1.0286853364589656
cycle= 26 E= -2.83763723658423  delta_E= -6.09e-07  |g|= 0.00018  |ddm|= 1.44
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473786024756  LUMO = 1.61746429826253
  mo_energy =
[-0.90447379  1.6174643   7.63554373 18.23619119 36.28952798 61.80786538]
E1 = -3.866323436583001  E_coul = 1.0286865899230837
cycle= 27 E= -2.83763684665992  delta_E= 3.9e-07  |g|= 8.82e-05  |ddm|= 12.3
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473504430792  LUMO = 1.61746939696042
  mo_energy =
[-0.9044735   1.6174694   7.63556662 18.23629256 36.28970866 61.80843835]
E1 = -3.866322879153364  E_coul = 1.0286866180939387
cycle= 28 E= -2.83763626105943  delta_E= 5.86e-07  |g|= 6.97e-05  |ddm|= 8.36
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447488679232  LUMO = 1.617445988448
  mo_energy =
[-0.90447489  1.61744599  7.63544909 18.23586423 36.28899659 61.80676769]
E1 = -3.866325091840053  E_coul = 1.028687218805492
cycle= 29 E= -2.83763787303456  delta_E= -1.61e-06  |g|= 9.62e-05  |ddm|= 31.6
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475134588458  LUMO = 1.6174395829952
  mo_energy =
[-0.90447513  1.61743958  7.63541633 18.23575784 36.28883953 61.80646114]
E1 = -3.8663257099090065  E_coul = 1.0286913621414577
cycle= 30 E= -2.83763434776755  delta_E= 3.53e-06  |g|= 0.000264  |ddm|= 8.06
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474218342576  LUMO = 1.61745673287287
  mo_energy =
[-0.90447422  1.61745673  7.63550384 18.23605791 36.28931724 61.80747608]
E1 = -3.8663241102404373  E_coul = 1.028687829722858
cycle= 31 E= -2.83763628051758  delta_E= -1.93e-06  |g|= 5.93e-06  |ddm|=   22
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474246503553  LUMO = 1.61745607467009
  mo_energy =
[-0.90447425  1.61745607  7.63550023 18.23604876 36.28930592 61.80746301]
E1 = -3.8663241652579012  E_coul = 1.028689399344367
cycle= 32 E= -2.83763476591353  delta_E= 1.51e-06  |g|= 0.000145  |ddm|= 0.638
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474128125234  LUMO = 1.61745837601369
  mo_energy =
[-0.90447413  1.61745838  7.63551159 18.23608948 36.28937186 61.80763325]
E1 = -3.8663239398345586  E_coul = 1.0286875245497562
cycle= 33 E= -2.8376364152848  delta_E= -1.65e-06  |g|= 1.75e-05  |ddm|= 3.15
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474181442192  LUMO = 1.61745751061405
  mo_energy =
[-0.90447418  1.61745751  7.63550734 18.23607557 36.28935055 61.80758309]
E1 = -3.8663240203051976  E_coul = 1.028688168412421
cycle= 34 E= -2.83763585189278  delta_E= 5.63e-07  |g|= 2.24e-05  |ddm|= 1.08
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474083961237  LUMO = 1.61745962055853
  mo_energy =
[-0.90447408  1.61745962  7.63551841 18.23610832 36.28939698 61.80765894]
E1 = -3.866323831526709  E_coul = 1.028688473697396
cycle= 35 E= -2.83763535782931  delta_E= 4.94e-07  |g|= 7.34e-05  |ddm|= 2.38
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473897970789  LUMO = 1.61746341191703
  mo_energy =
[-0.9044739   1.61746341  7.63553802 18.23617346 36.28949836 61.80786361]
E1 = -3.8663234802653395  E_coul = 1.0286872680728545
cycle= 36 E= -2.83763621219248  delta_E= -8.54e-07  |g|= 2.92e-05  |ddm|= 4.74
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473882251415  LUMO = 1.61746361977076
  mo_energy =
[-0.90447388  1.61746362  7.63553964 18.23617517 36.28949928 61.80784198]
E1 = -3.866323476833157  E_coul = 1.0286866951629006
cycle= 37 E= -2.83763678167026  delta_E= -5.69e-07  |g|= 7.88e-05  |ddm|= 0.0531
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473715765511  LUMO = 1.61746665179915
  mo_energy =
[-0.90447372  1.61746665  7.63555477 18.23623126 36.28959251 61.80805896]
E1 = -3.8663231839265126  E_coul = 1.028688342196177
cycle= 38 E= -2.83763484173034  delta_E= 1.94e-06  |g|= 8.37e-05  |ddm|= 4.18
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473707484233  LUMO = 1.61746655024032
  mo_energy =
[-0.90447371  1.61746655  7.63555335 18.23623074 36.28959456 61.80810708]
E1 = -3.8663231757101832  E_coul = 1.0286856581011643
cycle= 39 E= -2.83763751760902  delta_E= -2.68e-06  |g|= 0.000157  |ddm|= 0.251
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473419615798  LUMO = 1.61747265463206
  mo_energy =
[-0.90447342  1.61747265  7.63558526 18.23633076 36.28974427 61.80839151]
E1 = -3.8663226210814323  E_coul = 1.02868634360039
cycle= 40 E= -2.83763627748104  delta_E= 1.24e-06  |g|= 9.19e-05  |ddm|= 7.25
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473859011986  LUMO = 1.61746393632446
  mo_energy =
[-0.90447386  1.61746394  7.63554095 18.23618721 36.28952578 61.80791485]
E1 = -3.866323434286337  E_coul = 1.0286886079163033
cycle= 41 E= -2.83763482637003  delta_E= 1.45e-06  |g|= 9.9e-05  |ddm|= 10.8
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473458528762  LUMO = 1.61747219324187
  mo_energy =
[-0.90447346  1.61747219  7.6355841  18.23632042 36.2897207  61.80824484]
E1 = -3.8663226908051485  E_coul = 1.0286867134008835
cycle= 42 E= -2.83763597740426  delta_E= -1.15e-06  |g|= 3.61e-05  |ddm|= 9.61
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473468262342  LUMO = 1.61747190203769
  mo_energy =
[-0.90447347  1.6174719   7.63558204 18.23633348 36.28976469 61.80843365]
E1 = -3.866322681321628  E_coul = 1.0286863080318276
cycle= 43 E= -2.8376363732898  delta_E= -3.96e-07  |g|= 7.14e-05  |ddm|= 0.945
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473669446926  LUMO = 1.61746905310993
  mo_energy =
[-0.90447367  1.61746905  7.63556946 18.23627323 36.28965334 61.80808993]
E1 = -3.8663229919160007  E_coul = 1.0286865310009317
cycle= 44 E= -2.83763646091507  delta_E= -8.76e-08  |g|= 6.71e-05  |ddm|= 4.91
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473509452391  LUMO = 1.61747136223579
  mo_energy =
[-0.90447351  1.61747136  7.63557929 18.23632757 36.28975909 61.80842521]
E1 = -3.8663227274025687  E_coul = 1.028687476390056
cycle= 45 E= -2.83763525101251  delta_E= 1.21e-06  |g|= 2.38e-05  |ddm|= 4.39
    CPU time for cycle= 45      0.01 sec, wall time      0.02 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472657151887  LUMO = 1.6174882948658
  mo_energy =
[-0.90447266  1.61748829  7.63566648 18.23661938 36.29021746 61.80939006]
E1 = -3.8663211551820416  E_coul = 1.028686039981298
cycle= 46 E= -2.83763511520074  delta_E= 1.36e-07  |g|= 5.18e-05  |ddm|= 21.4
    CPU time for cycle= 46      0.02 sec, wall time      0.02 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474438913297  LUMO = 1.61745169734364
  mo_energy =
[-0.90447444  1.6174517   7.63547602 18.23599904 36.28926527 61.80757243]
E1 = -3.866324507692037  E_coul = 1.0286893577050635
cycle= 47 E= -2.83763514998697  delta_E= -3.48e-08  |g|= 0.000116  |ddm|= 44.7
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473508369263  LUMO = 1.61747046396717
  mo_energy =
[-0.90447351  1.61747046  7.63557362 18.23630559 36.2897247  61.80841588]
E1 = -3.8663228079730074  E_coul = 1.028687344684611
cycle= 48 E= -2.8376354632884  delta_E= -3.13e-07  |g|= 1.06e-05  |ddm|= 22.3
    CPU time for cycle= 48      0.01 sec, wall time      0.02 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473438807388  LUMO = 1.61747145629666
  mo_energy =
[-0.90447344  1.61747146  7.63557793 18.23632846 36.28976886 61.80855444]
E1 = -3.8663226959874937  E_coul = 1.0286856743749575
cycle= 49 E= -2.83763702161254  delta_E= -1.56e-06  |g|= 0.000153  |ddm|= 1.84
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473795278286  LUMO = 1.61746464481542
  mo_energy =
[-0.9044738   1.61746464  7.63554319 18.23620809 36.28957674 61.80814339]
E1 = -3.866323334699069  E_coul = 1.0286864653262675
cycle= 50 E= -2.8376368693728  delta_E= 1.52e-07  |g|= 0.000108  |ddm|= 8.81
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.866323334699069  E_coul = 1.0286864653262675

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904475202112553  LUMO = 1.61744593133781
  mo_energy =
[-0.9044752   1.61744593  7.63545237 18.23585816 36.28897415 61.80657438]
E1 = -3.8663250871733528  E_coul = 1.0286888469268305
Extra cycle  E= -2.83763624024652  delta_E= 6.29e-07  |g|= 5.56e-05  |ddm|= 26.1
    CPU time for scf_cycle      0.58 sec, wall time      0.60 sec
exp = [6.39063747 5.63431963 4.96075422 4.25881618 3.85153871 0.37935145]
E = -2.837636240246522
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:26 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.39063752556        1
[INPUT] 0    0    [1    /1   ]  5.6343197388         1
[INPUT] 0    0    [1    /1   ]  4.9607542492         1
[INPUT] 0    0    [1    /1   ]  4.2588161839         1
[INPUT] 0    0    [1    /1   ]  3.85153879588        1
[INPUT] 0    0    [1    /1   ]  0.379351446499       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.390637525562419, 1.0]], [0, [5.634319738799214, 1.0]], [0, [4.960754249199746, 1.0]], [0, [4.258816183897869, 1.0]], [0, [3.851538795883185, 1.0]], [0, [0.3793514464994429, 1.0]]]}
ecp = {}
CPU time:        83.03
Set gradient conv threshold to 3.16228e-05
cond(S) = 973466515.8086257

WARN: Singularity detected in overlap matrix (condition number = 9.73e+08). SCF may be inaccurate and hard to converge.

E1 = -3.856568206728252  E_coul = 1.0242385030904793
init E= -2.83232970363777
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906692110525715  LUMO = 1.61341905901486
  mo_energy =
[-0.90669211  1.61341906  7.63044662 18.23053708 36.2833441  61.80081274]
E1 = -3.866588468463675  E_coul = 1.028949616699245
cycle= 1 E= -2.83763885176443  delta_E= -0.00531  |g|= 0.00599  |ddm|= 9.4e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904345490530987  LUMO = 1.61743338251453
  mo_energy =
[-0.90434549  1.61743338  7.63528072 18.23491181 36.28739581 61.80287091]
E1 = -3.866334859727921  E_coul = 1.0286936768466843
cycle= 2 E= -2.83764118288124  delta_E= -2.33e-06  |g|= 0.000388  |ddm|=  624
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904481311315941  LUMO = 1.61736098535007
  mo_energy =
[-0.90448131  1.61736099  7.63502012 18.23441702 36.28671016 61.80168007]
E1 = -3.8663324487189064  E_coul = 1.0286922959224225
cycle= 3 E= -2.83764015279648  delta_E= 1.03e-06  |g|= 0.000102  |ddm|=   85
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904472030223975  LUMO = 1.61739115049268
  mo_energy =
[-0.90447203  1.61739115  7.63515244 18.23487553 36.28747066 61.80359543]
E1 = -3.866331693345979  E_coul = 1.028689125207065
cycle= 4 E= -2.83764256813891  delta_E= -2.42e-06  |g|= 0.000252  |ddm|=   29
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904476405029002  LUMO = 1.6173450458181
  mo_energy =
[-0.90447641  1.61734505  7.63492587 18.23407758 36.28617076 61.80052935]
E1 = -3.8663355782923716  E_coul = 1.028695290176772
cycle= 5 E= -2.8376402881156  delta_E= 2.28e-06  |g|= 0.000172  |ddm|= 57.8
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474835666469  LUMO = 1.61736048953224
  mo_energy =
[-0.90447484  1.61736049  7.63500311 18.23432764 36.28655599 61.80133703]
E1 = -3.8663343593918187  E_coul = 1.02869322326533
cycle= 6 E= -2.83764113612649  delta_E= -8.48e-07  |g|= 2.72e-05  |ddm|= 17.4
    CPU time for cycle= 6      0.01 sec, wall time      0.02 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474577541258  LUMO = 1.61736302103016
  mo_energy =
[-0.90447458  1.61736302  7.63501636 18.23435862 36.28659092 61.80136179]
E1 = -3.866334187043013  E_coul = 1.0286940647910452
cycle= 7 E= -2.83764012225197  delta_E= 1.01e-06  |g|= 0.000133  |ddm|= 2.02
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474179109276  LUMO = 1.61736881066479
  mo_energy =
[-0.90447418  1.61736881  7.63504451 18.23447022 36.2867845  61.80185289]
E1 = -3.866333631108906  E_coul = 1.0286920007567257
cycle= 8 E= -2.83764163035218  delta_E= -1.51e-06  |g|= 6.06e-05  |ddm|= 8.32
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474314872335  LUMO = 1.61736695758135
  mo_energy =
[-0.90447431  1.61736696  7.63503579 18.23443054 36.28671024 61.80164938]
E1 = -3.8663338170123334  E_coul = 1.02869325367246
cycle= 9 E= -2.83764056333987  delta_E= 1.07e-06  |g|= 6.36e-05  |ddm|= 2.98
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447421053068  LUMO = 1.61736869870189
  mo_energy =
[-0.90447421  1.6173687   7.63504402 18.23446294 36.28676564 61.80180027]
E1 = -3.866333642105341  E_coul = 1.0286931984299357
cycle= 10 E= -2.83764044367541  delta_E= 1.2e-07  |g|= 5.21e-05  |ddm|= 2.55
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474200242269  LUMO = 1.61737021038233
  mo_energy =
[-0.9044742   1.61737021  7.63505279 18.23448376 36.28679012 61.80179493]
E1 = -3.8663335113420496  E_coul = 1.0286908684681644
cycle= 11 E= -2.83764264287389  delta_E= -2.2e-06  |g|= 0.000151  |ddm|= 1.38
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474301404924  LUMO = 1.61736741523309
  mo_energy =
[-0.9044743   1.61736742  7.63503854 18.23443187 36.28670454 61.80159744]
E1 = -3.8663337902040755  E_coul = 1.02869343607816
cycle= 12 E= -2.83764035412592  delta_E= 2.29e-06  |g|= 7.31e-05  |ddm|= 3.89
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474121473238  LUMO = 1.61737106183109
  mo_energy =
[-0.90447412  1.61737106  7.63505787 18.23448778 36.28678306 61.80171263]
E1 = -3.866333472914912  E_coul = 1.0286909855628243
cycle= 13 E= -2.83764248735209  delta_E= -2.13e-06  |g|= 0.000133  |ddm|= 3.95
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474299392842  LUMO = 1.61736760585182
  mo_energy =
[-0.9044743   1.61736761  7.63503988 18.23442913 36.28669238 61.80153828]
E1 = -3.866333786423776  E_coul = 1.0286941997419057
cycle= 14 E= -2.83763958668187  delta_E= 2.9e-06  |g|= 0.000158  |ddm|= 4.22
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473873071454  LUMO = 1.61737527147973
  mo_energy =
[-0.90447387  1.61737527  7.63507786 18.23457583 36.28694287 61.80215687]
E1 = -3.866333035436227  E_coul = 1.0286919056494943
cycle= 15 E= -2.83764112978673  delta_E= -1.54e-06  |g|= 3.79e-05  |ddm|=   11
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473704793505  LUMO = 1.61737860021215
  mo_energy =
[-0.9044737   1.6173786   7.63509514 18.23462969 36.28702222 61.80230181]
E1 = -3.8663327347809893  E_coul = 1.0286939351219713
cycle= 16 E= -2.83763879965902  delta_E= 2.33e-06  |g|= 0.000163  |ddm|= 3.92
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474024293529  LUMO = 1.61737241372178
  mo_energy =
[-0.90447402  1.61737241  7.63506352 18.23452203 36.28685223 61.80193476]
E1 = -3.8663333136949682  E_coul = 1.0286915250954212
cycle= 17 E= -2.83764178859955  delta_E= -2.99e-06  |g|= 8.01e-05  |ddm|= 7.93
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474217987404  LUMO = 1.61736898044844
  mo_energy =
[-0.90447422  1.61736898  7.63504689 18.23445954 36.28674807 61.80166099]
E1 = -3.8663336528389496  E_coul = 1.028694658272376
cycle= 18 E= -2.83763899456657  delta_E= 2.79e-06  |g|= 0.0002  |ddm|= 4.86
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473831274571  LUMO = 1.61737634482481
  mo_energy =
[-0.90447383  1.61737634  7.63508388 18.23459926 36.28698484 61.80224038]
E1 = -3.86633293461938  E_coul = 1.0286926004116772
cycle= 19 E= -2.8376403342077  delta_E= -1.34e-06  |g|= 4.32e-05  |ddm|= 10.4
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473505541139  LUMO = 1.617382765469
  mo_energy =
[-0.90447351  1.61738277  7.63511695 18.23471145 36.28716266 61.80262047]
E1 = -3.8663323378375196  E_coul = 1.0286897038769942
cycle= 20 E= -2.83764263396053  delta_E= -2.3e-06  |g|= 0.000218  |ddm|= 8.18
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473218448331  LUMO = 1.61738740935681
  mo_energy =
[-0.90447322  1.61738741  7.63513837 18.23480769 36.28733906 61.80314473]
E1 = -3.8663318461608203  E_coul = 1.0286908110489401
cycle= 21 E= -2.83764103511188  delta_E= 1.6e-06  |g|= 9.31e-05  |ddm|= 7.62
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472912316503  LUMO = 1.61739352178756
  mo_energy =
[-0.90447291  1.61739352  7.63517012 18.2349135  36.28750608 61.80348731]
E1 = -3.8663312837237918  E_coul = 1.0286905656277132
cycle= 22 E= -2.83764071809608  delta_E= 3.17e-07  |g|= 8.51e-05  |ddm|= 7.64
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473249569466  LUMO = 1.61738731157769
  mo_energy =
[-0.90447325  1.61738731  7.63514017 18.23478708 36.28728284 61.80290669]
E1 = -3.8663319221062  E_coul = 1.0286922441861954
cycle= 23 E= -2.83763967792  delta_E= 1.04e-06  |g|= 4.01e-05  |ddm|= 9.61
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473147013758  LUMO = 1.61738896838956
  mo_energy =
[-0.90447315  1.61738897  7.63514795 18.23482262 36.28734874 61.80308357]
E1 = -3.8663317490301026  E_coul = 1.0286917759419634
cycle= 24 E= -2.83763997308814  delta_E= -2.95e-07  |g|= 8.73e-06  |ddm|= 2.71
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473551305791  LUMO = 1.61738096865757
  mo_energy =
[-0.90447355  1.61738097  7.63510674 18.23468961 36.28714596 61.8026713 ]
E1 = -3.8663324839091295  E_coul = 1.0286921501315416
cycle= 25 E= -2.83764033377759  delta_E= -3.61e-07  |g|= 9.64e-06  |ddm|= 9.78
    CPU time for cycle= 25      0.02 sec, wall time      0.02 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472841161902  LUMO = 1.61739451967908
  mo_energy =
[-0.90447284  1.61739452  7.6351755  18.23493011 36.28753366 61.80354775]
E1 = -3.866331201843942  E_coul = 1.0286899262619509
cycle= 26 E= -2.83764127558199  delta_E= -9.42e-07  |g|= 0.000144  |ddm|= 17.8
    CPU time for cycle= 26      0.02 sec, wall time      0.02 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473888550376  LUMO = 1.61737305083626
  mo_energy =
[-0.90447389  1.61737305  7.63506462 18.2345474  36.28692157 61.80225175]
E1 = -3.8663332117648106  E_coul = 1.0286887899210972
cycle= 27 E= -2.83764442184371  delta_E= -3.15e-06  |g|= 0.000346  |ddm|= 27.7
    CPU time for cycle= 27      0.02 sec, wall time      0.02 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904477269261009  LUMO = 1.61731273775378
  mo_energy =
[-0.90447727  1.61731274  7.63476359 18.23344086 36.28507767 61.79785691]
E1 = -3.8663389981822704  E_coul = 1.0286987968472185
cycle= 28 E= -2.83764020133505  delta_E= 4.22e-06  |g|= 0.000361  |ddm|= 82.6
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474060450847  LUMO = 1.61737263818815
  mo_energy =
[-0.90447406  1.61737264  7.63506619 18.23451627 36.28682946 61.80181618]
E1 = -3.8663333231194157  E_coul = 1.0286911033523891
cycle= 29 E= -2.83764221976703  delta_E= -2.02e-06  |g|= 0.000107  |ddm|= 79.5
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474215933175  LUMO = 1.61736932430977
  mo_energy =
[-0.90447422  1.61736932  7.63504873 18.23446416 36.28675423 61.8016885 ]
E1 = -3.866333617687127  E_coul = 1.028693251062418
cycle= 30 E= -2.83764036662471  delta_E= 1.85e-06  |g|= 5.99e-05  |ddm|= 3.76
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474162199329  LUMO = 1.61737052524307
  mo_energy =
[-0.90447416  1.61737053  7.6350551  18.23448011 36.28677293 61.80170416]
E1 = -3.8663335153089053  E_coul = 1.0286917773343172
cycle= 31 E= -2.83764173797459  delta_E= -1.37e-06  |g|= 6.43e-05  |ddm|= 1.16
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474416394974  LUMO = 1.61736561202503
  mo_energy =
[-0.90447442  1.61736561  7.63502966 18.23439465 36.28663755 61.80142479]
E1 = -3.8663339672511405  E_coul = 1.0286939866112763
cycle= 32 E= -2.83763998063986  delta_E= 1.76e-06  |g|= 0.000123  |ddm|= 6.18
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474445211581  LUMO = 1.61736473800476
  mo_energy =
[-0.90447445  1.61736474  7.6350245  18.23438472 36.28662962 61.80145318]
E1 = -3.8663340310612804  E_coul = 1.0286911839247461
cycle= 33 E= -2.83764284713653  delta_E= -2.87e-06  |g|= 0.000134  |ddm|= 0.581
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447481620585  LUMO = 1.61735782912832
  mo_energy =
[-0.90447482  1.61735783  7.63498957 18.23426348 36.28643511 61.80101897]
E1 = -3.8663346821925315  E_coul = 1.0286940513586178
cycle= 34 E= -2.83764063083391  delta_E= 2.22e-06  |g|= 8.85e-05  |ddm|= 9.02
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474927257805  LUMO = 1.61735589406524
  mo_energy =
[-0.90447493  1.61735589  7.63498041 18.23422757 36.28637395 61.80085142]
E1 = -3.8663348767066896  E_coul = 1.0286948565310818
cycle= 35 E= -2.83764002017561  delta_E= 6.11e-07  |g|= 0.000167  |ddm|= 2.83
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474331071671  LUMO = 1.61736695456375
  mo_energy =
[-0.90447433  1.61736695  7.63503632 18.23442799 36.28670315 61.80159984]
E1 = -3.86633382748301  E_coul = 1.0286909513948075
cycle= 36 E= -2.8376428760882  delta_E= -2.86e-06  |g|= 0.000151  |ddm|= 14.8
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474676009341  LUMO = 1.61736036924051
  mo_energy =
[-0.90447468  1.61736037  7.6350028  18.23431473 36.28652426 61.80121201]
E1 = -3.8663344420043475  E_coul = 1.028696060721139
cycle= 37 E= -2.83763838128321  delta_E= 4.49e-06  |g|= 0.000294  |ddm|= 8.39
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474471163719  LUMO = 1.61736470418949
  mo_energy =
[-0.90447447  1.6173647   7.63502542 18.23438291 36.28662198 61.80137514]
E1 = -3.8663340529523755  E_coul = 1.0286922483449747
cycle= 38 E= -2.8376418046074  delta_E= -3.42e-06  |g|= 3.41e-05  |ddm|= 4.96
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474942592492  LUMO = 1.617354886635
  mo_energy =
[-0.90447494  1.61735489  7.63497436 18.23422432 36.28638759 61.80094398]
E1 = -3.866334943614861  E_coul = 1.0286945908715175
cycle= 39 E= -2.83764035274334  delta_E= 1.45e-06  |g|= 0.000143  |ddm|= 11.6
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475027645362  LUMO = 1.61735291173949
  mo_energy =
[-0.90447503  1.61735291  7.63496416 18.23419567 36.28635011 61.80087986]
E1 = -3.866335124733297  E_coul = 1.0286935690919705
cycle= 40 E= -2.83764155564133  delta_E= -1.2e-06  |g|= 2.87e-05  |ddm|= 2.21
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447530755425  LUMO = 1.61734740528405
  mo_energy =
[-0.90447531  1.61734741  7.63493588 18.23410501 36.28621263 61.8006045 ]
E1 = -3.8663356303461494  E_coul = 1.0286950086578421
cycle= 41 E= -2.83764062168831  delta_E= 9.34e-07  |g|= 0.000138  |ddm|=  6.7
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474529680046  LUMO = 1.6173618226323
  mo_energy =
[-0.90447453  1.61736182  7.63500886 18.23436169 36.28662811 61.8015355 ]
E1 = -3.8663342679916552  E_coul = 1.028694336980188
cycle= 42 E= -2.83763993101147  delta_E= 6.91e-07  |g|= 0.000128  |ddm|=   19
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474303578555  LUMO = 1.61736631387324
  mo_energy =
[-0.9044743   1.61736631  7.63503175 18.23443984 36.28675245 61.80179943]
E1 = -3.866333846755852  E_coul = 1.028693525963486
cycle= 43 E= -2.83764032079237  delta_E= -3.9e-07  |g|= 6.48e-05  |ddm|= 5.77
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474141669748  LUMO = 1.61737035595456
  mo_energy =
[-0.90447414  1.61737036  7.63505343 18.23449393 36.28681612 61.80186588]
E1 = -3.8663334981503055  E_coul = 1.0286926445772469
cycle= 44 E= -2.83764085357306  delta_E= -5.33e-07  |g|= 1.48e-05  |ddm|= 3.98
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473598864009  LUMO = 1.61738071901396
  mo_energy =
[-0.9044736   1.61738072  7.63510554 18.23467225 36.28709933 61.80253715]
E1 = -3.866332516840673  E_coul = 1.0286931421143257
cycle= 45 E= -2.83763937472635  delta_E= 1.48e-06  |g|= 0.00011  |ddm|= 13.5
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473576575198  LUMO = 1.61738099021003
  mo_energy =
[-0.90447358  1.61738099  7.63510627 18.23468718 36.28713528 61.80264762]
E1 = -3.8663324659687306  E_coul = 1.0286926473593334
cycle= 46 E= -2.8376398186094  delta_E= -4.44e-07  |g|= 6.15e-05  |ddm|= 1.15
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447337828007  LUMO = 1.61738514895983
  mo_energy =
[-0.90447338  1.61738515  7.63512736 18.23475706 36.28724382 61.80290296]
E1 = -3.8663320715489045  E_coul = 1.028690781542314
cycle= 47 E= -2.83764129000659  delta_E= -1.47e-06  |g|= 9.89e-05  |ddm|= 5.31
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473629386174  LUMO = 1.61738083459256
  mo_energy =
[-0.90447363  1.61738083  7.63510655 18.23467601 36.28710571 61.80253402]
E1 = -3.866332502423883  E_coul = 1.0286913879502877
cycle= 48 E= -2.8376411144736  delta_E= 1.76e-07  |g|= 7.18e-05  |ddm|= 6.28
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473567554339  LUMO = 1.61738250051335
  mo_energy =
[-0.90447357  1.6173825   7.63511591 18.23469665 36.28712667 61.80252189]
E1 = -3.8663323696911367  E_coul = 1.0286912839831837
cycle= 49 E= -2.83764108570795  delta_E= 2.88e-08  |g|= 6.06e-05  |ddm|= 1.38
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473421599603  LUMO = 1.61738541555049
  mo_energy =
[-0.90447342  1.61738542  7.63513098 18.23474195 36.28719212 61.80264514]
E1 = -3.866332106446005  E_coul = 1.0286918327205814
cycle= 50 E= -2.83764027372542  delta_E= 8.12e-07  |g|= 3.38e-06  |ddm|= 3.38
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.866332106446005  E_coul = 1.0286918327205814

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904474220477281  LUMO = 1.6173851851194
  mo_energy =
[-0.90447422  1.61738519  7.63513347 18.23473935 36.28717512 61.80250962]
E1 = -3.8663319597859798  E_coul = 1.0286906614669686
Extra cycle  E= -2.83764129831901  delta_E= -1.02e-06  |g|= 9.5e-05  |ddm|= 0.446
    CPU time for scf_cycle      0.59 sec, wall time      0.61 sec
exp = [6.39063753 5.63431974 4.96075425 4.25881618 3.8515388  0.37935145]
E = -2.837641298319011
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:27 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.39063753066        1
[INPUT] 0    0    [1    /1   ]  5.63431974931        1
[INPUT] 0    0    [1    /1   ]  4.96075425205        1
[INPUT] 0    0    [1    /1   ]  4.25881618404        1
[INPUT] 0    0    [1    /1   ]  3.85153880423        1
[INPUT] 0    0    [1    /1   ]  0.379351445814       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.39063753066311, 1.0]], [0, [5.634319749306343, 1.0]], [0, [4.960754252045554, 1.0]], [0, [4.258816184041362, 1.0]], [0, [3.8515388042348473, 1.0]], [0, [0.37935144581432145, 1.0]]]}
ecp = {}
CPU time:        83.98
Set gradient conv threshold to 3.16228e-05
cond(S) = 973466456.3193603

WARN: Singularity detected in overlap matrix (condition number = 9.73e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8565682060238986  E_coul = 1.0242404911122405
init E= -2.83232771491166
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906689999038863  LUMO = 1.61346242093682
  mo_energy =
[-0.90669     1.61346242  7.6306747  18.231243   36.28441389 61.80277029]
E1 = -3.8665845476757577  E_coul = 1.0289477672091363
cycle= 1 E= -2.83763678046662  delta_E= -0.00531  |g|= 0.00599  |ddm|= 9.35e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.90434537969875  LUMO = 1.61747101303038
  mo_energy =
[-0.90434538  1.61747101  7.63547524 18.23555552 36.28840903 61.805197  ]
E1 = -3.866330813957433  E_coul = 1.0286923880965075
cycle= 2 E= -2.83763842586093  delta_E= -1.65e-06  |g|= 0.000377  |ddm|=  623
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904480540935285  LUMO = 1.61741400881164
  mo_energy =
[-0.90448054  1.61741401  7.63529687 18.23532325 36.28812145 61.80467757]
E1 = -3.8663270168264154  E_coul = 1.0286905346271733
cycle= 3 E= -2.83763648219924  delta_E= 1.94e-06  |g|= 0.000183  |ddm|= 66.8
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904471142973548  LUMO = 1.61746505250433
  mo_energy =
[-0.90447114  1.61746505  7.63554108 18.2361509  36.28945704 61.80769225]
E1 = -3.866324115662496  E_coul = 1.0286857847289468
cycle= 4 E= -2.83763833093355  delta_E= -1.85e-06  |g|= 0.00022  |ddm|= 56.5
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904475724337192  LUMO = 1.61742651321575
  mo_energy =
[-0.90447572  1.61742651  7.63535681 18.23548189 36.28835026 61.80495428]
E1 = -3.866327182381379  E_coul = 1.0286902200663606
cycle= 5 E= -2.83763696231502  delta_E= 1.37e-06  |g|= 9.7e-05  |ddm|= 47.9
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474833070132  LUMO = 1.61743406941113
  mo_energy =
[-0.90447483  1.61743407  7.63539273 18.23561122 36.28856183 61.80545773]
E1 = -3.866326577967546  E_coul = 1.0286875709024752
cycle= 6 E= -2.83763900706507  delta_E= -2.04e-06  |g|= 0.000116  |ddm|= 9.18
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447511601625  LUMO = 1.61742525394862
  mo_energy =
[-0.90447512  1.61742525  7.63534578 18.23546962 36.28835655 61.80513228]
E1 = -3.8663273955532507  E_coul = 1.0286890866513059
cycle= 7 E= -2.83763830890195  delta_E= 6.98e-07  |g|= 3e-05  |ddm|= 10.3
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475039946743  LUMO = 1.61742381779314
  mo_energy =
[-0.90447504  1.61742382  7.63533798 18.23543898 36.28830255 61.80500937]
E1 = -3.8663275724999693  E_coul = 1.028690969446896
cycle= 8 E= -2.83763660305307  delta_E= 1.71e-06  |g|= 0.000132  |ddm|= 2.36
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474656957905  LUMO = 1.61742910585443
  mo_energy =
[-0.90447466  1.61742911  7.63536478 18.23552701 36.28843802 61.80529143]
E1 = -3.8663271130756587  E_coul = 1.0286884446728701
cycle= 9 E= -2.83763866840279  delta_E= -2.07e-06  |g|= 7.89e-05  |ddm|= 6.33
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474717611797  LUMO = 1.61742683215611
  mo_energy =
[-0.90447472  1.61742683  7.63535296 18.23548308 36.28836362 61.8051216 ]
E1 = -3.8663273458537946  E_coul = 1.0286892554450342
cycle= 10 E= -2.83763809040876  delta_E= 5.78e-07  |g|= 1.09e-05  |ddm|= 3.26
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474743457966  LUMO = 1.61742635048239
  mo_energy =
[-0.90447474  1.61742635  7.63535078 18.23547351 36.28834683 61.80507022]
E1 = -3.8663273985482505  E_coul = 1.0286908514649629
cycle= 11 E= -2.83763654708329  delta_E= 1.54e-06  |g|= 0.000143  |ddm|= 0.787
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474522901986  LUMO = 1.61742932846732
  mo_energy =
[-0.90447452  1.61742933  7.63536526 18.2355282  36.2884387  61.80530024]
E1 = -3.8663271207908347  E_coul = 1.0286885302249484
cycle= 12 E= -2.83763859056589  delta_E= -2.04e-06  |g|= 7.98e-05  |ddm|= 4.09
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475104623282  LUMO = 1.61741437418853
  mo_energy =
[-0.9044751   1.61741437  7.63528928 18.23525682 36.287998   61.8043231 ]
E1 = -3.8663286012434415  E_coul = 1.028690332213814
cycle= 13 E= -2.83763826902963  delta_E= 3.22e-07  |g|= 4.12e-05  |ddm|= 20.4
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475286975737  LUMO = 1.61741587080718
  mo_energy =
[-0.90447529  1.61741587  7.63529953 18.23527204 36.28800351 61.80418096]
E1 = -3.8663284577952206  E_coul = 1.0286901409284432
cycle= 14 E= -2.83763831686678  delta_E= -4.78e-08  |g|= 4.1e-05  |ddm|= 0.841
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474823401317  LUMO = 1.61742491016099
  mo_energy =
[-0.90447482  1.61742491  7.6353458  18.2354236  36.28823642 61.80468667]
E1 = -3.866327620011601  E_coul = 1.0286897287488639
cycle= 15 E= -2.83763789126274  delta_E= 4.26e-07  |g|= 3.14e-05  |ddm|= 11.3
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474886013915  LUMO = 1.61742402224429
  mo_energy =
[-0.90447489  1.61742402  7.63534132 18.23540518 36.28820358 61.8046126 ]
E1 = -3.8663277003754417  E_coul = 1.0286884378029848
cycle= 16 E= -2.83763926257246  delta_E= -1.37e-06  |g|= 7.89e-05  |ddm|= 1.26
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474795911912  LUMO = 1.61742703146807
  mo_energy =
[-0.9044748   1.61742703  7.6353571  18.2354553  36.28827809 61.80475762]
E1 = -3.8663274103314005  E_coul = 1.0286891568185106
cycle= 17 E= -2.83763825351289  delta_E= 1.01e-06  |g|= 1.31e-05  |ddm|= 3.74
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474635121836  LUMO = 1.61742898526921
  mo_energy =
[-0.90447464  1.61742899  7.6353661  18.23550121 36.28836913 61.80503192]
E1 = -3.8663272065156207  E_coul = 1.028687589281869
cycle= 18 E= -2.83763961723375  delta_E= -1.36e-06  |g|= 0.000149  |ddm|= 3.45
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475142106328  LUMO = 1.6174193129742
  mo_energy =
[-0.90447514  1.61741931  7.63531609 18.23533634 36.28811197 61.8045286 ]
E1 = -3.8663280905162  E_coul = 1.0286891644579588
cycle= 19 E= -2.83763892605824  delta_E= 6.91e-07  |g|= 4.34e-05  |ddm|= 11.9
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475504323819  LUMO = 1.61741181181651
  mo_energy =
[-0.9044755   1.61741181  7.63527813 18.23520295 36.28789829 61.80406901]
E1 = -3.866328810713365  E_coul = 1.0286921273567329
cycle= 20 E= -2.83763668335663  delta_E= 2.24e-06  |g|= 0.000196  |ddm|= 9.95
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904476330980899  LUMO = 1.61739206202035
  mo_energy =
[-0.90447633  1.61739206  7.63517057 18.23489788 36.28747232 61.80353066]
E1 = -3.8663305147107265  E_coul = 1.0286939792447147
cycle= 21 E= -2.83763653546601  delta_E= 1.48e-07  |g|= 0.000292  |ddm|=   21
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904476015917877  LUMO = 1.61739929056213
  mo_energy =
[-0.90447602  1.61739929  7.63521007 18.23501333 36.28763639 61.80366898]
E1 = -3.8663298949071043  E_coul = 1.0286921148999355
cycle= 22 E= -2.83763778000717  delta_E= -1.24e-06  |g|= 0.000149  |ddm|= 7.68
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475890088213  LUMO = 1.6174018535181
  mo_energy =
[-0.90447589  1.61740185  7.63522316 18.23505698 36.28770449 61.80382496]
E1 = -3.8663296541342205  E_coul = 1.0286929388981612
cycle= 23 E= -2.83763671523606  delta_E= 1.06e-06  |g|= 0.000235  |ddm|= 3.26
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447626514076  LUMO = 1.61739489678929
  mo_energy =
[-0.90447627  1.6173949   7.63518719 18.23494214 36.28752961 61.80348126]
E1 = -3.8663302823910857  E_coul = 1.0286930101339877
cycle= 24 E= -2.8376372722571  delta_E= -5.57e-07  |g|= 0.000215  |ddm|= 8.37
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475977278327  LUMO = 1.61740112589293
  mo_energy =
[-0.90447598  1.61740113  7.63522051 18.23504321 36.28767883 61.80370635]
E1 = -3.866329734045196  E_coul = 1.028693717574555
cycle= 25 E= -2.83763601647064  delta_E= 1.26e-06  |g|= 0.000307  |ddm|= 7.06
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904476379668916  LUMO = 1.61739417194766
  mo_energy =
[-0.90447638  1.61739417  7.63518665 18.23490989 36.28744747 61.80308908]
E1 = -3.8663304257706077  E_coul = 1.0286930804927326
cycle= 26 E= -2.83763734527788  delta_E= -1.33e-06  |g|= 0.00021  |ddm|= 10.2
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475432861217  LUMO = 1.6174114644625
  mo_energy =
[-0.90447543  1.61741146  7.63527466 18.23521776 36.2879452  61.8041048 ]
E1 = -3.8663288095006783  E_coul = 1.0286906434589895
cycle= 27 E= -2.83763816604169  delta_E= -8.21e-07  |g|= 6.54e-05  |ddm|= 22.5
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.9044744197201  LUMO = 1.61743154089265
  mo_energy =
[-0.90447442  1.61743154  7.63537745 18.23558624 36.28855478 61.80552447]
E1 = -3.866326902834326  E_coul = 1.0286920735216563
cycle= 28 E= -2.83763482931267  delta_E= 3.34e-06  |g|= 0.000263  |ddm|= 26.9
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472113239985  LUMO = 1.61747783729076
  mo_energy =
[-0.90447211  1.61747784  7.63561324 18.23637756 36.28979018 61.80819707]
E1 = -3.866322550241645  E_coul = 1.0286840212652244
cycle= 29 E= -2.83763852897642  delta_E= -3.7e-06  |g|= 0.000284  |ddm|=   59
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474057939999  LUMO = 1.61743920132535
  mo_energy =
[-0.90447406  1.6174392   7.63541334 18.23571929 36.28876828 61.80616161]
E1 = -3.86632610359134  E_coul = 1.0286895381648455
cycle= 30 E= -2.83763656542649  delta_E= 1.96e-06  |g|= 6.94e-05  |ddm|= 47.8
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473879193999  LUMO = 1.61744283465161
  mo_energy =
[-0.90447388  1.61744283  7.63543166 18.23578448 36.28887429 61.80640652]
E1 = -3.8663257546891505  E_coul = 1.028687798258477
cycle= 31 E= -2.83763795643067  delta_E= -1.39e-06  |g|= 8.24e-05  |ddm|= 4.86
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474027292499  LUMO = 1.61744034125246
  mo_energy =
[-0.90447403  1.61744034  7.63541943 18.23573898 36.28879853 61.8062225 ]
E1 = -3.8663259958149037  E_coul = 1.0286901833727937
cycle= 32 E= -2.83763581244211  delta_E= 2.14e-06  |g|= 0.00014  |ddm|= 3.45
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473777657731  LUMO = 1.61744494611946
  mo_energy =
[-0.90447378  1.61744495  7.63544258 18.23582064 36.28893142 61.80653524]
E1 = -3.866325558569931  E_coul = 1.0286870331302698
cycle= 33 E= -2.83763852543966  delta_E= -2.71e-06  |g|= 0.000127  |ddm|= 6.11
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447402748584  LUMO = 1.61744003377009
  mo_energy =
[-0.90447403  1.61744003  7.63541738 18.2357417  36.28881435 61.80629943]
E1 = -3.866326008509752  E_coul = 1.0286890127791757
cycle= 34 E= -2.83763699573058  delta_E= 1.53e-06  |g|= 1.53e-05  |ddm|= 5.88
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473887379263  LUMO = 1.61744309583109
  mo_energy =
[-0.90447389  1.6174431   7.63543356 18.2357952  36.28889798 61.8064565 ]
E1 = -3.8663257275632805  E_coul = 1.0286873736152518
cycle= 35 E= -2.83763835394803  delta_E= -1.36e-06  |g|= 0.00012  |ddm|= 3.79
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473524515645  LUMO = 1.61745068565648
  mo_energy =
[-0.90447352  1.61745069  7.63547287 18.23592128 36.28908889 61.80682699]
E1 = -3.866325030034604  E_coul = 1.0286870207344514
cycle= 36 E= -2.83763800930015  delta_E= 3.45e-07  |g|= 0.00013  |ddm|= 9.23
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447400045255  LUMO = 1.61744162291679
  mo_energy =
[-0.904474    1.61744162  7.63542647 18.23576569 36.28884495 61.80631443]
E1 = -3.8663258716782716  E_coul = 1.028686706789187
cycle= 37 E= -2.83763916488908  delta_E= -1.16e-06  |g|= 0.000193  |ddm|= 11.4
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473763463107  LUMO = 1.61744541169249
  mo_energy =
[-0.90447376  1.61744541  7.63544363 18.23584216 36.28898343 61.80675794]
E1 = -3.866325463397103  E_coul = 1.0286868953492692
cycle= 38 E= -2.83763856804783  delta_E= 5.97e-07  |g|= 0.00018  |ddm|= 6.26
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474075609007  LUMO = 1.61743932141856
  mo_energy =
[-0.90447408  1.61743932  7.63541265 18.23573649 36.28881619 61.80640774]
E1 = -3.8663260324388515  E_coul = 1.0286873206478686
cycle= 39 E= -2.83763871179098  delta_E= -1.44e-07  |g|= 0.000127  |ddm|= 7.76
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474631822303  LUMO = 1.61742836125408
  mo_energy =
[-0.90447463  1.61742836  7.63535488 18.23555383 36.28853871 61.80591393]
E1 = -3.8663270134922114  E_coul = 1.0286886958524983
cycle= 40 E= -2.83763831763971  delta_E= 3.94e-07  |g|= 7.31e-05  |ddm|=   13
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475217931134  LUMO = 1.61741976637816
  mo_energy =
[-0.90447522  1.61741977  7.63531671 18.23535885 36.28816344 61.80472047]
E1 = -3.8663279669769675  E_coul = 1.0286903923083566
cycle= 41 E= -2.83763757466861  delta_E= 7.43e-07  |g|= 7.67e-05  |ddm|= 15.6
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475018599647  LUMO = 1.61742303867101
  mo_energy =
[-0.90447502  1.61742304  7.63533331 18.23541471 36.28825143 61.80490192]
E1 = -3.8663276689750767  E_coul = 1.0286892389167883
cycle= 42 E= -2.83763843005829  delta_E= -8.55e-07  |g|= 1.52e-05  |ddm|= 4.07
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475226523587  LUMO = 1.61741853794299
  mo_energy =
[-0.90447523  1.61741854  7.63530946 18.23534266 36.28814646 61.80472937]
E1 = -3.8663280699361153  E_coul = 1.0286909748062474
cycle= 43 E= -2.83763709512987  delta_E= 1.33e-06  |g|= 0.00012  |ddm|= 5.14
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475160846769  LUMO = 1.61742005986175
  mo_energy =
[-0.90447516  1.61742006  7.63531789 18.23536408 36.28817345 61.8047434 ]
E1 = -3.8663279458840756  E_coul = 1.0286891137955863
cycle= 44 E= -2.83763883208849  delta_E= -1.74e-06  |g|= 3.85e-05  |ddm|= 1.42
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475462172378  LUMO = 1.61741434573174
  mo_energy =
[-0.90447546  1.61741435  7.63528833 18.23526397 36.28801426 61.80442648]
E1 = -3.866328470958994  E_coul = 1.0286919835082404
cycle= 45 E= -2.83763648745075  delta_E= 2.34e-06  |g|= 0.000197  |ddm|= 7.19
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475395810261  LUMO = 1.61741617557799
  mo_energy =
[-0.9044754   1.61741618  7.63529871 18.23529386 36.28805677 61.80446788]
E1 = -3.8663283157662254  E_coul = 1.028689562787671
cycle= 46 E= -2.83763875297855  delta_E= -2.27e-06  |g|= 2.24e-05  |ddm|= 1.93
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475748372145  LUMO = 1.61740806817512
  mo_energy =
[-0.90447575  1.61740807  7.63525308 18.2351889  36.2879418  61.80452149]
E1 = -3.8663289521577893  E_coul = 1.0286921945601823
cycle= 47 E= -2.83763675759761  delta_E= 2e-06  |g|= 0.000203  |ddm|= 6.79
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904476324312261  LUMO = 1.61739942127486
  mo_energy =
[-0.90447632  1.61739942  7.63521802 18.23497593 36.28751087 61.80305101]
E1 = -3.866329993637363  E_coul = 1.0286911298758186
cycle= 48 E= -2.83763886376154  delta_E= -2.11e-06  |g|= 5.14e-05  |ddm|= 17.7
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474738130201  LUMO = 1.61742511247691
  mo_energy =
[-0.90447474  1.61742511  7.63533822 18.23551908 36.2885132  61.80592542]
E1 = -3.8663272987742814  E_coul = 1.0286886682392664
cycle= 49 E= -2.83763863053501  delta_E= 2.33e-07  |g|= 7.35e-05  |ddm|= 42.1
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475267323771  LUMO = 1.61741607013235
  mo_energy =
[-0.90447527  1.61741607  7.63529284 18.23535546 36.28824403 61.80528024]
E1 = -3.866328156069736  E_coul = 1.028691436864147
cycle= 50 E= -2.83763671920559  delta_E= 1.91e-06  |g|= 0.000129  |ddm|= 12.1
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.866328156069736  E_coul = 1.028691436864147

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904472641307114  LUMO = 1.61745406903084
  mo_energy =
[-0.90447264  1.61745407  7.63549419 18.23591175 36.28898705 61.80609988]
E1 = -3.866325122876368  E_coul = 1.0286871493764167
Extra cycle  E= -2.83763797349995  delta_E= -1.25e-06  |g|= 0.000103  |ddm|= 37.8
    CPU time for scf_cycle      0.52 sec, wall time      0.52 sec
exp = [6.39063753 5.63431975 4.96075425 4.25881618 3.8515388  0.37935145]
E = -2.8376379734999513
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:27 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.39063753117        1
[INPUT] 0    0    [1    /1   ]  5.63431975036        1
[INPUT] 0    0    [1    /1   ]  4.96075425233        1
[INPUT] 0    0    [1    /1   ]  4.25881618406        1
[INPUT] 0    0    [1    /1   ]  3.85153880507        1
[INPUT] 0    0    [1    /1   ]  0.379351445746       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.390637531173178, 1.0]], [0, [5.634319750357056, 1.0]], [0, [4.960754252330135, 1.0]], [0, [4.2588161840557115, 1.0]], [0, [3.8515388050700134, 1.0]], [0, [0.3793514457458093, 1.0]]]}
ecp = {}
CPU time:        84.86
Set gradient conv threshold to 3.16228e-05
cond(S) = 973466484.6118896

WARN: Singularity detected in overlap matrix (condition number = 9.73e+08). SCF may be inaccurate and hard to converge.

E1 = -3.8565682070112266  E_coul = 1.0242443994679857
init E= -2.83232380754324
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906685930224277  LUMO = 1.61353054487014
  mo_energy =
[-0.90668593  1.61353054  7.63100076 18.23264603 36.28694523 61.80969992]
E1 = -3.866577539063335  E_coul = 1.028943163808122
cycle= 1 E= -2.83763437525521  delta_E= -0.00531  |g|= 0.00599  |ddm|= 9.24e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904346482539713  LUMO = 1.61750749280002
  mo_energy =
[-0.90434648  1.61750749  7.63565909 18.23641162 36.28999882 61.80955054]
E1 = -3.8663261462294045  E_coul = 1.0286903986495708
cycle= 2 E= -2.83763574757983  delta_E= -1.37e-06  |g|= 0.000373  |ddm|=  661
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.90448011737533  LUMO = 1.61745985288509
  mo_energy =
[-0.90448012  1.61745985  7.63552935 18.23625514 36.28974178 61.80878277]
E1 = -3.8663219148073154  E_coul = 1.0286874928894247
cycle= 3 E= -2.83763442191789  delta_E= 1.33e-06  |g|= 0.000122  |ddm|= 62.9
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904471897335907  LUMO = 1.61749632973609
  mo_energy =
[-0.9044719   1.61749633  7.63570374 18.23684153 36.29068984 61.81068829]
E1 = -3.8663203285029755  E_coul = 1.028685114056768
cycle= 4 E= -2.83763521444621  delta_E= -7.93e-07  |g|= 9.93e-05  |ddm|= 37.7
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.90447495867423  LUMO = 1.61747329004267
  mo_energy =
[-0.90447496  1.61747329  7.63558682 18.23646803 36.29011316 61.80968389]
E1 = -3.8663218714129792  E_coul = 1.0286877908313852
cycle= 5 E= -2.83763408058159  delta_E= 1.13e-06  |g|= 8.76e-05  |ddm|= 23.8
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474212969805  LUMO = 1.61748282505689
  mo_energy =
[-0.90447421  1.61748283  7.63563625 18.23661527 36.29032673 61.81007108]
E1 = -3.86632110068686  E_coul = 1.0286865837703654
cycle= 6 E= -2.83763451691649  delta_E= -4.36e-07  |g|= 3.55e-05  |ddm|= 10.2
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474120751276  LUMO = 1.61748317214706
  mo_energy =
[-0.90447412  1.61748317  7.6356363  18.23664121 36.29039366 61.81032713]
E1 = -3.8663210256400475  E_coul = 1.0286858486824233
cycle= 7 E= -2.83763517695762  delta_E= -6.6e-07  |g|= 3.82e-05  |ddm|= 2.08
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474240780217  LUMO = 1.61748025886493
  mo_energy =
[-0.90447424  1.61748026  7.63562057 18.23660073 36.29034377 61.8102796 ]
E1 = -3.866321274170116  E_coul = 1.028683701786672
cycle= 8 E= -2.83763757238344  delta_E= -2.4e-06  |g|= 0.000252  |ddm|= 2.86
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474751373747  LUMO = 1.61746980152627
  mo_energy =
[-0.90447475  1.6174698   7.63556723 18.23642101 36.29006218 61.80966474]
E1 = -3.8663222616808244  E_coul = 1.028687904442
cycle= 9 E= -2.83763435723882  delta_E= 3.22e-06  |g|= 7.78e-05  |ddm|= 13.4
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474512260982  LUMO = 1.61747316447654
  mo_energy =
[-0.90447451  1.61747316  7.63558493 18.23647423 36.29014056 61.80979019]
E1 = -3.8663219868902203  E_coul = 1.028686671375529
cycle= 10 E= -2.83763531551469  delta_E= -9.58e-07  |g|= 2.43e-05  |ddm|= 3.63
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447447854918  LUMO = 1.61747297821154
  mo_energy =
[-0.90447448  1.61747298  7.63558424 18.23646766 36.29012584 61.80973146]
E1 = -3.8663220278162473  E_coul = 1.0286882441161447
cycle= 11 E= -2.8376337837001  delta_E= 1.53e-06  |g|= 0.000125  |ddm|= 0.637
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474274949762  LUMO = 1.61747629726195
  mo_energy =
[-0.90447427  1.6174763   7.63560128 18.23652326 36.29021148 61.80990371]
E1 = -3.866321732196239  E_coul = 1.0286885427693127
cycle= 12 E= -2.83763318942693  delta_E= 5.94e-07  |g|= 0.000172  |ddm|= 4.01
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474521894455  LUMO = 1.61747152760822
  mo_energy =
[-0.90447452  1.61747153  7.63557416 18.23647319 36.29017555 61.81002825]
E1 = -3.8663220702428096  E_coul = 1.0286880876265827
cycle= 13 E= -2.83763398261623  delta_E= -7.93e-07  |g|= 9.83e-05  |ddm|= 3.11
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474644648369  LUMO = 1.61747032616221
  mo_energy =
[-0.90447464  1.61747033  7.63556765 18.23645427 36.29014799 61.81000874]
E1 = -3.86632215204082  E_coul = 1.0286850220817079
cycle= 14 E= -2.83763712995911  delta_E= -3.15e-06  |g|= 0.000192  |ddm|= 1.13
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474360749652  LUMO = 1.61747505549489
  mo_energy =
[-0.90447436  1.61747506  7.63559216 18.23653093 36.29026378 61.81021848]
E1 = -3.8663217369114107  E_coul = 1.0286873738441966
cycle= 15 E= -2.83763436306721  delta_E= 2.77e-06  |g|= 4.62e-05  |ddm|= 5.51
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474060415545  LUMO = 1.61748000651149
  mo_energy =
[-0.90447406  1.61748001  7.63561753 18.23661029 36.29038149 61.81043798]
E1 = -3.86632130079206  E_coul = 1.0286877615634584
cycle= 16 E= -2.8376335392286  delta_E= 8.24e-07  |g|= 0.000104  |ddm|= 5.76
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472329031136  LUMO = 1.61751367621641
  mo_energy =
[-0.90447233  1.61751368  7.63579125 18.23717556 36.29124965 61.81220182]
E1 = -3.866318213435181  E_coul = 1.028684481745619
cycle= 17 E= -2.83763373168956  delta_E= -1.92e-07  |g|= 6.28e-05  |ddm|= 41.3
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447369451856  LUMO = 1.61748971064176
  mo_energy =
[-0.90447369  1.61748971  7.63567069 18.23675137 36.29056381 61.81062354]
E1 = -3.866320471264164  E_coul = 1.0286853224058294
cycle= 18 E= -2.83763514885833  delta_E= -1.42e-06  |g|= 7.1e-05  |ddm|= 31.5
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473742391238  LUMO = 1.61748876096062
  mo_energy =
[-0.90447374  1.61748876  7.6356656  18.23673679 36.29054391 61.81059591]
E1 = -3.8663205535012  E_coul = 1.0286866673821669
cycle= 19 E= -2.83763388611903  delta_E= 1.26e-06  |g|= 5.1e-05  |ddm|= 1.03
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473824204369  LUMO = 1.61748727609679
  mo_energy =
[-0.90447382  1.61748728  7.6356579  18.23671463 36.29051358 61.81055059]
E1 = -3.866320682697097  E_coul = 1.0286854600648203
cycle= 20 E= -2.83763522263228  delta_E= -1.34e-06  |g|= 6.93e-05  |ddm|= 1.61
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474141887069  LUMO = 1.61748165796932
  mo_energy =
[-0.90447414  1.61748166  7.63562971 18.23661629 36.29035571 61.81018664]
E1 = -3.8663212120629122  E_coul = 1.0286853657412853
cycle= 21 E= -2.83763584632163  delta_E= -6.24e-07  |g|= 9.1e-05  |ddm|= 7.35
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474487181457  LUMO = 1.61747463505022
  mo_energy =
[-0.90447449  1.61747464  7.63559302 18.23650068 36.29018225 61.80988124]
E1 = -3.8663218465617155  E_coul = 1.0286875530679243
cycle= 22 E= -2.83763429349379  delta_E= 1.55e-06  |g|= 7.22e-05  |ddm|= 8.32
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447396579438  LUMO = 1.617483837006
  mo_energy =
[-0.90447397  1.61748384  7.63563873 18.23666703 36.29045597 61.81053415]
E1 = -3.8663209618150876  E_coul = 1.028687400651153
cycle= 23 E= -2.83763356116393  delta_E= 7.32e-07  |g|= 8.72e-05  |ddm|= 12.5
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473877550687  LUMO = 1.61748551708876
  mo_energy =
[-0.90447388  1.61748552  7.63564746 18.23669584 36.29050074 61.81062116]
E1 = -3.866320808285747  E_coul = 1.0286870565433153
cycle= 24 E= -2.83763375174243  delta_E= -1.91e-07  |g|= 8.2e-05  |ddm|= 2.06
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473958742708  LUMO = 1.61748358291318
  mo_energy =
[-0.90447396  1.61748358  7.6356368  18.23667148 36.29047471 61.81061175]
E1 = -3.8663209649169237  E_coul = 1.028686675442562
cycle= 25 E= -2.83763428947436  delta_E= -5.38e-07  |g|= 2.07e-05  |ddm|=  1.7
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473865106019  LUMO = 1.61748563462194
  mo_energy =
[-0.90447387  1.61748563  7.63564721 18.23670254 36.29051854 61.81070431]
E1 = -3.8663207755313285  E_coul = 1.0286849529386237
cycle= 26 E= -2.8376358225927  delta_E= -1.53e-06  |g|= 0.000128  |ddm|=  2.4
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473997459269  LUMO = 1.61748325884259
  mo_energy =
[-0.904474    1.61748326  7.63563524 18.23665959 36.29044774 61.81053918]
E1 = -3.8663210005269186  E_coul = 1.028688292836602
cycle= 27 E= -2.83763270769032  delta_E= 3.11e-06  |g|= 0.000182  |ddm|= 3.17
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473779118521  LUMO = 1.61748736199676
  mo_energy =
[-0.90447378  1.61748736  7.6356557  18.23673468 36.29057201 61.81083999]
E1 = -3.866320602199947  E_coul = 1.0286851372496932
cycle= 28 E= -2.83763546495025  delta_E= -2.76e-06  |g|= 0.000104  |ddm|= 5.65
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473802751098  LUMO = 1.61748696626123
  mo_energy =
[-0.9044738   1.61748697  7.63565359 18.23672668 36.29055801 61.81080958]
E1 = -3.8663206382755964  E_coul = 1.0286884213064458
cycle= 29 E= -2.83763221696915  delta_E= 3.25e-06  |g|= 0.000205  |ddm|= 0.539
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473442004223  LUMO = 1.61749421905177
  mo_energy =
[-0.90447344  1.61749422  7.63569122 18.23684914 36.2907467  61.81117318]
E1 = -3.8663199741272014  E_coul = 1.0286858253035396
cycle= 30 E= -2.83763414882366  delta_E= -1.93e-06  |g|= 2.94e-05  |ddm|= 8.87
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473214304794  LUMO = 1.61749778208548
  mo_energy =
[-0.90447321  1.61749778  7.63570692 18.23692698 36.29089348 61.81162842]
E1 = -3.866319577983926  E_coul = 1.028685200740321
cycle= 31 E= -2.8376343772436  delta_E= -2.28e-07  |g|= 5e-05  |ddm|= 6.31
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473318367148  LUMO = 1.61749637274097
  mo_energy =
[-0.90447332  1.61749637  7.63570174 18.2368947  36.29082957 61.81139104]
E1 = -3.8663197535818856  E_coul = 1.0286864398521873
cycle= 32 E= -2.8376333137297  delta_E= 1.06e-06  |g|= 5.06e-05  |ddm|= 2.91
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447348072727  LUMO = 1.61749343817996
  mo_energy =
[-0.90447348  1.61749344  7.63568699 18.2368385  36.29073423 61.81117503]
E1 = -3.8663200373040194  E_coul = 1.02868579695095
cycle= 33 E= -2.83763424035307  delta_E= -9.27e-07  |g|= 1.96e-05  |ddm|= 4.11
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473369549917  LUMO = 1.61749529308305
  mo_energy =
[-0.90447337  1.61749529  7.63569579 18.23687837 36.29080681 61.81137228]
E1 = -3.866319841140851  E_coul = 1.0286829471423355
cycle= 34 E= -2.83763689399852  delta_E= -2.65e-06  |g|= 0.000273  |ddm|= 3.05
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472394488621  LUMO = 1.61751400857338
  mo_energy =
[-0.90447239  1.61751401  7.63579078 18.23721016 36.29134283 61.81257517]
E1 = -3.8663180713299887  E_coul = 1.028684208509625
cycle= 35 E= -2.83763386282036  delta_E= 3.03e-06  |g|= 8.8e-05  |ddm|= 24.5
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473757153716  LUMO = 1.61748905434644
  mo_energy =
[-0.90447376  1.61748905  7.63566733 18.23675206 36.29058168 61.8106962 ]
E1 = -3.8663205096708735  E_coul = 1.0286855426578718
cycle= 36 E= -2.837634967013  delta_E= -1.1e-06  |g|= 5.84e-05  |ddm|= 34.7
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473547468246  LUMO = 1.61749338660542
  mo_energy =
[-0.90447355  1.61749339  7.63569026 18.23682429 36.29069046 61.81089816]
E1 = -3.866320121216411  E_coul = 1.028684977983165
cycle= 37 E= -2.83763514323325  delta_E= -1.76e-07  |g|= 8.67e-05  |ddm|= 5.09
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474683118717  LUMO = 1.61747178963584
  mo_energy =
[-0.90447468  1.61747179  7.63558043 18.23643797 36.29006267 61.80952574]
E1 = -3.8663221586751493  E_coul = 1.0286855011266816
cycle= 38 E= -2.83763665754847  delta_E= -1.51e-06  |g|= 0.000126  |ddm|= 28.4
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475137060449  LUMO = 1.61746222069005
  mo_energy =
[-0.90447514  1.61746222  7.63553025 18.23628406 36.28983533 61.80911354]
E1 = -3.8663230193198297  E_coul = 1.0286876990492222
cycle= 39 E= -2.83763532027061  delta_E= 1.34e-06  |g|= 2.87e-05  |ddm|= 11.1
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474754676811  LUMO = 1.61746980481375
  mo_energy =
[-0.90447475  1.6174698   7.63556961 18.23640921 36.29002453 61.80946759]
E1 = -3.8663223289332143  E_coul = 1.0286905045408958
cycle= 40 E= -2.83763182439232  delta_E= 3.5e-06  |g|= 0.000321  |ddm|= 9.12
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474250524078  LUMO = 1.61747937885385
  mo_energy =
[-0.90447425  1.61747938  7.63561813 18.23657456 36.29028553 61.81003968]
E1 = -3.86632142925363  E_coul = 1.028688947073332
cycle= 41 E= -2.8376324821803  delta_E= -6.58e-07  |g|= 0.000229  |ddm|= 12.3
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473996946776  LUMO = 1.61748397415293
  mo_energy =
[-0.904474    1.61748397  7.63564138 18.2366585  36.2904242  61.8103474 ]
E1 = -3.866320994410391  E_coul = 1.0286847512447577
cycle= 42 E= -2.83763624316563  delta_E= -3.76e-06  |g|= 0.000151  |ddm|= 6.15
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473950067265  LUMO = 1.6174849527364
  mo_energy =
[-0.90447395  1.61748495  7.63564666 18.23667392 36.29044653 61.81038119]
E1 = -3.8663209099421456  E_coul = 1.0286850622383537
cycle= 43 E= -2.83763584770379  delta_E= 3.95e-07  |g|= 0.000121  |ddm|= 1.06
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474235093683  LUMO = 1.61747917940089
  mo_energy =
[-0.90447424  1.61747918  7.635617   18.23657401 36.29028974 61.81005764]
E1 = -3.866321448990575  E_coul = 1.028686766150715
cycle= 44 E= -2.83763468283986  delta_E= 1.16e-06  |g|= 1.6e-05  |ddm|= 7.32
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474242521326  LUMO = 1.61747895419264
  mo_energy =
[-0.90447424  1.61747895  7.63561587 18.2365736  36.29029282 61.810063  ]
E1 = -3.866321467128044  E_coul = 1.0286875250506946
cycle= 45 E= -2.83763394207735  delta_E= 7.41e-07  |g|= 7.57e-05  |ddm|= 0.108
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474130137143  LUMO = 1.61748133871523
  mo_energy =
[-0.90447413  1.61748134  7.63562886 18.23660797 36.29033812 61.81011154]
E1 = -3.866321268728233  E_coul = 1.0286861275087194
cycle= 46 E= -2.83763514121951  delta_E= -1.2e-06  |g|= 4.17e-05  |ddm|= 2.37
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474031084015  LUMO = 1.61748344722826
  mo_energy =
[-0.90447403  1.61748345  7.63563994 18.2366402  36.2903828  61.81017527]
E1 = -3.866321081418475  E_coul = 1.0286882349757667
cycle= 47 E= -2.83763284644271  delta_E= 2.29e-06  |g|= 0.000177  |ddm|= 2.33
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473645855604  LUMO = 1.61749040134462
  mo_energy =
[-0.90447365  1.6174904   7.63567446 18.23676533 36.29058787 61.81066301]
E1 = -3.8663204107992293  E_coul = 1.028685708281183
cycle= 48 E= -2.83763470251805  delta_E= -1.86e-06  |g|= 4.66e-05  |ddm|= 9.45
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473692927025  LUMO = 1.61748985270356
  mo_energy =
[-0.90447369  1.61748985  7.6356722  18.23675634 36.2905729  61.81060566]
E1 = -3.8663204685740813  E_coul = 1.0286866879343646
cycle= 49 E= -2.83763378063972  delta_E= 9.22e-07  |g|= 5.31e-05  |ddm|= 0.843
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447409036369  LUMO = 1.61748246287857
  mo_energy =
[-0.90447409  1.61748246  7.635635   18.23662199 36.2903514  61.81009894]
E1 = -3.8663211744838137  E_coul = 1.0286859158822594
cycle= 50 E= -2.83763525860155  delta_E= -1.48e-06  |g|= 5.3e-05  |ddm|= 9.95
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.8663211744838137  E_coul = 1.0286859158822594

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904474671362049  LUMO = 1.61747188500904
  mo_energy =
[-0.90447467  1.61747189  7.63558055 18.23644069 36.2900718  61.80956871]
E1 = -3.866322137384091  E_coul = 1.0286863298207698
Extra cycle  E= -2.83763580756332  delta_E= -5.49e-07  |g|= 6.04e-05  |ddm|= 13.1
    CPU time for scf_cycle      0.51 sec, wall time      0.52 sec
exp = [6.39063753 5.63431975 4.96075425 4.25881618 3.85153881 0.37935145]
E = -2.8376358075633212
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:28 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.39063753122        1
[INPUT] 0    0    [1    /1   ]  5.63431975046        1
[INPUT] 0    0    [1    /1   ]  4.96075425236        1
[INPUT] 0    0    [1    /1   ]  4.25881618406        1
[INPUT] 0    0    [1    /1   ]  3.85153880515        1
[INPUT] 0    0    [1    /1   ]  0.379351445739       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.390637531224185, 1.0]], [0, [5.634319750462128, 1.0]], [0, [4.960754252358593, 1.0]], [0, [4.258816184057146, 1.0]], [0, [3.85153880515353, 1.0]], [0, [0.37935144573895807, 1.0]]]}
ecp = {}
CPU time:        85.73
Set gradient conv threshold to 3.16228e-05
cond(S) = 973466502.6180633

WARN: Singularity detected in overlap matrix (condition number = 9.73e+08). SCF may be inaccurate and hard to converge.

E1 = -3.856568206711077  E_coul = 1.0242412234786413
init E= -2.83232698323244
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906689258214377  LUMO = 1.61347043843091
  mo_energy =
[-0.90668926  1.61347044  7.630701   18.23148055 36.28492888 61.80475688]
E1 = -3.8665834342887107  E_coul = 1.0289479283555718
cycle= 1 E= -2.83763550593314  delta_E= -0.00531  |g|= 0.00599  |ddm|= 9.33e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904344659300698  LUMO = 1.61749131251807
  mo_energy =
[-0.90434466  1.61749131  7.63557202 18.23598863 36.28918602 61.80737338]
E1 = -3.8663285643918037  E_coul = 1.0286896100230962
cycle= 2 E= -2.83763895436871  delta_E= -3.45e-06  |g|= 0.000421  |ddm|=  610
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.90448233092973  LUMO = 1.61739465495836
  mo_energy =
[-0.90448233  1.61739465  7.63518725 18.23510386 36.28791093 61.80506765]
E1 = -3.8663281874970865  E_coul = 1.028691022447642
cycle= 3 E= -2.83763716504944  delta_E= 1.79e-06  |g|= 0.000166  |ddm|=  113
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904470497336121  LUMO = 1.61744982338985
  mo_energy =
[-0.9044705   1.61744982  7.63544908 18.2359247  36.28917517 61.80763397]
E1 = -3.866325639922621  E_coul = 1.0286902966952447
cycle= 4 E= -2.83763534322738  delta_E= 1.82e-06  |g|= 0.000135  |ddm|= 52.8
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904472697758087  LUMO = 1.6174649399924
  mo_energy =
[-0.9044727   1.61746494  7.63553345 18.23625707 36.289739   61.8089688 ]
E1 = -3.8663233447040097  E_coul = 1.0286851636423973
cycle= 5 E= -2.83763818106161  delta_E= -2.84e-06  |g|= 0.000228  |ddm|= 27.8
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474323559354  LUMO = 1.61744350601943
  mo_energy =
[-0.90447432  1.61744351  7.63542594 18.23588579 36.28914451 61.80766158]
E1 = -3.8663252298715576  E_coul = 1.0286888359370343
cycle= 6 E= -2.83763639393452  delta_E= 1.79e-06  |g|= 2.58e-05  |ddm|= 26.8
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474181581139  LUMO = 1.61744596073147
  mo_energy =
[-0.90447418  1.61744596  7.63543898 18.23591992 36.28918583 61.80768605]
E1 = -3.866325027885377  E_coul = 1.0286877817962958
cycle= 7 E= -2.83763724608908  delta_E= -8.52e-07  |g|= 6.16e-05  |ddm|= 2.37
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474291541604  LUMO = 1.61744380678149
  mo_energy =
[-0.90447429  1.61744381  7.63542886 18.2358772  36.28910997 61.80747049]
E1 = -3.8663252553886647  E_coul = 1.0286877475853962
cycle= 8 E= -2.83763750780327  delta_E= -2.62e-07  |g|= 7.52e-05  |ddm|= 3.39
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474403154974  LUMO = 1.61744157114442
  mo_energy =
[-0.9044744   1.61744157  7.6354178  18.23583282 36.28903135 61.80726299]
E1 = -3.866325481139358  E_coul = 1.028687760866828
cycle= 9 E= -2.83763772027253  delta_E= -2.12e-07  |g|= 6.8e-05  |ddm|= 3.36
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474459233712  LUMO = 1.61743921062958
  mo_energy =
[-0.90447446  1.61743921  7.6354053  18.23579499 36.28897707 61.80717474]
E1 = -3.8663257079481093  E_coul = 1.0286887145730386
cycle= 10 E= -2.83763699337507  delta_E= 7.27e-07  |g|= 8.83e-06  |ddm|= 2.82
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474677069605  LUMO = 1.61743511879305
  mo_energy =
[-0.90447468  1.61743512  7.63538462 18.23571978 36.28885135 61.8068755 ]
E1 = -3.8663260973992664  E_coul = 1.028688763681759
cycle= 11 E= -2.83763733371751  delta_E= -3.4e-07  |g|= 4.72e-06  |ddm|= 5.56
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474622441882  LUMO = 1.61743494839786
  mo_energy =
[-0.90447462  1.61743495  7.6353835  18.23571941 36.2888564  61.80690551]
E1 = -3.8663261235467807  E_coul = 1.0286901257949164
cycle= 12 E= -2.83763599775186  delta_E= 1.34e-06  |g|= 0.000118  |ddm|= 0.109
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474586452344  LUMO = 1.61743605355129
  mo_energy =
[-0.90447459  1.61743605  7.63538897 18.23573867 36.28888684 61.8069839 ]
E1 = -3.86632601047762  E_coul = 1.0286890145393583
cycle= 13 E= -2.83763699593826  delta_E= -9.98e-07  |g|= 2.57e-05  |ddm|= 1.53
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474955957436  LUMO = 1.61743233346596
  mo_energy =
[-0.90447496  1.61743233  7.63537263 18.23566152 36.28874138 61.80651619]
E1 = -3.866326378142272  E_coul = 1.0286893659410323
cycle= 14 E= -2.83763701220124  delta_E= -1.63e-08  |g|= 4.23e-05  |ddm|= 6.06
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474999019888  LUMO = 1.61743056557726
  mo_energy =
[-0.904475    1.61743057  7.63536311 18.23563165 36.28869581 61.80645268]
E1 = -3.8663265460815657  E_coul = 1.028687965572786
cycle= 15 E= -2.83763858050878  delta_E= -1.57e-06  |g|= 0.000103  |ddm|= 2.13
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474527237126  LUMO = 1.61743788977463
  mo_energy =
[-0.90447453  1.61743789  7.6353975  18.23577497 36.28894741 61.80715372]
E1 = -3.866325803285261  E_coul = 1.0286895013085031
cycle= 16 E= -2.83763630197676  delta_E= 2.28e-06  |g|= 7.24e-05  |ddm|= 11.2
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473974840968  LUMO = 1.61744653066015
  mo_energy =
[-0.90447397  1.61744653  7.63543896 18.23595128 36.28926486 61.80803585]
E1 = -3.8663249314102677  E_coul = 1.0286886926769867
cycle= 17 E= -2.83763623873328  delta_E= 6.32e-08  |g|= 3.21e-05  |ddm|= 13.4
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447355444586  LUMO = 1.61745480162918
  mo_energy =
[-0.90447355  1.6174548   7.63548049 18.23609965 36.28950769 61.80861632]
E1 = -3.8663241346026886  E_coul = 1.0286885409023747
cycle= 18 E= -2.83763559370031  delta_E= 6.45e-07  |g|= 4.31e-05  |ddm|= 11.2
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473692870959  LUMO = 1.61745278790485
  mo_energy =
[-0.90447369  1.61745279  7.63547253 18.23604739 36.28940194 61.8082293 ]
E1 = -3.8663243882899727  E_coul = 1.0286882912342943
cycle= 19 E= -2.83763609705568  delta_E= -5.03e-07  |g|= 3.68e-05  |ddm|= 4.41
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473748174625  LUMO = 1.61745163972471
  mo_energy =
[-0.90447375  1.61745164  7.63546606 18.23603409 36.2893899  61.80825085]
E1 = -3.866324474610432  E_coul = 1.028690914857664
cycle= 20 E= -2.83763355975277  delta_E= 2.54e-06  |g|= 0.00025  |ddm|= 0.869
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473514398518  LUMO = 1.61745641880501
  mo_energy =
[-0.90447351  1.61745642  7.63549083 18.23611461 36.28951408 61.80849621]
E1 = -3.8663240357664153  E_coul = 1.028687435971723
cycle= 21 E= -2.83763659979469  delta_E= -3.04e-06  |g|= 6.43e-05  |ddm|= 5.85
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473729268213  LUMO = 1.61745263598518
  mo_energy =
[-0.90447373  1.61745264  7.63547236 18.23604113 36.2893873  61.80816417]
E1 = -3.8663244126448455  E_coul = 1.0286866176223086
cycle= 22 E= -2.83763779502254  delta_E= -1.2e-06  |g|= 0.000145  |ddm|= 5.57
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474021145137  LUMO = 1.61744738789469
  mo_energy =
[-0.90447402  1.61744739  7.6354462  18.23594488 36.28922671 61.80778494]
E1 = -3.866324917660439  E_coul = 1.028689525659218
cycle= 23 E= -2.83763539200122  delta_E= 2.4e-06  |g|= 0.00012  |ddm|= 7.19
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473411541411  LUMO = 1.61745823330142
  mo_energy =
[-0.90447341  1.61745823  7.63549915 18.23615152 36.28957983 61.80870541]
E1 = -3.866323838039303  E_coul = 1.0286881699355255
cycle= 24 E= -2.83763566810378  delta_E= -2.76e-07  |g|= 2.05e-05  |ddm|= 15.8
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473133257324  LUMO = 1.6174624397065
  mo_energy =
[-0.90447313  1.61746244  7.6355175  18.23624755 36.28976904 61.80934665]
E1 = -3.866323363342519  E_coul = 1.028686888562612
cycle= 25 E= -2.83763647477991  delta_E= -8.07e-07  |g|= 8.5e-05  |ddm|= 7.82
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472546565567  LUMO = 1.61747313195273
  mo_energy =
[-0.90447255  1.61747313  7.63557209 18.23642388 36.29004007 61.80992037]
E1 = -3.8663223849988633  E_coul = 1.0286853246561722
cycle= 26 E= -2.83763706034269  delta_E= -5.86e-07  |g|= 0.000194  |ddm|=   13
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472655739361  LUMO = 1.61747198970834
  mo_energy =
[-0.90447266  1.61747199  7.63556902 18.23639114 36.28996687 61.80959361]
E1 = -3.866322555124214  E_coul = 1.02868259621301
cycle= 27 E= -2.8376399589112  delta_E= -2.9e-06  |g|= 0.000433  |ddm|= 3.14
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472074318108  LUMO = 1.61748447017227
  mo_energy =
[-0.90447207  1.61748447  7.63563482 18.23658449 36.29023956 61.81000667]
E1 = -3.8663214490901447  E_coul = 1.0286848173868202
cycle= 28 E= -2.83763663170332  delta_E= 3.33e-06  |g|= 0.000177  |ddm|= 13.9
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473613465115  LUMO = 1.61745549564371
  mo_energy =
[-0.90447361  1.6174555   7.63548776 18.23607446 36.28942099 61.80817634]
E1 = -3.8663241758281384  E_coul = 1.0286856125879595
cycle= 29 E= -2.83763856324018  delta_E= -1.93e-06  |g|= 0.000226  |ddm|= 37.7
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474107538367  LUMO = 1.61744601437994
  mo_energy =
[-0.90447411  1.61744601  7.63544001 18.23591096 36.28916239 61.80760437]
E1 = -3.8663250724771756  E_coul = 1.0286899400519567
cycle= 30 E= -2.83763513242522  delta_E= 3.43e-06  |g|= 0.000152  |ddm|= 12.3
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473287981741  LUMO = 1.61746144395439
  mo_energy =
[-0.90447329  1.61746144  7.63551826 18.23619111 36.28961997 61.80863297]
E1 = -3.8663236078044423  E_coul = 1.0286873809790145
cycle= 31 E= -2.83763622682543  delta_E= -1.09e-06  |g|= 2.69e-05  |ddm|= 20.6
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473485636033  LUMO = 1.61745871508172
  mo_energy =
[-0.90447349  1.61745872  7.63550686 18.2361376  36.28952076 61.80827686]
E1 = -3.8663239105721137  E_coul = 1.028689121573628
cycle= 32 E= -2.83763478899849  delta_E= 1.44e-06  |g|= 0.000118  |ddm|= 4.69
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473272819014  LUMO = 1.61746249248302
  mo_energy =
[-0.90447327  1.61746249  7.63552601 18.23620261 36.28962304 61.80850211]
E1 = -3.866323559025234  E_coul = 1.0286865545369153
cycle= 33 E= -2.83763700448832  delta_E= -2.22e-06  |g|= 0.000108  |ddm|= 4.81
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473323359648  LUMO = 1.61746097662622
  mo_energy =
[-0.90447332  1.61746098  7.63551793 18.23617681 36.28958371 61.80843773]
E1 = -3.8663236989035443  E_coul = 1.028688382703972
cycle= 34 E= -2.83763531619957  delta_E= 1.69e-06  |g|= 6.72e-05  |ddm|= 1.84
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473068899839  LUMO = 1.61746569858659
  mo_energy =
[-0.90447307  1.6174657   7.63554126 18.23626053 36.28971924 61.80876163]
E1 = -3.8663232420986264  E_coul = 1.0286848654375194
cycle= 35 E= -2.83763837666111  delta_E= -3.06e-06  |g|= 0.00025  |ddm|= 6.38
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473318463617  LUMO = 1.61746088514146
  mo_energy =
[-0.90447332  1.61746089  7.63551656 18.23617783 36.28958984 61.80849386]
E1 = -3.8663236884395142  E_coul = 1.028687414798504
cycle= 36 E= -2.83763627364101  delta_E= 2.1e-06  |g|= 1.84e-05  |ddm|= 6.05
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472604578209  LUMO = 1.61747544967757
  mo_energy =
[-0.9044726   1.61747545  7.63559166 18.23643696 36.29000565 61.80938772]
E1 = -3.8663223218378056  E_coul = 1.0286869198731228
cycle= 37 E= -2.83763540196468  delta_E= 8.72e-07  |g|= 1.34e-05  |ddm|= 18.8
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472730839456  LUMO = 1.61747194919837
  mo_energy =
[-0.90447273  1.61747195  7.63557169 18.2363819  36.28992813 61.8093076 ]
E1 = -3.866322611503431  E_coul = 1.0286847780793362
cycle= 38 E= -2.83763783342409  delta_E= -2.43e-06  |g|= 0.000239  |ddm|= 3.52
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472450579999  LUMO = 1.61747526759465
  mo_energy =
[-0.90447245  1.61747527  7.63558419 18.23644636 36.29004573 61.80973358]
E1 = -3.8663222264706762  E_coul = 1.0286850950187483
cycle= 39 E= -2.83763713145193  delta_E= 7.02e-07  |g|= 0.000192  |ddm|= 5.98
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472381644146  LUMO = 1.61747603006451
  mo_energy =
[-0.90447238  1.61747603  7.63558755 18.23645664 36.29006044 61.80979034]
E1 = -3.8663221570545665  E_coul = 1.0286871376608582
cycle= 40 E= -2.83763501939371  delta_E= 2.11e-06  |g|= 1.47e-05  |ddm|= 0.892
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474331070015  LUMO = 1.61743606817818
  mo_energy =
[-0.90447433  1.61743607  7.63538025 18.23580469 36.28908648 61.80789854]
E1 = -3.866325799260608  E_coul = 1.0286892365362938
cycle= 41 E= -2.83763656272431  delta_E= -1.54e-06  |g|= 2.66e-05  |ddm|= 47.7
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474092469922  LUMO = 1.61744749505916
  mo_energy =
[-0.90447409  1.6174475   7.6354468  18.23594712 36.28922803 61.80776999]
E1 = -3.86632488768346  E_coul = 1.0286898422855366
cycle= 42 E= -2.83763504539792  delta_E= 1.52e-06  |g|= 0.00014  |ddm|= 9.23
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447379600976  LUMO = 1.61745303601588
  mo_energy =
[-0.9044738   1.61745304  7.63547499 18.23604099 36.28937506 61.80808472]
E1 = -3.866324375416216  E_coul = 1.0286887199495474
cycle= 43 E= -2.83763565546667  delta_E= -6.1e-07  |g|= 5.35e-05  |ddm|= 6.93
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473481907089  LUMO = 1.61745917104593
  mo_energy =
[-0.90447348  1.61745917  7.63550663 18.23614431 36.28953429 61.80840343]
E1 = -3.866323811237546  E_coul = 1.0286880495832789
cycle= 44 E= -2.83763576165427  delta_E= -1.06e-07  |g|= 2.25e-05  |ddm|= 7.54
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447341638136  LUMO = 1.61746086523445
  mo_energy =
[-0.90447342  1.61746087  7.63551602 18.23616568 36.28955711 61.80840692]
E1 = -3.866323672637561  E_coul = 1.0286880988665683
cycle= 45 E= -2.83763557377099  delta_E= 1.88e-07  |g|= 3.31e-05  |ddm|= 1.48
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447333135879  LUMO = 1.61746223954429
  mo_energy =
[-0.90447333  1.61746224  7.63552273 18.23619109 36.28960022 61.80851648]
E1 = -3.866323539178468  E_coul = 1.0286880996075247
cycle= 46 E= -2.83763543957094  delta_E= 1.34e-07  |g|= 4.31e-05  |ddm|= 1.93
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473287407227  LUMO = 1.61746300629967
  mo_energy =
[-0.90447329  1.61746301  7.63552665 18.236205   36.28962281 61.80856063]
E1 = -3.866323468414769  E_coul = 1.0286869622802803
cycle= 47 E= -2.83763650613449  delta_E= -1.07e-06  |g|= 6.19e-05  |ddm|= 0.99
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473444838493  LUMO = 1.61746004685925
  mo_energy =
[-0.90447344  1.61746005  7.63551174 18.23615486 36.28954422 61.80838202]
E1 = -3.8663237462235953  E_coul = 1.0286885549375089
cycle= 48 E= -2.83763519128609  delta_E= 1.31e-06  |g|= 7.46e-05  |ddm|= 3.77
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473389405301  LUMO = 1.61746147375882
  mo_energy =
[-0.90447339  1.61746147  7.63551898 18.23617734 36.28957691 61.80845902]
E1 = -3.866323609971719  E_coul = 1.0286861898365958
cycle= 49 E= -2.83763742013512  delta_E= -2.23e-06  |g|= 0.000139  |ddm|= 1.76
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904472446157064  LUMO = 1.61747807336045
  mo_energy =
[-0.90447245  1.61747807  7.63560107 18.23647064 36.29005432 61.80961867]
E1 = -3.866322019978764  E_coul = 1.0286856601118104
cycle= 50 E= -2.83763635986695  delta_E= 1.06e-06  |g|= 0.00012  |ddm|= 22.2
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.866322019978764  E_coul = 1.0286856601118104

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904475349989442  LUMO = 1.61745056446284
  mo_energy =
[-0.90447535  1.61745056  7.63546666 18.23601913 36.28934579 61.80801263]
E1 = -3.866324222616706  E_coul = 1.0286889466870077
Extra cycle  E= -2.8376352759297  delta_E= 1.08e-06  |g|= 9.66e-05  |ddm|=   32
    CPU time for scf_cycle      0.52 sec, wall time      0.52 sec
exp = [6.39063753 5.63431975 4.96075425 4.25881618 3.85153881 0.37935145]
E = -2.8376352759296983
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:29 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.39063753123        1
[INPUT] 0    0    [1    /1   ]  5.63431975047        1
[INPUT] 0    0    [1    /1   ]  4.96075425236        1
[INPUT] 0    0    [1    /1   ]  4.25881618406        1
[INPUT] 0    0    [1    /1   ]  3.85153880516        1
[INPUT] 0    0    [1    /1   ]  0.379351445738       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.390637531229286, 1.0]], [0, [5.634319750472635, 1.0]], [0, [4.960754252361439, 1.0]], [0, [4.25881618405729, 1.0]], [0, [3.8515388051618817, 1.0]], [0, [0.37935144573827295, 1.0]]]}
ecp = {}
CPU time:        86.60
Set gradient conv threshold to 3.16228e-05
cond(S) = 973466447.1367638

WARN: Singularity detected in overlap matrix (condition number = 9.73e+08). SCF may be inaccurate and hard to converge.

E1 = -3.856568206008523  E_coul = 1.0242312430166676
init E= -2.83233696299186
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906699781189609  LUMO = 1.61326951189297
  mo_energy =
[-0.90669978  1.61326951  7.62967876 18.22793529 36.27924935 61.79214807]
E1 = -3.8666024276131834  E_coul = 1.0289592619522554
cycle= 1 E= -2.83764316566093  delta_E= -0.00531  |g|= 0.006  |ddm|= 9.59e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904342817224177  LUMO = 1.61735318694205
  mo_energy =
[-0.90434282  1.61735319  7.6348415  18.23343372 36.28509664 61.79848116]
E1 = -3.86634394464141  E_coul = 1.028696031881572
cycle= 2 E= -2.83764791275984  delta_E= -4.75e-06  |g|= 0.000489  |ddm|=  549
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904483770743184  LUMO = 1.61723300750595
  mo_energy =
[-0.90448377  1.61723301  7.63435514 18.23208784 36.28297722 61.79351178]
E1 = -3.866345614035403  E_coul = 1.0286993502887594
cycle= 3 E= -2.83764626374664  delta_E= 1.65e-06  |g|= 0.000168  |ddm|=  147
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904470320026854  LUMO = 1.61728535316893
  mo_energy =
[-0.90447032  1.61728535  7.63459054 18.23289713 36.28430382 61.79679249]
E1 = -3.8663435462777147  E_coul = 1.0286963071427466
cycle= 4 E= -2.83764723913497  delta_E= -9.75e-07  |g|= 0.000138  |ddm|= 51.4
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904475232611284  LUMO = 1.61725730637092
  mo_energy =
[-0.90447523  1.61725731  7.63446035 18.2324336  36.28353667 61.79484772]
E1 = -3.8663453486507513  E_coul = 1.0287001725943556
cycle= 5 E= -2.8376451760564  delta_E= 2.06e-06  |g|= 0.000173  |ddm|= 31.3
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474155439779  LUMO = 1.61727211448015
  mo_energy =
[-0.90447416  1.61727211  7.63453395 18.23268676 36.28393932 61.79577018]
E1 = -3.8663440225367225  E_coul = 1.0286987191162584
cycle= 6 E= -2.83764530342046  delta_E= -1.27e-07  |g|= 9.2e-05  |ddm|= 18.7
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473910685365  LUMO = 1.61727797327385
  mo_energy =
[-0.90447391  1.61727797  7.63456402 18.2327848  36.28408994 61.79608963]
E1 = -3.866343463616  E_coul = 1.0286951856433277
cycle= 7 E= -2.83764827797267  delta_E= -2.97e-06  |g|= 0.000212  |ddm|= 7.39
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447451289904  LUMO = 1.6172679924477
  mo_energy =
[-0.90447451  1.61726799  7.63451388 18.2326069  36.28380105 61.79541932]
E1 = -3.866344393120147  E_coul = 1.02869632287967
cycle= 8 E= -2.83764807024048  delta_E= 2.08e-07  |g|= 0.000139  |ddm|= 13.2
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474763449562  LUMO = 1.61726250795066
  mo_energy =
[-0.90447476  1.61726251  7.63448572 18.23251341 36.2836551  61.79511517]
E1 = -3.8663449085545434  E_coul = 1.028697411435461
cycle= 9 E= -2.83764749711908  delta_E= 5.73e-07  |g|= 6.08e-05  |ddm|= 6.93
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474767965523  LUMO = 1.61726088803565
  mo_energy =
[-0.90447477  1.61726089  7.6344774  18.23248467 36.28360909 61.79500948]
E1 = -3.86634508325002  E_coul = 1.0286978880719282
cycle= 10 E= -2.83764719517809  delta_E= 3.02e-07  |g|= 3e-05  |ddm|= 2.28
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474633915074  LUMO = 1.61726144905403
  mo_energy =
[-0.90447463  1.61726145  7.63448004 18.23249101 36.28361663 61.79502403]
E1 = -3.8663450621708626  E_coul = 1.0286991932945326
cycle= 11 E= -2.83764586887633  delta_E= 1.33e-06  |g|= 0.000105  |ddm|= 0.339
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474479231309  LUMO = 1.61726366250099
  mo_energy =
[-0.90447448  1.61726366  7.63449086 18.23253357 36.28369038 61.79521038]
E1 = -3.8663448513076384  E_coul = 1.028696471291168
cycle= 12 E= -2.83764838001647  delta_E= -2.51e-06  |g|= 0.000136  |ddm|= 3.16
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475005853849  LUMO = 1.61725554226626
  mo_energy =
[-0.90447501  1.61725554  7.63444946 18.23239458 36.28347242 61.79475306]
E1 = -3.8663455751567755  E_coul = 1.0286968820906406
cycle= 13 E= -2.83764869306613  delta_E= -3.13e-07  |g|= 0.000133  |ddm|=   10
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475090835004  LUMO = 1.61725380020366
  mo_energy =
[-0.90447509  1.6172538   7.6344405  18.2323651  36.28342684 61.79466052]
E1 = -3.866345736854557  E_coul = 1.0286987781615926
cycle= 14 E= -2.83764695869296  delta_E= 1.73e-06  |g|= 4.02e-05  |ddm|= 2.17
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475604007398  LUMO = 1.61724404138254
  mo_energy =
[-0.9044756   1.61724404  7.63439089 18.23219647 36.28316025 61.79407293]
E1 = -3.8663466494922725  E_coul = 1.0286994671491172
cycle= 15 E= -2.83764718234316  delta_E= -2.24e-07  |g|= 4.72e-05  |ddm|= 12.5
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475432595297  LUMO = 1.61724617868514
  mo_energy =
[-0.90447543  1.61724618  7.63439911 18.23225394 36.28327983 61.79451614]
E1 = -3.866346380147143  E_coul = 1.0286996434727451
cycle= 16 E= -2.8376467366744  delta_E= 4.46e-07  |g|= 7.42e-05  |ddm|= 4.83
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475277040756  LUMO = 1.6172478232802
  mo_energy =
[-0.90447528  1.61724782  7.63440688 18.23228618 36.28333847 61.794681  ]
E1 = -3.8663462293155124  E_coul = 1.0286986281627406
cycle= 17 E= -2.83764760115277  delta_E= -8.64e-07  |g|= 5.89e-06  |ddm|= 2.39
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475178239292  LUMO = 1.61724876947126
  mo_energy =
[-0.90447518  1.61724877  7.63441099 18.2323047  36.28337325 61.79479901]
E1 = -3.866346138938995  E_coul = 1.0286984279174543
cycle= 18 E= -2.83764771102154  delta_E= -1.1e-07  |g|= 3.24e-05  |ddm|= 1.48
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475246008619  LUMO = 1.61724629321411
  mo_energy =
[-0.90447525  1.61724629  7.63439652 18.23227692 36.28335119 61.79486372]
E1 = -3.866346328330211  E_coul = 1.0286998584824782
cycle= 19 E= -2.83764646984773  delta_E= 1.24e-06  |g|= 8.19e-05  |ddm|= 1.74
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904476592431334  LUMO = 1.61722018163332
  mo_energy =
[-0.90447659  1.61722018  7.6342617  18.23183208 36.28265988 61.79348671]
E1 = -3.866348725522235  E_coul = 1.0287003553865193
cycle= 20 E= -2.83764837013572  delta_E= -1.9e-06  |g|= 2.71e-05  |ddm|= 32.4
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474942953778  LUMO = 1.61725554697764
  mo_energy =
[-0.90447494  1.61725555  7.63444505 18.23244137 36.28361173 61.7954056 ]
E1 = -3.8663454358871037  E_coul = 1.0286987795386646
cycle= 21 E= -2.83764665634844  delta_E= 1.71e-06  |g|= 2.39e-05  |ddm|= 44.4
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474080874603  LUMO = 1.61727405071603
  mo_energy =
[-0.90447408  1.61727405  7.63454192 18.23274342 36.28406261 61.79621677]
E1 = -3.866343760385641  E_coul = 1.0286944750626759
cycle= 22 E= -2.83764928532297  delta_E= -2.63e-06  |g|= 0.000307  |ddm|= 21.9
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475746360259  LUMO = 1.61724426197496
  mo_energy =
[-0.90447575  1.61724426  7.6343946  18.23218844 36.2831266  61.79388392]
E1 = -3.8663466566308435  E_coul = 1.0286987082953438
cycle= 23 E= -2.8376479483355  delta_E= 1.34e-06  |g|= 1.1e-05  |ddm|= 41.8
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475792916653  LUMO = 1.61724312402471
  mo_energy =
[-0.90447579  1.61724312  7.63438842 18.23217019 36.28310098 61.79385327]
E1 = -3.8663467563556737  E_coul = 1.028698561187815
cycle= 24 E= -2.83764819516786  delta_E= -2.47e-07  |g|= 3.81e-05  |ddm|= 1.26
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475878323922  LUMO = 1.61724144882303
  mo_energy =
[-0.90447588  1.61724145  7.63438012 18.23213903 36.28304898 61.79372674]
E1 = -3.866346920980456  E_coul = 1.0287016078513262
cycle= 25 E= -2.83764531312913  delta_E= 2.88e-06  |g|= 0.000237  |ddm|= 2.36
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475813468142  LUMO = 1.61724308958607
  mo_energy =
[-0.90447581  1.61724309  7.63438934 18.23215818 36.28306658 61.79370752]
E1 = -3.866346793062944  E_coul = 1.0287017755874603
cycle= 26 E= -2.83764501747548  delta_E= 2.96e-07  |g|= 0.000257  |ddm|= 1.28
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475620471213  LUMO = 1.6172473857023
  mo_energy =
[-0.90447562  1.61724739  7.63441245 18.23222692 36.28316582 61.7938502 ]
E1 = -3.8663464154678513  E_coul = 1.0286989861974234
cycle= 27 E= -2.83764742927043  delta_E= -2.41e-06  |g|= 4.69e-05  |ddm|= 4.79
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447575389727  LUMO = 1.61724419386217
  mo_energy =
[-0.90447575  1.61724419  7.63439514 18.23217739 36.28309538 61.79375031]
E1 = -3.866346690019706  E_coul = 1.0286973104921082
cycle= 28 E= -2.8376493795276  delta_E= -1.95e-06  |g|= 0.000139  |ddm|= 3.44
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904476733121296  LUMO = 1.61722583199374
  mo_energy =
[-0.90447673  1.61722583  7.63430174 18.23185455 36.28257785 61.79261694]
E1 = -3.8663484099231358  E_coul = 1.0286998100225988
cycle= 29 E= -2.83764859990054  delta_E= 7.8e-07  |g|= 2.9e-05  |ddm|= 23.8
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904476274456523  LUMO = 1.6172343148561
  mo_energy =
[-0.90447627  1.61723431  7.63434602 18.23199626 36.28279424 61.79300516]
E1 = -3.8663476526524887  E_coul = 1.0287010560616434
cycle= 30 E= -2.83764659659085  delta_E= 2e-06  |g|= 0.000161  |ddm|= 10.1
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447432771685  LUMO = 1.61726878047316
  mo_energy =
[-0.90447433  1.61726878  7.63451983 18.23261325 36.28380134 61.79525993]
E1 = -3.866344412554314  E_coul = 1.0286943944581664
cycle= 31 E= -2.83765001809615  delta_E= -3.42e-06  |g|= 0.000307  |ddm|= 45.6
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904476796479268  LUMO = 1.61722103241499
  mo_energy =
[-0.9044768   1.61722103  7.63427422 18.23181619 36.28257879 61.79284894]
E1 = -3.8663487809816477  E_coul = 1.0287035781177294
cycle= 32 E= -2.83764520286392  delta_E= 4.82e-06  |g|= 0.000339  |ddm|= 58.5
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904476964660008  LUMO = 1.61721758638687
  mo_energy =
[-0.90447696  1.61721759  7.63425674 18.23175545 36.28248101 61.79262453]
E1 = -3.8663491103659293  E_coul = 1.0287009327455832
cycle= 33 E= -2.83764817762035  delta_E= -2.97e-06  |g|= 7.97e-05  |ddm|= 4.59
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904476766000621  LUMO = 1.61722114487972
  mo_energy =
[-0.90447677  1.61722114  7.63427466 18.23181508 36.28257351 61.79283079]
E1 = -3.866348778502941  E_coul = 1.028700869007891
cycle= 34 E= -2.83764790949505  delta_E= 2.68e-07  |g|= 8.79e-05  |ddm|= 4.49
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904477342156998  LUMO = 1.61720927382833
  mo_energy =
[-0.90447734  1.61720927  7.63421278 18.23161965 36.28227968 61.7922888 ]
E1 = -3.8663498531559375  E_coul = 1.0287035400829767
cycle= 35 E= -2.83764631307296  delta_E= 1.6e-06  |g|= 0.000287  |ddm|= 14.1
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904477888411341  LUMO = 1.61719938809639
  mo_energy =
[-0.90447789  1.61719939  7.63416353 18.23143905 36.28198183 61.79159023]
E1 = -3.866350804662479  E_coul = 1.0287045368324312
cycle= 36 E= -2.83764626783005  delta_E= 4.52e-08  |g|= 0.000334  |ddm|= 13.5
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904477496125519  LUMO = 1.61720632334393
  mo_energy =
[-0.9044775   1.61720632  7.63419684 18.23157101 36.2822088  61.79220938]
E1 = -3.8663501067999944  E_coul = 1.0287021619609107
cycle= 37 E= -2.83764794483908  delta_E= -1.68e-06  |g|= 0.000145  |ddm|= 10.3
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904477124929796  LUMO = 1.61721378539664
  mo_energy =
[-0.90447712  1.61721379  7.63423552 18.23169682 36.28240218 61.7925825 ]
E1 = -3.866349423690268  E_coul = 1.0287017372395089
cycle= 38 E= -2.83764768645076  delta_E= 2.58e-07  |g|= 0.000137  |ddm|= 9.15
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904477643139001  LUMO = 1.61720379175619
  mo_energy =
[-0.90447764  1.61720379  7.63418355 18.23153498 36.28216125 61.79213758]
E1 = -3.8663503204123724  E_coul = 1.0287052748225505
cycle= 39 E= -2.83764504558982  delta_E= 2.64e-06  |g|= 0.000426  |ddm|= 11.7
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904477032245848  LUMO = 1.61721130409783
  mo_energy =
[-0.90447703  1.6172113   7.63421545 18.23165237 36.28234808 61.79268084]
E1 = -3.8663495760823343  E_coul = 1.028702283618831
cycle= 40 E= -2.8376472924635  delta_E= -2.25e-06  |g|= 0.00017  |ddm|= 10.4
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904481402144434  LUMO = 1.61712812747335
  mo_energy =
[-0.9044814   1.61712813  7.63379065 18.23021218 36.28007146 61.78782948]
E1 = -3.866357319193745  E_coul = 1.0287103386779504
cycle= 41 E= -2.83764698051579  delta_E= 3.12e-07  |g|= 0.000587  |ddm|=  106
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475151782865  LUMO = 1.61725385025216
  mo_energy =
[-0.90447515  1.61725385  7.63444125 18.23237545 36.28345042 61.79473855]
E1 = -3.866345705211977  E_coul = 1.02869683888859
cycle= 42 E= -2.83764886632339  delta_E= -1.89e-06  |g|= 0.000142  |ddm|=  158
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475809170603  LUMO = 1.61724082674911
  mo_energy =
[-0.90447581  1.61724083  7.63437395 18.23216035 36.28312689 61.79409979]
E1 = -3.8663468968417325  E_coul = 1.02869965008757
cycle= 43 E= -2.83764724675416  delta_E= 1.62e-06  |g|= 4.34e-05  |ddm|= 15.8
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447581545238  LUMO = 1.61724134175007
  mo_energy =
[-0.90447582  1.61724134  7.63437793 18.23215499 36.28309984 61.79395397]
E1 = -3.8663468896978728  E_coul = 1.0287002582785312
cycle= 44 E= -2.83764663141934  delta_E= 6.15e-07  |g|= 0.000116  |ddm|= 0.622
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475576143499  LUMO = 1.61724545385409
  mo_energy =
[-0.90447558  1.61724545  7.63439814 18.23222966 36.28322378 61.7942541 ]
E1 = -3.866346492489855  E_coul = 1.0287010574843576
cycle= 45 E= -2.8376454350055  delta_E= 1.2e-06  |g|= 0.000207  |ddm|= 5.67
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474992951137  LUMO = 1.61725658336522
  mo_energy =
[-0.90447499  1.61725658  7.63445501 18.2324268  36.28354036 61.79495128]
E1 = -3.8663454481758652  E_coul = 1.0286973768710028
cycle= 46 E= -2.83764807130486  delta_E= -2.64e-06  |g|= 8.59e-05  |ddm|= 14.5
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475182650123  LUMO = 1.61725286790085
  mo_energy =
[-0.90447518  1.61725287  7.63443543 18.23236554 36.28344866 61.79479484]
E1 = -3.866345777726195  E_coul = 1.0286950933499008
cycle= 47 E= -2.83765068437629  delta_E= -2.61e-06  |g|= 0.000318  |ddm|= 4.34
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475959677921  LUMO = 1.61723800681592
  mo_energy =
[-0.90447596  1.61723801  7.63435984 18.23210569 36.28303419 61.79388072]
E1 = -3.866347171859828  E_coul = 1.0287003388662823
cycle= 48 E= -2.83764683299355  delta_E= 3.85e-06  |g|= 0.000104  |ddm|= 19.2
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475845836884  LUMO = 1.61724034698274
  mo_energy =
[-0.90447585  1.61724035  7.63437196 18.23214415 36.28309154 61.7939854 ]
E1 = -3.866346958227399  E_coul = 1.0286975048408835
cycle= 49 E= -2.83764945338652  delta_E= -2.62e-06  |g|= 0.000142  |ddm|=  2.8
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904478427736784  LUMO = 1.61718877473714
  mo_energy =
[-0.90447843  1.61718877  7.63410438 18.23128665 36.28178917 61.79148473]
E1 = -3.866351651927516  E_coul = 1.0287039392575057
cycle= 50 E= -2.83764771267001  delta_E= 1.74e-06  |g|= 0.000247  |ddm|= 62.4
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.866351651927516  E_coul = 1.0287039392575057

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904471887161079  LUMO = 1.61724637070615
  mo_energy =
[-0.90447189  1.61724637  7.63438981 18.23224584 36.28330788 61.79464703]
E1 = -3.8663472572407382  E_coul = 1.0286989462567957
Extra cycle  E= -2.83764831098394  delta_E= -5.98e-07  |g|= 6.92e-05  |ddm|= 65.3
    CPU time for scf_cycle      0.50 sec, wall time      0.50 sec
exp = [6.39063753 5.63431975 4.96075425 4.25881618 3.85153881 0.37935145]
E = -2.8376483109839423
 message: Optimization terminated successfully
 success: True
  status: 0
     fun: -2.8376483109839423
       x: [ 6.391e+00  5.634e+00  4.961e+00  4.259e+00  3.852e+00
            3.794e-01]
     nit: 21
     jac: [-3.364e-04 -1.688e-04  5.002e-06  2.996e-04  5.421e-04
           -1.110e-03]
    nfev: 54
    njev: 21
#INFO: **** input file is /Users/deyanmihaylov/Documents/Work/pyscf_basis_opt/pyscfad_test.py ****
import pyscf
from pyscfad import gto, scf
import numpy as np

from scipy import optimize

def min_diff(x):
    b = np.diff(np.sort(x))
    return np.abs(b).min()

def He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))

    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}

    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    e = mf.kernel()

    print(f"exp = {exponent}")
    print(f"E = {e}")

    return e

def grad_He_energy(exponent, exp_array=None):
    if exp_array is None:
        exp_array = np.zeros((exponent.size, 2))
        
    mol = gto.Mole()
    mol.atom = 'He 0 0 0'  # in Angstrom

    basis_string = '\n'.join([f'''
    He  S
        {exp_array[i, 0] if exp_array[i, 1] == 1 else exponent[i]}              1.0'''
        for i in range(exponent.shape[0])])
    mol.basis = {'He': pyscf.gto.basis.parse(basis_string)}
    
    mol.verbose = 5
    mol.build()

    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()

    print(f"exp = {exponent}")
    print(f"grad_E = {jac.exp}")

    grad_E = np.array(jac.exp)

    return grad_E

def minimize_energy(n, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-6, None) for _ in range(n))

    res = optimize.minimize(
        He_energy,
        x0,
        args=(exp_array),
        method="SLSQP",
        jac=grad_He_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-8,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-8},
    )
    
    print(res)
    print(f"E = {He_energy(res.x)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")


exps = np.zeros((6,2))
# exps[1:, 0] = exps_He_10s[:]
# exps[0, 0] = np.max(exps_He_10s) * 10.0
exps[:, 0] = np.array([3.0, 2.5, 2.0, 1.5, 1.0, 0.5])

minimize_energy(6, exps)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Deyans-MacBook-Pro-Home.local', release='22.1.0', version='Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:54 PDT 2022; root:xnu-8792.41.9~2/RELEASE_X86_64', machine='x86_64', processor='i386')  Threads 1
Python 3.8.16 (default, Mar  1 2023, 21:19:10) 
[Clang 14.0.6 ]
numpy 1.24.2  scipy 1.10.1
Date: Tue Mar  7 17:35:30 2023
PySCF version 2.1.1
PySCF path  /Users/deyanmihaylov/opt/anaconda3/envs/pyscfad_env/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file /Users/deyanmihaylov/.pyscf_conf.py
[INPUT] verbose = 5
[INPUT] max_memory = 4000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 He     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] He
[INPUT] 0    0    [1    /1   ]  6.39063753123        1
[INPUT] 0    0    [1    /1   ]  5.63431975047        1
[INPUT] 0    0    [1    /1   ]  4.96075425236        1
[INPUT] 0    0    [1    /1   ]  4.25881618406        1
[INPUT] 0    0    [1    /1   ]  3.85153880516        1
[INPUT] 0    0    [1    /1   ]  0.379351445738       1

nuclear repulsion = 0
number of shells = 6
number of NR pGTOs = 6
number of NR cGTOs = 6
basis = {'He': [[0, [6.390637531229286, 1.0]], [0, [5.634319750472635, 1.0]], [0, [4.960754252361439, 1.0]], [0, [4.25881618405729, 1.0]], [0, [3.8515388051618817, 1.0]], [0, [0.37935144573827295, 1.0]]]}
ecp = {}
CPU time:        87.44
Set gradient conv threshold to 3.16228e-05
cond(S) = 973466447.1367638

WARN: Singularity detected in overlap matrix (condition number = 9.73e+08). SCF may be inaccurate and hard to converge.

E1 = -3.856568206008523  E_coul = 1.0242312430166676
init E= -2.83233696299186
    CPU time for initialize scf      0.02 sec, wall time      0.02 sec
  HOMO = -0.906699781189609  LUMO = 1.61326951189297
  mo_energy =
[-0.90669978  1.61326951  7.62967876 18.22793529 36.27924935 61.79214807]
E1 = -3.8666024276131834  E_coul = 1.0289592619522554
cycle= 1 E= -2.83764316566093  delta_E= -0.00531  |g|= 0.006  |ddm|= 9.59e+03
    CPU time for cycle= 1      0.01 sec, wall time      0.01 sec
  HOMO = -0.904342817224177  LUMO = 1.61735318694205
  mo_energy =
[-0.90434282  1.61735319  7.6348415  18.23343372 36.28509664 61.79848116]
E1 = -3.86634394464141  E_coul = 1.028696031881572
cycle= 2 E= -2.83764791275984  delta_E= -4.75e-06  |g|= 0.000489  |ddm|=  549
    CPU time for cycle= 2      0.01 sec, wall time      0.01 sec
  HOMO = -0.904483770743184  LUMO = 1.61723300750595
  mo_energy =
[-0.90448377  1.61723301  7.63435514 18.23208784 36.28297722 61.79351178]
E1 = -3.866345614035403  E_coul = 1.0286993502887594
cycle= 3 E= -2.83764626374664  delta_E= 1.65e-06  |g|= 0.000168  |ddm|=  147
    CPU time for cycle= 3      0.01 sec, wall time      0.01 sec
  HOMO = -0.904470320026854  LUMO = 1.61728535316893
  mo_energy =
[-0.90447032  1.61728535  7.63459054 18.23289713 36.28430382 61.79679249]
E1 = -3.8663435462777147  E_coul = 1.0286963071427466
cycle= 4 E= -2.83764723913497  delta_E= -9.75e-07  |g|= 0.000138  |ddm|= 51.4
    CPU time for cycle= 4      0.01 sec, wall time      0.01 sec
  HOMO = -0.904475232611284  LUMO = 1.61725730637092
  mo_energy =
[-0.90447523  1.61725731  7.63446035 18.2324336  36.28353667 61.79484772]
E1 = -3.8663453486507513  E_coul = 1.0287001725943556
cycle= 5 E= -2.8376451760564  delta_E= 2.06e-06  |g|= 0.000173  |ddm|= 31.3
    CPU time for cycle= 5      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474155439779  LUMO = 1.61727211448015
  mo_energy =
[-0.90447416  1.61727211  7.63453395 18.23268676 36.28393932 61.79577018]
E1 = -3.8663440225367225  E_coul = 1.0286987191162584
cycle= 6 E= -2.83764530342046  delta_E= -1.27e-07  |g|= 9.2e-05  |ddm|= 18.7
    CPU time for cycle= 6      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904473910685365  LUMO = 1.61727797327385
  mo_energy =
[-0.90447391  1.61727797  7.63456402 18.2327848  36.28408994 61.79608963]
E1 = -3.866343463616  E_coul = 1.0286951856433277
cycle= 7 E= -2.83764827797267  delta_E= -2.97e-06  |g|= 0.000212  |ddm|= 7.39
    CPU time for cycle= 7      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447451289904  LUMO = 1.6172679924477
  mo_energy =
[-0.90447451  1.61726799  7.63451388 18.2326069  36.28380105 61.79541932]
E1 = -3.866344393120147  E_coul = 1.02869632287967
cycle= 8 E= -2.83764807024048  delta_E= 2.08e-07  |g|= 0.000139  |ddm|= 13.2
    CPU time for cycle= 8      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474763449562  LUMO = 1.61726250795066
  mo_energy =
[-0.90447476  1.61726251  7.63448572 18.23251341 36.2836551  61.79511517]
E1 = -3.8663449085545434  E_coul = 1.028697411435461
cycle= 9 E= -2.83764749711908  delta_E= 5.73e-07  |g|= 6.08e-05  |ddm|= 6.93
    CPU time for cycle= 9      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474767965523  LUMO = 1.61726088803565
  mo_energy =
[-0.90447477  1.61726089  7.6344774  18.23248467 36.28360909 61.79500948]
E1 = -3.86634508325002  E_coul = 1.0286978880719282
cycle= 10 E= -2.83764719517809  delta_E= 3.02e-07  |g|= 3e-05  |ddm|= 2.28
    CPU time for cycle= 10      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474633915074  LUMO = 1.61726144905403
  mo_energy =
[-0.90447463  1.61726145  7.63448004 18.23249101 36.28361663 61.79502403]
E1 = -3.8663450621708626  E_coul = 1.0286991932945326
cycle= 11 E= -2.83764586887633  delta_E= 1.33e-06  |g|= 0.000105  |ddm|= 0.339
    CPU time for cycle= 11      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474479231309  LUMO = 1.61726366250099
  mo_energy =
[-0.90447448  1.61726366  7.63449086 18.23253357 36.28369038 61.79521038]
E1 = -3.8663448513076384  E_coul = 1.028696471291168
cycle= 12 E= -2.83764838001647  delta_E= -2.51e-06  |g|= 0.000136  |ddm|= 3.16
    CPU time for cycle= 12      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475005853849  LUMO = 1.61725554226626
  mo_energy =
[-0.90447501  1.61725554  7.63444946 18.23239458 36.28347242 61.79475306]
E1 = -3.8663455751567755  E_coul = 1.0286968820906406
cycle= 13 E= -2.83764869306613  delta_E= -3.13e-07  |g|= 0.000133  |ddm|=   10
    CPU time for cycle= 13      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475090835004  LUMO = 1.61725380020366
  mo_energy =
[-0.90447509  1.6172538   7.6344405  18.2323651  36.28342684 61.79466052]
E1 = -3.866345736854557  E_coul = 1.0286987781615926
cycle= 14 E= -2.83764695869296  delta_E= 1.73e-06  |g|= 4.02e-05  |ddm|= 2.17
    CPU time for cycle= 14      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475604007398  LUMO = 1.61724404138254
  mo_energy =
[-0.9044756   1.61724404  7.63439089 18.23219647 36.28316025 61.79407293]
E1 = -3.8663466494922725  E_coul = 1.0286994671491172
cycle= 15 E= -2.83764718234316  delta_E= -2.24e-07  |g|= 4.72e-05  |ddm|= 12.5
    CPU time for cycle= 15      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475432595297  LUMO = 1.61724617868514
  mo_energy =
[-0.90447543  1.61724618  7.63439911 18.23225394 36.28327983 61.79451614]
E1 = -3.866346380147143  E_coul = 1.0286996434727451
cycle= 16 E= -2.8376467366744  delta_E= 4.46e-07  |g|= 7.42e-05  |ddm|= 4.83
    CPU time for cycle= 16      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475277040756  LUMO = 1.6172478232802
  mo_energy =
[-0.90447528  1.61724782  7.63440688 18.23228618 36.28333847 61.794681  ]
E1 = -3.8663462293155124  E_coul = 1.0286986281627406
cycle= 17 E= -2.83764760115277  delta_E= -8.64e-07  |g|= 5.89e-06  |ddm|= 2.39
    CPU time for cycle= 17      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475178239292  LUMO = 1.61724876947126
  mo_energy =
[-0.90447518  1.61724877  7.63441099 18.2323047  36.28337325 61.79479901]
E1 = -3.866346138938995  E_coul = 1.0286984279174543
cycle= 18 E= -2.83764771102154  delta_E= -1.1e-07  |g|= 3.24e-05  |ddm|= 1.48
    CPU time for cycle= 18      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475246008619  LUMO = 1.61724629321411
  mo_energy =
[-0.90447525  1.61724629  7.63439652 18.23227692 36.28335119 61.79486372]
E1 = -3.866346328330211  E_coul = 1.0286998584824782
cycle= 19 E= -2.83764646984773  delta_E= 1.24e-06  |g|= 8.19e-05  |ddm|= 1.74
    CPU time for cycle= 19      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904476592431334  LUMO = 1.61722018163332
  mo_energy =
[-0.90447659  1.61722018  7.6342617  18.23183208 36.28265988 61.79348671]
E1 = -3.866348725522235  E_coul = 1.0287003553865193
cycle= 20 E= -2.83764837013572  delta_E= -1.9e-06  |g|= 2.71e-05  |ddm|= 32.4
    CPU time for cycle= 20      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474942953778  LUMO = 1.61725554697764
  mo_energy =
[-0.90447494  1.61725555  7.63444505 18.23244137 36.28361173 61.7954056 ]
E1 = -3.8663454358871037  E_coul = 1.0286987795386646
cycle= 21 E= -2.83764665634844  delta_E= 1.71e-06  |g|= 2.39e-05  |ddm|= 44.4
    CPU time for cycle= 21      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474080874603  LUMO = 1.61727405071603
  mo_energy =
[-0.90447408  1.61727405  7.63454192 18.23274342 36.28406261 61.79621677]
E1 = -3.866343760385641  E_coul = 1.0286944750626759
cycle= 22 E= -2.83764928532297  delta_E= -2.63e-06  |g|= 0.000307  |ddm|= 21.9
    CPU time for cycle= 22      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475746360259  LUMO = 1.61724426197496
  mo_energy =
[-0.90447575  1.61724426  7.6343946  18.23218844 36.2831266  61.79388392]
E1 = -3.8663466566308435  E_coul = 1.0286987082953438
cycle= 23 E= -2.8376479483355  delta_E= 1.34e-06  |g|= 1.1e-05  |ddm|= 41.8
    CPU time for cycle= 23      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475792916653  LUMO = 1.61724312402471
  mo_energy =
[-0.90447579  1.61724312  7.63438842 18.23217019 36.28310098 61.79385327]
E1 = -3.8663467563556737  E_coul = 1.028698561187815
cycle= 24 E= -2.83764819516786  delta_E= -2.47e-07  |g|= 3.81e-05  |ddm|= 1.26
    CPU time for cycle= 24      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475878323922  LUMO = 1.61724144882303
  mo_energy =
[-0.90447588  1.61724145  7.63438012 18.23213903 36.28304898 61.79372674]
E1 = -3.866346920980456  E_coul = 1.0287016078513262
cycle= 25 E= -2.83764531312913  delta_E= 2.88e-06  |g|= 0.000237  |ddm|= 2.36
    CPU time for cycle= 25      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475813468142  LUMO = 1.61724308958607
  mo_energy =
[-0.90447581  1.61724309  7.63438934 18.23215818 36.28306658 61.79370752]
E1 = -3.866346793062944  E_coul = 1.0287017755874603
cycle= 26 E= -2.83764501747548  delta_E= 2.96e-07  |g|= 0.000257  |ddm|= 1.28
    CPU time for cycle= 26      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475620471213  LUMO = 1.6172473857023
  mo_energy =
[-0.90447562  1.61724739  7.63441245 18.23222692 36.28316582 61.7938502 ]
E1 = -3.8663464154678513  E_coul = 1.0286989861974234
cycle= 27 E= -2.83764742927043  delta_E= -2.41e-06  |g|= 4.69e-05  |ddm|= 4.79
    CPU time for cycle= 27      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447575389727  LUMO = 1.61724419386217
  mo_energy =
[-0.90447575  1.61724419  7.63439514 18.23217739 36.28309538 61.79375031]
E1 = -3.866346690019706  E_coul = 1.0286973104921082
cycle= 28 E= -2.8376493795276  delta_E= -1.95e-06  |g|= 0.000139  |ddm|= 3.44
    CPU time for cycle= 28      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904476733121296  LUMO = 1.61722583199374
  mo_energy =
[-0.90447673  1.61722583  7.63430174 18.23185455 36.28257785 61.79261694]
E1 = -3.8663484099231358  E_coul = 1.0286998100225988
cycle= 29 E= -2.83764859990054  delta_E= 7.8e-07  |g|= 2.9e-05  |ddm|= 23.8
    CPU time for cycle= 29      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904476274456523  LUMO = 1.6172343148561
  mo_energy =
[-0.90447627  1.61723431  7.63434602 18.23199626 36.28279424 61.79300516]
E1 = -3.8663476526524887  E_coul = 1.0287010560616434
cycle= 30 E= -2.83764659659085  delta_E= 2e-06  |g|= 0.000161  |ddm|= 10.1
    CPU time for cycle= 30      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447432771685  LUMO = 1.61726878047316
  mo_energy =
[-0.90447433  1.61726878  7.63451983 18.23261325 36.28380134 61.79525993]
E1 = -3.866344412554314  E_coul = 1.0286943944581664
cycle= 31 E= -2.83765001809615  delta_E= -3.42e-06  |g|= 0.000307  |ddm|= 45.6
    CPU time for cycle= 31      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904476796479268  LUMO = 1.61722103241499
  mo_energy =
[-0.9044768   1.61722103  7.63427422 18.23181619 36.28257879 61.79284894]
E1 = -3.8663487809816477  E_coul = 1.0287035781177294
cycle= 32 E= -2.83764520286392  delta_E= 4.82e-06  |g|= 0.000339  |ddm|= 58.5
    CPU time for cycle= 32      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904476964660008  LUMO = 1.61721758638687
  mo_energy =
[-0.90447696  1.61721759  7.63425674 18.23175545 36.28248101 61.79262453]
E1 = -3.8663491103659293  E_coul = 1.0287009327455832
cycle= 33 E= -2.83764817762035  delta_E= -2.97e-06  |g|= 7.97e-05  |ddm|= 4.59
    CPU time for cycle= 33      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904476766000621  LUMO = 1.61722114487972
  mo_energy =
[-0.90447677  1.61722114  7.63427466 18.23181508 36.28257351 61.79283079]
E1 = -3.866348778502941  E_coul = 1.028700869007891
cycle= 34 E= -2.83764790949505  delta_E= 2.68e-07  |g|= 8.79e-05  |ddm|= 4.49
    CPU time for cycle= 34      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904477342156998  LUMO = 1.61720927382833
  mo_energy =
[-0.90447734  1.61720927  7.63421278 18.23161965 36.28227968 61.7922888 ]
E1 = -3.8663498531559375  E_coul = 1.0287035400829767
cycle= 35 E= -2.83764631307296  delta_E= 1.6e-06  |g|= 0.000287  |ddm|= 14.1
    CPU time for cycle= 35      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904477888411341  LUMO = 1.61719938809639
  mo_energy =
[-0.90447789  1.61719939  7.63416353 18.23143905 36.28198183 61.79159023]
E1 = -3.866350804662479  E_coul = 1.0287045368324312
cycle= 36 E= -2.83764626783005  delta_E= 4.52e-08  |g|= 0.000334  |ddm|= 13.5
    CPU time for cycle= 36      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904477496125519  LUMO = 1.61720632334393
  mo_energy =
[-0.9044775   1.61720632  7.63419684 18.23157101 36.2822088  61.79220938]
E1 = -3.8663501067999944  E_coul = 1.0287021619609107
cycle= 37 E= -2.83764794483908  delta_E= -1.68e-06  |g|= 0.000145  |ddm|= 10.3
    CPU time for cycle= 37      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904477124929796  LUMO = 1.61721378539664
  mo_energy =
[-0.90447712  1.61721379  7.63423552 18.23169682 36.28240218 61.7925825 ]
E1 = -3.866349423690268  E_coul = 1.0287017372395089
cycle= 38 E= -2.83764768645076  delta_E= 2.58e-07  |g|= 0.000137  |ddm|= 9.15
    CPU time for cycle= 38      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904477643139001  LUMO = 1.61720379175619
  mo_energy =
[-0.90447764  1.61720379  7.63418355 18.23153498 36.28216125 61.79213758]
E1 = -3.8663503204123724  E_coul = 1.0287052748225505
cycle= 39 E= -2.83764504558982  delta_E= 2.64e-06  |g|= 0.000426  |ddm|= 11.7
    CPU time for cycle= 39      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904477032245848  LUMO = 1.61721130409783
  mo_energy =
[-0.90447703  1.6172113   7.63421545 18.23165237 36.28234808 61.79268084]
E1 = -3.8663495760823343  E_coul = 1.028702283618831
cycle= 40 E= -2.8376472924635  delta_E= -2.25e-06  |g|= 0.00017  |ddm|= 10.4
    CPU time for cycle= 40      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904481402144434  LUMO = 1.61712812747335
  mo_energy =
[-0.9044814   1.61712813  7.63379065 18.23021218 36.28007146 61.78782948]
E1 = -3.866357319193745  E_coul = 1.0287103386779504
cycle= 41 E= -2.83764698051579  delta_E= 3.12e-07  |g|= 0.000587  |ddm|=  106
    CPU time for cycle= 41      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475151782865  LUMO = 1.61725385025216
  mo_energy =
[-0.90447515  1.61725385  7.63444125 18.23237545 36.28345042 61.79473855]
E1 = -3.866345705211977  E_coul = 1.02869683888859
cycle= 42 E= -2.83764886632339  delta_E= -1.89e-06  |g|= 0.000142  |ddm|=  158
    CPU time for cycle= 42      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475809170603  LUMO = 1.61724082674911
  mo_energy =
[-0.90447581  1.61724083  7.63437395 18.23216035 36.28312689 61.79409979]
E1 = -3.8663468968417325  E_coul = 1.02869965008757
cycle= 43 E= -2.83764724675416  delta_E= 1.62e-06  |g|= 4.34e-05  |ddm|= 15.8
    CPU time for cycle= 43      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.90447581545238  LUMO = 1.61724134175007
  mo_energy =
[-0.90447582  1.61724134  7.63437793 18.23215499 36.28309984 61.79395397]
E1 = -3.8663468896978728  E_coul = 1.0287002582785312
cycle= 44 E= -2.83764663141934  delta_E= 6.15e-07  |g|= 0.000116  |ddm|= 0.622
    CPU time for cycle= 44      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475576143499  LUMO = 1.61724545385409
  mo_energy =
[-0.90447558  1.61724545  7.63439814 18.23222966 36.28322378 61.7942541 ]
E1 = -3.866346492489855  E_coul = 1.0287010574843576
cycle= 45 E= -2.8376454350055  delta_E= 1.2e-06  |g|= 0.000207  |ddm|= 5.67
    CPU time for cycle= 45      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904474992951137  LUMO = 1.61725658336522
  mo_energy =
[-0.90447499  1.61725658  7.63445501 18.2324268  36.28354036 61.79495128]
E1 = -3.8663454481758652  E_coul = 1.0286973768710028
cycle= 46 E= -2.83764807130486  delta_E= -2.64e-06  |g|= 8.59e-05  |ddm|= 14.5
    CPU time for cycle= 46      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475182650123  LUMO = 1.61725286790085
  mo_energy =
[-0.90447518  1.61725287  7.63443543 18.23236554 36.28344866 61.79479484]
E1 = -3.866345777726195  E_coul = 1.0286950933499008
cycle= 47 E= -2.83765068437629  delta_E= -2.61e-06  |g|= 0.000318  |ddm|= 4.34
    CPU time for cycle= 47      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475959677921  LUMO = 1.61723800681592
  mo_energy =
[-0.90447596  1.61723801  7.63435984 18.23210569 36.28303419 61.79388072]
E1 = -3.866347171859828  E_coul = 1.0287003388662823
cycle= 48 E= -2.83764683299355  delta_E= 3.85e-06  |g|= 0.000104  |ddm|= 19.2
    CPU time for cycle= 48      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904475845836884  LUMO = 1.61724034698274
  mo_energy =
[-0.90447585  1.61724035  7.63437196 18.23214415 36.28309154 61.7939854 ]
E1 = -3.866346958227399  E_coul = 1.0286975048408835
cycle= 49 E= -2.83764945338652  delta_E= -2.62e-06  |g|= 0.000142  |ddm|=  2.8
    CPU time for cycle= 49      0.01 sec, wall time      0.01 sec
Linear dependence found in DIIS error vectors.
  HOMO = -0.904478427736784  LUMO = 1.61718877473714
  mo_energy =
[-0.90447843  1.61718877  7.63410438 18.23128665 36.28178917 61.79148473]
E1 = -3.866351651927516  E_coul = 1.0287039392575057
cycle= 50 E= -2.83764771267001  delta_E= 1.74e-06  |g|= 0.000247  |ddm|= 62.4
    CPU time for cycle= 50      0.01 sec, wall time      0.01 sec
E1 = -3.866351651927516  E_coul = 1.0287039392575057

WARN: 	An extra scf cycle is going to be run
	in order to restore the mo_energy derivatives
	missing in implicit differentiation.

  HOMO = -0.904471887161079  LUMO = 1.61724637070615
  mo_energy =
[-0.90447189  1.61724637  7.63438981 18.23224584 36.28330788 61.79464703]
E1 = -3.8663472572407382  E_coul = 1.0286989462567957
Extra cycle  E= -2.83764831098394  delta_E= -5.98e-07  |g|= 6.92e-05  |ddm|= 65.3
    CPU time for scf_cycle      0.49 sec, wall time      0.49 sec
exp = [6.39063753 5.63431975 4.96075425 4.25881618 3.85153881 0.37935145]
E = -2.8376483109839423
E = -2.8376483109839423
exp = [6.3906375312292862e+00,5.6343197504726348e+00,4.9607542523614390e+00,4.2588161840572898e+00,3.8515388051618817e+00,3.7935144573827295e-01]
